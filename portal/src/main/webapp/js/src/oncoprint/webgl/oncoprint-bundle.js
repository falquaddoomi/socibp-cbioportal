(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
var CachedProperty = (function() {
    function CachedProperty(init_val, updateFn) {
	this.value = init_val;
	this.updateFn = updateFn;
	this.bound_properties = [];
    }
    CachedProperty.prototype.update = function() {
	this.value = this.updateFn.apply(null, arguments);
	for (var i=0; i<this.bound_properties.length; i++) {
	    this.bound_properties[i].update();
	}
    }
    CachedProperty.prototype.get = function() {
	return this.value;
    }
    CachedProperty.prototype.updateAndGet = function() {
	this.update();
	return this.get();
    }
    CachedProperty.prototype.addBoundProperty = function(cached_property) {
	this.bound_properties.push(cached_property);
    };
    return CachedProperty;
})();

module.exports = CachedProperty;
},{}],2:[function(require,module,exports){
module.exports = function(array, target_key, keyFn, return_closest_if_not_found) {
    var upper_excl = array.length;
    var lower_incl = 0;
    var middle;
    while (lower_incl < upper_excl) {
	middle = Math.floor((upper_excl + lower_incl) / 2);
	var middle_key = keyFn(array[middle]);
	if (middle_key === target_key) {
	    return middle;
	} else if (target_key > middle_key) {
	    lower_incl = middle + 1;
	} else if (target_key < middle_key) {
	    upper_excl = middle;
	}
    }
    if (return_closest_if_not_found) {
	return lower_incl-1;
    } else {
	return null;
    }
}
},{}],3:[function(require,module,exports){
module.exports = function (str) {
    var ret = [0, 0, 0, 1];
    if (str[0] === "#") {
	// hex, convert to rgba
	var r = parseInt(str[1] + str[2], 16);
	var g = parseInt(str[3] + str[4], 16);
	var b = parseInt(str[5] + str[6], 16);
	str = 'rgba('+r+','+g+','+b+',1)';
    }
    var match = str.match(/^[\s]*rgba\([\s]*([0-9.]+)[\s]*,[\s]*([0-9.]+)[\s]*,[\s]*([0-9.]+)[\s]*,[\s]*([0-9.]+)[\s]*\)[\s]*$/);
    if (match && match.length === 5) {
	ret = [parseFloat(match[1]) / 255,
	    parseFloat(match[2]) / 255,
	    parseFloat(match[3]) / 255,
	    parseFloat(match[4])];
    }
    return ret;
};

},{}],4:[function(require,module,exports){
// Colours for the oncoprint heatmap feature
// viridis comes from matplotlib's default colour set, created by StÃ©fan van der Walt and Nathaniel Smith

module.exports = {
  viridis: [
    [68.086020,1.242870,84.000825,1.000000],
  	[68.470050,2.449275,85.533885,1.000000],
  	[68.835720,3.729375,87.051645,1.000000],
  	[69.182775,5.085210,88.553595,1.000000],
  	[69.511470,6.518565,90.038715,1.000000],
  	[69.821295,8.031735,91.507515,1.000000],
  	[70.112760,9.626760,92.958465,1.000000],
  	[70.385610,11.262585,94.391820,1.000000],
  	[70.639590,12.837720,95.807325,1.000000],
  	[70.874955,14.362620,97.203705,1.000000],
  	[71.091705,15.846975,98.580960,1.000000],
  	[71.289330,17.298180,99.938835,1.000000],
  	[71.468085,18.721335,101.276565,1.000000],
  	[71.627970,20.121285,102.593895,1.000000],
  	[71.768730,21.501600,103.890570,1.000000],
  	[71.890620,22.864830,105.165825,1.000000],
  	[71.993385,24.213525,106.419405,1.000000],
  	[72.077280,25.549980,107.650800,1.000000],
  	[72.142050,26.875215,108.860010,1.000000],
  	[72.188205,28.191015,110.046270,1.000000],
  	[72.215235,29.498400,111.209325,1.000000],
  	[72.223395,30.798135,112.348920,1.000000],
  	[72.212685,32.091240,113.464800,1.000000],
  	[72.183360,33.378225,114.556455,1.000000],
  	[72.135420,34.659600,115.623885,1.000000],
  	[72.068865,35.936130,116.666835,1.000000],
  	[71.983950,37.207560,117.685050,1.000000],
  	[71.881185,38.474655,118.678275,1.000000],
  	[71.760060,39.737670,119.646255,1.000000],
  	[71.621340,40.996605,120.589245,1.000000],
  	[71.465025,42.251715,121.506990,1.000000],
  	[71.291370,43.502745,122.399235,1.000000],
  	[71.100630,44.749950,123.266235,1.000000],
  	[70.893060,45.993585,124.107735,1.000000],
  	[70.669170,47.233140,124.923990,1.000000],
  	[70.429470,48.468870,125.715255,1.000000],
  	[70.173705,49.700775,126.481275,1.000000],
  	[69.902640,50.928855,127.222305,1.000000],
  	[69.616530,52.152600,127.938855,1.000000],
  	[69.316140,53.372265,128.630670,1.000000],
  	[69.001725,54.587595,129.298260,1.000000],
  	[68.673540,55.798590,129.942135,1.000000],
  	[68.331840,57.004995,130.562040,1.000000],
  	[67.977900,58.206810,131.158995,1.000000],
  	[67.611975,59.403780,131.732745,1.000000],
  	[67.234065,60.595905,132.284310,1.000000],
  	[66.845190,61.782930,132.813435,1.000000],
  	[66.445605,62.965110,133.321140,1.000000],
  	[66.036075,64.141935,133.807680,1.000000],
  	[65.617110,65.313150,134.273565,1.000000],
  	[65.189475,66.479265,134.719560,1.000000],
  	[64.753425,67.639770,135.145665,1.000000],
  	[64.309470,68.794665,135.552645,1.000000],
  	[63.858375,69.943950,135.941265,1.000000],
  	[63.400395,71.087625,136.311780,1.000000],
  	[62.936805,72.225435,136.664955,1.000000],
  	[62.467860,73.357125,137.001300,1.000000],
  	[61.993815,74.483460,137.321580,1.000000],
  	[61.515435,75.603675,137.625795,1.000000],
  	[61.033230,76.718025,137.915220,1.000000],
  	[60.547455,77.826510,138.189855,1.000000],
  	[60.059130,78.929385,138.450720,1.000000],
  	[59.568765,80.026140,138.698070,1.000000],
  	[59.076870,81.117030,138.932670,1.000000],
  	[58.583445,82.202055,139.155030,1.000000],
  	[58.089510,83.281470,139.365660,1.000000],
  	[57.595065,84.355275,139.565070,1.000000],
  	[57.100875,85.423470,139.753515,1.000000],
  	[56.607195,86.486055,139.931760,1.000000],
  	[56.114535,87.543285,140.100315,1.000000],
  	[55.623150,88.595160,140.259690,1.000000],
  	[55.133550,89.641425,140.409885,1.000000],
  	[54.645990,90.682845,140.551920,1.000000],
  	[54.160725,91.719165,140.686050,1.000000],
  	[53.678265,92.750385,140.812530,1.000000],
  	[53.198865,93.776760,140.932125,1.000000],
  	[52.722780,94.798290,141.044835,1.000000],
  	[52.250265,95.815230,141.150915,1.000000],
  	[51.781065,96.827580,141.250875,1.000000],
  	[51.315945,97.835850,141.344970,1.000000],
  	[50.854650,98.839785,141.433710,1.000000],
  	[50.397180,99.839640,141.517095,1.000000],
  	[49.944300,100.835415,141.595380,1.000000],
  	[49.495500,101.827365,141.669075,1.000000],
  	[49.051035,102.815745,141.738180,1.000000],
  	[48.610905,103.800555,141.802695,1.000000],
  	[48.175365,104.782050,141.863130,1.000000],
  	[47.743905,105.760230,141.919485,1.000000],
  	[47.316780,106.735350,141.972015,1.000000],
  	[46.893990,107.707665,142.020720,1.000000],
  	[46.475280,108.676920,142.065600,1.000000],
  	[46.060395,109.643625,142.106910,1.000000],
  	[45.649845,110.607780,142.144650,1.000000],
  	[45.242865,111.569385,142.179075,1.000000],
  	[44.839455,112.528950,142.209675,1.000000],
  	[44.439870,113.486220,142.236960,1.000000],
  	[44.043345,114.441705,142.260675,1.000000],
  	[43.649880,115.395150,142.281075,1.000000],
  	[43.259730,116.346810,142.297650,1.000000],
  	[42.872130,117.296940,142.310910,1.000000],
  	[42.487335,118.245540,142.320345,1.000000],
  	[42.104835,119.192865,142.325955,1.000000],
  	[41.724375,120.138915,142.327740,1.000000],
  	[41.346210,121.083690,142.325700,1.000000],
  	[40.969575,122.027700,142.319325,1.000000],
  	[40.594470,122.970435,142.308615,1.000000],
  	[40.220895,123.912660,142.293315,1.000000],
  	[39.848850,124.854120,142.273680,1.000000],
  	[39.477825,125.794815,142.249200,1.000000],
  	[39.107820,126.735000,142.219620,1.000000],
  	[38.739090,127.674675,142.184685,1.000000],
  	[38.371380,128.614095,142.144650,1.000000],
  	[38.004945,129.553005,142.098750,1.000000],
  	[37.639785,130.491915,142.047495,1.000000],
  	[37.275900,131.430315,141.989865,1.000000],
  	[36.913545,132.368715,141.925860,1.000000],
  	[36.552465,133.307115,141.855225,1.000000],
  	[36.193425,134.245515,141.777705,1.000000],
  	[35.836680,135.183660,141.693045,1.000000],
  	[35.482485,136.122060,141.600990,1.000000],
  	[35.131350,137.060460,141.501030,1.000000],
  	[34.784040,137.999115,141.393165,1.000000],
  	[34.441830,138.937515,141.277395,1.000000],
  	[34.104465,139.876425,141.152955,1.000000],
  	[33.773220,140.815080,141.019590,1.000000],
  	[33.448860,141.754245,140.877045,1.000000],
  	[33.132915,142.693410,140.725320,1.000000],
  	[32.825895,143.632575,140.563395,1.000000],
  	[32.529840,144.571995,140.391780,1.000000],
  	[32.245515,145.511415,140.209455,1.000000],
  	[31.975470,146.451090,140.016930,1.000000],
  	[31.720725,147.390510,139.813185,1.000000],
  	[31.483065,148.330185,139.598475,1.000000],
  	[31.264530,149.269605,139.372035,1.000000],
  	[31.066905,150.209025,139.133865,1.000000],
  	[30.892740,151.148445,138.883455,1.000000],
  	[30.744075,152.087610,138.620805,1.000000],
  	[30.623460,153.026520,138.345150,1.000000],
  	[30.533190,153.965175,138.057000,1.000000],
  	[30.475560,154.903320,137.755590,1.000000],
  	[30.452865,155.840955,137.440410,1.000000],
  	[30.468165,156.778335,137.111460,1.000000],
  	[30.523245,157.714950,136.768485,1.000000],
  	[30.620655,158.651055,136.411230,1.000000],
  	[30.762690,159.586140,136.039440,1.000000],
  	[30.951900,160.520460,135.653115,1.000000],
  	[31.189560,161.454015,135.251490,1.000000],
  	[31.478220,162.386295,134.834565,1.000000],
  	[31.818900,163.317555,134.402340,1.000000],
  	[32.213130,164.247285,133.954305,1.000000],
  	[32.662185,165.175995,133.490205,1.000000],
  	[33.167085,166.102920,133.010040,1.000000],
  	[33.728340,167.028570,132.513555,1.000000],
  	[34.346460,167.952180,132.000495,1.000000],
  	[35.021445,168.874260,131.470605,1.000000],
  	[35.753550,169.794045,130.923885,1.000000],
  	[36.542265,170.712045,130.359825,1.000000],
  	[37.387080,171.627750,129.778680,1.000000],
  	[38.287740,172.540905,129.180195,1.000000],
  	[39.242970,173.451765,128.563860,1.000000],
  	[40.252005,174.360075,127.929930,1.000000],
  	[41.314080,175.265580,127.277895,1.000000],
  	[42.427665,176.168280,126.608010,1.000000],
  	[43.591740,177.067920,125.919765,1.000000],
  	[44.805285,177.964500,125.213415,1.000000],
  	[46.066515,178.857510,124.488195,1.000000],
  	[47.374665,179.747205,123.744615,1.000000],
  	[48.727950,180.633330,122.982420,1.000000],
  	[50.125605,181.515885,122.201355,1.000000],
  	[51.565845,182.394360,121.401420,1.000000],
  	[53.047650,183.268755,120.582615,1.000000],
  	[54.570000,184.139070,119.744940,1.000000],
  	[56.131620,185.004795,118.887630,1.000000],
  	[57.731235,185.866440,118.011195,1.000000],
  	[59.367825,186.722985,117.115635,1.000000],
  	[61.040370,187.574940,116.200440,1.000000],
  	[62.747850,188.422050,115.266120,1.000000],
  	[64.489245,189.263805,114.312420,1.000000],
  	[66.263535,190.100460,113.339085,1.000000],
  	[68.069955,190.931505,112.346115,1.000000],
  	[69.907995,191.756940,111.333255,1.000000],
  	[71.776635,192.576765,110.300760,1.000000],
  	[73.674855,193.390470,109.248630,1.000000],
  	[75.602145,194.198055,108.176865,1.000000],
  	[77.557740,194.999520,107.085465,1.000000],
  	[79.540875,195.794610,105.974430,1.000000],
  	[81.551295,196.583070,104.843760,1.000000],
  	[83.587980,197.364900,103.693200,1.000000],
  	[85.650675,198.139590,102.522495,1.000000],
  	[87.738870,198.907395,101.332155,1.000000],
  	[89.851800,199.667805,100.122180,1.000000],
  	[91.988955,200.420820,98.892570,1.000000],
  	[94.149570,201.166440,97.643070,1.000000],
  	[96.333645,201.904155,96.374445,1.000000],
  	[98.540415,202.634220,95.085930,1.000000],
  	[100.769370,203.356125,93.778035,1.000000],
  	[103.020255,204.070125,92.450760,1.000000],
  	[105.292815,204.775455,91.103595,1.000000],
  	[107.586540,205.472370,89.737050,1.000000],
  	[109.900665,206.160615,88.351380,1.000000],
  	[112.234935,206.840190,86.946585,1.000000],
  	[114.588840,207.510840,85.522920,1.000000],
  	[116.961870,208.172565,84.080385,1.000000],
  	[119.353515,208.824855,82.619490,1.000000],
  	[121.763520,209.468220,81.139725,1.000000],
  	[124.191630,210.101895,79.641855,1.000000],
  	[126.636825,210.725880,78.126135,1.000000],
  	[129.099105,211.340430,76.592310,1.000000],
  	[131.577960,211.945290,75.041145,1.000000],
  	[134.072880,212.540205,73.472385,1.000000],
  	[136.583355,213.125175,71.886540,1.000000],
  	[139.108620,213.699945,70.284630,1.000000],
  	[141.648420,214.264770,68.666655,1.000000],
  	[144.201990,214.819650,67.033635,1.000000],
  	[146.768565,215.364330,65.385825,1.000000],
  	[149.347890,215.898555,63.723735,1.000000],
  	[151.938945,216.422835,62.048895,1.000000],
  	[154.541475,216.936915,60.361560,1.000000],
  	[157.154715,217.440795,58.663260,1.000000],
  	[159.777645,217.934475,56.955015,1.000000],
  	[162.410010,218.418210,55.238100,1.000000],
  	[165.050535,218.892000,53.514555,1.000000],
  	[167.698710,219.355845,51.785910,1.000000],
  	[170.353770,219.809745,50.054715,1.000000],
  	[173.014695,220.254210,48.323265,1.000000],
  	[175.680720,220.689240,46.594875,1.000000],
  	[178.350825,221.114835,44.872605,1.000000],
  	[181.023990,221.531505,43.160535,1.000000],
  	[183.699705,221.939250,41.463765,1.000000],
  	[186.376695,222.338580,39.787395,1.000000],
  	[189.053940,222.729495,38.138055,1.000000],
  	[191.730420,223.112505,36.523140,1.000000],
  	[194.405115,223.488120,34.951320,1.000000],
  	[197.077260,223.856340,33.432795,1.000000],
  	[199.745325,224.217675,31.978275,1.000000],
  	[202.408800,224.572890,30.601275,1.000000],
  	[205.066410,224.921730,29.316075,1.000000],
  	[207.716880,225.265215,28.138485,1.000000],
  	[210.359700,225.603600,27.085335,1.000000],
  	[212.993850,225.937395,26.174730,1.000000],
  	[215.618055,226.267110,25.424010,1.000000],
  	[218.231550,226.593255,24.850260,1.000000],
  	[220.833315,226.916340,24.468015,1.000000],
  	[223.422840,227.236875,24.288750,1.000000],
  	[225.999105,227.555370,24.320370,1.000000],
  	[228.561600,227.872080,24.565425,1.000000],
  	[231.109305,228.188025,25.021875,1.000000],
  	[233.641710,228.503205,25.682835,1.000000],
  	[236.157030,228.819150,26.538105,1.000000],
  	[238.655520,229.135350,27.573405,1.000000],
  	[241.137180,229.452825,28.773690,1.000000],
  	[243.601500,229.771575,30.122640,1.000000],
  	[246.047970,230.092365,31.604955,1.000000],
  	[248.476335,230.415450,33.204825,1.000000],
  	[250.886340,230.741085,34.908735,1.000000],
  	[253.278240,231.070035,36.703680,1.000000],
  ],
  inferno: [
    [0.372810,0.118830,3.535830,1.000000],
    [0.578085,0.323850,4.735350,1.000000],
    [0.841245,0.573495,6.180945,1.000000],
    [1.159485,0.864960,7.881795,1.000000],
    [1.531530,1.196460,9.832290,1.000000],
    [1.957380,1.564680,11.943180,1.000000],
    [2.438055,1.966815,14.061465,1.000000],
    [2.974065,2.401335,16.182300,1.000000],
    [3.568725,2.862375,18.324810,1.000000],
    [4.223055,3.349680,20.471910,1.000000],
    [4.940115,3.858915,22.635585,1.000000],
    [5.723985,4.385745,24.818385,1.000000],
    [6.577215,4.929405,27.012150,1.000000],
    [7.505160,5.483265,29.228355,1.000000],
    [8.513175,6.044010,31.466235,1.000000],
    [9.605340,6.609855,33.719160,1.000000],
    [10.774515,7.175445,35.990955,1.000000],
    [11.963325,7.732620,38.291820,1.000000],
    [13.169220,8.280870,40.609770,1.000000],
    [14.394495,8.815095,42.945570,1.000000],
    [15.641700,9.330450,45.298710,1.000000],
    [16.914405,9.818520,47.675310,1.000000],
    [18.214395,10.274970,50.070270,1.000000],
    [19.542435,10.685775,52.478745,1.000000],
    [20.900310,11.048640,54.898695,1.000000],
    [22.289805,11.361780,57.327315,1.000000],
    [23.712450,11.623665,59.761290,1.000000],
    [25.169010,11.832510,62.195520,1.000000],
    [26.660505,11.987040,64.624650,1.000000],
    [28.186680,12.086745,67.042560,1.000000],
    [29.747280,12.131370,69.441855,1.000000],
    [31.341540,12.121680,71.814120,1.000000],
    [32.967675,12.059715,74.150940,1.000000],
    [34.623390,11.948280,76.442880,1.000000],
    [36.306390,11.791710,78.681015,1.000000],
    [38.013615,11.594340,80.856675,1.000000],
    [39.741750,11.362545,82.961190,1.000000],
    [41.485695,11.106270,84.985635,1.000000],
    [43.241625,10.834695,86.922870,1.000000],
    [45.005715,10.557510,88.768305,1.000000],
    [46.774395,10.283895,90.517605,1.000000],
    [48.543585,10.023795,92.168985,1.000000],
    [50.310735,9.792000,93.721425,1.000000],
    [52.073295,9.596160,95.175690,1.000000],
    [53.829225,9.442650,96.533565,1.000000],
    [55.576995,9.336825,97.798110,1.000000],
    [57.314565,9.283275,98.972895,1.000000],
    [59.042190,9.283275,100.062000,1.000000],
    [60.759615,9.338355,101.070015,1.000000],
    [62.466585,9.449025,102.001785,1.000000],
    [64.163100,9.614775,102.861390,1.000000],
    [65.849670,9.835605,103.653675,1.000000],
    [67.526550,10.109985,104.382975,1.000000],
    [69.193485,10.435110,105.053880,1.000000],
    [70.851750,10.800015,105.669960,1.000000],
    [72.501855,11.202915,106.235040,1.000000],
    [74.144565,11.639220,106.752435,1.000000],
    [75.780390,12.104850,107.225205,1.000000],
    [77.409840,12.595980,107.656410,1.000000],
    [79.033425,13.108785,108.048855,1.000000],
    [80.651910,13.639950,108.404580,1.000000],
    [82.265550,14.186670,108.726135,1.000000],
    [83.874855,14.745885,109.015305,1.000000],
    [85.480335,15.315300,109.273620,1.000000],
    [87.082500,15.892875,109.503375,1.000000],
    [88.681605,16.477080,109.705335,1.000000],
    [90.278160,17.065875,109.881030,1.000000],
    [91.872420,17.657985,110.031735,1.000000],
    [93.464895,18.252645,110.158470,1.000000],
    [95.055840,18.848325,110.262000,1.000000],
    [96.645255,19.444515,110.343345,1.000000],
    [98.233140,20.040705,110.403525,1.000000],
    [99.820515,20.636385,110.442795,1.000000],
    [101.406870,21.230535,110.461665,1.000000],
    [102.992970,21.822900,110.460645,1.000000],
    [104.578815,22.413480,110.439990,1.000000],
    [106.164405,23.001765,110.400465,1.000000],
    [107.749995,23.587755,110.342070,1.000000],
    [109.335840,24.171450,110.265060,1.000000],
    [110.921685,24.752595,110.169945,1.000000],
    [112.507785,25.331190,110.056470,1.000000],
    [114.094140,25.907235,109.925400,1.000000],
    [115.681005,26.481240,109.776990,1.000000],
    [117.268125,27.052695,109.610730,1.000000],
    [118.855500,27.622110,109.426875,1.000000],
    [120.443640,28.189485,109.225170,1.000000],
    [122.032290,28.754820,109.006125,1.000000],
    [123.621195,29.318370,108.769740,1.000000],
    [125.210610,29.880645,108.515760,1.000000],
    [126.800535,30.441645,108.244440,1.000000],
    [128.390715,31.001625,107.955780,1.000000],
    [129.981150,31.561095,107.649780,1.000000],
    [131.571585,32.119800,107.326185,1.000000],
    [133.162530,32.678250,106.984995,1.000000],
    [134.753220,33.236955,106.626210,1.000000],
    [136.344165,33.796170,106.250085,1.000000],
    [137.934600,34.355895,105.856365,1.000000],
    [139.525035,34.916895,105.445305,1.000000],
    [141.114960,35.479170,105.016395,1.000000],
    [142.704120,36.043230,104.569890,1.000000],
    [144.292770,36.609585,104.105790,1.000000],
    [145.880655,37.178235,103.624095,1.000000],
    [147.467520,37.749945,103.124805,1.000000],
    [149.052855,38.324970,102.608175,1.000000],
    [150.637170,38.903565,102.073950,1.000000],
    [152.219700,39.486240,101.521875,1.000000],
    [153.800445,40.073505,100.952205,1.000000],
    [155.379150,40.665870,100.365195,1.000000],
    [156.955815,41.263335,99.760845,1.000000],
    [158.529675,41.866920,99.139155,1.000000],
    [160.100985,42.476625,98.500380,1.000000],
    [161.669490,43.092960,97.844520,1.000000],
    [163.234425,43.716690,97.171575,1.000000],
    [164.796300,44.348070,96.481545,1.000000],
    [166.354095,44.987355,95.774430,1.000000],
    [167.908065,45.635310,95.050740,1.000000],
    [169.457700,46.292445,94.310730,1.000000],
    [171.002745,46.959015,93.554145,1.000000],
    [172.542690,47.635785,92.781495,1.000000],
    [174.077280,48.322755,91.993035,1.000000],
    [175.606515,49.020945,91.188765,1.000000],
    [177.129885,49.730355,90.368940,1.000000],
    [178.646880,50.452005,89.533815,1.000000],
    [180.157500,51.185640,88.683135,1.000000],
    [181.660980,51.932280,87.817665,1.000000],
    [183.157320,52.692180,86.937405,1.000000],
    [184.646265,53.465850,86.043120,1.000000],
    [186.126795,54.253545,85.134555,1.000000],
    [187.599165,55.056030,84.212475,1.000000],
    [189.062865,55.873560,83.276880,1.000000],
    [190.517385,56.706390,82.328280,1.000000],
    [191.962470,57.555030,81.366675,1.000000],
    [193.397610,58.419735,80.392830,1.000000],
    [194.822550,59.301270,79.406745,1.000000],
    [196.236780,60.199635,78.408675,1.000000],
    [197.640045,61.115085,77.399130,1.000000],
    [199.031835,62.048385,76.378365,1.000000],
    [200.411895,62.999280,75.346635,1.000000],
    [201.779715,63.968280,74.304450,1.000000],
    [203.134785,64.955640,73.252320,1.000000],
    [204.477105,65.961870,72.190245,1.000000],
    [205.805910,66.986460,71.118990,1.000000],
    [207.120945,68.030430,70.038555,1.000000],
    [208.421955,69.093270,68.949450,1.000000],
    [209.708430,70.175235,67.851675,1.000000],
    [210.979860,71.276835,66.746250,1.000000],
    [212.236245,72.397815,65.632665,1.000000],
    [213.477075,73.538175,64.511940,1.000000],
    [214.702095,74.697915,63.383820,1.000000],
    [215.910795,75.877545,62.248815,1.000000],
    [217.102920,77.076300,61.107180,1.000000],
    [218.277960,78.294690,59.958915,1.000000],
    [219.435915,79.532460,58.804530,1.000000],
    [220.576530,80.789610,57.644025,1.000000],
    [221.699295,82.065885,56.477910,1.000000],
    [222.803955,83.361030,55.305930,1.000000],
    [223.890255,84.675300,54.128340,1.000000],
    [224.957940,86.008185,52.945140,1.000000],
    [226.007010,87.359430,51.756840,1.000000],
    [227.036955,88.729035,50.562930,1.000000],
    [228.047775,90.116745,49.363920,1.000000],
    [229.038960,91.522305,48.159300,1.000000],
    [230.010765,92.945460,46.949580,1.000000],
    [230.962425,94.385700,45.734250,1.000000],
    [231.894450,95.843280,44.513565,1.000000],
    [232.806330,97.317180,43.287525,1.000000],
    [233.697810,98.807655,42.055620,1.000000],
    [234.569145,100.314195,40.817850,1.000000],
    [235.419825,101.836545,39.574215,1.000000],
    [236.249850,103.374195,38.324460,1.000000],
    [237.059220,104.927145,37.068585,1.000000],
    [237.847935,106.494885,35.806335,1.000000],
    [238.615485,108.076905,34.537200,1.000000],
    [239.362125,109.673205,33.261690,1.000000],
    [240.087855,111.283275,31.979295,1.000000],
    [240.792675,112.906860,30.690270,1.000000],
    [241.476075,114.543705,29.394360,1.000000],
    [242.138310,116.193300,28.091820,1.000000],
    [242.779125,117.855390,26.782905,1.000000],
    [243.399030,119.529720,25.467870,1.000000],
    [243.997260,121.215780,24.147225,1.000000],
    [244.574070,122.913570,22.822245,1.000000],
    [245.129715,124.622580,21.493695,1.000000],
    [245.663685,126.342810,20.163615,1.000000],
    [246.176235,128.073495,18.834045,1.000000],
    [246.667110,129.814890,17.508045,1.000000],
    [247.136565,131.566230,16.189440,1.000000],
    [247.584345,133.327515,14.883585,1.000000],
    [248.010450,135.098490,13.597620,1.000000],
    [248.414880,136.878900,12.339960,1.000000],
    [248.797635,138.668490,11.122590,1.000000],
    [249.158460,140.466750,9.957750,1.000000],
    [249.497610,142.273935,8.907405,1.000000],
    [249.814830,144.089535,8.009295,1.000000],
    [250.110120,145.913295,7.269540,1.000000],
    [250.383225,147.744960,6.693750,1.000000],
    [250.634655,149.584530,6.288555,1.000000],
    [250.863645,151.431495,6.061350,1.000000],
    [251.070705,153.286110,6.019530,1.000000],
    [251.255325,155.147610,6.171510,1.000000],
    [251.417760,157.016250,6.525960,1.000000],
    [251.558010,158.891775,7.092570,1.000000],
    [251.675820,160.773675,7.881540,1.000000],
    [251.770935,162.661950,8.903580,1.000000],
    [251.843610,164.556600,10.170930,1.000000],
    [251.893845,166.457115,11.623155,1.000000],
    [251.921130,168.363750,13.196250,1.000000],
    [251.925975,170.275740,14.873895,1.000000],
    [251.907870,172.193085,16.640535,1.000000],
    [251.867070,174.115785,18.484695,1.000000],
    [251.803320,176.043330,20.397450,1.000000],
    [251.716620,177.975720,22.371405,1.000000],
    [251.606970,179.912700,24.401970,1.000000],
    [251.474625,181.854015,26.485065,1.000000],
    [251.319330,183.799410,28.618395,1.000000],
    [251.140575,185.748885,30.800175,1.000000],
    [250.939125,187.702185,33.029385,1.000000],
    [250.714980,189.658290,35.305515,1.000000],
    [250.468140,191.617710,37.629075,1.000000],
    [250.199115,193.579425,40.000065,1.000000],
    [249.908160,195.543435,42.420015,1.000000],
    [249.595530,197.508975,44.889435,1.000000],
    [249.261735,199.475790,47.410365,1.000000],
    [248.907540,201.443370,49.984590,1.000000],
    [248.532690,203.411460,52.614660,1.000000],
    [248.137440,205.379295,55.303635,1.000000],
    [247.724340,207.346110,58.052790,1.000000],
    [247.294665,209.310375,60.864930,1.000000],
    [246.850455,211.271325,63.742860,1.000000],
    [246.391965,213.228705,66.691170,1.000000],
    [245.920470,215.181240,69.714705,1.000000],
    [245.441835,217.126380,72.814230,1.000000],
    [244.959630,219.062595,75.992550,1.000000],
    [244.473600,220.989120,79.259100,1.000000],
    [243.992670,222.902895,82.613370,1.000000],
    [243.524235,224.800095,86.056125,1.000000],
    [243.069825,226.680210,89.599095,1.000000],
    [242.644230,228.537630,93.234885,1.000000],
    [242.254590,230.369295,96.969105,1.000000],
    [241.914165,232.170615,100.798695,1.000000],
    [241.636470,233.936745,104.719575,1.000000],
    [241.436295,235.662840,108.725115,1.000000],
    [241.329960,237.344055,112.803585,1.000000],
    [241.332765,238.975545,116.940960,1.000000],
    [241.460265,240.553740,121.117350,1.000000],
    [241.723935,242.076090,125.313630,1.000000],
    [242.133975,243.541065,129.504300,1.000000],
    [242.693700,244.949685,133.671765,1.000000],
    [243.404895,246.303480,137.792055,1.000000],
    [244.263480,247.605765,141.850125,1.000000],
    [245.262060,248.860620,145.840875,1.000000],
    [246.393495,250.072890,149.737530,1.000000],
    [247.646310,251.246910,153.549270,1.000000],
    [249.010305,252.387015,157.273800,1.000000],
    [250.475535,253.497795,160.909335,1.000000],
    [252.032310,254.582820,164.455620,1.000000],
  ]
}

},{}],5:[function(require,module,exports){
window.Oncoprint = require('./oncoprint.js');
},{"./oncoprint.js":17}],6:[function(require,module,exports){
module.exports = function (tag, attrs) {
    var el = document.createElementNS('http://www.w3.org/2000/svg', tag);
    for (var k in attrs) {
	if (attrs.hasOwnProperty(k)) {
	    el.setAttribute(k, attrs[k]);
	}
    }
    return el;
};
},{}],7:[function(require,module,exports){
/**
 * @fileoverview gl-matrix - High performance matrix and vector operations
 * @author Brandon Jones
 * @author Colin MacKenzie IV
 * @version 2.3.2
 */

/* Copyright (c) 2015, Brandon Jones, Colin MacKenzie IV.

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE. */
// END HEADER

exports.glMatrix = require("./gl-matrix/common.js");
exports.mat2 = require("./gl-matrix/mat2.js");
exports.mat2d = require("./gl-matrix/mat2d.js");
exports.mat3 = require("./gl-matrix/mat3.js");
exports.mat4 = require("./gl-matrix/mat4.js");
exports.quat = require("./gl-matrix/quat.js");
exports.vec2 = require("./gl-matrix/vec2.js");
exports.vec3 = require("./gl-matrix/vec3.js");
exports.vec4 = require("./gl-matrix/vec4.js");
},{"./gl-matrix/common.js":8,"./gl-matrix/mat2.js":9,"./gl-matrix/mat2d.js":10,"./gl-matrix/mat3.js":11,"./gl-matrix/mat4.js":12,"./gl-matrix/quat.js":13,"./gl-matrix/vec2.js":14,"./gl-matrix/vec3.js":15,"./gl-matrix/vec4.js":16}],8:[function(require,module,exports){
/* Copyright (c) 2015, Brandon Jones, Colin MacKenzie IV.

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE. */

/**
 * @class Common utilities
 * @name glMatrix
 */
var glMatrix = {};

// Configuration Constants
glMatrix.EPSILON = 0.000001;
glMatrix.ARRAY_TYPE = (typeof Float32Array !== 'undefined') ? Float32Array : Array;
glMatrix.RANDOM = Math.random;
glMatrix.ENABLE_SIMD = false;

// Capability detection
glMatrix.SIMD_AVAILABLE = (glMatrix.ARRAY_TYPE === Float32Array) && ('SIMD' in this);
glMatrix.USE_SIMD = glMatrix.ENABLE_SIMD && glMatrix.SIMD_AVAILABLE;

/**
 * Sets the type of array used when creating new vectors and matrices
 *
 * @param {Type} type Array type, such as Float32Array or Array
 */
glMatrix.setMatrixArrayType = function(type) {
    glMatrix.ARRAY_TYPE = type;
}

var degree = Math.PI / 180;

/**
* Convert Degree To Radian
*
* @param {Number} Angle in Degrees
*/
glMatrix.toRadian = function(a){
     return a * degree;
}

/**
 * Tests whether or not the arguments have approximately the same value, within an absolute
 * or relative tolerance of glMatrix.EPSILON (an absolute tolerance is used for values less 
 * than or equal to 1.0, and a relative tolerance is used for larger values)
 * 
 * @param {Number} a The first number to test.
 * @param {Number} b The second number to test.
 * @returns {Boolean} True if the numbers are approximately equal, false otherwise.
 */
glMatrix.equals = function(a, b) {
	return Math.abs(a - b) <= glMatrix.EPSILON*Math.max(1.0, Math.abs(a), Math.abs(b));
}

module.exports = glMatrix;

},{}],9:[function(require,module,exports){
/* Copyright (c) 2015, Brandon Jones, Colin MacKenzie IV.

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE. */

var glMatrix = require("./common.js");

/**
 * @class 2x2 Matrix
 * @name mat2
 */
var mat2 = {};

/**
 * Creates a new identity mat2
 *
 * @returns {mat2} a new 2x2 matrix
 */
mat2.create = function() {
    var out = new glMatrix.ARRAY_TYPE(4);
    out[0] = 1;
    out[1] = 0;
    out[2] = 0;
    out[3] = 1;
    return out;
};

/**
 * Creates a new mat2 initialized with values from an existing matrix
 *
 * @param {mat2} a matrix to clone
 * @returns {mat2} a new 2x2 matrix
 */
mat2.clone = function(a) {
    var out = new glMatrix.ARRAY_TYPE(4);
    out[0] = a[0];
    out[1] = a[1];
    out[2] = a[2];
    out[3] = a[3];
    return out;
};

/**
 * Copy the values from one mat2 to another
 *
 * @param {mat2} out the receiving matrix
 * @param {mat2} a the source matrix
 * @returns {mat2} out
 */
mat2.copy = function(out, a) {
    out[0] = a[0];
    out[1] = a[1];
    out[2] = a[2];
    out[3] = a[3];
    return out;
};

/**
 * Set a mat2 to the identity matrix
 *
 * @param {mat2} out the receiving matrix
 * @returns {mat2} out
 */
mat2.identity = function(out) {
    out[0] = 1;
    out[1] = 0;
    out[2] = 0;
    out[3] = 1;
    return out;
};

/**
 * Create a new mat2 with the given values
 *
 * @param {Number} m00 Component in column 0, row 0 position (index 0)
 * @param {Number} m01 Component in column 0, row 1 position (index 1)
 * @param {Number} m10 Component in column 1, row 0 position (index 2)
 * @param {Number} m11 Component in column 1, row 1 position (index 3)
 * @returns {mat2} out A new 2x2 matrix
 */
mat2.fromValues = function(m00, m01, m10, m11) {
    var out = new glMatrix.ARRAY_TYPE(4);
    out[0] = m00;
    out[1] = m01;
    out[2] = m10;
    out[3] = m11;
    return out;
};

/**
 * Set the components of a mat2 to the given values
 *
 * @param {mat2} out the receiving matrix
 * @param {Number} m00 Component in column 0, row 0 position (index 0)
 * @param {Number} m01 Component in column 0, row 1 position (index 1)
 * @param {Number} m10 Component in column 1, row 0 position (index 2)
 * @param {Number} m11 Component in column 1, row 1 position (index 3)
 * @returns {mat2} out
 */
mat2.set = function(out, m00, m01, m10, m11) {
    out[0] = m00;
    out[1] = m01;
    out[2] = m10;
    out[3] = m11;
    return out;
};


/**
 * Transpose the values of a mat2
 *
 * @param {mat2} out the receiving matrix
 * @param {mat2} a the source matrix
 * @returns {mat2} out
 */
mat2.transpose = function(out, a) {
    // If we are transposing ourselves we can skip a few steps but have to cache some values
    if (out === a) {
        var a1 = a[1];
        out[1] = a[2];
        out[2] = a1;
    } else {
        out[0] = a[0];
        out[1] = a[2];
        out[2] = a[1];
        out[3] = a[3];
    }
    
    return out;
};

/**
 * Inverts a mat2
 *
 * @param {mat2} out the receiving matrix
 * @param {mat2} a the source matrix
 * @returns {mat2} out
 */
mat2.invert = function(out, a) {
    var a0 = a[0], a1 = a[1], a2 = a[2], a3 = a[3],

        // Calculate the determinant
        det = a0 * a3 - a2 * a1;

    if (!det) {
        return null;
    }
    det = 1.0 / det;
    
    out[0] =  a3 * det;
    out[1] = -a1 * det;
    out[2] = -a2 * det;
    out[3] =  a0 * det;

    return out;
};

/**
 * Calculates the adjugate of a mat2
 *
 * @param {mat2} out the receiving matrix
 * @param {mat2} a the source matrix
 * @returns {mat2} out
 */
mat2.adjoint = function(out, a) {
    // Caching this value is nessecary if out == a
    var a0 = a[0];
    out[0] =  a[3];
    out[1] = -a[1];
    out[2] = -a[2];
    out[3] =  a0;

    return out;
};

/**
 * Calculates the determinant of a mat2
 *
 * @param {mat2} a the source matrix
 * @returns {Number} determinant of a
 */
mat2.determinant = function (a) {
    return a[0] * a[3] - a[2] * a[1];
};

/**
 * Multiplies two mat2's
 *
 * @param {mat2} out the receiving matrix
 * @param {mat2} a the first operand
 * @param {mat2} b the second operand
 * @returns {mat2} out
 */
mat2.multiply = function (out, a, b) {
    var a0 = a[0], a1 = a[1], a2 = a[2], a3 = a[3];
    var b0 = b[0], b1 = b[1], b2 = b[2], b3 = b[3];
    out[0] = a0 * b0 + a2 * b1;
    out[1] = a1 * b0 + a3 * b1;
    out[2] = a0 * b2 + a2 * b3;
    out[3] = a1 * b2 + a3 * b3;
    return out;
};

/**
 * Alias for {@link mat2.multiply}
 * @function
 */
mat2.mul = mat2.multiply;

/**
 * Rotates a mat2 by the given angle
 *
 * @param {mat2} out the receiving matrix
 * @param {mat2} a the matrix to rotate
 * @param {Number} rad the angle to rotate the matrix by
 * @returns {mat2} out
 */
mat2.rotate = function (out, a, rad) {
    var a0 = a[0], a1 = a[1], a2 = a[2], a3 = a[3],
        s = Math.sin(rad),
        c = Math.cos(rad);
    out[0] = a0 *  c + a2 * s;
    out[1] = a1 *  c + a3 * s;
    out[2] = a0 * -s + a2 * c;
    out[3] = a1 * -s + a3 * c;
    return out;
};

/**
 * Scales the mat2 by the dimensions in the given vec2
 *
 * @param {mat2} out the receiving matrix
 * @param {mat2} a the matrix to rotate
 * @param {vec2} v the vec2 to scale the matrix by
 * @returns {mat2} out
 **/
mat2.scale = function(out, a, v) {
    var a0 = a[0], a1 = a[1], a2 = a[2], a3 = a[3],
        v0 = v[0], v1 = v[1];
    out[0] = a0 * v0;
    out[1] = a1 * v0;
    out[2] = a2 * v1;
    out[3] = a3 * v1;
    return out;
};

/**
 * Creates a matrix from a given angle
 * This is equivalent to (but much faster than):
 *
 *     mat2.identity(dest);
 *     mat2.rotate(dest, dest, rad);
 *
 * @param {mat2} out mat2 receiving operation result
 * @param {Number} rad the angle to rotate the matrix by
 * @returns {mat2} out
 */
mat2.fromRotation = function(out, rad) {
    var s = Math.sin(rad),
        c = Math.cos(rad);
    out[0] = c;
    out[1] = s;
    out[2] = -s;
    out[3] = c;
    return out;
}

/**
 * Creates a matrix from a vector scaling
 * This is equivalent to (but much faster than):
 *
 *     mat2.identity(dest);
 *     mat2.scale(dest, dest, vec);
 *
 * @param {mat2} out mat2 receiving operation result
 * @param {vec2} v Scaling vector
 * @returns {mat2} out
 */
mat2.fromScaling = function(out, v) {
    out[0] = v[0];
    out[1] = 0;
    out[2] = 0;
    out[3] = v[1];
    return out;
}

/**
 * Returns a string representation of a mat2
 *
 * @param {mat2} mat matrix to represent as a string
 * @returns {String} string representation of the matrix
 */
mat2.str = function (a) {
    return 'mat2(' + a[0] + ', ' + a[1] + ', ' + a[2] + ', ' + a[3] + ')';
};

/**
 * Returns Frobenius norm of a mat2
 *
 * @param {mat2} a the matrix to calculate Frobenius norm of
 * @returns {Number} Frobenius norm
 */
mat2.frob = function (a) {
    return(Math.sqrt(Math.pow(a[0], 2) + Math.pow(a[1], 2) + Math.pow(a[2], 2) + Math.pow(a[3], 2)))
};

/**
 * Returns L, D and U matrices (Lower triangular, Diagonal and Upper triangular) by factorizing the input matrix
 * @param {mat2} L the lower triangular matrix 
 * @param {mat2} D the diagonal matrix 
 * @param {mat2} U the upper triangular matrix 
 * @param {mat2} a the input matrix to factorize
 */

mat2.LDU = function (L, D, U, a) { 
    L[2] = a[2]/a[0]; 
    U[0] = a[0]; 
    U[1] = a[1]; 
    U[3] = a[3] - L[2] * U[1]; 
    return [L, D, U];       
}; 

/**
 * Adds two mat2's
 *
 * @param {mat2} out the receiving matrix
 * @param {mat2} a the first operand
 * @param {mat2} b the second operand
 * @returns {mat2} out
 */
mat2.add = function(out, a, b) {
    out[0] = a[0] + b[0];
    out[1] = a[1] + b[1];
    out[2] = a[2] + b[2];
    out[3] = a[3] + b[3];
    return out;
};

/**
 * Subtracts matrix b from matrix a
 *
 * @param {mat2} out the receiving matrix
 * @param {mat2} a the first operand
 * @param {mat2} b the second operand
 * @returns {mat2} out
 */
mat2.subtract = function(out, a, b) {
    out[0] = a[0] - b[0];
    out[1] = a[1] - b[1];
    out[2] = a[2] - b[2];
    out[3] = a[3] - b[3];
    return out;
};

/**
 * Alias for {@link mat2.subtract}
 * @function
 */
mat2.sub = mat2.subtract;

/**
 * Returns whether or not the matrices have exactly the same elements in the same position (when compared with ===)
 *
 * @param {mat2} a The first matrix.
 * @param {mat2} b The second matrix.
 * @returns {Boolean} True if the matrices are equal, false otherwise.
 */
mat2.exactEquals = function (a, b) {
    return a[0] === b[0] && a[1] === b[1] && a[2] === b[2] && a[3] === b[3];
};

/**
 * Returns whether or not the matrices have approximately the same elements in the same position.
 *
 * @param {mat2} a The first matrix.
 * @param {mat2} b The second matrix.
 * @returns {Boolean} True if the matrices are equal, false otherwise.
 */
mat2.equals = function (a, b) {
    var a0 = a[0], a1 = a[1], a2 = a[2], a3 = a[3];
    var b0 = b[0], b1 = b[1], b2 = b[2], b3 = b[3];
    return (Math.abs(a0 - b0) <= glMatrix.EPSILON*Math.max(1.0, Math.abs(a0), Math.abs(b0)) &&
            Math.abs(a1 - b1) <= glMatrix.EPSILON*Math.max(1.0, Math.abs(a1), Math.abs(b1)) &&
            Math.abs(a2 - b2) <= glMatrix.EPSILON*Math.max(1.0, Math.abs(a2), Math.abs(b2)) &&
            Math.abs(a3 - b3) <= glMatrix.EPSILON*Math.max(1.0, Math.abs(a3), Math.abs(b3)));
};

/**
 * Multiply each element of the matrix by a scalar.
 *
 * @param {mat2} out the receiving matrix
 * @param {mat2} a the matrix to scale
 * @param {Number} b amount to scale the matrix's elements by
 * @returns {mat2} out
 */
mat2.multiplyScalar = function(out, a, b) {
    out[0] = a[0] * b;
    out[1] = a[1] * b;
    out[2] = a[2] * b;
    out[3] = a[3] * b;
    return out;
};

/**
 * Adds two mat2's after multiplying each element of the second operand by a scalar value.
 *
 * @param {mat2} out the receiving vector
 * @param {mat2} a the first operand
 * @param {mat2} b the second operand
 * @param {Number} scale the amount to scale b's elements by before adding
 * @returns {mat2} out
 */
mat2.multiplyScalarAndAdd = function(out, a, b, scale) {
    out[0] = a[0] + (b[0] * scale);
    out[1] = a[1] + (b[1] * scale);
    out[2] = a[2] + (b[2] * scale);
    out[3] = a[3] + (b[3] * scale);
    return out;
};

module.exports = mat2;

},{"./common.js":8}],10:[function(require,module,exports){
/* Copyright (c) 2015, Brandon Jones, Colin MacKenzie IV.

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE. */

var glMatrix = require("./common.js");

/**
 * @class 2x3 Matrix
 * @name mat2d
 * 
 * @description 
 * A mat2d contains six elements defined as:
 * <pre>
 * [a, c, tx,
 *  b, d, ty]
 * </pre>
 * This is a short form for the 3x3 matrix:
 * <pre>
 * [a, c, tx,
 *  b, d, ty,
 *  0, 0, 1]
 * </pre>
 * The last row is ignored so the array is shorter and operations are faster.
 */
var mat2d = {};

/**
 * Creates a new identity mat2d
 *
 * @returns {mat2d} a new 2x3 matrix
 */
mat2d.create = function() {
    var out = new glMatrix.ARRAY_TYPE(6);
    out[0] = 1;
    out[1] = 0;
    out[2] = 0;
    out[3] = 1;
    out[4] = 0;
    out[5] = 0;
    return out;
};

/**
 * Creates a new mat2d initialized with values from an existing matrix
 *
 * @param {mat2d} a matrix to clone
 * @returns {mat2d} a new 2x3 matrix
 */
mat2d.clone = function(a) {
    var out = new glMatrix.ARRAY_TYPE(6);
    out[0] = a[0];
    out[1] = a[1];
    out[2] = a[2];
    out[3] = a[3];
    out[4] = a[4];
    out[5] = a[5];
    return out;
};

/**
 * Copy the values from one mat2d to another
 *
 * @param {mat2d} out the receiving matrix
 * @param {mat2d} a the source matrix
 * @returns {mat2d} out
 */
mat2d.copy = function(out, a) {
    out[0] = a[0];
    out[1] = a[1];
    out[2] = a[2];
    out[3] = a[3];
    out[4] = a[4];
    out[5] = a[5];
    return out;
};

/**
 * Set a mat2d to the identity matrix
 *
 * @param {mat2d} out the receiving matrix
 * @returns {mat2d} out
 */
mat2d.identity = function(out) {
    out[0] = 1;
    out[1] = 0;
    out[2] = 0;
    out[3] = 1;
    out[4] = 0;
    out[5] = 0;
    return out;
};

/**
 * Create a new mat2d with the given values
 *
 * @param {Number} a Component A (index 0)
 * @param {Number} b Component B (index 1)
 * @param {Number} c Component C (index 2)
 * @param {Number} d Component D (index 3)
 * @param {Number} tx Component TX (index 4)
 * @param {Number} ty Component TY (index 5)
 * @returns {mat2d} A new mat2d
 */
mat2d.fromValues = function(a, b, c, d, tx, ty) {
    var out = new glMatrix.ARRAY_TYPE(6);
    out[0] = a;
    out[1] = b;
    out[2] = c;
    out[3] = d;
    out[4] = tx;
    out[5] = ty;
    return out;
};

/**
 * Set the components of a mat2d to the given values
 *
 * @param {mat2d} out the receiving matrix
 * @param {Number} a Component A (index 0)
 * @param {Number} b Component B (index 1)
 * @param {Number} c Component C (index 2)
 * @param {Number} d Component D (index 3)
 * @param {Number} tx Component TX (index 4)
 * @param {Number} ty Component TY (index 5)
 * @returns {mat2d} out
 */
mat2d.set = function(out, a, b, c, d, tx, ty) {
    out[0] = a;
    out[1] = b;
    out[2] = c;
    out[3] = d;
    out[4] = tx;
    out[5] = ty;
    return out;
};

/**
 * Inverts a mat2d
 *
 * @param {mat2d} out the receiving matrix
 * @param {mat2d} a the source matrix
 * @returns {mat2d} out
 */
mat2d.invert = function(out, a) {
    var aa = a[0], ab = a[1], ac = a[2], ad = a[3],
        atx = a[4], aty = a[5];

    var det = aa * ad - ab * ac;
    if(!det){
        return null;
    }
    det = 1.0 / det;

    out[0] = ad * det;
    out[1] = -ab * det;
    out[2] = -ac * det;
    out[3] = aa * det;
    out[4] = (ac * aty - ad * atx) * det;
    out[5] = (ab * atx - aa * aty) * det;
    return out;
};

/**
 * Calculates the determinant of a mat2d
 *
 * @param {mat2d} a the source matrix
 * @returns {Number} determinant of a
 */
mat2d.determinant = function (a) {
    return a[0] * a[3] - a[1] * a[2];
};

/**
 * Multiplies two mat2d's
 *
 * @param {mat2d} out the receiving matrix
 * @param {mat2d} a the first operand
 * @param {mat2d} b the second operand
 * @returns {mat2d} out
 */
mat2d.multiply = function (out, a, b) {
    var a0 = a[0], a1 = a[1], a2 = a[2], a3 = a[3], a4 = a[4], a5 = a[5],
        b0 = b[0], b1 = b[1], b2 = b[2], b3 = b[3], b4 = b[4], b5 = b[5];
    out[0] = a0 * b0 + a2 * b1;
    out[1] = a1 * b0 + a3 * b1;
    out[2] = a0 * b2 + a2 * b3;
    out[3] = a1 * b2 + a3 * b3;
    out[4] = a0 * b4 + a2 * b5 + a4;
    out[5] = a1 * b4 + a3 * b5 + a5;
    return out;
};

/**
 * Alias for {@link mat2d.multiply}
 * @function
 */
mat2d.mul = mat2d.multiply;

/**
 * Rotates a mat2d by the given angle
 *
 * @param {mat2d} out the receiving matrix
 * @param {mat2d} a the matrix to rotate
 * @param {Number} rad the angle to rotate the matrix by
 * @returns {mat2d} out
 */
mat2d.rotate = function (out, a, rad) {
    var a0 = a[0], a1 = a[1], a2 = a[2], a3 = a[3], a4 = a[4], a5 = a[5],
        s = Math.sin(rad),
        c = Math.cos(rad);
    out[0] = a0 *  c + a2 * s;
    out[1] = a1 *  c + a3 * s;
    out[2] = a0 * -s + a2 * c;
    out[3] = a1 * -s + a3 * c;
    out[4] = a4;
    out[5] = a5;
    return out;
};

/**
 * Scales the mat2d by the dimensions in the given vec2
 *
 * @param {mat2d} out the receiving matrix
 * @param {mat2d} a the matrix to translate
 * @param {vec2} v the vec2 to scale the matrix by
 * @returns {mat2d} out
 **/
mat2d.scale = function(out, a, v) {
    var a0 = a[0], a1 = a[1], a2 = a[2], a3 = a[3], a4 = a[4], a5 = a[5],
        v0 = v[0], v1 = v[1];
    out[0] = a0 * v0;
    out[1] = a1 * v0;
    out[2] = a2 * v1;
    out[3] = a3 * v1;
    out[4] = a4;
    out[5] = a5;
    return out;
};

/**
 * Translates the mat2d by the dimensions in the given vec2
 *
 * @param {mat2d} out the receiving matrix
 * @param {mat2d} a the matrix to translate
 * @param {vec2} v the vec2 to translate the matrix by
 * @returns {mat2d} out
 **/
mat2d.translate = function(out, a, v) {
    var a0 = a[0], a1 = a[1], a2 = a[2], a3 = a[3], a4 = a[4], a5 = a[5],
        v0 = v[0], v1 = v[1];
    out[0] = a0;
    out[1] = a1;
    out[2] = a2;
    out[3] = a3;
    out[4] = a0 * v0 + a2 * v1 + a4;
    out[5] = a1 * v0 + a3 * v1 + a5;
    return out;
};

/**
 * Creates a matrix from a given angle
 * This is equivalent to (but much faster than):
 *
 *     mat2d.identity(dest);
 *     mat2d.rotate(dest, dest, rad);
 *
 * @param {mat2d} out mat2d receiving operation result
 * @param {Number} rad the angle to rotate the matrix by
 * @returns {mat2d} out
 */
mat2d.fromRotation = function(out, rad) {
    var s = Math.sin(rad), c = Math.cos(rad);
    out[0] = c;
    out[1] = s;
    out[2] = -s;
    out[3] = c;
    out[4] = 0;
    out[5] = 0;
    return out;
}

/**
 * Creates a matrix from a vector scaling
 * This is equivalent to (but much faster than):
 *
 *     mat2d.identity(dest);
 *     mat2d.scale(dest, dest, vec);
 *
 * @param {mat2d} out mat2d receiving operation result
 * @param {vec2} v Scaling vector
 * @returns {mat2d} out
 */
mat2d.fromScaling = function(out, v) {
    out[0] = v[0];
    out[1] = 0;
    out[2] = 0;
    out[3] = v[1];
    out[4] = 0;
    out[5] = 0;
    return out;
}

/**
 * Creates a matrix from a vector translation
 * This is equivalent to (but much faster than):
 *
 *     mat2d.identity(dest);
 *     mat2d.translate(dest, dest, vec);
 *
 * @param {mat2d} out mat2d receiving operation result
 * @param {vec2} v Translation vector
 * @returns {mat2d} out
 */
mat2d.fromTranslation = function(out, v) {
    out[0] = 1;
    out[1] = 0;
    out[2] = 0;
    out[3] = 1;
    out[4] = v[0];
    out[5] = v[1];
    return out;
}

/**
 * Returns a string representation of a mat2d
 *
 * @param {mat2d} a matrix to represent as a string
 * @returns {String} string representation of the matrix
 */
mat2d.str = function (a) {
    return 'mat2d(' + a[0] + ', ' + a[1] + ', ' + a[2] + ', ' + 
                    a[3] + ', ' + a[4] + ', ' + a[5] + ')';
};

/**
 * Returns Frobenius norm of a mat2d
 *
 * @param {mat2d} a the matrix to calculate Frobenius norm of
 * @returns {Number} Frobenius norm
 */
mat2d.frob = function (a) { 
    return(Math.sqrt(Math.pow(a[0], 2) + Math.pow(a[1], 2) + Math.pow(a[2], 2) + Math.pow(a[3], 2) + Math.pow(a[4], 2) + Math.pow(a[5], 2) + 1))
}; 

/**
 * Adds two mat2d's
 *
 * @param {mat2d} out the receiving matrix
 * @param {mat2d} a the first operand
 * @param {mat2d} b the second operand
 * @returns {mat2d} out
 */
mat2d.add = function(out, a, b) {
    out[0] = a[0] + b[0];
    out[1] = a[1] + b[1];
    out[2] = a[2] + b[2];
    out[3] = a[3] + b[3];
    out[4] = a[4] + b[4];
    out[5] = a[5] + b[5];
    return out;
};

/**
 * Subtracts matrix b from matrix a
 *
 * @param {mat2d} out the receiving matrix
 * @param {mat2d} a the first operand
 * @param {mat2d} b the second operand
 * @returns {mat2d} out
 */
mat2d.subtract = function(out, a, b) {
    out[0] = a[0] - b[0];
    out[1] = a[1] - b[1];
    out[2] = a[2] - b[2];
    out[3] = a[3] - b[3];
    out[4] = a[4] - b[4];
    out[5] = a[5] - b[5];
    return out;
};

/**
 * Alias for {@link mat2d.subtract}
 * @function
 */
mat2d.sub = mat2d.subtract;

/**
 * Multiply each element of the matrix by a scalar.
 *
 * @param {mat2d} out the receiving matrix
 * @param {mat2d} a the matrix to scale
 * @param {Number} b amount to scale the matrix's elements by
 * @returns {mat2d} out
 */
mat2d.multiplyScalar = function(out, a, b) {
    out[0] = a[0] * b;
    out[1] = a[1] * b;
    out[2] = a[2] * b;
    out[3] = a[3] * b;
    out[4] = a[4] * b;
    out[5] = a[5] * b;
    return out;
};

/**
 * Adds two mat2d's after multiplying each element of the second operand by a scalar value.
 *
 * @param {mat2d} out the receiving vector
 * @param {mat2d} a the first operand
 * @param {mat2d} b the second operand
 * @param {Number} scale the amount to scale b's elements by before adding
 * @returns {mat2d} out
 */
mat2d.multiplyScalarAndAdd = function(out, a, b, scale) {
    out[0] = a[0] + (b[0] * scale);
    out[1] = a[1] + (b[1] * scale);
    out[2] = a[2] + (b[2] * scale);
    out[3] = a[3] + (b[3] * scale);
    out[4] = a[4] + (b[4] * scale);
    out[5] = a[5] + (b[5] * scale);
    return out;
};

/**
 * Returns whether or not the matrices have exactly the same elements in the same position (when compared with ===)
 *
 * @param {mat2d} a The first matrix.
 * @param {mat2d} b The second matrix.
 * @returns {Boolean} True if the matrices are equal, false otherwise.
 */
mat2d.exactEquals = function (a, b) {
    return a[0] === b[0] && a[1] === b[1] && a[2] === b[2] && a[3] === b[3] && a[4] === b[4] && a[5] === b[5];
};

/**
 * Returns whether or not the matrices have approximately the same elements in the same position.
 *
 * @param {mat2d} a The first matrix.
 * @param {mat2d} b The second matrix.
 * @returns {Boolean} True if the matrices are equal, false otherwise.
 */
mat2d.equals = function (a, b) {
    var a0 = a[0], a1 = a[1], a2 = a[2], a3 = a[3], a4 = a[4], a5 = a[5];
    var b0 = b[0], b1 = b[1], b2 = b[2], b3 = b[3], b4 = b[4], b5 = b[5];
    return (Math.abs(a0 - b0) <= glMatrix.EPSILON*Math.max(1.0, Math.abs(a0), Math.abs(b0)) &&
            Math.abs(a1 - b1) <= glMatrix.EPSILON*Math.max(1.0, Math.abs(a1), Math.abs(b1)) &&
            Math.abs(a2 - b2) <= glMatrix.EPSILON*Math.max(1.0, Math.abs(a2), Math.abs(b2)) &&
            Math.abs(a3 - b3) <= glMatrix.EPSILON*Math.max(1.0, Math.abs(a3), Math.abs(b3)) &&
            Math.abs(a4 - b4) <= glMatrix.EPSILON*Math.max(1.0, Math.abs(a4), Math.abs(b4)) &&
            Math.abs(a5 - b5) <= glMatrix.EPSILON*Math.max(1.0, Math.abs(a5), Math.abs(b5)));
};

module.exports = mat2d;

},{"./common.js":8}],11:[function(require,module,exports){
/* Copyright (c) 2015, Brandon Jones, Colin MacKenzie IV.

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE. */

var glMatrix = require("./common.js");

/**
 * @class 3x3 Matrix
 * @name mat3
 */
var mat3 = {};

/**
 * Creates a new identity mat3
 *
 * @returns {mat3} a new 3x3 matrix
 */
mat3.create = function() {
    var out = new glMatrix.ARRAY_TYPE(9);
    out[0] = 1;
    out[1] = 0;
    out[2] = 0;
    out[3] = 0;
    out[4] = 1;
    out[5] = 0;
    out[6] = 0;
    out[7] = 0;
    out[8] = 1;
    return out;
};

/**
 * Copies the upper-left 3x3 values into the given mat3.
 *
 * @param {mat3} out the receiving 3x3 matrix
 * @param {mat4} a   the source 4x4 matrix
 * @returns {mat3} out
 */
mat3.fromMat4 = function(out, a) {
    out[0] = a[0];
    out[1] = a[1];
    out[2] = a[2];
    out[3] = a[4];
    out[4] = a[5];
    out[5] = a[6];
    out[6] = a[8];
    out[7] = a[9];
    out[8] = a[10];
    return out;
};

/**
 * Creates a new mat3 initialized with values from an existing matrix
 *
 * @param {mat3} a matrix to clone
 * @returns {mat3} a new 3x3 matrix
 */
mat3.clone = function(a) {
    var out = new glMatrix.ARRAY_TYPE(9);
    out[0] = a[0];
    out[1] = a[1];
    out[2] = a[2];
    out[3] = a[3];
    out[4] = a[4];
    out[5] = a[5];
    out[6] = a[6];
    out[7] = a[7];
    out[8] = a[8];
    return out;
};

/**
 * Copy the values from one mat3 to another
 *
 * @param {mat3} out the receiving matrix
 * @param {mat3} a the source matrix
 * @returns {mat3} out
 */
mat3.copy = function(out, a) {
    out[0] = a[0];
    out[1] = a[1];
    out[2] = a[2];
    out[3] = a[3];
    out[4] = a[4];
    out[5] = a[5];
    out[6] = a[6];
    out[7] = a[7];
    out[8] = a[8];
    return out;
};

/**
 * Create a new mat3 with the given values
 *
 * @param {Number} m00 Component in column 0, row 0 position (index 0)
 * @param {Number} m01 Component in column 0, row 1 position (index 1)
 * @param {Number} m02 Component in column 0, row 2 position (index 2)
 * @param {Number} m10 Component in column 1, row 0 position (index 3)
 * @param {Number} m11 Component in column 1, row 1 position (index 4)
 * @param {Number} m12 Component in column 1, row 2 position (index 5)
 * @param {Number} m20 Component in column 2, row 0 position (index 6)
 * @param {Number} m21 Component in column 2, row 1 position (index 7)
 * @param {Number} m22 Component in column 2, row 2 position (index 8)
 * @returns {mat3} A new mat3
 */
mat3.fromValues = function(m00, m01, m02, m10, m11, m12, m20, m21, m22) {
    var out = new glMatrix.ARRAY_TYPE(9);
    out[0] = m00;
    out[1] = m01;
    out[2] = m02;
    out[3] = m10;
    out[4] = m11;
    out[5] = m12;
    out[6] = m20;
    out[7] = m21;
    out[8] = m22;
    return out;
};

/**
 * Set the components of a mat3 to the given values
 *
 * @param {mat3} out the receiving matrix
 * @param {Number} m00 Component in column 0, row 0 position (index 0)
 * @param {Number} m01 Component in column 0, row 1 position (index 1)
 * @param {Number} m02 Component in column 0, row 2 position (index 2)
 * @param {Number} m10 Component in column 1, row 0 position (index 3)
 * @param {Number} m11 Component in column 1, row 1 position (index 4)
 * @param {Number} m12 Component in column 1, row 2 position (index 5)
 * @param {Number} m20 Component in column 2, row 0 position (index 6)
 * @param {Number} m21 Component in column 2, row 1 position (index 7)
 * @param {Number} m22 Component in column 2, row 2 position (index 8)
 * @returns {mat3} out
 */
mat3.set = function(out, m00, m01, m02, m10, m11, m12, m20, m21, m22) {
    out[0] = m00;
    out[1] = m01;
    out[2] = m02;
    out[3] = m10;
    out[4] = m11;
    out[5] = m12;
    out[6] = m20;
    out[7] = m21;
    out[8] = m22;
    return out;
};

/**
 * Set a mat3 to the identity matrix
 *
 * @param {mat3} out the receiving matrix
 * @returns {mat3} out
 */
mat3.identity = function(out) {
    out[0] = 1;
    out[1] = 0;
    out[2] = 0;
    out[3] = 0;
    out[4] = 1;
    out[5] = 0;
    out[6] = 0;
    out[7] = 0;
    out[8] = 1;
    return out;
};

/**
 * Transpose the values of a mat3
 *
 * @param {mat3} out the receiving matrix
 * @param {mat3} a the source matrix
 * @returns {mat3} out
 */
mat3.transpose = function(out, a) {
    // If we are transposing ourselves we can skip a few steps but have to cache some values
    if (out === a) {
        var a01 = a[1], a02 = a[2], a12 = a[5];
        out[1] = a[3];
        out[2] = a[6];
        out[3] = a01;
        out[5] = a[7];
        out[6] = a02;
        out[7] = a12;
    } else {
        out[0] = a[0];
        out[1] = a[3];
        out[2] = a[6];
        out[3] = a[1];
        out[4] = a[4];
        out[5] = a[7];
        out[6] = a[2];
        out[7] = a[5];
        out[8] = a[8];
    }
    
    return out;
};

/**
 * Inverts a mat3
 *
 * @param {mat3} out the receiving matrix
 * @param {mat3} a the source matrix
 * @returns {mat3} out
 */
mat3.invert = function(out, a) {
    var a00 = a[0], a01 = a[1], a02 = a[2],
        a10 = a[3], a11 = a[4], a12 = a[5],
        a20 = a[6], a21 = a[7], a22 = a[8],

        b01 = a22 * a11 - a12 * a21,
        b11 = -a22 * a10 + a12 * a20,
        b21 = a21 * a10 - a11 * a20,

        // Calculate the determinant
        det = a00 * b01 + a01 * b11 + a02 * b21;

    if (!det) { 
        return null; 
    }
    det = 1.0 / det;

    out[0] = b01 * det;
    out[1] = (-a22 * a01 + a02 * a21) * det;
    out[2] = (a12 * a01 - a02 * a11) * det;
    out[3] = b11 * det;
    out[4] = (a22 * a00 - a02 * a20) * det;
    out[5] = (-a12 * a00 + a02 * a10) * det;
    out[6] = b21 * det;
    out[7] = (-a21 * a00 + a01 * a20) * det;
    out[8] = (a11 * a00 - a01 * a10) * det;
    return out;
};

/**
 * Calculates the adjugate of a mat3
 *
 * @param {mat3} out the receiving matrix
 * @param {mat3} a the source matrix
 * @returns {mat3} out
 */
mat3.adjoint = function(out, a) {
    var a00 = a[0], a01 = a[1], a02 = a[2],
        a10 = a[3], a11 = a[4], a12 = a[5],
        a20 = a[6], a21 = a[7], a22 = a[8];

    out[0] = (a11 * a22 - a12 * a21);
    out[1] = (a02 * a21 - a01 * a22);
    out[2] = (a01 * a12 - a02 * a11);
    out[3] = (a12 * a20 - a10 * a22);
    out[4] = (a00 * a22 - a02 * a20);
    out[5] = (a02 * a10 - a00 * a12);
    out[6] = (a10 * a21 - a11 * a20);
    out[7] = (a01 * a20 - a00 * a21);
    out[8] = (a00 * a11 - a01 * a10);
    return out;
};

/**
 * Calculates the determinant of a mat3
 *
 * @param {mat3} a the source matrix
 * @returns {Number} determinant of a
 */
mat3.determinant = function (a) {
    var a00 = a[0], a01 = a[1], a02 = a[2],
        a10 = a[3], a11 = a[4], a12 = a[5],
        a20 = a[6], a21 = a[7], a22 = a[8];

    return a00 * (a22 * a11 - a12 * a21) + a01 * (-a22 * a10 + a12 * a20) + a02 * (a21 * a10 - a11 * a20);
};

/**
 * Multiplies two mat3's
 *
 * @param {mat3} out the receiving matrix
 * @param {mat3} a the first operand
 * @param {mat3} b the second operand
 * @returns {mat3} out
 */
mat3.multiply = function (out, a, b) {
    var a00 = a[0], a01 = a[1], a02 = a[2],
        a10 = a[3], a11 = a[4], a12 = a[5],
        a20 = a[6], a21 = a[7], a22 = a[8],

        b00 = b[0], b01 = b[1], b02 = b[2],
        b10 = b[3], b11 = b[4], b12 = b[5],
        b20 = b[6], b21 = b[7], b22 = b[8];

    out[0] = b00 * a00 + b01 * a10 + b02 * a20;
    out[1] = b00 * a01 + b01 * a11 + b02 * a21;
    out[2] = b00 * a02 + b01 * a12 + b02 * a22;

    out[3] = b10 * a00 + b11 * a10 + b12 * a20;
    out[4] = b10 * a01 + b11 * a11 + b12 * a21;
    out[5] = b10 * a02 + b11 * a12 + b12 * a22;

    out[6] = b20 * a00 + b21 * a10 + b22 * a20;
    out[7] = b20 * a01 + b21 * a11 + b22 * a21;
    out[8] = b20 * a02 + b21 * a12 + b22 * a22;
    return out;
};

/**
 * Alias for {@link mat3.multiply}
 * @function
 */
mat3.mul = mat3.multiply;

/**
 * Translate a mat3 by the given vector
 *
 * @param {mat3} out the receiving matrix
 * @param {mat3} a the matrix to translate
 * @param {vec2} v vector to translate by
 * @returns {mat3} out
 */
mat3.translate = function(out, a, v) {
    var a00 = a[0], a01 = a[1], a02 = a[2],
        a10 = a[3], a11 = a[4], a12 = a[5],
        a20 = a[6], a21 = a[7], a22 = a[8],
        x = v[0], y = v[1];

    out[0] = a00;
    out[1] = a01;
    out[2] = a02;

    out[3] = a10;
    out[4] = a11;
    out[5] = a12;

    out[6] = x * a00 + y * a10 + a20;
    out[7] = x * a01 + y * a11 + a21;
    out[8] = x * a02 + y * a12 + a22;
    return out;
};

/**
 * Rotates a mat3 by the given angle
 *
 * @param {mat3} out the receiving matrix
 * @param {mat3} a the matrix to rotate
 * @param {Number} rad the angle to rotate the matrix by
 * @returns {mat3} out
 */
mat3.rotate = function (out, a, rad) {
    var a00 = a[0], a01 = a[1], a02 = a[2],
        a10 = a[3], a11 = a[4], a12 = a[5],
        a20 = a[6], a21 = a[7], a22 = a[8],

        s = Math.sin(rad),
        c = Math.cos(rad);

    out[0] = c * a00 + s * a10;
    out[1] = c * a01 + s * a11;
    out[2] = c * a02 + s * a12;

    out[3] = c * a10 - s * a00;
    out[4] = c * a11 - s * a01;
    out[5] = c * a12 - s * a02;

    out[6] = a20;
    out[7] = a21;
    out[8] = a22;
    return out;
};

/**
 * Scales the mat3 by the dimensions in the given vec2
 *
 * @param {mat3} out the receiving matrix
 * @param {mat3} a the matrix to rotate
 * @param {vec2} v the vec2 to scale the matrix by
 * @returns {mat3} out
 **/
mat3.scale = function(out, a, v) {
    var x = v[0], y = v[1];

    out[0] = x * a[0];
    out[1] = x * a[1];
    out[2] = x * a[2];

    out[3] = y * a[3];
    out[4] = y * a[4];
    out[5] = y * a[5];

    out[6] = a[6];
    out[7] = a[7];
    out[8] = a[8];
    return out;
};

/**
 * Creates a matrix from a vector translation
 * This is equivalent to (but much faster than):
 *
 *     mat3.identity(dest);
 *     mat3.translate(dest, dest, vec);
 *
 * @param {mat3} out mat3 receiving operation result
 * @param {vec2} v Translation vector
 * @returns {mat3} out
 */
mat3.fromTranslation = function(out, v) {
    out[0] = 1;
    out[1] = 0;
    out[2] = 0;
    out[3] = 0;
    out[4] = 1;
    out[5] = 0;
    out[6] = v[0];
    out[7] = v[1];
    out[8] = 1;
    return out;
}

/**
 * Creates a matrix from a given angle
 * This is equivalent to (but much faster than):
 *
 *     mat3.identity(dest);
 *     mat3.rotate(dest, dest, rad);
 *
 * @param {mat3} out mat3 receiving operation result
 * @param {Number} rad the angle to rotate the matrix by
 * @returns {mat3} out
 */
mat3.fromRotation = function(out, rad) {
    var s = Math.sin(rad), c = Math.cos(rad);

    out[0] = c;
    out[1] = s;
    out[2] = 0;

    out[3] = -s;
    out[4] = c;
    out[5] = 0;

    out[6] = 0;
    out[7] = 0;
    out[8] = 1;
    return out;
}

/**
 * Creates a matrix from a vector scaling
 * This is equivalent to (but much faster than):
 *
 *     mat3.identity(dest);
 *     mat3.scale(dest, dest, vec);
 *
 * @param {mat3} out mat3 receiving operation result
 * @param {vec2} v Scaling vector
 * @returns {mat3} out
 */
mat3.fromScaling = function(out, v) {
    out[0] = v[0];
    out[1] = 0;
    out[2] = 0;

    out[3] = 0;
    out[4] = v[1];
    out[5] = 0;

    out[6] = 0;
    out[7] = 0;
    out[8] = 1;
    return out;
}

/**
 * Copies the values from a mat2d into a mat3
 *
 * @param {mat3} out the receiving matrix
 * @param {mat2d} a the matrix to copy
 * @returns {mat3} out
 **/
mat3.fromMat2d = function(out, a) {
    out[0] = a[0];
    out[1] = a[1];
    out[2] = 0;

    out[3] = a[2];
    out[4] = a[3];
    out[5] = 0;

    out[6] = a[4];
    out[7] = a[5];
    out[8] = 1;
    return out;
};

/**
* Calculates a 3x3 matrix from the given quaternion
*
* @param {mat3} out mat3 receiving operation result
* @param {quat} q Quaternion to create matrix from
*
* @returns {mat3} out
*/
mat3.fromQuat = function (out, q) {
    var x = q[0], y = q[1], z = q[2], w = q[3],
        x2 = x + x,
        y2 = y + y,
        z2 = z + z,

        xx = x * x2,
        yx = y * x2,
        yy = y * y2,
        zx = z * x2,
        zy = z * y2,
        zz = z * z2,
        wx = w * x2,
        wy = w * y2,
        wz = w * z2;

    out[0] = 1 - yy - zz;
    out[3] = yx - wz;
    out[6] = zx + wy;

    out[1] = yx + wz;
    out[4] = 1 - xx - zz;
    out[7] = zy - wx;

    out[2] = zx - wy;
    out[5] = zy + wx;
    out[8] = 1 - xx - yy;

    return out;
};

/**
* Calculates a 3x3 normal matrix (transpose inverse) from the 4x4 matrix
*
* @param {mat3} out mat3 receiving operation result
* @param {mat4} a Mat4 to derive the normal matrix from
*
* @returns {mat3} out
*/
mat3.normalFromMat4 = function (out, a) {
    var a00 = a[0], a01 = a[1], a02 = a[2], a03 = a[3],
        a10 = a[4], a11 = a[5], a12 = a[6], a13 = a[7],
        a20 = a[8], a21 = a[9], a22 = a[10], a23 = a[11],
        a30 = a[12], a31 = a[13], a32 = a[14], a33 = a[15],

        b00 = a00 * a11 - a01 * a10,
        b01 = a00 * a12 - a02 * a10,
        b02 = a00 * a13 - a03 * a10,
        b03 = a01 * a12 - a02 * a11,
        b04 = a01 * a13 - a03 * a11,
        b05 = a02 * a13 - a03 * a12,
        b06 = a20 * a31 - a21 * a30,
        b07 = a20 * a32 - a22 * a30,
        b08 = a20 * a33 - a23 * a30,
        b09 = a21 * a32 - a22 * a31,
        b10 = a21 * a33 - a23 * a31,
        b11 = a22 * a33 - a23 * a32,

        // Calculate the determinant
        det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;

    if (!det) { 
        return null; 
    }
    det = 1.0 / det;

    out[0] = (a11 * b11 - a12 * b10 + a13 * b09) * det;
    out[1] = (a12 * b08 - a10 * b11 - a13 * b07) * det;
    out[2] = (a10 * b10 - a11 * b08 + a13 * b06) * det;

    out[3] = (a02 * b10 - a01 * b11 - a03 * b09) * det;
    out[4] = (a00 * b11 - a02 * b08 + a03 * b07) * det;
    out[5] = (a01 * b08 - a00 * b10 - a03 * b06) * det;

    out[6] = (a31 * b05 - a32 * b04 + a33 * b03) * det;
    out[7] = (a32 * b02 - a30 * b05 - a33 * b01) * det;
    out[8] = (a30 * b04 - a31 * b02 + a33 * b00) * det;

    return out;
};

/**
 * Returns a string representation of a mat3
 *
 * @param {mat3} mat matrix to represent as a string
 * @returns {String} string representation of the matrix
 */
mat3.str = function (a) {
    return 'mat3(' + a[0] + ', ' + a[1] + ', ' + a[2] + ', ' + 
                    a[3] + ', ' + a[4] + ', ' + a[5] + ', ' + 
                    a[6] + ', ' + a[7] + ', ' + a[8] + ')';
};

/**
 * Returns Frobenius norm of a mat3
 *
 * @param {mat3} a the matrix to calculate Frobenius norm of
 * @returns {Number} Frobenius norm
 */
mat3.frob = function (a) {
    return(Math.sqrt(Math.pow(a[0], 2) + Math.pow(a[1], 2) + Math.pow(a[2], 2) + Math.pow(a[3], 2) + Math.pow(a[4], 2) + Math.pow(a[5], 2) + Math.pow(a[6], 2) + Math.pow(a[7], 2) + Math.pow(a[8], 2)))
};

/**
 * Adds two mat3's
 *
 * @param {mat3} out the receiving matrix
 * @param {mat3} a the first operand
 * @param {mat3} b the second operand
 * @returns {mat3} out
 */
mat3.add = function(out, a, b) {
    out[0] = a[0] + b[0];
    out[1] = a[1] + b[1];
    out[2] = a[2] + b[2];
    out[3] = a[3] + b[3];
    out[4] = a[4] + b[4];
    out[5] = a[5] + b[5];
    out[6] = a[6] + b[6];
    out[7] = a[7] + b[7];
    out[8] = a[8] + b[8];
    return out;
};

/**
 * Subtracts matrix b from matrix a
 *
 * @param {mat3} out the receiving matrix
 * @param {mat3} a the first operand
 * @param {mat3} b the second operand
 * @returns {mat3} out
 */
mat3.subtract = function(out, a, b) {
    out[0] = a[0] - b[0];
    out[1] = a[1] - b[1];
    out[2] = a[2] - b[2];
    out[3] = a[3] - b[3];
    out[4] = a[4] - b[4];
    out[5] = a[5] - b[5];
    out[6] = a[6] - b[6];
    out[7] = a[7] - b[7];
    out[8] = a[8] - b[8];
    return out;
};

/**
 * Alias for {@link mat3.subtract}
 * @function
 */
mat3.sub = mat3.subtract;

/**
 * Multiply each element of the matrix by a scalar.
 *
 * @param {mat3} out the receiving matrix
 * @param {mat3} a the matrix to scale
 * @param {Number} b amount to scale the matrix's elements by
 * @returns {mat3} out
 */
mat3.multiplyScalar = function(out, a, b) {
    out[0] = a[0] * b;
    out[1] = a[1] * b;
    out[2] = a[2] * b;
    out[3] = a[3] * b;
    out[4] = a[4] * b;
    out[5] = a[5] * b;
    out[6] = a[6] * b;
    out[7] = a[7] * b;
    out[8] = a[8] * b;
    return out;
};

/**
 * Adds two mat3's after multiplying each element of the second operand by a scalar value.
 *
 * @param {mat3} out the receiving vector
 * @param {mat3} a the first operand
 * @param {mat3} b the second operand
 * @param {Number} scale the amount to scale b's elements by before adding
 * @returns {mat3} out
 */
mat3.multiplyScalarAndAdd = function(out, a, b, scale) {
    out[0] = a[0] + (b[0] * scale);
    out[1] = a[1] + (b[1] * scale);
    out[2] = a[2] + (b[2] * scale);
    out[3] = a[3] + (b[3] * scale);
    out[4] = a[4] + (b[4] * scale);
    out[5] = a[5] + (b[5] * scale);
    out[6] = a[6] + (b[6] * scale);
    out[7] = a[7] + (b[7] * scale);
    out[8] = a[8] + (b[8] * scale);
    return out;
};

/*
 * Returns whether or not the matrices have exactly the same elements in the same position (when compared with ===)
 *
 * @param {mat3} a The first matrix.
 * @param {mat3} b The second matrix.
 * @returns {Boolean} True if the matrices are equal, false otherwise.
 */
mat3.exactEquals = function (a, b) {
    return a[0] === b[0] && a[1] === b[1] && a[2] === b[2] && 
           a[3] === b[3] && a[4] === b[4] && a[5] === b[5] &&
           a[6] === b[6] && a[7] === b[7] && a[8] === b[8];
};

/**
 * Returns whether or not the matrices have approximately the same elements in the same position.
 *
 * @param {mat3} a The first matrix.
 * @param {mat3} b The second matrix.
 * @returns {Boolean} True if the matrices are equal, false otherwise.
 */
mat3.equals = function (a, b) {
    var a0 = a[0], a1 = a[1], a2 = a[2], a3 = a[3], a4 = a[4], a5 = a[5], a6 = a[6], a7 = a[7], a8 = a[8];
    var b0 = b[0], b1 = b[1], b2 = b[2], b3 = b[3], b4 = b[4], b5 = b[5], b6 = a[6], b7 = b[7], b8 = b[8];
    return (Math.abs(a0 - b0) <= glMatrix.EPSILON*Math.max(1.0, Math.abs(a0), Math.abs(b0)) &&
            Math.abs(a1 - b1) <= glMatrix.EPSILON*Math.max(1.0, Math.abs(a1), Math.abs(b1)) &&
            Math.abs(a2 - b2) <= glMatrix.EPSILON*Math.max(1.0, Math.abs(a2), Math.abs(b2)) &&
            Math.abs(a3 - b3) <= glMatrix.EPSILON*Math.max(1.0, Math.abs(a3), Math.abs(b3)) &&
            Math.abs(a4 - b4) <= glMatrix.EPSILON*Math.max(1.0, Math.abs(a4), Math.abs(b4)) &&
            Math.abs(a5 - b5) <= glMatrix.EPSILON*Math.max(1.0, Math.abs(a5), Math.abs(b5)) &&
            Math.abs(a6 - b6) <= glMatrix.EPSILON*Math.max(1.0, Math.abs(a6), Math.abs(b6)) &&
            Math.abs(a7 - b7) <= glMatrix.EPSILON*Math.max(1.0, Math.abs(a7), Math.abs(b7)) &&
            Math.abs(a8 - b8) <= glMatrix.EPSILON*Math.max(1.0, Math.abs(a8), Math.abs(b8)));
};


module.exports = mat3;

},{"./common.js":8}],12:[function(require,module,exports){
/* Copyright (c) 2015, Brandon Jones, Colin MacKenzie IV.

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE. */

var glMatrix = require("./common.js");

/**
 * @class 4x4 Matrix
 * @name mat4
 */
var mat4 = {
  scalar: {},
  SIMD: {},
};

/**
 * Creates a new identity mat4
 *
 * @returns {mat4} a new 4x4 matrix
 */
mat4.create = function() {
    var out = new glMatrix.ARRAY_TYPE(16);
    out[0] = 1;
    out[1] = 0;
    out[2] = 0;
    out[3] = 0;
    out[4] = 0;
    out[5] = 1;
    out[6] = 0;
    out[7] = 0;
    out[8] = 0;
    out[9] = 0;
    out[10] = 1;
    out[11] = 0;
    out[12] = 0;
    out[13] = 0;
    out[14] = 0;
    out[15] = 1;
    return out;
};

/**
 * Creates a new mat4 initialized with values from an existing matrix
 *
 * @param {mat4} a matrix to clone
 * @returns {mat4} a new 4x4 matrix
 */
mat4.clone = function(a) {
    var out = new glMatrix.ARRAY_TYPE(16);
    out[0] = a[0];
    out[1] = a[1];
    out[2] = a[2];
    out[3] = a[3];
    out[4] = a[4];
    out[5] = a[5];
    out[6] = a[6];
    out[7] = a[7];
    out[8] = a[8];
    out[9] = a[9];
    out[10] = a[10];
    out[11] = a[11];
    out[12] = a[12];
    out[13] = a[13];
    out[14] = a[14];
    out[15] = a[15];
    return out;
};

/**
 * Copy the values from one mat4 to another
 *
 * @param {mat4} out the receiving matrix
 * @param {mat4} a the source matrix
 * @returns {mat4} out
 */
mat4.copy = function(out, a) {
    out[0] = a[0];
    out[1] = a[1];
    out[2] = a[2];
    out[3] = a[3];
    out[4] = a[4];
    out[5] = a[5];
    out[6] = a[6];
    out[7] = a[7];
    out[8] = a[8];
    out[9] = a[9];
    out[10] = a[10];
    out[11] = a[11];
    out[12] = a[12];
    out[13] = a[13];
    out[14] = a[14];
    out[15] = a[15];
    return out;
};

/**
 * Create a new mat4 with the given values
 *
 * @param {Number} m00 Component in column 0, row 0 position (index 0)
 * @param {Number} m01 Component in column 0, row 1 position (index 1)
 * @param {Number} m02 Component in column 0, row 2 position (index 2)
 * @param {Number} m03 Component in column 0, row 3 position (index 3)
 * @param {Number} m10 Component in column 1, row 0 position (index 4)
 * @param {Number} m11 Component in column 1, row 1 position (index 5)
 * @param {Number} m12 Component in column 1, row 2 position (index 6)
 * @param {Number} m13 Component in column 1, row 3 position (index 7)
 * @param {Number} m20 Component in column 2, row 0 position (index 8)
 * @param {Number} m21 Component in column 2, row 1 position (index 9)
 * @param {Number} m22 Component in column 2, row 2 position (index 10)
 * @param {Number} m23 Component in column 2, row 3 position (index 11)
 * @param {Number} m30 Component in column 3, row 0 position (index 12)
 * @param {Number} m31 Component in column 3, row 1 position (index 13)
 * @param {Number} m32 Component in column 3, row 2 position (index 14)
 * @param {Number} m33 Component in column 3, row 3 position (index 15)
 * @returns {mat4} A new mat4
 */
mat4.fromValues = function(m00, m01, m02, m03, m10, m11, m12, m13, m20, m21, m22, m23, m30, m31, m32, m33) {
    var out = new glMatrix.ARRAY_TYPE(16);
    out[0] = m00;
    out[1] = m01;
    out[2] = m02;
    out[3] = m03;
    out[4] = m10;
    out[5] = m11;
    out[6] = m12;
    out[7] = m13;
    out[8] = m20;
    out[9] = m21;
    out[10] = m22;
    out[11] = m23;
    out[12] = m30;
    out[13] = m31;
    out[14] = m32;
    out[15] = m33;
    return out;
};

/**
 * Set the components of a mat4 to the given values
 *
 * @param {mat4} out the receiving matrix
 * @param {Number} m00 Component in column 0, row 0 position (index 0)
 * @param {Number} m01 Component in column 0, row 1 position (index 1)
 * @param {Number} m02 Component in column 0, row 2 position (index 2)
 * @param {Number} m03 Component in column 0, row 3 position (index 3)
 * @param {Number} m10 Component in column 1, row 0 position (index 4)
 * @param {Number} m11 Component in column 1, row 1 position (index 5)
 * @param {Number} m12 Component in column 1, row 2 position (index 6)
 * @param {Number} m13 Component in column 1, row 3 position (index 7)
 * @param {Number} m20 Component in column 2, row 0 position (index 8)
 * @param {Number} m21 Component in column 2, row 1 position (index 9)
 * @param {Number} m22 Component in column 2, row 2 position (index 10)
 * @param {Number} m23 Component in column 2, row 3 position (index 11)
 * @param {Number} m30 Component in column 3, row 0 position (index 12)
 * @param {Number} m31 Component in column 3, row 1 position (index 13)
 * @param {Number} m32 Component in column 3, row 2 position (index 14)
 * @param {Number} m33 Component in column 3, row 3 position (index 15)
 * @returns {mat4} out
 */
mat4.set = function(out, m00, m01, m02, m03, m10, m11, m12, m13, m20, m21, m22, m23, m30, m31, m32, m33) {
    out[0] = m00;
    out[1] = m01;
    out[2] = m02;
    out[3] = m03;
    out[4] = m10;
    out[5] = m11;
    out[6] = m12;
    out[7] = m13;
    out[8] = m20;
    out[9] = m21;
    out[10] = m22;
    out[11] = m23;
    out[12] = m30;
    out[13] = m31;
    out[14] = m32;
    out[15] = m33;
    return out;
};


/**
 * Set a mat4 to the identity matrix
 *
 * @param {mat4} out the receiving matrix
 * @returns {mat4} out
 */
mat4.identity = function(out) {
    out[0] = 1;
    out[1] = 0;
    out[2] = 0;
    out[3] = 0;
    out[4] = 0;
    out[5] = 1;
    out[6] = 0;
    out[7] = 0;
    out[8] = 0;
    out[9] = 0;
    out[10] = 1;
    out[11] = 0;
    out[12] = 0;
    out[13] = 0;
    out[14] = 0;
    out[15] = 1;
    return out;
};

/**
 * Transpose the values of a mat4 not using SIMD
 *
 * @param {mat4} out the receiving matrix
 * @param {mat4} a the source matrix
 * @returns {mat4} out
 */
mat4.scalar.transpose = function(out, a) {
    // If we are transposing ourselves we can skip a few steps but have to cache some values
    if (out === a) {
        var a01 = a[1], a02 = a[2], a03 = a[3],
            a12 = a[6], a13 = a[7],
            a23 = a[11];

        out[1] = a[4];
        out[2] = a[8];
        out[3] = a[12];
        out[4] = a01;
        out[6] = a[9];
        out[7] = a[13];
        out[8] = a02;
        out[9] = a12;
        out[11] = a[14];
        out[12] = a03;
        out[13] = a13;
        out[14] = a23;
    } else {
        out[0] = a[0];
        out[1] = a[4];
        out[2] = a[8];
        out[3] = a[12];
        out[4] = a[1];
        out[5] = a[5];
        out[6] = a[9];
        out[7] = a[13];
        out[8] = a[2];
        out[9] = a[6];
        out[10] = a[10];
        out[11] = a[14];
        out[12] = a[3];
        out[13] = a[7];
        out[14] = a[11];
        out[15] = a[15];
    }

    return out;
};

/**
 * Transpose the values of a mat4 using SIMD
 *
 * @param {mat4} out the receiving matrix
 * @param {mat4} a the source matrix
 * @returns {mat4} out
 */
mat4.SIMD.transpose = function(out, a) {
    var a0, a1, a2, a3,
        tmp01, tmp23,
        out0, out1, out2, out3;

    a0 = SIMD.Float32x4.load(a, 0);
    a1 = SIMD.Float32x4.load(a, 4);
    a2 = SIMD.Float32x4.load(a, 8);
    a3 = SIMD.Float32x4.load(a, 12);

    tmp01 = SIMD.Float32x4.shuffle(a0, a1, 0, 1, 4, 5);
    tmp23 = SIMD.Float32x4.shuffle(a2, a3, 0, 1, 4, 5);
    out0  = SIMD.Float32x4.shuffle(tmp01, tmp23, 0, 2, 4, 6);
    out1  = SIMD.Float32x4.shuffle(tmp01, tmp23, 1, 3, 5, 7);
    SIMD.Float32x4.store(out, 0,  out0);
    SIMD.Float32x4.store(out, 4,  out1);

    tmp01 = SIMD.Float32x4.shuffle(a0, a1, 2, 3, 6, 7);
    tmp23 = SIMD.Float32x4.shuffle(a2, a3, 2, 3, 6, 7);
    out2  = SIMD.Float32x4.shuffle(tmp01, tmp23, 0, 2, 4, 6);
    out3  = SIMD.Float32x4.shuffle(tmp01, tmp23, 1, 3, 5, 7);
    SIMD.Float32x4.store(out, 8,  out2);
    SIMD.Float32x4.store(out, 12, out3);

    return out;
};

/**
 * Transpse a mat4 using SIMD if available and enabled
 *
 * @param {mat4} out the receiving matrix
 * @param {mat4} a the source matrix
 * @returns {mat4} out
 */
mat4.transpose = glMatrix.USE_SIMD ? mat4.SIMD.transpose : mat4.scalar.transpose;

/**
 * Inverts a mat4 not using SIMD
 *
 * @param {mat4} out the receiving matrix
 * @param {mat4} a the source matrix
 * @returns {mat4} out
 */
mat4.scalar.invert = function(out, a) {
    var a00 = a[0], a01 = a[1], a02 = a[2], a03 = a[3],
        a10 = a[4], a11 = a[5], a12 = a[6], a13 = a[7],
        a20 = a[8], a21 = a[9], a22 = a[10], a23 = a[11],
        a30 = a[12], a31 = a[13], a32 = a[14], a33 = a[15],

        b00 = a00 * a11 - a01 * a10,
        b01 = a00 * a12 - a02 * a10,
        b02 = a00 * a13 - a03 * a10,
        b03 = a01 * a12 - a02 * a11,
        b04 = a01 * a13 - a03 * a11,
        b05 = a02 * a13 - a03 * a12,
        b06 = a20 * a31 - a21 * a30,
        b07 = a20 * a32 - a22 * a30,
        b08 = a20 * a33 - a23 * a30,
        b09 = a21 * a32 - a22 * a31,
        b10 = a21 * a33 - a23 * a31,
        b11 = a22 * a33 - a23 * a32,

        // Calculate the determinant
        det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;

    if (!det) {
        return null;
    }
    det = 1.0 / det;

    out[0] = (a11 * b11 - a12 * b10 + a13 * b09) * det;
    out[1] = (a02 * b10 - a01 * b11 - a03 * b09) * det;
    out[2] = (a31 * b05 - a32 * b04 + a33 * b03) * det;
    out[3] = (a22 * b04 - a21 * b05 - a23 * b03) * det;
    out[4] = (a12 * b08 - a10 * b11 - a13 * b07) * det;
    out[5] = (a00 * b11 - a02 * b08 + a03 * b07) * det;
    out[6] = (a32 * b02 - a30 * b05 - a33 * b01) * det;
    out[7] = (a20 * b05 - a22 * b02 + a23 * b01) * det;
    out[8] = (a10 * b10 - a11 * b08 + a13 * b06) * det;
    out[9] = (a01 * b08 - a00 * b10 - a03 * b06) * det;
    out[10] = (a30 * b04 - a31 * b02 + a33 * b00) * det;
    out[11] = (a21 * b02 - a20 * b04 - a23 * b00) * det;
    out[12] = (a11 * b07 - a10 * b09 - a12 * b06) * det;
    out[13] = (a00 * b09 - a01 * b07 + a02 * b06) * det;
    out[14] = (a31 * b01 - a30 * b03 - a32 * b00) * det;
    out[15] = (a20 * b03 - a21 * b01 + a22 * b00) * det;

    return out;
};

/**
 * Inverts a mat4 using SIMD
 *
 * @param {mat4} out the receiving matrix
 * @param {mat4} a the source matrix
 * @returns {mat4} out
 */
mat4.SIMD.invert = function(out, a) {
  var row0, row1, row2, row3,
      tmp1,
      minor0, minor1, minor2, minor3,
      det,
      a0 = SIMD.Float32x4.load(a, 0),
      a1 = SIMD.Float32x4.load(a, 4),
      a2 = SIMD.Float32x4.load(a, 8),
      a3 = SIMD.Float32x4.load(a, 12);

  // Compute matrix adjugate
  tmp1 = SIMD.Float32x4.shuffle(a0, a1, 0, 1, 4, 5);
  row1 = SIMD.Float32x4.shuffle(a2, a3, 0, 1, 4, 5);
  row0 = SIMD.Float32x4.shuffle(tmp1, row1, 0, 2, 4, 6);
  row1 = SIMD.Float32x4.shuffle(row1, tmp1, 1, 3, 5, 7);
  tmp1 = SIMD.Float32x4.shuffle(a0, a1, 2, 3, 6, 7);
  row3 = SIMD.Float32x4.shuffle(a2, a3, 2, 3, 6, 7);
  row2 = SIMD.Float32x4.shuffle(tmp1, row3, 0, 2, 4, 6);
  row3 = SIMD.Float32x4.shuffle(row3, tmp1, 1, 3, 5, 7);

  tmp1   = SIMD.Float32x4.mul(row2, row3);
  tmp1   = SIMD.Float32x4.swizzle(tmp1, 1, 0, 3, 2);
  minor0 = SIMD.Float32x4.mul(row1, tmp1);
  minor1 = SIMD.Float32x4.mul(row0, tmp1);
  tmp1   = SIMD.Float32x4.swizzle(tmp1, 2, 3, 0, 1);
  minor0 = SIMD.Float32x4.sub(SIMD.Float32x4.mul(row1, tmp1), minor0);
  minor1 = SIMD.Float32x4.sub(SIMD.Float32x4.mul(row0, tmp1), minor1);
  minor1 = SIMD.Float32x4.swizzle(minor1, 2, 3, 0, 1);

  tmp1   = SIMD.Float32x4.mul(row1, row2);
  tmp1   = SIMD.Float32x4.swizzle(tmp1, 1, 0, 3, 2);
  minor0 = SIMD.Float32x4.add(SIMD.Float32x4.mul(row3, tmp1), minor0);
  minor3 = SIMD.Float32x4.mul(row0, tmp1);
  tmp1   = SIMD.Float32x4.swizzle(tmp1, 2, 3, 0, 1);
  minor0 = SIMD.Float32x4.sub(minor0, SIMD.Float32x4.mul(row3, tmp1));
  minor3 = SIMD.Float32x4.sub(SIMD.Float32x4.mul(row0, tmp1), minor3);
  minor3 = SIMD.Float32x4.swizzle(minor3, 2, 3, 0, 1);

  tmp1   = SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(row1, 2, 3, 0, 1), row3);
  tmp1   = SIMD.Float32x4.swizzle(tmp1, 1, 0, 3, 2);
  row2   = SIMD.Float32x4.swizzle(row2, 2, 3, 0, 1);
  minor0 = SIMD.Float32x4.add(SIMD.Float32x4.mul(row2, tmp1), minor0);
  minor2 = SIMD.Float32x4.mul(row0, tmp1);
  tmp1   = SIMD.Float32x4.swizzle(tmp1, 2, 3, 0, 1);
  minor0 = SIMD.Float32x4.sub(minor0, SIMD.Float32x4.mul(row2, tmp1));
  minor2 = SIMD.Float32x4.sub(SIMD.Float32x4.mul(row0, tmp1), minor2);
  minor2 = SIMD.Float32x4.swizzle(minor2, 2, 3, 0, 1);

  tmp1   = SIMD.Float32x4.mul(row0, row1);
  tmp1   = SIMD.Float32x4.swizzle(tmp1, 1, 0, 3, 2);
  minor2 = SIMD.Float32x4.add(SIMD.Float32x4.mul(row3, tmp1), minor2);
  minor3 = SIMD.Float32x4.sub(SIMD.Float32x4.mul(row2, tmp1), minor3);
  tmp1   = SIMD.Float32x4.swizzle(tmp1, 2, 3, 0, 1);
  minor2 = SIMD.Float32x4.sub(SIMD.Float32x4.mul(row3, tmp1), minor2);
  minor3 = SIMD.Float32x4.sub(minor3, SIMD.Float32x4.mul(row2, tmp1));

  tmp1   = SIMD.Float32x4.mul(row0, row3);
  tmp1   = SIMD.Float32x4.swizzle(tmp1, 1, 0, 3, 2);
  minor1 = SIMD.Float32x4.sub(minor1, SIMD.Float32x4.mul(row2, tmp1));
  minor2 = SIMD.Float32x4.add(SIMD.Float32x4.mul(row1, tmp1), minor2);
  tmp1   = SIMD.Float32x4.swizzle(tmp1, 2, 3, 0, 1);
  minor1 = SIMD.Float32x4.add(SIMD.Float32x4.mul(row2, tmp1), minor1);
  minor2 = SIMD.Float32x4.sub(minor2, SIMD.Float32x4.mul(row1, tmp1));

  tmp1   = SIMD.Float32x4.mul(row0, row2);
  tmp1   = SIMD.Float32x4.swizzle(tmp1, 1, 0, 3, 2);
  minor1 = SIMD.Float32x4.add(SIMD.Float32x4.mul(row3, tmp1), minor1);
  minor3 = SIMD.Float32x4.sub(minor3, SIMD.Float32x4.mul(row1, tmp1));
  tmp1   = SIMD.Float32x4.swizzle(tmp1, 2, 3, 0, 1);
  minor1 = SIMD.Float32x4.sub(minor1, SIMD.Float32x4.mul(row3, tmp1));
  minor3 = SIMD.Float32x4.add(SIMD.Float32x4.mul(row1, tmp1), minor3);

  // Compute matrix determinant
  det   = SIMD.Float32x4.mul(row0, minor0);
  det   = SIMD.Float32x4.add(SIMD.Float32x4.swizzle(det, 2, 3, 0, 1), det);
  det   = SIMD.Float32x4.add(SIMD.Float32x4.swizzle(det, 1, 0, 3, 2), det);
  tmp1  = SIMD.Float32x4.reciprocalApproximation(det);
  det   = SIMD.Float32x4.sub(
               SIMD.Float32x4.add(tmp1, tmp1),
               SIMD.Float32x4.mul(det, SIMD.Float32x4.mul(tmp1, tmp1)));
  det   = SIMD.Float32x4.swizzle(det, 0, 0, 0, 0);
  if (!det) {
      return null;
  }

  // Compute matrix inverse
  SIMD.Float32x4.store(out, 0,  SIMD.Float32x4.mul(det, minor0));
  SIMD.Float32x4.store(out, 4,  SIMD.Float32x4.mul(det, minor1));
  SIMD.Float32x4.store(out, 8,  SIMD.Float32x4.mul(det, minor2));
  SIMD.Float32x4.store(out, 12, SIMD.Float32x4.mul(det, minor3));
  return out;
}

/**
 * Inverts a mat4 using SIMD if available and enabled
 *
 * @param {mat4} out the receiving matrix
 * @param {mat4} a the source matrix
 * @returns {mat4} out
 */
mat4.invert = glMatrix.USE_SIMD ? mat4.SIMD.invert : mat4.scalar.invert;

/**
 * Calculates the adjugate of a mat4 not using SIMD
 *
 * @param {mat4} out the receiving matrix
 * @param {mat4} a the source matrix
 * @returns {mat4} out
 */
mat4.scalar.adjoint = function(out, a) {
    var a00 = a[0], a01 = a[1], a02 = a[2], a03 = a[3],
        a10 = a[4], a11 = a[5], a12 = a[6], a13 = a[7],
        a20 = a[8], a21 = a[9], a22 = a[10], a23 = a[11],
        a30 = a[12], a31 = a[13], a32 = a[14], a33 = a[15];

    out[0]  =  (a11 * (a22 * a33 - a23 * a32) - a21 * (a12 * a33 - a13 * a32) + a31 * (a12 * a23 - a13 * a22));
    out[1]  = -(a01 * (a22 * a33 - a23 * a32) - a21 * (a02 * a33 - a03 * a32) + a31 * (a02 * a23 - a03 * a22));
    out[2]  =  (a01 * (a12 * a33 - a13 * a32) - a11 * (a02 * a33 - a03 * a32) + a31 * (a02 * a13 - a03 * a12));
    out[3]  = -(a01 * (a12 * a23 - a13 * a22) - a11 * (a02 * a23 - a03 * a22) + a21 * (a02 * a13 - a03 * a12));
    out[4]  = -(a10 * (a22 * a33 - a23 * a32) - a20 * (a12 * a33 - a13 * a32) + a30 * (a12 * a23 - a13 * a22));
    out[5]  =  (a00 * (a22 * a33 - a23 * a32) - a20 * (a02 * a33 - a03 * a32) + a30 * (a02 * a23 - a03 * a22));
    out[6]  = -(a00 * (a12 * a33 - a13 * a32) - a10 * (a02 * a33 - a03 * a32) + a30 * (a02 * a13 - a03 * a12));
    out[7]  =  (a00 * (a12 * a23 - a13 * a22) - a10 * (a02 * a23 - a03 * a22) + a20 * (a02 * a13 - a03 * a12));
    out[8]  =  (a10 * (a21 * a33 - a23 * a31) - a20 * (a11 * a33 - a13 * a31) + a30 * (a11 * a23 - a13 * a21));
    out[9]  = -(a00 * (a21 * a33 - a23 * a31) - a20 * (a01 * a33 - a03 * a31) + a30 * (a01 * a23 - a03 * a21));
    out[10] =  (a00 * (a11 * a33 - a13 * a31) - a10 * (a01 * a33 - a03 * a31) + a30 * (a01 * a13 - a03 * a11));
    out[11] = -(a00 * (a11 * a23 - a13 * a21) - a10 * (a01 * a23 - a03 * a21) + a20 * (a01 * a13 - a03 * a11));
    out[12] = -(a10 * (a21 * a32 - a22 * a31) - a20 * (a11 * a32 - a12 * a31) + a30 * (a11 * a22 - a12 * a21));
    out[13] =  (a00 * (a21 * a32 - a22 * a31) - a20 * (a01 * a32 - a02 * a31) + a30 * (a01 * a22 - a02 * a21));
    out[14] = -(a00 * (a11 * a32 - a12 * a31) - a10 * (a01 * a32 - a02 * a31) + a30 * (a01 * a12 - a02 * a11));
    out[15] =  (a00 * (a11 * a22 - a12 * a21) - a10 * (a01 * a22 - a02 * a21) + a20 * (a01 * a12 - a02 * a11));
    return out;
};

/**
 * Calculates the adjugate of a mat4 using SIMD
 *
 * @param {mat4} out the receiving matrix
 * @param {mat4} a the source matrix
 * @returns {mat4} out
 */
mat4.SIMD.adjoint = function(out, a) {
  var a0, a1, a2, a3;
  var row0, row1, row2, row3;
  var tmp1;
  var minor0, minor1, minor2, minor3;

  var a0 = SIMD.Float32x4.load(a, 0);
  var a1 = SIMD.Float32x4.load(a, 4);
  var a2 = SIMD.Float32x4.load(a, 8);
  var a3 = SIMD.Float32x4.load(a, 12);

  // Transpose the source matrix.  Sort of.  Not a true transpose operation
  tmp1 = SIMD.Float32x4.shuffle(a0, a1, 0, 1, 4, 5);
  row1 = SIMD.Float32x4.shuffle(a2, a3, 0, 1, 4, 5);
  row0 = SIMD.Float32x4.shuffle(tmp1, row1, 0, 2, 4, 6);
  row1 = SIMD.Float32x4.shuffle(row1, tmp1, 1, 3, 5, 7);

  tmp1 = SIMD.Float32x4.shuffle(a0, a1, 2, 3, 6, 7);
  row3 = SIMD.Float32x4.shuffle(a2, a3, 2, 3, 6, 7);
  row2 = SIMD.Float32x4.shuffle(tmp1, row3, 0, 2, 4, 6);
  row3 = SIMD.Float32x4.shuffle(row3, tmp1, 1, 3, 5, 7);

  tmp1   = SIMD.Float32x4.mul(row2, row3);
  tmp1   = SIMD.Float32x4.swizzle(tmp1, 1, 0, 3, 2);
  minor0 = SIMD.Float32x4.mul(row1, tmp1);
  minor1 = SIMD.Float32x4.mul(row0, tmp1);
  tmp1   = SIMD.Float32x4.swizzle(tmp1, 2, 3, 0, 1);
  minor0 = SIMD.Float32x4.sub(SIMD.Float32x4.mul(row1, tmp1), minor0);
  minor1 = SIMD.Float32x4.sub(SIMD.Float32x4.mul(row0, tmp1), minor1);
  minor1 = SIMD.Float32x4.swizzle(minor1, 2, 3, 0, 1);

  tmp1   = SIMD.Float32x4.mul(row1, row2);
  tmp1   = SIMD.Float32x4.swizzle(tmp1, 1, 0, 3, 2);
  minor0 = SIMD.Float32x4.add(SIMD.Float32x4.mul(row3, tmp1), minor0);
  minor3 = SIMD.Float32x4.mul(row0, tmp1);
  tmp1   = SIMD.Float32x4.swizzle(tmp1, 2, 3, 0, 1);
  minor0 = SIMD.Float32x4.sub(minor0, SIMD.Float32x4.mul(row3, tmp1));
  minor3 = SIMD.Float32x4.sub(SIMD.Float32x4.mul(row0, tmp1), minor3);
  minor3 = SIMD.Float32x4.swizzle(minor3, 2, 3, 0, 1);

  tmp1   = SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(row1, 2, 3, 0, 1), row3);
  tmp1   = SIMD.Float32x4.swizzle(tmp1, 1, 0, 3, 2);
  row2   = SIMD.Float32x4.swizzle(row2, 2, 3, 0, 1);
  minor0 = SIMD.Float32x4.add(SIMD.Float32x4.mul(row2, tmp1), minor0);
  minor2 = SIMD.Float32x4.mul(row0, tmp1);
  tmp1   = SIMD.Float32x4.swizzle(tmp1, 2, 3, 0, 1);
  minor0 = SIMD.Float32x4.sub(minor0, SIMD.Float32x4.mul(row2, tmp1));
  minor2 = SIMD.Float32x4.sub(SIMD.Float32x4.mul(row0, tmp1), minor2);
  minor2 = SIMD.Float32x4.swizzle(minor2, 2, 3, 0, 1);

  tmp1   = SIMD.Float32x4.mul(row0, row1);
  tmp1   = SIMD.Float32x4.swizzle(tmp1, 1, 0, 3, 2);
  minor2 = SIMD.Float32x4.add(SIMD.Float32x4.mul(row3, tmp1), minor2);
  minor3 = SIMD.Float32x4.sub(SIMD.Float32x4.mul(row2, tmp1), minor3);
  tmp1   = SIMD.Float32x4.swizzle(tmp1, 2, 3, 0, 1);
  minor2 = SIMD.Float32x4.sub(SIMD.Float32x4.mul(row3, tmp1), minor2);
  minor3 = SIMD.Float32x4.sub(minor3, SIMD.Float32x4.mul(row2, tmp1));

  tmp1   = SIMD.Float32x4.mul(row0, row3);
  tmp1   = SIMD.Float32x4.swizzle(tmp1, 1, 0, 3, 2);
  minor1 = SIMD.Float32x4.sub(minor1, SIMD.Float32x4.mul(row2, tmp1));
  minor2 = SIMD.Float32x4.add(SIMD.Float32x4.mul(row1, tmp1), minor2);
  tmp1   = SIMD.Float32x4.swizzle(tmp1, 2, 3, 0, 1);
  minor1 = SIMD.Float32x4.add(SIMD.Float32x4.mul(row2, tmp1), minor1);
  minor2 = SIMD.Float32x4.sub(minor2, SIMD.Float32x4.mul(row1, tmp1));

  tmp1   = SIMD.Float32x4.mul(row0, row2);
  tmp1   = SIMD.Float32x4.swizzle(tmp1, 1, 0, 3, 2);
  minor1 = SIMD.Float32x4.add(SIMD.Float32x4.mul(row3, tmp1), minor1);
  minor3 = SIMD.Float32x4.sub(minor3, SIMD.Float32x4.mul(row1, tmp1));
  tmp1   = SIMD.Float32x4.swizzle(tmp1, 2, 3, 0, 1);
  minor1 = SIMD.Float32x4.sub(minor1, SIMD.Float32x4.mul(row3, tmp1));
  minor3 = SIMD.Float32x4.add(SIMD.Float32x4.mul(row1, tmp1), minor3);

  SIMD.Float32x4.store(out, 0,  minor0);
  SIMD.Float32x4.store(out, 4,  minor1);
  SIMD.Float32x4.store(out, 8,  minor2);
  SIMD.Float32x4.store(out, 12, minor3);
  return out;
};

/**
 * Calculates the adjugate of a mat4 using SIMD if available and enabled
 *
 * @param {mat4} out the receiving matrix
 * @param {mat4} a the source matrix
 * @returns {mat4} out
 */
 mat4.adjoint = glMatrix.USE_SIMD ? mat4.SIMD.adjoint : mat4.scalar.adjoint;

/**
 * Calculates the determinant of a mat4
 *
 * @param {mat4} a the source matrix
 * @returns {Number} determinant of a
 */
mat4.determinant = function (a) {
    var a00 = a[0], a01 = a[1], a02 = a[2], a03 = a[3],
        a10 = a[4], a11 = a[5], a12 = a[6], a13 = a[7],
        a20 = a[8], a21 = a[9], a22 = a[10], a23 = a[11],
        a30 = a[12], a31 = a[13], a32 = a[14], a33 = a[15],

        b00 = a00 * a11 - a01 * a10,
        b01 = a00 * a12 - a02 * a10,
        b02 = a00 * a13 - a03 * a10,
        b03 = a01 * a12 - a02 * a11,
        b04 = a01 * a13 - a03 * a11,
        b05 = a02 * a13 - a03 * a12,
        b06 = a20 * a31 - a21 * a30,
        b07 = a20 * a32 - a22 * a30,
        b08 = a20 * a33 - a23 * a30,
        b09 = a21 * a32 - a22 * a31,
        b10 = a21 * a33 - a23 * a31,
        b11 = a22 * a33 - a23 * a32;

    // Calculate the determinant
    return b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;
};

/**
 * Multiplies two mat4's explicitly using SIMD
 *
 * @param {mat4} out the receiving matrix
 * @param {mat4} a the first operand, must be a Float32Array
 * @param {mat4} b the second operand, must be a Float32Array
 * @returns {mat4} out
 */
mat4.SIMD.multiply = function (out, a, b) {
    var a0 = SIMD.Float32x4.load(a, 0);
    var a1 = SIMD.Float32x4.load(a, 4);
    var a2 = SIMD.Float32x4.load(a, 8);
    var a3 = SIMD.Float32x4.load(a, 12);

    var b0 = SIMD.Float32x4.load(b, 0);
    var out0 = SIMD.Float32x4.add(
                   SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(b0, 0, 0, 0, 0), a0),
                   SIMD.Float32x4.add(
                       SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(b0, 1, 1, 1, 1), a1),
                       SIMD.Float32x4.add(
                           SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(b0, 2, 2, 2, 2), a2),
                           SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(b0, 3, 3, 3, 3), a3))));
    SIMD.Float32x4.store(out, 0, out0);

    var b1 = SIMD.Float32x4.load(b, 4);
    var out1 = SIMD.Float32x4.add(
                   SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(b1, 0, 0, 0, 0), a0),
                   SIMD.Float32x4.add(
                       SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(b1, 1, 1, 1, 1), a1),
                       SIMD.Float32x4.add(
                           SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(b1, 2, 2, 2, 2), a2),
                           SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(b1, 3, 3, 3, 3), a3))));
    SIMD.Float32x4.store(out, 4, out1);

    var b2 = SIMD.Float32x4.load(b, 8);
    var out2 = SIMD.Float32x4.add(
                   SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(b2, 0, 0, 0, 0), a0),
                   SIMD.Float32x4.add(
                       SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(b2, 1, 1, 1, 1), a1),
                       SIMD.Float32x4.add(
                               SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(b2, 2, 2, 2, 2), a2),
                               SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(b2, 3, 3, 3, 3), a3))));
    SIMD.Float32x4.store(out, 8, out2);

    var b3 = SIMD.Float32x4.load(b, 12);
    var out3 = SIMD.Float32x4.add(
                   SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(b3, 0, 0, 0, 0), a0),
                   SIMD.Float32x4.add(
                        SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(b3, 1, 1, 1, 1), a1),
                        SIMD.Float32x4.add(
                            SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(b3, 2, 2, 2, 2), a2),
                            SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(b3, 3, 3, 3, 3), a3))));
    SIMD.Float32x4.store(out, 12, out3);

    return out;
};

/**
 * Multiplies two mat4's explicitly not using SIMD
 *
 * @param {mat4} out the receiving matrix
 * @param {mat4} a the first operand
 * @param {mat4} b the second operand
 * @returns {mat4} out
 */
mat4.scalar.multiply = function (out, a, b) {
    var a00 = a[0], a01 = a[1], a02 = a[2], a03 = a[3],
        a10 = a[4], a11 = a[5], a12 = a[6], a13 = a[7],
        a20 = a[8], a21 = a[9], a22 = a[10], a23 = a[11],
        a30 = a[12], a31 = a[13], a32 = a[14], a33 = a[15];

    // Cache only the current line of the second matrix
    var b0  = b[0], b1 = b[1], b2 = b[2], b3 = b[3];
    out[0] = b0*a00 + b1*a10 + b2*a20 + b3*a30;
    out[1] = b0*a01 + b1*a11 + b2*a21 + b3*a31;
    out[2] = b0*a02 + b1*a12 + b2*a22 + b3*a32;
    out[3] = b0*a03 + b1*a13 + b2*a23 + b3*a33;

    b0 = b[4]; b1 = b[5]; b2 = b[6]; b3 = b[7];
    out[4] = b0*a00 + b1*a10 + b2*a20 + b3*a30;
    out[5] = b0*a01 + b1*a11 + b2*a21 + b3*a31;
    out[6] = b0*a02 + b1*a12 + b2*a22 + b3*a32;
    out[7] = b0*a03 + b1*a13 + b2*a23 + b3*a33;

    b0 = b[8]; b1 = b[9]; b2 = b[10]; b3 = b[11];
    out[8] = b0*a00 + b1*a10 + b2*a20 + b3*a30;
    out[9] = b0*a01 + b1*a11 + b2*a21 + b3*a31;
    out[10] = b0*a02 + b1*a12 + b2*a22 + b3*a32;
    out[11] = b0*a03 + b1*a13 + b2*a23 + b3*a33;

    b0 = b[12]; b1 = b[13]; b2 = b[14]; b3 = b[15];
    out[12] = b0*a00 + b1*a10 + b2*a20 + b3*a30;
    out[13] = b0*a01 + b1*a11 + b2*a21 + b3*a31;
    out[14] = b0*a02 + b1*a12 + b2*a22 + b3*a32;
    out[15] = b0*a03 + b1*a13 + b2*a23 + b3*a33;
    return out;
};

/**
 * Multiplies two mat4's using SIMD if available and enabled
 *
 * @param {mat4} out the receiving matrix
 * @param {mat4} a the first operand
 * @param {mat4} b the second operand
 * @returns {mat4} out
 */
mat4.multiply = glMatrix.USE_SIMD ? mat4.SIMD.multiply : mat4.scalar.multiply;

/**
 * Alias for {@link mat4.multiply}
 * @function
 */
mat4.mul = mat4.multiply;

/**
 * Translate a mat4 by the given vector not using SIMD
 *
 * @param {mat4} out the receiving matrix
 * @param {mat4} a the matrix to translate
 * @param {vec3} v vector to translate by
 * @returns {mat4} out
 */
mat4.scalar.translate = function (out, a, v) {
    var x = v[0], y = v[1], z = v[2],
        a00, a01, a02, a03,
        a10, a11, a12, a13,
        a20, a21, a22, a23;

    if (a === out) {
        out[12] = a[0] * x + a[4] * y + a[8] * z + a[12];
        out[13] = a[1] * x + a[5] * y + a[9] * z + a[13];
        out[14] = a[2] * x + a[6] * y + a[10] * z + a[14];
        out[15] = a[3] * x + a[7] * y + a[11] * z + a[15];
    } else {
        a00 = a[0]; a01 = a[1]; a02 = a[2]; a03 = a[3];
        a10 = a[4]; a11 = a[5]; a12 = a[6]; a13 = a[7];
        a20 = a[8]; a21 = a[9]; a22 = a[10]; a23 = a[11];

        out[0] = a00; out[1] = a01; out[2] = a02; out[3] = a03;
        out[4] = a10; out[5] = a11; out[6] = a12; out[7] = a13;
        out[8] = a20; out[9] = a21; out[10] = a22; out[11] = a23;

        out[12] = a00 * x + a10 * y + a20 * z + a[12];
        out[13] = a01 * x + a11 * y + a21 * z + a[13];
        out[14] = a02 * x + a12 * y + a22 * z + a[14];
        out[15] = a03 * x + a13 * y + a23 * z + a[15];
    }

    return out;
};

/**
 * Translates a mat4 by the given vector using SIMD
 *
 * @param {mat4} out the receiving matrix
 * @param {mat4} a the matrix to translate
 * @param {vec3} v vector to translate by
 * @returns {mat4} out
 */
mat4.SIMD.translate = function (out, a, v) {
    var a0 = SIMD.Float32x4.load(a, 0),
        a1 = SIMD.Float32x4.load(a, 4),
        a2 = SIMD.Float32x4.load(a, 8),
        a3 = SIMD.Float32x4.load(a, 12),
        vec = SIMD.Float32x4(v[0], v[1], v[2] , 0);

    if (a !== out) {
        out[0] = a[0]; out[1] = a[1]; out[2] = a[2]; out[3] = a[3];
        out[4] = a[4]; out[5] = a[5]; out[6] = a[6]; out[7] = a[7];
        out[8] = a[8]; out[9] = a[9]; out[10] = a[10]; out[11] = a[11];
    }

    a0 = SIMD.Float32x4.mul(a0, SIMD.Float32x4.swizzle(vec, 0, 0, 0, 0));
    a1 = SIMD.Float32x4.mul(a1, SIMD.Float32x4.swizzle(vec, 1, 1, 1, 1));
    a2 = SIMD.Float32x4.mul(a2, SIMD.Float32x4.swizzle(vec, 2, 2, 2, 2));

    var t0 = SIMD.Float32x4.add(a0, SIMD.Float32x4.add(a1, SIMD.Float32x4.add(a2, a3)));
    SIMD.Float32x4.store(out, 12, t0);

    return out;
};

/**
 * Translates a mat4 by the given vector using SIMD if available and enabled
 *
 * @param {mat4} out the receiving matrix
 * @param {mat4} a the matrix to translate
 * @param {vec3} v vector to translate by
 * @returns {mat4} out
 */
mat4.translate = glMatrix.USE_SIMD ? mat4.SIMD.translate : mat4.scalar.translate;

/**
 * Scales the mat4 by the dimensions in the given vec3 not using vectorization
 *
 * @param {mat4} out the receiving matrix
 * @param {mat4} a the matrix to scale
 * @param {vec3} v the vec3 to scale the matrix by
 * @returns {mat4} out
 **/
mat4.scalar.scale = function(out, a, v) {
    var x = v[0], y = v[1], z = v[2];

    out[0] = a[0] * x;
    out[1] = a[1] * x;
    out[2] = a[2] * x;
    out[3] = a[3] * x;
    out[4] = a[4] * y;
    out[5] = a[5] * y;
    out[6] = a[6] * y;
    out[7] = a[7] * y;
    out[8] = a[8] * z;
    out[9] = a[9] * z;
    out[10] = a[10] * z;
    out[11] = a[11] * z;
    out[12] = a[12];
    out[13] = a[13];
    out[14] = a[14];
    out[15] = a[15];
    return out;
};

/**
 * Scales the mat4 by the dimensions in the given vec3 using vectorization
 *
 * @param {mat4} out the receiving matrix
 * @param {mat4} a the matrix to scale
 * @param {vec3} v the vec3 to scale the matrix by
 * @returns {mat4} out
 **/
mat4.SIMD.scale = function(out, a, v) {
    var a0, a1, a2;
    var vec = SIMD.Float32x4(v[0], v[1], v[2], 0);

    a0 = SIMD.Float32x4.load(a, 0);
    SIMD.Float32x4.store(
        out, 0, SIMD.Float32x4.mul(a0, SIMD.Float32x4.swizzle(vec, 0, 0, 0, 0)));

    a1 = SIMD.Float32x4.load(a, 4);
    SIMD.Float32x4.store(
        out, 4, SIMD.Float32x4.mul(a1, SIMD.Float32x4.swizzle(vec, 1, 1, 1, 1)));

    a2 = SIMD.Float32x4.load(a, 8);
    SIMD.Float32x4.store(
        out, 8, SIMD.Float32x4.mul(a2, SIMD.Float32x4.swizzle(vec, 2, 2, 2, 2)));

    out[12] = a[12];
    out[13] = a[13];
    out[14] = a[14];
    out[15] = a[15];
    return out;
};

/**
 * Scales the mat4 by the dimensions in the given vec3 using SIMD if available and enabled
 *
 * @param {mat4} out the receiving matrix
 * @param {mat4} a the matrix to scale
 * @param {vec3} v the vec3 to scale the matrix by
 * @returns {mat4} out
 */
mat4.scale = glMatrix.USE_SIMD ? mat4.SIMD.scale : mat4.scalar.scale;

/**
 * Rotates a mat4 by the given angle around the given axis
 *
 * @param {mat4} out the receiving matrix
 * @param {mat4} a the matrix to rotate
 * @param {Number} rad the angle to rotate the matrix by
 * @param {vec3} axis the axis to rotate around
 * @returns {mat4} out
 */
mat4.rotate = function (out, a, rad, axis) {
    var x = axis[0], y = axis[1], z = axis[2],
        len = Math.sqrt(x * x + y * y + z * z),
        s, c, t,
        a00, a01, a02, a03,
        a10, a11, a12, a13,
        a20, a21, a22, a23,
        b00, b01, b02,
        b10, b11, b12,
        b20, b21, b22;

    if (Math.abs(len) < glMatrix.EPSILON) { return null; }

    len = 1 / len;
    x *= len;
    y *= len;
    z *= len;

    s = Math.sin(rad);
    c = Math.cos(rad);
    t = 1 - c;

    a00 = a[0]; a01 = a[1]; a02 = a[2]; a03 = a[3];
    a10 = a[4]; a11 = a[5]; a12 = a[6]; a13 = a[7];
    a20 = a[8]; a21 = a[9]; a22 = a[10]; a23 = a[11];

    // Construct the elements of the rotation matrix
    b00 = x * x * t + c; b01 = y * x * t + z * s; b02 = z * x * t - y * s;
    b10 = x * y * t - z * s; b11 = y * y * t + c; b12 = z * y * t + x * s;
    b20 = x * z * t + y * s; b21 = y * z * t - x * s; b22 = z * z * t + c;

    // Perform rotation-specific matrix multiplication
    out[0] = a00 * b00 + a10 * b01 + a20 * b02;
    out[1] = a01 * b00 + a11 * b01 + a21 * b02;
    out[2] = a02 * b00 + a12 * b01 + a22 * b02;
    out[3] = a03 * b00 + a13 * b01 + a23 * b02;
    out[4] = a00 * b10 + a10 * b11 + a20 * b12;
    out[5] = a01 * b10 + a11 * b11 + a21 * b12;
    out[6] = a02 * b10 + a12 * b11 + a22 * b12;
    out[7] = a03 * b10 + a13 * b11 + a23 * b12;
    out[8] = a00 * b20 + a10 * b21 + a20 * b22;
    out[9] = a01 * b20 + a11 * b21 + a21 * b22;
    out[10] = a02 * b20 + a12 * b21 + a22 * b22;
    out[11] = a03 * b20 + a13 * b21 + a23 * b22;

    if (a !== out) { // If the source and destination differ, copy the unchanged last row
        out[12] = a[12];
        out[13] = a[13];
        out[14] = a[14];
        out[15] = a[15];
    }
    return out;
};

/**
 * Rotates a matrix by the given angle around the X axis not using SIMD
 *
 * @param {mat4} out the receiving matrix
 * @param {mat4} a the matrix to rotate
 * @param {Number} rad the angle to rotate the matrix by
 * @returns {mat4} out
 */
mat4.scalar.rotateX = function (out, a, rad) {
    var s = Math.sin(rad),
        c = Math.cos(rad),
        a10 = a[4],
        a11 = a[5],
        a12 = a[6],
        a13 = a[7],
        a20 = a[8],
        a21 = a[9],
        a22 = a[10],
        a23 = a[11];

    if (a !== out) { // If the source and destination differ, copy the unchanged rows
        out[0]  = a[0];
        out[1]  = a[1];
        out[2]  = a[2];
        out[3]  = a[3];
        out[12] = a[12];
        out[13] = a[13];
        out[14] = a[14];
        out[15] = a[15];
    }

    // Perform axis-specific matrix multiplication
    out[4] = a10 * c + a20 * s;
    out[5] = a11 * c + a21 * s;
    out[6] = a12 * c + a22 * s;
    out[7] = a13 * c + a23 * s;
    out[8] = a20 * c - a10 * s;
    out[9] = a21 * c - a11 * s;
    out[10] = a22 * c - a12 * s;
    out[11] = a23 * c - a13 * s;
    return out;
};

/**
 * Rotates a matrix by the given angle around the X axis using SIMD
 *
 * @param {mat4} out the receiving matrix
 * @param {mat4} a the matrix to rotate
 * @param {Number} rad the angle to rotate the matrix by
 * @returns {mat4} out
 */
mat4.SIMD.rotateX = function (out, a, rad) {
    var s = SIMD.Float32x4.splat(Math.sin(rad)),
        c = SIMD.Float32x4.splat(Math.cos(rad));

    if (a !== out) { // If the source and destination differ, copy the unchanged rows
      out[0]  = a[0];
      out[1]  = a[1];
      out[2]  = a[2];
      out[3]  = a[3];
      out[12] = a[12];
      out[13] = a[13];
      out[14] = a[14];
      out[15] = a[15];
    }

    // Perform axis-specific matrix multiplication
    var a_1 = SIMD.Float32x4.load(a, 4);
    var a_2 = SIMD.Float32x4.load(a, 8);
    SIMD.Float32x4.store(out, 4,
                         SIMD.Float32x4.add(SIMD.Float32x4.mul(a_1, c), SIMD.Float32x4.mul(a_2, s)));
    SIMD.Float32x4.store(out, 8,
                         SIMD.Float32x4.sub(SIMD.Float32x4.mul(a_2, c), SIMD.Float32x4.mul(a_1, s)));
    return out;
};

/**
 * Rotates a matrix by the given angle around the X axis using SIMD if availabe and enabled
 *
 * @param {mat4} out the receiving matrix
 * @param {mat4} a the matrix to rotate
 * @param {Number} rad the angle to rotate the matrix by
 * @returns {mat4} out
 */
mat4.rotateX = glMatrix.USE_SIMD ? mat4.SIMD.rotateX : mat4.scalar.rotateX;

/**
 * Rotates a matrix by the given angle around the Y axis not using SIMD
 *
 * @param {mat4} out the receiving matrix
 * @param {mat4} a the matrix to rotate
 * @param {Number} rad the angle to rotate the matrix by
 * @returns {mat4} out
 */
mat4.scalar.rotateY = function (out, a, rad) {
    var s = Math.sin(rad),
        c = Math.cos(rad),
        a00 = a[0],
        a01 = a[1],
        a02 = a[2],
        a03 = a[3],
        a20 = a[8],
        a21 = a[9],
        a22 = a[10],
        a23 = a[11];

    if (a !== out) { // If the source and destination differ, copy the unchanged rows
        out[4]  = a[4];
        out[5]  = a[5];
        out[6]  = a[6];
        out[7]  = a[7];
        out[12] = a[12];
        out[13] = a[13];
        out[14] = a[14];
        out[15] = a[15];
    }

    // Perform axis-specific matrix multiplication
    out[0] = a00 * c - a20 * s;
    out[1] = a01 * c - a21 * s;
    out[2] = a02 * c - a22 * s;
    out[3] = a03 * c - a23 * s;
    out[8] = a00 * s + a20 * c;
    out[9] = a01 * s + a21 * c;
    out[10] = a02 * s + a22 * c;
    out[11] = a03 * s + a23 * c;
    return out;
};

/**
 * Rotates a matrix by the given angle around the Y axis using SIMD
 *
 * @param {mat4} out the receiving matrix
 * @param {mat4} a the matrix to rotate
 * @param {Number} rad the angle to rotate the matrix by
 * @returns {mat4} out
 */
mat4.SIMD.rotateY = function (out, a, rad) {
    var s = SIMD.Float32x4.splat(Math.sin(rad)),
        c = SIMD.Float32x4.splat(Math.cos(rad));

    if (a !== out) { // If the source and destination differ, copy the unchanged rows
        out[4]  = a[4];
        out[5]  = a[5];
        out[6]  = a[6];
        out[7]  = a[7];
        out[12] = a[12];
        out[13] = a[13];
        out[14] = a[14];
        out[15] = a[15];
    }

    // Perform axis-specific matrix multiplication
    var a_0 = SIMD.Float32x4.load(a, 0);
    var a_2 = SIMD.Float32x4.load(a, 8);
    SIMD.Float32x4.store(out, 0,
                         SIMD.Float32x4.sub(SIMD.Float32x4.mul(a_0, c), SIMD.Float32x4.mul(a_2, s)));
    SIMD.Float32x4.store(out, 8,
                         SIMD.Float32x4.add(SIMD.Float32x4.mul(a_0, s), SIMD.Float32x4.mul(a_2, c)));
    return out;
};

/**
 * Rotates a matrix by the given angle around the Y axis if SIMD available and enabled
 *
 * @param {mat4} out the receiving matrix
 * @param {mat4} a the matrix to rotate
 * @param {Number} rad the angle to rotate the matrix by
 * @returns {mat4} out
 */
 mat4.rotateY = glMatrix.USE_SIMD ? mat4.SIMD.rotateY : mat4.scalar.rotateY;

/**
 * Rotates a matrix by the given angle around the Z axis not using SIMD
 *
 * @param {mat4} out the receiving matrix
 * @param {mat4} a the matrix to rotate
 * @param {Number} rad the angle to rotate the matrix by
 * @returns {mat4} out
 */
mat4.scalar.rotateZ = function (out, a, rad) {
    var s = Math.sin(rad),
        c = Math.cos(rad),
        a00 = a[0],
        a01 = a[1],
        a02 = a[2],
        a03 = a[3],
        a10 = a[4],
        a11 = a[5],
        a12 = a[6],
        a13 = a[7];

    if (a !== out) { // If the source and destination differ, copy the unchanged last row
        out[8]  = a[8];
        out[9]  = a[9];
        out[10] = a[10];
        out[11] = a[11];
        out[12] = a[12];
        out[13] = a[13];
        out[14] = a[14];
        out[15] = a[15];
    }

    // Perform axis-specific matrix multiplication
    out[0] = a00 * c + a10 * s;
    out[1] = a01 * c + a11 * s;
    out[2] = a02 * c + a12 * s;
    out[3] = a03 * c + a13 * s;
    out[4] = a10 * c - a00 * s;
    out[5] = a11 * c - a01 * s;
    out[6] = a12 * c - a02 * s;
    out[7] = a13 * c - a03 * s;
    return out;
};

/**
 * Rotates a matrix by the given angle around the Z axis using SIMD
 *
 * @param {mat4} out the receiving matrix
 * @param {mat4} a the matrix to rotate
 * @param {Number} rad the angle to rotate the matrix by
 * @returns {mat4} out
 */
mat4.SIMD.rotateZ = function (out, a, rad) {
    var s = SIMD.Float32x4.splat(Math.sin(rad)),
        c = SIMD.Float32x4.splat(Math.cos(rad));

    if (a !== out) { // If the source and destination differ, copy the unchanged last row
        out[8]  = a[8];
        out[9]  = a[9];
        out[10] = a[10];
        out[11] = a[11];
        out[12] = a[12];
        out[13] = a[13];
        out[14] = a[14];
        out[15] = a[15];
    }

    // Perform axis-specific matrix multiplication
    var a_0 = SIMD.Float32x4.load(a, 0);
    var a_1 = SIMD.Float32x4.load(a, 4);
    SIMD.Float32x4.store(out, 0,
                         SIMD.Float32x4.add(SIMD.Float32x4.mul(a_0, c), SIMD.Float32x4.mul(a_1, s)));
    SIMD.Float32x4.store(out, 4,
                         SIMD.Float32x4.sub(SIMD.Float32x4.mul(a_1, c), SIMD.Float32x4.mul(a_0, s)));
    return out;
};

/**
 * Rotates a matrix by the given angle around the Z axis if SIMD available and enabled
 *
 * @param {mat4} out the receiving matrix
 * @param {mat4} a the matrix to rotate
 * @param {Number} rad the angle to rotate the matrix by
 * @returns {mat4} out
 */
 mat4.rotateZ = glMatrix.USE_SIMD ? mat4.SIMD.rotateZ : mat4.scalar.rotateZ;

/**
 * Creates a matrix from a vector translation
 * This is equivalent to (but much faster than):
 *
 *     mat4.identity(dest);
 *     mat4.translate(dest, dest, vec);
 *
 * @param {mat4} out mat4 receiving operation result
 * @param {vec3} v Translation vector
 * @returns {mat4} out
 */
mat4.fromTranslation = function(out, v) {
    out[0] = 1;
    out[1] = 0;
    out[2] = 0;
    out[3] = 0;
    out[4] = 0;
    out[5] = 1;
    out[6] = 0;
    out[7] = 0;
    out[8] = 0;
    out[9] = 0;
    out[10] = 1;
    out[11] = 0;
    out[12] = v[0];
    out[13] = v[1];
    out[14] = v[2];
    out[15] = 1;
    return out;
}

/**
 * Creates a matrix from a vector scaling
 * This is equivalent to (but much faster than):
 *
 *     mat4.identity(dest);
 *     mat4.scale(dest, dest, vec);
 *
 * @param {mat4} out mat4 receiving operation result
 * @param {vec3} v Scaling vector
 * @returns {mat4} out
 */
mat4.fromScaling = function(out, v) {
    out[0] = v[0];
    out[1] = 0;
    out[2] = 0;
    out[3] = 0;
    out[4] = 0;
    out[5] = v[1];
    out[6] = 0;
    out[7] = 0;
    out[8] = 0;
    out[9] = 0;
    out[10] = v[2];
    out[11] = 0;
    out[12] = 0;
    out[13] = 0;
    out[14] = 0;
    out[15] = 1;
    return out;
}

/**
 * Creates a matrix from a given angle around a given axis
 * This is equivalent to (but much faster than):
 *
 *     mat4.identity(dest);
 *     mat4.rotate(dest, dest, rad, axis);
 *
 * @param {mat4} out mat4 receiving operation result
 * @param {Number} rad the angle to rotate the matrix by
 * @param {vec3} axis the axis to rotate around
 * @returns {mat4} out
 */
mat4.fromRotation = function(out, rad, axis) {
    var x = axis[0], y = axis[1], z = axis[2],
        len = Math.sqrt(x * x + y * y + z * z),
        s, c, t;

    if (Math.abs(len) < glMatrix.EPSILON) { return null; }

    len = 1 / len;
    x *= len;
    y *= len;
    z *= len;

    s = Math.sin(rad);
    c = Math.cos(rad);
    t = 1 - c;

    // Perform rotation-specific matrix multiplication
    out[0] = x * x * t + c;
    out[1] = y * x * t + z * s;
    out[2] = z * x * t - y * s;
    out[3] = 0;
    out[4] = x * y * t - z * s;
    out[5] = y * y * t + c;
    out[6] = z * y * t + x * s;
    out[7] = 0;
    out[8] = x * z * t + y * s;
    out[9] = y * z * t - x * s;
    out[10] = z * z * t + c;
    out[11] = 0;
    out[12] = 0;
    out[13] = 0;
    out[14] = 0;
    out[15] = 1;
    return out;
}

/**
 * Creates a matrix from the given angle around the X axis
 * This is equivalent to (but much faster than):
 *
 *     mat4.identity(dest);
 *     mat4.rotateX(dest, dest, rad);
 *
 * @param {mat4} out mat4 receiving operation result
 * @param {Number} rad the angle to rotate the matrix by
 * @returns {mat4} out
 */
mat4.fromXRotation = function(out, rad) {
    var s = Math.sin(rad),
        c = Math.cos(rad);

    // Perform axis-specific matrix multiplication
    out[0]  = 1;
    out[1]  = 0;
    out[2]  = 0;
    out[3]  = 0;
    out[4] = 0;
    out[5] = c;
    out[6] = s;
    out[7] = 0;
    out[8] = 0;
    out[9] = -s;
    out[10] = c;
    out[11] = 0;
    out[12] = 0;
    out[13] = 0;
    out[14] = 0;
    out[15] = 1;
    return out;
}

/**
 * Creates a matrix from the given angle around the Y axis
 * This is equivalent to (but much faster than):
 *
 *     mat4.identity(dest);
 *     mat4.rotateY(dest, dest, rad);
 *
 * @param {mat4} out mat4 receiving operation result
 * @param {Number} rad the angle to rotate the matrix by
 * @returns {mat4} out
 */
mat4.fromYRotation = function(out, rad) {
    var s = Math.sin(rad),
        c = Math.cos(rad);

    // Perform axis-specific matrix multiplication
    out[0]  = c;
    out[1]  = 0;
    out[2]  = -s;
    out[3]  = 0;
    out[4] = 0;
    out[5] = 1;
    out[6] = 0;
    out[7] = 0;
    out[8] = s;
    out[9] = 0;
    out[10] = c;
    out[11] = 0;
    out[12] = 0;
    out[13] = 0;
    out[14] = 0;
    out[15] = 1;
    return out;
}

/**
 * Creates a matrix from the given angle around the Z axis
 * This is equivalent to (but much faster than):
 *
 *     mat4.identity(dest);
 *     mat4.rotateZ(dest, dest, rad);
 *
 * @param {mat4} out mat4 receiving operation result
 * @param {Number} rad the angle to rotate the matrix by
 * @returns {mat4} out
 */
mat4.fromZRotation = function(out, rad) {
    var s = Math.sin(rad),
        c = Math.cos(rad);

    // Perform axis-specific matrix multiplication
    out[0]  = c;
    out[1]  = s;
    out[2]  = 0;
    out[3]  = 0;
    out[4] = -s;
    out[5] = c;
    out[6] = 0;
    out[7] = 0;
    out[8] = 0;
    out[9] = 0;
    out[10] = 1;
    out[11] = 0;
    out[12] = 0;
    out[13] = 0;
    out[14] = 0;
    out[15] = 1;
    return out;
}

/**
 * Creates a matrix from a quaternion rotation and vector translation
 * This is equivalent to (but much faster than):
 *
 *     mat4.identity(dest);
 *     mat4.translate(dest, vec);
 *     var quatMat = mat4.create();
 *     quat4.toMat4(quat, quatMat);
 *     mat4.multiply(dest, quatMat);
 *
 * @param {mat4} out mat4 receiving operation result
 * @param {quat4} q Rotation quaternion
 * @param {vec3} v Translation vector
 * @returns {mat4} out
 */
mat4.fromRotationTranslation = function (out, q, v) {
    // Quaternion math
    var x = q[0], y = q[1], z = q[2], w = q[3],
        x2 = x + x,
        y2 = y + y,
        z2 = z + z,

        xx = x * x2,
        xy = x * y2,
        xz = x * z2,
        yy = y * y2,
        yz = y * z2,
        zz = z * z2,
        wx = w * x2,
        wy = w * y2,
        wz = w * z2;

    out[0] = 1 - (yy + zz);
    out[1] = xy + wz;
    out[2] = xz - wy;
    out[3] = 0;
    out[4] = xy - wz;
    out[5] = 1 - (xx + zz);
    out[6] = yz + wx;
    out[7] = 0;
    out[8] = xz + wy;
    out[9] = yz - wx;
    out[10] = 1 - (xx + yy);
    out[11] = 0;
    out[12] = v[0];
    out[13] = v[1];
    out[14] = v[2];
    out[15] = 1;

    return out;
};

/**
 * Returns the translation vector component of a transformation
 *  matrix. If a matrix is built with fromRotationTranslation,
 *  the returned vector will be the same as the translation vector
 *  originally supplied.
 * @param  {vec3} out Vector to receive translation component
 * @param  {mat4} mat Matrix to be decomposed (input)
 * @return {vec3} out
 */
mat4.getTranslation = function (out, mat) {
  out[0] = mat[12];
  out[1] = mat[13];
  out[2] = mat[14];

  return out;
};

/**
 * Returns a quaternion representing the rotational component
 *  of a transformation matrix. If a matrix is built with
 *  fromRotationTranslation, the returned quaternion will be the
 *  same as the quaternion originally supplied.
 * @param {quat} out Quaternion to receive the rotation component
 * @param {mat4} mat Matrix to be decomposed (input)
 * @return {quat} out
 */
mat4.getRotation = function (out, mat) {
  // Algorithm taken from http://www.euclideanspace.com/maths/geometry/rotations/conversions/matrixToQuaternion/index.htm
  var trace = mat[0] + mat[5] + mat[10];
  var S = 0;

  if (trace > 0) { 
    S = Math.sqrt(trace + 1.0) * 2;
    out[3] = 0.25 * S;
    out[0] = (mat[6] - mat[9]) / S;
    out[1] = (mat[8] - mat[2]) / S; 
    out[2] = (mat[1] - mat[4]) / S; 
  } else if ((mat[0] > mat[5])&(mat[0] > mat[10])) { 
    S = Math.sqrt(1.0 + mat[0] - mat[5] - mat[10]) * 2;
    out[3] = (mat[6] - mat[9]) / S;
    out[0] = 0.25 * S;
    out[1] = (mat[1] + mat[4]) / S; 
    out[2] = (mat[8] + mat[2]) / S; 
  } else if (mat[5] > mat[10]) { 
    S = Math.sqrt(1.0 + mat[5] - mat[0] - mat[10]) * 2;
    out[3] = (mat[8] - mat[2]) / S;
    out[0] = (mat[1] + mat[4]) / S; 
    out[1] = 0.25 * S;
    out[2] = (mat[6] + mat[9]) / S; 
  } else { 
    S = Math.sqrt(1.0 + mat[10] - mat[0] - mat[5]) * 2;
    out[3] = (mat[1] - mat[4]) / S;
    out[0] = (mat[8] + mat[2]) / S;
    out[1] = (mat[6] + mat[9]) / S;
    out[2] = 0.25 * S;
  }

  return out;
};

/**
 * Creates a matrix from a quaternion rotation, vector translation and vector scale
 * This is equivalent to (but much faster than):
 *
 *     mat4.identity(dest);
 *     mat4.translate(dest, vec);
 *     var quatMat = mat4.create();
 *     quat4.toMat4(quat, quatMat);
 *     mat4.multiply(dest, quatMat);
 *     mat4.scale(dest, scale)
 *
 * @param {mat4} out mat4 receiving operation result
 * @param {quat4} q Rotation quaternion
 * @param {vec3} v Translation vector
 * @param {vec3} s Scaling vector
 * @returns {mat4} out
 */
mat4.fromRotationTranslationScale = function (out, q, v, s) {
    // Quaternion math
    var x = q[0], y = q[1], z = q[2], w = q[3],
        x2 = x + x,
        y2 = y + y,
        z2 = z + z,

        xx = x * x2,
        xy = x * y2,
        xz = x * z2,
        yy = y * y2,
        yz = y * z2,
        zz = z * z2,
        wx = w * x2,
        wy = w * y2,
        wz = w * z2,
        sx = s[0],
        sy = s[1],
        sz = s[2];

    out[0] = (1 - (yy + zz)) * sx;
    out[1] = (xy + wz) * sx;
    out[2] = (xz - wy) * sx;
    out[3] = 0;
    out[4] = (xy - wz) * sy;
    out[5] = (1 - (xx + zz)) * sy;
    out[6] = (yz + wx) * sy;
    out[7] = 0;
    out[8] = (xz + wy) * sz;
    out[9] = (yz - wx) * sz;
    out[10] = (1 - (xx + yy)) * sz;
    out[11] = 0;
    out[12] = v[0];
    out[13] = v[1];
    out[14] = v[2];
    out[15] = 1;

    return out;
};

/**
 * Creates a matrix from a quaternion rotation, vector translation and vector scale, rotating and scaling around the given origin
 * This is equivalent to (but much faster than):
 *
 *     mat4.identity(dest);
 *     mat4.translate(dest, vec);
 *     mat4.translate(dest, origin);
 *     var quatMat = mat4.create();
 *     quat4.toMat4(quat, quatMat);
 *     mat4.multiply(dest, quatMat);
 *     mat4.scale(dest, scale)
 *     mat4.translate(dest, negativeOrigin);
 *
 * @param {mat4} out mat4 receiving operation result
 * @param {quat4} q Rotation quaternion
 * @param {vec3} v Translation vector
 * @param {vec3} s Scaling vector
 * @param {vec3} o The origin vector around which to scale and rotate
 * @returns {mat4} out
 */
mat4.fromRotationTranslationScaleOrigin = function (out, q, v, s, o) {
  // Quaternion math
  var x = q[0], y = q[1], z = q[2], w = q[3],
      x2 = x + x,
      y2 = y + y,
      z2 = z + z,

      xx = x * x2,
      xy = x * y2,
      xz = x * z2,
      yy = y * y2,
      yz = y * z2,
      zz = z * z2,
      wx = w * x2,
      wy = w * y2,
      wz = w * z2,

      sx = s[0],
      sy = s[1],
      sz = s[2],

      ox = o[0],
      oy = o[1],
      oz = o[2];

  out[0] = (1 - (yy + zz)) * sx;
  out[1] = (xy + wz) * sx;
  out[2] = (xz - wy) * sx;
  out[3] = 0;
  out[4] = (xy - wz) * sy;
  out[5] = (1 - (xx + zz)) * sy;
  out[6] = (yz + wx) * sy;
  out[7] = 0;
  out[8] = (xz + wy) * sz;
  out[9] = (yz - wx) * sz;
  out[10] = (1 - (xx + yy)) * sz;
  out[11] = 0;
  out[12] = v[0] + ox - (out[0] * ox + out[4] * oy + out[8] * oz);
  out[13] = v[1] + oy - (out[1] * ox + out[5] * oy + out[9] * oz);
  out[14] = v[2] + oz - (out[2] * ox + out[6] * oy + out[10] * oz);
  out[15] = 1;

  return out;
};

/**
 * Calculates a 4x4 matrix from the given quaternion
 *
 * @param {mat4} out mat4 receiving operation result
 * @param {quat} q Quaternion to create matrix from
 *
 * @returns {mat4} out
 */
mat4.fromQuat = function (out, q) {
    var x = q[0], y = q[1], z = q[2], w = q[3],
        x2 = x + x,
        y2 = y + y,
        z2 = z + z,

        xx = x * x2,
        yx = y * x2,
        yy = y * y2,
        zx = z * x2,
        zy = z * y2,
        zz = z * z2,
        wx = w * x2,
        wy = w * y2,
        wz = w * z2;

    out[0] = 1 - yy - zz;
    out[1] = yx + wz;
    out[2] = zx - wy;
    out[3] = 0;

    out[4] = yx - wz;
    out[5] = 1 - xx - zz;
    out[6] = zy + wx;
    out[7] = 0;

    out[8] = zx + wy;
    out[9] = zy - wx;
    out[10] = 1 - xx - yy;
    out[11] = 0;

    out[12] = 0;
    out[13] = 0;
    out[14] = 0;
    out[15] = 1;

    return out;
};

/**
 * Generates a frustum matrix with the given bounds
 *
 * @param {mat4} out mat4 frustum matrix will be written into
 * @param {Number} left Left bound of the frustum
 * @param {Number} right Right bound of the frustum
 * @param {Number} bottom Bottom bound of the frustum
 * @param {Number} top Top bound of the frustum
 * @param {Number} near Near bound of the frustum
 * @param {Number} far Far bound of the frustum
 * @returns {mat4} out
 */
mat4.frustum = function (out, left, right, bottom, top, near, far) {
    var rl = 1 / (right - left),
        tb = 1 / (top - bottom),
        nf = 1 / (near - far);
    out[0] = (near * 2) * rl;
    out[1] = 0;
    out[2] = 0;
    out[3] = 0;
    out[4] = 0;
    out[5] = (near * 2) * tb;
    out[6] = 0;
    out[7] = 0;
    out[8] = (right + left) * rl;
    out[9] = (top + bottom) * tb;
    out[10] = (far + near) * nf;
    out[11] = -1;
    out[12] = 0;
    out[13] = 0;
    out[14] = (far * near * 2) * nf;
    out[15] = 0;
    return out;
};

/**
 * Generates a perspective projection matrix with the given bounds
 *
 * @param {mat4} out mat4 frustum matrix will be written into
 * @param {number} fovy Vertical field of view in radians
 * @param {number} aspect Aspect ratio. typically viewport width/height
 * @param {number} near Near bound of the frustum
 * @param {number} far Far bound of the frustum
 * @returns {mat4} out
 */
mat4.perspective = function (out, fovy, aspect, near, far) {
    var f = 1.0 / Math.tan(fovy / 2),
        nf = 1 / (near - far);
    out[0] = f / aspect;
    out[1] = 0;
    out[2] = 0;
    out[3] = 0;
    out[4] = 0;
    out[5] = f;
    out[6] = 0;
    out[7] = 0;
    out[8] = 0;
    out[9] = 0;
    out[10] = (far + near) * nf;
    out[11] = -1;
    out[12] = 0;
    out[13] = 0;
    out[14] = (2 * far * near) * nf;
    out[15] = 0;
    return out;
};

/**
 * Generates a perspective projection matrix with the given field of view.
 * This is primarily useful for generating projection matrices to be used
 * with the still experiemental WebVR API.
 *
 * @param {mat4} out mat4 frustum matrix will be written into
 * @param {Object} fov Object containing the following values: upDegrees, downDegrees, leftDegrees, rightDegrees
 * @param {number} near Near bound of the frustum
 * @param {number} far Far bound of the frustum
 * @returns {mat4} out
 */
mat4.perspectiveFromFieldOfView = function (out, fov, near, far) {
    var upTan = Math.tan(fov.upDegrees * Math.PI/180.0),
        downTan = Math.tan(fov.downDegrees * Math.PI/180.0),
        leftTan = Math.tan(fov.leftDegrees * Math.PI/180.0),
        rightTan = Math.tan(fov.rightDegrees * Math.PI/180.0),
        xScale = 2.0 / (leftTan + rightTan),
        yScale = 2.0 / (upTan + downTan);

    out[0] = xScale;
    out[1] = 0.0;
    out[2] = 0.0;
    out[3] = 0.0;
    out[4] = 0.0;
    out[5] = yScale;
    out[6] = 0.0;
    out[7] = 0.0;
    out[8] = -((leftTan - rightTan) * xScale * 0.5);
    out[9] = ((upTan - downTan) * yScale * 0.5);
    out[10] = far / (near - far);
    out[11] = -1.0;
    out[12] = 0.0;
    out[13] = 0.0;
    out[14] = (far * near) / (near - far);
    out[15] = 0.0;
    return out;
}

/**
 * Generates a orthogonal projection matrix with the given bounds
 *
 * @param {mat4} out mat4 frustum matrix will be written into
 * @param {number} left Left bound of the frustum
 * @param {number} right Right bound of the frustum
 * @param {number} bottom Bottom bound of the frustum
 * @param {number} top Top bound of the frustum
 * @param {number} near Near bound of the frustum
 * @param {number} far Far bound of the frustum
 * @returns {mat4} out
 */
mat4.ortho = function (out, left, right, bottom, top, near, far) {
    var lr = 1 / (left - right),
        bt = 1 / (bottom - top),
        nf = 1 / (near - far);
    out[0] = -2 * lr;
    out[1] = 0;
    out[2] = 0;
    out[3] = 0;
    out[4] = 0;
    out[5] = -2 * bt;
    out[6] = 0;
    out[7] = 0;
    out[8] = 0;
    out[9] = 0;
    out[10] = 2 * nf;
    out[11] = 0;
    out[12] = (left + right) * lr;
    out[13] = (top + bottom) * bt;
    out[14] = (far + near) * nf;
    out[15] = 1;
    return out;
};

/**
 * Generates a look-at matrix with the given eye position, focal point, and up axis
 *
 * @param {mat4} out mat4 frustum matrix will be written into
 * @param {vec3} eye Position of the viewer
 * @param {vec3} center Point the viewer is looking at
 * @param {vec3} up vec3 pointing up
 * @returns {mat4} out
 */
mat4.lookAt = function (out, eye, center, up) {
    var x0, x1, x2, y0, y1, y2, z0, z1, z2, len,
        eyex = eye[0],
        eyey = eye[1],
        eyez = eye[2],
        upx = up[0],
        upy = up[1],
        upz = up[2],
        centerx = center[0],
        centery = center[1],
        centerz = center[2];

    if (Math.abs(eyex - centerx) < glMatrix.EPSILON &&
        Math.abs(eyey - centery) < glMatrix.EPSILON &&
        Math.abs(eyez - centerz) < glMatrix.EPSILON) {
        return mat4.identity(out);
    }

    z0 = eyex - centerx;
    z1 = eyey - centery;
    z2 = eyez - centerz;

    len = 1 / Math.sqrt(z0 * z0 + z1 * z1 + z2 * z2);
    z0 *= len;
    z1 *= len;
    z2 *= len;

    x0 = upy * z2 - upz * z1;
    x1 = upz * z0 - upx * z2;
    x2 = upx * z1 - upy * z0;
    len = Math.sqrt(x0 * x0 + x1 * x1 + x2 * x2);
    if (!len) {
        x0 = 0;
        x1 = 0;
        x2 = 0;
    } else {
        len = 1 / len;
        x0 *= len;
        x1 *= len;
        x2 *= len;
    }

    y0 = z1 * x2 - z2 * x1;
    y1 = z2 * x0 - z0 * x2;
    y2 = z0 * x1 - z1 * x0;

    len = Math.sqrt(y0 * y0 + y1 * y1 + y2 * y2);
    if (!len) {
        y0 = 0;
        y1 = 0;
        y2 = 0;
    } else {
        len = 1 / len;
        y0 *= len;
        y1 *= len;
        y2 *= len;
    }

    out[0] = x0;
    out[1] = y0;
    out[2] = z0;
    out[3] = 0;
    out[4] = x1;
    out[5] = y1;
    out[6] = z1;
    out[7] = 0;
    out[8] = x2;
    out[9] = y2;
    out[10] = z2;
    out[11] = 0;
    out[12] = -(x0 * eyex + x1 * eyey + x2 * eyez);
    out[13] = -(y0 * eyex + y1 * eyey + y2 * eyez);
    out[14] = -(z0 * eyex + z1 * eyey + z2 * eyez);
    out[15] = 1;

    return out;
};

/**
 * Returns a string representation of a mat4
 *
 * @param {mat4} mat matrix to represent as a string
 * @returns {String} string representation of the matrix
 */
mat4.str = function (a) {
    return 'mat4(' + a[0] + ', ' + a[1] + ', ' + a[2] + ', ' + a[3] + ', ' +
                    a[4] + ', ' + a[5] + ', ' + a[6] + ', ' + a[7] + ', ' +
                    a[8] + ', ' + a[9] + ', ' + a[10] + ', ' + a[11] + ', ' +
                    a[12] + ', ' + a[13] + ', ' + a[14] + ', ' + a[15] + ')';
};

/**
 * Returns Frobenius norm of a mat4
 *
 * @param {mat4} a the matrix to calculate Frobenius norm of
 * @returns {Number} Frobenius norm
 */
mat4.frob = function (a) {
    return(Math.sqrt(Math.pow(a[0], 2) + Math.pow(a[1], 2) + Math.pow(a[2], 2) + Math.pow(a[3], 2) + Math.pow(a[4], 2) + Math.pow(a[5], 2) + Math.pow(a[6], 2) + Math.pow(a[7], 2) + Math.pow(a[8], 2) + Math.pow(a[9], 2) + Math.pow(a[10], 2) + Math.pow(a[11], 2) + Math.pow(a[12], 2) + Math.pow(a[13], 2) + Math.pow(a[14], 2) + Math.pow(a[15], 2) ))
};

/**
 * Adds two mat4's
 *
 * @param {mat4} out the receiving matrix
 * @param {mat4} a the first operand
 * @param {mat4} b the second operand
 * @returns {mat4} out
 */
mat4.add = function(out, a, b) {
    out[0] = a[0] + b[0];
    out[1] = a[1] + b[1];
    out[2] = a[2] + b[2];
    out[3] = a[3] + b[3];
    out[4] = a[4] + b[4];
    out[5] = a[5] + b[5];
    out[6] = a[6] + b[6];
    out[7] = a[7] + b[7];
    out[8] = a[8] + b[8];
    out[9] = a[9] + b[9];
    out[10] = a[10] + b[10];
    out[11] = a[11] + b[11];
    out[12] = a[12] + b[12];
    out[13] = a[13] + b[13];
    out[14] = a[14] + b[14];
    out[15] = a[15] + b[15];
    return out;
};

/**
 * Subtracts matrix b from matrix a
 *
 * @param {mat4} out the receiving matrix
 * @param {mat4} a the first operand
 * @param {mat4} b the second operand
 * @returns {mat4} out
 */
mat4.subtract = function(out, a, b) {
    out[0] = a[0] - b[0];
    out[1] = a[1] - b[1];
    out[2] = a[2] - b[2];
    out[3] = a[3] - b[3];
    out[4] = a[4] - b[4];
    out[5] = a[5] - b[5];
    out[6] = a[6] - b[6];
    out[7] = a[7] - b[7];
    out[8] = a[8] - b[8];
    out[9] = a[9] - b[9];
    out[10] = a[10] - b[10];
    out[11] = a[11] - b[11];
    out[12] = a[12] - b[12];
    out[13] = a[13] - b[13];
    out[14] = a[14] - b[14];
    out[15] = a[15] - b[15];
    return out;
};

/**
 * Alias for {@link mat4.subtract}
 * @function
 */
mat4.sub = mat4.subtract;

/**
 * Multiply each element of the matrix by a scalar.
 *
 * @param {mat4} out the receiving matrix
 * @param {mat4} a the matrix to scale
 * @param {Number} b amount to scale the matrix's elements by
 * @returns {mat4} out
 */
mat4.multiplyScalar = function(out, a, b) {
    out[0] = a[0] * b;
    out[1] = a[1] * b;
    out[2] = a[2] * b;
    out[3] = a[3] * b;
    out[4] = a[4] * b;
    out[5] = a[5] * b;
    out[6] = a[6] * b;
    out[7] = a[7] * b;
    out[8] = a[8] * b;
    out[9] = a[9] * b;
    out[10] = a[10] * b;
    out[11] = a[11] * b;
    out[12] = a[12] * b;
    out[13] = a[13] * b;
    out[14] = a[14] * b;
    out[15] = a[15] * b;
    return out;
};

/**
 * Adds two mat4's after multiplying each element of the second operand by a scalar value.
 *
 * @param {mat4} out the receiving vector
 * @param {mat4} a the first operand
 * @param {mat4} b the second operand
 * @param {Number} scale the amount to scale b's elements by before adding
 * @returns {mat4} out
 */
mat4.multiplyScalarAndAdd = function(out, a, b, scale) {
    out[0] = a[0] + (b[0] * scale);
    out[1] = a[1] + (b[1] * scale);
    out[2] = a[2] + (b[2] * scale);
    out[3] = a[3] + (b[3] * scale);
    out[4] = a[4] + (b[4] * scale);
    out[5] = a[5] + (b[5] * scale);
    out[6] = a[6] + (b[6] * scale);
    out[7] = a[7] + (b[7] * scale);
    out[8] = a[8] + (b[8] * scale);
    out[9] = a[9] + (b[9] * scale);
    out[10] = a[10] + (b[10] * scale);
    out[11] = a[11] + (b[11] * scale);
    out[12] = a[12] + (b[12] * scale);
    out[13] = a[13] + (b[13] * scale);
    out[14] = a[14] + (b[14] * scale);
    out[15] = a[15] + (b[15] * scale);
    return out;
};

/**
 * Returns whether or not the matrices have exactly the same elements in the same position (when compared with ===)
 *
 * @param {mat4} a The first matrix.
 * @param {mat4} b The second matrix.
 * @returns {Boolean} True if the matrices are equal, false otherwise.
 */
mat4.exactEquals = function (a, b) {
    return a[0] === b[0] && a[1] === b[1] && a[2] === b[2] && a[3] === b[3] && 
           a[4] === b[4] && a[5] === b[5] && a[6] === b[6] && a[7] === b[7] && 
           a[8] === b[8] && a[9] === b[9] && a[10] === b[10] && a[11] === b[11] &&
           a[12] === b[12] && a[13] === b[13] && a[14] === b[14] && a[15] === b[15];
};

/**
 * Returns whether or not the matrices have approximately the same elements in the same position.
 *
 * @param {mat4} a The first matrix.
 * @param {mat4} b The second matrix.
 * @returns {Boolean} True if the matrices are equal, false otherwise.
 */
mat4.equals = function (a, b) {
    var a0  = a[0],  a1  = a[1],  a2  = a[2],  a3  = a[3],
        a4  = a[4],  a5  = a[5],  a6  = a[6],  a7  = a[7], 
        a8  = a[8],  a9  = a[9],  a10 = a[10], a11 = a[11], 
        a12 = a[12], a13 = a[13], a14 = a[14], a15 = a[15];

    var b0  = b[0],  b1  = b[1],  b2  = b[2],  b3  = b[3],
        b4  = b[4],  b5  = b[5],  b6  = b[6],  b7  = b[7], 
        b8  = b[8],  b9  = b[9],  b10 = b[10], b11 = b[11], 
        b12 = b[12], b13 = b[13], b14 = b[14], b15 = b[15];

    return (Math.abs(a0 - b0) <= glMatrix.EPSILON*Math.max(1.0, Math.abs(a0), Math.abs(b0)) &&
            Math.abs(a1 - b1) <= glMatrix.EPSILON*Math.max(1.0, Math.abs(a1), Math.abs(b1)) &&
            Math.abs(a2 - b2) <= glMatrix.EPSILON*Math.max(1.0, Math.abs(a2), Math.abs(b2)) &&
            Math.abs(a3 - b3) <= glMatrix.EPSILON*Math.max(1.0, Math.abs(a3), Math.abs(b3)) &&
            Math.abs(a4 - b4) <= glMatrix.EPSILON*Math.max(1.0, Math.abs(a4), Math.abs(b4)) &&
            Math.abs(a5 - b5) <= glMatrix.EPSILON*Math.max(1.0, Math.abs(a5), Math.abs(b5)) &&
            Math.abs(a6 - b6) <= glMatrix.EPSILON*Math.max(1.0, Math.abs(a6), Math.abs(b6)) &&
            Math.abs(a7 - b7) <= glMatrix.EPSILON*Math.max(1.0, Math.abs(a7), Math.abs(b7)) &&
            Math.abs(a8 - b8) <= glMatrix.EPSILON*Math.max(1.0, Math.abs(a8), Math.abs(b8)) &&
            Math.abs(a9 - b9) <= glMatrix.EPSILON*Math.max(1.0, Math.abs(a9), Math.abs(b9)) &&
            Math.abs(a10 - b10) <= glMatrix.EPSILON*Math.max(1.0, Math.abs(a10), Math.abs(b10)) &&
            Math.abs(a11 - b11) <= glMatrix.EPSILON*Math.max(1.0, Math.abs(a11), Math.abs(b11)) &&
            Math.abs(a12 - b12) <= glMatrix.EPSILON*Math.max(1.0, Math.abs(a12), Math.abs(b12)) &&
            Math.abs(a13 - b13) <= glMatrix.EPSILON*Math.max(1.0, Math.abs(a13), Math.abs(b13)) &&
            Math.abs(a14 - b14) <= glMatrix.EPSILON*Math.max(1.0, Math.abs(a14), Math.abs(b14)) &&
            Math.abs(a15 - b15) <= glMatrix.EPSILON*Math.max(1.0, Math.abs(a15), Math.abs(b15)));
};



module.exports = mat4;

},{"./common.js":8}],13:[function(require,module,exports){
/* Copyright (c) 2015, Brandon Jones, Colin MacKenzie IV.

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE. */

var glMatrix = require("./common.js");
var mat3 = require("./mat3.js");
var vec3 = require("./vec3.js");
var vec4 = require("./vec4.js");

/**
 * @class Quaternion
 * @name quat
 */
var quat = {};

/**
 * Creates a new identity quat
 *
 * @returns {quat} a new quaternion
 */
quat.create = function() {
    var out = new glMatrix.ARRAY_TYPE(4);
    out[0] = 0;
    out[1] = 0;
    out[2] = 0;
    out[3] = 1;
    return out;
};

/**
 * Sets a quaternion to represent the shortest rotation from one
 * vector to another.
 *
 * Both vectors are assumed to be unit length.
 *
 * @param {quat} out the receiving quaternion.
 * @param {vec3} a the initial vector
 * @param {vec3} b the destination vector
 * @returns {quat} out
 */
quat.rotationTo = (function() {
    var tmpvec3 = vec3.create();
    var xUnitVec3 = vec3.fromValues(1,0,0);
    var yUnitVec3 = vec3.fromValues(0,1,0);

    return function(out, a, b) {
        var dot = vec3.dot(a, b);
        if (dot < -0.999999) {
            vec3.cross(tmpvec3, xUnitVec3, a);
            if (vec3.length(tmpvec3) < 0.000001)
                vec3.cross(tmpvec3, yUnitVec3, a);
            vec3.normalize(tmpvec3, tmpvec3);
            quat.setAxisAngle(out, tmpvec3, Math.PI);
            return out;
        } else if (dot > 0.999999) {
            out[0] = 0;
            out[1] = 0;
            out[2] = 0;
            out[3] = 1;
            return out;
        } else {
            vec3.cross(tmpvec3, a, b);
            out[0] = tmpvec3[0];
            out[1] = tmpvec3[1];
            out[2] = tmpvec3[2];
            out[3] = 1 + dot;
            return quat.normalize(out, out);
        }
    };
})();

/**
 * Sets the specified quaternion with values corresponding to the given
 * axes. Each axis is a vec3 and is expected to be unit length and
 * perpendicular to all other specified axes.
 *
 * @param {vec3} view  the vector representing the viewing direction
 * @param {vec3} right the vector representing the local "right" direction
 * @param {vec3} up    the vector representing the local "up" direction
 * @returns {quat} out
 */
quat.setAxes = (function() {
    var matr = mat3.create();

    return function(out, view, right, up) {
        matr[0] = right[0];
        matr[3] = right[1];
        matr[6] = right[2];

        matr[1] = up[0];
        matr[4] = up[1];
        matr[7] = up[2];

        matr[2] = -view[0];
        matr[5] = -view[1];
        matr[8] = -view[2];

        return quat.normalize(out, quat.fromMat3(out, matr));
    };
})();

/**
 * Creates a new quat initialized with values from an existing quaternion
 *
 * @param {quat} a quaternion to clone
 * @returns {quat} a new quaternion
 * @function
 */
quat.clone = vec4.clone;

/**
 * Creates a new quat initialized with the given values
 *
 * @param {Number} x X component
 * @param {Number} y Y component
 * @param {Number} z Z component
 * @param {Number} w W component
 * @returns {quat} a new quaternion
 * @function
 */
quat.fromValues = vec4.fromValues;

/**
 * Copy the values from one quat to another
 *
 * @param {quat} out the receiving quaternion
 * @param {quat} a the source quaternion
 * @returns {quat} out
 * @function
 */
quat.copy = vec4.copy;

/**
 * Set the components of a quat to the given values
 *
 * @param {quat} out the receiving quaternion
 * @param {Number} x X component
 * @param {Number} y Y component
 * @param {Number} z Z component
 * @param {Number} w W component
 * @returns {quat} out
 * @function
 */
quat.set = vec4.set;

/**
 * Set a quat to the identity quaternion
 *
 * @param {quat} out the receiving quaternion
 * @returns {quat} out
 */
quat.identity = function(out) {
    out[0] = 0;
    out[1] = 0;
    out[2] = 0;
    out[3] = 1;
    return out;
};

/**
 * Sets a quat from the given angle and rotation axis,
 * then returns it.
 *
 * @param {quat} out the receiving quaternion
 * @param {vec3} axis the axis around which to rotate
 * @param {Number} rad the angle in radians
 * @returns {quat} out
 **/
quat.setAxisAngle = function(out, axis, rad) {
    rad = rad * 0.5;
    var s = Math.sin(rad);
    out[0] = s * axis[0];
    out[1] = s * axis[1];
    out[2] = s * axis[2];
    out[3] = Math.cos(rad);
    return out;
};

/**
 * Gets the rotation axis and angle for a given
 *  quaternion. If a quaternion is created with
 *  setAxisAngle, this method will return the same
 *  values as providied in the original parameter list
 *  OR functionally equivalent values.
 * Example: The quaternion formed by axis [0, 0, 1] and
 *  angle -90 is the same as the quaternion formed by
 *  [0, 0, 1] and 270. This method favors the latter.
 * @param  {vec3} out_axis  Vector receiving the axis of rotation
 * @param  {quat} q     Quaternion to be decomposed
 * @return {Number}     Angle, in radians, of the rotation
 */
quat.getAxisAngle = function(out_axis, q) {
    var rad = Math.acos(q[3]) * 2.0;
    var s = Math.sin(rad / 2.0);
    if (s != 0.0) {
        out_axis[0] = q[0] / s;
        out_axis[1] = q[1] / s;
        out_axis[2] = q[2] / s;
    } else {
        // If s is zero, return any axis (no rotation - axis does not matter)
        out_axis[0] = 1;
        out_axis[1] = 0;
        out_axis[2] = 0;
    }
    return rad;
};

/**
 * Adds two quat's
 *
 * @param {quat} out the receiving quaternion
 * @param {quat} a the first operand
 * @param {quat} b the second operand
 * @returns {quat} out
 * @function
 */
quat.add = vec4.add;

/**
 * Multiplies two quat's
 *
 * @param {quat} out the receiving quaternion
 * @param {quat} a the first operand
 * @param {quat} b the second operand
 * @returns {quat} out
 */
quat.multiply = function(out, a, b) {
    var ax = a[0], ay = a[1], az = a[2], aw = a[3],
        bx = b[0], by = b[1], bz = b[2], bw = b[3];

    out[0] = ax * bw + aw * bx + ay * bz - az * by;
    out[1] = ay * bw + aw * by + az * bx - ax * bz;
    out[2] = az * bw + aw * bz + ax * by - ay * bx;
    out[3] = aw * bw - ax * bx - ay * by - az * bz;
    return out;
};

/**
 * Alias for {@link quat.multiply}
 * @function
 */
quat.mul = quat.multiply;

/**
 * Scales a quat by a scalar number
 *
 * @param {quat} out the receiving vector
 * @param {quat} a the vector to scale
 * @param {Number} b amount to scale the vector by
 * @returns {quat} out
 * @function
 */
quat.scale = vec4.scale;

/**
 * Rotates a quaternion by the given angle about the X axis
 *
 * @param {quat} out quat receiving operation result
 * @param {quat} a quat to rotate
 * @param {number} rad angle (in radians) to rotate
 * @returns {quat} out
 */
quat.rotateX = function (out, a, rad) {
    rad *= 0.5; 

    var ax = a[0], ay = a[1], az = a[2], aw = a[3],
        bx = Math.sin(rad), bw = Math.cos(rad);

    out[0] = ax * bw + aw * bx;
    out[1] = ay * bw + az * bx;
    out[2] = az * bw - ay * bx;
    out[3] = aw * bw - ax * bx;
    return out;
};

/**
 * Rotates a quaternion by the given angle about the Y axis
 *
 * @param {quat} out quat receiving operation result
 * @param {quat} a quat to rotate
 * @param {number} rad angle (in radians) to rotate
 * @returns {quat} out
 */
quat.rotateY = function (out, a, rad) {
    rad *= 0.5; 

    var ax = a[0], ay = a[1], az = a[2], aw = a[3],
        by = Math.sin(rad), bw = Math.cos(rad);

    out[0] = ax * bw - az * by;
    out[1] = ay * bw + aw * by;
    out[2] = az * bw + ax * by;
    out[3] = aw * bw - ay * by;
    return out;
};

/**
 * Rotates a quaternion by the given angle about the Z axis
 *
 * @param {quat} out quat receiving operation result
 * @param {quat} a quat to rotate
 * @param {number} rad angle (in radians) to rotate
 * @returns {quat} out
 */
quat.rotateZ = function (out, a, rad) {
    rad *= 0.5; 

    var ax = a[0], ay = a[1], az = a[2], aw = a[3],
        bz = Math.sin(rad), bw = Math.cos(rad);

    out[0] = ax * bw + ay * bz;
    out[1] = ay * bw - ax * bz;
    out[2] = az * bw + aw * bz;
    out[3] = aw * bw - az * bz;
    return out;
};

/**
 * Calculates the W component of a quat from the X, Y, and Z components.
 * Assumes that quaternion is 1 unit in length.
 * Any existing W component will be ignored.
 *
 * @param {quat} out the receiving quaternion
 * @param {quat} a quat to calculate W component of
 * @returns {quat} out
 */
quat.calculateW = function (out, a) {
    var x = a[0], y = a[1], z = a[2];

    out[0] = x;
    out[1] = y;
    out[2] = z;
    out[3] = Math.sqrt(Math.abs(1.0 - x * x - y * y - z * z));
    return out;
};

/**
 * Calculates the dot product of two quat's
 *
 * @param {quat} a the first operand
 * @param {quat} b the second operand
 * @returns {Number} dot product of a and b
 * @function
 */
quat.dot = vec4.dot;

/**
 * Performs a linear interpolation between two quat's
 *
 * @param {quat} out the receiving quaternion
 * @param {quat} a the first operand
 * @param {quat} b the second operand
 * @param {Number} t interpolation amount between the two inputs
 * @returns {quat} out
 * @function
 */
quat.lerp = vec4.lerp;

/**
 * Performs a spherical linear interpolation between two quat
 *
 * @param {quat} out the receiving quaternion
 * @param {quat} a the first operand
 * @param {quat} b the second operand
 * @param {Number} t interpolation amount between the two inputs
 * @returns {quat} out
 */
quat.slerp = function (out, a, b, t) {
    // benchmarks:
    //    http://jsperf.com/quaternion-slerp-implementations

    var ax = a[0], ay = a[1], az = a[2], aw = a[3],
        bx = b[0], by = b[1], bz = b[2], bw = b[3];

    var        omega, cosom, sinom, scale0, scale1;

    // calc cosine
    cosom = ax * bx + ay * by + az * bz + aw * bw;
    // adjust signs (if necessary)
    if ( cosom < 0.0 ) {
        cosom = -cosom;
        bx = - bx;
        by = - by;
        bz = - bz;
        bw = - bw;
    }
    // calculate coefficients
    if ( (1.0 - cosom) > 0.000001 ) {
        // standard case (slerp)
        omega  = Math.acos(cosom);
        sinom  = Math.sin(omega);
        scale0 = Math.sin((1.0 - t) * omega) / sinom;
        scale1 = Math.sin(t * omega) / sinom;
    } else {        
        // "from" and "to" quaternions are very close 
        //  ... so we can do a linear interpolation
        scale0 = 1.0 - t;
        scale1 = t;
    }
    // calculate final values
    out[0] = scale0 * ax + scale1 * bx;
    out[1] = scale0 * ay + scale1 * by;
    out[2] = scale0 * az + scale1 * bz;
    out[3] = scale0 * aw + scale1 * bw;
    
    return out;
};

/**
 * Performs a spherical linear interpolation with two control points
 *
 * @param {quat} out the receiving quaternion
 * @param {quat} a the first operand
 * @param {quat} b the second operand
 * @param {quat} c the third operand
 * @param {quat} d the fourth operand
 * @param {Number} t interpolation amount
 * @returns {quat} out
 */
quat.sqlerp = (function () {
  var temp1 = quat.create();
  var temp2 = quat.create();
  
  return function (out, a, b, c, d, t) {
    quat.slerp(temp1, a, d, t);
    quat.slerp(temp2, b, c, t);
    quat.slerp(out, temp1, temp2, 2 * t * (1 - t));
    
    return out;
  };
}());

/**
 * Calculates the inverse of a quat
 *
 * @param {quat} out the receiving quaternion
 * @param {quat} a quat to calculate inverse of
 * @returns {quat} out
 */
quat.invert = function(out, a) {
    var a0 = a[0], a1 = a[1], a2 = a[2], a3 = a[3],
        dot = a0*a0 + a1*a1 + a2*a2 + a3*a3,
        invDot = dot ? 1.0/dot : 0;
    
    // TODO: Would be faster to return [0,0,0,0] immediately if dot == 0

    out[0] = -a0*invDot;
    out[1] = -a1*invDot;
    out[2] = -a2*invDot;
    out[3] = a3*invDot;
    return out;
};

/**
 * Calculates the conjugate of a quat
 * If the quaternion is normalized, this function is faster than quat.inverse and produces the same result.
 *
 * @param {quat} out the receiving quaternion
 * @param {quat} a quat to calculate conjugate of
 * @returns {quat} out
 */
quat.conjugate = function (out, a) {
    out[0] = -a[0];
    out[1] = -a[1];
    out[2] = -a[2];
    out[3] = a[3];
    return out;
};

/**
 * Calculates the length of a quat
 *
 * @param {quat} a vector to calculate length of
 * @returns {Number} length of a
 * @function
 */
quat.length = vec4.length;

/**
 * Alias for {@link quat.length}
 * @function
 */
quat.len = quat.length;

/**
 * Calculates the squared length of a quat
 *
 * @param {quat} a vector to calculate squared length of
 * @returns {Number} squared length of a
 * @function
 */
quat.squaredLength = vec4.squaredLength;

/**
 * Alias for {@link quat.squaredLength}
 * @function
 */
quat.sqrLen = quat.squaredLength;

/**
 * Normalize a quat
 *
 * @param {quat} out the receiving quaternion
 * @param {quat} a quaternion to normalize
 * @returns {quat} out
 * @function
 */
quat.normalize = vec4.normalize;

/**
 * Creates a quaternion from the given 3x3 rotation matrix.
 *
 * NOTE: The resultant quaternion is not normalized, so you should be sure
 * to renormalize the quaternion yourself where necessary.
 *
 * @param {quat} out the receiving quaternion
 * @param {mat3} m rotation matrix
 * @returns {quat} out
 * @function
 */
quat.fromMat3 = function(out, m) {
    // Algorithm in Ken Shoemake's article in 1987 SIGGRAPH course notes
    // article "Quaternion Calculus and Fast Animation".
    var fTrace = m[0] + m[4] + m[8];
    var fRoot;

    if ( fTrace > 0.0 ) {
        // |w| > 1/2, may as well choose w > 1/2
        fRoot = Math.sqrt(fTrace + 1.0);  // 2w
        out[3] = 0.5 * fRoot;
        fRoot = 0.5/fRoot;  // 1/(4w)
        out[0] = (m[5]-m[7])*fRoot;
        out[1] = (m[6]-m[2])*fRoot;
        out[2] = (m[1]-m[3])*fRoot;
    } else {
        // |w| <= 1/2
        var i = 0;
        if ( m[4] > m[0] )
          i = 1;
        if ( m[8] > m[i*3+i] )
          i = 2;
        var j = (i+1)%3;
        var k = (i+2)%3;
        
        fRoot = Math.sqrt(m[i*3+i]-m[j*3+j]-m[k*3+k] + 1.0);
        out[i] = 0.5 * fRoot;
        fRoot = 0.5 / fRoot;
        out[3] = (m[j*3+k] - m[k*3+j]) * fRoot;
        out[j] = (m[j*3+i] + m[i*3+j]) * fRoot;
        out[k] = (m[k*3+i] + m[i*3+k]) * fRoot;
    }
    
    return out;
};

/**
 * Returns a string representation of a quatenion
 *
 * @param {quat} vec vector to represent as a string
 * @returns {String} string representation of the vector
 */
quat.str = function (a) {
    return 'quat(' + a[0] + ', ' + a[1] + ', ' + a[2] + ', ' + a[3] + ')';
};

/**
 * Returns whether or not the quaternions have exactly the same elements in the same position (when compared with ===)
 *
 * @param {quat} a The first quaternion.
 * @param {quat} b The second quaternion.
 * @returns {Boolean} True if the vectors are equal, false otherwise.
 */
quat.exactEquals = vec4.exactEquals;

/**
 * Returns whether or not the quaternions have approximately the same elements in the same position.
 *
 * @param {quat} a The first vector.
 * @param {quat} b The second vector.
 * @returns {Boolean} True if the vectors are equal, false otherwise.
 */
quat.equals = vec4.equals;

module.exports = quat;

},{"./common.js":8,"./mat3.js":11,"./vec3.js":15,"./vec4.js":16}],14:[function(require,module,exports){
/* Copyright (c) 2015, Brandon Jones, Colin MacKenzie IV.

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE. */

var glMatrix = require("./common.js");

/**
 * @class 2 Dimensional Vector
 * @name vec2
 */
var vec2 = {};

/**
 * Creates a new, empty vec2
 *
 * @returns {vec2} a new 2D vector
 */
vec2.create = function() {
    var out = new glMatrix.ARRAY_TYPE(2);
    out[0] = 0;
    out[1] = 0;
    return out;
};

/**
 * Creates a new vec2 initialized with values from an existing vector
 *
 * @param {vec2} a vector to clone
 * @returns {vec2} a new 2D vector
 */
vec2.clone = function(a) {
    var out = new glMatrix.ARRAY_TYPE(2);
    out[0] = a[0];
    out[1] = a[1];
    return out;
};

/**
 * Creates a new vec2 initialized with the given values
 *
 * @param {Number} x X component
 * @param {Number} y Y component
 * @returns {vec2} a new 2D vector
 */
vec2.fromValues = function(x, y) {
    var out = new glMatrix.ARRAY_TYPE(2);
    out[0] = x;
    out[1] = y;
    return out;
};

/**
 * Copy the values from one vec2 to another
 *
 * @param {vec2} out the receiving vector
 * @param {vec2} a the source vector
 * @returns {vec2} out
 */
vec2.copy = function(out, a) {
    out[0] = a[0];
    out[1] = a[1];
    return out;
};

/**
 * Set the components of a vec2 to the given values
 *
 * @param {vec2} out the receiving vector
 * @param {Number} x X component
 * @param {Number} y Y component
 * @returns {vec2} out
 */
vec2.set = function(out, x, y) {
    out[0] = x;
    out[1] = y;
    return out;
};

/**
 * Adds two vec2's
 *
 * @param {vec2} out the receiving vector
 * @param {vec2} a the first operand
 * @param {vec2} b the second operand
 * @returns {vec2} out
 */
vec2.add = function(out, a, b) {
    out[0] = a[0] + b[0];
    out[1] = a[1] + b[1];
    return out;
};

/**
 * Subtracts vector b from vector a
 *
 * @param {vec2} out the receiving vector
 * @param {vec2} a the first operand
 * @param {vec2} b the second operand
 * @returns {vec2} out
 */
vec2.subtract = function(out, a, b) {
    out[0] = a[0] - b[0];
    out[1] = a[1] - b[1];
    return out;
};

/**
 * Alias for {@link vec2.subtract}
 * @function
 */
vec2.sub = vec2.subtract;

/**
 * Multiplies two vec2's
 *
 * @param {vec2} out the receiving vector
 * @param {vec2} a the first operand
 * @param {vec2} b the second operand
 * @returns {vec2} out
 */
vec2.multiply = function(out, a, b) {
    out[0] = a[0] * b[0];
    out[1] = a[1] * b[1];
    return out;
};

/**
 * Alias for {@link vec2.multiply}
 * @function
 */
vec2.mul = vec2.multiply;

/**
 * Divides two vec2's
 *
 * @param {vec2} out the receiving vector
 * @param {vec2} a the first operand
 * @param {vec2} b the second operand
 * @returns {vec2} out
 */
vec2.divide = function(out, a, b) {
    out[0] = a[0] / b[0];
    out[1] = a[1] / b[1];
    return out;
};

/**
 * Alias for {@link vec2.divide}
 * @function
 */
vec2.div = vec2.divide;

/**
 * Math.ceil the components of a vec2
 *
 * @param {vec2} out the receiving vector
 * @param {vec2} a vector to ceil
 * @returns {vec2} out
 */
vec2.ceil = function (out, a) {
    out[0] = Math.ceil(a[0]);
    out[1] = Math.ceil(a[1]);
    return out;
};

/**
 * Math.floor the components of a vec2
 *
 * @param {vec2} out the receiving vector
 * @param {vec2} a vector to floor
 * @returns {vec2} out
 */
vec2.floor = function (out, a) {
    out[0] = Math.floor(a[0]);
    out[1] = Math.floor(a[1]);
    return out;
};

/**
 * Returns the minimum of two vec2's
 *
 * @param {vec2} out the receiving vector
 * @param {vec2} a the first operand
 * @param {vec2} b the second operand
 * @returns {vec2} out
 */
vec2.min = function(out, a, b) {
    out[0] = Math.min(a[0], b[0]);
    out[1] = Math.min(a[1], b[1]);
    return out;
};

/**
 * Returns the maximum of two vec2's
 *
 * @param {vec2} out the receiving vector
 * @param {vec2} a the first operand
 * @param {vec2} b the second operand
 * @returns {vec2} out
 */
vec2.max = function(out, a, b) {
    out[0] = Math.max(a[0], b[0]);
    out[1] = Math.max(a[1], b[1]);
    return out;
};

/**
 * Math.round the components of a vec2
 *
 * @param {vec2} out the receiving vector
 * @param {vec2} a vector to round
 * @returns {vec2} out
 */
vec2.round = function (out, a) {
    out[0] = Math.round(a[0]);
    out[1] = Math.round(a[1]);
    return out;
};

/**
 * Scales a vec2 by a scalar number
 *
 * @param {vec2} out the receiving vector
 * @param {vec2} a the vector to scale
 * @param {Number} b amount to scale the vector by
 * @returns {vec2} out
 */
vec2.scale = function(out, a, b) {
    out[0] = a[0] * b;
    out[1] = a[1] * b;
    return out;
};

/**
 * Adds two vec2's after scaling the second operand by a scalar value
 *
 * @param {vec2} out the receiving vector
 * @param {vec2} a the first operand
 * @param {vec2} b the second operand
 * @param {Number} scale the amount to scale b by before adding
 * @returns {vec2} out
 */
vec2.scaleAndAdd = function(out, a, b, scale) {
    out[0] = a[0] + (b[0] * scale);
    out[1] = a[1] + (b[1] * scale);
    return out;
};

/**
 * Calculates the euclidian distance between two vec2's
 *
 * @param {vec2} a the first operand
 * @param {vec2} b the second operand
 * @returns {Number} distance between a and b
 */
vec2.distance = function(a, b) {
    var x = b[0] - a[0],
        y = b[1] - a[1];
    return Math.sqrt(x*x + y*y);
};

/**
 * Alias for {@link vec2.distance}
 * @function
 */
vec2.dist = vec2.distance;

/**
 * Calculates the squared euclidian distance between two vec2's
 *
 * @param {vec2} a the first operand
 * @param {vec2} b the second operand
 * @returns {Number} squared distance between a and b
 */
vec2.squaredDistance = function(a, b) {
    var x = b[0] - a[0],
        y = b[1] - a[1];
    return x*x + y*y;
};

/**
 * Alias for {@link vec2.squaredDistance}
 * @function
 */
vec2.sqrDist = vec2.squaredDistance;

/**
 * Calculates the length of a vec2
 *
 * @param {vec2} a vector to calculate length of
 * @returns {Number} length of a
 */
vec2.length = function (a) {
    var x = a[0],
        y = a[1];
    return Math.sqrt(x*x + y*y);
};

/**
 * Alias for {@link vec2.length}
 * @function
 */
vec2.len = vec2.length;

/**
 * Calculates the squared length of a vec2
 *
 * @param {vec2} a vector to calculate squared length of
 * @returns {Number} squared length of a
 */
vec2.squaredLength = function (a) {
    var x = a[0],
        y = a[1];
    return x*x + y*y;
};

/**
 * Alias for {@link vec2.squaredLength}
 * @function
 */
vec2.sqrLen = vec2.squaredLength;

/**
 * Negates the components of a vec2
 *
 * @param {vec2} out the receiving vector
 * @param {vec2} a vector to negate
 * @returns {vec2} out
 */
vec2.negate = function(out, a) {
    out[0] = -a[0];
    out[1] = -a[1];
    return out;
};

/**
 * Returns the inverse of the components of a vec2
 *
 * @param {vec2} out the receiving vector
 * @param {vec2} a vector to invert
 * @returns {vec2} out
 */
vec2.inverse = function(out, a) {
  out[0] = 1.0 / a[0];
  out[1] = 1.0 / a[1];
  return out;
};

/**
 * Normalize a vec2
 *
 * @param {vec2} out the receiving vector
 * @param {vec2} a vector to normalize
 * @returns {vec2} out
 */
vec2.normalize = function(out, a) {
    var x = a[0],
        y = a[1];
    var len = x*x + y*y;
    if (len > 0) {
        //TODO: evaluate use of glm_invsqrt here?
        len = 1 / Math.sqrt(len);
        out[0] = a[0] * len;
        out[1] = a[1] * len;
    }
    return out;
};

/**
 * Calculates the dot product of two vec2's
 *
 * @param {vec2} a the first operand
 * @param {vec2} b the second operand
 * @returns {Number} dot product of a and b
 */
vec2.dot = function (a, b) {
    return a[0] * b[0] + a[1] * b[1];
};

/**
 * Computes the cross product of two vec2's
 * Note that the cross product must by definition produce a 3D vector
 *
 * @param {vec3} out the receiving vector
 * @param {vec2} a the first operand
 * @param {vec2} b the second operand
 * @returns {vec3} out
 */
vec2.cross = function(out, a, b) {
    var z = a[0] * b[1] - a[1] * b[0];
    out[0] = out[1] = 0;
    out[2] = z;
    return out;
};

/**
 * Performs a linear interpolation between two vec2's
 *
 * @param {vec2} out the receiving vector
 * @param {vec2} a the first operand
 * @param {vec2} b the second operand
 * @param {Number} t interpolation amount between the two inputs
 * @returns {vec2} out
 */
vec2.lerp = function (out, a, b, t) {
    var ax = a[0],
        ay = a[1];
    out[0] = ax + t * (b[0] - ax);
    out[1] = ay + t * (b[1] - ay);
    return out;
};

/**
 * Generates a random vector with the given scale
 *
 * @param {vec2} out the receiving vector
 * @param {Number} [scale] Length of the resulting vector. If ommitted, a unit vector will be returned
 * @returns {vec2} out
 */
vec2.random = function (out, scale) {
    scale = scale || 1.0;
    var r = glMatrix.RANDOM() * 2.0 * Math.PI;
    out[0] = Math.cos(r) * scale;
    out[1] = Math.sin(r) * scale;
    return out;
};

/**
 * Transforms the vec2 with a mat2
 *
 * @param {vec2} out the receiving vector
 * @param {vec2} a the vector to transform
 * @param {mat2} m matrix to transform with
 * @returns {vec2} out
 */
vec2.transformMat2 = function(out, a, m) {
    var x = a[0],
        y = a[1];
    out[0] = m[0] * x + m[2] * y;
    out[1] = m[1] * x + m[3] * y;
    return out;
};

/**
 * Transforms the vec2 with a mat2d
 *
 * @param {vec2} out the receiving vector
 * @param {vec2} a the vector to transform
 * @param {mat2d} m matrix to transform with
 * @returns {vec2} out
 */
vec2.transformMat2d = function(out, a, m) {
    var x = a[0],
        y = a[1];
    out[0] = m[0] * x + m[2] * y + m[4];
    out[1] = m[1] * x + m[3] * y + m[5];
    return out;
};

/**
 * Transforms the vec2 with a mat3
 * 3rd vector component is implicitly '1'
 *
 * @param {vec2} out the receiving vector
 * @param {vec2} a the vector to transform
 * @param {mat3} m matrix to transform with
 * @returns {vec2} out
 */
vec2.transformMat3 = function(out, a, m) {
    var x = a[0],
        y = a[1];
    out[0] = m[0] * x + m[3] * y + m[6];
    out[1] = m[1] * x + m[4] * y + m[7];
    return out;
};

/**
 * Transforms the vec2 with a mat4
 * 3rd vector component is implicitly '0'
 * 4th vector component is implicitly '1'
 *
 * @param {vec2} out the receiving vector
 * @param {vec2} a the vector to transform
 * @param {mat4} m matrix to transform with
 * @returns {vec2} out
 */
vec2.transformMat4 = function(out, a, m) {
    var x = a[0], 
        y = a[1];
    out[0] = m[0] * x + m[4] * y + m[12];
    out[1] = m[1] * x + m[5] * y + m[13];
    return out;
};

/**
 * Perform some operation over an array of vec2s.
 *
 * @param {Array} a the array of vectors to iterate over
 * @param {Number} stride Number of elements between the start of each vec2. If 0 assumes tightly packed
 * @param {Number} offset Number of elements to skip at the beginning of the array
 * @param {Number} count Number of vec2s to iterate over. If 0 iterates over entire array
 * @param {Function} fn Function to call for each vector in the array
 * @param {Object} [arg] additional argument to pass to fn
 * @returns {Array} a
 * @function
 */
vec2.forEach = (function() {
    var vec = vec2.create();

    return function(a, stride, offset, count, fn, arg) {
        var i, l;
        if(!stride) {
            stride = 2;
        }

        if(!offset) {
            offset = 0;
        }
        
        if(count) {
            l = Math.min((count * stride) + offset, a.length);
        } else {
            l = a.length;
        }

        for(i = offset; i < l; i += stride) {
            vec[0] = a[i]; vec[1] = a[i+1];
            fn(vec, vec, arg);
            a[i] = vec[0]; a[i+1] = vec[1];
        }
        
        return a;
    };
})();

/**
 * Returns a string representation of a vector
 *
 * @param {vec2} vec vector to represent as a string
 * @returns {String} string representation of the vector
 */
vec2.str = function (a) {
    return 'vec2(' + a[0] + ', ' + a[1] + ')';
};

/**
 * Returns whether or not the vectors exactly have the same elements in the same position (when compared with ===)
 *
 * @param {vec2} a The first vector.
 * @param {vec2} b The second vector.
 * @returns {Boolean} True if the vectors are equal, false otherwise.
 */
vec2.exactEquals = function (a, b) {
    return a[0] === b[0] && a[1] === b[1];
};

/**
 * Returns whether or not the vectors have approximately the same elements in the same position.
 *
 * @param {vec2} a The first vector.
 * @param {vec2} b The second vector.
 * @returns {Boolean} True if the vectors are equal, false otherwise.
 */
vec2.equals = function (a, b) {
    var a0 = a[0], a1 = a[1];
    var b0 = b[0], b1 = b[1];
    return (Math.abs(a0 - b0) <= glMatrix.EPSILON*Math.max(1.0, Math.abs(a0), Math.abs(b0)) &&
            Math.abs(a1 - b1) <= glMatrix.EPSILON*Math.max(1.0, Math.abs(a1), Math.abs(b1)));
};

module.exports = vec2;

},{"./common.js":8}],15:[function(require,module,exports){
/* Copyright (c) 2015, Brandon Jones, Colin MacKenzie IV.

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE. */

var glMatrix = require("./common.js");

/**
 * @class 3 Dimensional Vector
 * @name vec3
 */
var vec3 = {};

/**
 * Creates a new, empty vec3
 *
 * @returns {vec3} a new 3D vector
 */
vec3.create = function() {
    var out = new glMatrix.ARRAY_TYPE(3);
    out[0] = 0;
    out[1] = 0;
    out[2] = 0;
    return out;
};

/**
 * Creates a new vec3 initialized with values from an existing vector
 *
 * @param {vec3} a vector to clone
 * @returns {vec3} a new 3D vector
 */
vec3.clone = function(a) {
    var out = new glMatrix.ARRAY_TYPE(3);
    out[0] = a[0];
    out[1] = a[1];
    out[2] = a[2];
    return out;
};

/**
 * Creates a new vec3 initialized with the given values
 *
 * @param {Number} x X component
 * @param {Number} y Y component
 * @param {Number} z Z component
 * @returns {vec3} a new 3D vector
 */
vec3.fromValues = function(x, y, z) {
    var out = new glMatrix.ARRAY_TYPE(3);
    out[0] = x;
    out[1] = y;
    out[2] = z;
    return out;
};

/**
 * Copy the values from one vec3 to another
 *
 * @param {vec3} out the receiving vector
 * @param {vec3} a the source vector
 * @returns {vec3} out
 */
vec3.copy = function(out, a) {
    out[0] = a[0];
    out[1] = a[1];
    out[2] = a[2];
    return out;
};

/**
 * Set the components of a vec3 to the given values
 *
 * @param {vec3} out the receiving vector
 * @param {Number} x X component
 * @param {Number} y Y component
 * @param {Number} z Z component
 * @returns {vec3} out
 */
vec3.set = function(out, x, y, z) {
    out[0] = x;
    out[1] = y;
    out[2] = z;
    return out;
};

/**
 * Adds two vec3's
 *
 * @param {vec3} out the receiving vector
 * @param {vec3} a the first operand
 * @param {vec3} b the second operand
 * @returns {vec3} out
 */
vec3.add = function(out, a, b) {
    out[0] = a[0] + b[0];
    out[1] = a[1] + b[1];
    out[2] = a[2] + b[2];
    return out;
};

/**
 * Subtracts vector b from vector a
 *
 * @param {vec3} out the receiving vector
 * @param {vec3} a the first operand
 * @param {vec3} b the second operand
 * @returns {vec3} out
 */
vec3.subtract = function(out, a, b) {
    out[0] = a[0] - b[0];
    out[1] = a[1] - b[1];
    out[2] = a[2] - b[2];
    return out;
};

/**
 * Alias for {@link vec3.subtract}
 * @function
 */
vec3.sub = vec3.subtract;

/**
 * Multiplies two vec3's
 *
 * @param {vec3} out the receiving vector
 * @param {vec3} a the first operand
 * @param {vec3} b the second operand
 * @returns {vec3} out
 */
vec3.multiply = function(out, a, b) {
    out[0] = a[0] * b[0];
    out[1] = a[1] * b[1];
    out[2] = a[2] * b[2];
    return out;
};

/**
 * Alias for {@link vec3.multiply}
 * @function
 */
vec3.mul = vec3.multiply;

/**
 * Divides two vec3's
 *
 * @param {vec3} out the receiving vector
 * @param {vec3} a the first operand
 * @param {vec3} b the second operand
 * @returns {vec3} out
 */
vec3.divide = function(out, a, b) {
    out[0] = a[0] / b[0];
    out[1] = a[1] / b[1];
    out[2] = a[2] / b[2];
    return out;
};

/**
 * Alias for {@link vec3.divide}
 * @function
 */
vec3.div = vec3.divide;

/**
 * Math.ceil the components of a vec3
 *
 * @param {vec3} out the receiving vector
 * @param {vec3} a vector to ceil
 * @returns {vec3} out
 */
vec3.ceil = function (out, a) {
    out[0] = Math.ceil(a[0]);
    out[1] = Math.ceil(a[1]);
    out[2] = Math.ceil(a[2]);
    return out;
};

/**
 * Math.floor the components of a vec3
 *
 * @param {vec3} out the receiving vector
 * @param {vec3} a vector to floor
 * @returns {vec3} out
 */
vec3.floor = function (out, a) {
    out[0] = Math.floor(a[0]);
    out[1] = Math.floor(a[1]);
    out[2] = Math.floor(a[2]);
    return out;
};

/**
 * Returns the minimum of two vec3's
 *
 * @param {vec3} out the receiving vector
 * @param {vec3} a the first operand
 * @param {vec3} b the second operand
 * @returns {vec3} out
 */
vec3.min = function(out, a, b) {
    out[0] = Math.min(a[0], b[0]);
    out[1] = Math.min(a[1], b[1]);
    out[2] = Math.min(a[2], b[2]);
    return out;
};

/**
 * Returns the maximum of two vec3's
 *
 * @param {vec3} out the receiving vector
 * @param {vec3} a the first operand
 * @param {vec3} b the second operand
 * @returns {vec3} out
 */
vec3.max = function(out, a, b) {
    out[0] = Math.max(a[0], b[0]);
    out[1] = Math.max(a[1], b[1]);
    out[2] = Math.max(a[2], b[2]);
    return out;
};

/**
 * Math.round the components of a vec3
 *
 * @param {vec3} out the receiving vector
 * @param {vec3} a vector to round
 * @returns {vec3} out
 */
vec3.round = function (out, a) {
    out[0] = Math.round(a[0]);
    out[1] = Math.round(a[1]);
    out[2] = Math.round(a[2]);
    return out;
};

/**
 * Scales a vec3 by a scalar number
 *
 * @param {vec3} out the receiving vector
 * @param {vec3} a the vector to scale
 * @param {Number} b amount to scale the vector by
 * @returns {vec3} out
 */
vec3.scale = function(out, a, b) {
    out[0] = a[0] * b;
    out[1] = a[1] * b;
    out[2] = a[2] * b;
    return out;
};

/**
 * Adds two vec3's after scaling the second operand by a scalar value
 *
 * @param {vec3} out the receiving vector
 * @param {vec3} a the first operand
 * @param {vec3} b the second operand
 * @param {Number} scale the amount to scale b by before adding
 * @returns {vec3} out
 */
vec3.scaleAndAdd = function(out, a, b, scale) {
    out[0] = a[0] + (b[0] * scale);
    out[1] = a[1] + (b[1] * scale);
    out[2] = a[2] + (b[2] * scale);
    return out;
};

/**
 * Calculates the euclidian distance between two vec3's
 *
 * @param {vec3} a the first operand
 * @param {vec3} b the second operand
 * @returns {Number} distance between a and b
 */
vec3.distance = function(a, b) {
    var x = b[0] - a[0],
        y = b[1] - a[1],
        z = b[2] - a[2];
    return Math.sqrt(x*x + y*y + z*z);
};

/**
 * Alias for {@link vec3.distance}
 * @function
 */
vec3.dist = vec3.distance;

/**
 * Calculates the squared euclidian distance between two vec3's
 *
 * @param {vec3} a the first operand
 * @param {vec3} b the second operand
 * @returns {Number} squared distance between a and b
 */
vec3.squaredDistance = function(a, b) {
    var x = b[0] - a[0],
        y = b[1] - a[1],
        z = b[2] - a[2];
    return x*x + y*y + z*z;
};

/**
 * Alias for {@link vec3.squaredDistance}
 * @function
 */
vec3.sqrDist = vec3.squaredDistance;

/**
 * Calculates the length of a vec3
 *
 * @param {vec3} a vector to calculate length of
 * @returns {Number} length of a
 */
vec3.length = function (a) {
    var x = a[0],
        y = a[1],
        z = a[2];
    return Math.sqrt(x*x + y*y + z*z);
};

/**
 * Alias for {@link vec3.length}
 * @function
 */
vec3.len = vec3.length;

/**
 * Calculates the squared length of a vec3
 *
 * @param {vec3} a vector to calculate squared length of
 * @returns {Number} squared length of a
 */
vec3.squaredLength = function (a) {
    var x = a[0],
        y = a[1],
        z = a[2];
    return x*x + y*y + z*z;
};

/**
 * Alias for {@link vec3.squaredLength}
 * @function
 */
vec3.sqrLen = vec3.squaredLength;

/**
 * Negates the components of a vec3
 *
 * @param {vec3} out the receiving vector
 * @param {vec3} a vector to negate
 * @returns {vec3} out
 */
vec3.negate = function(out, a) {
    out[0] = -a[0];
    out[1] = -a[1];
    out[2] = -a[2];
    return out;
};

/**
 * Returns the inverse of the components of a vec3
 *
 * @param {vec3} out the receiving vector
 * @param {vec3} a vector to invert
 * @returns {vec3} out
 */
vec3.inverse = function(out, a) {
  out[0] = 1.0 / a[0];
  out[1] = 1.0 / a[1];
  out[2] = 1.0 / a[2];
  return out;
};

/**
 * Normalize a vec3
 *
 * @param {vec3} out the receiving vector
 * @param {vec3} a vector to normalize
 * @returns {vec3} out
 */
vec3.normalize = function(out, a) {
    var x = a[0],
        y = a[1],
        z = a[2];
    var len = x*x + y*y + z*z;
    if (len > 0) {
        //TODO: evaluate use of glm_invsqrt here?
        len = 1 / Math.sqrt(len);
        out[0] = a[0] * len;
        out[1] = a[1] * len;
        out[2] = a[2] * len;
    }
    return out;
};

/**
 * Calculates the dot product of two vec3's
 *
 * @param {vec3} a the first operand
 * @param {vec3} b the second operand
 * @returns {Number} dot product of a and b
 */
vec3.dot = function (a, b) {
    return a[0] * b[0] + a[1] * b[1] + a[2] * b[2];
};

/**
 * Computes the cross product of two vec3's
 *
 * @param {vec3} out the receiving vector
 * @param {vec3} a the first operand
 * @param {vec3} b the second operand
 * @returns {vec3} out
 */
vec3.cross = function(out, a, b) {
    var ax = a[0], ay = a[1], az = a[2],
        bx = b[0], by = b[1], bz = b[2];

    out[0] = ay * bz - az * by;
    out[1] = az * bx - ax * bz;
    out[2] = ax * by - ay * bx;
    return out;
};

/**
 * Performs a linear interpolation between two vec3's
 *
 * @param {vec3} out the receiving vector
 * @param {vec3} a the first operand
 * @param {vec3} b the second operand
 * @param {Number} t interpolation amount between the two inputs
 * @returns {vec3} out
 */
vec3.lerp = function (out, a, b, t) {
    var ax = a[0],
        ay = a[1],
        az = a[2];
    out[0] = ax + t * (b[0] - ax);
    out[1] = ay + t * (b[1] - ay);
    out[2] = az + t * (b[2] - az);
    return out;
};

/**
 * Performs a hermite interpolation with two control points
 *
 * @param {vec3} out the receiving vector
 * @param {vec3} a the first operand
 * @param {vec3} b the second operand
 * @param {vec3} c the third operand
 * @param {vec3} d the fourth operand
 * @param {Number} t interpolation amount between the two inputs
 * @returns {vec3} out
 */
vec3.hermite = function (out, a, b, c, d, t) {
  var factorTimes2 = t * t,
      factor1 = factorTimes2 * (2 * t - 3) + 1,
      factor2 = factorTimes2 * (t - 2) + t,
      factor3 = factorTimes2 * (t - 1),
      factor4 = factorTimes2 * (3 - 2 * t);
  
  out[0] = a[0] * factor1 + b[0] * factor2 + c[0] * factor3 + d[0] * factor4;
  out[1] = a[1] * factor1 + b[1] * factor2 + c[1] * factor3 + d[1] * factor4;
  out[2] = a[2] * factor1 + b[2] * factor2 + c[2] * factor3 + d[2] * factor4;
  
  return out;
};

/**
 * Performs a bezier interpolation with two control points
 *
 * @param {vec3} out the receiving vector
 * @param {vec3} a the first operand
 * @param {vec3} b the second operand
 * @param {vec3} c the third operand
 * @param {vec3} d the fourth operand
 * @param {Number} t interpolation amount between the two inputs
 * @returns {vec3} out
 */
vec3.bezier = function (out, a, b, c, d, t) {
  var inverseFactor = 1 - t,
      inverseFactorTimesTwo = inverseFactor * inverseFactor,
      factorTimes2 = t * t,
      factor1 = inverseFactorTimesTwo * inverseFactor,
      factor2 = 3 * t * inverseFactorTimesTwo,
      factor3 = 3 * factorTimes2 * inverseFactor,
      factor4 = factorTimes2 * t;
  
  out[0] = a[0] * factor1 + b[0] * factor2 + c[0] * factor3 + d[0] * factor4;
  out[1] = a[1] * factor1 + b[1] * factor2 + c[1] * factor3 + d[1] * factor4;
  out[2] = a[2] * factor1 + b[2] * factor2 + c[2] * factor3 + d[2] * factor4;
  
  return out;
};

/**
 * Generates a random vector with the given scale
 *
 * @param {vec3} out the receiving vector
 * @param {Number} [scale] Length of the resulting vector. If ommitted, a unit vector will be returned
 * @returns {vec3} out
 */
vec3.random = function (out, scale) {
    scale = scale || 1.0;

    var r = glMatrix.RANDOM() * 2.0 * Math.PI;
    var z = (glMatrix.RANDOM() * 2.0) - 1.0;
    var zScale = Math.sqrt(1.0-z*z) * scale;

    out[0] = Math.cos(r) * zScale;
    out[1] = Math.sin(r) * zScale;
    out[2] = z * scale;
    return out;
};

/**
 * Transforms the vec3 with a mat4.
 * 4th vector component is implicitly '1'
 *
 * @param {vec3} out the receiving vector
 * @param {vec3} a the vector to transform
 * @param {mat4} m matrix to transform with
 * @returns {vec3} out
 */
vec3.transformMat4 = function(out, a, m) {
    var x = a[0], y = a[1], z = a[2],
        w = m[3] * x + m[7] * y + m[11] * z + m[15];
    w = w || 1.0;
    out[0] = (m[0] * x + m[4] * y + m[8] * z + m[12]) / w;
    out[1] = (m[1] * x + m[5] * y + m[9] * z + m[13]) / w;
    out[2] = (m[2] * x + m[6] * y + m[10] * z + m[14]) / w;
    return out;
};

/**
 * Transforms the vec3 with a mat3.
 *
 * @param {vec3} out the receiving vector
 * @param {vec3} a the vector to transform
 * @param {mat4} m the 3x3 matrix to transform with
 * @returns {vec3} out
 */
vec3.transformMat3 = function(out, a, m) {
    var x = a[0], y = a[1], z = a[2];
    out[0] = x * m[0] + y * m[3] + z * m[6];
    out[1] = x * m[1] + y * m[4] + z * m[7];
    out[2] = x * m[2] + y * m[5] + z * m[8];
    return out;
};

/**
 * Transforms the vec3 with a quat
 *
 * @param {vec3} out the receiving vector
 * @param {vec3} a the vector to transform
 * @param {quat} q quaternion to transform with
 * @returns {vec3} out
 */
vec3.transformQuat = function(out, a, q) {
    // benchmarks: http://jsperf.com/quaternion-transform-vec3-implementations

    var x = a[0], y = a[1], z = a[2],
        qx = q[0], qy = q[1], qz = q[2], qw = q[3],

        // calculate quat * vec
        ix = qw * x + qy * z - qz * y,
        iy = qw * y + qz * x - qx * z,
        iz = qw * z + qx * y - qy * x,
        iw = -qx * x - qy * y - qz * z;

    // calculate result * inverse quat
    out[0] = ix * qw + iw * -qx + iy * -qz - iz * -qy;
    out[1] = iy * qw + iw * -qy + iz * -qx - ix * -qz;
    out[2] = iz * qw + iw * -qz + ix * -qy - iy * -qx;
    return out;
};

/**
 * Rotate a 3D vector around the x-axis
 * @param {vec3} out The receiving vec3
 * @param {vec3} a The vec3 point to rotate
 * @param {vec3} b The origin of the rotation
 * @param {Number} c The angle of rotation
 * @returns {vec3} out
 */
vec3.rotateX = function(out, a, b, c){
   var p = [], r=[];
	  //Translate point to the origin
	  p[0] = a[0] - b[0];
	  p[1] = a[1] - b[1];
  	p[2] = a[2] - b[2];

	  //perform rotation
	  r[0] = p[0];
	  r[1] = p[1]*Math.cos(c) - p[2]*Math.sin(c);
	  r[2] = p[1]*Math.sin(c) + p[2]*Math.cos(c);

	  //translate to correct position
	  out[0] = r[0] + b[0];
	  out[1] = r[1] + b[1];
	  out[2] = r[2] + b[2];

  	return out;
};

/**
 * Rotate a 3D vector around the y-axis
 * @param {vec3} out The receiving vec3
 * @param {vec3} a The vec3 point to rotate
 * @param {vec3} b The origin of the rotation
 * @param {Number} c The angle of rotation
 * @returns {vec3} out
 */
vec3.rotateY = function(out, a, b, c){
  	var p = [], r=[];
  	//Translate point to the origin
  	p[0] = a[0] - b[0];
  	p[1] = a[1] - b[1];
  	p[2] = a[2] - b[2];
  
  	//perform rotation
  	r[0] = p[2]*Math.sin(c) + p[0]*Math.cos(c);
  	r[1] = p[1];
  	r[2] = p[2]*Math.cos(c) - p[0]*Math.sin(c);
  
  	//translate to correct position
  	out[0] = r[0] + b[0];
  	out[1] = r[1] + b[1];
  	out[2] = r[2] + b[2];
  
  	return out;
};

/**
 * Rotate a 3D vector around the z-axis
 * @param {vec3} out The receiving vec3
 * @param {vec3} a The vec3 point to rotate
 * @param {vec3} b The origin of the rotation
 * @param {Number} c The angle of rotation
 * @returns {vec3} out
 */
vec3.rotateZ = function(out, a, b, c){
  	var p = [], r=[];
  	//Translate point to the origin
  	p[0] = a[0] - b[0];
  	p[1] = a[1] - b[1];
  	p[2] = a[2] - b[2];
  
  	//perform rotation
  	r[0] = p[0]*Math.cos(c) - p[1]*Math.sin(c);
  	r[1] = p[0]*Math.sin(c) + p[1]*Math.cos(c);
  	r[2] = p[2];
  
  	//translate to correct position
  	out[0] = r[0] + b[0];
  	out[1] = r[1] + b[1];
  	out[2] = r[2] + b[2];
  
  	return out;
};

/**
 * Perform some operation over an array of vec3s.
 *
 * @param {Array} a the array of vectors to iterate over
 * @param {Number} stride Number of elements between the start of each vec3. If 0 assumes tightly packed
 * @param {Number} offset Number of elements to skip at the beginning of the array
 * @param {Number} count Number of vec3s to iterate over. If 0 iterates over entire array
 * @param {Function} fn Function to call for each vector in the array
 * @param {Object} [arg] additional argument to pass to fn
 * @returns {Array} a
 * @function
 */
vec3.forEach = (function() {
    var vec = vec3.create();

    return function(a, stride, offset, count, fn, arg) {
        var i, l;
        if(!stride) {
            stride = 3;
        }

        if(!offset) {
            offset = 0;
        }
        
        if(count) {
            l = Math.min((count * stride) + offset, a.length);
        } else {
            l = a.length;
        }

        for(i = offset; i < l; i += stride) {
            vec[0] = a[i]; vec[1] = a[i+1]; vec[2] = a[i+2];
            fn(vec, vec, arg);
            a[i] = vec[0]; a[i+1] = vec[1]; a[i+2] = vec[2];
        }
        
        return a;
    };
})();

/**
 * Get the angle between two 3D vectors
 * @param {vec3} a The first operand
 * @param {vec3} b The second operand
 * @returns {Number} The angle in radians
 */
vec3.angle = function(a, b) {
   
    var tempA = vec3.fromValues(a[0], a[1], a[2]);
    var tempB = vec3.fromValues(b[0], b[1], b[2]);
 
    vec3.normalize(tempA, tempA);
    vec3.normalize(tempB, tempB);
 
    var cosine = vec3.dot(tempA, tempB);

    if(cosine > 1.0){
        return 0;
    } else {
        return Math.acos(cosine);
    }     
};

/**
 * Returns a string representation of a vector
 *
 * @param {vec3} vec vector to represent as a string
 * @returns {String} string representation of the vector
 */
vec3.str = function (a) {
    return 'vec3(' + a[0] + ', ' + a[1] + ', ' + a[2] + ')';
};

/**
 * Returns whether or not the vectors have exactly the same elements in the same position (when compared with ===)
 *
 * @param {vec3} a The first vector.
 * @param {vec3} b The second vector.
 * @returns {Boolean} True if the vectors are equal, false otherwise.
 */
vec3.exactEquals = function (a, b) {
    return a[0] === b[0] && a[1] === b[1] && a[2] === b[2];
};

/**
 * Returns whether or not the vectors have approximately the same elements in the same position.
 *
 * @param {vec3} a The first vector.
 * @param {vec3} b The second vector.
 * @returns {Boolean} True if the vectors are equal, false otherwise.
 */
vec3.equals = function (a, b) {
    var a0 = a[0], a1 = a[1], a2 = a[2];
    var b0 = b[0], b1 = b[1], b2 = b[2];
    return (Math.abs(a0 - b0) <= glMatrix.EPSILON*Math.max(1.0, Math.abs(a0), Math.abs(b0)) &&
            Math.abs(a1 - b1) <= glMatrix.EPSILON*Math.max(1.0, Math.abs(a1), Math.abs(b1)) &&
            Math.abs(a2 - b2) <= glMatrix.EPSILON*Math.max(1.0, Math.abs(a2), Math.abs(b2)));
};

module.exports = vec3;

},{"./common.js":8}],16:[function(require,module,exports){
/* Copyright (c) 2015, Brandon Jones, Colin MacKenzie IV.

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE. */

var glMatrix = require("./common.js");

/**
 * @class 4 Dimensional Vector
 * @name vec4
 */
var vec4 = {};

/**
 * Creates a new, empty vec4
 *
 * @returns {vec4} a new 4D vector
 */
vec4.create = function() {
    var out = new glMatrix.ARRAY_TYPE(4);
    out[0] = 0;
    out[1] = 0;
    out[2] = 0;
    out[3] = 0;
    return out;
};

/**
 * Creates a new vec4 initialized with values from an existing vector
 *
 * @param {vec4} a vector to clone
 * @returns {vec4} a new 4D vector
 */
vec4.clone = function(a) {
    var out = new glMatrix.ARRAY_TYPE(4);
    out[0] = a[0];
    out[1] = a[1];
    out[2] = a[2];
    out[3] = a[3];
    return out;
};

/**
 * Creates a new vec4 initialized with the given values
 *
 * @param {Number} x X component
 * @param {Number} y Y component
 * @param {Number} z Z component
 * @param {Number} w W component
 * @returns {vec4} a new 4D vector
 */
vec4.fromValues = function(x, y, z, w) {
    var out = new glMatrix.ARRAY_TYPE(4);
    out[0] = x;
    out[1] = y;
    out[2] = z;
    out[3] = w;
    return out;
};

/**
 * Copy the values from one vec4 to another
 *
 * @param {vec4} out the receiving vector
 * @param {vec4} a the source vector
 * @returns {vec4} out
 */
vec4.copy = function(out, a) {
    out[0] = a[0];
    out[1] = a[1];
    out[2] = a[2];
    out[3] = a[3];
    return out;
};

/**
 * Set the components of a vec4 to the given values
 *
 * @param {vec4} out the receiving vector
 * @param {Number} x X component
 * @param {Number} y Y component
 * @param {Number} z Z component
 * @param {Number} w W component
 * @returns {vec4} out
 */
vec4.set = function(out, x, y, z, w) {
    out[0] = x;
    out[1] = y;
    out[2] = z;
    out[3] = w;
    return out;
};

/**
 * Adds two vec4's
 *
 * @param {vec4} out the receiving vector
 * @param {vec4} a the first operand
 * @param {vec4} b the second operand
 * @returns {vec4} out
 */
vec4.add = function(out, a, b) {
    out[0] = a[0] + b[0];
    out[1] = a[1] + b[1];
    out[2] = a[2] + b[2];
    out[3] = a[3] + b[3];
    return out;
};

/**
 * Subtracts vector b from vector a
 *
 * @param {vec4} out the receiving vector
 * @param {vec4} a the first operand
 * @param {vec4} b the second operand
 * @returns {vec4} out
 */
vec4.subtract = function(out, a, b) {
    out[0] = a[0] - b[0];
    out[1] = a[1] - b[1];
    out[2] = a[2] - b[2];
    out[3] = a[3] - b[3];
    return out;
};

/**
 * Alias for {@link vec4.subtract}
 * @function
 */
vec4.sub = vec4.subtract;

/**
 * Multiplies two vec4's
 *
 * @param {vec4} out the receiving vector
 * @param {vec4} a the first operand
 * @param {vec4} b the second operand
 * @returns {vec4} out
 */
vec4.multiply = function(out, a, b) {
    out[0] = a[0] * b[0];
    out[1] = a[1] * b[1];
    out[2] = a[2] * b[2];
    out[3] = a[3] * b[3];
    return out;
};

/**
 * Alias for {@link vec4.multiply}
 * @function
 */
vec4.mul = vec4.multiply;

/**
 * Divides two vec4's
 *
 * @param {vec4} out the receiving vector
 * @param {vec4} a the first operand
 * @param {vec4} b the second operand
 * @returns {vec4} out
 */
vec4.divide = function(out, a, b) {
    out[0] = a[0] / b[0];
    out[1] = a[1] / b[1];
    out[2] = a[2] / b[2];
    out[3] = a[3] / b[3];
    return out;
};

/**
 * Alias for {@link vec4.divide}
 * @function
 */
vec4.div = vec4.divide;

/**
 * Math.ceil the components of a vec4
 *
 * @param {vec4} out the receiving vector
 * @param {vec4} a vector to ceil
 * @returns {vec4} out
 */
vec4.ceil = function (out, a) {
    out[0] = Math.ceil(a[0]);
    out[1] = Math.ceil(a[1]);
    out[2] = Math.ceil(a[2]);
    out[3] = Math.ceil(a[3]);
    return out;
};

/**
 * Math.floor the components of a vec4
 *
 * @param {vec4} out the receiving vector
 * @param {vec4} a vector to floor
 * @returns {vec4} out
 */
vec4.floor = function (out, a) {
    out[0] = Math.floor(a[0]);
    out[1] = Math.floor(a[1]);
    out[2] = Math.floor(a[2]);
    out[3] = Math.floor(a[3]);
    return out;
};

/**
 * Returns the minimum of two vec4's
 *
 * @param {vec4} out the receiving vector
 * @param {vec4} a the first operand
 * @param {vec4} b the second operand
 * @returns {vec4} out
 */
vec4.min = function(out, a, b) {
    out[0] = Math.min(a[0], b[0]);
    out[1] = Math.min(a[1], b[1]);
    out[2] = Math.min(a[2], b[2]);
    out[3] = Math.min(a[3], b[3]);
    return out;
};

/**
 * Returns the maximum of two vec4's
 *
 * @param {vec4} out the receiving vector
 * @param {vec4} a the first operand
 * @param {vec4} b the second operand
 * @returns {vec4} out
 */
vec4.max = function(out, a, b) {
    out[0] = Math.max(a[0], b[0]);
    out[1] = Math.max(a[1], b[1]);
    out[2] = Math.max(a[2], b[2]);
    out[3] = Math.max(a[3], b[3]);
    return out;
};

/**
 * Math.round the components of a vec4
 *
 * @param {vec4} out the receiving vector
 * @param {vec4} a vector to round
 * @returns {vec4} out
 */
vec4.round = function (out, a) {
    out[0] = Math.round(a[0]);
    out[1] = Math.round(a[1]);
    out[2] = Math.round(a[2]);
    out[3] = Math.round(a[3]);
    return out;
};

/**
 * Scales a vec4 by a scalar number
 *
 * @param {vec4} out the receiving vector
 * @param {vec4} a the vector to scale
 * @param {Number} b amount to scale the vector by
 * @returns {vec4} out
 */
vec4.scale = function(out, a, b) {
    out[0] = a[0] * b;
    out[1] = a[1] * b;
    out[2] = a[2] * b;
    out[3] = a[3] * b;
    return out;
};

/**
 * Adds two vec4's after scaling the second operand by a scalar value
 *
 * @param {vec4} out the receiving vector
 * @param {vec4} a the first operand
 * @param {vec4} b the second operand
 * @param {Number} scale the amount to scale b by before adding
 * @returns {vec4} out
 */
vec4.scaleAndAdd = function(out, a, b, scale) {
    out[0] = a[0] + (b[0] * scale);
    out[1] = a[1] + (b[1] * scale);
    out[2] = a[2] + (b[2] * scale);
    out[3] = a[3] + (b[3] * scale);
    return out;
};

/**
 * Calculates the euclidian distance between two vec4's
 *
 * @param {vec4} a the first operand
 * @param {vec4} b the second operand
 * @returns {Number} distance between a and b
 */
vec4.distance = function(a, b) {
    var x = b[0] - a[0],
        y = b[1] - a[1],
        z = b[2] - a[2],
        w = b[3] - a[3];
    return Math.sqrt(x*x + y*y + z*z + w*w);
};

/**
 * Alias for {@link vec4.distance}
 * @function
 */
vec4.dist = vec4.distance;

/**
 * Calculates the squared euclidian distance between two vec4's
 *
 * @param {vec4} a the first operand
 * @param {vec4} b the second operand
 * @returns {Number} squared distance between a and b
 */
vec4.squaredDistance = function(a, b) {
    var x = b[0] - a[0],
        y = b[1] - a[1],
        z = b[2] - a[2],
        w = b[3] - a[3];
    return x*x + y*y + z*z + w*w;
};

/**
 * Alias for {@link vec4.squaredDistance}
 * @function
 */
vec4.sqrDist = vec4.squaredDistance;

/**
 * Calculates the length of a vec4
 *
 * @param {vec4} a vector to calculate length of
 * @returns {Number} length of a
 */
vec4.length = function (a) {
    var x = a[0],
        y = a[1],
        z = a[2],
        w = a[3];
    return Math.sqrt(x*x + y*y + z*z + w*w);
};

/**
 * Alias for {@link vec4.length}
 * @function
 */
vec4.len = vec4.length;

/**
 * Calculates the squared length of a vec4
 *
 * @param {vec4} a vector to calculate squared length of
 * @returns {Number} squared length of a
 */
vec4.squaredLength = function (a) {
    var x = a[0],
        y = a[1],
        z = a[2],
        w = a[3];
    return x*x + y*y + z*z + w*w;
};

/**
 * Alias for {@link vec4.squaredLength}
 * @function
 */
vec4.sqrLen = vec4.squaredLength;

/**
 * Negates the components of a vec4
 *
 * @param {vec4} out the receiving vector
 * @param {vec4} a vector to negate
 * @returns {vec4} out
 */
vec4.negate = function(out, a) {
    out[0] = -a[0];
    out[1] = -a[1];
    out[2] = -a[2];
    out[3] = -a[3];
    return out;
};

/**
 * Returns the inverse of the components of a vec4
 *
 * @param {vec4} out the receiving vector
 * @param {vec4} a vector to invert
 * @returns {vec4} out
 */
vec4.inverse = function(out, a) {
  out[0] = 1.0 / a[0];
  out[1] = 1.0 / a[1];
  out[2] = 1.0 / a[2];
  out[3] = 1.0 / a[3];
  return out;
};

/**
 * Normalize a vec4
 *
 * @param {vec4} out the receiving vector
 * @param {vec4} a vector to normalize
 * @returns {vec4} out
 */
vec4.normalize = function(out, a) {
    var x = a[0],
        y = a[1],
        z = a[2],
        w = a[3];
    var len = x*x + y*y + z*z + w*w;
    if (len > 0) {
        len = 1 / Math.sqrt(len);
        out[0] = x * len;
        out[1] = y * len;
        out[2] = z * len;
        out[3] = w * len;
    }
    return out;
};

/**
 * Calculates the dot product of two vec4's
 *
 * @param {vec4} a the first operand
 * @param {vec4} b the second operand
 * @returns {Number} dot product of a and b
 */
vec4.dot = function (a, b) {
    return a[0] * b[0] + a[1] * b[1] + a[2] * b[2] + a[3] * b[3];
};

/**
 * Performs a linear interpolation between two vec4's
 *
 * @param {vec4} out the receiving vector
 * @param {vec4} a the first operand
 * @param {vec4} b the second operand
 * @param {Number} t interpolation amount between the two inputs
 * @returns {vec4} out
 */
vec4.lerp = function (out, a, b, t) {
    var ax = a[0],
        ay = a[1],
        az = a[2],
        aw = a[3];
    out[0] = ax + t * (b[0] - ax);
    out[1] = ay + t * (b[1] - ay);
    out[2] = az + t * (b[2] - az);
    out[3] = aw + t * (b[3] - aw);
    return out;
};

/**
 * Generates a random vector with the given scale
 *
 * @param {vec4} out the receiving vector
 * @param {Number} [scale] Length of the resulting vector. If ommitted, a unit vector will be returned
 * @returns {vec4} out
 */
vec4.random = function (out, scale) {
    scale = scale || 1.0;

    //TODO: This is a pretty awful way of doing this. Find something better.
    out[0] = glMatrix.RANDOM();
    out[1] = glMatrix.RANDOM();
    out[2] = glMatrix.RANDOM();
    out[3] = glMatrix.RANDOM();
    vec4.normalize(out, out);
    vec4.scale(out, out, scale);
    return out;
};

/**
 * Transforms the vec4 with a mat4.
 *
 * @param {vec4} out the receiving vector
 * @param {vec4} a the vector to transform
 * @param {mat4} m matrix to transform with
 * @returns {vec4} out
 */
vec4.transformMat4 = function(out, a, m) {
    var x = a[0], y = a[1], z = a[2], w = a[3];
    out[0] = m[0] * x + m[4] * y + m[8] * z + m[12] * w;
    out[1] = m[1] * x + m[5] * y + m[9] * z + m[13] * w;
    out[2] = m[2] * x + m[6] * y + m[10] * z + m[14] * w;
    out[3] = m[3] * x + m[7] * y + m[11] * z + m[15] * w;
    return out;
};

/**
 * Transforms the vec4 with a quat
 *
 * @param {vec4} out the receiving vector
 * @param {vec4} a the vector to transform
 * @param {quat} q quaternion to transform with
 * @returns {vec4} out
 */
vec4.transformQuat = function(out, a, q) {
    var x = a[0], y = a[1], z = a[2],
        qx = q[0], qy = q[1], qz = q[2], qw = q[3],

        // calculate quat * vec
        ix = qw * x + qy * z - qz * y,
        iy = qw * y + qz * x - qx * z,
        iz = qw * z + qx * y - qy * x,
        iw = -qx * x - qy * y - qz * z;

    // calculate result * inverse quat
    out[0] = ix * qw + iw * -qx + iy * -qz - iz * -qy;
    out[1] = iy * qw + iw * -qy + iz * -qx - ix * -qz;
    out[2] = iz * qw + iw * -qz + ix * -qy - iy * -qx;
    out[3] = a[3];
    return out;
};

/**
 * Perform some operation over an array of vec4s.
 *
 * @param {Array} a the array of vectors to iterate over
 * @param {Number} stride Number of elements between the start of each vec4. If 0 assumes tightly packed
 * @param {Number} offset Number of elements to skip at the beginning of the array
 * @param {Number} count Number of vec4s to iterate over. If 0 iterates over entire array
 * @param {Function} fn Function to call for each vector in the array
 * @param {Object} [arg] additional argument to pass to fn
 * @returns {Array} a
 * @function
 */
vec4.forEach = (function() {
    var vec = vec4.create();

    return function(a, stride, offset, count, fn, arg) {
        var i, l;
        if(!stride) {
            stride = 4;
        }

        if(!offset) {
            offset = 0;
        }
        
        if(count) {
            l = Math.min((count * stride) + offset, a.length);
        } else {
            l = a.length;
        }

        for(i = offset; i < l; i += stride) {
            vec[0] = a[i]; vec[1] = a[i+1]; vec[2] = a[i+2]; vec[3] = a[i+3];
            fn(vec, vec, arg);
            a[i] = vec[0]; a[i+1] = vec[1]; a[i+2] = vec[2]; a[i+3] = vec[3];
        }
        
        return a;
    };
})();

/**
 * Returns a string representation of a vector
 *
 * @param {vec4} vec vector to represent as a string
 * @returns {String} string representation of the vector
 */
vec4.str = function (a) {
    return 'vec4(' + a[0] + ', ' + a[1] + ', ' + a[2] + ', ' + a[3] + ')';
};

/**
 * Returns whether or not the vectors have exactly the same elements in the same position (when compared with ===)
 *
 * @param {vec4} a The first vector.
 * @param {vec4} b The second vector.
 * @returns {Boolean} True if the vectors are equal, false otherwise.
 */
vec4.exactEquals = function (a, b) {
    return a[0] === b[0] && a[1] === b[1] && a[2] === b[2] && a[3] === b[3];
};

/**
 * Returns whether or not the vectors have approximately the same elements in the same position.
 *
 * @param {vec4} a The first vector.
 * @param {vec4} b The second vector.
 * @returns {Boolean} True if the vectors are equal, false otherwise.
 */
vec4.equals = function (a, b) {
    var a0 = a[0], a1 = a[1], a2 = a[2], a3 = a[3];
    var b0 = b[0], b1 = b[1], b2 = b[2], b3 = b[3];
    return (Math.abs(a0 - b0) <= glMatrix.EPSILON*Math.max(1.0, Math.abs(a0), Math.abs(b0)) &&
            Math.abs(a1 - b1) <= glMatrix.EPSILON*Math.max(1.0, Math.abs(a1), Math.abs(b1)) &&
            Math.abs(a2 - b2) <= glMatrix.EPSILON*Math.max(1.0, Math.abs(a2), Math.abs(b2)) &&
            Math.abs(a3 - b3) <= glMatrix.EPSILON*Math.max(1.0, Math.abs(a3), Math.abs(b3)));
};

module.exports = vec4;

},{"./common.js":8}],17:[function(require,module,exports){
var OncoprintModel = require('./oncoprintmodel.js');
var OncoprintWebGLCellView = require('./oncoprintwebglcellview.js');
var OncoprintLabelView = require('./oncoprintlabelview.js');
var OncoprintRuleSet = require('./oncoprintruleset.js');
var OncoprintTrackOptionsView = require('./oncoprinttrackoptionsview.js');
var OncoprintLegendView = require('./oncoprintlegendrenderer.js');//TODO: rename
var OncoprintToolTip = require('./oncoprinttooltip.js');
var OncoprintTrackInfoView = require('./oncoprinttrackinfoview.js');
var OncoprintMinimapView = require('./oncoprintminimapview.js');

var svgfactory = require('./svgfactory.js');

var clamp = function(val, lower, upper) {
    return Math.min(Math.max(val, lower), upper);
};

var Oncoprint = (function () {
    // this is the controller
    var nextTrackId = (function () {
	var ctr = 0;
	return function () {
	    ctr += 1;
	    return ctr;
	}
    })();
    function Oncoprint(ctr_selector, width) {
	var self = this;
	this.ctr_selector = ctr_selector;
	
	var $ctr = $('<span></span>').css({'position':'relative', 'display':'inline-block'}).appendTo(ctr_selector);
	var $oncoprint_ctr = $('<div></div>')
			    .css({'position':'relative', 'display':'inline-block'})
			    .appendTo($ctr);
		    
	var $tooltip_ctr = $('<span></span>').css({'position':'absolute'}).appendTo(ctr_selector);
	var $legend_ctr = $('<div></div>').css({'position':'absolute', 'display':'inline-block', 'top':0, 'left':0, 'min-height':1})
			    .appendTo($ctr);
	
	var $label_canvas = $('<canvas></canvas>')
			    .css({'display':'inline-block', 
				'position':'absolute', 
				'left':'0px', 
				'top':'0px'})
			    .addClass("noselect")
			    .attr({'width':'150', 'height':'250'});
		    
	var $track_options_div = $('<div></div>')
				.css({'position':'absolute', 
					'left':'150px', 
					'top':'0px'})
				.addClass("noselect")
				.attr({'width':'50', 'height':'250'});
			
	var $legend_div = $('<div></div>')
			    .css({'position':'absolute', 
				    'top':'250px',
				    'min-height':1})
			    .addClass("noselect");
	
	var $cell_div = $('<div>')
			.css({'width':width,
			    'display':'inline-block', 
			    'position':'absolute', 
			    'left':'200px', 
			    'top':'0px'})
			.addClass("noselect");
		
	var $cell_canvas = $('<canvas></canvas>')
			    .attr('width', width)
			    .css({'position':'absolute', 'top':'0px', 'left':'0px'})
			    .addClass("noselect");
		    
	var $dummy_scroll_div = $('<div>')
				.css({'position':'absolute',
				    'overflow-x':'scroll',
				    'overflow-y':'scroll',
				    'top':'0', 
				    'left':'0px', 
				    'height':'1px',
				});
	
	var $dummy_scroll_div_contents = $('<div>').appendTo($dummy_scroll_div);
				
	var $cell_overlay_canvas = $('<canvas></canvas>')
				    .attr('width', width)
				    .css({'position':'absolute', 
					    'top':'0px', 
					    'left':'0px'})
				    .addClass("noselect");
			    
	var $track_info_div = $('<div>')
				.css({'position':'absolute'});
			
	var $minimap_div = $('<div>').css({'position':'absolute', 'outline':'solid 1px black', 'display': 'none'}).addClass("noselect");
	
	var $minimap_canvas = $('<canvas></canvas>')
				    .attr('width', 300)
				    .attr('height', 300)
				    .css({'position':'absolute', 'top':'0px', 'left':'0px', 'z-index':0})
				    .addClass("noselect");
	var $minimap_overlay_canvas = $('<canvas></canvas>')
				    .attr('width', 300)
				    .attr('height', 300)
				    .css({'position': 'absolute', 'top':'0px', 'left':'0px', 'z-index':1})
				    .addClass("noselect");
	
	$label_canvas.appendTo($oncoprint_ctr);
	$cell_div.appendTo($oncoprint_ctr);
	$track_options_div.appendTo($oncoprint_ctr);
	$track_info_div.appendTo($oncoprint_ctr);
	
	$legend_div.appendTo($legend_ctr);

	$minimap_div.appendTo($ctr);
	
	$cell_canvas.appendTo($cell_div);
	$cell_overlay_canvas.appendTo($cell_div);
	$dummy_scroll_div.appendTo($cell_div);
	$dummy_scroll_div.on("mousemove mousedown mouseup", function(evt) {
	    $cell_overlay_canvas.trigger(evt);
	});
	$minimap_canvas.appendTo($minimap_div);
	$minimap_overlay_canvas.appendTo($minimap_div);
	
	this.$ctr = $ctr;
	this.$oncoprint_ctr = $oncoprint_ctr;
	this.$cell_div = $cell_div;
	this.$legend_div = $legend_div;
	this.$track_options_div = $track_options_div;
	this.$track_info_div = $track_info_div;
	this.$dummy_scroll_div = $dummy_scroll_div;
	this.$minimap_div = $minimap_div;
	
	
	
	this.$cell_canvas = $cell_canvas;
	this.$cell_overlay_canvas = $cell_overlay_canvas;
	
	this.model = new OncoprintModel();
	
	
	this.cell_view = new OncoprintWebGLCellView($cell_div, $cell_canvas, $cell_overlay_canvas, $dummy_scroll_div_contents, this.model, new OncoprintToolTip($tooltip_ctr), function(left, right) {
	    var enclosed_ids = self.model.getIdsInLeftInterval(left, right);
	    self.setHorzZoom(self.model.getHorzZoomToFit(self.cell_view.visible_area_width, enclosed_ids));
	    self.$dummy_scroll_div.scrollLeft(self.model.getZoomedColumnLeft(enclosed_ids[0]));
	    self.id_clipboard = enclosed_ids;
	},
		(function () {
		    var highlight_timeout = null;
		    var highlight_track = null;
		    return function (track_id, column_id) {
			if (track_id === null) {
			    highlight_track = null;
			    self.highlightTrack(null);
			    clearTimeout(highlight_timeout);
			} else {
			    if (highlight_track !== track_id) {
				self.highlightTrack(null);
				clearTimeout(highlight_timeout);
				highlight_track = track_id;
				highlight_timeout = setTimeout(function() {
				    self.highlightTrack(highlight_track);
				}, 250);
			    }
			}
		    };
		})());
	
	this.minimap_view = new OncoprintMinimapView($minimap_div, $minimap_canvas, $minimap_overlay_canvas, this.model, this.cell_view, 150, 150, function(x,y) {
	    self.setScroll(x,y);
	},
	function(vp) {
	    self.setViewport(vp.col,vp.scroll_y_proportion,vp.num_cols, vp.zoom_y);
	},
	function(val) {
	    var prev_viewport = self.cell_view.getViewportOncoprintSpace(self.model);
	    var prev_center_onc_space = (prev_viewport.left + prev_viewport.right) / 2;
	    var center_column = Math.floor(prev_center_onc_space / (self.model.getCellWidth(true) + self.model.getCellPadding(true)));
	    self.setHorzZoom(val);
	    var viewport = self.cell_view.getViewportOncoprintSpace(self.model);
	    var center_column_x_zoomed = center_column * (self.model.getCellWidth() + self.model.getCellPadding());
	    var half_viewport_width_zoomed = self.model.getHorzZoom() * (viewport.right - viewport.left) / 2;
	    
	    self.setHorzScroll(center_column_x_zoomed - half_viewport_width_zoomed);
	},
	function(val) {
	    var prev_viewport = self.cell_view.getViewportOncoprintSpace(self.model);
	    var center_onc_space = (prev_viewport.top + prev_viewport.bottom) / 2;
	    self.setVertZoom(val);
	    var viewport = self.cell_view.getViewportOncoprintSpace(self.model);
	    var half_viewport_height_zoomed = self.model.getVertZoom() * (viewport.bottom - viewport.top) / 2;
	    
	    self.setVertScroll(center_onc_space * self.model.getVertZoom() - half_viewport_height_zoomed);
	},
	function() {
	    updateHorzZoomToFit(self);
	    var left = self.model.getZoomedColumnLeft();
	    self.setHorzScroll(Math.min.apply(null, self.keep_horz_zoomed_to_fit_ids.map(function(id) { return left[id]; })));
	},
	function() {
	    self.setMinimapVisible(false);
	});
	
	this.track_options_view = new OncoprintTrackOptionsView($track_options_div,
								function (track_id) {
								    // move up
								    var tracks = self.model.getContainingTrackGroup(track_id);
								    var index = tracks.indexOf(track_id);
								    if (index > 0) {
									var new_previous_track = null;
									if (index >= 2) {
									    new_previous_track = tracks[index-2];
									}
									self.moveTrack(track_id, new_previous_track);
								    }
								},
								function (track_id) {
								    // move down
								    var tracks = self.model.getContainingTrackGroup(track_id);
								    var index = tracks.indexOf(track_id);
								    if (index < tracks.length - 1) {
									self.moveTrack(track_id, tracks[index+1]);
								    }
								},
								function (track_id) { self.removeTrack(track_id); },
								function (track_id, dir) { self.setTrackSortDirection(track_id, dir); },
								function (track_id) {
								    // remove all related expansion tracks
								    var tracks_to_remove = self.model.track_expansion_tracks[track_id].slice(), i;
								    self.suppressRendering();
								    for (i = 0; i < tracks_to_remove.length; i++) {
									self.removeTrack(tracks_to_remove[i]);
								    }
								    self.releaseRendering();
								});
	this.track_info_view = new OncoprintTrackInfoView($track_info_div);
								
	//this.track_info_view = new OncoprintTrackInfoView($track_info_div);

	this.label_view = new OncoprintLabelView($label_canvas, this.model, new OncoprintToolTip($tooltip_ctr, {noselect: true}));
	this.label_view.setDragCallback(function(target_track, new_previous_track) {
	    self.moveTrack(target_track, new_previous_track);
	});
	
	this.legend_view = new OncoprintLegendView($legend_div, 10, 20);
	
	this.keep_sorted = false;
	
	this.keep_horz_zoomed_to_fit = false;
	this.keep_horz_zoomed_to_fit_ids = [];
	
	// We need to handle scrolling this way because for some reason huge 
	//  canvas elements have terrible resolution.
	var cell_view = this.cell_view;
	var model = this.model;
	
	this.target_dummy_scroll_left = 0;
	this.target_dummy_scroll_top = 0;
	
	(function setUpOncoprintScroll() {
	    $dummy_scroll_div.scroll(function (e) {
		var dummy_scroll_left = $dummy_scroll_div.scrollLeft();
		var dummy_scroll_top = $dummy_scroll_div.scrollTop();
		if (dummy_scroll_left !== self.target_dummy_scroll_left || dummy_scroll_top !== self.target_dummy_scroll_top) {
		    // In setDummyScrollDivScroll, where we intend to set the scroll programmatically without
		    //	triggering the handler, we set target_dummy_scroll_left and target_dummy_scroll_top,
		    //	so if they're not set (we get inside this block), then it's a user-triggered scroll.
		    //	
		    // Set oncoprint scroll to match
		    self.target_dummy_scroll_left = dummy_scroll_left;
		    self.target_dummy_scroll_top = dummy_scroll_top;
		    var maximum_dummy_scroll_div_scroll = maxDummyScrollDivScroll(oncoprint);
		    var maximum_div_scroll_left = maximum_dummy_scroll_div_scroll.left;
		    var maximum_div_scroll_top = maximum_dummy_scroll_div_scroll.top;
		    var scroll_left_prop = maximum_div_scroll_left > 0 ? dummy_scroll_left / maximum_div_scroll_left : 0;
		    var scroll_top_prop = maximum_div_scroll_top > 0 ? dummy_scroll_top / maximum_div_scroll_top : 0;
		    scroll_left_prop = clamp(scroll_left_prop, 0, 1);
		    scroll_top_prop = clamp(scroll_top_prop, 0, 1);
		    var maximum_scroll_left = maxOncoprintScrollLeft(self);
		    var maximum_scroll_top = maxOncoprintScrollTop(self);
		    var scroll_left = Math.round(maximum_scroll_left * scroll_left_prop);
		    var scroll_top = Math.round(maximum_scroll_top * scroll_top_prop);
		    self.keep_horz_zoomed_to_fit = false;

		    doSetScroll(self, scroll_left, scroll_top);
		}
	    });
	})();
	
	this.horz_zoom_callbacks = [];
	this.minimap_close_callbacks = [];
	
	
	$(window).resize(function() {
	    resizeAndOrganize(self);
	});
	
	
	this.id_clipboard = [];
	this.clipboard_change_callbacks = [];
    }

    var _SetLegendTop = function (oncoprint) {
	if (oncoprint.model.rendering_suppressed_depth > 0) {
	    return;
	}
	oncoprint.$legend_div.css({'top': oncoprint.model.getCellViewHeight() + 30});
    };
    var setLegendTopAfterTimeout = function (oncoprint) {
	if (oncoprint.model.rendering_suppressed_depth > 0) {
	    return;
	}
	setTimeout(function () {
	    oncoprint.$ctr.css({'min-height': oncoprint.model.getCellViewHeight() + Math.max(oncoprint.$legend_div.outerHeight(), oncoprint.$minimap_div.outerHeight()) + 30});
	    _SetLegendTop(oncoprint);
	}, 0);
    };

    var resizeAndOrganize = function (oncoprint) {
	if (oncoprint.model.rendering_suppressed_depth > 0) {
	    return;
	}
	var ctr_width = $(oncoprint.ctr_selector).width();
	oncoprint.$track_options_div.css({'left': oncoprint.label_view.getWidth()});
	oncoprint.$track_info_div.css({'left': oncoprint.label_view.getWidth() + oncoprint.track_options_view.getWidth()});
	var cell_div_left = oncoprint.label_view.getWidth() + oncoprint.track_options_view.getWidth() + oncoprint.track_info_view.getWidth();
	oncoprint.$cell_div.css('left', cell_div_left);
	oncoprint.cell_view.setWidth(ctr_width - cell_div_left - 20, oncoprint.model);

	_SetLegendTop(oncoprint);
	oncoprint.legend_view.setWidth(ctr_width - oncoprint.$minimap_div.outerWidth() - 20, oncoprint.model);

	oncoprint.$ctr.css({'min-height': oncoprint.model.getCellViewHeight() + Math.max(oncoprint.$legend_div.outerHeight(), oncoprint.$minimap_div.outerHeight()) + 30,
	    'min-width': ctr_width});

	setTimeout(function () {
	    if (oncoprint.keep_horz_zoomed_to_fit) {
		updateHorzZoomToFit(oncoprint);
	    }
	}, 0);
    };

    var resizeAndOrganizeAfterTimeout = function (oncoprint) {
	if (oncoprint.model.rendering_suppressed_depth > 0) {
	    return;
	}
	setTimeout(function () {
	    resizeAndOrganize(oncoprint);
	}, 0);
    };
    
    var maxOncoprintScrollLeft = function(oncoprint) {
	return Math.max(0, oncoprint.model.getOncoprintWidth() - oncoprint.cell_view.getWidth());
    };
    
    var maxOncoprintScrollTop = function(oncoprint) {
	return Math.max(0, oncoprint.model.getOncoprintHeight() - oncoprint.model.getCellViewHeight());
    };
    
    var maxDummyScrollDivScroll = function(oncoprint) {
	var dummy_scroll_div_client_size = oncoprint.cell_view.getDummyScrollDivClientSize();
	var maximum_div_scroll_left = Math.max(0, (oncoprint.$dummy_scroll_div[0].scrollWidth - dummy_scroll_div_client_size.width));
	var maximum_div_scroll_top = Math.max(0, (oncoprint.$dummy_scroll_div[0].scrollHeight - dummy_scroll_div_client_size.height));
	return {'left': maximum_div_scroll_left, 'top': maximum_div_scroll_top};
    };
    
    Oncoprint.prototype.setMinimapVisible = function (visible) {
	if (visible) {
	    this.$minimap_div.css({'display': 'block', 'top': this.model.getCellViewHeight() + 30, 'left': $(this.ctr_selector).width() - this.$minimap_div.outerWidth() - 10});
	} else {
	    this.$minimap_div.css('display', 'none');
	    executeMinimapCloseCallbacks(this);
	}
    }
    
    Oncoprint.prototype.scrollTo = function(left) {
	this.$dummy_scroll_div.scrollLeft(left);
    }
    Oncoprint.prototype.onHorzZoom = function(callback) {
	this.horz_zoom_callbacks.push(callback);
    }
    Oncoprint.prototype.onMinimapClose = function(callback) {
	this.minimap_close_callbacks.push(callback);
    }
    Oncoprint.prototype.moveTrack = function(target_track, new_previous_track) {
	this.model.moveTrack(target_track, new_previous_track);
	this.cell_view.moveTrack(this.model);
	this.label_view.moveTrack(this.model);
	this.track_options_view.moveTrack(this.model);
	this.track_info_view.moveTrack(this.model);
	this.minimap_view.moveTrack(this.model, this.cell_view);
	
	if (this.keep_sorted) {
	    this.sort();
	}
	
	resizeAndOrganizeAfterTimeout(this);
    }
    Oncoprint.prototype.setTrackGroupOrder = function(index, track_order) {
	this.model.setTrackGroupOrder(index, track_order);
	this.cell_view.setTrackGroupOrder(this.model);
	this.label_view.setTrackGroupOrder(this.model);
	this.track_options_view.setTrackGroupOrder(this.model);
	this.track_info_view.setTrackGroupOrder(this.model);
	
	if (this.keep_sorted) {
	    this.sort();
	}
	
	resizeAndOrganizeAfterTimeout(this);
    }
    
    Oncoprint.prototype.keepSorted = function(keep_sorted) {
	this.keep_sorted = (typeof keep_sorted === 'undefined' ? true : keep_sorted);
	if (this.keep_sorted) {
	    this.sort();
	}
    }
    
    Oncoprint.prototype.addTracks = function (params_list) {
	// Update model
	var track_ids = [];
	params_list = params_list.map(function (o) {
	    o.track_id = nextTrackId();
	    o.rule_set = OncoprintRuleSet(o.rule_set_params);
	    track_ids.push(o.track_id);
	    return o;
	});
	
	this.model.addTracks(params_list);
	// Update views
	this.cell_view.addTracks(this.model, track_ids);
	this.label_view.addTracks(this.model, track_ids);
	this.track_options_view.addTracks(this.model);
	this.track_info_view.addTracks(this.model);
	this.legend_view.addTracks(this.model);
	this.minimap_view.addTracks(this.model, this.cell_view);
	
	if (this.keep_sorted) {
	    this.sort();
	}
	resizeAndOrganizeAfterTimeout(this);
	return track_ids;
    }

    Oncoprint.prototype.removeTrack = function (track_id) {
	// Update model
	this.model.removeTrack(track_id);
	// Update views
	this.cell_view.removeTrack(this.model, track_id);
	this.label_view.removeTrack(this.model, track_id);
	this.track_options_view.removeTrack(this.model, track_id);
	this.track_info_view.removeTrack(this.model);
	this.legend_view.removeTrack(this.model);
	this.minimap_view.removeTrack(this.model, this.cell_view);
	
	if (this.keep_sorted) {
	    this.sort();
	}
	resizeAndOrganizeAfterTimeout(this);
    }
    
    Oncoprint.prototype.removeTracks = function(track_ids) {
	this.keepSorted(false);
	this.suppressRendering();
	for (var i=0; i<track_ids.length; i++) {
	    this.removeTrack(track_ids[i]);
	}
	this.keepSorted(true);
	this.releaseRendering();
    }
    
    Oncoprint.prototype.getTracks = function() {
	return this.model.getTracks().slice();
    }
    
    Oncoprint.prototype.removeAllTracks = function() {
	var track_ids = this.model.getTracks();
	this.removeTracks(track_ids);
    }

    Oncoprint.prototype.setHorzZoomToFit = function(ids) {
	this.keep_horz_zoomed_to_fit = true;
	this.updateHorzZoomToFitIds(ids);
	updateHorzZoomToFit(this);
    }
    Oncoprint.prototype.updateHorzZoomToFitIds = function(ids) {
	this.keep_horz_zoomed_to_fit_ids = ids.slice();
    }
    var updateHorzZoomToFit = function(oncoprint) {
	oncoprint.setHorzZoom(getHorzZoomToFit(oncoprint, oncoprint.keep_horz_zoomed_to_fit_ids), true);
    };
    var getHorzZoomToFit = function(oncoprint, ids) {
	ids = ids || [];
	return oncoprint.model.getHorzZoomToFit(oncoprint.cell_view.visible_area_width, ids);
    }
    var executeHorzZoomCallbacks = function(oncoprint) {
	for (var i=0; i<oncoprint.horz_zoom_callbacks.length; i++) {
	    oncoprint.horz_zoom_callbacks[i](oncoprint.model.getHorzZoom());
	}
    };
    
    var executeMinimapCloseCallbacks = function(oncoprint) {
	for (var i=0; i<oncoprint.minimap_close_callbacks.length; i++) {
	    oncoprint.minimap_close_callbacks[i]();
	}
    };
    
    Oncoprint.prototype.getHorzZoom = function () {
	return this.model.getHorzZoom();
    }
    

    Oncoprint.prototype.setHorzZoom = function (z, still_keep_horz_zoomed_to_fit) {
	this.keep_horz_zoomed_to_fit = this.keep_horz_zoomed_to_fit && still_keep_horz_zoomed_to_fit
	// Update model
	this.model.setHorzZoom(z);
	// Update views
	this.cell_view.setHorzZoom(this.model);
	this.minimap_view.setHorzZoom(this.model, this.cell_view);

	executeHorzZoomCallbacks(this);
	return this.model.getHorzZoom();
    }
    
    Oncoprint.prototype.getVertZoom = function () {
	return this.model.getVertZoom();
    }

    Oncoprint.prototype.setVertZoom = function (z) {
	// Update model
	this.model.setVertZoom(z);
	// Update views
	this.cell_view.setVertZoom(this.model, z);
	this.label_view.setVertZoom(this.model, z);
	this.track_info_view.setVertZoom(this.model);
	this.track_options_view.setVertZoom(this.model);
	this.minimap_view.setVertZoom(this.model, this.cell_view);
	
	resizeAndOrganizeAfterTimeout(this);
	return this.model.getVertZoom();
    }
    
    var doSetScroll = function(oncoprint, scroll_left, scroll_top) {
	// Update model
	scroll_left = Math.min(scroll_left, maxOncoprintScrollLeft(oncoprint));
	scroll_top = Math.min(scroll_top, maxOncoprintScrollTop(oncoprint));
	oncoprint.model.setScroll(scroll_left, scroll_top);
	// Update views
	
	oncoprint.cell_view.setScroll(oncoprint.model);
	oncoprint.label_view.setScroll(oncoprint.model);
	oncoprint.track_info_view.setScroll(oncoprint.model);
	oncoprint.track_options_view.setScroll(oncoprint.model);
	oncoprint.minimap_view.setScroll(oncoprint.model, oncoprint.cell_view);
    };
 
    var setDummyScrollDivScroll = function(oncoprint) {
	var scroll_left = oncoprint.model.getHorzScroll();
	var scroll_top = oncoprint.model.getVertScroll();
	
	var maximum_scroll_left = maxOncoprintScrollLeft(oncoprint);
	var maximum_scroll_top = maxOncoprintScrollTop(oncoprint);
	var onc_scroll_left_prop = maximum_scroll_left > 0 ? scroll_left/maximum_scroll_left : 0;
	var onc_scroll_top_prop = maximum_scroll_top > 0 ? scroll_top/maximum_scroll_top : 0;
	onc_scroll_left_prop = clamp(onc_scroll_left_prop, 0, 1);
	onc_scroll_top_prop = clamp(onc_scroll_top_prop, 0, 1);
	
	var maximum_dummy_scroll_div_scroll = maxDummyScrollDivScroll(oncoprint);
	var maximum_div_scroll_left = maximum_dummy_scroll_div_scroll.left;
	var maximum_div_scroll_top = maximum_dummy_scroll_div_scroll.top;
	
	oncoprint.target_dummy_scroll_left = Math.round(onc_scroll_left_prop * maximum_div_scroll_left);
	oncoprint.target_dummy_scroll_top = Math.round(onc_scroll_top_prop * maximum_div_scroll_top);
	oncoprint.$dummy_scroll_div.scrollLeft(oncoprint.target_dummy_scroll_left);
	oncoprint.$dummy_scroll_div.scrollTop(oncoprint.target_dummy_scroll_top);
    };
    
    Oncoprint.prototype.setScroll = function(scroll_left, scroll_top) {
	doSetScroll(this, scroll_left, scroll_top);
	setDummyScrollDivScroll(this);
    }
    
    Oncoprint.prototype.setZoom = function(zoom_x, zoom_y) {
	// Update model
	this.model.setZoom(zoom_x, zoom_y);
	// Update views
	this.cell_view.setZoom(this.model);
	this.label_view.setZoom(this.model);
	this.track_info_view.setZoom(this.model);
	this.track_options_view.setZoom(this.model);
	this.minimap_view.setZoom(this.model, this.cell_view);
    }
    
    Oncoprint.prototype.setHorzScroll = function(s) {
	// Update model
	this.model.setHorzScroll(Math.min(s, maxOncoprintScrollLeft(this)));
	// Update views
	this.cell_view.setHorzScroll(this.model);
	this.label_view.setHorzScroll(this.model);
	this.track_info_view.setHorzScroll(this.model);
	this.track_options_view.setHorzScroll(this.model);
	this.minimap_view.setHorzScroll(this.model, this.cell_view);
	// Update dummy scroll div
	setDummyScrollDivScroll(this);
	
	return this.model.getHorzScroll();
    }
    Oncoprint.prototype.setVertScroll = function(s) {
	// Update model
	this.model.setVertScroll(Math.min(s, maxOncoprintScrollTop(this)));
	// Update views
	this.cell_view.setVertScroll(this.model);
	this.label_view.setVertScroll(this.model);
	this.track_info_view.setVertScroll(this.model);
	this.track_options_view.setVertScroll(this.model);
	this.minimap_view.setVertScroll(this.model, this.cell_view);
	// Update dummy scroll div
	setDummyScrollDivScroll(this);
	
	return this.model.getVertScroll();
    }
    Oncoprint.prototype.setViewport = function(col, scroll_y_proportion, num_cols, zoom_y) {
	// Zoom
	var zoom_x = this.model.getHorzZoomToFitNumCols(this.cell_view.getWidth(), num_cols);
	this.setZoom(zoom_x, zoom_y);
	// Scroll
	var scroll_left = Math.min(col * (this.model.getCellWidth() + this.model.getCellPadding()), maxOncoprintScrollLeft(this));
	var scroll_top = Math.min(scroll_y_proportion*this.model.getOncoprintHeight(), maxOncoprintScrollTop(this));
	this.setScroll(scroll_left, scroll_top);
	
	executeHorzZoomCallbacks(this);
    }

    Oncoprint.prototype.getTrackData = function (track_id) {
	return this.model.getTrackData(track_id);
    }
    
    Oncoprint.prototype.getTrackDataIdKey = function(track_id) {
	return this.model.getTrackDataIdKey(track_id);
    }
    
    /**
     * Sets the data for an Oncoprint track.
     *
     * @param track_id - the ID that identifies the track
     * @param {Object[]} data - the list of data for the cells
     * @param {string} data_id_key - name of the property of the
     * data objects to use as the (column) key
     */
    Oncoprint.prototype.setTrackData = function (track_id, data, data_id_key) {
	this.model.setTrackData(track_id, data, data_id_key);
	this.cell_view.setTrackData(this.model, track_id);
	this.legend_view.setTrackData(this.model);
	this.minimap_view.setTrackData(this.model, this.cell_view);
	
	if (this.keep_sorted) {
	    this.sort();
	}
	resizeAndOrganizeAfterTimeout(this);
    }
    
    Oncoprint.prototype.setTrackGroupSortPriority = function(priority) {
	this.model.setTrackGroupSortPriority(priority);
	this.cell_view.setTrackGroupSortPriority(this.model);
	
	if (this.keep_sorted) {
	    this.sort();
	}
	resizeAndOrganizeAfterTimeout(this);
    }

    Oncoprint.prototype.setTrackSortDirection = function(track_id, dir) {
	if (this.model.isTrackSortDirectionChangeable(track_id)) {
	    this.model.setTrackSortDirection(track_id, dir);
	    
	    if (this.keep_sorted) {
		this.sort();
	    }
	}
	return this.model.getTrackSortDirection(track_id);
    }
    
    Oncoprint.prototype.setTrackSortComparator = function(track_id, sortCmpFn) {
	this.model.setTrackSortComparator(track_id, sortCmpFn);
	if (this.keep_sorted) {
	    this.sort();
	}
    }
    
    Oncoprint.prototype.getTrackSortDirection = function(track_id) {
	return this.model.getTrackSortDirection(track_id);
    }
    
    Oncoprint.prototype.setTrackInfo = function(track_id, msg) {
	this.model.setTrackInfo(track_id, msg);
	this.track_info_view.setTrackInfo(this.model);
    }
    
    Oncoprint.prototype.setTrackTooltipFn = function(track_id, tooltipFn) {
	this.model.setTrackTooltipFn(track_id, tooltipFn);
    }
    
    Oncoprint.prototype.sort = function() {
	this.model.sort();
	this.cell_view.sort(this.model);
	this.minimap_view.sort(this.model, this.cell_view);
    }
    
    Oncoprint.prototype.shareRuleSet = function(source_track_id, target_track_id) {
	this.model.shareRuleSet(source_track_id, target_track_id);
	this.cell_view.shareRuleSet(this.model, target_track_id);
	this.legend_view.shareRuleSet(this.model);
	this.minimap_view.shareRuleSet(this.model, this.cell_view);
    }
    
    Oncoprint.prototype.setRuleSet = function(track_id, rule_set_params) {
	this.model.setRuleSet(track_id, OncoprintRuleSet(rule_set_params));
	this.cell_view.setRuleSet(this.model, track_id);
	this.legend_view.setRuleSet(this.model);
	this.minimap_view.setRuleSet(this.model, this.cell_view);
	resizeAndOrganizeAfterTimeout(this);
    }
    
    Oncoprint.prototype.setSortConfig = function(params) {
	this.model.setSortConfig(params);
	this.cell_view.setSortConfig(this.model);
	
	if (this.keep_sorted) {
	    this.sort();
	}
    }
    Oncoprint.prototype.setIdOrder = function(ids) {
	// Update model
	this.model.setIdOrder(ids);
	// Update views
	this.cell_view.setIdOrder(this.model, ids);
	this.minimap_view.setIdOrder(this.model, this.cell_view);
	
	if (this.keep_sorted) {
	    this.sort();
	}
    }
    
    Oncoprint.prototype.disableInteraction = function() {
	//this.label_view.disableInteraction();
	//this.cell_view.disableInteraction();
	this.track_options_view.disableInteraction();
	//this.track_info_view.disableInteraction();
	//this.legend_view.disableInteraction();
    }
    Oncoprint.prototype.enableInteraction = function() {
	//this.label_view.enableInteraction();
	//this.cell_view.enableInteraction();
	this.track_options_view.enableInteraction();
	//this.track_info_view.enableInteraction();
	//this.legend_view.enableInteraction();
    }
    Oncoprint.prototype.suppressRendering = function() {
	this.model.rendering_suppressed_depth += 1;
	this.label_view.suppressRendering();
	this.cell_view.suppressRendering();
	this.track_options_view.suppressRendering();
	this.track_info_view.suppressRendering();
	this.legend_view.suppressRendering();
	this.minimap_view.suppressRendering();
    }
    
    Oncoprint.prototype.releaseRendering = function() {
	this.model.rendering_suppressed_depth -= 1;
	this.model.rendering_suppressed_depth = Math.max(0, this.model.rendering_suppressed_depth);
	if (this.model.rendering_suppressed_depth === 0) {
	    this.label_view.releaseRendering(this.model);
	    this.cell_view.releaseRendering(this.model);
	    this.track_options_view.releaseRendering(this.model);
	    this.track_info_view.releaseRendering(this.model);
	    this.legend_view.releaseRendering(this.model);
	    this.minimap_view.releaseRendering(this.model, this.cell_view);
	    resizeAndOrganizeAfterTimeout(this);
	}
    }
    
    Oncoprint.prototype.hideIds = function(to_hide, show_others) {
	this.model.hideIds(to_hide, show_others);
	this.cell_view.hideIds(this.model);
	this.minimap_view.hideIds(this.model, this.cell_view);
    }
    
    Oncoprint.prototype.hideTrackLegends = function(track_ids) {
	track_ids = [].concat(track_ids);
	this.model.hideTrackLegends(track_ids);
	this.legend_view.hideTrackLegends(this.model);
	setLegendTopAfterTimeout(this);
    }
    
    Oncoprint.prototype.showTrackLegends = function(track_ids) {
	track_ids = [].concat(track_ids);
	this.model.showTrackLegends(track_ids);
	this.legend_view.showTrackLegends(this.model);
	setLegendTopAfterTimeout(this);
    }
    
    Oncoprint.prototype.setCellPaddingOn = function(cell_padding_on) {
	this.model.setCellPaddingOn(cell_padding_on);
	this.cell_view.setCellPaddingOn(this.model);
    }
    
    Oncoprint.prototype.toSVG = function(with_background) {
	// Returns svg DOM element
	var root = svgfactory.svg(10, 10);
	this.$ctr.append(root);
	var everything_group = svgfactory.group(0,0);
	root.appendChild(everything_group);
	
	var bgrect = svgfactory.bgrect(10,10,'#ffffff');
	
	if (with_background) {
	    everything_group.appendChild(bgrect);
	}
	
	var label_view_group = this.label_view.toSVGGroup(this.model, true, 0, 0);
	everything_group.appendChild(label_view_group);
	var track_info_group_x = label_view_group.getBBox().width + 30;
	var track_info_group = this.track_info_view.toSVGGroup(this.model, track_info_group_x, 0);
	everything_group.appendChild(track_info_group);
	var cell_view_group_x = track_info_group_x + track_info_group.getBBox().width + 10;
	everything_group.appendChild(this.cell_view.toSVGGroup(this.model, cell_view_group_x, 0));
	everything_group.appendChild(this.legend_view.toSVGGroup(this.model, 0, label_view_group.getBBox().y + label_view_group.getBBox().height+20));
	
	var everything_box = everything_group.getBBox();
	var everything_width = everything_box.x + everything_box.width;
	var everything_height = everything_box.y + everything_box.height;
	root.setAttribute('width', everything_width);
	root.setAttribute('height', everything_height);
	
	if (with_background) {
	    bgrect.setAttribute('width', everything_width);
	    bgrect.setAttribute('height', everything_height);
	}
	root.parentNode.removeChild(root);
	
	return root;
    }
    
    Oncoprint.prototype.toCanvas = function(callback, resolution) {
	// Returns data url, requires IE >= 11
	
	var MAX_CANVAS_SIDE = 8192;
	var svg = this.toSVG(true);
	svg.setAttribute('xmlns', 'http://www.w3.org/2000/svg');
	var width = parseInt(svg.getAttribute('width'), 10);
	var height = parseInt(svg.getAttribute('height'), 10);
	var canvas = document.createElement('canvas');
	
	resolution = resolution || 1;
	var truncated = width*resolution > MAX_CANVAS_SIDE || height*resolution > MAX_CANVAS_SIDE;
	canvas.setAttribute('width', Math.min(MAX_CANVAS_SIDE, width*resolution));
	canvas.setAttribute('height', Math.min(MAX_CANVAS_SIDE, height*resolution));
	
	var container = document.createElement("div");
	container.appendChild(svg);
	var svg_data_str = container.innerHTML;
	var svg_data_uri = "data:image/svg+xml;base64,"+window.btoa(svg_data_str);
	
	var ctx = canvas.getContext('2d');
	ctx.setTransform(resolution,0,0,resolution,0,0);
	var img = new Image();
	
	img.onload = function() {
	    ctx.drawImage(img, 0, 0);
	    callback(canvas, truncated);
	};
	img.onerror = function() {
	    console.log("IMAGE LOAD ERROR");
	};
	
	img.src = svg_data_uri;
	return img;
    }
    
    Oncoprint.prototype.highlightTrack = function(track_id) {
	this.label_view.highlightTrack(track_id, this.model);
    }
    
    Oncoprint.prototype.getIdOrder = function(all) {
	return this.model.getIdOrder(all);
    }
    
    Oncoprint.prototype.setIdClipboardContents = function(array) {
	this.id_clipboard = array.slice();
	for (var i=0; i<this.clipboard_change_callbacks.length; i++) {
	    this.clipboard_change_callbacks[i](array);
	}
    }
    Oncoprint.prototype.getIdClipboardContents = function() {
	return this.id_clipboard.slice();
    }
    Oncoprint.prototype.onClipboardChange = function(callback) {
	this.clipboard_change_callbacks.push(callback);
    }
    
    return Oncoprint;
})();
module.exports = Oncoprint;
},{"./oncoprintlabelview.js":18,"./oncoprintlegendrenderer.js":19,"./oncoprintminimapview.js":20,"./oncoprintmodel.js":21,"./oncoprintruleset.js":22,"./oncoprinttooltip.js":26,"./oncoprinttrackinfoview.js":27,"./oncoprinttrackoptionsview.js":28,"./oncoprintwebglcellview.js":29,"./svgfactory.js":31}],18:[function(require,module,exports){
var svgfactory = require('./svgfactory.js');

var OncoprintLabelView = (function () {
    function OncoprintLabelView($canvas, model, tooltip) {
	var view = this;
	
	this.supersampling_ratio = 2;
	
	this.$canvas = $canvas;
	this.base_font_size = 14;
	this.model = model;
	this.tooltip = tooltip;
	this.tooltip.center = false;
	// stuff from model
	this.cell_tops = {};
	this.cell_tops_view_space = {};
	this.cell_heights = {};
	this.cell_heights_view_space = {};
	this.label_middles_view_space = {};
	this.labels = {};
	this.track_descriptions = {};
	this.tracks = [];
	this.minimum_track_height = Number.POSITIVE_INFINITY;
	this.maximum_label_width = Number.NEGATIVE_INFINITY;
	
	this.maximum_label_length = 18;
	this.rendering_suppressed = false;
	
	this.highlighted_track = null;
	
	setUpContext(this);
	
	(function setUpDragging(view) {
	    view.drag_callback = function(target_track, new_previous_track) {};
	    view.dragged_label_track_id = null;
	    view.drag_mouse_y = null;
	    
	    view.$canvas.on("mousedown", function(evt) {
		view.tooltip.hide();
		var track_id = isMouseOnLabel(view, evt.offsetY);
		if (track_id !== null && model.getContainingTrackGroup(track_id).length > 1) {
		    startDragging(view, track_id, evt.offsetY);
		}
	    });
	    
	    view.$canvas.on("mousemove", function(evt) {
		if (view.dragged_label_track_id !== null) {
		    var track_group = model.getContainingTrackGroup(view.dragged_label_track_id);
		    view.drag_mouse_y = Math.min(evt.pageY - view.$canvas.offset().top, view.track_tops[track_group[track_group.length-1]] + model.getTrackHeight(track_group[track_group.length-1]));
		    view.drag_mouse_y = Math.max(view.drag_mouse_y, view.track_tops[track_group[0]]-5);
		    renderAllLabels(view);
		} else {
		    var hovered_track = isMouseOnLabel(view, evt.pageY - view.$canvas.offset().top);
		    if (hovered_track !== null) {
			var $tooltip_div = $('<div>');
			var offset = view.$canvas.offset();   
			if (isNecessaryToShortenLabel(view, view.labels[hovered_track])) {
			    $tooltip_div.append($('<b>'+view.labels[hovered_track]+'</b>'));
			}
			var track_description = view.track_descriptions[hovered_track].replace("<", "&lt;").replace(">", "&gt;");
			if (track_description.length > 0) {
			    $tooltip_div.append(track_description + "<br>");
			}
			if (model.getContainingTrackGroup(hovered_track).length > 1) {
			    view.$canvas.css('cursor', 'move');
			    $tooltip_div.append("<b>hold to drag</b>");
			}
			view.tooltip.fadeIn(200, renderedLabelWidth(view, view.labels[hovered_track]) + offset.left, view.cell_tops[hovered_track] + offset.top - view.scroll_y, $tooltip_div);
		    } else {
			view.$canvas.css('cursor', 'auto');
			view.tooltip.hide();
		    }
		}
	    });
	    
	    view.$canvas.on("mouseup mouseleave", function(evt) {
		if (view.dragged_label_track_id !== null) {
		    var track_group = model.getContainingTrackGroup(view.dragged_label_track_id);
		    var previous_track_id = getLabelAboveMouseSpace(view, track_group, evt.offsetY, view.dragged_label_track_id);
		    stopDragging(view, previous_track_id);
		}
		view.tooltip.hide();
	    });
	})(this);
	
    }
    var renderedLabelWidth = function(view, label) {
	return view.ctx.measureText(shortenLabelIfNecessary(view, label)).width/view.supersampling_ratio;
    };
    var updateFromModel = function(view, model) {
	if (view.rendering_suppressed) {
	    return;
	}
	view.scroll_y = model.getVertScroll();
	view.track_tops = model.getZoomedTrackTops();
	view.cell_tops = model.getCellTops();
	view.cell_tops_view_space = {};
	view.cell_heights = {};
	view.tracks = model.getTracks();
	view.track_descriptions = {};
	
	view.ctx.font = 'bold '+view.getFontSize()+'px Arial';
	view.minimum_track_height = Number.POSITIVE_INFINITY;
	view.maximum_label_width = 0;
	for (var i=0; i<view.tracks.length; i++) {
	    view.minimum_track_height = Math.min(view.minimum_track_height, model.getTrackHeight(view.tracks[i]));
	    var shortened_label = shortenLabelIfNecessary(view, view.labels[view.tracks[i]]);
	    view.maximum_label_width = Math.max(view.maximum_label_width, view.ctx.measureText(shortened_label).width);
	    
	    view.cell_tops_view_space[view.tracks[i]] = view.cell_tops[view.tracks[i]]*view.supersampling_ratio - view.scroll_y*view.supersampling_ratio;
	    view.track_descriptions[view.tracks[i]] = model.getTrackDescription(view.tracks[i]);
	    view.cell_heights[view.tracks[i]] = model.getCellHeight(view.tracks[i]);
	    view.cell_heights_view_space[view.tracks[i]] = view.cell_heights[view.tracks[i]]*view.supersampling_ratio;
	    view.label_middles_view_space[view.tracks[i]] = view.cell_tops_view_space[view.tracks[i]] + view.cell_heights_view_space[view.tracks[i]]/2;
	}
    }
    var setUpContext = function(view) {
	view.ctx = view.$canvas[0].getContext('2d');
	view.ctx.textAlign="start";
	view.ctx.textBaseline="middle";
    }
    var resizeAndClear = function(view, model) {
	if (view.rendering_suppressed) {
	    return;
	}
	var visible_height = model.getCellViewHeight();
	var visible_width = view.getWidth();
	view.$canvas[0].height = view.supersampling_ratio*visible_height;
	view.$canvas[0].width = view.supersampling_ratio*visible_width;
	view.$canvas[0].style.height = visible_height + 'px';
	view.$canvas[0].style.width = visible_width + 'px';
	setUpContext(view);
    }
    var isNecessaryToShortenLabel = function(view, label) {
	return label.length > view.maximum_label_length;
    };
    var shortenLabelIfNecessary = function(view, label) {
	if (isNecessaryToShortenLabel(view, label)) {
	    return label.substring(0, view.maximum_label_length-3) + '...';
	} else {
	    return label;
	}
    };
    var renderAllLabels = function(view) {
	if (view.rendering_suppressed) {
	    return;
	}
	view.ctx.clearRect(0,0,view.$canvas[0].width,view.$canvas[0].height);
	
	if (view.highlighted_track !== null) {
	    if (view.cell_tops_view_space.hasOwnProperty(view.highlighted_track)) {
		view.ctx.fillStyle = 'rgba(255,255,0,0.4)';
		view.ctx.fillRect(0, view.cell_tops_view_space[view.highlighted_track], view.getWidth()*view.supersampling_ratio, view.cell_heights_view_space[view.highlighted_track]);
	    }
	}
	var font_size = view.getFontSize();
	view.ctx.font = 'bold '+font_size +'px Arial';
	view.ctx.fillStyle = 'black';
	var tracks = view.tracks;
	for (var i=0; i<tracks.length; i++) {
	    view.ctx.fillText(shortenLabelIfNecessary(view, view.labels[tracks[i]]), 0, view.label_middles_view_space[tracks[i]]);
	}
	if (view.dragged_label_track_id !== null) {
	    view.ctx.fillStyle = 'rgba(255,0,0,0.95)';
	    view.ctx.fillText(shortenLabelIfNecessary(view, view.labels[view.dragged_label_track_id]), 0, view.supersampling_ratio*view.drag_mouse_y);
	    view.ctx.fillStyle = 'rgba(0,0,0,0.15)';
	    var group = view.model.getContainingTrackGroup(view.dragged_label_track_id);
	    var label_above_mouse = getLabelAboveMouseSpace(view, group, view.drag_mouse_y, null);
	    var label_below_mouse = getLabelBelowMouseSpace(view, group, view.drag_mouse_y, null);
	    var rect_y, rect_height;
	    if (label_above_mouse === view.dragged_label_track_id || label_below_mouse === view.dragged_label_track_id) {
		return;
	    }
	    if (label_above_mouse !== null && label_below_mouse !== null) {
		rect_y = view.cell_tops_view_space[label_above_mouse] + view.cell_heights_view_space[label_above_mouse];
		rect_height = view.cell_tops_view_space[label_below_mouse] - rect_y;
	    } else if (label_above_mouse === null) {
		rect_y = view.cell_tops_view_space[group[0]] - view.ctx.measureText("m").width;
		rect_height = view.ctx.measureText("m").width;
	    } else if (label_below_mouse === null) {
		rect_y = view.cell_tops_view_space[group[group.length-1]] + view.cell_heights_view_space[group[group.length-1]];
		rect_height = view.ctx.measureText("m").width;
	    }
	    view.ctx.fillRect(0, rect_y, view.getWidth()*view.supersampling_ratio, rect_height);
	}
    }
    
    var isMouseOnLabel = function(view, mouse_y) {
	var candidate_track = getLabelAboveMouseSpace(view, view.tracks, mouse_y, null);
	if (candidate_track === null) {
	    return null;
	}
	if (mouse_y <= view.cell_tops[candidate_track] - view.scroll_y + view.cell_heights[candidate_track]) {
	    return candidate_track;
	} else {
	    return null;
	}
    }
    var getLabelAboveMouseSpace = function(view, track_ids, y, track_to_exclude) {
	if (y < view.cell_tops[track_ids[0]] - view.scroll_y) {
	    return null;
	} else {
	    var candidate_track = null;
	    for (var i=0; i<track_ids.length; i++) {
		if (track_to_exclude !== null && track_to_exclude === track_ids[i]) {
		    continue;
		}
		if (view.cell_tops[track_ids[i]] - view.scroll_y > y) {
		    break;
		} else {
		    candidate_track = track_ids[i];
		}
	    }
	    return candidate_track;
	}
    }
    var getLabelBelowMouseSpace = function(view, track_ids, y, track_to_exclude) {
	if (y > view.cell_tops[track_ids[track_ids.length-1]] - view.scroll_y) {
	    return null;
	} else {
	    var candidate_track = null;
	    for (var i=track_ids.length-1; i>=0; i--) {
		if (track_to_exclude !== null && track_to_exclude === track_ids[i]) {
		    continue;
		}
		if (view.cell_tops[track_ids[i]] - view.scroll_y < y) {
		    break;
		} else {
		    candidate_track = track_ids[i];
		}
	    }
	    return candidate_track;
	}
    }
    
    var startDragging = function(view, track_id, mouse_y) {
	view.dragged_label_track_id = track_id;
	view.drag_mouse_y = mouse_y;
	renderAllLabels(view);
    }
    var stopDragging = function(view, new_previous_track_id) {
	view.drag_callback(view.dragged_label_track_id, new_previous_track_id);
	view.dragged_label_track_id = null;
	renderAllLabels(view);
    }
    
    OncoprintLabelView.prototype.getWidth = function() {
	//return this.maximum_label_width + 20;
	return Math.max(this.maximum_label_width/this.supersampling_ratio + 10, 70);
    }
    OncoprintLabelView.prototype.getFontSize = function(no_supersampling_adjustment) {
	return (no_supersampling_adjustment ? 1 : this.supersampling_ratio) * Math.max(Math.min(this.base_font_size, this.minimum_track_height), 7);
    }
    OncoprintLabelView.prototype.setDragCallback = function(callback) {
	this.drag_callback = callback;
    }
    OncoprintLabelView.prototype.removeTrack = function (model, track_id) {
	updateFromModel(this, model);
	resizeAndClear(this, model);
	renderAllLabels(this, model);
    }
    OncoprintLabelView.prototype.moveTrack = function (model) {
	updateFromModel(this, model);
	resizeAndClear(this, model);
	renderAllLabels(this, model);
    }
    OncoprintLabelView.prototype.setTrackGroupOrder = function (model) {
	updateFromModel(this, model);
	resizeAndClear(this, model);
	renderAllLabels(this, model);
    }
    OncoprintLabelView.prototype.addTracks = function (model, track_ids) {
	for (var i=0; i<track_ids.length; i++) {
	    this.labels[track_ids[i]] = model.getTrackLabel(track_ids[i]);
	}
	updateFromModel(this, model);
	resizeAndClear(this, model);
	renderAllLabels(this, model);
    }
    
    OncoprintLabelView.prototype.setScroll = function(model) {
	this.setVertScroll(model);
    }
    
    OncoprintLabelView.prototype.setHorzScroll = function(model) {
    }
    
    OncoprintLabelView.prototype.setViewport = function(model) {
	this.setVertScroll(model);
    }
    
    OncoprintLabelView.prototype.setVertScroll = function(model) {
	updateFromModel(this, model);
	resizeAndClear(this, model);
	renderAllLabels(this, model);
    }
    
    OncoprintLabelView.prototype.setVertZoom = function(model) {
	updateFromModel(this, model);
	resizeAndClear(this, model);
	renderAllLabels(this, model);
    }
    
    OncoprintLabelView.prototype.setZoom = function(model) {
	this.setVertZoom(model);
    }
    
    OncoprintLabelView.prototype.highlightTrack = function(track_id, model) {
	// track_id is a track id, or null to clear highlight
	this.highlighted_track = track_id;
	renderAllLabels(this, model);
    }
    
    OncoprintLabelView.prototype.suppressRendering = function() {
	this.rendering_suppressed = true;
    }
    
    OncoprintLabelView.prototype.releaseRendering = function(model) {
	this.rendering_suppressed = false;
	updateFromModel(this, model);
	resizeAndClear(this, model);
	renderAllLabels(this);
    }
    
    OncoprintLabelView.prototype.toSVGGroup = function(model, full_labels, offset_x, offset_y) {
	var root = svgfactory.group((offset_x || 0), (offset_y || 0));
	var cell_tops = model.getCellTops();
	var tracks = model.getTracks();
	for (var i=0; i<tracks.length; i++) {
	    var track_id = tracks[i];
	    var y = cell_tops[track_id] + model.getCellHeight(track_id)/2;
	    var label = model.getTrackLabel(track_id);
	    var text_elt = svgfactory.text((full_labels ? label : shortenLabelIfNecessary(this, label)), 0, y, this.getFontSize(true), 'Arial', 'bold', "bottom"); 
	    text_elt.setAttribute("dy", "0.35em");
	    root.appendChild(text_elt);
	}
	return root;
    }

    return OncoprintLabelView;
})();

module.exports = OncoprintLabelView;
},{"./svgfactory.js":31}],19:[function(require,module,exports){
var svgfactory = require('./svgfactory.js');

var nodeIsVisible = function(node) {
    var ret = true;
    while (node.tagName.toLowerCase() !== "html") {
	if ($(node).css('display') === 'none') {
	    ret = false;
	    break;
	}
	node = node.parentNode;
    }
    return ret;
};

var OncoprintLegendView = (function() {
    function OncoprintLegendView($div, base_width, base_height) {
	this.$div = $div;
	this.$svg = $(svgfactory.svg(200,200)).appendTo(this.$div);
	this.base_width = base_width;
	this.base_height = base_height;
	this.rendering_suppressed = false;
	
	this.width = $div.width();
	
	this.rule_set_label_config = {
	    weight: 'bold',
	    size: 12,
	    font: 'Arial'
	};
	this.rule_label_config = {
	    weight: 'normal',
	    size: 12,
	    font: 'Arial'
	};
	
	this.padding_after_rule_set_label = 10;
	this.padding_between_rules = 20;
	this.padding_between_rule_set_rows = 10;
    }
    
    var renderLegend = function(view, model, target_svg, show_all) {
	if (view.rendering_suppressed) {
	    return;
	}
	if (typeof target_svg === 'undefined') {
	    target_svg = view.$svg[0];
	}
	if (!nodeIsVisible(target_svg)) {
	    return;
	}
	$(target_svg).empty();
	var defs = svgfactory.defs();
	target_svg.appendChild(defs);
	
	var everything_group = svgfactory.group(0,0);
	target_svg.appendChild(everything_group);
	
	var rule_sets = model.getRuleSets();
	var y = 0;
	var rule_start_x = 200;
	for (var i=0; i<rule_sets.length; i++) {
	    if (rule_sets[i].exclude_from_legend && !show_all) {
		continue;
	    }
	    var rule_set_group = svgfactory.group(0,y);
	    everything_group.appendChild(rule_set_group);
	    (function addLabel() {
		if ((typeof rule_sets[i].legend_label !== 'undefined') && rule_sets[i].legend_label.length > 0) {
		    var label = svgfactory.text(rule_sets[i].legend_label, 0, 0, 12, 'Arial', 'bold');
		    rule_set_group.appendChild(label);
		    svgfactory.wrapText(label, rule_start_x);
		}
	    })();
	    
	    var x = rule_start_x + view.padding_after_rule_set_label;
	    var in_group_y_offset = 0;
	    
	    var rules = model.getActiveRules(rule_sets[i].rule_set_id);
	    for (var j=0; j<rules.length; j++) {
		var rule = rules[j].rule;
		if (rule.exclude_from_legend) {
		    continue;
		}
		var group = ruleToSVGGroup(rule, view, model, target_svg, defs);
		group.setAttribute('transform', 'translate('+x+','+in_group_y_offset+')');
		rule_set_group.appendChild(group);
		if (x + group.getBBox().width > view.width) {
		    x = rule_start_x + view.padding_after_rule_set_label;
		    in_group_y_offset = rule_set_group.getBBox().height + view.padding_between_rule_set_rows;
		    group.setAttribute('transform', 'translate('+x+','+in_group_y_offset+')');
		}
		x += group.getBBox().width;
		x += view.padding_between_rules;
	    }
	    y += rule_set_group.getBBox().height;
	    y += 3*view.padding_between_rule_set_rows;
	}
	var everything_box = everything_group.getBBox();
	view.$svg[0].setAttribute('width', everything_box.width);
	view.$svg[0].setAttribute('height', everything_box.height);
    };
    
    var ruleToSVGGroup = function(rule, view, model, target_svg, target_defs) {
	var root = svgfactory.group(0,0);
	var config = rule.getLegendConfig();
	if (config.type === 'rule') {
	    var concrete_shapes = rule.apply(config.target, model.getCellWidth(true), view.base_height);
	    for (var i=0; i<concrete_shapes.length; i++) {
		root.appendChild(svgfactory.fromShape(concrete_shapes[i], 0, 0));
	    }
	    if (typeof rule.legend_label !== 'undefined') {
		var font_size = 12;
		var text_node = svgfactory.text(rule.legend_label, model.getCellWidth(true) + 5, view.base_height/2, font_size, 'Arial', 'normal');
		target_svg.appendChild(text_node);
		var height = text_node.getBBox().height;
		text_node.setAttribute('y', parseFloat(text_node.getAttribute('y')) - height/2);
		target_svg.removeChild(text_node);
		root.appendChild(text_node);
	    }
	} else if (config.type === 'number') {
	    var num_decimal_digits = 2;
	    var display_range = config.range.map(function(x) {
		var num_digit_multiplier = Math.pow(10, num_decimal_digits);
		return Math.round(x * num_digit_multiplier) / num_digit_multiplier;
	    });
	    root.appendChild(svgfactory.text(display_range[0], 0, 0, 12, 'Arial', 'normal'));
	    root.appendChild(svgfactory.text(display_range[1], 50, 0, 12, 'Arial', 'normal'));
	    var mesh = 100;
	    var points = [];
	    points.push([5, 20]);
	    for (var i=0; i<mesh; i++) {
		var t = i/mesh;
		var h = config.interpFn((1-t)*config.range[0] + t*config.range[1]);
		var height = 20*h;
		points.push([5 + 40*i/mesh, 20-height]);
	    }
	    points.push([45, 20]);
	    root.appendChild(svgfactory.path(points, config.color, config.color));
	} else if (config.type === 'gradient') {
	    var num_decimal_digits = 2;
	    var display_range = config.range.map(function(x) {
		var num_digit_multiplier = Math.pow(10, num_decimal_digits);
		return Math.round(x * num_digit_multiplier) / num_digit_multiplier;
	    });
	    var gradient = svgfactory.gradient(config.colorFn);
	    var gradient_id = gradient.getAttribute("id");
	    target_defs.appendChild(gradient);
	    root.appendChild(svgfactory.text(display_range[0], 0, 0, 12, 'Arial', 'normal'));
	    root.appendChild(svgfactory.text(display_range[1], 120, 0, 12, 'Arial', 'normal'));
	    root.appendChild(svgfactory.rect(30,0,60,20,"url(#"+gradient_id+")"));
	}
	return root;
    };
    
    OncoprintLegendView.prototype.setWidth = function(w, model) {
	this.width = w;
	renderLegend(this, model);
    }
    OncoprintLegendView.prototype.removeTrack = function(model) {
	renderLegend(this, model);
    }
    
    OncoprintLegendView.prototype.addTracks = function(model) {
	renderLegend(this, model);
    }
    
    OncoprintLegendView.prototype.setTrackData = function(model) {
	renderLegend(this, model);
    }
    
    OncoprintLegendView.prototype.shareRuleSet = function(model) {
	renderLegend(this, model);
    }
    
    OncoprintLegendView.prototype.setRuleSet = function(model) {
	renderLegend(this, model);
    }
    
    OncoprintLegendView.prototype.hideTrackLegends = function(model) {
	renderLegend(this, model);
    }
    
    OncoprintLegendView.prototype.showTrackLegends = function(model) {
	renderLegend(this, model);
    }
    
    OncoprintLegendView.prototype.suppressRendering = function() {
	this.rendering_suppressed = true;
    }
    
    OncoprintLegendView.prototype.releaseRendering = function(model) {
	this.rendering_suppressed = false;
	renderLegend(this, model);
    }
    
    OncoprintLegendView.prototype.toSVGGroup = function(model, offset_x, offset_y) {
	var root = svgfactory.group((offset_x || 0), (offset_y || 0));
	this.$svg.append(root);
	renderLegend(this, model, root, true);
	root.parentNode.removeChild(root);
	return root;
    }
    
    return OncoprintLegendView;
})();

module.exports = OncoprintLegendView;
},{"./svgfactory.js":31}],20:[function(require,module,exports){
var gl_matrix = require('gl-matrix');
var OncoprintZoomSlider = require('./oncoprintzoomslider.js');

var arrayFindIndex = function (arr, callback, start_index) {
    start_index = start_index || 0;
    for (var i = start_index; i < arr.length; i++) {
	if (callback(arr[i])) {
	    return i;
	}
    }
    return -1;
};

var getWebGLCanvasContext = function (view) {
    try {
	var canvas = view.$canvas[0];
	var ctx = canvas.getContext("experimental-webgl", {alpha: false, antialias: true});
	ctx.clearColor(1.0, 1.0, 1.0, 1.0);
	ctx.clear(ctx.COLOR_BUFFER_BIT | ctx.DEPTH_BUFFER_BIT);
	ctx.viewportWidth = canvas.width;
	ctx.viewportHeight = canvas.height;
	ctx.viewport(0, 0, ctx.viewportWidth, ctx.viewportHeight);
	ctx.enable(ctx.DEPTH_TEST);
	ctx.enable(ctx.BLEND);
	ctx.blendEquation(ctx.FUNC_ADD);
	ctx.blendFunc(ctx.SRC_ALPHA, ctx.ONE_MINUS_SRC_ALPHA);
	ctx.depthMask(false);

	return ctx;
    } catch (e) {
	return null;
    }
};
var createShaderProgram = function (view, vertex_shader, fragment_shader) {
    var program = view.ctx.createProgram();
    view.ctx.attachShader(program, vertex_shader);
    view.ctx.attachShader(program, fragment_shader);

    view.ctx.linkProgram(program);

    var success = view.ctx.getProgramParameter(program, view.ctx.LINK_STATUS);
    if (!success) {
	var msg = view.ctx.getProgramInfoLog(program);
	view.ctx.deleteProgram(program);
	throw "Unable to link shader program: " + msg;
    }

    return program;
};
var createShader = function (view, source, type) {
    var shader = view.ctx.createShader(view.ctx[type]);
    view.ctx.shaderSource(shader, source);
    view.ctx.compileShader(shader);

    var success = view.ctx.getShaderParameter(shader, view.ctx.COMPILE_STATUS);
    if (!success) {
	var msg = view.ctx.getShaderInfoLog(shader);
	view.ctx.deleteShader(shader);
	throw "Unable to compile shader: " + msg;
    }

    return shader;
};
var getWebGLContextAndSetUpMatrices = function (view) {
    view.ctx = getWebGLCanvasContext(view);
    (function initializeMatrices(self) {
	var mvMatrix = gl_matrix.mat4.create();
	gl_matrix.mat4.lookAt(mvMatrix, [0, 0, 1], [0, 0, 0], [0, 1, 0]);
	self.mvMatrix = mvMatrix;

	var pMatrix = gl_matrix.mat4.create();
	gl_matrix.mat4.ortho(pMatrix, 0, self.ctx.viewportWidth, self.ctx.viewportHeight, 0, -5, 1000); // y axis inverted so that y increases down like SVG
	self.pMatrix = pMatrix;
    })(view);
};
var getWebGLContextAndSetUpMatricesAndShaders = function (view) {
    getWebGLContextAndSetUpMatrices(view);
    (function initializeShaders(self) {// Initialize shaders
	var vertex_shader_source = ['attribute vec3 aVertexPosition;',
	    'attribute vec4 aVertexColor;',
	    'attribute float aVertexOncoprintColumn;',
	    'uniform float columnWidth;',
	    'uniform float zoomX;',
	    'uniform float zoomY;',
	    'uniform mat4 uMVMatrix;',
	    'uniform mat4 uPMatrix;',
	    'uniform float offsetY;',
	    'varying vec4 vColor;',
	    'void main(void) {',
	    '	gl_Position = vec4(aVertexPosition, 1.0);',
	    '	gl_Position[0] += aVertexOncoprintColumn * columnWidth;',
	    '	gl_Position[1] += offsetY;',
	    '	gl_Position *= vec4(zoomX, zoomY, 1.0, 1.0);',
	    '	gl_Position = uPMatrix * uMVMatrix * gl_Position;',
	    '	vColor = aVertexColor;',
	    '}'].join('\n');
	var fragment_shader_source = ['precision mediump float;',
	    'varying vec4 vColor;',
	    '',
	    'void main(void) {',
	    '   gl_FragColor = vColor;',
	    '}'].join('\n');
	var vertex_shader = createShader(self, vertex_shader_source, 'VERTEX_SHADER');
	var fragment_shader = createShader(self, fragment_shader_source, 'FRAGMENT_SHADER');

	var shader_program = createShaderProgram(self, vertex_shader, fragment_shader);
	shader_program.vertexPositionAttribute = self.ctx.getAttribLocation(shader_program, 'aVertexPosition');
	self.ctx.enableVertexAttribArray(shader_program.vertexPositionAttribute);
	shader_program.vertexColorAttribute = self.ctx.getAttribLocation(shader_program, 'aVertexColor');
	self.ctx.enableVertexAttribArray(shader_program.vertexColorAttribute);
	shader_program.vertexOncoprintColumnAttribute = self.ctx.getAttribLocation(shader_program, 'aVertexOncoprintColumn');
	self.ctx.enableVertexAttribArray(shader_program.vertexOncoprintColumnAttribute);

	shader_program.pMatrixUniform = self.ctx.getUniformLocation(shader_program, 'uPMatrix');
	shader_program.mvMatrixUniform = self.ctx.getUniformLocation(shader_program, 'uMVMatrix');
	shader_program.columnWidthUniform = self.ctx.getUniformLocation(shader_program, 'columnWidth');
	shader_program.zoomXUniform = self.ctx.getUniformLocation(shader_program, 'zoomX');
	shader_program.zoomYUniform = self.ctx.getUniformLocation(shader_program, 'zoomY');
	shader_program.offsetYUniform = self.ctx.getUniformLocation(shader_program, 'offsetY');

	self.shader_program = shader_program;
    })(view);
};

var clamp = function(x, lower, upper) {
    return Math.max(lower, Math.min(upper, x));
};

var OncoprintMinimapView = (function () {

    function OncoprintMinimapView($div, $canvas, $overlay_canvas, model, cell_view, width, height, drag_callback, viewport_callback, horz_zoom_callback, vert_zoom_callback, zoom_to_fit_callback, close_callback) {
	this.$div = $div;
	this.$canvas = $canvas;
	this.$overlay_canvas = $overlay_canvas;

	var self = this;
	var padding = 4;
	var vertical_zoom_area_width = 20;
	var horizontal_zoom_area_height = 20;
	var window_bar_height = 20;

	this.layout_numbers = {
	    window_width: padding + width + padding + vertical_zoom_area_width,
	    window_height: window_bar_height + padding + height + padding + horizontal_zoom_area_height,
	    vertical_zoom_area_width: vertical_zoom_area_width,
	    horizontal_zoom_area_height: horizontal_zoom_area_height,
	    padding: padding,
	    window_bar_height: window_bar_height,
	    canvas_left: padding,
	    canvas_top: window_bar_height + padding,
	};
	this.$div.css({'min-width': this.layout_numbers.window_width,
			'min-height': this.layout_numbers.window_height,
			'outline':'solid 1px black', 'background-color':'#ffffff'});
		    
	this.$window_bar = $('<div>').css({'position':'absolute', 
					    'min-width': this.layout_numbers.window_width,
					    'min-height': this.layout_numbers.window_bar_height,
					    'background-color':'#cccccc'})
						.appendTo(this.$div);
					
	this.$close_btn = $('<div>').css({'position':'absolute',
					    'top': 3,
					    'left': 3,
					    'min-width': this.layout_numbers.window_bar_height - 6,
					    'min-height': this.layout_numbers.window_bar_height - 6,
					    'cursor': 'pointer'})
						.appendTo(this.$div);
	$('<span>').addClass("icon fa fa-times-circle").css('font-size', (this.layout_numbers.window_bar_height - 6) + "px").appendTo(this.$close_btn);
	
	this.$close_btn.click(close_callback || function(){});
	
	this.$canvas[0].width = width;
	this.$canvas[0].height = height;
	this.$canvas.css({'top': this.layout_numbers.canvas_top, 'left':this.layout_numbers.canvas_left});
	this.$overlay_canvas[0].width = width;
	this.$overlay_canvas[0].height = width;
	this.$overlay_canvas.css({'top': this.layout_numbers.canvas_top, 'left':this.layout_numbers.canvas_left, 'outline':'solid 1px #444444'});
	
	this.horizontal_zoom = new OncoprintZoomSlider(this.$div, {'btn_size': this.layout_numbers.horizontal_zoom_area_height - padding,
								    'horizontal': true,
								    'width': width,
								    'init_val': model.getHorzZoom(),
								    'left': padding,
								    'top': this.layout_numbers.canvas_top + height + padding,
								    'onChange': function(val) { horz_zoom_callback(val); }});
	this.vertical_zoom = new OncoprintZoomSlider(this.$div, {'btn_size': this.layout_numbers.vertical_zoom_area_width - padding,
								    'vertical': true,
								    'height': height,
								    'init_val': model.getVertZoom(),
								    'left': this.layout_numbers.canvas_left + width + padding,
								    'top': this.layout_numbers.window_bar_height + padding,
								    'onChange': function(val) { vert_zoom_callback(val); }});							
	
	(function setUpZoomToFitButton() {
	    var $btn = $('<div>').css({'position': 'absolute',
		'min-height': self.layout_numbers.horizontal_zoom_area_height - padding,
		'min-width': self.layout_numbers.vertical_zoom_area_width - padding,
		'background-color': '#ffffff',
		'outline': 'solid 1px black',
		'left': self.layout_numbers.canvas_left + width + padding,
		'top': self.layout_numbers.canvas_top + height + padding,
		'cursor': 'pointer'})
		    .appendTo($div);
	    $("<img>").appendTo($btn).attr({"src": "images/fitalteredcases.svg",
		"preserveaspectratio": "none",
		"width": parseInt($btn.css('min-width'),10) - 4,
		"height": parseInt($btn.css('min-height'),10) - 4}).css({'position':'absolute', 'top': 2, 'left': 2});
	    $btn.hover(function () {
		$(this).css({'background-color': '#cccccc'});
	    }, function () {
		$(this).css({'background-color': '#ffffff'});
	    });
	    
	    zoom_to_fit_callback = zoom_to_fit_callback || function() {};
	    $btn.click(zoom_to_fit_callback);
	})();
	getWebGLContextAndSetUpMatricesAndShaders(this);
	this.overlay_ctx = $overlay_canvas[0].getContext("2d");

	this.img = new Image();
	this.current_rect = {'top': 0, 'left': 0, 'width': 0, 'height': 0, 'col':0, 'num_cols':0};

	var self = this;
	this.img.onload = function () {
	    self.ctx.drawImage(img, 0, 0);
	};

	// Set up dragging
	var resize_hit_zone = 5;
	var mouseInRectDragZone = function (x, y) {
	    return ((x >= self.current_rect.left + resize_hit_zone) &&
		    (x <= self.current_rect.left + self.current_rect.width - resize_hit_zone) &&
		    (y >= self.current_rect.top + resize_hit_zone) &&
		    (y <= self.current_rect.top + self.current_rect.height - resize_hit_zone));
	};
	var mouseInsideRectHitZone = function(x,y) {
	    return (x >= self.current_rect.left - resize_hit_zone) && 
		    (x <= self.current_rect.left + self.current_rect.width + resize_hit_zone) &&
		    (y >= self.current_rect.top - resize_hit_zone) && 
		    (y <= self.current_rect.top + self.current_rect.height + resize_hit_zone);
	};
	var mouseInRightHorzResizeZone = function (x,y) {
	    return !mouseInTopLeftResizeZone(x,y) && !mouseInTopRightResizeZone(x,y) &&
		    !mouseInBottomLeftResizeZone(x,y) && !mouseInBottomRightResizeZone(x,y) &&
		    mouseInsideRectHitZone(x,y) &&
		    (Math.abs(x - (self.current_rect.left + self.current_rect.width)) < resize_hit_zone);
	};
	var mouseInLeftHorzResizeZone = function (x,y) {
	    return !mouseInTopLeftResizeZone(x,y) && !mouseInTopRightResizeZone(x,y) &&
		    !mouseInBottomLeftResizeZone(x,y) && !mouseInBottomRightResizeZone(x,y) &&
		    mouseInsideRectHitZone(x,y) &&
		    (Math.abs(x - self.current_rect.left) < resize_hit_zone);
	};
	var mouseInTopVertResizeZone = function (x,y) {
	    return !mouseInTopLeftResizeZone(x,y) && !mouseInTopRightResizeZone(x,y) &&
		    !mouseInBottomLeftResizeZone(x,y) && !mouseInBottomRightResizeZone(x,y) &&
		    mouseInsideRectHitZone(x,y) &&
		    (Math.abs(y - self.current_rect.top) < resize_hit_zone);
	};
	var mouseInBottomVertResizeZone = function (x, y) {
	    return !mouseInTopLeftResizeZone(x, y) && !mouseInTopRightResizeZone(x, y) &&
		    !mouseInBottomLeftResizeZone(x, y) && !mouseInBottomRightResizeZone(x, y) &&
		    mouseInsideRectHitZone(x,y) &&
		    (Math.abs(y - (self.current_rect.top + self.current_rect.height)) < resize_hit_zone);
	};
	var mouseInTopLeftResizeZone = function(x,y) {
	    return (Math.abs(y - self.current_rect.top) < resize_hit_zone) &&
		    (Math.abs(x - self.current_rect.left) < resize_hit_zone);
	};
	var mouseInBottomLeftResizeZone = function(x,y) {
	    return (Math.abs(y - (self.current_rect.top + self.current_rect.height)) < resize_hit_zone) &&
		    (Math.abs(x - self.current_rect.left) < resize_hit_zone);
	};
	var mouseInTopRightResizeZone = function(x,y) {
	    return (Math.abs(y - self.current_rect.top) < resize_hit_zone) &&
		    (Math.abs(x - (self.current_rect.left + self.current_rect.width)) < resize_hit_zone);
	};
	var mouseInBottomRightResizeZone = function(x,y) {
	    return (Math.abs(y - (self.current_rect.top + self.current_rect.height)) < resize_hit_zone) &&
		    (Math.abs(x - (self.current_rect.left + self.current_rect.width)) < resize_hit_zone);
	};
	
	this.resize_hover = false;
	var updateRectResizeHoverLocation = function(x,y) {
	    if (typeof x === "undefined") {
		self.resize_hover = false;
	    } else {
		if (mouseInRightHorzResizeZone(x, y)) {
		    self.resize_hover = "r";
		} else if (mouseInLeftHorzResizeZone(x, y)) {
		    self.resize_hover = "l";
		} else if (mouseInTopVertResizeZone(x, y)) {
		    self.resize_hover = "t";
		} else if (mouseInBottomVertResizeZone(x, y)) {
		    self.resize_hover = "b";
		} else if (mouseInTopLeftResizeZone(x, y)) {
		    self.resize_hover = "tl";
		} else if (mouseInBottomRightResizeZone(x, y)) {
		    self.resize_hover = "br";
		} else if (mouseInBottomLeftResizeZone(x, y)) {
		    self.resize_hover = "bl";
		} else if (mouseInTopRightResizeZone(x, y)) {
		    self.resize_hover = "tr";
		} else {
		    self.resize_hover = false;
		}
	    }
	};
	var updateCSSCursor = function(x, y) {
	    var cursor_val;
	    if (typeof x === "undefined") {
		cursor_val = 'auto';
	    } else {
		if (mouseInRectDragZone(x, y)) {
		    cursor_val = 'move';
		} else if (mouseInRightHorzResizeZone(x, y) || mouseInLeftHorzResizeZone(x, y)) {
		    cursor_val = 'ew-resize';
		} else if (mouseInTopVertResizeZone(x, y) || mouseInBottomVertResizeZone(x, y)) {
		    cursor_val = 'ns-resize';
		} else if (mouseInTopLeftResizeZone(x, y) || mouseInBottomRightResizeZone(x, y)) {
		    cursor_val = 'nwse-resize';
		} else if (mouseInBottomLeftResizeZone(x, y) || mouseInTopRightResizeZone(x, y)) {
		    cursor_val = 'nesw-resize';
		} else {
		    cursor_val = 'auto';
		}
	    }
	    $div.css('cursor', cursor_val);
	};
	var getCanvasMouse = function(view, div_mouse_x, div_mouse_y) {
	    var canv_top = parseInt(view.$canvas[0].style.top, 10);
	    var canv_left = parseInt(view.$canvas[0].style.left, 10);
	    var canv_width = parseInt(view.$canvas[0].width, 10);
	    var canv_height = parseInt(view.$canvas[0].height, 10);
	    
	    var mouse_x = div_mouse_x - canv_left;
	    var mouse_y = div_mouse_y - canv_top;
	    
	    var outside = mouse_x < 0 || mouse_x >= canv_width || mouse_y < 0 || mouse_y >= canv_height;
	    
	    return {'mouse_x': mouse_x,
		    'mouse_y': mouse_y,
		    'outside': outside};
	};
	var dragging = false;
	var drag_type = false;
	var drag_start_col = -1;
	var drag_start_vert_scroll = -1;
	var drag_start_x = -1;
	var drag_start_y = -1;
	var drag_start_vert_zoom = -1;
	var y_ratio = -1;
	$(document).on("mousedown", function (evt) {
	    var offset = self.$div.offset();
	    var overlay_mouse_x = evt.pageX - offset.left;
	    var overlay_mouse_y = evt.pageY - offset.top;
	    var mouse = getCanvasMouse(self, overlay_mouse_x, overlay_mouse_y);
	    
	    if (!mouse.outside) {
		var mouse_x = mouse.mouse_x;
		var mouse_y = mouse.mouse_y;
		dragging = false;
		drag_type = false;


		y_ratio = model.getOncoprintHeight() / parseInt(self.$canvas[0].height, 10);
		if (mouseInRectDragZone(mouse_x, mouse_y)) {
		    drag_type = "move";
		} else if (mouseInRightHorzResizeZone(mouse_x, mouse_y)) {
		    drag_type = "resize_r";
		} else if (mouseInLeftHorzResizeZone(mouse_x, mouse_y)) {
		    drag_type = "resize_l";
		} else if (mouseInTopVertResizeZone(mouse_x, mouse_y)) {
		    drag_type = "resize_t";
		} else if (mouseInBottomVertResizeZone(mouse_x, mouse_y)) {
		    drag_type = "resize_b";
		} else if (mouseInTopRightResizeZone(mouse_x, mouse_y)) {
		    drag_type = "resize_tr";
		} else if (mouseInBottomRightResizeZone(mouse_x, mouse_y)) {
		    drag_type = "resize_br";
		} else if (mouseInTopLeftResizeZone(mouse_x, mouse_y)) {
		    drag_type = "resize_tl";
		} else if (mouseInBottomLeftResizeZone(mouse_x, mouse_y)) {
		    drag_type = "resize_bl";
		}
		if (drag_type !== false) {
		    dragging = true;
		    drag_start_x = mouse_x;
		    drag_start_y = mouse_y;
		    drag_start_col = Math.floor(model.getHorzScroll() / (model.getCellWidth() + model.getCellPadding()));
		    drag_start_vert_scroll = model.getVertScroll();
		    drag_start_vert_zoom = model.getVertZoom();
		    drag_start_rect = self.current_rect;
		}
	    }
	});
	$(document).on("mousemove", function (evt) {
	    var offset = self.$div.offset();
	    var overlay_mouse_x = evt.pageX - offset.left;
	    var overlay_mouse_y = evt.pageY - offset.top;
	    var mouse = getCanvasMouse(self, overlay_mouse_x, overlay_mouse_y);
	    var mouse_x = mouse.mouse_x;
	    var mouse_y = mouse.mouse_y;
	    var zoom = getZoom(self, model);
	    var cell_width = model.getCellWidth(true)*zoom.x;
	    if (dragging) {
		evt.preventDefault();
		var delta_col = Math.floor(mouse_x / cell_width) - Math.floor(drag_start_x / cell_width);
		var delta_y = mouse_y - drag_start_y;
		if (drag_type === "move") {
		    var delta_y_scroll = delta_y * y_ratio;
		    drag_callback((drag_start_col + delta_col)*(model.getCellWidth() + model.getCellPadding()), drag_start_vert_scroll + delta_y_scroll);
		} else {
		    var render_rect;
		    var zoom = getZoom(self, model);
		    var max_num_cols = model.getIdOrder().length;
		    var min_num_cols = Math.ceil(cell_view.getWidth() / (model.getCellWidth(true) + model.getCellPadding(true, true)));
		    var max_height = model.getOncoprintHeight(true) * zoom.y;
		    var min_height = model.getCellViewHeight() * zoom.y;
		    var drag_start_right_col = drag_start_rect.col + drag_start_rect.num_cols;
		    var drag_start_bottom = drag_start_rect.top + drag_start_rect.height;
		    if (drag_type === "resize_r") {
			// Width must be valid
			delta_col = clamp(delta_col, 
					min_num_cols - drag_start_rect.num_cols,
					max_num_cols - drag_start_rect.num_cols);
			// Right must be valid
			delta_col = Math.min(delta_col, max_num_cols - drag_start_right_col);
			render_rect = {
			    'top': drag_start_rect.top,
			    'col': drag_start_rect.col,
			    'num_cols': drag_start_rect.num_cols + delta_col,
			    'height': drag_start_rect.height
			};
		    } else if (drag_type === "resize_l") {
			// Width must be valid
			delta_col = clamp(delta_col,
					drag_start_rect.num_cols - max_num_cols,
					drag_start_rect.num_cols - min_num_cols);
			// Left must be valid
			delta_col = Math.max(delta_col, -drag_start_rect.col);
			render_rect = {
			    'top': drag_start_rect.top,
			    'col': drag_start_rect.col + delta_col,
			    'num_cols': drag_start_rect.num_cols - delta_col,
			    'height': drag_start_rect.height
			};
		    } else if (drag_type === "resize_t") {
			// Height must be valid
			delta_y = clamp(delta_y,
					drag_start_rect.height - max_height,
					drag_start_rect.height - min_height);
			// Top must be valid
			delta_y = Math.max(delta_y, -drag_start_rect.top);
			render_rect = {
			    'top': drag_start_rect.top + delta_y,
			    'col': drag_start_rect.col,
			    'num_cols': drag_start_rect.num_cols,
			    'height': drag_start_rect.height - delta_y
			};
		    } else if (drag_type === "resize_b") {
			// Height must be valid
			delta_y = clamp(delta_y,
					min_height - drag_start_rect.height,
					max_height - drag_start_rect.height);
			// Bottom must be valid
			delta_y = Math.min(delta_y, max_height - drag_start_bottom);
			render_rect = {
			    'top': drag_start_rect.top,
			    'col': drag_start_rect.col,
			    'num_cols': drag_start_rect.num_cols,
			    'height': drag_start_rect.height + delta_y
			};
		    } else if (drag_type === "resize_tr") {
			// Width must be valid
			delta_col = clamp(delta_col, 
					min_num_cols - drag_start_rect.num_cols,
					max_num_cols - drag_start_rect.num_cols);
			// Right must be valid
			delta_col = Math.min(delta_col, max_num_cols - drag_start_right_col);
			// Height must be valid
			delta_y = clamp(delta_y,
					drag_start_rect.height - max_height,
					drag_start_rect.height - min_height);
			// Top must be valid
			delta_y = Math.max(delta_y, -drag_start_rect.top);
			render_rect = {
			    'top': drag_start_rect.top + delta_y,
			    'col': drag_start_rect.col,
			    'num_cols': drag_start_rect.num_cols + delta_col,
			    'height': drag_start_rect.height - delta_y
			};
		    } else if (drag_type === "resize_tl") {
			// Width must be valid
			delta_col = clamp(delta_col,
					drag_start_rect.num_cols - max_num_cols,
					drag_start_rect.num_cols - min_num_cols);
			// Left must be valid
			delta_col = Math.max(delta_col, -drag_start_rect.col);
			// Height must be valid
			delta_y = clamp(delta_y,
					drag_start_rect.height - max_height,
					drag_start_rect.height - min_height);
			// Top must be valid
			delta_y = Math.max(delta_y, -drag_start_rect.top);
			render_rect = {
			    'top': drag_start_rect.top + delta_y,
			    'col': drag_start_rect.col + delta_col,
			    'num_cols': drag_start_rect.num_cols - delta_col,
			    'height': drag_start_rect.height - delta_y
			};
		    } else if (drag_type === "resize_br") {
			// Height must be valid
			delta_y = clamp(delta_y,
					min_height - drag_start_rect.height,
					max_height - drag_start_rect.height);
			// Bottom must be valid
			delta_y = Math.min(delta_y, max_height - drag_start_bottom);
			// Width must be valid
			delta_col = clamp(delta_col, 
					min_num_cols - drag_start_rect.num_cols,
					max_num_cols - drag_start_rect.num_cols);
			// Right must be valid
			delta_col = Math.min(delta_col, max_num_cols - drag_start_right_col);
			render_rect = {
			    'top': drag_start_rect.top,
			    'col': drag_start_rect.col,
			    'num_cols': drag_start_rect.num_cols + delta_col,
			    'height': drag_start_rect.height + delta_y
			};
		    } else if (drag_type === "resize_bl") {
			// Height must be valid
			delta_y = clamp(delta_y,
					min_height - drag_start_rect.height,
					max_height - drag_start_rect.height);
			// Bottom must be valid
			delta_y = Math.min(delta_y, max_height - drag_start_bottom);		
			// Width must be valid
			delta_col = clamp(delta_col,
					drag_start_rect.num_cols - max_num_cols,
					drag_start_rect.num_cols - min_num_cols);
			// Left must be valid
			delta_col = Math.max(delta_col, -drag_start_rect.col);
			render_rect = {
			    'top': drag_start_rect.top,
			    'col': drag_start_rect.col + delta_col,
			    'num_cols': drag_start_rect.num_cols - delta_col,
			    'height': drag_start_rect.height + delta_y
			};
		    }
		    var cell_width = model.getCellWidth(true)*zoom.x;
		    // Compute render left and width
		    render_rect.left = render_rect.col * cell_width;
		    render_rect.width = render_rect.num_cols * cell_width;
		    drawOverlayRect(self, null, null, render_rect);
		}
	    } else {
		if (mouse.outside) {
		    updateCSSCursor();
		    updateRectResizeHoverLocation();
		} else {
		    updateCSSCursor(mouse_x, mouse_y);
		    updateRectResizeHoverLocation(mouse_x, mouse_y);
		}
		drawOverlayRect(self, model, cell_view);
	    }
	});
	var endDrag = function() {
	    if (dragging) {
		if (["resize_t", "resize_b", "resize_l", "resize_r",
		    "resize_tl", "resize_tr", "resize_bl", "resize_br"].indexOf(drag_type) > -1) {
		    viewport_callback({
			'col': self.current_rect.col,
			'scroll_y_proportion': (self.current_rect.top / parseInt(self.$canvas[0].height, 10)),
			'num_cols': self.current_rect.num_cols,
			'zoom_y': (drag_start_rect.height / self.current_rect.height) * drag_start_vert_zoom
		    });
		}
		dragging = false;
		drag_type = false;
	    }
	};
	$(document).on("mouseup", function (evt) {
	    var offset = self.$div.offset();
	    var overlay_mouse_x = evt.pageX - offset.left;
	    var overlay_mouse_y = evt.pageY - offset.top;
	    endDrag();
	    var mouse = getCanvasMouse(self, overlay_mouse_x, overlay_mouse_y);
	    if (!mouse.outside) {
		var mouse_x = mouse.mouse_x;
		var mouse_y = mouse.mouse_y;
		updateCSSCursor(mouse_x, mouse_y);
		updateRectResizeHoverLocation(mouse_x, mouse_y);
	    } else {
		updateCSSCursor();
		updateRectResizeHoverLocation();
	    }
	    drawOverlayRect(self, model, cell_view);
	});
	
	(function setUpWindowDrag() {
	    var start_mouse_x;
	    var start_mouse_y;
	    var start_left;
	    var start_top;
	    var handleDrag = function(evt) {
		evt.preventDefault();
		var delta_mouse_x = evt.pageX - start_mouse_x;
		var delta_mouse_y = evt.pageY - start_mouse_y;
		self.setWindowPosition(start_left + delta_mouse_x, start_top + delta_mouse_y);
	    };
	    self.$window_bar.hover(function() {
		$(this).css({'cursor':'move'});
	    }, function() {
		$(this).css({'cursor':'auto'});
	    });
	    
	    self.$window_bar.on("mousedown", function (evt) {
		start_mouse_x = evt.pageX;
		start_mouse_y = evt.pageY;
		start_left = parseInt(self.$div.css('left'), 10);
		start_top = parseInt(self.$div.css('top'), 10);
		$(document).on("mousemove", handleDrag);
	    });
	    $(document).on("mouseup click", function () {
		$(document).off("mousemove", handleDrag);
	    });
	})();
	
    }

    var getTrackBuffers = function (view, cell_view, track_id) {
	var vertex_position_buffer = view.ctx.createBuffer();
	var vertex_color_buffer = view.ctx.createBuffer();
	var vertex_position_array = cell_view.vertex_position_array[track_id];
	var vertex_color_array = cell_view.vertex_color_array[track_id];

	view.ctx.bindBuffer(view.ctx.ARRAY_BUFFER, vertex_position_buffer);
	view.ctx.bufferData(view.ctx.ARRAY_BUFFER, new Float32Array(vertex_position_array), view.ctx.STATIC_DRAW);
	vertex_position_buffer.itemSize = 3;
	vertex_position_buffer.numItems = vertex_position_array.length / vertex_position_buffer.itemSize;

	view.ctx.bindBuffer(view.ctx.ARRAY_BUFFER, vertex_color_buffer);
	view.ctx.bufferData(view.ctx.ARRAY_BUFFER, new Float32Array(vertex_color_array), view.ctx.STATIC_DRAW);
	vertex_color_buffer.itemSize = 4;
	vertex_color_buffer.numItems = vertex_color_array.length / vertex_color_buffer.itemSize;

	var vertex_column_buffer = view.ctx.createBuffer();
	var vertex_column_array = cell_view.vertex_column_array[track_id];
	view.ctx.bindBuffer(view.ctx.ARRAY_BUFFER, vertex_column_buffer);
	view.ctx.bufferData(view.ctx.ARRAY_BUFFER, new Float32Array(vertex_column_array), view.ctx.STATIC_DRAW);
	vertex_column_buffer.itemSize = 1;
	vertex_column_buffer.numItems = vertex_column_array.length / vertex_column_buffer.itemSize;

	return {'position': vertex_position_buffer,
	    'color': vertex_color_buffer,
	    'column': vertex_column_buffer};
    };

    var drawOncoprint = function (view, model, cell_view) {
	if (view.rendering_suppressed) {
	    return;
	}

	var zoom = getZoom(view, model);

	view.ctx.clearColor(1.0, 1.0, 1.0, 1.0);
	view.ctx.clear(view.ctx.COLOR_BUFFER_BIT | view.ctx.DEPTH_BUFFER_BIT);

	var tracks = model.getTracks();
	for (var i = 0; i < tracks.length; i++) {
	    var track_id = tracks[i];
	    var cell_top = model.getCellTops(track_id, true);
	    var buffers = getTrackBuffers(view, cell_view, track_id);
	    if (buffers.position.numItems === 0) {
		continue;
	    }

	    view.ctx.useProgram(view.shader_program);
	    view.ctx.bindBuffer(view.ctx.ARRAY_BUFFER, buffers.position);
	    view.ctx.vertexAttribPointer(view.shader_program.vertexPositionAttribute, buffers.position.itemSize, view.ctx.FLOAT, false, 0, 0);

	    view.ctx.bindBuffer(view.ctx.ARRAY_BUFFER, buffers.color);
	    view.ctx.vertexAttribPointer(view.shader_program.vertexColorAttribute, buffers.color.itemSize, view.ctx.FLOAT, false, 0, 0);

	    view.ctx.bindBuffer(view.ctx.ARRAY_BUFFER, buffers.column);
	    view.ctx.vertexAttribPointer(view.shader_program.vertexOncoprintColumnAttribute, buffers.column.itemSize, view.ctx.FLOAT, false, 0, 0);

	    view.ctx.uniformMatrix4fv(view.shader_program.pMatrixUniform, false, view.pMatrix);
	    view.ctx.uniformMatrix4fv(view.shader_program.mvMatrixUniform, false, view.mvMatrix);
	    view.ctx.uniform1f(view.shader_program.columnWidthUniform, model.getCellWidth(true));
	    view.ctx.uniform1f(view.shader_program.zoomXUniform, zoom.x);
	    view.ctx.uniform1f(view.shader_program.zoomYUniform, zoom.y);
	    view.ctx.uniform1f(view.shader_program.offsetYUniform, cell_top);

	    view.ctx.drawArrays(view.ctx.TRIANGLES, 0, buffers.position.numItems);
	}
    };
    var getZoom = function (view, model) {
	var zoom_x = parseInt(view.$canvas[0].width, 10) / model.getOncoprintWidthNoColumnPadding(true);
	var zoom_y = parseInt(view.$canvas[0].height, 10) / model.getOncoprintHeight(true);
	zoom_x = Math.max(0, Math.min(1, zoom_x));
	zoom_y = Math.max(0, Math.min(1, zoom_y));
	return {
	    x: zoom_x,
	    y: zoom_y
	};
    };
    
    var drawOverlayRect = function (view, model, cell_view, opt_rect) {
	if (view.rendering_suppressed) {
	    return;
	}

	var left, width, top, height, col, num_cols;
	if (opt_rect) {
	    left = opt_rect.left;
	    width = opt_rect.width;
	    top = opt_rect.top;
	    height = opt_rect.height;
	    col = opt_rect.col;
	    num_cols = opt_rect.num_cols;
	} else {
	    var cell_width = model.getCellWidth(true);
	    var cell_padding = model.getCellPadding(true);
	    var viewport = cell_view.getViewportOncoprintSpace(model);

	    var zoom = getZoom(view, model);
	    col = Math.floor(viewport.left / (cell_width + cell_padding));
	    num_cols = Math.min(model.getIdOrder().length - col,
				Math.floor(viewport.right / (cell_width + cell_padding)) - Math.floor(viewport.left / (cell_width + cell_padding)));
	    left = col * cell_width * zoom.x;
	    width = num_cols * cell_width * zoom.x;
	    top = viewport.top * zoom.y;
	    height = (viewport.bottom - viewport.top) * zoom.y;
	}

	var ctx = view.overlay_ctx;
	var canv = view.$overlay_canvas[0];
	var canv_width = parseInt(canv.width, 10);
	var canv_height = parseInt(canv.height, 10);
	
	// Clear
	ctx.fillStyle = "rgba(0,0,0,0)";
	ctx.clearRect(0, 0, canv_width, canv_height);
	// Draw rectangle
	ctx.fillStyle = "rgba(255,255,255,0.4)";
	ctx.fillRect(left, top, width, height);
	// Draw border line by line
	var unhover_color = "rgba(0,0,0,0.75)";
	var hover_color = "rgba(255,0,0,1)";
	var unhover_width = 1;
	var hover_width = 2;
	var top_is_hovered = view.resize_hover === "t" || view.resize_hover === "tr" || view.resize_hover === "tl";
	var right_is_hovered = view.resize_hover === "r" || view.resize_hover === "tr" || view.resize_hover === "br";
	var bottom_is_hovered = view.resize_hover === "b" || view.resize_hover === "br" || view.resize_hover === "bl";
	var left_is_hovered = view.resize_hover === "l" || view.resize_hover === "tl" || view.resize_hover === "bl";
	// Draw top border
	ctx.beginPath();
	ctx.moveTo(left, top);
	ctx.strokeStyle = top_is_hovered ? hover_color : unhover_color;
	ctx.lineWidth = top_is_hovered ? hover_width : unhover_width;
	ctx.lineTo(left+width, top);
	ctx.stroke();
	// Draw right border
	ctx.beginPath();
	ctx.moveTo(left+width, top);
	ctx.strokeStyle = right_is_hovered ? hover_color : unhover_color;
	ctx.lineWidth = right_is_hovered ? hover_width : unhover_width;
	ctx.lineTo(left+width, top+height);
	ctx.stroke();
	// Draw bottom border
	ctx.beginPath();
	ctx.moveTo(left+width, top+height);
	ctx.strokeStyle = bottom_is_hovered ? hover_color : unhover_color;
	ctx.lineWidth = bottom_is_hovered ? hover_width : unhover_width;
	ctx.lineTo(left, top+height);
	ctx.stroke();
	// Draw left border
	ctx.beginPath();
	ctx.moveTo(left, top+height);
	ctx.strokeStyle = left_is_hovered ? hover_color : unhover_color;
	ctx.lineWidth = left_is_hovered ? hover_width : unhover_width;
	ctx.lineTo(left, top);
	ctx.stroke();
	
	view.current_rect = {
	    'top':top,
	    'left':left,
	    'width':width,
	    'height':height,
	    'col': col,
	    'num_cols': num_cols
	};
    };
    var drawOncoprintAndOverlayRect = function (view, model, cell_view) {
	if (view.rendering_suppressed) {
	    return;
	}
	drawOncoprint(view, model, cell_view);
	drawOverlayRect(view, model, cell_view);
    };

    OncoprintMinimapView.prototype.moveTrack = function (model, cell_view) {
	drawOncoprintAndOverlayRect(this, model, cell_view);
    }
    OncoprintMinimapView.prototype.addTracks = function (model, cell_view) {
	drawOncoprintAndOverlayRect(this, model, cell_view);
    }
    OncoprintMinimapView.prototype.removeTrack = function (model, cell_view) {
	drawOncoprintAndOverlayRect(this, model, cell_view);
    }
    OncoprintMinimapView.prototype.setHorzZoom = function (model, cell_view) {
	drawOverlayRect(this, model, cell_view);
	this.horizontal_zoom.setSliderValue(model.getHorzZoom());
    }
    OncoprintMinimapView.prototype.setVertZoom = function (model, cell_view) {
	drawOverlayRect(this, model, cell_view);
	this.vertical_zoom.setSliderValue(model.getVertZoom());
    }
    OncoprintMinimapView.prototype.setZoom = function(model, cell_view) {
	drawOverlayRect(this, model, cell_view);
	this.horizontal_zoom.setSliderValue(model.getHorzZoom());
	this.vertical_zoom.setSliderValue(model.getVertZoom());
    }
    OncoprintMinimapView.prototype.setScroll = function (model, cell_view) {
	drawOverlayRect(this, model, cell_view);
    }
    OncoprintMinimapView.prototype.setHorzScroll = function (model, cell_view) {
	drawOverlayRect(this, model, cell_view);
    }
    OncoprintMinimapView.prototype.setVertScroll = function (model, cell_view) {
	drawOverlayRect(this, model, cell_view);
    }
    OncoprintMinimapView.prototype.setViewport = function (model, cell_view) {
	drawOverlayRect(this, model, cell_view);
	this.horizontal_zoom.setSliderValue(model.getHorzZoom());
	this.vertical_zoom.setSliderValue(model.getVertZoom());
    }
    OncoprintMinimapView.prototype.sort = function (model, cell_view) {
	drawOncoprintAndOverlayRect(this, model, cell_view);
    }
    OncoprintMinimapView.prototype.setTrackData = function (model, cell_view) {
	drawOncoprintAndOverlayRect(this, model, cell_view);
    }
    OncoprintMinimapView.prototype.shareRuleSet = function (model, cell_view) {
	drawOncoprintAndOverlayRect(this, model, cell_view);
    }
    OncoprintMinimapView.prototype.setRuleSet = function (model, cell_view) {
	drawOncoprintAndOverlayRect(this, model, cell_view);
    }
    OncoprintMinimapView.prototype.setIdOrder = function (model, cell_view) {
	drawOncoprintAndOverlayRect(this, model, cell_view);
    }
    OncoprintMinimapView.prototype.suppressRendering = function () {
	this.rendering_suppressed = true;
    }
    OncoprintMinimapView.prototype.releaseRendering = function (model, cell_view) {
	this.rendering_suppressed = false;
	drawOncoprintAndOverlayRect(this, model, cell_view);
    }
    OncoprintMinimapView.prototype.hideIds = function (model, cell_view) {
	drawOncoprintAndOverlayRect(this, model, cell_view);
    }

    OncoprintMinimapView.prototype.setWindowPosition = function(x, y) {
	this.$div.css({'top': y, 'left': x});
    }
    
    OncoprintMinimapView.prototype.setWidth = function (w, model, cell_view) {
	this.$canvas[0].width = w;
	this.$overlay_canvas[0].width = w;
	getWebGLContextAndSetUpMatricesAndShaders(this);
	this.overlay_ctx = this.$overlay_canvas[0].getContext("2d");

	drawOncoprintAndOverlayRect(this, model, cell_view);
    }
    return OncoprintMinimapView;
})();

module.exports = OncoprintMinimapView;
},{"./oncoprintzoomslider.js":30,"gl-matrix":7}],21:[function(require,module,exports){
var binarysearch = require('./binarysearch.js');
var CachedProperty = require('./CachedProperty.js');

function ifndef(x, val) {
    return (typeof x === "undefined" ? val : x);
}

var UnionOfSets = (function() {
    // a set, to be passed in as argument, is an object where the values are truthy
    function UnionOfSets() {
	this.union_count = {};
	this.sets = {};
    }
    var setOfKeys = function (obj) {
	var set = {};
	for (var k in obj) {
	    if (typeof obj[k] !== 'undefined') {
		set[k] = true;
	    }
	}
	return set;
    };
    UnionOfSets.prototype.putSet = function(id, set) {
	this.removeSet(id);
	this.sets[id] = set;
	
	var union_count = this.union_count;
	for (var k in set) {
	    if (set[k]) {
		this.union_count[k] = this.union_count[k] || 0;
		this.union_count[k] += 1;
	    }
	}
    }
    UnionOfSets.prototype.removeSet = function(id) {
	var union_count = this.union_count;
	var old_set = this.sets[id] || {};
	for (var k in old_set) {
	    if (old_set[k]) {
		union_count[k] -= 1;
		if (union_count[k] === 0) {
		    delete union_count[k];
		}
	    }
	}
	delete this.sets[id];
    }
    UnionOfSets.prototype.getUnion = function() {
	return setOfKeys(this.union_count);
    }
    return UnionOfSets;
})();

var setUnion = function(list_of_sets) {
    var union = {};
    for (var i=0; i<list_of_sets.length; i++) {
	var set = list_of_sets[i];
	for (var k in set) {
	    if (set.hasOwnProperty(k)) {
		union[k] = true;
	    }
	}
    }
    return union;
};

var objectValues = function(obj) {
    return Object.keys(obj).map(function(key) {
	return obj[key];
    });
};

var arrayUnique = function(arr) {
    var present = {};
    var unique = [];
    for (var i=0; i<arr.length; i++) {
	if (typeof present[arr[i]] === 'undefined') {
	    present[arr[i]] = true;
	    unique.push(arr[i]);
	}
    }
    return unique;
};

var copyShallowObject = function(obj) {
    var copy = {};
    for (var key in obj) {
	if (obj.hasOwnProperty(key)) {
	    copy[key] = obj[key];
	}
    }
    return copy;
};

var clamp = function(x, lower, upper) {
    return Math.min(upper, Math.max(lower, x));
};

var OncoprintModel = (function () {
    var MIN_ZOOM_PIXELS = 100;
    var MIN_CELL_HEIGHT_PIXELS = 3;
    function OncoprintModel(init_cell_padding, init_cell_padding_on,
	    init_horz_zoom, init_vert_zoom, 
	    init_cell_width, init_track_group_padding) {
		
	var model = this;	
	
	// Global properties
	this.sort_config = {};
	this.rendering_suppressed_depth = 0;
	
	// Rendering Properties
	this.max_height = 500;
	this.cell_width = ifndef(init_cell_width, 6);
	this.horz_zoom = ifndef(init_horz_zoom, 1);
	this.vert_zoom = ifndef(init_vert_zoom, 1);
	this.horz_scroll = 0;
	this.vert_scroll = 0;
	this.bottom_padding = 0;
	this.track_group_padding = ifndef(init_track_group_padding, 10);
	this.cell_padding = ifndef(init_cell_padding, 3);
	this.cell_padding_on = ifndef(init_cell_padding_on, true);
	this.cell_padding_off_cell_width_threshold = 2;
	this.cell_padding_off_because_of_zoom = (this.getCellWidth() < this.cell_padding_off_cell_width_threshold);
	this.id_order = [];
	this.hidden_ids = {};
	
	// Track Properties
	this.track_label = {};
	this.track_description = {};
	this.cell_height = {};
	this.track_padding = {};
	this.track_data_id_key = {};
	this.track_tooltip_fn = {};
	this.track_removable = {};
	this.track_remove_callback = {};
	this.track_sort_cmp_fn = {};
	this.track_sort_direction_changeable = {};
	this.track_sort_direction = {}; // 1: ascending, -1: descending, 0: not
	this.track_data = {};
	this.track_rule_set_id = {}; // track id -> rule set id
	this.track_active_rules = {}; // from track id to active rule map (map with rule ids as keys)
	this.track_info = {};
	this.track_has_column_spacing = {}; // track id -> boolean
	this.track_expansion_init_callback = {}; // track id -> function that initializes expansion data if applicable
	this.track_expansion_genes = {}; // track id -> array of gene data to expand if initialized
	this.track_expansion_callback = {}; // track id -> function that takes gene data and adds expansion tracks if initialized
	this.track_expansion_tracks = {}; // track id -> array of track ids if applicable
	
	// Rule Set Properties
	this.rule_sets = {}; // map from rule set id to rule set
	
	// Cached and Recomputed Properties
	this.visible_id_order = new CachedProperty([], function () {
	    var hidden_ids = model.hidden_ids;
	    return model.id_order.filter(function (id) {
		return !hidden_ids[id];
	    });
	});
	this.track_id_to_datum = new CachedProperty({}, function(model, track_id) {
	    var curr = model.track_id_to_datum.get();
	    if (model.getContainingTrackGroup(track_id) !== null) {
		var map = {};
		var data = model.getTrackData(track_id) || [];
		var data_id_key = model.getTrackDataIdKey(track_id) || '';
		for (var i=0; i<data.length; i++) {
		    map[data[i][data_id_key]] = data[i];
		}
		curr[track_id] = map;
	    } else {
		delete curr[track_id];
	    }
	    return curr;
	});
	this.track_present_ids = new CachedProperty(new UnionOfSets(), function(model, track_id) {
	    var union = model.track_present_ids.get();
	    if (model.getContainingTrackGroup(track_id) !== null) {
		var ids = {};
		var data = model.getTrackData(track_id) || [];
		var data_id_key = model.getTrackDataIdKey(track_id) || '';
		for (var i = 0; i < data.length; i++) {
		    ids[data[i][data_id_key]] = true;
		}
		union.putSet(track_id, ids);
	    } else {
		union.removeSet(track_id);
	    }
	    return union;
	});
	this.present_ids = new CachedProperty({}, function() {
	    return model.track_present_ids.get().getUnion();
	});
	this.track_present_ids.addBoundProperty(this.present_ids);
	
	this.id_to_index = new CachedProperty({}, function() {
	    var id_to_index = {};
	    var id_order = model.getIdOrder(true);
	    for (var i=0; i<id_order.length; i++) {
		id_to_index[id_order[i]] = i;
	    }
	    return id_to_index;
	});
	this.visible_id_to_index = new CachedProperty({}, function() {
	    var id_to_index = {};
	    var id_order = model.getIdOrder();
	    for (var i=0; i<id_order.length; i++) {
		id_to_index[id_order[i]] = i;
	    }
	    return id_to_index;
	});
	this.visible_id_order.addBoundProperty(this.visible_id_to_index);
	
	this.track_groups = [];
	this.track_group_sort_priority = [];
	this.track_group_header = [];
	
	this.track_tops = new CachedProperty({}, function () {
	    var tops = {};
	    var groups = model.getTrackGroups();
	    var y = 0;
	    for (var i = 0; i < groups.length; i++) {
		var group = groups[i];
		if (model.getTrackGroupHeader(i).length > 0 && group.length > 0) {
		    y += model.getTrackGroupHeaderSize();
		}
		for (var j = 0; j < group.length; j++) {
		    var track_id = group[j];
		    tops[track_id] = y;
		    y += model.getTrackHeight(track_id, true);
		}
		if (group.length > 0) {
		    y += model.getTrackGroupPadding(true);
		}
	    }
	    return tops;
	});
	this.cell_tops = new CachedProperty({}, function() {
	    var track_tops = model.track_tops.get();
	    var cell_tops = {};
	    for (var k in track_tops) {
		if (track_tops.hasOwnProperty(k)) {
		    cell_tops[k] = track_tops[k] + model.getTrackPadding(k, true);
		}
	    }
	    return cell_tops;
	});
	this.label_tops = new CachedProperty({}, function() {
	    return model.cell_tops.get();
	});
	
	this.track_tops.addBoundProperty(this.cell_tops);
	this.cell_tops.addBoundProperty(this.label_tops);
	
	this.track_tops_zoomed = new CachedProperty({}, function () {
	    var tops = {};
	    var groups = model.getTrackGroups();
	    var y = 0;
	    for (var i = 0; i < groups.length; i++) {
		var group = groups[i];
		for (var j = 0; j < group.length; j++) {
		    var track_id = group[j];
		    tops[track_id] = y;
		    y += model.getTrackHeight(track_id);
		}
		if (group.length > 0) {
		    y += model.getTrackGroupPadding();
		}
	    }
	    return tops;
	});
	this.cell_tops_zoomed = new CachedProperty({}, function() {
	    var track_tops = model.track_tops_zoomed.get();
	    var cell_tops = {};
	    for (var k in track_tops) {
		if (track_tops.hasOwnProperty(k)) {
		    cell_tops[k] = track_tops[k] + model.getTrackPadding(k);
		}
	    }
	    return cell_tops;
	});
	this.label_tops_zoomed = new CachedProperty({}, function() {
	    return model.cell_tops_zoomed.get();
	});
	
	this.track_tops.addBoundProperty(this.track_tops_zoomed);
	this.track_tops_zoomed.addBoundProperty(this.cell_tops_zoomed);
	this.cell_tops_zoomed.addBoundProperty(this.label_tops_zoomed);
	
	this.column_left = new CachedProperty({}, function() {
	    var cell_width = model.getCellWidth(true);
	    var cell_padding = model.getCellPadding(true);
	    var left = {};
	    var ids = model.getIdOrder();
	    for (var i = 0; i < ids.length; i++) {
		left[ids[i]] = i * (cell_width + cell_padding);
	    }
	    return left;
	});
	
	this.zoomed_column_left = new CachedProperty({}, function() {
	    var cell_width = model.getCellWidth();
	    var cell_padding = model.getCellPadding();
	    var left = {};
	    var ids = model.getIdOrder();
	    for (var i = 0; i < ids.length; i++) {
		left[ids[i]] = i * (cell_width + cell_padding);
	    }
	    return left;
	});
	this.column_left_no_padding = new CachedProperty({}, function() {
	    var cell_width = model.getCellWidth(true);
	    var left = {};
	    var ids = model.getIdOrder();
	    for (var i = 0; i < ids.length; i++) {
		left[ids[i]] = i * cell_width;
	    }
	    return left;
	});
	this.column_left.addBoundProperty(this.zoomed_column_left);
	this.column_left.addBoundProperty(this.column_left_no_padding);
	
	this.precomputed_comparator = new CachedProperty({}, function(model, track_id) {
	    var curr_precomputed_comparator = model.precomputed_comparator.get();
	    curr_precomputed_comparator[track_id] = new PrecomputedComparator(model.getTrackData(track_id),
									    model.getTrackSortComparator(track_id),
									    model.getTrackSortDirection(track_id),
									    model.getTrackDataIdKey(track_id));
	    return curr_precomputed_comparator;
	});// track_id -> PrecomputedComparator
    }

    OncoprintModel.prototype.toggleCellPadding = function () {
	this.cell_padding_on = !this.cell_padding_on;
	this.column_left.update();
	return this.cell_padding_on;
    }

    OncoprintModel.prototype.getCellPadding = function (base, dont_consider_zoom) {
	return (this.cell_padding * (base ? 1 : this.horz_zoom)) * (+this.cell_padding_on) * (dont_consider_zoom ? 1 : +(!this.cell_padding_off_because_of_zoom));
    }

    OncoprintModel.prototype.getHorzZoom = function () {
	return this.horz_zoom;
    }

    OncoprintModel.prototype.getHorzZoomToFitNumCols = function(width, num_cols) {
	var cell_width = this.getCellWidth(true);
	var zoom_if_cell_padding_on = clamp(width / (num_cols*(cell_width + this.cell_padding)),
					    0,1);
	var zoom_if_cell_padding_off = clamp(width / (num_cols*cell_width),
					    0,1);
	var zoom;
	if (!this.cell_padding_on) {
	    zoom = zoom_if_cell_padding_off;
	} else {
	    if (cell_width * zoom_if_cell_padding_on < this.cell_padding_off_cell_width_threshold) {
		if (cell_width * zoom_if_cell_padding_off >= this.cell_padding_off_cell_width_threshold) {
		    // Because of cell padding toggling there's no way to get exactly the desired number of columns.
		    // We can see this by contradiction: if we assume that cell padding is on, and try to fit exactly
		    // our number of columns, we end up turning cell padding off (outer if statement). If we assume that
		    // cell padding is off and try to fit our number of columns, we find that cell padding is on (inner if statement).
		    // Thus, it's impossible to show this exact number of columns - we either under or overshoot it. We
		    // thus should overshoot it by as little as possible, show as few columns as possible while still fitting
		    // this amount. It must be exactly at the threshold for switching.
		    // 
		    var unrounded_zoom = this.cell_padding_off_cell_width_threshold / cell_width;
		    var unrounded_num_cols = width / (unrounded_zoom * cell_width);
		    var rounded_num_cols = Math.ceil(unrounded_num_cols);
		    zoom = width / (rounded_num_cols * cell_width);
		} else {
		    zoom = zoom_if_cell_padding_off;
		}
	    } else {
		zoom = zoom_if_cell_padding_on;
	    }
	}
	return zoom;
    }
    OncoprintModel.prototype.getHorzZoomToFit = function(width, ids) {
	ids = ids || [];
	var id_to_index_map = this.getVisibleIdToIndexMap();
	var indexes = ids.map(function(id) { return id_to_index_map[id]; });
	var max = Math.max.apply(null, indexes);
	var min = Math.min.apply(null, indexes);
	var num_cols = max - min;
	return this.getHorzZoomToFitNumCols(width, num_cols);
    }
    
    OncoprintModel.prototype.getMinHorzZoom = function() {
	return Math.min(MIN_ZOOM_PIXELS / (this.getIdOrder().length*this.getCellWidth(true) + (this.getIdOrder().length-1)*this.getCellPadding(true)), 1);
    }
    
    OncoprintModel.prototype.getMinVertZoom = function() {
	// Can't zoom to be smaller than max height
	// That zoom would be z*this.getOncoprintHeight(true) = max_height
	return this.max_height / this.getOncoprintHeight(true);
    }
    
    OncoprintModel.prototype.setHorzScroll = function(s) {
	this.horz_scroll = Math.max(0, s);
	return this.horz_scroll;
    }
    OncoprintModel.prototype.setVertScroll = function(s) {
	this.vert_scroll = Math.max(0, s);
	return this.vert_scroll;
    }
    OncoprintModel.prototype.setScroll = function(h, v) {
	this.setHorzScroll(h);
	this.setVertScroll(v);
    }
    OncoprintModel.prototype.getHorzScroll = function() {
	return this.horz_scroll;
    }
    OncoprintModel.prototype.getVertScroll = function() {
	return this.vert_scroll;
    }
    OncoprintModel.prototype.setZoom = function(zoom_x, zoom_y) {
	this.setHorzZoom(zoom_x);
	this.setVertZoom(zoom_y);
    }
    var setCellPaddingOffBecauseOfZoom = function(model, val) {
	model.cell_padding_off_because_of_zoom = val;
	model.column_left.update();
    };
    OncoprintModel.prototype.setHorzZoom = function (z) {
	var min_zoom = this.getMinHorzZoom();
	this.horz_zoom = clamp(z, min_zoom, 1);
	this.column_left.update();
	
	if (this.getCellWidth() < this.cell_padding_off_cell_width_threshold && !this.cell_padding_off_because_of_zoom) {
	    setCellPaddingOffBecauseOfZoom(this, true);
	} else if (this.getCellWidth() >= this.cell_padding_off_cell_width_threshold && this.cell_padding_off_because_of_zoom) {
	    setCellPaddingOffBecauseOfZoom(this, false);
	}
	return this.horz_zoom;
    }
    
    
    OncoprintModel.prototype.getVertZoom = function() {
	return this.vert_zoom;
    }
    
    OncoprintModel.prototype.setVertZoom = function (z) {
	var min_zoom = this.getMinVertZoom();
	this.vert_zoom = clamp(z, min_zoom, 1);
	this.track_tops.update();
	return this.vert_zoom;
    }

    OncoprintModel.prototype.hideTrackLegends = function(track_ids) {
	track_ids = [].concat(track_ids);
	for (var i=0; i<track_ids.length; i++) {
	    this.getRuleSet(track_ids[i]).exclude_from_legend = true;
	}
    }
    
    OncoprintModel.prototype.showTrackLegends = function(track_ids) {
	track_ids = [].concat(track_ids);
	for (var i=0; i<track_ids.length; i++) {
	    this.getRuleSet(track_ids[i]).exclude_from_legend = false;
	}
    }

    OncoprintModel.prototype.getIdentifiedShapeListList = function(track_id, use_base_size, sort_by_z) {
	var active_rules = {};
	var data = this.getTrackData(track_id);
	var id_key = this.getTrackDataIdKey(track_id);
	var spacing = this.getTrackHasColumnSpacing(track_id);
	var width = this.getCellWidth(use_base_size) + (!spacing ? this.getCellPadding(use_base_size) : 0);
	var shapes = this.getRuleSet(track_id).apply(data, width, this.getCellHeight(track_id, use_base_size), active_rules);
	this.track_active_rules[track_id] = active_rules;
	
	var z_comparator = function(shapeA, shapeB) {
	    var zA = parseFloat(shapeA.z);
	    var zB = parseFloat(shapeB.z);
	    if (zA < zB) {
		return -1;
	    } else if (zA > zB) {
		return 1;
	    } else {
		return 0;
	    }
	};
	return shapes.map(function(shape_list, index) {
	    if (sort_by_z) {
		shape_list.sort(z_comparator);
	    }
	    return {
		id: data[index][id_key],
		shape_list: shape_list
	    };
	});
    }
    
    OncoprintModel.prototype.getActiveRules = function(rule_set_id) {
	var list_of_active_rules_maps = [];
	for (var track_id in this.track_rule_set_id) {
	    if (this.track_rule_set_id.hasOwnProperty(track_id) && this.track_rule_set_id[track_id] === rule_set_id) {
		list_of_active_rules_maps.push(this.track_active_rules[track_id]);
	    }
	}
	var active_rules = setUnion(list_of_active_rules_maps);
	return this.rule_sets[rule_set_id].getRulesWithId().filter(function(rule_with_id) {
	    return !!active_rules[rule_with_id.id];
	});
    }
    
    OncoprintModel.prototype.getRuleSets = function() {
	// return rule sets, sorted by associating each with the lowest track id its on
	var self = this;
	var sorted_tracks = this.getTracks().sort();
	var rule_set_ids = sorted_tracks.map(function(track_id) {
	    return self.track_rule_set_id[track_id];
	});
	var unique_rule_set_ids = arrayUnique(rule_set_ids);
	return unique_rule_set_ids.map(function(rule_set_id) {
	    return self.rule_sets[rule_set_id];
	});
    }

    OncoprintModel.prototype.getTrackHasColumnSpacing = function(track_id) {
	return !!(this.track_has_column_spacing[track_id]);
    }
    
    OncoprintModel.prototype.getCellWidth = function (base) {
	return this.cell_width * (base ? 1 : this.horz_zoom);
    }

    OncoprintModel.prototype.getCellHeight = function (track_id, base) {
	return this.cell_height[track_id] * (base ? 1 : this.vert_zoom);
    }
    
    OncoprintModel.prototype.getTrackInfo = function(track_id) {
	return this.track_info[track_id];
    }
    
    OncoprintModel.prototype.setTrackInfo = function(track_id, msg) {
	this.track_info[track_id] = msg;
    }
    
    OncoprintModel.prototype.getTrackHeight = function(track_id, base) {
	return this.getCellHeight(track_id, base) + 2*this.getTrackPadding(track_id, base);
    }

    OncoprintModel.prototype.getTrackPadding = function (track_id, base) {
	return this.track_padding[track_id] * (base ? 1 : this.vert_zoom);
    }
    OncoprintModel.prototype.getBottomPadding = function() {
	return this.bottom_padding;
    }
    OncoprintModel.prototype.getTrackSortDirection = function(track_id) {
	return this.track_sort_direction[track_id];
    }
    OncoprintModel.prototype.setTrackSortDirection = function(track_id, dir) {
	// see above for dir options
	this.track_sort_direction[track_id] = dir;
	this.precomputed_comparator.update(this, track_id);
    }
    
    OncoprintModel.prototype.setCellPaddingOn = function(cell_padding_on) {
	this.cell_padding_on = cell_padding_on;
	this.column_left.update();
    }
    OncoprintModel.prototype.getIdOrder = function (all) {
	if (all) {
	    return this.id_order; // TODO: should be read-only
	} else {
	    return this.visible_id_order.get();
	}
    }
    OncoprintModel.prototype.getIdToIndexMap = function() {
	return this.id_to_index.get();
    }
    OncoprintModel.prototype.getVisibleIdToIndexMap = function() {
	return this.visible_id_to_index.get();
    }

    OncoprintModel.prototype.getHiddenIds = function () {
	var hidden_ids = this.hidden_ids;
	return this.id_order.filter(function (id) {
	    return !!hidden_ids[id];
	});
    }

    OncoprintModel.prototype.setIdOrder = function (ids) {
	this.id_order = ids.slice();
	Object.freeze(this.id_order);
	this.id_to_index.update();
	this.visible_id_order.update();
	this.column_left.update();
    }

    OncoprintModel.prototype.hideIds = function (to_hide, show_others) {
	if (show_others) {
	    this.hidden_ids = {};
	}
	for (var j = 0, len = to_hide.length; j < len; j++) {
	    this.hidden_ids[to_hide[j]] = true;
	}
	this.visible_id_order.update();
	this.column_left.update();
    }

    OncoprintModel.prototype.setTrackGroupOrder = function(index, track_order) {
	this.track_groups[index] = track_order;
	
	this.track_tops.update();
    }
    
    OncoprintModel.prototype.moveTrackGroup = function (from_index, to_index) {
	var new_groups = [];
	var new_headers = [];
	var group_to_move = this.track_groups[from_index];
	for (var i = 0; i < this.track_groups.length; i++) {
	    if (i !== from_index && i !== to_index) {
		new_groups.push(this.track_groups[i]);
		new_headers.push(this.track_group_header[i]);
	    }
	    if (i === to_index) {
		new_groups.push(group_to_move);
		new_headers.push(this.track_group_header[from_index]);
	    }
	}
	this.track_groups = new_groups;
	this.track_group_header = new_headers;
	this.track_tops.update();
	return this.track_groups;
    }

    OncoprintModel.prototype.addTracks = function (params_list) {
	for (var i = 0; i < params_list.length; i++) {
	    var params = params_list[i];
	    addTrack(this, params.track_id, params.target_group, params.track_group_header,
		    params.cell_height, params.track_padding, params.has_column_spacing,
		    params.data_id_key, params.tooltipFn,
		    params.removable, params.removeCallback, params.label, params.description, params.track_info,
		    params.sortCmpFn, params.sort_direction_changeable, params.init_sort_direction,
		    params.data, params.rule_set, params.expansion_of, params.expansionInitCallback);
	}
	this.track_tops.update();
    }
  
    var addTrack = function (model, track_id, target_group, track_group_header,
	    cell_height, track_padding, has_column_spacing,
	    data_id_key, tooltipFn,
	    removable, removeCallback, label, description, track_info,
	    sortCmpFn, sort_direction_changeable, init_sort_direction,
	    data, rule_set, expansion_of, expansionInitCallback) {
	model.track_label[track_id] = ifndef(label, "Label");
	model.track_description[track_id] = ifndef(description, "");
	model.cell_height[track_id] = ifndef(cell_height, 23);
	model.track_padding[track_id] = ifndef(track_padding, 5);
	model.track_has_column_spacing[track_id] = ifndef(has_column_spacing, true);

	model.track_tooltip_fn[track_id] = ifndef(tooltipFn, function (d) {
	    return d + '';
	});
	model.track_removable[track_id] = ifndef(removable, false);
	model.track_remove_callback[track_id] = ifndef(removeCallback, function() {});
	
	if (typeof expansion_of !== 'undefined') {
	    if (!model.track_expansion_tracks.hasOwnProperty(expansion_of)) {
		model.track_expansion_tracks[expansion_of] = [];
	    }
	    if (model.track_expansion_tracks[expansion_of].indexOf(track_id) !== -1) {
		throw new Error('Illegal state: duplicate expansion track ID');
	    }
	    model.track_expansion_tracks[expansion_of].push(track_id);
	}
	if (typeof expansionInitCallback !== 'undefined') {
	    model.track_expansion_init_callback[track_id] = expansionInitCallback;
	}
	
	model.track_sort_cmp_fn[track_id] = ifndef(sortCmpFn, function () {
	    return 0;
	});
	
	model.track_sort_direction_changeable[track_id] = ifndef(sort_direction_changeable, false);
	model.track_data[track_id] = ifndef(data, []);
	model.track_data_id_key[track_id] = ifndef(data_id_key, 'id');
	
	model.track_info[track_id] = ifndef(track_info, "");
	
	if (typeof rule_set !== 'undefined') {
	    model.rule_sets[rule_set.rule_set_id] = rule_set;
	    model.track_rule_set_id[track_id] = rule_set.rule_set_id;
	}

	model.track_sort_direction[track_id] = ifndef(init_sort_direction, 1);
	
	target_group = ifndef(target_group, 0);
	while (target_group >= model.track_groups.length) {
	    model.track_groups.push([]);
	    model.track_group_header.push("");
	}
	if (track_group_header) {
	    model.track_group_header[target_group] = track_group_header;
	}
	model.track_groups[target_group].push(track_id);
	
	
	
	model.track_id_to_datum.update(model, track_id);
	model.track_present_ids.update(model, track_id);
	model.precomputed_comparator.update(model, track_id);
	
	model.setIdOrder(Object.keys(model.present_ids.get()));
    }

    var _getContainingTrackGroup = function (oncoprint_model, track_id, return_reference) {
	var group;
	track_id = parseInt(track_id);
	for (var i = 0; i < oncoprint_model.track_groups.length; i++) {
	    if (oncoprint_model.track_groups[i].indexOf(track_id) > -1) {
		group = oncoprint_model.track_groups[i];
		break;
	    }
	}
	if (group) {
	    return (return_reference ? group : group.slice());
	} else {
	    return null;
	}
    }

    var isRuleSetUsed = function(model, rule_set_id) {
	var used = false;
	var tracks = model.getTracks();
	for (var i=0; i<tracks.length; i++) {
	    if (model.track_rule_set_id[tracks[i]] === rule_set_id) {
		used = true;
		break;
	    }
	}
	return used;
    }
   
    OncoprintModel.prototype.removeTrack = function (track_id) {
	var rule_set_id = this.track_rule_set_id[track_id];
	this.track_remove_callback[track_id](track_id);
	
	delete this.track_data[track_id];
	delete this.track_rule_set_id[track_id];
	delete this.track_label[track_id];
	delete this.cell_height[track_id];
	delete this.track_padding[track_id];
	delete this.track_data_id_key[track_id];
	delete this.track_tooltip_fn[track_id];
	delete this.track_removable[track_id];
	delete this.track_remove_callback[track_id];
	delete this.track_sort_cmp_fn[track_id];
	delete this.track_sort_direction_changeable[track_id];
	delete this.track_sort_direction[track_id];
	delete this.track_info[track_id];
	delete this.track_has_column_spacing[track_id];

	var containing_track_group = _getContainingTrackGroup(this, track_id, true);
	if (containing_track_group !== null) {
	    containing_track_group.splice(
		    containing_track_group.indexOf(track_id), 1);
	}
	var i, index_in_group;
	for (i in this.track_expansion_tracks) {
	    if (this.track_expansion_tracks.hasOwnProperty(i)) {
		index_in_group = this.track_expansion_tracks[i].indexOf(track_id);
		if (index_in_group !== -1) {
		    this.track_expansion_tracks[i].splice(index_in_group, 1);
		}
	    }
	}
	this.track_tops.update();
	this.track_present_ids.update(this, track_id);
	this.track_id_to_datum.update(this, track_id);
	this.setIdOrder(Object.keys(this.present_ids.get()));
	
	var rule_set_used = isRuleSetUsed(this, rule_set_id);
	if (!rule_set_used) {
	    delete this.rule_sets[rule_set_id];
	}
    }
    
    OncoprintModel.prototype.getOverlappingCell = function(x,y) {
	// First, see if it's in a column
	var id_order = this.getIdOrder();
	var zoomed_column_left = this.getZoomedColumnLeft();
	var nearest_id_index = binarysearch(id_order, x, function(id) { return zoomed_column_left[id];}, true);
	if (nearest_id_index === -1) {
	    return null;
	}
	var id = id_order[nearest_id_index];
	
	// Next, see if it's in a track
	var tracks = this.getTracks();
	var cell_tops = this.getCellTops();
	var nearest_track_index = binarysearch(tracks, y, function (track) {
	    return cell_tops[track];
	}, true);
	if (nearest_track_index === -1) {
	    return null;
	}
	var nearest_track = tracks[nearest_track_index];
	
	// Finally, see if it's inside a cell
	var hitzone_right = zoomed_column_left[id] + this.getCellWidth();
	if (!this.getTrackHasColumnSpacing(nearest_track)) {
	    hitzone_right += this.getCellPadding();
	}
	if (x <= hitzone_right && y < cell_tops[nearest_track] + this.getCellHeight(nearest_track)) {  
	    return {'id': id, 'track': nearest_track, 'top': cell_tops[nearest_track], 'left': zoomed_column_left[id]};
	}
	return null;
    };
    
    OncoprintModel.prototype.getTrackDatum = function(track_id, id) {
	var datum = this.track_id_to_datum.get()[track_id][id];
	if (typeof datum === 'undefined') {
	    datum = null;
	}
	return datum;
    }
    
    OncoprintModel.prototype.getTrackTops = function (desired_track_id) {
	if (typeof desired_track_id === 'undefined') {
	    return copyShallowObject(this.track_tops.get());
	} else {
	    return this.track_tops.get()[desired_track_id];
	}
    }
    
    OncoprintModel.prototype.getZoomedTrackTops = function (desired_track_id) {
	if (typeof desired_track_id === 'undefined') {
	    return copyShallowObject(this.track_tops_zoomed.get());
	} else {
	    return this.track_tops_zoomed.get()[desired_track_id];
	}
    }
    
    OncoprintModel.prototype.getCellTops = function(desired_track_id, base) {
	if (typeof desired_track_id === 'undefined') {
	    return copyShallowObject((base ? this.cell_tops : this.cell_tops_zoomed).get());
	} else {
	    return (base ? this.cell_tops : this.cell_tops_zoomed).get()[desired_track_id];
	}
    }
    OncoprintModel.prototype.getLabelTops = function(desired_track_id, base) {
	if (typeof desired_track_id === 'undefined') {
	    return copyShallowObject((base ? this.label_tops : this.label_tops_zoomed).get());
	} else {
	    return (base ? this.label_tops : this.label_tops_zoomed).get()[desired_track_id];
	}
    }
    
    OncoprintModel.prototype.getContainingTrackGroup = function (track_id) {
	return _getContainingTrackGroup(this, track_id, false);
    }

    OncoprintModel.prototype.setTrackGroupHeader = function(track_group_id, text) {
	this.track_group_header[track_group_id] = text;
	this.track_tops.update();
    }
    
    OncoprintModel.prototype.getTrackGroupHeader = function(track_group_id) {
	return this.track_group_header[track_group_id] || "";
    }
    
    OncoprintModel.prototype.getTrackGroupHeaderSize = function() {
	return 20;
    }
    
    OncoprintModel.prototype.getTrackGroups = function () {
	// TODO: make read-only
	return this.track_groups;
    }

    OncoprintModel.prototype.getTracks = function () {
	var ret = [];
	for (var i = 0; i < this.track_groups.length; i++) {
	    for (var j = 0; j < this.track_groups[i].length; j++) {
		ret.push(this.track_groups[i][j]);
	    }
	}
	return ret;
    }

    OncoprintModel.prototype.getIdsInLeftInterval = function(left, right) {
	var cell_width = this.getCellWidth();
	var cell_padding = this.getCellPadding();
	var id_order = this.getIdOrder();
	
	// left_id_index and right_id_index are inclusive
	var left_id_index = Math.floor(left/(cell_width + cell_padding));
	var left_remainder = left - left_id_index*(cell_width + cell_padding);
	if (left_remainder > cell_width) {
	    left_id_index += 1;
	}
	var right_id_index = Math.floor(right/(cell_width + cell_padding));
	return id_order.slice(left_id_index, right_id_index+1);
    }
    OncoprintModel.prototype.getColumnLeft = function(id) {
	if (typeof id === 'undefined') {
	    return this.column_left.get();
	} else {
	    return this.column_left.get()[id];
	}
    }
    
    OncoprintModel.prototype.getColumnLeftNoPadding = function(id) {
	if (typeof id === 'undefined') {
	    return this.column_left_no_padding.get();
	} else {
	    return this.column_left_no_padding.get()[id];
	}
    }
    
    OncoprintModel.prototype.getZoomedColumnLeft = function(id) {
	if (typeof id === 'undefined') {
	    return this.zoomed_column_left.get();
	} else {
	    return this.zoomed_column_left.get()[id];
	}
    }
    
    
    OncoprintModel.prototype.getOncoprintHeight = function(base) {
	var tracks = this.getTracks();
	var last_track = tracks[tracks.length-1];
	return (base ? this.getTrackTops(last_track) : this.getZoomedTrackTops(last_track))+this.getTrackHeight(last_track, base)
		    + this.getBottomPadding();
    }
    
    OncoprintModel.prototype.getOncoprintWidth = function(base) {
	return this.getIdOrder().length*(this.getCellWidth(base) + this.getCellPadding(base));
    }
    
    OncoprintModel.prototype.getOncoprintWidthNoColumnPadding = function(base) {
	return this.getIdOrder().length*this.getCellWidth(base);
    }
    
    OncoprintModel.prototype.getCellViewHeight = function() {
	return Math.min(this.max_height, this.getOncoprintHeight());
    }
    
    OncoprintModel.prototype.getCellViewWidth = function() {
	return this.getOncoprintWidth();
    }
    OncoprintModel.prototype.moveTrack = function (track_id, new_previous_track) {
	var track_group = _getContainingTrackGroup(this, track_id, true);
	if (track_group !== null) {
	    track_group.splice(track_group.indexOf(track_id), 1);
	    var new_position = (new_previous_track === null ? 0 : track_group.indexOf(new_previous_track)+1);
	    track_group.splice(new_position, 0, track_id);
	}
	
	this.track_tops.update();
    }

    OncoprintModel.prototype.getTrackLabel = function (track_id) {
	return this.track_label[track_id];
    }
    
    OncoprintModel.prototype.getTrackDescription = function(track_id) {
	return this.track_description[track_id];
    }

    OncoprintModel.prototype.getTrackTooltipFn = function (track_id) {
	return this.track_tooltip_fn[track_id];
    }
    OncoprintModel.prototype.setTrackTooltipFn = function (track_id, tooltipFn) {
	this.track_tooltip_fn[track_id] = tooltipFn;
    }

    OncoprintModel.prototype.getTrackDataIdKey = function (track_id) {
	return this.track_data_id_key[track_id];
    }

    OncoprintModel.prototype.getTrackGroupPadding = function (base) {
	return this.track_group_padding * (base ? 1 : this.vert_zoom);
    }
    
    OncoprintModel.prototype.isTrackRemovable = function (track_id) {
	return this.track_removable[track_id];
    }
    
    OncoprintModel.prototype.isTrackSortDirectionChangeable = function (track_id) {
	return this.track_sort_direction_changeable[track_id];
    }
    
    OncoprintModel.prototype.isTrackExpandable = function (track_id) {
	return this.track_expansion_init_callback.hasOwnProperty(track_id) &&
		((!this.track_expansion_genes.hasOwnProperty(track_id)) ||
		 this.track_expansion_genes[track_id].length > 0);
    }
    
    OncoprintModel.prototype.initExpansion = function (track_id) {
	this.track_expansion_init_callback[track_id](track_id);
    }
    
    OncoprintModel.prototype.setExpansionGeneData = function (track_id, geneDataArray) {
	this.track_expansion_genes[track_id] = geneDataArray;
    }
    
    OncoprintModel.prototype.setExpansionCallback = function (track_id, callbackFn) {
	this.track_expansion_callback[track_id] = callbackFn;
    }
    
    OncoprintModel.prototype.isTrackExpanded = function (track_id) {
	return this.track_expansion_tracks.hasOwnProperty(track_id) &&
		this.track_expansion_tracks[track_id].length > 0;
    }
    
    OncoprintModel.prototype.expandTrack = function (track_id, maxGenes) {
	maxGenes = maxGenes || 5;
	// pop off the first `maxGenes` genes, up to the end of the array
	var genes = this.track_expansion_genes[track_id].splice(0, maxGenes);
	return this.track_expansion_callback[track_id](track_id, genes);
    }
    
    OncoprintModel.prototype.getRuleSet = function (track_id) {
	return this.rule_sets[this.track_rule_set_id[track_id]];
    }

    OncoprintModel.prototype.shareRuleSet = function(source_track_id, target_track_id) {
	var curr_rule_set_id = this.track_rule_set_id[target_track_id];
	var should_delete_curr_rule_set = true;
	for (var track_id in this.track_rule_set_id) {
	    if (this.track_rule_set_id.hasOwnProperty(track_id) && track_id !== source_track_id + '') {
		if (this.track_rule_set_id[track_id] === curr_rule_set_id) {
		    should_delete_curr_rule_set = false;
		    break;
		}
	    }
	}
	if (should_delete_curr_rule_set) {
	    delete this.rule_sets[curr_rule_set_id];
	}
	delete this.track_active_rules[target_track_id];
	this.track_rule_set_id[target_track_id] = this.track_rule_set_id[source_track_id];
    }
    
    OncoprintModel.prototype.setRuleSet = function(track_id, rule_set) {
	var curr_rule_set_id = this.track_rule_set_id[track_id];
	this.rule_sets[rule_set.rule_set_id] = rule_set;
	this.track_rule_set_id[track_id] = rule_set.rule_set_id;
	
	var rule_set_used = isRuleSetUsed(this, curr_rule_set_id);
	if (!rule_set_used) {
	    delete this.rule_sets[curr_rule_set_id];
	}
    }

    OncoprintModel.prototype.getTrackSortComparator = function(track_id) {
	return this.track_sort_cmp_fn[track_id];
    }
    
    OncoprintModel.prototype.setTrackSortComparator = function(track_id, sortCmpFn) {
	this.track_sort_cmp_fn[track_id] = sortCmpFn;
	this.precomputed_comparator.update(this, track_id);
    }
    
    OncoprintModel.prototype.getTrackData = function (track_id) {
	return this.track_data[track_id];
    }
    
    /**
     * Sets the data for an Oncoprint track.
     *
     * @param track_id - the ID that identifies the track
     * @param {Object[]} data - the list of data for the cells
     * @param {string} data_id_key - name of the property of the
     * data objects to use as the (column) key
     */
    OncoprintModel.prototype.setTrackData = function (track_id, data, data_id_key) {
	this.track_data[track_id] = data;
	this.track_data_id_key[track_id] = data_id_key;
	this.track_id_to_datum.update(this, track_id);
	this.track_present_ids.update(this, track_id);
	this.setIdOrder(Object.keys(this.present_ids.get()));
	this.precomputed_comparator.update(this, track_id);
    }
    
    OncoprintModel.prototype.computeTrackIdToDatum = function(track_id) {
	this.track_id_to_datum[track_id] = {};
	
	var track_data = this.track_data[track_id] || [];
	var track_id_key = this.track_data_id_key[track_id];
	for (var i=0; i<track_data.length; i++) {
	    this.track_id_to_datum[track_id][track_data[i][track_id_key]] = track_data[i];
	}
    }
    
    OncoprintModel.prototype.setTrackGroupSortPriority = function(priority) {
	this.track_group_sort_priority = priority;
	this.sort();
    }
    var sortAlphabetical = function(model) {
	var id_order = model.getIdOrder(true).slice();
	id_order.sort(function(a,b) {
	    return a.localeCompare(b);
	});
	model.setIdOrder(id_order);
    };
    var sortByTracks = function(model) {
	var track_group_sort_priority = model.track_group_sort_priority;
	var track_groups = model.getTrackGroups();
	var track_groups_in_sort_order;
	
	if (track_group_sort_priority.length < track_groups.length) {
	    track_groups_in_sort_order = track_groups;
	} else {
	    track_groups_in_sort_order = track_group_sort_priority.map(function(x) {
		return track_groups[x];
	    });
	}
	
	var track_sort_priority = track_groups_in_sort_order.reduce(function(acc, next) {
	    return acc.concat(next);
	}, []);
	
	var precomputed_comparator = model.precomputed_comparator.get();
	var curr_id_to_index = model.getIdToIndexMap();
	var combinedComparator = function(idA, idB) {
	    var res = 0;
	    for (var i=0; i<track_sort_priority.length; i++) {
		res = precomputed_comparator[track_sort_priority[i]].compare(idA, idB);
		if (res !== 0) {
		    break;
		}
	    }
	    if (res === 0) {
		// stable sort
		res = ( curr_id_to_index[idA] < curr_id_to_index[idB] ? -1 : 1); // will never be the same, no need to check for 0
	    }
	    return res;
	}
	var id_order = model.getIdOrder(true).slice();
	id_order.sort(combinedComparator);
	model.setIdOrder(id_order);
    };
    OncoprintModel.prototype.sort = function() {
	this.sort_config = this.sort_config || {};
	if (this.sort_config.type === "alphabetical") {
	    sortAlphabetical(this);
	} else if (this.sort_config.type === "order") {
	    this.setIdOrder(this.sort_config.order);
	} else {
	    sortByTracks(this);
	}
    }
    
    OncoprintModel.prototype.setSortConfig = function(params) {
	this.sort_config = params;
    }

    return OncoprintModel;
})();

var PrecomputedComparator = (function() {
    function PrecomputedComparator(list, comparator, sort_direction, element_identifier_key) {
	var directed_comparator = function(d1, d2) {
	    if (sort_direction === 0) {
		return 0;
	    }
	    var res = comparator(d1, d2);
	    if (res === 2) {
		return 1;
	    } else if (res === -2) {
		return -1;
	    } else {
		return res*sort_direction;
	    }
	};
	var sorted_list = list.sort(directed_comparator);
	this.change_points = []; // i is a change point iff comp(elt[i], elt[i+1]) !== 0
	for (var i=0; i<sorted_list.length; i++) {
	    if (i === sorted_list.length - 1) {
		break;
	    }
	    if (directed_comparator(sorted_list[i], sorted_list[i+1]) !== 0) {
		this.change_points.push(i);
	    }
	}
	// Note that by this process change_points is sorted
	this.id_to_index = {};
	for (var i=0; i<sorted_list.length; i++) {
	    this.id_to_index[sorted_list[i][element_identifier_key]] = i;
	}
    }
    PrecomputedComparator.prototype.compare = function(idA, idB) {
	var indA = this.id_to_index[idA];
	var indB = this.id_to_index[idB];
	if (typeof indA === 'undefined' && typeof indB === 'undefined') {
	    return 0;
	} else if (typeof indA === 'undefined') {
	    return 1;
	} else if (typeof indB === 'undefined') {
	    return -1;
	}
	
	var should_negate_result = false;
	if (indA === indB) {
	    return 0;
	} else if (indA > indB) {
	    // switch if necessary to make process WLOG
	    var tmp = indA;
	    indA = indB;
	    indB = tmp;
	    should_negate_result = true;
	}
	// See if any changepoints in [indA, indB)
	var upper_bd_excl = this.change_points.length;
	var lower_bd_incl = 0;
	var middle;
	var res = 0;
	while (true) {
	    middle = Math.floor((lower_bd_incl + upper_bd_excl) / 2);
	    if (lower_bd_incl === upper_bd_excl) {
		break;
	    } else if (this.change_points[middle] >= indB) {
		upper_bd_excl = middle;
	    } else if (this.change_points[middle] < indA) {
		lower_bd_incl = middle+1;
	    } else {
		res = -1;
		break;
	    }
	}
	if (should_negate_result) {
	    res = res * -1;
	}
	return res;
    }
    return PrecomputedComparator;
})();
module.exports = OncoprintModel;
},{"./CachedProperty.js":1,"./binarysearch.js":2}],22:[function(require,module,exports){
/* Rule:
 * 
 * condition: function from datum to boolean
 * shapes - a list of Shapes
 * legend_label
 * exclude_from_legend
 * 
 * Shape:
 * type
 * x
 * y
 * ... shape-specific attrs ...
 * 
 * Attrs by shape:
 * 
 * rectangle: x, y, width, height, stroke, stroke-width, fill
 * triangle: x1, y1, x2, y2, x3, y3, stroke, stroke-width, fill
 * ellipse: x, y, width, height, stroke, stroke-width, fill
 * line: x1, y1, x2, y2, stroke, stroke-width
 */

var Shape = require('./oncoprintshape.js');
var extractRGBA = require('./extractrgba.js');
var heatmapColors = require('./heatmapcolors.js');
var binarysearch = require('./binarysearch.js');

function ifndef(x, val) {
    return (typeof x === "undefined" ? val : x);
}

function makeIdCounter() {
    var id = 0;
    return function () {
	id += 1;
	return id;
    };
}

function intRange(length) {
    var ret = [];
    for (var i=0; i<length; i++) {
	ret.push(i);
    }
    return ret;
}

function makeUniqueColorGetter(init_used_colors) {
    init_used_colors = init_used_colors || [];
    var colors = ["#3366cc", "#dc3912", "#ff9900", "#109618",
	"#990099", "#0099c6", "#dd4477", "#66aa00",
	"#b82e2e", "#316395", "#994499", "#22aa99",
	"#aaaa11", "#6633cc", "#e67300", "#8b0707",
	"#651067", "#329262", "#5574a6", "#3b3eac",
	"#b77322", "#16d620", "#b91383", "#f4359e",
	"#9c5935", "#a9c413", "#2a778d", "#668d1c",
	"#bea413", "#0c5922", "#743411"]; // Source: D3
    var index = 0;
    var used_colors = {};
    for (var i=0; i<init_used_colors.length; i++) {
	used_colors[init_used_colors[i]] = true;
    }
    return function() {
	var next_color = colors[index % colors.length];
	while (used_colors[next_color]) {
	    var darker_next_color = darkenHexColor(next_color);
	    if (darker_next_color === next_color) {
		break;
	    }
	    next_color = darker_next_color;
	}
	used_colors[next_color] = true;
	index += 1;
	
	return next_color;
    };
};

function shallowExtend(target, source) {
    var ret = {};
    for (var key in target) {
	if (target.hasOwnProperty(key)) {
	    ret[key] = target[key];
	}
    }
    for (var key in source) {
	if (source.hasOwnProperty(key)) {
	    ret[key] = source[key];
	}
    }
    return ret;
}

function objectValues(obj) {
    return Object.keys(obj).map(function(key) { return obj[key]; });
}

var makeNAShapes = function(z) {
    return [{
	'type': 'rectangle',
	'fill': 'rgba(224, 224, 224, 1)',
	'z': z
    }];
};
var NA_STRING = "na";
var NA_LABEL = "N/A";

var colorToHex = function(str) {
    var r;
    var g;
    var b;
    var rgba_match = str.match(/^[\s]*rgba\([\s]*([0-9]+)[\s]*,[\s]*([0-9]+)[\s]*,[\s]*([0-9]+)[\s]*,[\s]*([0-9.]+)[\s]*\)[\s]*$/);
    if (rgba_match && rgba_match.length === 5) {
	r = parseInt(rgba_match[1]).toString(16);
	g = parseInt(rgba_match[2]).toString(16);
	b = parseInt(rgba_match[3]).toString(16);
	if (r.length === 1) {
	    r = '0' + r;
	}
	if (g.length === 1) {
	    g = '0' + g;
	}
	if (b.length === 1) {
	    b = '0' + b;
	}
	return '#' + r + g + b;
    }
    
    var rgb_match = str.match(/^[\s]*rgb\([\s]*([0-9]+)[\s]*,[\s]*([0-9]+)[\s]*,[\s]*([0-9]+)[\s]*\)[\s]*$/);
    if (rgb_match && rgb_match.length === 4) {
	r = parseInt(rgb_match[1]).toString(16);
	g = parseInt(rgb_match[2]).toString(16);
	b = parseInt(rgb_match[3]).toString(16);
	if (r.length === 1) {
	    r = '0' + r;
	}
	if (g.length === 1) {
	    g = '0' + g;
	}
	if (b.length === 1) {
	    b = '0' + b;
	}
	return '#' + r + g + b;
    }
    
    return str;
};

var darkenHexColor = function(str) {
    var r = str[1] + str[2];
    var g = str[3] + str[4];
    var b = str[5] + str[6];
    var darkenHexChannel = function(c) {
	c = parseInt(c, 16);
	c *= 0.95;
	c = Math.round(c);
	c = c.toString(16);
	if (c.length === 1) {
	    c = '0' + c;
	}
	return c;
    };
    r = darkenHexChannel(r);
    g = darkenHexChannel(g);
    b = darkenHexChannel(b);
    return '#' + r + g + b;
};

var RuleSet = (function () {
    var getRuleSetId = makeIdCounter();
    var getRuleId = makeIdCounter();

    function RuleSet(params) {
	/* params:
	 * - legend_label
	 * - exclude_from_legend
	 */
	this.rule_set_id = getRuleSetId();
	this.legend_label = params.legend_label;
	this.exclude_from_legend = params.exclude_from_legend;
	this.active_rule_ids = {};
	this.rules_with_id = [];

    }

    RuleSet.prototype.getLegendLabel = function () {
	return this.legend_label;
    }

    RuleSet.prototype.getRuleSetId = function () {
	return this.rule_set_id;
    }

    RuleSet.prototype.addRules = function (list_of_params) {
	var self = this;
	return list_of_params.map(function (params) {
	    return self.addRule(params);
	});
    }

    RuleSet.prototype.addRule = function (params) {
	var rule_id = getRuleId();
	this.rules_with_id.push({id: rule_id, rule: new Rule(params)});
	return rule_id;
    }

    RuleSet.prototype.removeRule = function (rule_id) {
	var index = -1;
	for (var i = 0; i < this.rules_with_id.length; i++) {
	    if (this.rules_with_id[i].id === rule_id) {
		index = i;
		break;
	    }
	}
	if (index > -1) {
	    this.rules_with_id.splice(index, 1);
	}
	delete this.active_rule_ids[rule_id];
    }

    RuleSet.prototype.getRuleWithId = function (rule_id) {
	var ret = null;
	for (var i = 0; i < this.rules_with_id.length; i++) {
	    if (this.rules_with_id[i].id === rule_id) {
		ret = this.rules_with_id[i];
		break;
	    }
	}
	return ret;
    }

    RuleSet.prototype.isExcludedFromLegend = function () {
	return this.exclude_from_legend;
    }

    RuleSet.prototype.getRecentlyUsedRules = function () {
	var self = this;
	return Object.keys(this.active_rule_ids).map(
		function (rule_id) {
		    return self.getRule(rule_id);
		});
    }

    RuleSet.prototype.applyRulesToDatum = function (rules_with_id, datum, cell_width, cell_height) {
	var shapes = [];
	var rules_len = rules_with_id.length;
	for (var j = 0; j < rules_len; j++) {
	    shapes = shapes.concat(rules_with_id[j].rule.apply(datum, cell_width, cell_height));
	}
	return shapes;
    }
    RuleSet.prototype.apply = function (data, cell_width, cell_height, out_active_rules) {
	// Returns a list of lists of concrete shapes, in the same order as data
	var ret = [];
	for (var i = 0; i < data.length; i++) {
	    var rules = this.getRulesWithId(data[i]);
	    if (typeof out_active_rules !== 'undefined') {
		for (var j = 0; j < rules.length; j++) {
		    out_active_rules[rules[j].id] = true;
		}
	    }
	    ret.push(this.applyRulesToDatum(rules, data[i], cell_width, cell_height));
	}
	return ret;
    }

    return RuleSet;
})();

var LookupRuleSet = (function () {
    function LookupRuleSet(params) {
	RuleSet.call(this, params);
	this.lookup_map_by_key_and_value = {};
	this.lookup_map_by_key = {};
	this.universal_rules = [];

	this.rule_id_to_conditions = {};
    }
    LookupRuleSet.prototype = Object.create(RuleSet.prototype);

    LookupRuleSet.prototype.getRulesWithId = function (datum) {
	if (typeof datum === 'undefined') {
	    return this.rules_with_id;
	}
	var ret = [];
	ret = ret.concat(this.universal_rules);
	for (var key in datum) {
	    if (typeof datum[key] !== 'undefined') {
		var key_rule = this.lookup_map_by_key[key];
		if (typeof key_rule !== 'undefined') {
		    ret.push(key_rule);
		}
		var key_and_value_rule = (this.lookup_map_by_key_and_value[key] && this.lookup_map_by_key_and_value[key][datum[key]]) || undefined;
		if (typeof key_and_value_rule !== 'undefined') {
		    ret.push(key_and_value_rule);
		}
	    }
	}
	return ret;
    }

    var indexRuleForLookup = function (rule_set, condition_key, condition_value, rule_with_id) {
	if (condition_key === null) {
	    rule_set.universal_rules.push(rule_with_id);
	} else {
	    if (condition_value === null) {
		rule_set.lookup_map_by_key[condition_key] = rule_with_id;
	    } else {
		rule_set.lookup_map_by_key_and_value[condition_key] = rule_set.lookup_map_by_key_and_value[condition_key] || {};
		rule_set.lookup_map_by_key_and_value[condition_key][condition_value] = rule_with_id;
	    }
	}
	rule_set.rule_id_to_conditions[rule_with_id.id] = rule_set.rule_id_to_conditions[rule_with_id.id] || [];
	rule_set.rule_id_to_conditions[rule_with_id.id].push({key: condition_key, value: condition_value});
    };

    LookupRuleSet.prototype.addRule = function (condition_key, condition_value, params) {
	var rule_id = RuleSet.prototype.addRule.call(this, params);

	indexRuleForLookup(this, condition_key, condition_value, this.getRuleWithId(rule_id));

	return rule_id;
    }

    LookupRuleSet.prototype.linkExistingRule = function (condition_key, condition_value, existing_rule_id) {
	indexRuleForLookup(this, condition_key, condition_value, this.getRuleWithId(existing_rule_id));
    }

    LookupRuleSet.prototype.removeRule = function (rule_id) {
	RuleSet.prototype.removeRule.call(this, rule_id);

	while (this.rule_id_to_conditions[rule_id].length > 0) {
	    var condition = this.rule_id_to_conditions[rule_id].pop();
	    if (condition.key === null) {
		var index = -1;
		for (var i = 0; i < this.universal_rules.length; i++) {
		    if (this.universal_rules[i].id === rule_id) {
			index = i;
			break;
		    }
		}
		if (index > -1) {
		    this.universal_rules.splice(index, 1);
		}
	    } else {
		if (condition.value === null) {
		    delete this.lookup_map_by_key[condition.key];
		} else {
		    delete this.lookup_map_by_key_and_value[condition.key][condition.value];
		}
	    }
	}
	delete this.rule_id_to_conditions[rule_id];
    }
    return LookupRuleSet;
})();

var ConditionRuleSet = (function () {
    function ConditionRuleSet(params) {
	RuleSet.call(this, params);
	this.rule_id_to_condition = {};

	this.addRule(function (d) {
	    return d[NA_STRING] === true;
	},
		{shapes: makeNAShapes(params.na_z || 1000),
		    legend_label: NA_LABEL,
		    exclude_from_legend: false,
		    legend_config: {'type': 'rule', 'target': {'na': true}}
		});
    }
    ConditionRuleSet.prototype = Object.create(RuleSet.prototype);

    ConditionRuleSet.prototype.getRulesWithId = function (datum) {
	if (typeof datum === 'undefined') {
	    return this.rules_with_id;
	}
	var ret = [];
	for (var i = 0; i < this.rules_with_id.length; i++) {
	    if (this.rule_id_to_condition[this.rules_with_id[i].id](datum)) {
		ret.push(this.rules_with_id[i]);
	    }
	}
	return ret;
    }

    ConditionRuleSet.prototype.addRule = function (condition, params) {
	var rule_id = RuleSet.prototype.addRule.call(this, params);
	this.rule_id_to_condition[rule_id] = condition;
	return rule_id;
    }

    ConditionRuleSet.prototype.removeRule = function (rule_id) {
	RuleSet.prototype.removeRule.call(this, rule_id);
	delete this.rule_id_to_condition[rule_id];
    }

    return ConditionRuleSet;
})();

var CategoricalRuleSet = (function () {
    function CategoricalRuleSet(params) {
	/* params
	 * - category_key
	 * - categoryToColor
	 */
	LookupRuleSet.call(this, params);
	
	this.addRule(NA_STRING, true, {
	    shapes: makeNAShapes(params.na_z || 1000),
	    legend_label: NA_LABEL,
	    exclude_from_legend: false,
	    legend_config: {'type': 'rule', 'target': {'na': true}}
	});
	
	this.category_key = params.category_key;
	this.category_to_color = ifndef(params.category_to_color, {});
	this.getUnusedColor = makeUniqueColorGetter(objectValues(this.category_to_color).map(colorToHex));
	for (var category in this.category_to_color) {
	    if (this.category_to_color.hasOwnProperty(category)) {
		var color = this.category_to_color[category];
		addCategoryRule(this, category, color);
		this.used_colors[colorToHex(color)] = true;
	    }
	}
    }
    CategoricalRuleSet.prototype = Object.create(LookupRuleSet.prototype);

    var addCategoryRule = function (ruleset, category, color) {
	var legend_rule_target = {};
	legend_rule_target[ruleset.category_key] = category;
	var rule_params = {
	    shapes: [{
		    type: 'rectangle',
		    fill: color,
		}],
	    legend_label: category,
	    exclude_from_legend: false,
	    legend_config: {'type': 'rule', 'target': legend_rule_target}
	};
	ruleset.addRule(ruleset.category_key, category, rule_params);
    };

    CategoricalRuleSet.prototype.apply = function (data, cell_width, cell_height, out_active_rules) {
	// First ensure there is a color for all categories
	for (var i = 0, data_len = data.length; i < data_len; i++) {
	    if (data[i][NA_STRING]) {
		continue;
	    }
	    var category = data[i][this.category_key];
	    if (!this.category_to_color.hasOwnProperty(category)) {
		var color = this.getUnusedColor(this);
		
		this.category_to_color[category] = color;
		addCategoryRule(this, category, color);
	    }
	}
	// Then propagate the call up
	return LookupRuleSet.prototype.apply.call(this, data, cell_width, cell_height, out_active_rules);
    };

    return CategoricalRuleSet;
})();

var LinearInterpRuleSet = (function () {
    function LinearInterpRuleSet(params) {
	/* params
	 * - log_scale
	 * - value_key
	 * - value_range
	 */
	ConditionRuleSet.call(this, params);
	this.value_key = params.value_key;
	this.value_range = params.value_range;
	this.log_scale = params.log_scale; // boolean
	this.inferred_value_range;

	this.makeInterpFn = function () {
	    var range = this.getEffectiveValueRange();

	    if (this.log_scale) {
		var shift_to_make_pos = Math.abs(range[0]) + 1;
		var log_range = Math.log(range[1] + shift_to_make_pos) - Math.log(range[0] + shift_to_make_pos);
		var log_range_lower = Math.log(range[0] + shift_to_make_pos);
		return function (val) {
		    val = parseFloat(val);
		    return (Math.log(val + shift_to_make_pos) - log_range_lower) / log_range;
		};
	    } else {
		var range_spread = range[1] - range[0];
		var range_lower = range[0];
		return function (val) {
		    val = parseFloat(val);
		    if (val <= range[0]) {
			return 0;
		    } else if (val >= range[1]) {
			return 1;
		    } else {
			return (val - range_lower) / range_spread;
		    }
		};
	    }
	};
    }
    LinearInterpRuleSet.prototype = Object.create(ConditionRuleSet.prototype);

    LinearInterpRuleSet.prototype.getEffectiveValueRange = function () {
	var ret = (this.value_range && this.value_range.slice()) || [undefined, undefined];
	if (typeof ret[0] === "undefined") {
	    ret[0] = this.inferred_value_range[0];
	}
	if (typeof ret[1] === "undefined") {
	    ret[1] = this.inferred_value_range[1];
	}
	if (ret[0] === ret[1]) {
	    // Make sure non-empty interval
	    ret[0] -= ret[0] / 2;
	    ret[1] += ret[1] / 2;
	}
	return ret;
    };

    LinearInterpRuleSet.prototype.apply = function (data, cell_width, cell_height, out_active_rules) {
	// First find value range
	var value_min = Number.POSITIVE_INFINITY;
	var value_max = Number.NEGATIVE_INFINITY;
	for (var i = 0, datalen = data.length; i < datalen; i++) {
	    var d = data[i];
	    if (isNaN(d[this.value_key])) {
		continue;
	    }
	    value_min = Math.min(value_min, d[this.value_key]);
	    value_max = Math.max(value_max, d[this.value_key]);
	}
	if (value_min === Number.POSITIVE_INFINITY) {
	    value_min = 0;
	}
	if (value_max === Number.NEGATIVE_INFINITY) {
	    value_max = 0;
	}
	this.inferred_value_range = [value_min, value_max];
	this.updateLinearRules();

	// Then propagate the call up
	return ConditionRuleSet.prototype.apply.call(this, data, cell_width, cell_height, out_active_rules);
    };

    LinearInterpRuleSet.prototype.updateLinearRules = function () {
	throw "Not implemented in abstract class";
    };

    return LinearInterpRuleSet;
})();

var GradientRuleSet = (function () {
    function GradientRuleSet(params) {
	/* params
	 * - colors || colormap_name
	 * - null_color
	 */
	LinearInterpRuleSet.call(this, params);

	this.colors = [];
	if (params.colors) {
	    this.colors = params.colors || [];
	} else if (params.colormap_name) {
	    this.colors = heatmapColors[params.colormap_name] || [];
	}
	if (this.colors.length === 0) {
	    this.colors.push([0,0,0,1],[255,0,0,1]);
	}
	
	this.value_stop_points = params.value_stop_points;

	this.gradient_rule;
	this.null_color = params.null_color || "rgba(211,211,211,1)";
    }
    GradientRuleSet.prototype = Object.create(LinearInterpRuleSet.prototype);

    // interpScaleColors,
    // were adapted from politiken-journalism's scale-color-perceptual repo on Github
    var linInterpColors = function(t, begin_color, end_color) {
	// 0 <= t <= 1
	// begin_color and end_color are 4-element arrays in ([0,255])x([0,255])x([0,255])x([0,1])
	return [
	    Math.round(begin_color[0]*(1-t) + end_color[0]*t),
	    Math.round(begin_color[1]*(1-t) + end_color[1]*t),
	    Math.round(begin_color[2]*(1-t) + end_color[2]*t),
	    begin_color[3]*(1-t) + end_color[3]*t
	];
    };

    GradientRuleSet.prototype.makeColorFn = function(colors, interpFn) {
	var value_stop_points = this.value_stop_points;
	var stop_points;
	if (value_stop_points) {
	    stop_points = value_stop_points.map(interpFn);
	} else {
	    stop_points = intRange(colors.length).map(function(x) { return x/(colors.length -1); });
	}
	return function(t) {
	    // 0 <= t <= 1
	    var begin_interval_index = binarysearch(stop_points, t, function(x) { return x; }, true);
	    var end_interval_index = Math.min(colors.length - 1, begin_interval_index + 1);
	    var spread = stop_points[end_interval_index] - stop_points[begin_interval_index];
	    if (spread === 0) {
		return "rgba(" + colors[end_interval_index].join(",") + ")";
	    } else {
		var interval_t = (t - stop_points[begin_interval_index]) / spread;
		var begin_color = colors[begin_interval_index];
		var end_color = colors[end_interval_index];
		return "rgba(" + linInterpColors(interval_t, begin_color, end_color).join(",") + ")";
	    }
	    
	};
    }

    GradientRuleSet.prototype.updateLinearRules = function () {
	if (typeof this.gradient_rule !== "undefined") {
	    this.removeRule(this.gradient_rule);
	}
	var interpFn = this.makeInterpFn();
	var colorFn = this.makeColorFn(this.colors, interpFn);
	var value_key = this.value_key;
	var null_color = this.null_color;
	
	this.gradient_rule = this.addRule(function (d) {
	    return d[NA_STRING] !== true;
	},
		{shapes: [{
			    type: 'rectangle',
			    fill: function(d) {
				if (d[value_key]) {
				    var t = interpFn(d[value_key]);
				    return colorFn(t);
				} else {
				    return null_color;
				}
			    }
			}],
		    exclude_from_legend: false,
		    legend_config: {'type': 'gradient', 'range': this.getEffectiveValueRange(), 'colorFn':colorFn}
		});
    };

    return GradientRuleSet;
})();

var BarRuleSet = (function () {
    function BarRuleSet(params) {
	LinearInterpRuleSet.call(this, params);
	this.bar_rule;
	this.fill = params.fill || 'rgba(156,123,135,1)';
    }
    BarRuleSet.prototype = Object.create(LinearInterpRuleSet.prototype);

    BarRuleSet.prototype.updateLinearRules = function () {
	if (typeof this.bar_rule !== "undefined") {
	    this.removeRule(this.bar_rule);
	}
	var interpFn = this.makeInterpFn();
	var value_key = this.value_key;
	this.bar_rule = this.addRule(function (d) {
	    return d[NA_STRING] !== true;
	},
		{shapes: [{
			    type: 'rectangle',
			    y: function (d) {
				var t = interpFn(d[value_key]);
				return (1 - t) * 100 + "%";
			    },
			    height: function (d) {
				var t = interpFn(d[value_key]);
				return t * 100 + "%";
			    },
			    fill: this.fill,
			}],
		    exclude_from_legend: false,
		    legend_config: {'type': 'number', 
				    'range': this.getEffectiveValueRange(), 
				    'color': this.fill,
				    'interpFn': interpFn}
		});
    };

    return BarRuleSet;
})();

var StackedBarRuleSet = (function() {
    function StackedBarRuleSet(params) {
	/* params
	 * - categories
	 * - value_key
	 * - fills
	 */
	ConditionRuleSet.call(this, params);
	var value_key = params.value_key;
	var fills = params.fills || [];
	var categories = params.categories || [];
	var getUnusedColor = makeUniqueColorGetter(fills);
	
	// Initialize with default values
	while (fills.length < categories.length) {
	    fills.push(getUnusedColor());
	}
	
	var self = this;
	for (var i=0; i < categories.length; i++) {
	    (function(I) {
		var legend_target = {};
		legend_target[value_key] = {};
		for (var j=0; j<categories.length; j++) {
		    legend_target[value_key][categories[j]] = 0;
		}
		legend_target[value_key][categories[I]] = 1;
		self.addRule(function(d) {
		    return d[NA_STRING] !== true;
		},
		{shapes: [{
		    type: 'rectangle',
		    fill: fills[I],
		    width: '100%',
		    height: function(d) {
			var total = 0;
			for (var j=0; j<categories.length; j++) {
			    total += parseFloat(d[value_key][categories[j]]);
			}
			return parseFloat(d[value_key][categories[I]])*100/total + '%';
		    },
		    y: function(d) {
			var total = 0;
			var prev_vals_sum = 0;
			for (var j=0; j<categories.length; j++) {
			    var new_val = parseFloat(d[value_key][categories[j]]);
			    if (j < I) {
				prev_vals_sum += new_val;
			    }
			    total += new_val;
			}
			return prev_vals_sum*100/total + '%';
		    }
		}],
	    exclude_from_legend: false,
	    legend_config: {'type': 'rule', 'target': legend_target},
	    legend_label: categories[I]});
	    })(i);
	}
    }
    StackedBarRuleSet.prototype = Object.create(ConditionRuleSet.prototype);
    return StackedBarRuleSet;
})();
var GeneticAlterationRuleSet = (function () {
    function GeneticAlterationRuleSet(params) {
	/* params:
	 * - rule_params
	 */
	LookupRuleSet.call(this, params);
	(function addRules(self) {
	    var rule_params = params.rule_params;
	    for (var key in rule_params) {
		if (rule_params.hasOwnProperty(key)) {
		    var key_rule_params = rule_params[key];
		    if (key === '*') {
			self.addRule(null, null, shallowExtend(rule_params['*'], {'legend_config': {'type': 'rule', 'target': {}}}));
		    } else {
			for (var value in key_rule_params) {
			    if (key_rule_params.hasOwnProperty(value)) {
				var equiv_values = value.split(",");
				var legend_rule_target = {};
				legend_rule_target[equiv_values[0]] = value;
				var rule_id = self.addRule(key, (equiv_values[0] === '*' ? null : equiv_values[0]), shallowExtend(key_rule_params[value], {'legend_config': {'type': 'rule', 'target': legend_rule_target}}));
				for (var i = 1; i < equiv_values.length; i++) {
				    self.linkExistingRule(key, (equiv_values[i] === '*' ? null : equiv_values[i]), rule_id);
				}
			    }
			}
		    }
		}
	    }
	})(this);
	this.addRule(NA_STRING, true, {
	    shapes: makeNAShapes(params.na_z || 1),
	    legend_label: "N/S",
	    exclude_from_legend: false,
	    legend_config: {'type': 'rule', 'target': {'na': true}}
	});
    }
    GeneticAlterationRuleSet.prototype = Object.create(LookupRuleSet.prototype);

    return GeneticAlterationRuleSet;
})();

var Rule = (function () {
    function Rule(params) {
	this.shapes = params.shapes.map(function (shape) {
	    if (shape.type === 'rectangle') {
		return new Shape.Rectangle(shape);
	    } else if (shape.type === 'triangle') {
		return new Shape.Triangle(shape);
	    } else if (shape.type === 'ellipse') {
		return new Shape.Ellipse(shape);
	    } else if (shape.type === 'line') {
		return new Shape.Line(shape);
	    }
	});
	this.legend_label = typeof params.legend_label === "undefined" ? "" : params.legend_label;
	this.exclude_from_legend = params.exclude_from_legend;
	this.legend_config = params.legend_config;// {'type':'rule', 'target': {'mut_type':'MISSENSE'}} or {'type':'number', 'color':'rgba(1,2,3,1), 'range':[lower, upper]} or {'type':'gradient', 'color_range':['rgba(...)' or '#...', 'rgba(...)' or '#...'], 'number_range':[lower, upper]}
    }
    Rule.prototype.getLegendConfig = function () {
	return this.legend_config;
    }
    Rule.prototype.apply = function (d, cell_width, cell_height) {
	// Gets concrete shapes (i.e. computed
	// real values from percentages)
	var concrete_shapes = [];
	for (var i = 0, shapes_len = this.shapes.length; i < shapes_len; i++) {
	    concrete_shapes.push(this.shapes[i].getComputedParams(d, cell_width, cell_height));
	}
	return concrete_shapes;
    }

    Rule.prototype.isExcludedFromLegend = function () {
	return this.exclude_from_legend;
    }

    return Rule;
})();

module.exports = function (params) {
    if (params.type === 'categorical') {
	return new CategoricalRuleSet(params);
    } else if (params.type === 'gradient') {
	return new GradientRuleSet(params);
    } else if (params.type === 'bar') {
	return new BarRuleSet(params);
    } else if (params.type === 'stacked_bar') {
	return new StackedBarRuleSet(params);
    } else if (params.type === 'gene') {
	return new GeneticAlterationRuleSet(params);
    }
}
},{"./binarysearch.js":2,"./extractrgba.js":3,"./heatmapcolors.js":4,"./oncoprintshape.js":23}],23:[function(require,module,exports){
var Shape = (function() {
    var default_parameter_values = {
	    'width': '100%', 
	    'height': '100%', 
	    'x': '0%', 
	    'y': '0%', 
	    'z': 0,
	    'x1': '0%', 
	    'x2': '0%', 
	    'x3': '0%', 
	    'y1': '0%', 
	    'y2': '0%', 
	    'y3': '0%',
	    'stroke': 'rgba(0,0,0,0)', 
	    'fill': 'rgba(23,23,23,1)', 
	    'stroke-width': '0',
	    'stroke-opacity': '0'
    };
    var parameter_name_to_dimension_index = {
	'stroke-width':0,
	'width': 0,
	'x':0,
	'x1':0,
	'x2':0,
	'x3':0,
	'height':1,
	'y':1,
	'y1':1,
	'y2':1,
	'y3':1
    };
    function Shape(params) {
	this.params = params;
	this.params_with_type = {};
	this.completeWithDefaults();
	this.markParameterTypes();
    }
    Shape.prototype.completeWithDefaults = function() {
	var required_parameters = this.getRequiredParameters();
	for (var i=0; i<required_parameters.length; i++) {
	    var param = required_parameters[i];
	    this.params[param] = (typeof this.params[param] === 'undefined' ? default_parameter_values[param] : this.params[param]);
	}
    }
    Shape.prototype.markParameterTypes = function() {
	var parameters = Object.keys(this.params);
	for (var i=0; i<parameters.length; i++) {
	    var param_name = parameters[i];
	    var param_val = this.params[param_name];
	    if (typeof param_val === 'function') {
		this.params_with_type[param_name] = {'type':'function', 'value':param_val};
	    } else {
		this.params_with_type[param_name] = {'type':'value', 'value': param_val};
	    }
	}
    }
    Shape.prototype.getComputedParams = function(d, base_width, base_height) {
	var computed_params = {};
	var param_names = Object.keys(this.params_with_type);
	var dimensions = [base_width, base_height];
	for (var i=0; i<param_names.length; i++) {
	    var param_name = param_names[i];
	    var param_val_map = this.params_with_type[param_name];
	    var param_val = param_val_map.value;
	    if (param_name !== 'type') {
		if (param_val_map.type === 'function') {
		    param_val = param_val(d);
		}
		if (param_val[param_val.length-1] === '%') {
		    // check a couple of commonly-used special cases to avoid slower parseFloat 
		    if (param_val === '100%') {
			param_val = 1;
		    } else {
			param_val = parseFloat(param_val) / 100;
		    }
		    param_val *= dimensions[parameter_name_to_dimension_index[param_name]];
		}
	    }
	    computed_params[param_name] = param_val;
	}
	return computed_params;
    };
    return Shape;
})();



var Rectangle = (function() {
    function Rectangle(params) {
	Shape.call(this, params);
    }
    Rectangle.prototype = Object.create(Shape.prototype);
    Rectangle.prototype.getRequiredParameters = function() {
	return ['width', 'height', 'x', 'y', 'z', 'stroke', 'fill', 'stroke-width']; 
    }
    return Rectangle;
})();

var Triangle = (function() {
    function Triangle(params) {
	Shape.call(this, params);
    }
    Triangle.prototype = Object.create(Shape.prototype);
    Triangle.prototype.getRequiredParameters = function() {
	return ['x1', 'x2', 'x3', 'y1', 'y2', 'y3', 'z', 'stroke', 'fill', 'stroke-width']; 
    }
    return Triangle;
})();

var Ellipse = (function() {
    function Ellipse(params) {
	Shape.call(this, params);
    }
    Ellipse.prototype = Object.create(Shape.prototype);
    Ellipse.prototype.getRequiredParameters = function() {
	return ['width', 'height', 'x', 'y', 'z', 'stroke', 'fill', 'stroke-width']; 
    }
    return Ellipse;
})();

var Line = (function() {
    function Line(params) {
	Shape.call(this, params);
    }
    Line.prototype = Object.create(Shape.prototype);
    Line.prototype.getRequiredParameters = function() {
	return ['x1', 'x2', 'y1', 'y2', 'z', 'stroke', 'stroke-width']; 
    }
    return Line;
})();

module.exports = {
    'Rectangle':Rectangle,
    'Triangle':Triangle,
    'Ellipse':Ellipse,
    'Line':Line
};
},{}],24:[function(require,module,exports){
var makeSVGElement = function (tag, attrs) {
    var el = document.createElementNS('http://www.w3.org/2000/svg', tag);
    for (var k in attrs) {
	if (attrs.hasOwnProperty(k)) {
	    el.setAttribute(k, attrs[k]);
	}
    }
    return el;
};

var extractRGBA = require('./extractrgba.js');

var extractColor = function(str) {
    if (str.indexOf("rgb(") > -1) {
	return {
	    'rgb': str,
	    'opacity': 1
	};
    }
    var rgba_arr = extractRGBA(str);
    return {
	'rgb': 'rgb('+rgba_arr[0]*255+','+rgba_arr[1]*255+','+rgba_arr[2]*255+')',
	'opacity': rgba_arr[3]
    };
};

var rectangleToSVG = function (params, offset_x, offset_y) {
    var stroke_color = extractColor(params.stroke);
    var fill_color = extractColor(params.fill);
    return makeSVGElement('rect', {
	width: params.width,
	height: params.height,
	x: parseFloat(params.x) + offset_x,
	y: parseFloat(params.y) + offset_y,
	stroke: stroke_color.rgb,
	'stroke-opacity': stroke_color.opacity,
	'stroke-width': params['stroke-width'],
	fill: fill_color.rgb,
	'fill-opacity': fill_color.opacity
    });
};

var triangleToSVG = function (params, offset_x, offset_y) {
    var stroke_color = extractColor(params.stroke);
    var fill_color = extractColor(params.fill);
    return makeSVGElement('polygon', {
	points: [[parseFloat(params.x1) + offset_x, parseFloat(params.y1) + offset_y], [parseFloat(params.x2) + offset_x, parseFloat(params.y2) + offset_y], [parseFloat(params.x3) + offset_x, parseFloat(params.y3) + offset_y]].map(function (a) {
	    return a[0] + ',' + a[1];
	}).join(' '),
	stroke: stroke_color.rgb,
	'stroke-opacity': stroke_color.opacity,
	'stroke-width': params['stroke-width'],
	fill: fill_color.rgb,
	'fill-opacity': fill_color.opacity
    });
};

var ellipseToSVG = function (params, offset_x, offset_y) {
    var stroke_color = extractColor(params.stroke);
    var fill_color = extractColor(params.fill);
    return makeSVGElement('ellipse', {
	rx: parseFloat(params.width) / 2,
	height: parseFloat(params.height) / 2,
	cx: parseFloat(params.x) + offset_x,
	cy: parseFloat(params.y) + offset_y,
	stroke: stroke_color.rgb,
	'stroke-opacity': stroke_color.opacity,
	'stroke-width': params['stroke-width'],
	fill: fill_color.rgb,
	'fill-opacity': fill_color.opacity
    });
};

var lineToSVG = function (params, offset_x, offset_y) {
    var stroke_color = extractColor(params.stroke);
    return makeSVGElement('line', {
	x1: parseFloat(params.x1) + offset_x,
	y1: parseFloat(params.y1) + offset_y,
	x2: parseFloat(params.x2) + offset_x,
	y2: parseFloat(params.y2) + offset_y,
	stroke: stroke_color.rgb,
	'stroke-opacity': stroke_color.opacity,
	'stroke-width': params['stroke-width'],
    });
};

module.exports = function(oncoprint_shape_computed_params, offset_x, offset_y) {
    var type = oncoprint_shape_computed_params.type;
    if (type === 'rectangle') {
	return rectangleToSVG(oncoprint_shape_computed_params, offset_x, offset_y);
    } else if (type === 'triangle') {
	return triangleToSVG(oncoprint_shape_computed_params, offset_x, offset_y);
    } else if (type === 'ellipse') {
	return ellipseToSVG(oncoprint_shape_computed_params, offset_x, offset_y);
    } else if (type === 'line') {
	return lineToSVG(oncoprint_shape_computed_params, offset_x, offset_y);
    }
};
},{"./extractrgba.js":3}],25:[function(require,module,exports){
var halfsqrt2 = Math.sqrt(2) / 2;

var extractRGBA = function (str) {
    var ret = [0, 0, 0, 1];
    if (str[0] === "#") {
	// hex, convert to rgba
	var r = parseInt(str[1] + str[2], 16);
	var g = parseInt(str[3] + str[4], 16);
	var b = parseInt(str[5] + str[6], 16);
	str = 'rgba('+r+','+g+','+b+',1)';
    }
    var match = str.match(/^[\s]*rgba\([\s]*([0-9]+)[\s]*,[\s]*([0-9]+)[\s]*,[\s]*([0-9]+)[\s]*,[\s]*([0-9.]+)[\s]*\)[\s]*$/);
    if (match && match.length === 5) {
	ret = [parseFloat(match[1]) / 255,
	    parseFloat(match[2]) / 255,
	    parseFloat(match[3]) / 255,
	    parseFloat(match[4])];
    }
    return ret;
};

var addVertexColor = function (vertex_color_array, rgba_str, n_times) {
    var color = extractRGBA(rgba_str);
    for (var h = 0; h < n_times; h++) {
	vertex_color_array.push(color[0], color[1], color[2], color[3]);
    }
};
    
var rectangleToVertexes = function(params, z_index, target_position_array, target_color_array) {
    // Stroke
    var x = parseFloat(params.x), y = parseFloat(params.y), height = parseFloat(params.height), width = parseFloat(params.width);
    var stroke_width = parseFloat(params['stroke-width']);

    target_position_array.push(x, y, z_index);
    target_position_array.push(x + width, y, z_index);
    target_position_array.push(x + width, y + height, z_index);

    target_position_array.push(x, y, z_index);
    target_position_array.push(x + width, y + height, z_index);
    target_position_array.push(x, y + height, z_index);

    addVertexColor(target_color_array, params.fill, 6);

    if (stroke_width > 0) {
	// left side
	target_position_array.push(x, y, z_index);
	target_position_array.push(x + stroke_width, y, z_index);
	target_position_array.push(x + stroke_width, y + height, z_index);

	target_position_array.push(x, y, z_index);
	target_position_array.push(x + stroke_width, y + height, z_index);
	target_position_array.push(x, y + height, z_index);

	// right side
	target_position_array.push(x + width, y, z_index);
	target_position_array.push(x + width - stroke_width, y, z_index);
	target_position_array.push(x + width - stroke_width, y + height, z_index);

	target_position_array.push(x + width, y, z_index);
	target_position_array.push(x + width - stroke_width, y + height, z_index);
	target_position_array.push(x + width, y + height, z_index);

	// top side
	target_position_array.push(x, y, z_index);
	target_position_array.push(x + width, y, z_index);
	target_position_array.push(x + width, y + stroke_width, z_index);

	target_position_array.push(x, y, z_index);
	target_position_array.push(x + width, y + stroke_width, z_index);
	target_position_array.push(x, y + stroke_width, z_index);

	// bottom side
	target_position_array.push(x, y + height, z_index);
	target_position_array.push(x + width, y + height, z_index);
	target_position_array.push(x + width, y + height - stroke_width, z_index);

	target_position_array.push(x, y + height, z_index);
	target_position_array.push(x + width, y + height - stroke_width, z_index);
	target_position_array.push(x, y + height - stroke_width, z_index);

	addVertexColor(target_color_array, params.stroke, 6 * 4);
    }
};
var triangleToVertexes = function(params, z_index, target_position_array, target_color_array) {
    target_position_array.push(parseFloat(params.x1), parseFloat(params.y1), z_index);
    target_position_array.push(parseFloat(params.x2), parseFloat(params.y2), z_index);
    target_position_array.push(parseFloat(params.x3), parseFloat(params.y3), z_index);

    addVertexColor(target_color_array, params.fill, 3);
};
var ellipseToVertexes = function(params, z_index, target_position_array, target_color_array) {
    var center = {x: parseFloat(params.x) + parseFloat(params.width) / 2, y: parseFloat(params.y) + parseFloat(params.height) / 2};
    var horzrad = parseFloat(params.width) / 2;
    var vertrad = parseFloat(params.height) / 2;

    target_position_array.push(center.x, center.y, z_index);
    target_position_array.push(center.x + horzrad, center.y, z_index);
    target_position_array.push(center.x + halfsqrt2 * horzrad, center.y + halfsqrt2 * vertrad, z_index);

    target_position_array.push(center.x, center.y, z_index);
    target_position_array.push(center.x + halfsqrt2 * horzrad, center.y + halfsqrt2 * vertrad, z_index);
    target_position_array.push(center.x, center.y + vertrad, z_index);

    target_position_array.push(center.x, center.y, z_index);
    target_position_array.push(center.x, center.y + vertrad, z_index);
    target_position_array.push(center.x - halfsqrt2 * horzrad, center.y + halfsqrt2 * vertrad, z_index);

    target_position_array.push(center.x, center.y, z_index);
    target_position_array.push(center.x - halfsqrt2 * horzrad, center.y + halfsqrt2 * vertrad, z_index);
    target_position_array.push(center.x - horzrad, center.y, z_index);

    target_position_array.push(center.x, center.y, z_index);
    target_position_array.push(center.x - horzrad, center.y, z_index);
    target_position_array.push(center.x - halfsqrt2 * horzrad, center.y - halfsqrt2 * vertrad, z_index);

    target_position_array.push(center.x, center.y, z_index);
    target_position_array.push(center.x - halfsqrt2 * horzrad, center.y - halfsqrt2 * vertrad, z_index);
    target_position_array.push(center.x, center.y - vertrad, z_index);

    target_position_array.push(center.x, center.y, z_index);
    target_position_array.push(center.x, center.y - vertrad, z_index);
    target_position_array.push(center.x + halfsqrt2 * horzrad, center.y - halfsqrt2 * vertrad, z_index);

    target_position_array.push(center.x, center.y, z_index);
    target_position_array.push(center.x + halfsqrt2 * horzrad, center.y - halfsqrt2 * vertrad, z_index);
    target_position_array.push(center.x + horzrad, center.y, z_index);

    addVertexColor(target_color_array, params.fill, 3 * 8);
};
var lineToVertexes = function(params, z_index, target_position_array, target_color_array) {
    // For simplicity of dealing with webGL we'll implement lines as thin triangle pairs
    var x1 = parseFloat(params.x1);
    var x2 = parseFloat(params.x2);
    var y1 = parseFloat(params.y1);
    var y2 = parseFloat(params.y2);

    if (x1 !== x2) {
	// WLOG make x1,y1 the one on the left
	if (Math.min(x1, x2) === x2) {
	    var tmpx1 = x1;
	    var tmpy1 = y1;
	    x1 = x2;
	    y1 = y2;
	    x2 = tmpx1;
	    y2 = tmpy1;
	}
    }

    var perpendicular_vector = [y2 - y1, x1 - x2];
    var perpendicular_vector_length = Math.sqrt(perpendicular_vector[0] * perpendicular_vector[0] + perpendicular_vector[1] * perpendicular_vector[1]);
    var unit_perp_vector = [perpendicular_vector[0] / perpendicular_vector_length, perpendicular_vector[1] / perpendicular_vector_length];

    var half_stroke_width = parseFloat(params['stroke-width']) / 2;
    var direction1 = [unit_perp_vector[0] * half_stroke_width, unit_perp_vector[1] * half_stroke_width];
    var direction2 = [direction1[0] * -1, direction1[1] * -1];
    var A = [x1 + direction1[0], y1 + direction1[1]];
    var B = [x1 + direction2[0], y1 + direction2[1]];
    var C = [x2 + direction1[0], y2 + direction1[1]];
    var D = [x2 + direction2[0], y2 + direction2[1]];

    target_position_array.push(A[0], A[1], z_index);
    target_position_array.push(B[0], B[1], z_index);
    target_position_array.push(C[0], C[1], z_index);

    target_position_array.push(C[0], C[1], z_index);
    target_position_array.push(D[0], D[1], z_index);
    target_position_array.push(B[0], B[1], z_index);

    addVertexColor(target_color_array, params.stroke, 3 * 2);
};
module.exports = function(oncoprint_shape_computed_params, z_index, target_position_array, target_color_array) {
    // target_position_array is an array with 3-d float vertexes
    // target_color_array is an array with rgba values in [0,1]
    // We pass them in to save on concatenation costs
    
    var type = oncoprint_shape_computed_params.type;
    if (type === "rectangle") {
	return rectangleToVertexes(oncoprint_shape_computed_params, z_index, target_position_array, target_color_array);
    } else if (type === "triangle") {
	return triangleToVertexes(oncoprint_shape_computed_params, z_index, target_position_array, target_color_array);
    } else if (type === "ellipse") {
	return ellipseToVertexes(oncoprint_shape_computed_params, z_index, target_position_array, target_color_array);
    } else if (type === "line") {
	return lineToVertexes(oncoprint_shape_computed_params, z_index, target_position_array, target_color_array);
    }
}
},{}],26:[function(require,module,exports){
var OncoprintToolTip = (function() {
    function OncoprintToolTip($container, params) {
	params = params || {};
	this.$container = $container;
	this.$div = $('<div></div>').appendTo($container).css({'background-color':'rgba(255,255,255,1)', 'position':'absolute', 'display':'none', 'border':'1px solid black', 'max-width':300, 'min-width':150});
	if (params.noselect) {
	    this.$div.addClass("noselect");
	}
	this.hide_timeout_id = undefined;
	this.show_timeout_id = undefined;
	this.center = false;
	
	this.shown = false;
	
	var self = this;
	this.$div.on("mousemove", function(evt) {
	    evt.stopPropagation();
	    cancelScheduledHide(self);
	});
	this.$div.on("mouseleave", function(evt) {
	    evt.stopPropagation();
	    self.hide();
	});
    }
    OncoprintToolTip.prototype.show = function(wait, page_x, page_y, $contents, fade) {
	cancelScheduledHide(this);
	
	if (typeof wait !== 'undefined' && !this.shown) {
	    var self = this;
	    cancelScheduledShow(this);
	    this.show_timeout_id = setTimeout(function() {
		doShow(self, page_x, page_y, $contents, fade);
	    }, wait);
	} else {
	    doShow(this, page_x, page_y, $contents, fade);
	}
    }
    var doShow = function(tt, page_x, page_y, $contents, fade) {
	cancelScheduledShow(tt);
	tt.show_timeout_id = undefined;
	tt.$div.empty();
	tt.$div.append($contents);
	if (!fade) {
	    tt.$div.show();
	} else {
	    tt.$div.stop().fadeIn('fast');
	}
	var container_offset = tt.$container.offset();
	var x = page_x - container_offset.left - (tt.center ? tt.$div.width()/2 : 0);
	var y = page_y - container_offset.top - tt.$div.height();
	tt.$div.css({'top':y, 'left':x, 'z-index':9999});
	tt.shown = true;
    };
    var doHide = function(tt, fade) {
	cancelScheduledHide(tt);
	tt.hide_timeout_id = undefined;
	if (!fade) {
	    tt.$div.hide();
	} else {
	    tt.$div.fadeOut();
	}
	tt.shown = false;
    };
    var cancelScheduledShow = function(tt) {
	clearTimeout(tt.show_timeout_id);
	tt.show_timeout_id = undefined;
    };
    var cancelScheduledHide = function(tt) {
	clearTimeout(tt.hide_timeout_id);
	tt.hide_timeout_id = undefined;
    };
    OncoprintToolTip.prototype.showIfNotAlreadyGoingTo = function(wait, page_x, page_y, $contents) {
	if (typeof this.show_timeout_id === 'undefined') {
	    this.show(wait, page_x, page_y, $contents);
	}
    }
    OncoprintToolTip.prototype.hideIfNotAlreadyGoingTo = function(wait) {
	if (typeof this.hide_timeout_id === 'undefined') {
	    this.hide(wait);
	}
    };
    OncoprintToolTip.prototype.hide = function(wait) {
	cancelScheduledShow(this);
	
	if (!this.shown) {
	    return;
	}
	
	if (typeof wait !== 'undefined') {
	    var self = this;
	    cancelScheduledHide(this);
	    this.hide_timeout_id = setTimeout(function() {
		doHide(self);
	    }, wait);
	} else {
	    doHide(this);
	}
    }
    OncoprintToolTip.prototype.fadeIn = function(wait, page_x, page_y, $contents) {
	this.show(wait, page_x, page_y, $contents, true);
    }
    return OncoprintToolTip;
})();

module.exports = OncoprintToolTip;
},{}],27:[function(require,module,exports){
var svgfactory = require('./svgfactory.js');

var OncoprintTrackInfoView = (function () {
    function OncoprintTrackInfoView($div) {
	this.$div = $div;
	this.$ctr = $('<div></div>').css({'position': 'absolute', 'overflow-y':'hidden', 'overflow-x':'hidden'}).appendTo(this.$div);
	this.$text_ctr = $('<div></div>').css({'position':'absolute'}).appendTo(this.$ctr);
	this.base_font_size = 12;
	this.font_family = 'Arial';
	this.font_weight = 'bold';
	this.width = 0;

	this.rendering_suppressed = false;
    }

    var renderAllInfo = function (view, model) {
	if (view.rendering_suppressed) {
	    return;
	}
	view.$text_ctr.empty();

	var tracks = model.getTracks();
	view.minimum_track_height = Number.POSITIVE_INFINITY;
	for (var i = 0; i < tracks.length; i++) {
	    view.minimum_track_height = Math.min(view.minimum_track_height, model.getTrackHeight(tracks[i]));
	}

	view.width = 40;

	var label_tops = model.getLabelTops();
	scroll(view, model.getVertScroll());
	var font_size = view.getFontSize();
	for (var i = 0; i < tracks.length; i++) {
	    var $new_label = $('<span>').css({'position': 'absolute',
		'font-family': view.font_family,
		'font-weight': view.font_weight,
		'font-size': font_size})
		    .addClass('noselect');
	    $new_label.text(model.getTrackInfo(tracks[i]));
	    $new_label.appendTo(view.$text_ctr);
	    var top = label_tops[tracks[i]] + (model.getCellHeight(tracks[i]) - $new_label.outerHeight()) / 2;
	    $new_label.css({'top': top + 'px'});
	    view.width = Math.max(view.width, $new_label[0].clientWidth);
	}
    };
    var scroll = function (view, scroll_y) {
	if (view.rendering_suppressed) {
	    return;
	}
	view.$text_ctr.css({'top': -scroll_y});
    };

    var resize = function (view, model) {
	if (view.rendering_suppressed) {
	    return;
	}
	view.$div.css({'width': view.getWidth(), 'height': model.getCellViewHeight()});
	view.$ctr.css({'width': view.getWidth(), 'height': model.getCellViewHeight()});
    };

    OncoprintTrackInfoView.prototype.getFontSize = function () {
	return Math.max(Math.min(this.base_font_size, this.minimum_track_height), 7);
    }
    OncoprintTrackInfoView.prototype.getWidth = function () {
	return this.width + 10;
    }
    OncoprintTrackInfoView.prototype.addTracks = function (model) {
	renderAllInfo(this, model);
	resize(this, model);
    }
    OncoprintTrackInfoView.prototype.moveTrack = function (model) {
	renderAllInfo(this, model);
	resize(this, model);
    }
    OncoprintTrackInfoView.prototype.setTrackGroupOrder = function(model) {
	renderAllInfo(this, model);
	resize(this, model);
    }
    OncoprintTrackInfoView.prototype.removeTrack = function (model) {
	renderAllInfo(this, model);
	resize(this, model);
    }
    OncoprintTrackInfoView.prototype.setTrackInfo = function (model) {
	renderAllInfo(this, model);
	resize(this, model);
    }
    OncoprintTrackInfoView.prototype.setScroll = function(model) {
	this.setVertScroll(model);
    }
    OncoprintTrackInfoView.prototype.setHorzScroll = function (model) {
    }
    OncoprintTrackInfoView.prototype.setVertScroll = function (model) {
	scroll(this, model.getVertScroll());
    }
    OncoprintTrackInfoView.prototype.setZoom = function(model) {
	this.setVertZoom(model);
    }
    
    OncoprintTrackInfoView.prototype.setViewport = function(model) {
	renderAllInfo(this, model);
	resize(this, model);
	scroll(this, model.getVertScroll());
    }
    OncoprintTrackInfoView.prototype.setVertZoom = function (model) {
	renderAllInfo(this, model);
	resize(this, model);
    }
    OncoprintTrackInfoView.prototype.suppressRendering = function () {
	this.rendering_suppressed = true;
    }
    OncoprintTrackInfoView.prototype.releaseRendering = function (model) {
	this.rendering_suppressed = false;
	renderAllInfo(this, model);
	resize(this, model);
	scroll(this, model.getVertScroll());
    }
    OncoprintTrackInfoView.prototype.toSVGGroup = function (model, offset_x, offset_y) {
	var root = svgfactory.group((offset_x || 0), (offset_y || 0));
	var cell_tops = model.getCellTops();
	var tracks = model.getTracks();
	for (var i = 0; i < tracks.length; i++) {
	    var track_id = tracks[i];
	    var y = cell_tops[track_id] + model.getCellHeight(track_id) / 2;
	    var info = model.getTrackInfo(track_id);
	    var text_elt = svgfactory.text(info, 0, y, this.font_size, this.font_family, this.font_weight, "bottom");
	    text_elt.setAttribute("dy", "0.35em");
	    root.appendChild(text_elt);
	}
	return root;
    }
    return OncoprintTrackInfoView;
})();

module.exports = OncoprintTrackInfoView;
},{"./svgfactory.js":31}],28:[function(require,module,exports){
var OncoprintTrackOptionsView = (function () {
    function OncoprintTrackOptionsView($div, moveUpCallback, moveDownCallback, removeCallback, sortChangeCallback, unexpandCallback) {
	// removeCallback: function(track_id)
	var position = $div.css('position');
	if (position !== 'absolute' && position !== 'relative') {
	    console.log("WARNING: div passed to OncoprintTrackOptionsView must be absolute or relative positioned - layout problems will occur");
	}

	this.moveUpCallback = moveUpCallback;
	this.moveDownCallback = moveDownCallback;
	this.removeCallback = removeCallback; // function(track_id) { ... }
	this.sortChangeCallback = sortChangeCallback; // function(track_id, dir) { ... }
	this.unexpandCallback = unexpandCallback; // function(track_id)

	this.$div = $div;
	this.$ctr = $('<div></div>').css({'position': 'absolute', 'overflow-y':'hidden', 'overflow-x':'hidden'}).appendTo(this.$div);
	this.$buttons_ctr = $('<div></div>').css({'position':'absolute'}).appendTo(this.$ctr);
	this.$dropdown_ctr = $('<div></div>').css({'position': 'absolute'}).appendTo(this.$div);

	this.img_size = null;

	this.rendering_suppressed = false;

	this.track_options_$elts = {};

	this.menu_shown = {};

	var self = this;
	$(document).click(function() {
	    $(self).trigger('oncoprint-track-options-view.click-out');
	});

	this.interaction_disabled = false;
    }
    
    var renderAllOptions = function(view, model) {
	if (view.rendering_suppressed) {
	    return;
	}
	$(view).off('oncoprint-track-options-view.click-out');
	$(view).on('oncoprint-track-options-view.click-out', function() {
	     for (var track_id in view.track_options_$elts) {
		if (view.track_options_$elts.hasOwnProperty(track_id)) {
		    hideTrackMenu(view, track_id);
		}
	    }
	});
	
	view.$buttons_ctr.empty();
	view.$dropdown_ctr.empty();
	scroll(view, model.getVertScroll());

	var tracks = model.getTracks();
	var minimum_track_height = Number.POSITIVE_INFINITY;
	for (var i = 0; i < tracks.length; i++) {
	    minimum_track_height = Math.min(minimum_track_height, model.getTrackHeight(tracks[i]));
	}
	view.img_size = Math.floor(minimum_track_height * 0.75);

	for (var i = 0; i < tracks.length; i++) {
	    renderTrackOptions(view, model, tracks[i]);
	}
    };

    var scroll = function (view, scroll_y) {
	if (view.rendering_suppressed) {
	    return;
	}
	view.$buttons_ctr.css({'top': -scroll_y});
	view.$dropdown_ctr.css({'top': -scroll_y});
    };

    var resize = function (view, model) {
	if (view.rendering_suppressed) {
	    return;
	}
	view.$div.css({'width': view.getWidth(), 'height': model.getCellViewHeight()});
	view.$ctr.css({'width': view.getWidth(), 'height': model.getCellViewHeight()});
    };

    var hideTrackMenu = function (view, track_id) {
	view.menu_shown[track_id] = false;
	var $elts = view.track_options_$elts[track_id];
	$elts.$dropdown.css({'z-index': 1});
	$elts.$dropdown.css({'border': '1px solid rgba(125,125,125,0)'});
	$elts.$img.css({'border': '1px solid rgba(125,125,125,0)'});
	$elts.$dropdown.fadeOut(100);
    };

    var showTrackMenu = function (view, track_id) {
	view.menu_shown[track_id] = true;
	var $elts = view.track_options_$elts[track_id];
	$elts.$dropdown.css({'z-index': 10});
	$elts.$dropdown.css({'border': '1px solid rgba(125,125,125,1)'});
	$elts.$img.css({'border': '1px solid rgba(125,125,125,1)'});
	$elts.$dropdown.fadeIn(100);
    };

    var hideMenusExcept = function (view, track_id) {
	track_id = track_id.toString();
	for (var other_track_id in view.track_options_$elts) {
	    if (view.track_options_$elts.hasOwnProperty(other_track_id)) {
		if (other_track_id === track_id) {
		    continue;
		}
		hideTrackMenu(view, other_track_id);
	    }
	}
    };

    var $makeDropdownOption = function (text, weight, callback) {
	return $('<li>').text(text).css({'font-weight': weight, 'font-size': 12, 'cursor': 'pointer', 'border-bottom': '1px solid rgba(0,0,0,0.3)'})
		.click(callback)
		.hover(function () {
		    $(this).css({'background-color': 'rgb(200,200,200)'});
		}, function () {
		    $(this).css({'background-color': 'rgba(255,255,255,0)'});
		});
    };
    var $makeDropdownSeparator = function () {
	return $('<li>').css({'border-top': '1px solid black'});
    };

    var renderTrackOptions = function (view, model, track_id) {
	var $div, $img, $dropdown;
	var top = model.getZoomedTrackTops(track_id);
	$div = $('<div>').appendTo(view.$buttons_ctr).css({'position': 'absolute', 'left': '0px', 'top': top + 'px'});
	$img = $('<img/>').appendTo($div).attr({'src': 'images/menudots.svg', 'width': view.img_size, 'height': view.img_size}).css({'float': 'left', 'cursor': 'pointer', 'border': '1px solid rgba(125,125,125,0)'});
	$dropdown = $('<ul>').appendTo(view.$dropdown_ctr).css({'position':'absolute', 'width': 120, 'display': 'none', 'list-style-type': 'none', 'padding-left': '6', 'padding-right': '6', 'float': 'right', 'background-color': 'rgb(255,255,255)',
								'left':'0px', 'top': top + view.img_size + 'px'});
	view.track_options_$elts[track_id] = {'$div': $div, '$img': $img, '$dropdown': $dropdown};

	$img.hover(function (evt) {
	    if (!view.menu_shown[track_id]) {
		$(this).css({'border': '1px solid rgba(125,125,125,0.3)'});
	    }
	}, function (evt) {
	    if (!view.menu_shown[track_id]) {
		$(this).css({'border': '1px solid rgba(125,125,125,0)'});
	    }
	});
	$img.click(function (evt) {
	    evt.stopPropagation();
	    if ($dropdown.is(":visible")) {
		hideTrackMenu(view, track_id);
	    } else {
		showTrackMenu(view, track_id);
	    }
	    hideMenusExcept(view, track_id);
	});

	$dropdown.append($makeDropdownOption('Move up', 'normal', function (evt) {
	    evt.stopPropagation();
	    view.moveUpCallback(track_id);
	}));
	$dropdown.append($makeDropdownOption('Move down', 'normal', function (evt) {
	    evt.stopPropagation();
	    view.moveDownCallback(track_id);
	}));
	if (model.isTrackRemovable(track_id)) {
	    $dropdown.append($makeDropdownOption('Remove track', 'normal', function (evt) {
		evt.stopPropagation();
		view.removeCallback(track_id);
	    }));
	}
	if (model.isTrackSortDirectionChangeable(track_id)) {
	    $dropdown.append($makeDropdownSeparator());
	    var $sort_inc_li;
	    var $sort_dec_li;
	    var $dont_sort_li;
	    $sort_inc_li = $makeDropdownOption('Sort a-Z', (model.getTrackSortDirection(track_id) === 1 ? 'bold' : 'normal'), function (evt) {
		evt.stopPropagation();
		$sort_inc_li.css('font-weight', 'bold');
		$sort_dec_li.css('font-weight', 'normal');
		$dont_sort_li.css('font-weight', 'normal');
		view.sortChangeCallback(track_id, 1);
	    });
	    $sort_dec_li = $makeDropdownOption('Sort Z-a', (model.getTrackSortDirection(track_id) === -1 ? 'bold' : 'normal'), function (evt) {
		evt.stopPropagation();
		$sort_inc_li.css('font-weight', 'normal');
		$sort_dec_li.css('font-weight', 'bold');
		$dont_sort_li.css('font-weight', 'normal');
		view.sortChangeCallback(track_id, -1);
	    });
	    $dont_sort_li = $makeDropdownOption('Don\'t sort track', (model.getTrackSortDirection(track_id) === 0 ? 'bold' : 'normal'), function (evt) {
		evt.stopPropagation();
		$sort_inc_li.css('font-weight', 'normal');
		$sort_dec_li.css('font-weight', 'normal');
		$dont_sort_li.css('font-weight', 'bold');
		view.sortChangeCallback(track_id, 0);
	    });
	    $dropdown.append($sort_inc_li);
	    $dropdown.append($sort_dec_li);
	    $dropdown.append($dont_sort_li);
	}
	if (model.isTrackExpandable(track_id)) {
	    $dropdown.append($makeDropdownOption(
		    (model.isTrackExpanded(track_id) ? 'More' : 'Show') + ' genes',
		    'normal',
		    function (evt) {
			evt.stopPropagation();
			if (!model.isTrackExpanded(track_id)) {
			    model.initExpansion(track_id);
			}
			model.expandTrack(track_id);
		    }));
	}
	if (model.isTrackExpanded(track_id)) {
	    $dropdown.append($makeDropdownOption(
		    'Hide genes',
		    'normal',
		    function (evt) {
			evt.stopPropagation();
			view.unexpandCallback(track_id);
		    }));
	}
    };

    OncoprintTrackOptionsView.prototype.enableInteraction = function () {
	this.interaction_disabled = false;
    }
    OncoprintTrackOptionsView.prototype.disableInteraction = function () {
	this.interaction_disabled = true;
    }
    OncoprintTrackOptionsView.prototype.suppressRendering = function () {
	this.rendering_suppressed = true;
    }
    OncoprintTrackOptionsView.prototype.releaseRendering = function (model) {
	this.rendering_suppressed = false;
	renderAllOptions(this, model);
	resize(this, model);
	scroll(this, model.getVertScroll());
    }
    OncoprintTrackOptionsView.prototype.setScroll = function(model) {
	this.setVertScroll(model);
    }
    OncoprintTrackOptionsView.prototype.setHorzScroll = function (model) {
    }
    OncoprintTrackOptionsView.prototype.setVertScroll = function (model) {
	scroll(this, model.getVertScroll());
    }
    OncoprintTrackOptionsView.prototype.setZoom = function(model) {
	this.setVertZoom(model);
    }
    OncoprintTrackOptionsView.prototype.setVertZoom = function (model) {
	renderAllOptions(this, model);
	resize(this, model);
    }
    OncoprintTrackOptionsView.prototype.setViewport = function(model) {
	renderAllOptions(this, model);
	resize(this, model);
	scroll(this, model.getVertScroll());
    }
    OncoprintTrackOptionsView.prototype.getWidth = function () {
	return 10 + this.img_size;
    }
    OncoprintTrackOptionsView.prototype.addTracks = function (model) {
	renderAllOptions(this, model);
	resize(this, model);
    }
    OncoprintTrackOptionsView.prototype.moveTrack = function (model) {
	renderAllOptions(this, model);
	resize(this, model);
    }
    OncoprintTrackOptionsView.prototype.setTrackGroupOrder = function(model) {
	renderAllOptions(this, model);
    }
    OncoprintTrackOptionsView.prototype.removeTrack = function(model, track_id) {
	delete this.track_options_$elts[track_id];
	renderAllOptions(this, model);
	resize(this, model);
    }
    return OncoprintTrackOptionsView;
})();

module.exports = OncoprintTrackOptionsView;
},{}],29:[function(require,module,exports){
var gl_matrix = require('gl-matrix');
var svgfactory = require('./svgfactory.js');
var shapeToVertexes = require('./oncoprintshapetovertexes.js');
var CachedProperty = require('./CachedProperty.js');

// TODO: antialiasing

var sgndiff = function(a,b) {
    if (a < b) {
	return -1;
    } else if (a > b) {
	return 1;
    } else {
	return 0;
    }
};

var arrayFindIndex = function(arr, callback, start_index) {
    start_index = start_index || 0;
    for (var i=start_index; i<arr.length; i++) {
	if (callback(arr[i])) {
	    return i;
	}
    }
    return -1;
};

var getNewCanvas = function(view) {
    var old_canvas = view.$canvas[0];
    var new_canvas = old_canvas.cloneNode();
    var parent_node = old_canvas.parentNode;
    parent_node.removeChild(old_canvas);
    parent_node.insertBefore(new_canvas, view.$overlay_canvas[0]);
    view.$canvas = $(new_canvas);
};
var getWebGLCanvasContext = function (view) {
    try {
	var canvas = view.$canvas[0];
	var ctx = canvas.getContext("experimental-webgl", {alpha: false, antialias: view.antialias});
	ctx.clearColor(1.0, 1.0, 1.0, 1.0);
	ctx.clear(ctx.COLOR_BUFFER_BIT | ctx.DEPTH_BUFFER_BIT);
	ctx.viewportWidth = canvas.width;
	ctx.viewportHeight = canvas.height;
	ctx.viewport(0, 0, ctx.viewportWidth, ctx.viewportHeight);
	ctx.enable(ctx.DEPTH_TEST);
	ctx.enable(ctx.BLEND);
	ctx.blendEquation(ctx.FUNC_ADD);
	ctx.blendFunc(ctx.SRC_ALPHA, ctx.ONE_MINUS_SRC_ALPHA);
	ctx.depthMask(false);
	
	return ctx;
    } catch (e) {
	return null;
    }
};

var createShaderProgram = function (view, vertex_shader, fragment_shader) {
    var program = view.ctx.createProgram();
    view.ctx.attachShader(program, vertex_shader);
    view.ctx.attachShader(program, fragment_shader);

    view.ctx.linkProgram(program);

    var success = view.ctx.getProgramParameter(program, view.ctx.LINK_STATUS);
    if (!success) {
	var msg = view.ctx.getProgramInfoLog(program);
	view.ctx.deleteProgram(program);
	throw "Unable to link shader program: " + msg;
    }

    return program;
};
var createShader = function (view, source, type) {
    var shader = view.ctx.createShader(view.ctx[type]);
    view.ctx.shaderSource(shader, source);
    view.ctx.compileShader(shader);

    var success = view.ctx.getShaderParameter(shader, view.ctx.COMPILE_STATUS);
    if (!success) {
	var msg = view.ctx.getShaderInfoLog(shader);
	view.ctx.deleteShader(shader);
	throw "Unable to compile shader: " + msg;
    }

    return shader;
};

var OncoprintWebGLCellView = (function () {
    function OncoprintWebGLCellView($container, $canvas, $overlay_canvas, $dummy_scroll_div_contents, model, tooltip, highlight_area_callback, cell_over_callback) {
	this.$container = $container;
	this.$canvas = $canvas;
	this.$overlay_canvas = $overlay_canvas;
	
	this.supersampling_ratio = 2;
	
	this.antialias = true;
	this.antialias_on_cell_width_thresh = 5;
	
	getWebGLContextAndSetUpMatricesAndShaders(this);
	getOverlayContextAndClear(this);
	this.visible_area_width = $canvas[0].width;
	
	var self = this;
	
	this.tooltip = tooltip;
	this.tooltip.center = true;
	
	this.scroll_x = 0;
	this.scroll_y = 0;
	this.$dummy_scroll_div_contents = $dummy_scroll_div_contents;
	this.dummy_scroll_div_client_size = new CachedProperty({'width':$dummy_scroll_div_contents.parent()[0].clientWidth, 'height':$dummy_scroll_div_contents.parent()[0].clientHeight}, function() {
	    return {'width':$dummy_scroll_div_contents.parent()[0].clientWidth, 'height':$dummy_scroll_div_contents.parent()[0].clientHeight};
	});

	this.identified_shape_list_list = {};

	this.vertex_position_array = {}; // track_id -> vertex list (float list, item size 3)
	this.vertex_color_array = {}; // track_id -> color list (float list, item size 4)
	this.vertex_column_array = {}; // track_id -> number list (float list, item size 1)
	
	this.vertex_position_buffer = {}; // track_id -> gl.createBuffer()
	this.vertex_color_buffer = {}; // track_id -> gl.createBuffer()
	this.vertex_column_buffer = {}; // track_id -> gl.createBuffer()
	
	this.id_to_first_vertex_index = {}; // track_id -> id -> vertex index of first vertex corresponding to this id

	this.rendering_suppressed = false;
	
	this.highlight_area_callback = (typeof highlight_area_callback === 'undefined' ? function() {} : highlight_area_callback); // function(left, right) { ... }
	
	(function initializeOverlayEvents(self) {
	    var dragging = false;
	    var drag_diff_minimum = 10;
	    var drag_start_x;
	    var drag_end_x;
	    var prev_overlapping_cell = null;
	    
	    var dragIsValid = function(drag_start_x, drag_end_x) {
		return Math.abs(drag_start_x - drag_end_x) >= drag_diff_minimum;
	    };
	    var executeDrag = function() {
		if (!dragging) {
		    return;
		}
		dragging = false;
		
		if (!dragIsValid(drag_start_x, drag_end_x)) {
		    return;
		}
		var left = Math.min(drag_start_x, drag_end_x);
		var right = Math.max(drag_start_x, drag_end_x);
		self.highlight_area_callback(left+self.scroll_x, right+self.scroll_x);
	    };
	    
	    var mouseInOverlayCanvas = function(mouse_x, mouse_y) {
		var offset = self.$overlay_canvas.offset();
		var width = self.$overlay_canvas.width();
		var height = self.$overlay_canvas.height();
		return (mouse_x >= offset.left && mouse_x < width + offset.left && mouse_y >= offset.top && mouse_y < height + offset.top);
	    };
	    $(document).on("mousemove", function(evt) {
		if (!mouseInOverlayCanvas(evt.pageX, evt.pageY)) {
		    clearOverlay(self);
		    tooltip.hide();
		}
	    });
	    self.$overlay_canvas.on("mouseout mouseleave", function(evt) {
		clearOverlay(self);
		tooltip.hide();
	    });
	    self.$overlay_canvas.on("mousemove", function(evt) {
		if (self.rendering_suppressed) {
		    return;
		}
		clearOverlay(self);
		var offset = self.$overlay_canvas.offset();
		var mouseX = evt.pageX - offset.left;
		var mouseY = evt.pageY - offset.top;
		if (!dragging) {
		    var overlapping_cell = model.getOverlappingCell(mouseX + self.scroll_x, mouseY + self.scroll_y);
		    var overlapping_datum = (overlapping_cell === null ? null : model.getTrackDatum(overlapping_cell.track, overlapping_cell.id));
		    var cell_width = model.getCellWidth();
		    var cell_padding = model.getCellPadding();
		    if (overlapping_datum !== null) {
			cell_over_callback(overlapping_cell.track, overlapping_cell.id);
			var left = model.getZoomedColumnLeft(overlapping_cell.id) - self.scroll_x;
			overlayStrokeRect(self, left, model.getCellTops(overlapping_cell.track) - self.scroll_y, model.getCellWidth() + (model.getTrackHasColumnSpacing(overlapping_cell.track) ? 0 : cell_padding), model.getCellHeight(overlapping_cell.track), "rgba(0,0,0,1)");
			var tracks = model.getTracks();
			for (var i=0; i<tracks.length; i++) {
			    if (model.getTrackDatum(tracks[i], overlapping_cell.id) !== null) {
				overlayStrokeRect(self, left, model.getCellTops(tracks[i]) - self.scroll_y, model.getCellWidth() + (model.getTrackHasColumnSpacing(tracks[i]) ? 0 : cell_padding), model.getCellHeight(tracks[i]), "rgba(0,0,0,0.5)");
			    }
			}
			tooltip.show(250, model.getZoomedColumnLeft(overlapping_cell.id) + model.getCellWidth() / 2 + offset.left - self.scroll_x, model.getCellTops(overlapping_cell.track) + offset.top - self.scroll_y, model.getTrackTooltipFn(overlapping_cell.track)(overlapping_datum));
			prev_overlapping_cell = overlapping_cell;
		    } else {
			tooltip.hideIfNotAlreadyGoingTo(150);
			overlapping_cell = null;
		    }
		} else {
		    overlapping_cell = null;
		    drag_end_x = mouseX;
		    var left = Math.min(mouseX, drag_start_x);
		    var right = Math.max(mouseX, drag_start_x);
		    var drag_rect_fill = dragIsValid(drag_start_x, drag_end_x) ? 'rgba(0,0,0,0.3)' : 'rgba(0,0,0,0.2)';
		    overlayFillRect(self, left, 0, right-left, model.getCellViewHeight(), drag_rect_fill);
		}
		if (overlapping_cell === null) {
		    cell_over_callback(null);
		}
	    });
	    
	    self.$overlay_canvas.on("mousedown", function(evt) {
		if (!mouseInOverlayCanvas(evt.pageX, evt.pageY)) {
		    return;
		}
		dragging = true;
		drag_start_x = evt.pageX - self.$overlay_canvas.offset().left;
		drag_end_x = drag_start_x;
		
		tooltip.hide();
	    });
	    self.$overlay_canvas.on("mouseup", function(evt) {
		if (!mouseInOverlayCanvas(evt.pageX, evt.pageY)) {
		    return;
		}
		executeDrag();
	    });
	    self.$overlay_canvas.on("mouseleave", function(evt) {
		executeDrag();
	    });
	    
	})(this);
	
	$dummy_scroll_div_contents.parent().scroll(function() {
	    clearOverlay(self);
	});
    }
    
    var overlayStrokeRect = function(view, x, y, width, height, color) {
	var ctx = view.overlay_ctx;
	ctx.strokeStyle = color;
	ctx.strokeWidth = 10;
	ctx.strokeRect(view.supersampling_ratio*x, view.supersampling_ratio*y, view.supersampling_ratio*width, view.supersampling_ratio*height);
    };
    
    var overlayFillRect = function(view, x, y, width, height, color) {
	var ctx = view.overlay_ctx;
	ctx.fillStyle = color;
	ctx.fillRect(view.supersampling_ratio*x, view.supersampling_ratio*y, view.supersampling_ratio*width, view.supersampling_ratio*height);
    };
    
    var clearOverlay = function(view) {
	view.overlay_ctx.fillStyle = "rgba(0,0,0,0)";
	view.overlay_ctx.clearRect(0,0,view.$overlay_canvas[0].width, view.$overlay_canvas[0].height);
    };
    
    var getOverlayContextAndClear = function(view) {
	view.overlay_ctx = view.$overlay_canvas[0].getContext('2d');
	clearOverlay(view);
    };
    
    var getWebGLContextAndSetUpMatrices = function(view) {
	view.ctx = getWebGLCanvasContext(view);
	(function initializeMatrices(self) {
	    var mvMatrix = gl_matrix.mat4.create();
	    gl_matrix.mat4.lookAt(mvMatrix, [0, 0, 1], [0, 0, 0], [0, 1, 0]);
	    self.mvMatrix = mvMatrix;

	    var pMatrix = gl_matrix.mat4.create();
	    gl_matrix.mat4.ortho(pMatrix, 0, self.ctx.viewportWidth, self.ctx.viewportHeight, 0, -5, 1000); // y axis inverted so that y increases down like SVG
	    self.pMatrix = pMatrix;
	})(view);
    };
    var getWebGLContextAndSetUpMatricesAndShaders = function(view) {
	getWebGLContextAndSetUpMatrices(view);
	(function initializeShaders(self) {// Initialize shaders
	    var vertex_shader_source = ['attribute vec3 aVertexPosition;',
		'attribute vec4 aVertexColor;',
		'attribute float aVertexOncoprintColumn;',
		
		'uniform float columnWidth;',
		'uniform float scrollX;',
		'uniform float zoomX;',
		'uniform float scrollY;',
		'uniform float zoomY;',
		'uniform mat4 uMVMatrix;',
		'uniform mat4 uPMatrix;',
		'uniform float offsetY;',
		'uniform float supersamplingRatio;',
		'varying vec4 vColor;',
		'void main(void) {',
		'	gl_Position = vec4(aVertexPosition, 1.0);',
		'	gl_Position[0] += aVertexOncoprintColumn*columnWidth;',
		'	gl_Position *= vec4(zoomX, zoomY, 1.0, 1.0);',
		'	gl_Position[1] += offsetY;', // offset is given zoomed
		'	gl_Position -= vec4(scrollX, scrollY, 0.0, 0.0);',
		'	gl_Position[0] *= supersamplingRatio;',
		'	gl_Position[1] *= supersamplingRatio;',
		'	gl_Position = uPMatrix * uMVMatrix * gl_Position;',
		'	vColor = aVertexColor;',
		'}'].join('\n');
	    var fragment_shader_source = ['precision mediump float;',
		'varying vec4 vColor;',
		'',
		'void main(void) {',
		'   gl_FragColor = vColor;',
		'}'].join('\n');
	    var vertex_shader = createShader(self, vertex_shader_source, 'VERTEX_SHADER');
	    var fragment_shader = createShader(self, fragment_shader_source, 'FRAGMENT_SHADER');

	    var shader_program = createShaderProgram(self, vertex_shader, fragment_shader);
	    shader_program.vertexPositionAttribute = self.ctx.getAttribLocation(shader_program, 'aVertexPosition');
	    self.ctx.enableVertexAttribArray(shader_program.vertexPositionAttribute);
	    shader_program.vertexColorAttribute = self.ctx.getAttribLocation(shader_program, 'aVertexColor');
	    self.ctx.enableVertexAttribArray(shader_program.vertexColorAttribute);
	    shader_program.vertexOncoprintColumnAttribute = self.ctx.getAttribLocation(shader_program, 'aVertexOncoprintColumn');
	    self.ctx.enableVertexAttribArray(shader_program.vertexOncoprintColumnAttribute);

	    shader_program.pMatrixUniform = self.ctx.getUniformLocation(shader_program, 'uPMatrix');
	    shader_program.mvMatrixUniform = self.ctx.getUniformLocation(shader_program, 'uMVMatrix');
	    shader_program.columnWidthUniform = self.ctx.getUniformLocation(shader_program, 'columnWidth');
	    shader_program.scrollXUniform = self.ctx.getUniformLocation(shader_program, 'scrollX');
	    shader_program.scrollYUniform = self.ctx.getUniformLocation(shader_program, 'scrollY');
	    shader_program.zoomXUniform = self.ctx.getUniformLocation(shader_program, 'zoomX');
	    shader_program.zoomYUniform = self.ctx.getUniformLocation(shader_program, 'zoomY');
	    shader_program.offsetYUniform = self.ctx.getUniformLocation(shader_program, 'offsetY');
	    shader_program.supersamplingRatioUniform = self.ctx.getUniformLocation(shader_program, 'supersamplingRatio');

	    self.shader_program = shader_program;
	})(view);
    };

    var resizeAndClear = function(view, model) {
	var height = model.getCellViewHeight();
	var total_width = view.getTotalWidth(model);
	var visible_area_width = view.visible_area_width;
	var scrollbar_slack = 20;
	view.$dummy_scroll_div_contents.css({'min-width':total_width, 'min-height':model.getOncoprintHeight()});
	view.$dummy_scroll_div_contents.parent().css({'height': height + scrollbar_slack, 'width': visible_area_width + scrollbar_slack}); // add space for scrollbars
	view.dummy_scroll_div_client_size.update();
	view.$canvas[0].height = view.supersampling_ratio*height;
	view.$canvas[0].style.height = height + 'px';
	view.$overlay_canvas[0].height = view.supersampling_ratio*height;
	view.$overlay_canvas[0].style.height = height + 'px';
	view.$canvas[0].width = view.supersampling_ratio*visible_area_width;
	view.$canvas[0].style.width = visible_area_width + 'px';
	view.$overlay_canvas[0].width = view.supersampling_ratio*visible_area_width;
	view.$overlay_canvas[0].style.width = visible_area_width + 'px';
	view.$container.css('height', height);
	view.$container.css('width', visible_area_width);
	getWebGLContextAndSetUpMatrices(view);
	getOverlayContextAndClear(view);
    };
    var renderAllTracks = function (view, model, dont_resize) {
	if (view.rendering_suppressed) {
	    return;
	}
	
	var scroll_x = view.scroll_x;
	var scroll_y = view.scroll_y;
	var zoom_x = model.getHorzZoom();
	var zoom_y = model.getVertZoom();
	
	var viewport = view.getViewportOncoprintSpace(model);
	var window_left = viewport.left;
	var window_right = viewport.right;
	var window_top = viewport.top;
	var window_bottom = viewport.bottom;
	var id_to_left = model.getColumnLeft();
	var id_order = model.getIdOrder();
	var horz_first_id_in_window_index = arrayFindIndex(id_order, function(id) { return id_to_left[id] >= window_left; });
	var horz_first_id_after_window_index = arrayFindIndex(id_order, function(id) { return id_to_left[id] > window_right; }, horz_first_id_in_window_index+1);
	var horz_first_id_in_window = (horz_first_id_in_window_index < 1 ? id_order[0] : id_order[horz_first_id_in_window_index - 1]);
	var horz_first_id_after_window = (horz_first_id_after_window_index === -1 ? null : id_order[horz_first_id_after_window_index]);
	
	if (!dont_resize) {
	    resizeAndClear(view, model);
	}
	view.ctx.clearColor(1.0,1.0,1.0,1.0);
	view.ctx.clear(view.ctx.COLOR_BUFFER_BIT | view.ctx.DEPTH_BUFFER_BIT);
	
	var tracks = model.getTracks();
	for (var i = 0; i < tracks.length; i++) {
	    var track_id = tracks[i];
	    var cell_top = model.getCellTops(track_id);
	    var cell_height = model.getCellHeight(track_id);
	    if ((cell_top / zoom_y) >= window_bottom || ((cell_top + cell_height)/zoom_y) < window_top) {
		// vertical clipping
		continue;
	    }
	    var buffers = getTrackBuffers(view, track_id);
	    if (buffers.position.numItems === 0) {
		continue;
	    }
	    var first_index = view.id_to_first_vertex_index[track_id][horz_first_id_in_window];
	    var first_index_out = horz_first_id_after_window === null ? buffers.position.numItems : view.id_to_first_vertex_index[track_id][horz_first_id_after_window];
	    
	    view.ctx.useProgram(view.shader_program);
	    view.ctx.bindBuffer(view.ctx.ARRAY_BUFFER, buffers.position);
	    view.ctx.vertexAttribPointer(view.shader_program.vertexPositionAttribute, buffers.position.itemSize, view.ctx.FLOAT, false, 0, 0);

	    view.ctx.bindBuffer(view.ctx.ARRAY_BUFFER, buffers.color);
	    view.ctx.vertexAttribPointer(view.shader_program.vertexColorAttribute, buffers.color.itemSize, view.ctx.FLOAT, false, 0, 0);
	    
	    view.ctx.bindBuffer(view.ctx.ARRAY_BUFFER, buffers.column);
	    view.ctx.vertexAttribPointer(view.shader_program.vertexOncoprintColumnAttribute, buffers.column.itemSize, view.ctx.FLOAT, false, 0, 0);

	    view.ctx.uniformMatrix4fv(view.shader_program.pMatrixUniform, false, view.pMatrix);
	    view.ctx.uniformMatrix4fv(view.shader_program.mvMatrixUniform, false, view.mvMatrix);
	    view.ctx.uniform1f(view.shader_program.columnWidthUniform, model.getCellWidth(true) + model.getCellPadding(true));
	    view.ctx.uniform1f(view.shader_program.scrollXUniform, scroll_x);
	    view.ctx.uniform1f(view.shader_program.scrollYUniform, scroll_y);
	    view.ctx.uniform1f(view.shader_program.zoomXUniform, zoom_x);
	    view.ctx.uniform1f(view.shader_program.zoomYUniform, zoom_y);
	    view.ctx.uniform1f(view.shader_program.offsetYUniform, cell_top);
	    view.ctx.uniform1f(view.shader_program.supersamplingRatioUniform, view.supersampling_ratio);
	    
	    view.ctx.drawArrays(view.ctx.TRIANGLES, first_index, first_index_out - first_index);
	}
    };
    
    var clearTrackPositionAndColorBuffers = function(view, model, track_id) {
	var tracks_to_clear;
	if (typeof track_id === 'undefined') {
	    tracks_to_clear = model.getTracks();
	} else {
	    tracks_to_clear = [track_id];
	}
	for (var i=0; i<tracks_to_clear.length; i++) {
	    if (view.vertex_position_buffer[tracks_to_clear[i]]) {
		delete view.vertex_position_buffer[tracks_to_clear[i]];
	    }
	    if (view.vertex_color_buffer[tracks_to_clear[i]]) {
		delete view.vertex_color_buffer[tracks_to_clear[i]];
	    }
	}
    };
    
     var clearTrackColumnBuffers = function(view, model, track_id) {
	var tracks_to_clear;
	if (typeof track_id === 'undefined') {
	    tracks_to_clear = model.getTracks();
	} else {
	    tracks_to_clear = [track_id];
	}
	for (var i=0; i<tracks_to_clear.length; i++) {
	    if (view.vertex_column_buffer[tracks_to_clear[i]]) {
		delete view.vertex_column_buffer[tracks_to_clear[i]];
	    }
	}
    };
    
    
    var getTrackBuffers = function(view, track_id) {
	if (typeof view.vertex_position_buffer[track_id] === 'undefined') {
	    var vertex_position_buffer = view.ctx.createBuffer();
	    var vertex_color_buffer = view.ctx.createBuffer();
	    var vertex_position_array = view.vertex_position_array[track_id];
	    var vertex_color_array = view.vertex_color_array[track_id];
	    
	    view.ctx.bindBuffer(view.ctx.ARRAY_BUFFER, vertex_position_buffer);
	    view.ctx.bufferData(view.ctx.ARRAY_BUFFER, new Float32Array(vertex_position_array), view.ctx.STATIC_DRAW);
	    vertex_position_buffer.itemSize = 3;
	    vertex_position_buffer.numItems = vertex_position_array.length / vertex_position_buffer.itemSize;

	    view.ctx.bindBuffer(view.ctx.ARRAY_BUFFER, vertex_color_buffer);
	    view.ctx.bufferData(view.ctx.ARRAY_BUFFER, new Float32Array(vertex_color_array), view.ctx.STATIC_DRAW);
	    vertex_color_buffer.itemSize = 4;
	    vertex_color_buffer.numItems = vertex_color_array.length / vertex_color_buffer.itemSize;
	    
	    view.vertex_position_buffer[track_id] = vertex_position_buffer;
	    view.vertex_color_buffer[track_id] = vertex_color_buffer;
	}
	
	if (typeof view.vertex_column_buffer[track_id] === 'undefined') {
	    var vertex_column_buffer = view.ctx.createBuffer();
	    var vertex_column_array = view.vertex_column_array[track_id];
	    view.ctx.bindBuffer(view.ctx.ARRAY_BUFFER, vertex_column_buffer);
	    view.ctx.bufferData(view.ctx.ARRAY_BUFFER, new Float32Array(vertex_column_array), view.ctx.STATIC_DRAW);
	    vertex_column_buffer.itemSize = 1;
	    vertex_column_buffer.numItems = vertex_column_array.length / vertex_column_buffer.itemSize;
	    
	    view.vertex_column_buffer[track_id] = vertex_column_buffer;
	}
	return {'position':view.vertex_position_buffer[track_id],
		'color': view.vertex_color_buffer[track_id],
		'column': view.vertex_column_buffer[track_id]};
    };
    
    var computeVertexColumns = function(view, model, track_id) {
	if (view.rendering_suppressed) {
	    return;
	}
	var num_items = view.vertex_position_array[track_id].length / 3;
	var id_to_first_vertex_index = view.id_to_first_vertex_index[track_id];
	var id_to_index = model.getVisibleIdToIndexMap();
	var id_and_first_vertex = Object.keys(id_to_first_vertex_index).map(function(id) { return [id, id_to_first_vertex_index[id]]; })
				.sort(function(a,b) { return sgndiff(a[1], b[1]); });
	var vertex_column_array = [];
	for (var i=0; i<id_and_first_vertex.length; i++) {
	    var num_to_add = (i === id_and_first_vertex.length - 1 ? num_items : id_and_first_vertex[i+1][1]) - id_and_first_vertex[i][1];
	    var column = id_to_index[id_and_first_vertex[i][0]];
	    for (var j=0; j<num_to_add; j++) {
		vertex_column_array.push(column);
	    }
	}
	view.vertex_column_array[track_id] = vertex_column_array;
	clearTrackColumnBuffers(view, model, track_id);
    };
    
    var computeVertexPositionsAndVertexColors = function (view, model, track_id) {
	if (view.rendering_suppressed) {
	    return;
	}
	var identified_shape_list_list = view.identified_shape_list_list[track_id];
	var id_to_index = model.getIdToIndexMap();
	identified_shape_list_list.sort(function(a, b) {
	    return sgndiff(id_to_index[a.id], id_to_index[b.id]);
	});
	var halfsqrt2 = Math.sqrt(2) / 2;
	// Compute vertex and color arrays
	var vertex_position_array = [];
	var vertex_color_array = [];
	var id_to_first_vertex_index = {};
	
	for (var i = 0; i < identified_shape_list_list.length; i++) {
	    var shape_list = identified_shape_list_list[i].shape_list;
	    var id = identified_shape_list_list[i].id;

	    id_to_first_vertex_index[id] = vertex_position_array.length / 3;
	    
	    for (var j = 0; j < shape_list.length; j++) {
		var shape = shape_list[j];
		shapeToVertexes(shape, j, vertex_position_array, vertex_color_array);
	    }
	}
	view.vertex_position_array[track_id] = vertex_position_array;//track to vertex_position_array;
	view.vertex_color_array[track_id] = vertex_color_array;//track to vertex_color_array;
	view.id_to_first_vertex_index[track_id] = id_to_first_vertex_index;
	
	clearTrackPositionAndColorBuffers(view, model, track_id);
    };
    
    var getShapes = function(view, model, track_id) {
	if (view.rendering_suppressed) {
	    return;
	}
	view.identified_shape_list_list[track_id] = model.getIdentifiedShapeListList(track_id, true, true);
    };
    
    var refreshCanvas = function(view, model) {
	clearTrackPositionAndColorBuffers(view, model); // whenever you get a new context, you have to get new buffers
	clearTrackColumnBuffers(view, model);
	getNewCanvas(view);
	getWebGLContextAndSetUpMatricesAndShaders(view, model);
    };
    
    OncoprintWebGLCellView.prototype.getViewportOncoprintSpace = function(model) {
	var scroll_x = this.scroll_x;
	var scroll_y = this.scroll_y;
	var zoom_x = model.getHorzZoom();
	var zoom_y = model.getVertZoom();
	
	var window_left = Math.round(scroll_x / zoom_x);
	var window_right = Math.round((scroll_x + this.visible_area_width) / zoom_x);
	var window_top = Math.round(scroll_y / zoom_y);
	var window_bottom = Math.round((scroll_y + model.getCellViewHeight()) / zoom_y);
	
	return {
	    'top': window_top,
	    'bottom': window_bottom,
	    'left': window_left,
	    'right': window_right
	};
    }
    OncoprintWebGLCellView.prototype.isUsable = function () {
	return this.ctx !== null;
    }
    OncoprintWebGLCellView.prototype.removeTrack = function (model, track_id) {
	if (this.rendering_suppressed) {
	    return;
	};
	delete this.identified_shape_list_list[track_id];
	delete this.vertex_position_array[track_id];
	delete this.vertex_color_array[track_id];
	delete this.vertex_column_array[track_id];
	delete this.id_to_first_vertex_index[track_id];
	delete this.vertex_position_buffer[track_id];
	delete this.vertex_color_buffer[track_id];
	delete this.vertex_column_buffer[track_id];
	
	renderAllTracks(this, model);
    }
    OncoprintWebGLCellView.prototype.moveTrack = function (model) {
	if (this.rendering_suppressed) {
	    return;
	};
	renderAllTracks(this, model);
    }
    OncoprintWebGLCellView.prototype.setTrackGroupOrder = function(model) {
	renderAllTracks(this, model);
    }
    
    OncoprintWebGLCellView.prototype.addTracks = function (model, track_ids) {
	if (this.rendering_suppressed) {
	    return;
	};
	for (var i=0; i<track_ids.length; i++) {
	    getShapes(this, model, track_ids[i]);
	    computeVertexPositionsAndVertexColors(this, model, track_ids[i]);
	    computeVertexColumns(this, model, track_ids[i]);
	}
	renderAllTracks(this, model);
    }
    OncoprintWebGLCellView.prototype.setIdOrder = function(model, ids) {
	if (this.rendering_suppressed) {
	    return;
	};
	var track_ids = model.getTracks();
	for (var i=0; i<track_ids.length; i++) {
	    computeVertexColumns(this, model, track_ids[i]);
	}
	renderAllTracks(this, model);
    }
    OncoprintWebGLCellView.prototype.setTrackGroupSortPriority = function(model) {
	if (this.rendering_suppressed) {
	    return;
	};
	renderAllTracks(this, model);
    }
    OncoprintWebGLCellView.prototype.sort = function(model) {
	if (this.rendering_suppressed) {
	    return;
	};
	var track_ids = model.getTracks();
	for (var i=0; i<track_ids.length; i++) {
	    computeVertexPositionsAndVertexColors(this, model, track_ids[i]); // need to recompute because the vertexes are in sorted order for clipping
	    computeVertexColumns(this, model, track_ids[i]);
	}
	renderAllTracks(this, model);
    }
    OncoprintWebGLCellView.prototype.suppressRendering = function() {
	this.rendering_suppressed = true;
    }
    OncoprintWebGLCellView.prototype.releaseRendering = function(model) {
	this.rendering_suppressed = false;
	var track_ids = model.getTracks();
	for (var i=0; i<track_ids.length; i++) {
	    getShapes(this, model, track_ids[i]);
	    computeVertexPositionsAndVertexColors(this, model, track_ids[i]);
	    computeVertexColumns(this, model, track_ids[i]);
	}
	renderAllTracks(this, model);
    }
    OncoprintWebGLCellView.prototype.hideIds = function(model) {
	if (this.rendering_suppressed) {
	    return;
	};
	var track_ids = model.getTracks();
	for (var i=0; i<track_ids.length; i++) {
	    computeVertexColumns(this, model, track_ids[i]);
	}
	renderAllTracks(this, model);
    }
    OncoprintWebGLCellView.prototype.setTrackData = function(model, track_id) {
	if (this.rendering_suppressed) {
	    return;
	};
	getShapes(this, model, track_id);
	computeVertexPositionsAndVertexColors(this, model, track_id);
	computeVertexColumns(this, model, track_id);
	renderAllTracks(this, model);
    }
     OncoprintWebGLCellView.prototype.setRuleSet = function(model, target_track_id) {
	 if (this.rendering_suppressed) {
	    return;
	};
	getShapes(this, model, target_track_id);
	computeVertexPositionsAndVertexColors(this, model, target_track_id);
	renderAllTracks(this, model);
    }
    OncoprintWebGLCellView.prototype.shareRuleSet = function(model, target_track_id) {
	if (this.rendering_suppressed) {
	    return;
	};
	getShapes(this, model, target_track_id);
	computeVertexPositionsAndVertexColors(this, model, target_track_id);
	renderAllTracks(this, model);
    }
    OncoprintWebGLCellView.prototype.setSortConfig = function(model) {
	if (this.rendering_suppressed) {
	    return;
	};
	this.sort(model);
    }
    
    OncoprintWebGLCellView.prototype.setHorzScroll = function(model) {
	if (this.rendering_suppressed) {
	    return;
	};
	this.setScroll(model);
    }
    
    OncoprintWebGLCellView.prototype.setVertScroll = function(model) {
	if (this.rendering_suppressed) {
	    return;
	};
	this.setScroll(model);
    }
    
    OncoprintWebGLCellView.prototype.setScroll = function(model) {
	if (this.rendering_suppressed) {
	    return;
	};
	this.scroll_x = model.getHorzScroll();
	this.scroll_y = model.getVertScroll();
	renderAllTracks(this, model, true);
    }
    
    var updateAntialiasSetting = function(view, model) {
	var cell_width = model.getCellWidth();
	if (cell_width < view.antialias_on_cell_width_thresh) {
	    if (!view.antialias) {
		view.antialias = true;
		refreshCanvas(view, model);
	    }
	} else {
	    if (view.antialias) {
		view.antialias = false;
		refreshCanvas(view, model);
	    }
	}
    };
    
    OncoprintWebGLCellView.prototype.setZoom = function(model) {
	if (this.rendering_suppressed) {
	    return;
	};
	updateAntialiasSetting(this, model);
	renderAllTracks(this, model);
    }
    
    OncoprintWebGLCellView.prototype.setHorzZoom = function(model) {
	if (this.rendering_suppressed) {
	    return;
	};
	updateAntialiasSetting(this, model);
	renderAllTracks(this, model);
    }
    
    OncoprintWebGLCellView.prototype.setVertZoom = function(model) {
	if (this.rendering_suppressed) {
	    return;
	};
	renderAllTracks(this, model);
    }
    
    OncoprintWebGLCellView.prototype.setViewport = function(model) {
	if (this.rendering_suppressed) {
	    return;
	};
	this.scroll_x = model.getHorzScroll();
	this.scroll_y = model.getVertScroll();
	updateAntialiasSetting(this, model);
	renderAllTracks(this, model);
    }
    
    OncoprintWebGLCellView.prototype.getTotalWidth = function(model, base) {
	return (model.getCellWidth(base) + model.getCellPadding(base))*model.getIdOrder().length;
    }
    
    OncoprintWebGLCellView.prototype.getWidth = function() {
	return this.visible_area_width;
    }
    
    OncoprintWebGLCellView.prototype.setWidth = function(w, model) {
	this.visible_area_width = w;
	if (this.rendering_suppressed) {
	    return;
	};
	renderAllTracks(this, model); // in the process it will call resizeAndClear
    }
    
    OncoprintWebGLCellView.prototype.setCellPaddingOn = function(model) {
	if (this.rendering_suppressed) {
	    return;
	};
	var track_ids = model.getTracks();
	for (var i=0; i<track_ids.length; i++) {
	    if (!model.getTrackHasColumnSpacing(track_ids[i])) {
		// We need to recompute shapes for tracks that don't have column spacing,
		// because for those we're redefining the base width for shape generation.
		getShapes(this, model, track_ids[i]);
		computeVertexPositionsAndVertexColors(this, model, track_ids[i]);
	    }
	    computeVertexColumns(this, model, track_ids[i]);
	}
	renderAllTracks(this, model);
    }
    
    OncoprintWebGLCellView.prototype.getDummyScrollDivClientSize = function() {
	return this.dummy_scroll_div_client_size.get();
    }
    
    OncoprintWebGLCellView.prototype.toSVGGroup = function(model, offset_x, offset_y) {
	var root = svgfactory.group((offset_x || 0), (offset_y || 0));
	var cell_tops = model.getCellTops();
	var tracks = model.getTracks();
	var zoomedColumnLeft = model.getZoomedColumnLeft();
	for (var i=0; i<tracks.length; i++) {
	    var track_id = tracks[i];
	    var offset_y = cell_tops[track_id];
	    var identified_shape_list_list = model.getIdentifiedShapeListList(track_id, false, true);
	    for (var j=0; j<identified_shape_list_list.length; j++) {
		var id_sl = identified_shape_list_list[j];
		var id = id_sl.id;
		var sl = id_sl.shape_list;
		var offset_x = zoomedColumnLeft[id];
		if (typeof offset_x === 'undefined') {
		    // hidden id
		    continue;
		}
		for (var h=0; h<sl.length; h++) {
		    root.appendChild(svgfactory.fromShape(sl[h], offset_x, offset_y));
		}
	    }
	}
	return root;
    }
    return OncoprintWebGLCellView;
})();

module.exports = OncoprintWebGLCellView;

},{"./CachedProperty.js":1,"./oncoprintshapetovertexes.js":25,"./svgfactory.js":31,"gl-matrix":7}],30:[function(require,module,exports){
var OncoprintZoomSlider = (function() {
    var VERTICAL = "v";
    var HORIZONTAL = "h";
    
    var clamp = function(x) {
	return Math.max(Math.min(x, 1), 0);
    };
    
    var initialize = function(component, params) {
	var $ctr = component.$div;
	var icon_size = Math.round(params.btn_size * 0.7);
	var icon_padding = Math.round((params.btn_size - icon_size)/2);
	var $slider_bar = $('<div>').css({'position':'absolute',
					'background-color':'#ffffff',
					'outline': 'solid 1px black'}).appendTo($ctr);
	var $slider = $('<div>').css({'position':'absolute',
				    'background-color':'#ffffff',
				    'border': 'solid 1px black',
				    'border-radius': '3px',
				    'cursor': 'pointer'}).appendTo($ctr);
				
	var $plus_btn = $('<div>').css({'position':'absolute',
					    'min-height': params.btn_size,
					    'min-width': params.btn_size,
					    'background-color':'#ffffff',
					    'border': 'solid 1px black',
					    'border-radius': '3px',
					    'cursor': 'pointer'})
						.appendTo($ctr);
	$('<span>').addClass("icon fa fa-plus").css({'position':'absolute', 
							'top':icon_padding,
							'left':icon_padding,
							'min-width':icon_size,
							'min-height':icon_size})
						.appendTo($plus_btn);
	var $minus_btn = $('<div>').css({'position':'absolute',
					    'min-height': params.btn_size,
					    'min-width': params.btn_size,
					    'background-color':'#ffffff',
					    'border': 'solid 1px black',
					    'border-radius': '3px',
					    'cursor': 'pointer'})
						.appendTo($ctr);
	$('<span>').addClass("icon fa fa-minus").css({'position':'absolute', 
							'top':icon_padding,
							'left':icon_padding,
							'min-width':icon_size,
							'min-height':icon_size})
						.appendTo($minus_btn);
	if (params.vertical) {
	    $slider_bar.css({'min-height': params.height - 2 * params.btn_size,
		'min-width': Math.round(params.btn_size / 5)});
	    $slider.css({'min-height': Math.round(params.btn_size / 2),
		'min-width': params.btn_size});

	    $plus_btn.css({'top': 0, 'left': 0});
	    $minus_btn.css({'top': params.height - params.btn_size, 'left': 0});
	    $slider_bar.css({'top': params.btn_size, 'left': 0.4 * params.btn_size});
	    $slider.css({'left': 0});
	    component.orientation = VERTICAL;
	} else {
	    $slider_bar.css({'min-height': Math.round(params.btn_size / 5),
		'min-width': params.width - 2 * params.btn_size});
	    $slider.css({'min-height': params.btn_size,
		'min-width': Math.round(params.btn_size / 2)});
	    
	    $plus_btn.css({'top': 0, 'left': params.width - params.btn_size});
	    $minus_btn.css({'top': 0, 'left': 0});
	    $slider_bar.css({'top': 0.4*params.btn_size, 'left': params.btn_size});
	    $slider.css({'top': 0});
	    component.orientation = HORIZONTAL;
	}
	
	$plus_btn.click(function() {
	    component.value /= 0.7;
	    params.onChange(component.value);
	});				
	$minus_btn.click(function() {
	    component.value *= 0.7;
	    params.onChange(component.value);
	});
	
	[$slider, $plus_btn, $minus_btn].map(function($btn) { $btn.hover(function() {
	    $(this).css({'background-color':'#cccccc'});
	}, function() {
	    $(this).css({'background-color': '#ffffff'});
	}); });
    
    
    
	component.$slider = $slider;
	component.$plus_btn = $plus_btn;
	component.$minus_btn = $minus_btn;
	
	(function setUpSliderDrag() {
	    var start_mouse;
	    var start_val;
	    var dragging;
	    var handleSliderDrag = function (evt) {
		evt.stopPropagation();
		evt.preventDefault();
		var delta_mouse;
		if (component.orientation === VERTICAL) {
		    delta_mouse = start_mouse - evt.pageY; // vertical zoom, positive is up, but CSS positive is down, so we need to invert
		} else {
		    delta_mouse = evt.pageX - start_mouse;
		}
		var delta_val = delta_mouse / component.slider_bar_size;
		component.setSliderValue(start_val + delta_val);
	    };
	    var stopSliderDrag = function () {
		if (dragging && start_val !== component.value) {
		    component.onChange(component.value);
		}
		dragging = false;
	    };
	    component.$slider.on("mousedown", function (evt) {
		if (component.orientation === VERTICAL) {
		    start_mouse = evt.pageY;
		} else {
		    start_mouse = evt.pageX;
		}
		start_val = component.value;
		dragging = true;
		$(document).on("mousemove", handleSliderDrag);
	    });
	    $(document).on("mouseup click", function () {
		$(document).off("mousemove", handleSliderDrag);
		stopSliderDrag();
	    });
	})()
    };
    
    var setSliderPos = function(component, proportion) {
	var $slider = component.$slider;
	var bounds = getSliderBounds(component);
	if (component.orientation === VERTICAL) {
	    $slider.css('top', bounds.bottom*(1-proportion) + bounds.top*proportion);
	} else if (component.orientation === HORIZONTAL) {
	    $slider.css('left', bounds.left*(1-proportion) + bounds.right*proportion);
	}
    };
    
    var getSliderBounds = function(component) {
	if (component.orientation === VERTICAL) {
	    return {bottom: parseInt(component.$minus_btn.css('top'), 10) - parseInt(component.$slider.css('min-height'), 10),
		    top: parseInt(component.$plus_btn.css('top'), 10) + parseInt(component.$plus_btn.css('min-height'), 10)};
	} else { 
	    return {left: parseInt(component.$minus_btn.css('left'), 10) + parseInt(component.$minus_btn.css('min-width'), 10),
		    right: parseInt(component.$plus_btn.css('left'), 10) - parseInt(component.$slider.css('min-width'), 10)};
	}
    };
    
    var updateSliderPos = function(component) {
	setSliderPos(component, component.value);
    };
    
    function OncoprintZoomSlider($container, params) {
	this.$div = $('<div>').css({'position':'absolute',
				    'top': params.top || 0,
				    'left': params.left || 0}).appendTo($container);
	params = params || {};
	params.btn_size = params.btn_size || 13;
	this.onChange = params.onChange || function() {};
	initialize(this, params);
	this.value = params.init_val || 0.5;
	this.slider_bar_size = (this.orientation === VERTICAL ? params.height : params.width) - 2*params.btn_size;
	updateSliderPos(this);
    }
    
    OncoprintZoomSlider.prototype.setSliderValue = function(proportion, trigger_callback) {
	this.value = clamp(proportion);
	updateSliderPos(this);
    }
    
    
    return OncoprintZoomSlider;
    })();
    
module.exports = OncoprintZoomSlider;
},{}],31:[function(require,module,exports){
var makeSVGElement = require('./makesvgelement.js');
var shapeToSVG = require('./oncoprintshapetosvg.js');
var extractRGBA = require('./extractrgba.js');

var extractColor = function(str) {
    if (str.indexOf("rgb(") > -1) {
	return {
	    'rgb': str,
	    'opacity': 1
	};
    }
    var rgba_arr = extractRGBA(str);
    return {
	'rgb': 'rgb('+Math.round(rgba_arr[0]*255)+','+Math.round(rgba_arr[1]*255)+','+Math.round(rgba_arr[2]*255)+')',
	'opacity': rgba_arr[3]
    };
};

function makeIdCounter() {
    var id = 0;
    return function () {
	id += 1;
	return id;
    };
}

var gradientId = makeIdCounter();

module.exports = {
    text: function(content,x,y,size,family,weight,alignment_baseline) {
	size = size || 12;
	var alignment_baseline_y_offset = size;
	if (alignment_baseline === "middle") {
	    alignment_baseline_y_offset = size/2;
	} else if (alignment_baseline === "bottom") {
	    alignment_baseline_y_offset = 0;
	}
	var elt = makeSVGElement('text', {
	    'x':(x || 0),
	    'y':(y || 0) + alignment_baseline_y_offset,
	    'font-size':size,
	    'font-family':(family || 'serif'),
	    'font-weight':(weight || 'normal'),
	    'text-anchor':'start',
	});
	elt.textContent = content + '';
	return elt;
    },
    group: function(x,y) {
	x = x || 0;
	y = y || 0;
	return makeSVGElement('g', {
	    'transform':'translate('+x+','+y+')',
	    'x':x,
	    'y':y
	});
    },
    svg: function(width, height) {
	return makeSVGElement('svg', {
	    'width':(width || 0), 
	    'height':(height || 0),
	});
    },
    wrapText: function(in_dom_text_svg_elt, width) {
	var text = in_dom_text_svg_elt.textContent;
	in_dom_text_svg_elt.textContent = "";
	
	var words = text.split(" ");
	var dy = 0;
	var tspan = makeSVGElement('tspan', {'x':'0', 'dy':dy});
	in_dom_text_svg_elt.appendChild(tspan);
	
	var curr_tspan_words = [];
	for (var i=0; i<words.length; i++) {
	    curr_tspan_words.push(words[i]);
	    tspan.textContent = curr_tspan_words.join(" ");
	    if (tspan.getComputedTextLength() > width) {
		tspan.textContent = curr_tspan_words.slice(0, curr_tspan_words.length-1).join(" ");
		dy = in_dom_text_svg_elt.getBBox().height;
		curr_tspan_words = [words[i]];
		tspan = makeSVGElement('tspan', {'x':'0', 'dy':dy});
		in_dom_text_svg_elt.appendChild(tspan);
		tspan.textContent = words[i];
	    }
	}
    },
    fromShape: function(oncoprint_shape_computed_params, offset_x, offset_y) {
	return shapeToSVG(oncoprint_shape_computed_params, offset_x, offset_y);
    },
    polygon: function(points, fill) {
	return makeSVGElement('polygon', {'points': points, 'fill':fill});
    },
    rect: function(x,y,width,height,fill) {
	return makeSVGElement('rect', {'x':x, 'y':y, 'width':width, 'height':height, 'fill':fill});
    },
    bgrect: function(width, height, fill) {
	return makeSVGElement('rect', {'width':width, 'height':height, 'fill':fill});
    },
    path: function(points, stroke, fill) {
	points = points.map(function(pt) { return pt.join(","); });
	points[0] = 'M'+points[0];
	for (var i=1; i<points.length; i++) {
	    points[i] = 'L'+points[i];
	}
	stroke = extractColor(stroke);
	fill = extractColor(fill);
	return makeSVGElement('path', {
	    'd': points.join(" "),
	    'stroke': stroke.rgb,
	    'stroke-opacity': stroke.opacity,
	    'fill': fill.rgb,
	    'fill-opacity': fill.opacity
	});
    },
    defs: function() {
	return makeSVGElement('defs');
    },
    gradient: function(colorFn) {
	var gradient = makeSVGElement('linearGradient', {
	    'id': 'gradient'+gradientId(),
	    'x1':0,
	    'y1':0,
	    'x2':1,
	    'y2':0
	});
	for (var i=0; i<=100; i++) {
	    var color = extractColor(colorFn(i/100));
	    gradient.appendChild(makeSVGElement('stop', {
		'offset': i + '%',
		'stop-color':color.rgb,
		'stop-opacity': color.opacity
	    }));
	}
	return gradient;
    }
};



},{"./extractrgba.js":3,"./makesvgelement.js":6,"./oncoprintshapetosvg.js":24}]},{},[5])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3Vzci9sb2NhbC9saWIvbm9kZV9tb2R1bGVzL2Jyb3dzZXJpZnkvbm9kZV9tb2R1bGVzL2Jyb3dzZXItcGFjay9fcHJlbHVkZS5qcyIsIkNhY2hlZFByb3BlcnR5LmpzIiwiYmluYXJ5c2VhcmNoLmpzIiwiZXh0cmFjdHJnYmEuanMiLCJoZWF0bWFwY29sb3JzLmpzIiwibWFpbi5qcyIsIm1ha2VzdmdlbGVtZW50LmpzIiwibm9kZV9tb2R1bGVzL2dsLW1hdHJpeC9zcmMvZ2wtbWF0cml4LmpzIiwibm9kZV9tb2R1bGVzL2dsLW1hdHJpeC9zcmMvZ2wtbWF0cml4L2NvbW1vbi5qcyIsIm5vZGVfbW9kdWxlcy9nbC1tYXRyaXgvc3JjL2dsLW1hdHJpeC9tYXQyLmpzIiwibm9kZV9tb2R1bGVzL2dsLW1hdHJpeC9zcmMvZ2wtbWF0cml4L21hdDJkLmpzIiwibm9kZV9tb2R1bGVzL2dsLW1hdHJpeC9zcmMvZ2wtbWF0cml4L21hdDMuanMiLCJub2RlX21vZHVsZXMvZ2wtbWF0cml4L3NyYy9nbC1tYXRyaXgvbWF0NC5qcyIsIm5vZGVfbW9kdWxlcy9nbC1tYXRyaXgvc3JjL2dsLW1hdHJpeC9xdWF0LmpzIiwibm9kZV9tb2R1bGVzL2dsLW1hdHJpeC9zcmMvZ2wtbWF0cml4L3ZlYzIuanMiLCJub2RlX21vZHVsZXMvZ2wtbWF0cml4L3NyYy9nbC1tYXRyaXgvdmVjMy5qcyIsIm5vZGVfbW9kdWxlcy9nbC1tYXRyaXgvc3JjL2dsLW1hdHJpeC92ZWM0LmpzIiwib25jb3ByaW50LmpzIiwib25jb3ByaW50bGFiZWx2aWV3LmpzIiwib25jb3ByaW50bGVnZW5kcmVuZGVyZXIuanMiLCJvbmNvcHJpbnRtaW5pbWFwdmlldy5qcyIsIm9uY29wcmludG1vZGVsLmpzIiwib25jb3ByaW50cnVsZXNldC5qcyIsIm9uY29wcmludHNoYXBlLmpzIiwib25jb3ByaW50c2hhcGV0b3N2Zy5qcyIsIm9uY29wcmludHNoYXBldG92ZXJ0ZXhlcy5qcyIsIm9uY29wcmludHRvb2x0aXAuanMiLCJvbmNvcHJpbnR0cmFja2luZm92aWV3LmpzIiwib25jb3ByaW50dHJhY2tvcHRpb25zdmlldy5qcyIsIm9uY29wcmludHdlYmdsY2VsbHZpZXcuanMiLCJvbmNvcHJpbnR6b29tc2xpZGVyLmpzIiwic3ZnZmFjdG9yeS5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQ0FBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDekJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNwQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDbEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN6Z0JBOztBQ0FBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNSQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNwQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN0RUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNwYkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNyZEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzF1QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDeGxFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN4bEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUMza0JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3p3QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDam1CQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN2NEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3RWQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDOU1BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNqM0JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2p0Q0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDeDBCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3hJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2pHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDekxBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN4R0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNySUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ25SQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNsMEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNuTEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiBlKHQsbixyKXtmdW5jdGlvbiBzKG8sdSl7aWYoIW5bb10pe2lmKCF0W29dKXt2YXIgYT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2lmKCF1JiZhKXJldHVybiBhKG8sITApO2lmKGkpcmV0dXJuIGkobywhMCk7dmFyIGY9bmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitvK1wiJ1wiKTt0aHJvdyBmLmNvZGU9XCJNT0RVTEVfTk9UX0ZPVU5EXCIsZn12YXIgbD1uW29dPXtleHBvcnRzOnt9fTt0W29dWzBdLmNhbGwobC5leHBvcnRzLGZ1bmN0aW9uKGUpe3ZhciBuPXRbb11bMV1bZV07cmV0dXJuIHMobj9uOmUpfSxsLGwuZXhwb3J0cyxlLHQsbixyKX1yZXR1cm4gbltvXS5leHBvcnRzfXZhciBpPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7Zm9yKHZhciBvPTA7bzxyLmxlbmd0aDtvKyspcyhyW29dKTtyZXR1cm4gc30pIiwidmFyIENhY2hlZFByb3BlcnR5ID0gKGZ1bmN0aW9uKCkge1xuICAgIGZ1bmN0aW9uIENhY2hlZFByb3BlcnR5KGluaXRfdmFsLCB1cGRhdGVGbikge1xuXHR0aGlzLnZhbHVlID0gaW5pdF92YWw7XG5cdHRoaXMudXBkYXRlRm4gPSB1cGRhdGVGbjtcblx0dGhpcy5ib3VuZF9wcm9wZXJ0aWVzID0gW107XG4gICAgfVxuICAgIENhY2hlZFByb3BlcnR5LnByb3RvdHlwZS51cGRhdGUgPSBmdW5jdGlvbigpIHtcblx0dGhpcy52YWx1ZSA9IHRoaXMudXBkYXRlRm4uYXBwbHkobnVsbCwgYXJndW1lbnRzKTtcblx0Zm9yICh2YXIgaT0wOyBpPHRoaXMuYm91bmRfcHJvcGVydGllcy5sZW5ndGg7IGkrKykge1xuXHQgICAgdGhpcy5ib3VuZF9wcm9wZXJ0aWVzW2ldLnVwZGF0ZSgpO1xuXHR9XG4gICAgfVxuICAgIENhY2hlZFByb3BlcnR5LnByb3RvdHlwZS5nZXQgPSBmdW5jdGlvbigpIHtcblx0cmV0dXJuIHRoaXMudmFsdWU7XG4gICAgfVxuICAgIENhY2hlZFByb3BlcnR5LnByb3RvdHlwZS51cGRhdGVBbmRHZXQgPSBmdW5jdGlvbigpIHtcblx0dGhpcy51cGRhdGUoKTtcblx0cmV0dXJuIHRoaXMuZ2V0KCk7XG4gICAgfVxuICAgIENhY2hlZFByb3BlcnR5LnByb3RvdHlwZS5hZGRCb3VuZFByb3BlcnR5ID0gZnVuY3Rpb24oY2FjaGVkX3Byb3BlcnR5KSB7XG5cdHRoaXMuYm91bmRfcHJvcGVydGllcy5wdXNoKGNhY2hlZF9wcm9wZXJ0eSk7XG4gICAgfTtcbiAgICByZXR1cm4gQ2FjaGVkUHJvcGVydHk7XG59KSgpO1xuXG5tb2R1bGUuZXhwb3J0cyA9IENhY2hlZFByb3BlcnR5OyIsIm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oYXJyYXksIHRhcmdldF9rZXksIGtleUZuLCByZXR1cm5fY2xvc2VzdF9pZl9ub3RfZm91bmQpIHtcbiAgICB2YXIgdXBwZXJfZXhjbCA9IGFycmF5Lmxlbmd0aDtcbiAgICB2YXIgbG93ZXJfaW5jbCA9IDA7XG4gICAgdmFyIG1pZGRsZTtcbiAgICB3aGlsZSAobG93ZXJfaW5jbCA8IHVwcGVyX2V4Y2wpIHtcblx0bWlkZGxlID0gTWF0aC5mbG9vcigodXBwZXJfZXhjbCArIGxvd2VyX2luY2wpIC8gMik7XG5cdHZhciBtaWRkbGVfa2V5ID0ga2V5Rm4oYXJyYXlbbWlkZGxlXSk7XG5cdGlmIChtaWRkbGVfa2V5ID09PSB0YXJnZXRfa2V5KSB7XG5cdCAgICByZXR1cm4gbWlkZGxlO1xuXHR9IGVsc2UgaWYgKHRhcmdldF9rZXkgPiBtaWRkbGVfa2V5KSB7XG5cdCAgICBsb3dlcl9pbmNsID0gbWlkZGxlICsgMTtcblx0fSBlbHNlIGlmICh0YXJnZXRfa2V5IDwgbWlkZGxlX2tleSkge1xuXHQgICAgdXBwZXJfZXhjbCA9IG1pZGRsZTtcblx0fVxuICAgIH1cbiAgICBpZiAocmV0dXJuX2Nsb3Nlc3RfaWZfbm90X2ZvdW5kKSB7XG5cdHJldHVybiBsb3dlcl9pbmNsLTE7XG4gICAgfSBlbHNlIHtcblx0cmV0dXJuIG51bGw7XG4gICAgfVxufSIsIm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKHN0cikge1xuICAgIHZhciByZXQgPSBbMCwgMCwgMCwgMV07XG4gICAgaWYgKHN0clswXSA9PT0gXCIjXCIpIHtcblx0Ly8gaGV4LCBjb252ZXJ0IHRvIHJnYmFcblx0dmFyIHIgPSBwYXJzZUludChzdHJbMV0gKyBzdHJbMl0sIDE2KTtcblx0dmFyIGcgPSBwYXJzZUludChzdHJbM10gKyBzdHJbNF0sIDE2KTtcblx0dmFyIGIgPSBwYXJzZUludChzdHJbNV0gKyBzdHJbNl0sIDE2KTtcblx0c3RyID0gJ3JnYmEoJytyKycsJytnKycsJytiKycsMSknO1xuICAgIH1cbiAgICB2YXIgbWF0Y2ggPSBzdHIubWF0Y2goL15bXFxzXSpyZ2JhXFwoW1xcc10qKFswLTkuXSspW1xcc10qLFtcXHNdKihbMC05Ll0rKVtcXHNdKixbXFxzXSooWzAtOS5dKylbXFxzXSosW1xcc10qKFswLTkuXSspW1xcc10qXFwpW1xcc10qJC8pO1xuICAgIGlmIChtYXRjaCAmJiBtYXRjaC5sZW5ndGggPT09IDUpIHtcblx0cmV0ID0gW3BhcnNlRmxvYXQobWF0Y2hbMV0pIC8gMjU1LFxuXHQgICAgcGFyc2VGbG9hdChtYXRjaFsyXSkgLyAyNTUsXG5cdCAgICBwYXJzZUZsb2F0KG1hdGNoWzNdKSAvIDI1NSxcblx0ICAgIHBhcnNlRmxvYXQobWF0Y2hbNF0pXTtcbiAgICB9XG4gICAgcmV0dXJuIHJldDtcbn07XG4iLCIvLyBDb2xvdXJzIGZvciB0aGUgb25jb3ByaW50IGhlYXRtYXAgZmVhdHVyZVxuLy8gdmlyaWRpcyBjb21lcyBmcm9tIG1hdHBsb3RsaWIncyBkZWZhdWx0IGNvbG91ciBzZXQsIGNyZWF0ZWQgYnkgU3TDqWZhbiB2YW4gZGVyIFdhbHQgYW5kIE5hdGhhbmllbCBTbWl0aFxuXG5tb2R1bGUuZXhwb3J0cyA9IHtcbiAgdmlyaWRpczogW1xuICAgIFs2OC4wODYwMjAsMS4yNDI4NzAsODQuMDAwODI1LDEuMDAwMDAwXSxcbiAgXHRbNjguNDcwMDUwLDIuNDQ5Mjc1LDg1LjUzMzg4NSwxLjAwMDAwMF0sXG4gIFx0WzY4LjgzNTcyMCwzLjcyOTM3NSw4Ny4wNTE2NDUsMS4wMDAwMDBdLFxuICBcdFs2OS4xODI3NzUsNS4wODUyMTAsODguNTUzNTk1LDEuMDAwMDAwXSxcbiAgXHRbNjkuNTExNDcwLDYuNTE4NTY1LDkwLjAzODcxNSwxLjAwMDAwMF0sXG4gIFx0WzY5LjgyMTI5NSw4LjAzMTczNSw5MS41MDc1MTUsMS4wMDAwMDBdLFxuICBcdFs3MC4xMTI3NjAsOS42MjY3NjAsOTIuOTU4NDY1LDEuMDAwMDAwXSxcbiAgXHRbNzAuMzg1NjEwLDExLjI2MjU4NSw5NC4zOTE4MjAsMS4wMDAwMDBdLFxuICBcdFs3MC42Mzk1OTAsMTIuODM3NzIwLDk1LjgwNzMyNSwxLjAwMDAwMF0sXG4gIFx0WzcwLjg3NDk1NSwxNC4zNjI2MjAsOTcuMjAzNzA1LDEuMDAwMDAwXSxcbiAgXHRbNzEuMDkxNzA1LDE1Ljg0Njk3NSw5OC41ODA5NjAsMS4wMDAwMDBdLFxuICBcdFs3MS4yODkzMzAsMTcuMjk4MTgwLDk5LjkzODgzNSwxLjAwMDAwMF0sXG4gIFx0WzcxLjQ2ODA4NSwxOC43MjEzMzUsMTAxLjI3NjU2NSwxLjAwMDAwMF0sXG4gIFx0WzcxLjYyNzk3MCwyMC4xMjEyODUsMTAyLjU5Mzg5NSwxLjAwMDAwMF0sXG4gIFx0WzcxLjc2ODczMCwyMS41MDE2MDAsMTAzLjg5MDU3MCwxLjAwMDAwMF0sXG4gIFx0WzcxLjg5MDYyMCwyMi44NjQ4MzAsMTA1LjE2NTgyNSwxLjAwMDAwMF0sXG4gIFx0WzcxLjk5MzM4NSwyNC4yMTM1MjUsMTA2LjQxOTQwNSwxLjAwMDAwMF0sXG4gIFx0WzcyLjA3NzI4MCwyNS41NDk5ODAsMTA3LjY1MDgwMCwxLjAwMDAwMF0sXG4gIFx0WzcyLjE0MjA1MCwyNi44NzUyMTUsMTA4Ljg2MDAxMCwxLjAwMDAwMF0sXG4gIFx0WzcyLjE4ODIwNSwyOC4xOTEwMTUsMTEwLjA0NjI3MCwxLjAwMDAwMF0sXG4gIFx0WzcyLjIxNTIzNSwyOS40OTg0MDAsMTExLjIwOTMyNSwxLjAwMDAwMF0sXG4gIFx0WzcyLjIyMzM5NSwzMC43OTgxMzUsMTEyLjM0ODkyMCwxLjAwMDAwMF0sXG4gIFx0WzcyLjIxMjY4NSwzMi4wOTEyNDAsMTEzLjQ2NDgwMCwxLjAwMDAwMF0sXG4gIFx0WzcyLjE4MzM2MCwzMy4zNzgyMjUsMTE0LjU1NjQ1NSwxLjAwMDAwMF0sXG4gIFx0WzcyLjEzNTQyMCwzNC42NTk2MDAsMTE1LjYyMzg4NSwxLjAwMDAwMF0sXG4gIFx0WzcyLjA2ODg2NSwzNS45MzYxMzAsMTE2LjY2NjgzNSwxLjAwMDAwMF0sXG4gIFx0WzcxLjk4Mzk1MCwzNy4yMDc1NjAsMTE3LjY4NTA1MCwxLjAwMDAwMF0sXG4gIFx0WzcxLjg4MTE4NSwzOC40NzQ2NTUsMTE4LjY3ODI3NSwxLjAwMDAwMF0sXG4gIFx0WzcxLjc2MDA2MCwzOS43Mzc2NzAsMTE5LjY0NjI1NSwxLjAwMDAwMF0sXG4gIFx0WzcxLjYyMTM0MCw0MC45OTY2MDUsMTIwLjU4OTI0NSwxLjAwMDAwMF0sXG4gIFx0WzcxLjQ2NTAyNSw0Mi4yNTE3MTUsMTIxLjUwNjk5MCwxLjAwMDAwMF0sXG4gIFx0WzcxLjI5MTM3MCw0My41MDI3NDUsMTIyLjM5OTIzNSwxLjAwMDAwMF0sXG4gIFx0WzcxLjEwMDYzMCw0NC43NDk5NTAsMTIzLjI2NjIzNSwxLjAwMDAwMF0sXG4gIFx0WzcwLjg5MzA2MCw0NS45OTM1ODUsMTI0LjEwNzczNSwxLjAwMDAwMF0sXG4gIFx0WzcwLjY2OTE3MCw0Ny4yMzMxNDAsMTI0LjkyMzk5MCwxLjAwMDAwMF0sXG4gIFx0WzcwLjQyOTQ3MCw0OC40Njg4NzAsMTI1LjcxNTI1NSwxLjAwMDAwMF0sXG4gIFx0WzcwLjE3MzcwNSw0OS43MDA3NzUsMTI2LjQ4MTI3NSwxLjAwMDAwMF0sXG4gIFx0WzY5LjkwMjY0MCw1MC45Mjg4NTUsMTI3LjIyMjMwNSwxLjAwMDAwMF0sXG4gIFx0WzY5LjYxNjUzMCw1Mi4xNTI2MDAsMTI3LjkzODg1NSwxLjAwMDAwMF0sXG4gIFx0WzY5LjMxNjE0MCw1My4zNzIyNjUsMTI4LjYzMDY3MCwxLjAwMDAwMF0sXG4gIFx0WzY5LjAwMTcyNSw1NC41ODc1OTUsMTI5LjI5ODI2MCwxLjAwMDAwMF0sXG4gIFx0WzY4LjY3MzU0MCw1NS43OTg1OTAsMTI5Ljk0MjEzNSwxLjAwMDAwMF0sXG4gIFx0WzY4LjMzMTg0MCw1Ny4wMDQ5OTUsMTMwLjU2MjA0MCwxLjAwMDAwMF0sXG4gIFx0WzY3Ljk3NzkwMCw1OC4yMDY4MTAsMTMxLjE1ODk5NSwxLjAwMDAwMF0sXG4gIFx0WzY3LjYxMTk3NSw1OS40MDM3ODAsMTMxLjczMjc0NSwxLjAwMDAwMF0sXG4gIFx0WzY3LjIzNDA2NSw2MC41OTU5MDUsMTMyLjI4NDMxMCwxLjAwMDAwMF0sXG4gIFx0WzY2Ljg0NTE5MCw2MS43ODI5MzAsMTMyLjgxMzQzNSwxLjAwMDAwMF0sXG4gIFx0WzY2LjQ0NTYwNSw2Mi45NjUxMTAsMTMzLjMyMTE0MCwxLjAwMDAwMF0sXG4gIFx0WzY2LjAzNjA3NSw2NC4xNDE5MzUsMTMzLjgwNzY4MCwxLjAwMDAwMF0sXG4gIFx0WzY1LjYxNzExMCw2NS4zMTMxNTAsMTM0LjI3MzU2NSwxLjAwMDAwMF0sXG4gIFx0WzY1LjE4OTQ3NSw2Ni40NzkyNjUsMTM0LjcxOTU2MCwxLjAwMDAwMF0sXG4gIFx0WzY0Ljc1MzQyNSw2Ny42Mzk3NzAsMTM1LjE0NTY2NSwxLjAwMDAwMF0sXG4gIFx0WzY0LjMwOTQ3MCw2OC43OTQ2NjUsMTM1LjU1MjY0NSwxLjAwMDAwMF0sXG4gIFx0WzYzLjg1ODM3NSw2OS45NDM5NTAsMTM1Ljk0MTI2NSwxLjAwMDAwMF0sXG4gIFx0WzYzLjQwMDM5NSw3MS4wODc2MjUsMTM2LjMxMTc4MCwxLjAwMDAwMF0sXG4gIFx0WzYyLjkzNjgwNSw3Mi4yMjU0MzUsMTM2LjY2NDk1NSwxLjAwMDAwMF0sXG4gIFx0WzYyLjQ2Nzg2MCw3My4zNTcxMjUsMTM3LjAwMTMwMCwxLjAwMDAwMF0sXG4gIFx0WzYxLjk5MzgxNSw3NC40ODM0NjAsMTM3LjMyMTU4MCwxLjAwMDAwMF0sXG4gIFx0WzYxLjUxNTQzNSw3NS42MDM2NzUsMTM3LjYyNTc5NSwxLjAwMDAwMF0sXG4gIFx0WzYxLjAzMzIzMCw3Ni43MTgwMjUsMTM3LjkxNTIyMCwxLjAwMDAwMF0sXG4gIFx0WzYwLjU0NzQ1NSw3Ny44MjY1MTAsMTM4LjE4OTg1NSwxLjAwMDAwMF0sXG4gIFx0WzYwLjA1OTEzMCw3OC45MjkzODUsMTM4LjQ1MDcyMCwxLjAwMDAwMF0sXG4gIFx0WzU5LjU2ODc2NSw4MC4wMjYxNDAsMTM4LjY5ODA3MCwxLjAwMDAwMF0sXG4gIFx0WzU5LjA3Njg3MCw4MS4xMTcwMzAsMTM4LjkzMjY3MCwxLjAwMDAwMF0sXG4gIFx0WzU4LjU4MzQ0NSw4Mi4yMDIwNTUsMTM5LjE1NTAzMCwxLjAwMDAwMF0sXG4gIFx0WzU4LjA4OTUxMCw4My4yODE0NzAsMTM5LjM2NTY2MCwxLjAwMDAwMF0sXG4gIFx0WzU3LjU5NTA2NSw4NC4zNTUyNzUsMTM5LjU2NTA3MCwxLjAwMDAwMF0sXG4gIFx0WzU3LjEwMDg3NSw4NS40MjM0NzAsMTM5Ljc1MzUxNSwxLjAwMDAwMF0sXG4gIFx0WzU2LjYwNzE5NSw4Ni40ODYwNTUsMTM5LjkzMTc2MCwxLjAwMDAwMF0sXG4gIFx0WzU2LjExNDUzNSw4Ny41NDMyODUsMTQwLjEwMDMxNSwxLjAwMDAwMF0sXG4gIFx0WzU1LjYyMzE1MCw4OC41OTUxNjAsMTQwLjI1OTY5MCwxLjAwMDAwMF0sXG4gIFx0WzU1LjEzMzU1MCw4OS42NDE0MjUsMTQwLjQwOTg4NSwxLjAwMDAwMF0sXG4gIFx0WzU0LjY0NTk5MCw5MC42ODI4NDUsMTQwLjU1MTkyMCwxLjAwMDAwMF0sXG4gIFx0WzU0LjE2MDcyNSw5MS43MTkxNjUsMTQwLjY4NjA1MCwxLjAwMDAwMF0sXG4gIFx0WzUzLjY3ODI2NSw5Mi43NTAzODUsMTQwLjgxMjUzMCwxLjAwMDAwMF0sXG4gIFx0WzUzLjE5ODg2NSw5My43NzY3NjAsMTQwLjkzMjEyNSwxLjAwMDAwMF0sXG4gIFx0WzUyLjcyMjc4MCw5NC43OTgyOTAsMTQxLjA0NDgzNSwxLjAwMDAwMF0sXG4gIFx0WzUyLjI1MDI2NSw5NS44MTUyMzAsMTQxLjE1MDkxNSwxLjAwMDAwMF0sXG4gIFx0WzUxLjc4MTA2NSw5Ni44Mjc1ODAsMTQxLjI1MDg3NSwxLjAwMDAwMF0sXG4gIFx0WzUxLjMxNTk0NSw5Ny44MzU4NTAsMTQxLjM0NDk3MCwxLjAwMDAwMF0sXG4gIFx0WzUwLjg1NDY1MCw5OC44Mzk3ODUsMTQxLjQzMzcxMCwxLjAwMDAwMF0sXG4gIFx0WzUwLjM5NzE4MCw5OS44Mzk2NDAsMTQxLjUxNzA5NSwxLjAwMDAwMF0sXG4gIFx0WzQ5Ljk0NDMwMCwxMDAuODM1NDE1LDE0MS41OTUzODAsMS4wMDAwMDBdLFxuICBcdFs0OS40OTU1MDAsMTAxLjgyNzM2NSwxNDEuNjY5MDc1LDEuMDAwMDAwXSxcbiAgXHRbNDkuMDUxMDM1LDEwMi44MTU3NDUsMTQxLjczODE4MCwxLjAwMDAwMF0sXG4gIFx0WzQ4LjYxMDkwNSwxMDMuODAwNTU1LDE0MS44MDI2OTUsMS4wMDAwMDBdLFxuICBcdFs0OC4xNzUzNjUsMTA0Ljc4MjA1MCwxNDEuODYzMTMwLDEuMDAwMDAwXSxcbiAgXHRbNDcuNzQzOTA1LDEwNS43NjAyMzAsMTQxLjkxOTQ4NSwxLjAwMDAwMF0sXG4gIFx0WzQ3LjMxNjc4MCwxMDYuNzM1MzUwLDE0MS45NzIwMTUsMS4wMDAwMDBdLFxuICBcdFs0Ni44OTM5OTAsMTA3LjcwNzY2NSwxNDIuMDIwNzIwLDEuMDAwMDAwXSxcbiAgXHRbNDYuNDc1MjgwLDEwOC42NzY5MjAsMTQyLjA2NTYwMCwxLjAwMDAwMF0sXG4gIFx0WzQ2LjA2MDM5NSwxMDkuNjQzNjI1LDE0Mi4xMDY5MTAsMS4wMDAwMDBdLFxuICBcdFs0NS42NDk4NDUsMTEwLjYwNzc4MCwxNDIuMTQ0NjUwLDEuMDAwMDAwXSxcbiAgXHRbNDUuMjQyODY1LDExMS41NjkzODUsMTQyLjE3OTA3NSwxLjAwMDAwMF0sXG4gIFx0WzQ0LjgzOTQ1NSwxMTIuNTI4OTUwLDE0Mi4yMDk2NzUsMS4wMDAwMDBdLFxuICBcdFs0NC40Mzk4NzAsMTEzLjQ4NjIyMCwxNDIuMjM2OTYwLDEuMDAwMDAwXSxcbiAgXHRbNDQuMDQzMzQ1LDExNC40NDE3MDUsMTQyLjI2MDY3NSwxLjAwMDAwMF0sXG4gIFx0WzQzLjY0OTg4MCwxMTUuMzk1MTUwLDE0Mi4yODEwNzUsMS4wMDAwMDBdLFxuICBcdFs0My4yNTk3MzAsMTE2LjM0NjgxMCwxNDIuMjk3NjUwLDEuMDAwMDAwXSxcbiAgXHRbNDIuODcyMTMwLDExNy4yOTY5NDAsMTQyLjMxMDkxMCwxLjAwMDAwMF0sXG4gIFx0WzQyLjQ4NzMzNSwxMTguMjQ1NTQwLDE0Mi4zMjAzNDUsMS4wMDAwMDBdLFxuICBcdFs0Mi4xMDQ4MzUsMTE5LjE5Mjg2NSwxNDIuMzI1OTU1LDEuMDAwMDAwXSxcbiAgXHRbNDEuNzI0Mzc1LDEyMC4xMzg5MTUsMTQyLjMyNzc0MCwxLjAwMDAwMF0sXG4gIFx0WzQxLjM0NjIxMCwxMjEuMDgzNjkwLDE0Mi4zMjU3MDAsMS4wMDAwMDBdLFxuICBcdFs0MC45Njk1NzUsMTIyLjAyNzcwMCwxNDIuMzE5MzI1LDEuMDAwMDAwXSxcbiAgXHRbNDAuNTk0NDcwLDEyMi45NzA0MzUsMTQyLjMwODYxNSwxLjAwMDAwMF0sXG4gIFx0WzQwLjIyMDg5NSwxMjMuOTEyNjYwLDE0Mi4yOTMzMTUsMS4wMDAwMDBdLFxuICBcdFszOS44NDg4NTAsMTI0Ljg1NDEyMCwxNDIuMjczNjgwLDEuMDAwMDAwXSxcbiAgXHRbMzkuNDc3ODI1LDEyNS43OTQ4MTUsMTQyLjI0OTIwMCwxLjAwMDAwMF0sXG4gIFx0WzM5LjEwNzgyMCwxMjYuNzM1MDAwLDE0Mi4yMTk2MjAsMS4wMDAwMDBdLFxuICBcdFszOC43MzkwOTAsMTI3LjY3NDY3NSwxNDIuMTg0Njg1LDEuMDAwMDAwXSxcbiAgXHRbMzguMzcxMzgwLDEyOC42MTQwOTUsMTQyLjE0NDY1MCwxLjAwMDAwMF0sXG4gIFx0WzM4LjAwNDk0NSwxMjkuNTUzMDA1LDE0Mi4wOTg3NTAsMS4wMDAwMDBdLFxuICBcdFszNy42Mzk3ODUsMTMwLjQ5MTkxNSwxNDIuMDQ3NDk1LDEuMDAwMDAwXSxcbiAgXHRbMzcuMjc1OTAwLDEzMS40MzAzMTUsMTQxLjk4OTg2NSwxLjAwMDAwMF0sXG4gIFx0WzM2LjkxMzU0NSwxMzIuMzY4NzE1LDE0MS45MjU4NjAsMS4wMDAwMDBdLFxuICBcdFszNi41NTI0NjUsMTMzLjMwNzExNSwxNDEuODU1MjI1LDEuMDAwMDAwXSxcbiAgXHRbMzYuMTkzNDI1LDEzNC4yNDU1MTUsMTQxLjc3NzcwNSwxLjAwMDAwMF0sXG4gIFx0WzM1LjgzNjY4MCwxMzUuMTgzNjYwLDE0MS42OTMwNDUsMS4wMDAwMDBdLFxuICBcdFszNS40ODI0ODUsMTM2LjEyMjA2MCwxNDEuNjAwOTkwLDEuMDAwMDAwXSxcbiAgXHRbMzUuMTMxMzUwLDEzNy4wNjA0NjAsMTQxLjUwMTAzMCwxLjAwMDAwMF0sXG4gIFx0WzM0Ljc4NDA0MCwxMzcuOTk5MTE1LDE0MS4zOTMxNjUsMS4wMDAwMDBdLFxuICBcdFszNC40NDE4MzAsMTM4LjkzNzUxNSwxNDEuMjc3Mzk1LDEuMDAwMDAwXSxcbiAgXHRbMzQuMTA0NDY1LDEzOS44NzY0MjUsMTQxLjE1Mjk1NSwxLjAwMDAwMF0sXG4gIFx0WzMzLjc3MzIyMCwxNDAuODE1MDgwLDE0MS4wMTk1OTAsMS4wMDAwMDBdLFxuICBcdFszMy40NDg4NjAsMTQxLjc1NDI0NSwxNDAuODc3MDQ1LDEuMDAwMDAwXSxcbiAgXHRbMzMuMTMyOTE1LDE0Mi42OTM0MTAsMTQwLjcyNTMyMCwxLjAwMDAwMF0sXG4gIFx0WzMyLjgyNTg5NSwxNDMuNjMyNTc1LDE0MC41NjMzOTUsMS4wMDAwMDBdLFxuICBcdFszMi41Mjk4NDAsMTQ0LjU3MTk5NSwxNDAuMzkxNzgwLDEuMDAwMDAwXSxcbiAgXHRbMzIuMjQ1NTE1LDE0NS41MTE0MTUsMTQwLjIwOTQ1NSwxLjAwMDAwMF0sXG4gIFx0WzMxLjk3NTQ3MCwxNDYuNDUxMDkwLDE0MC4wMTY5MzAsMS4wMDAwMDBdLFxuICBcdFszMS43MjA3MjUsMTQ3LjM5MDUxMCwxMzkuODEzMTg1LDEuMDAwMDAwXSxcbiAgXHRbMzEuNDgzMDY1LDE0OC4zMzAxODUsMTM5LjU5ODQ3NSwxLjAwMDAwMF0sXG4gIFx0WzMxLjI2NDUzMCwxNDkuMjY5NjA1LDEzOS4zNzIwMzUsMS4wMDAwMDBdLFxuICBcdFszMS4wNjY5MDUsMTUwLjIwOTAyNSwxMzkuMTMzODY1LDEuMDAwMDAwXSxcbiAgXHRbMzAuODkyNzQwLDE1MS4xNDg0NDUsMTM4Ljg4MzQ1NSwxLjAwMDAwMF0sXG4gIFx0WzMwLjc0NDA3NSwxNTIuMDg3NjEwLDEzOC42MjA4MDUsMS4wMDAwMDBdLFxuICBcdFszMC42MjM0NjAsMTUzLjAyNjUyMCwxMzguMzQ1MTUwLDEuMDAwMDAwXSxcbiAgXHRbMzAuNTMzMTkwLDE1My45NjUxNzUsMTM4LjA1NzAwMCwxLjAwMDAwMF0sXG4gIFx0WzMwLjQ3NTU2MCwxNTQuOTAzMzIwLDEzNy43NTU1OTAsMS4wMDAwMDBdLFxuICBcdFszMC40NTI4NjUsMTU1Ljg0MDk1NSwxMzcuNDQwNDEwLDEuMDAwMDAwXSxcbiAgXHRbMzAuNDY4MTY1LDE1Ni43NzgzMzUsMTM3LjExMTQ2MCwxLjAwMDAwMF0sXG4gIFx0WzMwLjUyMzI0NSwxNTcuNzE0OTUwLDEzNi43Njg0ODUsMS4wMDAwMDBdLFxuICBcdFszMC42MjA2NTUsMTU4LjY1MTA1NSwxMzYuNDExMjMwLDEuMDAwMDAwXSxcbiAgXHRbMzAuNzYyNjkwLDE1OS41ODYxNDAsMTM2LjAzOTQ0MCwxLjAwMDAwMF0sXG4gIFx0WzMwLjk1MTkwMCwxNjAuNTIwNDYwLDEzNS42NTMxMTUsMS4wMDAwMDBdLFxuICBcdFszMS4xODk1NjAsMTYxLjQ1NDAxNSwxMzUuMjUxNDkwLDEuMDAwMDAwXSxcbiAgXHRbMzEuNDc4MjIwLDE2Mi4zODYyOTUsMTM0LjgzNDU2NSwxLjAwMDAwMF0sXG4gIFx0WzMxLjgxODkwMCwxNjMuMzE3NTU1LDEzNC40MDIzNDAsMS4wMDAwMDBdLFxuICBcdFszMi4yMTMxMzAsMTY0LjI0NzI4NSwxMzMuOTU0MzA1LDEuMDAwMDAwXSxcbiAgXHRbMzIuNjYyMTg1LDE2NS4xNzU5OTUsMTMzLjQ5MDIwNSwxLjAwMDAwMF0sXG4gIFx0WzMzLjE2NzA4NSwxNjYuMTAyOTIwLDEzMy4wMTAwNDAsMS4wMDAwMDBdLFxuICBcdFszMy43MjgzNDAsMTY3LjAyODU3MCwxMzIuNTEzNTU1LDEuMDAwMDAwXSxcbiAgXHRbMzQuMzQ2NDYwLDE2Ny45NTIxODAsMTMyLjAwMDQ5NSwxLjAwMDAwMF0sXG4gIFx0WzM1LjAyMTQ0NSwxNjguODc0MjYwLDEzMS40NzA2MDUsMS4wMDAwMDBdLFxuICBcdFszNS43NTM1NTAsMTY5Ljc5NDA0NSwxMzAuOTIzODg1LDEuMDAwMDAwXSxcbiAgXHRbMzYuNTQyMjY1LDE3MC43MTIwNDUsMTMwLjM1OTgyNSwxLjAwMDAwMF0sXG4gIFx0WzM3LjM4NzA4MCwxNzEuNjI3NzUwLDEyOS43Nzg2ODAsMS4wMDAwMDBdLFxuICBcdFszOC4yODc3NDAsMTcyLjU0MDkwNSwxMjkuMTgwMTk1LDEuMDAwMDAwXSxcbiAgXHRbMzkuMjQyOTcwLDE3My40NTE3NjUsMTI4LjU2Mzg2MCwxLjAwMDAwMF0sXG4gIFx0WzQwLjI1MjAwNSwxNzQuMzYwMDc1LDEyNy45Mjk5MzAsMS4wMDAwMDBdLFxuICBcdFs0MS4zMTQwODAsMTc1LjI2NTU4MCwxMjcuMjc3ODk1LDEuMDAwMDAwXSxcbiAgXHRbNDIuNDI3NjY1LDE3Ni4xNjgyODAsMTI2LjYwODAxMCwxLjAwMDAwMF0sXG4gIFx0WzQzLjU5MTc0MCwxNzcuMDY3OTIwLDEyNS45MTk3NjUsMS4wMDAwMDBdLFxuICBcdFs0NC44MDUyODUsMTc3Ljk2NDUwMCwxMjUuMjEzNDE1LDEuMDAwMDAwXSxcbiAgXHRbNDYuMDY2NTE1LDE3OC44NTc1MTAsMTI0LjQ4ODE5NSwxLjAwMDAwMF0sXG4gIFx0WzQ3LjM3NDY2NSwxNzkuNzQ3MjA1LDEyMy43NDQ2MTUsMS4wMDAwMDBdLFxuICBcdFs0OC43Mjc5NTAsMTgwLjYzMzMzMCwxMjIuOTgyNDIwLDEuMDAwMDAwXSxcbiAgXHRbNTAuMTI1NjA1LDE4MS41MTU4ODUsMTIyLjIwMTM1NSwxLjAwMDAwMF0sXG4gIFx0WzUxLjU2NTg0NSwxODIuMzk0MzYwLDEyMS40MDE0MjAsMS4wMDAwMDBdLFxuICBcdFs1My4wNDc2NTAsMTgzLjI2ODc1NSwxMjAuNTgyNjE1LDEuMDAwMDAwXSxcbiAgXHRbNTQuNTcwMDAwLDE4NC4xMzkwNzAsMTE5Ljc0NDk0MCwxLjAwMDAwMF0sXG4gIFx0WzU2LjEzMTYyMCwxODUuMDA0Nzk1LDExOC44ODc2MzAsMS4wMDAwMDBdLFxuICBcdFs1Ny43MzEyMzUsMTg1Ljg2NjQ0MCwxMTguMDExMTk1LDEuMDAwMDAwXSxcbiAgXHRbNTkuMzY3ODI1LDE4Ni43MjI5ODUsMTE3LjExNTYzNSwxLjAwMDAwMF0sXG4gIFx0WzYxLjA0MDM3MCwxODcuNTc0OTQwLDExNi4yMDA0NDAsMS4wMDAwMDBdLFxuICBcdFs2Mi43NDc4NTAsMTg4LjQyMjA1MCwxMTUuMjY2MTIwLDEuMDAwMDAwXSxcbiAgXHRbNjQuNDg5MjQ1LDE4OS4yNjM4MDUsMTE0LjMxMjQyMCwxLjAwMDAwMF0sXG4gIFx0WzY2LjI2MzUzNSwxOTAuMTAwNDYwLDExMy4zMzkwODUsMS4wMDAwMDBdLFxuICBcdFs2OC4wNjk5NTUsMTkwLjkzMTUwNSwxMTIuMzQ2MTE1LDEuMDAwMDAwXSxcbiAgXHRbNjkuOTA3OTk1LDE5MS43NTY5NDAsMTExLjMzMzI1NSwxLjAwMDAwMF0sXG4gIFx0WzcxLjc3NjYzNSwxOTIuNTc2NzY1LDExMC4zMDA3NjAsMS4wMDAwMDBdLFxuICBcdFs3My42NzQ4NTUsMTkzLjM5MDQ3MCwxMDkuMjQ4NjMwLDEuMDAwMDAwXSxcbiAgXHRbNzUuNjAyMTQ1LDE5NC4xOTgwNTUsMTA4LjE3Njg2NSwxLjAwMDAwMF0sXG4gIFx0Wzc3LjU1Nzc0MCwxOTQuOTk5NTIwLDEwNy4wODU0NjUsMS4wMDAwMDBdLFxuICBcdFs3OS41NDA4NzUsMTk1Ljc5NDYxMCwxMDUuOTc0NDMwLDEuMDAwMDAwXSxcbiAgXHRbODEuNTUxMjk1LDE5Ni41ODMwNzAsMTA0Ljg0Mzc2MCwxLjAwMDAwMF0sXG4gIFx0WzgzLjU4Nzk4MCwxOTcuMzY0OTAwLDEwMy42OTMyMDAsMS4wMDAwMDBdLFxuICBcdFs4NS42NTA2NzUsMTk4LjEzOTU5MCwxMDIuNTIyNDk1LDEuMDAwMDAwXSxcbiAgXHRbODcuNzM4ODcwLDE5OC45MDczOTUsMTAxLjMzMjE1NSwxLjAwMDAwMF0sXG4gIFx0Wzg5Ljg1MTgwMCwxOTkuNjY3ODA1LDEwMC4xMjIxODAsMS4wMDAwMDBdLFxuICBcdFs5MS45ODg5NTUsMjAwLjQyMDgyMCw5OC44OTI1NzAsMS4wMDAwMDBdLFxuICBcdFs5NC4xNDk1NzAsMjAxLjE2NjQ0MCw5Ny42NDMwNzAsMS4wMDAwMDBdLFxuICBcdFs5Ni4zMzM2NDUsMjAxLjkwNDE1NSw5Ni4zNzQ0NDUsMS4wMDAwMDBdLFxuICBcdFs5OC41NDA0MTUsMjAyLjYzNDIyMCw5NS4wODU5MzAsMS4wMDAwMDBdLFxuICBcdFsxMDAuNzY5MzcwLDIwMy4zNTYxMjUsOTMuNzc4MDM1LDEuMDAwMDAwXSxcbiAgXHRbMTAzLjAyMDI1NSwyMDQuMDcwMTI1LDkyLjQ1MDc2MCwxLjAwMDAwMF0sXG4gIFx0WzEwNS4yOTI4MTUsMjA0Ljc3NTQ1NSw5MS4xMDM1OTUsMS4wMDAwMDBdLFxuICBcdFsxMDcuNTg2NTQwLDIwNS40NzIzNzAsODkuNzM3MDUwLDEuMDAwMDAwXSxcbiAgXHRbMTA5LjkwMDY2NSwyMDYuMTYwNjE1LDg4LjM1MTM4MCwxLjAwMDAwMF0sXG4gIFx0WzExMi4yMzQ5MzUsMjA2Ljg0MDE5MCw4Ni45NDY1ODUsMS4wMDAwMDBdLFxuICBcdFsxMTQuNTg4ODQwLDIwNy41MTA4NDAsODUuNTIyOTIwLDEuMDAwMDAwXSxcbiAgXHRbMTE2Ljk2MTg3MCwyMDguMTcyNTY1LDg0LjA4MDM4NSwxLjAwMDAwMF0sXG4gIFx0WzExOS4zNTM1MTUsMjA4LjgyNDg1NSw4Mi42MTk0OTAsMS4wMDAwMDBdLFxuICBcdFsxMjEuNzYzNTIwLDIwOS40NjgyMjAsODEuMTM5NzI1LDEuMDAwMDAwXSxcbiAgXHRbMTI0LjE5MTYzMCwyMTAuMTAxODk1LDc5LjY0MTg1NSwxLjAwMDAwMF0sXG4gIFx0WzEyNi42MzY4MjUsMjEwLjcyNTg4MCw3OC4xMjYxMzUsMS4wMDAwMDBdLFxuICBcdFsxMjkuMDk5MTA1LDIxMS4zNDA0MzAsNzYuNTkyMzEwLDEuMDAwMDAwXSxcbiAgXHRbMTMxLjU3Nzk2MCwyMTEuOTQ1MjkwLDc1LjA0MTE0NSwxLjAwMDAwMF0sXG4gIFx0WzEzNC4wNzI4ODAsMjEyLjU0MDIwNSw3My40NzIzODUsMS4wMDAwMDBdLFxuICBcdFsxMzYuNTgzMzU1LDIxMy4xMjUxNzUsNzEuODg2NTQwLDEuMDAwMDAwXSxcbiAgXHRbMTM5LjEwODYyMCwyMTMuNjk5OTQ1LDcwLjI4NDYzMCwxLjAwMDAwMF0sXG4gIFx0WzE0MS42NDg0MjAsMjE0LjI2NDc3MCw2OC42NjY2NTUsMS4wMDAwMDBdLFxuICBcdFsxNDQuMjAxOTkwLDIxNC44MTk2NTAsNjcuMDMzNjM1LDEuMDAwMDAwXSxcbiAgXHRbMTQ2Ljc2ODU2NSwyMTUuMzY0MzMwLDY1LjM4NTgyNSwxLjAwMDAwMF0sXG4gIFx0WzE0OS4zNDc4OTAsMjE1Ljg5ODU1NSw2My43MjM3MzUsMS4wMDAwMDBdLFxuICBcdFsxNTEuOTM4OTQ1LDIxNi40MjI4MzUsNjIuMDQ4ODk1LDEuMDAwMDAwXSxcbiAgXHRbMTU0LjU0MTQ3NSwyMTYuOTM2OTE1LDYwLjM2MTU2MCwxLjAwMDAwMF0sXG4gIFx0WzE1Ny4xNTQ3MTUsMjE3LjQ0MDc5NSw1OC42NjMyNjAsMS4wMDAwMDBdLFxuICBcdFsxNTkuNzc3NjQ1LDIxNy45MzQ0NzUsNTYuOTU1MDE1LDEuMDAwMDAwXSxcbiAgXHRbMTYyLjQxMDAxMCwyMTguNDE4MjEwLDU1LjIzODEwMCwxLjAwMDAwMF0sXG4gIFx0WzE2NS4wNTA1MzUsMjE4Ljg5MjAwMCw1My41MTQ1NTUsMS4wMDAwMDBdLFxuICBcdFsxNjcuNjk4NzEwLDIxOS4zNTU4NDUsNTEuNzg1OTEwLDEuMDAwMDAwXSxcbiAgXHRbMTcwLjM1Mzc3MCwyMTkuODA5NzQ1LDUwLjA1NDcxNSwxLjAwMDAwMF0sXG4gIFx0WzE3My4wMTQ2OTUsMjIwLjI1NDIxMCw0OC4zMjMyNjUsMS4wMDAwMDBdLFxuICBcdFsxNzUuNjgwNzIwLDIyMC42ODkyNDAsNDYuNTk0ODc1LDEuMDAwMDAwXSxcbiAgXHRbMTc4LjM1MDgyNSwyMjEuMTE0ODM1LDQ0Ljg3MjYwNSwxLjAwMDAwMF0sXG4gIFx0WzE4MS4wMjM5OTAsMjIxLjUzMTUwNSw0My4xNjA1MzUsMS4wMDAwMDBdLFxuICBcdFsxODMuNjk5NzA1LDIyMS45MzkyNTAsNDEuNDYzNzY1LDEuMDAwMDAwXSxcbiAgXHRbMTg2LjM3NjY5NSwyMjIuMzM4NTgwLDM5Ljc4NzM5NSwxLjAwMDAwMF0sXG4gIFx0WzE4OS4wNTM5NDAsMjIyLjcyOTQ5NSwzOC4xMzgwNTUsMS4wMDAwMDBdLFxuICBcdFsxOTEuNzMwNDIwLDIyMy4xMTI1MDUsMzYuNTIzMTQwLDEuMDAwMDAwXSxcbiAgXHRbMTk0LjQwNTExNSwyMjMuNDg4MTIwLDM0Ljk1MTMyMCwxLjAwMDAwMF0sXG4gIFx0WzE5Ny4wNzcyNjAsMjIzLjg1NjM0MCwzMy40MzI3OTUsMS4wMDAwMDBdLFxuICBcdFsxOTkuNzQ1MzI1LDIyNC4yMTc2NzUsMzEuOTc4Mjc1LDEuMDAwMDAwXSxcbiAgXHRbMjAyLjQwODgwMCwyMjQuNTcyODkwLDMwLjYwMTI3NSwxLjAwMDAwMF0sXG4gIFx0WzIwNS4wNjY0MTAsMjI0LjkyMTczMCwyOS4zMTYwNzUsMS4wMDAwMDBdLFxuICBcdFsyMDcuNzE2ODgwLDIyNS4yNjUyMTUsMjguMTM4NDg1LDEuMDAwMDAwXSxcbiAgXHRbMjEwLjM1OTcwMCwyMjUuNjAzNjAwLDI3LjA4NTMzNSwxLjAwMDAwMF0sXG4gIFx0WzIxMi45OTM4NTAsMjI1LjkzNzM5NSwyNi4xNzQ3MzAsMS4wMDAwMDBdLFxuICBcdFsyMTUuNjE4MDU1LDIyNi4yNjcxMTAsMjUuNDI0MDEwLDEuMDAwMDAwXSxcbiAgXHRbMjE4LjIzMTU1MCwyMjYuNTkzMjU1LDI0Ljg1MDI2MCwxLjAwMDAwMF0sXG4gIFx0WzIyMC44MzMzMTUsMjI2LjkxNjM0MCwyNC40NjgwMTUsMS4wMDAwMDBdLFxuICBcdFsyMjMuNDIyODQwLDIyNy4yMzY4NzUsMjQuMjg4NzUwLDEuMDAwMDAwXSxcbiAgXHRbMjI1Ljk5OTEwNSwyMjcuNTU1MzcwLDI0LjMyMDM3MCwxLjAwMDAwMF0sXG4gIFx0WzIyOC41NjE2MDAsMjI3Ljg3MjA4MCwyNC41NjU0MjUsMS4wMDAwMDBdLFxuICBcdFsyMzEuMTA5MzA1LDIyOC4xODgwMjUsMjUuMDIxODc1LDEuMDAwMDAwXSxcbiAgXHRbMjMzLjY0MTcxMCwyMjguNTAzMjA1LDI1LjY4MjgzNSwxLjAwMDAwMF0sXG4gIFx0WzIzNi4xNTcwMzAsMjI4LjgxOTE1MCwyNi41MzgxMDUsMS4wMDAwMDBdLFxuICBcdFsyMzguNjU1NTIwLDIyOS4xMzUzNTAsMjcuNTczNDA1LDEuMDAwMDAwXSxcbiAgXHRbMjQxLjEzNzE4MCwyMjkuNDUyODI1LDI4Ljc3MzY5MCwxLjAwMDAwMF0sXG4gIFx0WzI0My42MDE1MDAsMjI5Ljc3MTU3NSwzMC4xMjI2NDAsMS4wMDAwMDBdLFxuICBcdFsyNDYuMDQ3OTcwLDIzMC4wOTIzNjUsMzEuNjA0OTU1LDEuMDAwMDAwXSxcbiAgXHRbMjQ4LjQ3NjMzNSwyMzAuNDE1NDUwLDMzLjIwNDgyNSwxLjAwMDAwMF0sXG4gIFx0WzI1MC44ODYzNDAsMjMwLjc0MTA4NSwzNC45MDg3MzUsMS4wMDAwMDBdLFxuICBcdFsyNTMuMjc4MjQwLDIzMS4wNzAwMzUsMzYuNzAzNjgwLDEuMDAwMDAwXSxcbiAgXSxcbiAgaW5mZXJubzogW1xuICAgIFswLjM3MjgxMCwwLjExODgzMCwzLjUzNTgzMCwxLjAwMDAwMF0sXG4gICAgWzAuNTc4MDg1LDAuMzIzODUwLDQuNzM1MzUwLDEuMDAwMDAwXSxcbiAgICBbMC44NDEyNDUsMC41NzM0OTUsNi4xODA5NDUsMS4wMDAwMDBdLFxuICAgIFsxLjE1OTQ4NSwwLjg2NDk2MCw3Ljg4MTc5NSwxLjAwMDAwMF0sXG4gICAgWzEuNTMxNTMwLDEuMTk2NDYwLDkuODMyMjkwLDEuMDAwMDAwXSxcbiAgICBbMS45NTczODAsMS41NjQ2ODAsMTEuOTQzMTgwLDEuMDAwMDAwXSxcbiAgICBbMi40MzgwNTUsMS45NjY4MTUsMTQuMDYxNDY1LDEuMDAwMDAwXSxcbiAgICBbMi45NzQwNjUsMi40MDEzMzUsMTYuMTgyMzAwLDEuMDAwMDAwXSxcbiAgICBbMy41Njg3MjUsMi44NjIzNzUsMTguMzI0ODEwLDEuMDAwMDAwXSxcbiAgICBbNC4yMjMwNTUsMy4zNDk2ODAsMjAuNDcxOTEwLDEuMDAwMDAwXSxcbiAgICBbNC45NDAxMTUsMy44NTg5MTUsMjIuNjM1NTg1LDEuMDAwMDAwXSxcbiAgICBbNS43MjM5ODUsNC4zODU3NDUsMjQuODE4Mzg1LDEuMDAwMDAwXSxcbiAgICBbNi41NzcyMTUsNC45Mjk0MDUsMjcuMDEyMTUwLDEuMDAwMDAwXSxcbiAgICBbNy41MDUxNjAsNS40ODMyNjUsMjkuMjI4MzU1LDEuMDAwMDAwXSxcbiAgICBbOC41MTMxNzUsNi4wNDQwMTAsMzEuNDY2MjM1LDEuMDAwMDAwXSxcbiAgICBbOS42MDUzNDAsNi42MDk4NTUsMzMuNzE5MTYwLDEuMDAwMDAwXSxcbiAgICBbMTAuNzc0NTE1LDcuMTc1NDQ1LDM1Ljk5MDk1NSwxLjAwMDAwMF0sXG4gICAgWzExLjk2MzMyNSw3LjczMjYyMCwzOC4yOTE4MjAsMS4wMDAwMDBdLFxuICAgIFsxMy4xNjkyMjAsOC4yODA4NzAsNDAuNjA5NzcwLDEuMDAwMDAwXSxcbiAgICBbMTQuMzk0NDk1LDguODE1MDk1LDQyLjk0NTU3MCwxLjAwMDAwMF0sXG4gICAgWzE1LjY0MTcwMCw5LjMzMDQ1MCw0NS4yOTg3MTAsMS4wMDAwMDBdLFxuICAgIFsxNi45MTQ0MDUsOS44MTg1MjAsNDcuNjc1MzEwLDEuMDAwMDAwXSxcbiAgICBbMTguMjE0Mzk1LDEwLjI3NDk3MCw1MC4wNzAyNzAsMS4wMDAwMDBdLFxuICAgIFsxOS41NDI0MzUsMTAuNjg1Nzc1LDUyLjQ3ODc0NSwxLjAwMDAwMF0sXG4gICAgWzIwLjkwMDMxMCwxMS4wNDg2NDAsNTQuODk4Njk1LDEuMDAwMDAwXSxcbiAgICBbMjIuMjg5ODA1LDExLjM2MTc4MCw1Ny4zMjczMTUsMS4wMDAwMDBdLFxuICAgIFsyMy43MTI0NTAsMTEuNjIzNjY1LDU5Ljc2MTI5MCwxLjAwMDAwMF0sXG4gICAgWzI1LjE2OTAxMCwxMS44MzI1MTAsNjIuMTk1NTIwLDEuMDAwMDAwXSxcbiAgICBbMjYuNjYwNTA1LDExLjk4NzA0MCw2NC42MjQ2NTAsMS4wMDAwMDBdLFxuICAgIFsyOC4xODY2ODAsMTIuMDg2NzQ1LDY3LjA0MjU2MCwxLjAwMDAwMF0sXG4gICAgWzI5Ljc0NzI4MCwxMi4xMzEzNzAsNjkuNDQxODU1LDEuMDAwMDAwXSxcbiAgICBbMzEuMzQxNTQwLDEyLjEyMTY4MCw3MS44MTQxMjAsMS4wMDAwMDBdLFxuICAgIFszMi45Njc2NzUsMTIuMDU5NzE1LDc0LjE1MDk0MCwxLjAwMDAwMF0sXG4gICAgWzM0LjYyMzM5MCwxMS45NDgyODAsNzYuNDQyODgwLDEuMDAwMDAwXSxcbiAgICBbMzYuMzA2MzkwLDExLjc5MTcxMCw3OC42ODEwMTUsMS4wMDAwMDBdLFxuICAgIFszOC4wMTM2MTUsMTEuNTk0MzQwLDgwLjg1NjY3NSwxLjAwMDAwMF0sXG4gICAgWzM5Ljc0MTc1MCwxMS4zNjI1NDUsODIuOTYxMTkwLDEuMDAwMDAwXSxcbiAgICBbNDEuNDg1Njk1LDExLjEwNjI3MCw4NC45ODU2MzUsMS4wMDAwMDBdLFxuICAgIFs0My4yNDE2MjUsMTAuODM0Njk1LDg2LjkyMjg3MCwxLjAwMDAwMF0sXG4gICAgWzQ1LjAwNTcxNSwxMC41NTc1MTAsODguNzY4MzA1LDEuMDAwMDAwXSxcbiAgICBbNDYuNzc0Mzk1LDEwLjI4Mzg5NSw5MC41MTc2MDUsMS4wMDAwMDBdLFxuICAgIFs0OC41NDM1ODUsMTAuMDIzNzk1LDkyLjE2ODk4NSwxLjAwMDAwMF0sXG4gICAgWzUwLjMxMDczNSw5Ljc5MjAwMCw5My43MjE0MjUsMS4wMDAwMDBdLFxuICAgIFs1Mi4wNzMyOTUsOS41OTYxNjAsOTUuMTc1NjkwLDEuMDAwMDAwXSxcbiAgICBbNTMuODI5MjI1LDkuNDQyNjUwLDk2LjUzMzU2NSwxLjAwMDAwMF0sXG4gICAgWzU1LjU3Njk5NSw5LjMzNjgyNSw5Ny43OTgxMTAsMS4wMDAwMDBdLFxuICAgIFs1Ny4zMTQ1NjUsOS4yODMyNzUsOTguOTcyODk1LDEuMDAwMDAwXSxcbiAgICBbNTkuMDQyMTkwLDkuMjgzMjc1LDEwMC4wNjIwMDAsMS4wMDAwMDBdLFxuICAgIFs2MC43NTk2MTUsOS4zMzgzNTUsMTAxLjA3MDAxNSwxLjAwMDAwMF0sXG4gICAgWzYyLjQ2NjU4NSw5LjQ0OTAyNSwxMDIuMDAxNzg1LDEuMDAwMDAwXSxcbiAgICBbNjQuMTYzMTAwLDkuNjE0Nzc1LDEwMi44NjEzOTAsMS4wMDAwMDBdLFxuICAgIFs2NS44NDk2NzAsOS44MzU2MDUsMTAzLjY1MzY3NSwxLjAwMDAwMF0sXG4gICAgWzY3LjUyNjU1MCwxMC4xMDk5ODUsMTA0LjM4Mjk3NSwxLjAwMDAwMF0sXG4gICAgWzY5LjE5MzQ4NSwxMC40MzUxMTAsMTA1LjA1Mzg4MCwxLjAwMDAwMF0sXG4gICAgWzcwLjg1MTc1MCwxMC44MDAwMTUsMTA1LjY2OTk2MCwxLjAwMDAwMF0sXG4gICAgWzcyLjUwMTg1NSwxMS4yMDI5MTUsMTA2LjIzNTA0MCwxLjAwMDAwMF0sXG4gICAgWzc0LjE0NDU2NSwxMS42MzkyMjAsMTA2Ljc1MjQzNSwxLjAwMDAwMF0sXG4gICAgWzc1Ljc4MDM5MCwxMi4xMDQ4NTAsMTA3LjIyNTIwNSwxLjAwMDAwMF0sXG4gICAgWzc3LjQwOTg0MCwxMi41OTU5ODAsMTA3LjY1NjQxMCwxLjAwMDAwMF0sXG4gICAgWzc5LjAzMzQyNSwxMy4xMDg3ODUsMTA4LjA0ODg1NSwxLjAwMDAwMF0sXG4gICAgWzgwLjY1MTkxMCwxMy42Mzk5NTAsMTA4LjQwNDU4MCwxLjAwMDAwMF0sXG4gICAgWzgyLjI2NTU1MCwxNC4xODY2NzAsMTA4LjcyNjEzNSwxLjAwMDAwMF0sXG4gICAgWzgzLjg3NDg1NSwxNC43NDU4ODUsMTA5LjAxNTMwNSwxLjAwMDAwMF0sXG4gICAgWzg1LjQ4MDMzNSwxNS4zMTUzMDAsMTA5LjI3MzYyMCwxLjAwMDAwMF0sXG4gICAgWzg3LjA4MjUwMCwxNS44OTI4NzUsMTA5LjUwMzM3NSwxLjAwMDAwMF0sXG4gICAgWzg4LjY4MTYwNSwxNi40NzcwODAsMTA5LjcwNTMzNSwxLjAwMDAwMF0sXG4gICAgWzkwLjI3ODE2MCwxNy4wNjU4NzUsMTA5Ljg4MTAzMCwxLjAwMDAwMF0sXG4gICAgWzkxLjg3MjQyMCwxNy42NTc5ODUsMTEwLjAzMTczNSwxLjAwMDAwMF0sXG4gICAgWzkzLjQ2NDg5NSwxOC4yNTI2NDUsMTEwLjE1ODQ3MCwxLjAwMDAwMF0sXG4gICAgWzk1LjA1NTg0MCwxOC44NDgzMjUsMTEwLjI2MjAwMCwxLjAwMDAwMF0sXG4gICAgWzk2LjY0NTI1NSwxOS40NDQ1MTUsMTEwLjM0MzM0NSwxLjAwMDAwMF0sXG4gICAgWzk4LjIzMzE0MCwyMC4wNDA3MDUsMTEwLjQwMzUyNSwxLjAwMDAwMF0sXG4gICAgWzk5LjgyMDUxNSwyMC42MzYzODUsMTEwLjQ0Mjc5NSwxLjAwMDAwMF0sXG4gICAgWzEwMS40MDY4NzAsMjEuMjMwNTM1LDExMC40NjE2NjUsMS4wMDAwMDBdLFxuICAgIFsxMDIuOTkyOTcwLDIxLjgyMjkwMCwxMTAuNDYwNjQ1LDEuMDAwMDAwXSxcbiAgICBbMTA0LjU3ODgxNSwyMi40MTM0ODAsMTEwLjQzOTk5MCwxLjAwMDAwMF0sXG4gICAgWzEwNi4xNjQ0MDUsMjMuMDAxNzY1LDExMC40MDA0NjUsMS4wMDAwMDBdLFxuICAgIFsxMDcuNzQ5OTk1LDIzLjU4Nzc1NSwxMTAuMzQyMDcwLDEuMDAwMDAwXSxcbiAgICBbMTA5LjMzNTg0MCwyNC4xNzE0NTAsMTEwLjI2NTA2MCwxLjAwMDAwMF0sXG4gICAgWzExMC45MjE2ODUsMjQuNzUyNTk1LDExMC4xNjk5NDUsMS4wMDAwMDBdLFxuICAgIFsxMTIuNTA3Nzg1LDI1LjMzMTE5MCwxMTAuMDU2NDcwLDEuMDAwMDAwXSxcbiAgICBbMTE0LjA5NDE0MCwyNS45MDcyMzUsMTA5LjkyNTQwMCwxLjAwMDAwMF0sXG4gICAgWzExNS42ODEwMDUsMjYuNDgxMjQwLDEwOS43NzY5OTAsMS4wMDAwMDBdLFxuICAgIFsxMTcuMjY4MTI1LDI3LjA1MjY5NSwxMDkuNjEwNzMwLDEuMDAwMDAwXSxcbiAgICBbMTE4Ljg1NTUwMCwyNy42MjIxMTAsMTA5LjQyNjg3NSwxLjAwMDAwMF0sXG4gICAgWzEyMC40NDM2NDAsMjguMTg5NDg1LDEwOS4yMjUxNzAsMS4wMDAwMDBdLFxuICAgIFsxMjIuMDMyMjkwLDI4Ljc1NDgyMCwxMDkuMDA2MTI1LDEuMDAwMDAwXSxcbiAgICBbMTIzLjYyMTE5NSwyOS4zMTgzNzAsMTA4Ljc2OTc0MCwxLjAwMDAwMF0sXG4gICAgWzEyNS4yMTA2MTAsMjkuODgwNjQ1LDEwOC41MTU3NjAsMS4wMDAwMDBdLFxuICAgIFsxMjYuODAwNTM1LDMwLjQ0MTY0NSwxMDguMjQ0NDQwLDEuMDAwMDAwXSxcbiAgICBbMTI4LjM5MDcxNSwzMS4wMDE2MjUsMTA3Ljk1NTc4MCwxLjAwMDAwMF0sXG4gICAgWzEyOS45ODExNTAsMzEuNTYxMDk1LDEwNy42NDk3ODAsMS4wMDAwMDBdLFxuICAgIFsxMzEuNTcxNTg1LDMyLjExOTgwMCwxMDcuMzI2MTg1LDEuMDAwMDAwXSxcbiAgICBbMTMzLjE2MjUzMCwzMi42NzgyNTAsMTA2Ljk4NDk5NSwxLjAwMDAwMF0sXG4gICAgWzEzNC43NTMyMjAsMzMuMjM2OTU1LDEwNi42MjYyMTAsMS4wMDAwMDBdLFxuICAgIFsxMzYuMzQ0MTY1LDMzLjc5NjE3MCwxMDYuMjUwMDg1LDEuMDAwMDAwXSxcbiAgICBbMTM3LjkzNDYwMCwzNC4zNTU4OTUsMTA1Ljg1NjM2NSwxLjAwMDAwMF0sXG4gICAgWzEzOS41MjUwMzUsMzQuOTE2ODk1LDEwNS40NDUzMDUsMS4wMDAwMDBdLFxuICAgIFsxNDEuMTE0OTYwLDM1LjQ3OTE3MCwxMDUuMDE2Mzk1LDEuMDAwMDAwXSxcbiAgICBbMTQyLjcwNDEyMCwzNi4wNDMyMzAsMTA0LjU2OTg5MCwxLjAwMDAwMF0sXG4gICAgWzE0NC4yOTI3NzAsMzYuNjA5NTg1LDEwNC4xMDU3OTAsMS4wMDAwMDBdLFxuICAgIFsxNDUuODgwNjU1LDM3LjE3ODIzNSwxMDMuNjI0MDk1LDEuMDAwMDAwXSxcbiAgICBbMTQ3LjQ2NzUyMCwzNy43NDk5NDUsMTAzLjEyNDgwNSwxLjAwMDAwMF0sXG4gICAgWzE0OS4wNTI4NTUsMzguMzI0OTcwLDEwMi42MDgxNzUsMS4wMDAwMDBdLFxuICAgIFsxNTAuNjM3MTcwLDM4LjkwMzU2NSwxMDIuMDczOTUwLDEuMDAwMDAwXSxcbiAgICBbMTUyLjIxOTcwMCwzOS40ODYyNDAsMTAxLjUyMTg3NSwxLjAwMDAwMF0sXG4gICAgWzE1My44MDA0NDUsNDAuMDczNTA1LDEwMC45NTIyMDUsMS4wMDAwMDBdLFxuICAgIFsxNTUuMzc5MTUwLDQwLjY2NTg3MCwxMDAuMzY1MTk1LDEuMDAwMDAwXSxcbiAgICBbMTU2Ljk1NTgxNSw0MS4yNjMzMzUsOTkuNzYwODQ1LDEuMDAwMDAwXSxcbiAgICBbMTU4LjUyOTY3NSw0MS44NjY5MjAsOTkuMTM5MTU1LDEuMDAwMDAwXSxcbiAgICBbMTYwLjEwMDk4NSw0Mi40NzY2MjUsOTguNTAwMzgwLDEuMDAwMDAwXSxcbiAgICBbMTYxLjY2OTQ5MCw0My4wOTI5NjAsOTcuODQ0NTIwLDEuMDAwMDAwXSxcbiAgICBbMTYzLjIzNDQyNSw0My43MTY2OTAsOTcuMTcxNTc1LDEuMDAwMDAwXSxcbiAgICBbMTY0Ljc5NjMwMCw0NC4zNDgwNzAsOTYuNDgxNTQ1LDEuMDAwMDAwXSxcbiAgICBbMTY2LjM1NDA5NSw0NC45ODczNTUsOTUuNzc0NDMwLDEuMDAwMDAwXSxcbiAgICBbMTY3LjkwODA2NSw0NS42MzUzMTAsOTUuMDUwNzQwLDEuMDAwMDAwXSxcbiAgICBbMTY5LjQ1NzcwMCw0Ni4yOTI0NDUsOTQuMzEwNzMwLDEuMDAwMDAwXSxcbiAgICBbMTcxLjAwMjc0NSw0Ni45NTkwMTUsOTMuNTU0MTQ1LDEuMDAwMDAwXSxcbiAgICBbMTcyLjU0MjY5MCw0Ny42MzU3ODUsOTIuNzgxNDk1LDEuMDAwMDAwXSxcbiAgICBbMTc0LjA3NzI4MCw0OC4zMjI3NTUsOTEuOTkzMDM1LDEuMDAwMDAwXSxcbiAgICBbMTc1LjYwNjUxNSw0OS4wMjA5NDUsOTEuMTg4NzY1LDEuMDAwMDAwXSxcbiAgICBbMTc3LjEyOTg4NSw0OS43MzAzNTUsOTAuMzY4OTQwLDEuMDAwMDAwXSxcbiAgICBbMTc4LjY0Njg4MCw1MC40NTIwMDUsODkuNTMzODE1LDEuMDAwMDAwXSxcbiAgICBbMTgwLjE1NzUwMCw1MS4xODU2NDAsODguNjgzMTM1LDEuMDAwMDAwXSxcbiAgICBbMTgxLjY2MDk4MCw1MS45MzIyODAsODcuODE3NjY1LDEuMDAwMDAwXSxcbiAgICBbMTgzLjE1NzMyMCw1Mi42OTIxODAsODYuOTM3NDA1LDEuMDAwMDAwXSxcbiAgICBbMTg0LjY0NjI2NSw1My40NjU4NTAsODYuMDQzMTIwLDEuMDAwMDAwXSxcbiAgICBbMTg2LjEyNjc5NSw1NC4yNTM1NDUsODUuMTM0NTU1LDEuMDAwMDAwXSxcbiAgICBbMTg3LjU5OTE2NSw1NS4wNTYwMzAsODQuMjEyNDc1LDEuMDAwMDAwXSxcbiAgICBbMTg5LjA2Mjg2NSw1NS44NzM1NjAsODMuMjc2ODgwLDEuMDAwMDAwXSxcbiAgICBbMTkwLjUxNzM4NSw1Ni43MDYzOTAsODIuMzI4MjgwLDEuMDAwMDAwXSxcbiAgICBbMTkxLjk2MjQ3MCw1Ny41NTUwMzAsODEuMzY2Njc1LDEuMDAwMDAwXSxcbiAgICBbMTkzLjM5NzYxMCw1OC40MTk3MzUsODAuMzkyODMwLDEuMDAwMDAwXSxcbiAgICBbMTk0LjgyMjU1MCw1OS4zMDEyNzAsNzkuNDA2NzQ1LDEuMDAwMDAwXSxcbiAgICBbMTk2LjIzNjc4MCw2MC4xOTk2MzUsNzguNDA4Njc1LDEuMDAwMDAwXSxcbiAgICBbMTk3LjY0MDA0NSw2MS4xMTUwODUsNzcuMzk5MTMwLDEuMDAwMDAwXSxcbiAgICBbMTk5LjAzMTgzNSw2Mi4wNDgzODUsNzYuMzc4MzY1LDEuMDAwMDAwXSxcbiAgICBbMjAwLjQxMTg5NSw2Mi45OTkyODAsNzUuMzQ2NjM1LDEuMDAwMDAwXSxcbiAgICBbMjAxLjc3OTcxNSw2My45NjgyODAsNzQuMzA0NDUwLDEuMDAwMDAwXSxcbiAgICBbMjAzLjEzNDc4NSw2NC45NTU2NDAsNzMuMjUyMzIwLDEuMDAwMDAwXSxcbiAgICBbMjA0LjQ3NzEwNSw2NS45NjE4NzAsNzIuMTkwMjQ1LDEuMDAwMDAwXSxcbiAgICBbMjA1LjgwNTkxMCw2Ni45ODY0NjAsNzEuMTE4OTkwLDEuMDAwMDAwXSxcbiAgICBbMjA3LjEyMDk0NSw2OC4wMzA0MzAsNzAuMDM4NTU1LDEuMDAwMDAwXSxcbiAgICBbMjA4LjQyMTk1NSw2OS4wOTMyNzAsNjguOTQ5NDUwLDEuMDAwMDAwXSxcbiAgICBbMjA5LjcwODQzMCw3MC4xNzUyMzUsNjcuODUxNjc1LDEuMDAwMDAwXSxcbiAgICBbMjEwLjk3OTg2MCw3MS4yNzY4MzUsNjYuNzQ2MjUwLDEuMDAwMDAwXSxcbiAgICBbMjEyLjIzNjI0NSw3Mi4zOTc4MTUsNjUuNjMyNjY1LDEuMDAwMDAwXSxcbiAgICBbMjEzLjQ3NzA3NSw3My41MzgxNzUsNjQuNTExOTQwLDEuMDAwMDAwXSxcbiAgICBbMjE0LjcwMjA5NSw3NC42OTc5MTUsNjMuMzgzODIwLDEuMDAwMDAwXSxcbiAgICBbMjE1LjkxMDc5NSw3NS44Nzc1NDUsNjIuMjQ4ODE1LDEuMDAwMDAwXSxcbiAgICBbMjE3LjEwMjkyMCw3Ny4wNzYzMDAsNjEuMTA3MTgwLDEuMDAwMDAwXSxcbiAgICBbMjE4LjI3Nzk2MCw3OC4yOTQ2OTAsNTkuOTU4OTE1LDEuMDAwMDAwXSxcbiAgICBbMjE5LjQzNTkxNSw3OS41MzI0NjAsNTguODA0NTMwLDEuMDAwMDAwXSxcbiAgICBbMjIwLjU3NjUzMCw4MC43ODk2MTAsNTcuNjQ0MDI1LDEuMDAwMDAwXSxcbiAgICBbMjIxLjY5OTI5NSw4Mi4wNjU4ODUsNTYuNDc3OTEwLDEuMDAwMDAwXSxcbiAgICBbMjIyLjgwMzk1NSw4My4zNjEwMzAsNTUuMzA1OTMwLDEuMDAwMDAwXSxcbiAgICBbMjIzLjg5MDI1NSw4NC42NzUzMDAsNTQuMTI4MzQwLDEuMDAwMDAwXSxcbiAgICBbMjI0Ljk1Nzk0MCw4Ni4wMDgxODUsNTIuOTQ1MTQwLDEuMDAwMDAwXSxcbiAgICBbMjI2LjAwNzAxMCw4Ny4zNTk0MzAsNTEuNzU2ODQwLDEuMDAwMDAwXSxcbiAgICBbMjI3LjAzNjk1NSw4OC43MjkwMzUsNTAuNTYyOTMwLDEuMDAwMDAwXSxcbiAgICBbMjI4LjA0Nzc3NSw5MC4xMTY3NDUsNDkuMzYzOTIwLDEuMDAwMDAwXSxcbiAgICBbMjI5LjAzODk2MCw5MS41MjIzMDUsNDguMTU5MzAwLDEuMDAwMDAwXSxcbiAgICBbMjMwLjAxMDc2NSw5Mi45NDU0NjAsNDYuOTQ5NTgwLDEuMDAwMDAwXSxcbiAgICBbMjMwLjk2MjQyNSw5NC4zODU3MDAsNDUuNzM0MjUwLDEuMDAwMDAwXSxcbiAgICBbMjMxLjg5NDQ1MCw5NS44NDMyODAsNDQuNTEzNTY1LDEuMDAwMDAwXSxcbiAgICBbMjMyLjgwNjMzMCw5Ny4zMTcxODAsNDMuMjg3NTI1LDEuMDAwMDAwXSxcbiAgICBbMjMzLjY5NzgxMCw5OC44MDc2NTUsNDIuMDU1NjIwLDEuMDAwMDAwXSxcbiAgICBbMjM0LjU2OTE0NSwxMDAuMzE0MTk1LDQwLjgxNzg1MCwxLjAwMDAwMF0sXG4gICAgWzIzNS40MTk4MjUsMTAxLjgzNjU0NSwzOS41NzQyMTUsMS4wMDAwMDBdLFxuICAgIFsyMzYuMjQ5ODUwLDEwMy4zNzQxOTUsMzguMzI0NDYwLDEuMDAwMDAwXSxcbiAgICBbMjM3LjA1OTIyMCwxMDQuOTI3MTQ1LDM3LjA2ODU4NSwxLjAwMDAwMF0sXG4gICAgWzIzNy44NDc5MzUsMTA2LjQ5NDg4NSwzNS44MDYzMzUsMS4wMDAwMDBdLFxuICAgIFsyMzguNjE1NDg1LDEwOC4wNzY5MDUsMzQuNTM3MjAwLDEuMDAwMDAwXSxcbiAgICBbMjM5LjM2MjEyNSwxMDkuNjczMjA1LDMzLjI2MTY5MCwxLjAwMDAwMF0sXG4gICAgWzI0MC4wODc4NTUsMTExLjI4MzI3NSwzMS45NzkyOTUsMS4wMDAwMDBdLFxuICAgIFsyNDAuNzkyNjc1LDExMi45MDY4NjAsMzAuNjkwMjcwLDEuMDAwMDAwXSxcbiAgICBbMjQxLjQ3NjA3NSwxMTQuNTQzNzA1LDI5LjM5NDM2MCwxLjAwMDAwMF0sXG4gICAgWzI0Mi4xMzgzMTAsMTE2LjE5MzMwMCwyOC4wOTE4MjAsMS4wMDAwMDBdLFxuICAgIFsyNDIuNzc5MTI1LDExNy44NTUzOTAsMjYuNzgyOTA1LDEuMDAwMDAwXSxcbiAgICBbMjQzLjM5OTAzMCwxMTkuNTI5NzIwLDI1LjQ2Nzg3MCwxLjAwMDAwMF0sXG4gICAgWzI0My45OTcyNjAsMTIxLjIxNTc4MCwyNC4xNDcyMjUsMS4wMDAwMDBdLFxuICAgIFsyNDQuNTc0MDcwLDEyMi45MTM1NzAsMjIuODIyMjQ1LDEuMDAwMDAwXSxcbiAgICBbMjQ1LjEyOTcxNSwxMjQuNjIyNTgwLDIxLjQ5MzY5NSwxLjAwMDAwMF0sXG4gICAgWzI0NS42NjM2ODUsMTI2LjM0MjgxMCwyMC4xNjM2MTUsMS4wMDAwMDBdLFxuICAgIFsyNDYuMTc2MjM1LDEyOC4wNzM0OTUsMTguODM0MDQ1LDEuMDAwMDAwXSxcbiAgICBbMjQ2LjY2NzExMCwxMjkuODE0ODkwLDE3LjUwODA0NSwxLjAwMDAwMF0sXG4gICAgWzI0Ny4xMzY1NjUsMTMxLjU2NjIzMCwxNi4xODk0NDAsMS4wMDAwMDBdLFxuICAgIFsyNDcuNTg0MzQ1LDEzMy4zMjc1MTUsMTQuODgzNTg1LDEuMDAwMDAwXSxcbiAgICBbMjQ4LjAxMDQ1MCwxMzUuMDk4NDkwLDEzLjU5NzYyMCwxLjAwMDAwMF0sXG4gICAgWzI0OC40MTQ4ODAsMTM2Ljg3ODkwMCwxMi4zMzk5NjAsMS4wMDAwMDBdLFxuICAgIFsyNDguNzk3NjM1LDEzOC42Njg0OTAsMTEuMTIyNTkwLDEuMDAwMDAwXSxcbiAgICBbMjQ5LjE1ODQ2MCwxNDAuNDY2NzUwLDkuOTU3NzUwLDEuMDAwMDAwXSxcbiAgICBbMjQ5LjQ5NzYxMCwxNDIuMjczOTM1LDguOTA3NDA1LDEuMDAwMDAwXSxcbiAgICBbMjQ5LjgxNDgzMCwxNDQuMDg5NTM1LDguMDA5Mjk1LDEuMDAwMDAwXSxcbiAgICBbMjUwLjExMDEyMCwxNDUuOTEzMjk1LDcuMjY5NTQwLDEuMDAwMDAwXSxcbiAgICBbMjUwLjM4MzIyNSwxNDcuNzQ0OTYwLDYuNjkzNzUwLDEuMDAwMDAwXSxcbiAgICBbMjUwLjYzNDY1NSwxNDkuNTg0NTMwLDYuMjg4NTU1LDEuMDAwMDAwXSxcbiAgICBbMjUwLjg2MzY0NSwxNTEuNDMxNDk1LDYuMDYxMzUwLDEuMDAwMDAwXSxcbiAgICBbMjUxLjA3MDcwNSwxNTMuMjg2MTEwLDYuMDE5NTMwLDEuMDAwMDAwXSxcbiAgICBbMjUxLjI1NTMyNSwxNTUuMTQ3NjEwLDYuMTcxNTEwLDEuMDAwMDAwXSxcbiAgICBbMjUxLjQxNzc2MCwxNTcuMDE2MjUwLDYuNTI1OTYwLDEuMDAwMDAwXSxcbiAgICBbMjUxLjU1ODAxMCwxNTguODkxNzc1LDcuMDkyNTcwLDEuMDAwMDAwXSxcbiAgICBbMjUxLjY3NTgyMCwxNjAuNzczNjc1LDcuODgxNTQwLDEuMDAwMDAwXSxcbiAgICBbMjUxLjc3MDkzNSwxNjIuNjYxOTUwLDguOTAzNTgwLDEuMDAwMDAwXSxcbiAgICBbMjUxLjg0MzYxMCwxNjQuNTU2NjAwLDEwLjE3MDkzMCwxLjAwMDAwMF0sXG4gICAgWzI1MS44OTM4NDUsMTY2LjQ1NzExNSwxMS42MjMxNTUsMS4wMDAwMDBdLFxuICAgIFsyNTEuOTIxMTMwLDE2OC4zNjM3NTAsMTMuMTk2MjUwLDEuMDAwMDAwXSxcbiAgICBbMjUxLjkyNTk3NSwxNzAuMjc1NzQwLDE0Ljg3Mzg5NSwxLjAwMDAwMF0sXG4gICAgWzI1MS45MDc4NzAsMTcyLjE5MzA4NSwxNi42NDA1MzUsMS4wMDAwMDBdLFxuICAgIFsyNTEuODY3MDcwLDE3NC4xMTU3ODUsMTguNDg0Njk1LDEuMDAwMDAwXSxcbiAgICBbMjUxLjgwMzMyMCwxNzYuMDQzMzMwLDIwLjM5NzQ1MCwxLjAwMDAwMF0sXG4gICAgWzI1MS43MTY2MjAsMTc3Ljk3NTcyMCwyMi4zNzE0MDUsMS4wMDAwMDBdLFxuICAgIFsyNTEuNjA2OTcwLDE3OS45MTI3MDAsMjQuNDAxOTcwLDEuMDAwMDAwXSxcbiAgICBbMjUxLjQ3NDYyNSwxODEuODU0MDE1LDI2LjQ4NTA2NSwxLjAwMDAwMF0sXG4gICAgWzI1MS4zMTkzMzAsMTgzLjc5OTQxMCwyOC42MTgzOTUsMS4wMDAwMDBdLFxuICAgIFsyNTEuMTQwNTc1LDE4NS43NDg4ODUsMzAuODAwMTc1LDEuMDAwMDAwXSxcbiAgICBbMjUwLjkzOTEyNSwxODcuNzAyMTg1LDMzLjAyOTM4NSwxLjAwMDAwMF0sXG4gICAgWzI1MC43MTQ5ODAsMTg5LjY1ODI5MCwzNS4zMDU1MTUsMS4wMDAwMDBdLFxuICAgIFsyNTAuNDY4MTQwLDE5MS42MTc3MTAsMzcuNjI5MDc1LDEuMDAwMDAwXSxcbiAgICBbMjUwLjE5OTExNSwxOTMuNTc5NDI1LDQwLjAwMDA2NSwxLjAwMDAwMF0sXG4gICAgWzI0OS45MDgxNjAsMTk1LjU0MzQzNSw0Mi40MjAwMTUsMS4wMDAwMDBdLFxuICAgIFsyNDkuNTk1NTMwLDE5Ny41MDg5NzUsNDQuODg5NDM1LDEuMDAwMDAwXSxcbiAgICBbMjQ5LjI2MTczNSwxOTkuNDc1NzkwLDQ3LjQxMDM2NSwxLjAwMDAwMF0sXG4gICAgWzI0OC45MDc1NDAsMjAxLjQ0MzM3MCw0OS45ODQ1OTAsMS4wMDAwMDBdLFxuICAgIFsyNDguNTMyNjkwLDIwMy40MTE0NjAsNTIuNjE0NjYwLDEuMDAwMDAwXSxcbiAgICBbMjQ4LjEzNzQ0MCwyMDUuMzc5Mjk1LDU1LjMwMzYzNSwxLjAwMDAwMF0sXG4gICAgWzI0Ny43MjQzNDAsMjA3LjM0NjExMCw1OC4wNTI3OTAsMS4wMDAwMDBdLFxuICAgIFsyNDcuMjk0NjY1LDIwOS4zMTAzNzUsNjAuODY0OTMwLDEuMDAwMDAwXSxcbiAgICBbMjQ2Ljg1MDQ1NSwyMTEuMjcxMzI1LDYzLjc0Mjg2MCwxLjAwMDAwMF0sXG4gICAgWzI0Ni4zOTE5NjUsMjEzLjIyODcwNSw2Ni42OTExNzAsMS4wMDAwMDBdLFxuICAgIFsyNDUuOTIwNDcwLDIxNS4xODEyNDAsNjkuNzE0NzA1LDEuMDAwMDAwXSxcbiAgICBbMjQ1LjQ0MTgzNSwyMTcuMTI2MzgwLDcyLjgxNDIzMCwxLjAwMDAwMF0sXG4gICAgWzI0NC45NTk2MzAsMjE5LjA2MjU5NSw3NS45OTI1NTAsMS4wMDAwMDBdLFxuICAgIFsyNDQuNDczNjAwLDIyMC45ODkxMjAsNzkuMjU5MTAwLDEuMDAwMDAwXSxcbiAgICBbMjQzLjk5MjY3MCwyMjIuOTAyODk1LDgyLjYxMzM3MCwxLjAwMDAwMF0sXG4gICAgWzI0My41MjQyMzUsMjI0LjgwMDA5NSw4Ni4wNTYxMjUsMS4wMDAwMDBdLFxuICAgIFsyNDMuMDY5ODI1LDIyNi42ODAyMTAsODkuNTk5MDk1LDEuMDAwMDAwXSxcbiAgICBbMjQyLjY0NDIzMCwyMjguNTM3NjMwLDkzLjIzNDg4NSwxLjAwMDAwMF0sXG4gICAgWzI0Mi4yNTQ1OTAsMjMwLjM2OTI5NSw5Ni45NjkxMDUsMS4wMDAwMDBdLFxuICAgIFsyNDEuOTE0MTY1LDIzMi4xNzA2MTUsMTAwLjc5ODY5NSwxLjAwMDAwMF0sXG4gICAgWzI0MS42MzY0NzAsMjMzLjkzNjc0NSwxMDQuNzE5NTc1LDEuMDAwMDAwXSxcbiAgICBbMjQxLjQzNjI5NSwyMzUuNjYyODQwLDEwOC43MjUxMTUsMS4wMDAwMDBdLFxuICAgIFsyNDEuMzI5OTYwLDIzNy4zNDQwNTUsMTEyLjgwMzU4NSwxLjAwMDAwMF0sXG4gICAgWzI0MS4zMzI3NjUsMjM4Ljk3NTU0NSwxMTYuOTQwOTYwLDEuMDAwMDAwXSxcbiAgICBbMjQxLjQ2MDI2NSwyNDAuNTUzNzQwLDEyMS4xMTczNTAsMS4wMDAwMDBdLFxuICAgIFsyNDEuNzIzOTM1LDI0Mi4wNzYwOTAsMTI1LjMxMzYzMCwxLjAwMDAwMF0sXG4gICAgWzI0Mi4xMzM5NzUsMjQzLjU0MTA2NSwxMjkuNTA0MzAwLDEuMDAwMDAwXSxcbiAgICBbMjQyLjY5MzcwMCwyNDQuOTQ5Njg1LDEzMy42NzE3NjUsMS4wMDAwMDBdLFxuICAgIFsyNDMuNDA0ODk1LDI0Ni4zMDM0ODAsMTM3Ljc5MjA1NSwxLjAwMDAwMF0sXG4gICAgWzI0NC4yNjM0ODAsMjQ3LjYwNTc2NSwxNDEuODUwMTI1LDEuMDAwMDAwXSxcbiAgICBbMjQ1LjI2MjA2MCwyNDguODYwNjIwLDE0NS44NDA4NzUsMS4wMDAwMDBdLFxuICAgIFsyNDYuMzkzNDk1LDI1MC4wNzI4OTAsMTQ5LjczNzUzMCwxLjAwMDAwMF0sXG4gICAgWzI0Ny42NDYzMTAsMjUxLjI0NjkxMCwxNTMuNTQ5MjcwLDEuMDAwMDAwXSxcbiAgICBbMjQ5LjAxMDMwNSwyNTIuMzg3MDE1LDE1Ny4yNzM4MDAsMS4wMDAwMDBdLFxuICAgIFsyNTAuNDc1NTM1LDI1My40OTc3OTUsMTYwLjkwOTMzNSwxLjAwMDAwMF0sXG4gICAgWzI1Mi4wMzIzMTAsMjU0LjU4MjgyMCwxNjQuNDU1NjIwLDEuMDAwMDAwXSxcbiAgXVxufVxuIiwid2luZG93Lk9uY29wcmludCA9IHJlcXVpcmUoJy4vb25jb3ByaW50LmpzJyk7IiwibW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAodGFnLCBhdHRycykge1xuICAgIHZhciBlbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUygnaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnLCB0YWcpO1xuICAgIGZvciAodmFyIGsgaW4gYXR0cnMpIHtcblx0aWYgKGF0dHJzLmhhc093blByb3BlcnR5KGspKSB7XG5cdCAgICBlbC5zZXRBdHRyaWJ1dGUoaywgYXR0cnNba10pO1xuXHR9XG4gICAgfVxuICAgIHJldHVybiBlbDtcbn07IiwiLyoqXG4gKiBAZmlsZW92ZXJ2aWV3IGdsLW1hdHJpeCAtIEhpZ2ggcGVyZm9ybWFuY2UgbWF0cml4IGFuZCB2ZWN0b3Igb3BlcmF0aW9uc1xuICogQGF1dGhvciBCcmFuZG9uIEpvbmVzXG4gKiBAYXV0aG9yIENvbGluIE1hY0tlbnppZSBJVlxuICogQHZlcnNpb24gMi4zLjJcbiAqL1xuXG4vKiBDb3B5cmlnaHQgKGMpIDIwMTUsIEJyYW5kb24gSm9uZXMsIENvbGluIE1hY0tlbnppZSBJVi5cblxuUGVybWlzc2lvbiBpcyBoZXJlYnkgZ3JhbnRlZCwgZnJlZSBvZiBjaGFyZ2UsIHRvIGFueSBwZXJzb24gb2J0YWluaW5nIGEgY29weVxub2YgdGhpcyBzb2Z0d2FyZSBhbmQgYXNzb2NpYXRlZCBkb2N1bWVudGF0aW9uIGZpbGVzICh0aGUgXCJTb2Z0d2FyZVwiKSwgdG8gZGVhbFxuaW4gdGhlIFNvZnR3YXJlIHdpdGhvdXQgcmVzdHJpY3Rpb24sIGluY2x1ZGluZyB3aXRob3V0IGxpbWl0YXRpb24gdGhlIHJpZ2h0c1xudG8gdXNlLCBjb3B5LCBtb2RpZnksIG1lcmdlLCBwdWJsaXNoLCBkaXN0cmlidXRlLCBzdWJsaWNlbnNlLCBhbmQvb3Igc2VsbFxuY29waWVzIG9mIHRoZSBTb2Z0d2FyZSwgYW5kIHRvIHBlcm1pdCBwZXJzb25zIHRvIHdob20gdGhlIFNvZnR3YXJlIGlzXG5mdXJuaXNoZWQgdG8gZG8gc28sIHN1YmplY3QgdG8gdGhlIGZvbGxvd2luZyBjb25kaXRpb25zOlxuXG5UaGUgYWJvdmUgY29weXJpZ2h0IG5vdGljZSBhbmQgdGhpcyBwZXJtaXNzaW9uIG5vdGljZSBzaGFsbCBiZSBpbmNsdWRlZCBpblxuYWxsIGNvcGllcyBvciBzdWJzdGFudGlhbCBwb3J0aW9ucyBvZiB0aGUgU29mdHdhcmUuXG5cblRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCBcIkFTIElTXCIsIFdJVEhPVVQgV0FSUkFOVFkgT0YgQU5ZIEtJTkQsIEVYUFJFU1MgT1JcbklNUExJRUQsIElOQ0xVRElORyBCVVQgTk9UIExJTUlURUQgVE8gVEhFIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZLFxuRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UgQU5EIE5PTklORlJJTkdFTUVOVC4gSU4gTk8gRVZFTlQgU0hBTEwgVEhFXG5BVVRIT1JTIE9SIENPUFlSSUdIVCBIT0xERVJTIEJFIExJQUJMRSBGT1IgQU5ZIENMQUlNLCBEQU1BR0VTIE9SIE9USEVSXG5MSUFCSUxJVFksIFdIRVRIRVIgSU4gQU4gQUNUSU9OIE9GIENPTlRSQUNULCBUT1JUIE9SIE9USEVSV0lTRSwgQVJJU0lORyBGUk9NLFxuT1VUIE9GIE9SIElOIENPTk5FQ1RJT04gV0lUSCBUSEUgU09GVFdBUkUgT1IgVEhFIFVTRSBPUiBPVEhFUiBERUFMSU5HUyBJTlxuVEhFIFNPRlRXQVJFLiAqL1xuLy8gRU5EIEhFQURFUlxuXG5leHBvcnRzLmdsTWF0cml4ID0gcmVxdWlyZShcIi4vZ2wtbWF0cml4L2NvbW1vbi5qc1wiKTtcbmV4cG9ydHMubWF0MiA9IHJlcXVpcmUoXCIuL2dsLW1hdHJpeC9tYXQyLmpzXCIpO1xuZXhwb3J0cy5tYXQyZCA9IHJlcXVpcmUoXCIuL2dsLW1hdHJpeC9tYXQyZC5qc1wiKTtcbmV4cG9ydHMubWF0MyA9IHJlcXVpcmUoXCIuL2dsLW1hdHJpeC9tYXQzLmpzXCIpO1xuZXhwb3J0cy5tYXQ0ID0gcmVxdWlyZShcIi4vZ2wtbWF0cml4L21hdDQuanNcIik7XG5leHBvcnRzLnF1YXQgPSByZXF1aXJlKFwiLi9nbC1tYXRyaXgvcXVhdC5qc1wiKTtcbmV4cG9ydHMudmVjMiA9IHJlcXVpcmUoXCIuL2dsLW1hdHJpeC92ZWMyLmpzXCIpO1xuZXhwb3J0cy52ZWMzID0gcmVxdWlyZShcIi4vZ2wtbWF0cml4L3ZlYzMuanNcIik7XG5leHBvcnRzLnZlYzQgPSByZXF1aXJlKFwiLi9nbC1tYXRyaXgvdmVjNC5qc1wiKTsiLCIvKiBDb3B5cmlnaHQgKGMpIDIwMTUsIEJyYW5kb24gSm9uZXMsIENvbGluIE1hY0tlbnppZSBJVi5cblxuUGVybWlzc2lvbiBpcyBoZXJlYnkgZ3JhbnRlZCwgZnJlZSBvZiBjaGFyZ2UsIHRvIGFueSBwZXJzb24gb2J0YWluaW5nIGEgY29weVxub2YgdGhpcyBzb2Z0d2FyZSBhbmQgYXNzb2NpYXRlZCBkb2N1bWVudGF0aW9uIGZpbGVzICh0aGUgXCJTb2Z0d2FyZVwiKSwgdG8gZGVhbFxuaW4gdGhlIFNvZnR3YXJlIHdpdGhvdXQgcmVzdHJpY3Rpb24sIGluY2x1ZGluZyB3aXRob3V0IGxpbWl0YXRpb24gdGhlIHJpZ2h0c1xudG8gdXNlLCBjb3B5LCBtb2RpZnksIG1lcmdlLCBwdWJsaXNoLCBkaXN0cmlidXRlLCBzdWJsaWNlbnNlLCBhbmQvb3Igc2VsbFxuY29waWVzIG9mIHRoZSBTb2Z0d2FyZSwgYW5kIHRvIHBlcm1pdCBwZXJzb25zIHRvIHdob20gdGhlIFNvZnR3YXJlIGlzXG5mdXJuaXNoZWQgdG8gZG8gc28sIHN1YmplY3QgdG8gdGhlIGZvbGxvd2luZyBjb25kaXRpb25zOlxuXG5UaGUgYWJvdmUgY29weXJpZ2h0IG5vdGljZSBhbmQgdGhpcyBwZXJtaXNzaW9uIG5vdGljZSBzaGFsbCBiZSBpbmNsdWRlZCBpblxuYWxsIGNvcGllcyBvciBzdWJzdGFudGlhbCBwb3J0aW9ucyBvZiB0aGUgU29mdHdhcmUuXG5cblRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCBcIkFTIElTXCIsIFdJVEhPVVQgV0FSUkFOVFkgT0YgQU5ZIEtJTkQsIEVYUFJFU1MgT1JcbklNUExJRUQsIElOQ0xVRElORyBCVVQgTk9UIExJTUlURUQgVE8gVEhFIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZLFxuRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UgQU5EIE5PTklORlJJTkdFTUVOVC4gSU4gTk8gRVZFTlQgU0hBTEwgVEhFXG5BVVRIT1JTIE9SIENPUFlSSUdIVCBIT0xERVJTIEJFIExJQUJMRSBGT1IgQU5ZIENMQUlNLCBEQU1BR0VTIE9SIE9USEVSXG5MSUFCSUxJVFksIFdIRVRIRVIgSU4gQU4gQUNUSU9OIE9GIENPTlRSQUNULCBUT1JUIE9SIE9USEVSV0lTRSwgQVJJU0lORyBGUk9NLFxuT1VUIE9GIE9SIElOIENPTk5FQ1RJT04gV0lUSCBUSEUgU09GVFdBUkUgT1IgVEhFIFVTRSBPUiBPVEhFUiBERUFMSU5HUyBJTlxuVEhFIFNPRlRXQVJFLiAqL1xuXG4vKipcbiAqIEBjbGFzcyBDb21tb24gdXRpbGl0aWVzXG4gKiBAbmFtZSBnbE1hdHJpeFxuICovXG52YXIgZ2xNYXRyaXggPSB7fTtcblxuLy8gQ29uZmlndXJhdGlvbiBDb25zdGFudHNcbmdsTWF0cml4LkVQU0lMT04gPSAwLjAwMDAwMTtcbmdsTWF0cml4LkFSUkFZX1RZUEUgPSAodHlwZW9mIEZsb2F0MzJBcnJheSAhPT0gJ3VuZGVmaW5lZCcpID8gRmxvYXQzMkFycmF5IDogQXJyYXk7XG5nbE1hdHJpeC5SQU5ET00gPSBNYXRoLnJhbmRvbTtcbmdsTWF0cml4LkVOQUJMRV9TSU1EID0gZmFsc2U7XG5cbi8vIENhcGFiaWxpdHkgZGV0ZWN0aW9uXG5nbE1hdHJpeC5TSU1EX0FWQUlMQUJMRSA9IChnbE1hdHJpeC5BUlJBWV9UWVBFID09PSBGbG9hdDMyQXJyYXkpICYmICgnU0lNRCcgaW4gdGhpcyk7XG5nbE1hdHJpeC5VU0VfU0lNRCA9IGdsTWF0cml4LkVOQUJMRV9TSU1EICYmIGdsTWF0cml4LlNJTURfQVZBSUxBQkxFO1xuXG4vKipcbiAqIFNldHMgdGhlIHR5cGUgb2YgYXJyYXkgdXNlZCB3aGVuIGNyZWF0aW5nIG5ldyB2ZWN0b3JzIGFuZCBtYXRyaWNlc1xuICpcbiAqIEBwYXJhbSB7VHlwZX0gdHlwZSBBcnJheSB0eXBlLCBzdWNoIGFzIEZsb2F0MzJBcnJheSBvciBBcnJheVxuICovXG5nbE1hdHJpeC5zZXRNYXRyaXhBcnJheVR5cGUgPSBmdW5jdGlvbih0eXBlKSB7XG4gICAgZ2xNYXRyaXguQVJSQVlfVFlQRSA9IHR5cGU7XG59XG5cbnZhciBkZWdyZWUgPSBNYXRoLlBJIC8gMTgwO1xuXG4vKipcbiogQ29udmVydCBEZWdyZWUgVG8gUmFkaWFuXG4qXG4qIEBwYXJhbSB7TnVtYmVyfSBBbmdsZSBpbiBEZWdyZWVzXG4qL1xuZ2xNYXRyaXgudG9SYWRpYW4gPSBmdW5jdGlvbihhKXtcbiAgICAgcmV0dXJuIGEgKiBkZWdyZWU7XG59XG5cbi8qKlxuICogVGVzdHMgd2hldGhlciBvciBub3QgdGhlIGFyZ3VtZW50cyBoYXZlIGFwcHJveGltYXRlbHkgdGhlIHNhbWUgdmFsdWUsIHdpdGhpbiBhbiBhYnNvbHV0ZVxuICogb3IgcmVsYXRpdmUgdG9sZXJhbmNlIG9mIGdsTWF0cml4LkVQU0lMT04gKGFuIGFic29sdXRlIHRvbGVyYW5jZSBpcyB1c2VkIGZvciB2YWx1ZXMgbGVzcyBcbiAqIHRoYW4gb3IgZXF1YWwgdG8gMS4wLCBhbmQgYSByZWxhdGl2ZSB0b2xlcmFuY2UgaXMgdXNlZCBmb3IgbGFyZ2VyIHZhbHVlcylcbiAqIFxuICogQHBhcmFtIHtOdW1iZXJ9IGEgVGhlIGZpcnN0IG51bWJlciB0byB0ZXN0LlxuICogQHBhcmFtIHtOdW1iZXJ9IGIgVGhlIHNlY29uZCBudW1iZXIgdG8gdGVzdC5cbiAqIEByZXR1cm5zIHtCb29sZWFufSBUcnVlIGlmIHRoZSBudW1iZXJzIGFyZSBhcHByb3hpbWF0ZWx5IGVxdWFsLCBmYWxzZSBvdGhlcndpc2UuXG4gKi9cbmdsTWF0cml4LmVxdWFscyA9IGZ1bmN0aW9uKGEsIGIpIHtcblx0cmV0dXJuIE1hdGguYWJzKGEgLSBiKSA8PSBnbE1hdHJpeC5FUFNJTE9OKk1hdGgubWF4KDEuMCwgTWF0aC5hYnMoYSksIE1hdGguYWJzKGIpKTtcbn1cblxubW9kdWxlLmV4cG9ydHMgPSBnbE1hdHJpeDtcbiIsIi8qIENvcHlyaWdodCAoYykgMjAxNSwgQnJhbmRvbiBKb25lcywgQ29saW4gTWFjS2VuemllIElWLlxuXG5QZXJtaXNzaW9uIGlzIGhlcmVieSBncmFudGVkLCBmcmVlIG9mIGNoYXJnZSwgdG8gYW55IHBlcnNvbiBvYnRhaW5pbmcgYSBjb3B5XG5vZiB0aGlzIHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGRvY3VtZW50YXRpb24gZmlsZXMgKHRoZSBcIlNvZnR3YXJlXCIpLCB0byBkZWFsXG5pbiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbiB0aGUgcmlnaHRzXG50byB1c2UsIGNvcHksIG1vZGlmeSwgbWVyZ2UsIHB1Ymxpc2gsIGRpc3RyaWJ1dGUsIHN1YmxpY2Vuc2UsIGFuZC9vciBzZWxsXG5jb3BpZXMgb2YgdGhlIFNvZnR3YXJlLCBhbmQgdG8gcGVybWl0IHBlcnNvbnMgdG8gd2hvbSB0aGUgU29mdHdhcmUgaXNcbmZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6XG5cblRoZSBhYm92ZSBjb3B5cmlnaHQgbm90aWNlIGFuZCB0aGlzIHBlcm1pc3Npb24gbm90aWNlIHNoYWxsIGJlIGluY2x1ZGVkIGluXG5hbGwgY29waWVzIG9yIHN1YnN0YW50aWFsIHBvcnRpb25zIG9mIHRoZSBTb2Z0d2FyZS5cblxuVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEIFwiQVMgSVNcIiwgV0lUSE9VVCBXQVJSQU5UWSBPRiBBTlkgS0lORCwgRVhQUkVTUyBPUlxuSU1QTElFRCwgSU5DTFVESU5HIEJVVCBOT1QgTElNSVRFRCBUTyBUSEUgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFksXG5GSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQgTk9OSU5GUklOR0VNRU5ULiBJTiBOTyBFVkVOVCBTSEFMTCBUSEVcbkFVVEhPUlMgT1IgQ09QWVJJR0hUIEhPTERFUlMgQkUgTElBQkxFIEZPUiBBTlkgQ0xBSU0sIERBTUFHRVMgT1IgT1RIRVJcbkxJQUJJTElUWSwgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIFRPUlQgT1IgT1RIRVJXSVNFLCBBUklTSU5HIEZST00sXG5PVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SIE9USEVSIERFQUxJTkdTIElOXG5USEUgU09GVFdBUkUuICovXG5cbnZhciBnbE1hdHJpeCA9IHJlcXVpcmUoXCIuL2NvbW1vbi5qc1wiKTtcblxuLyoqXG4gKiBAY2xhc3MgMngyIE1hdHJpeFxuICogQG5hbWUgbWF0MlxuICovXG52YXIgbWF0MiA9IHt9O1xuXG4vKipcbiAqIENyZWF0ZXMgYSBuZXcgaWRlbnRpdHkgbWF0MlxuICpcbiAqIEByZXR1cm5zIHttYXQyfSBhIG5ldyAyeDIgbWF0cml4XG4gKi9cbm1hdDIuY3JlYXRlID0gZnVuY3Rpb24oKSB7XG4gICAgdmFyIG91dCA9IG5ldyBnbE1hdHJpeC5BUlJBWV9UWVBFKDQpO1xuICAgIG91dFswXSA9IDE7XG4gICAgb3V0WzFdID0gMDtcbiAgICBvdXRbMl0gPSAwO1xuICAgIG91dFszXSA9IDE7XG4gICAgcmV0dXJuIG91dDtcbn07XG5cbi8qKlxuICogQ3JlYXRlcyBhIG5ldyBtYXQyIGluaXRpYWxpemVkIHdpdGggdmFsdWVzIGZyb20gYW4gZXhpc3RpbmcgbWF0cml4XG4gKlxuICogQHBhcmFtIHttYXQyfSBhIG1hdHJpeCB0byBjbG9uZVxuICogQHJldHVybnMge21hdDJ9IGEgbmV3IDJ4MiBtYXRyaXhcbiAqL1xubWF0Mi5jbG9uZSA9IGZ1bmN0aW9uKGEpIHtcbiAgICB2YXIgb3V0ID0gbmV3IGdsTWF0cml4LkFSUkFZX1RZUEUoNCk7XG4gICAgb3V0WzBdID0gYVswXTtcbiAgICBvdXRbMV0gPSBhWzFdO1xuICAgIG91dFsyXSA9IGFbMl07XG4gICAgb3V0WzNdID0gYVszXTtcbiAgICByZXR1cm4gb3V0O1xufTtcblxuLyoqXG4gKiBDb3B5IHRoZSB2YWx1ZXMgZnJvbSBvbmUgbWF0MiB0byBhbm90aGVyXG4gKlxuICogQHBhcmFtIHttYXQyfSBvdXQgdGhlIHJlY2VpdmluZyBtYXRyaXhcbiAqIEBwYXJhbSB7bWF0Mn0gYSB0aGUgc291cmNlIG1hdHJpeFxuICogQHJldHVybnMge21hdDJ9IG91dFxuICovXG5tYXQyLmNvcHkgPSBmdW5jdGlvbihvdXQsIGEpIHtcbiAgICBvdXRbMF0gPSBhWzBdO1xuICAgIG91dFsxXSA9IGFbMV07XG4gICAgb3V0WzJdID0gYVsyXTtcbiAgICBvdXRbM10gPSBhWzNdO1xuICAgIHJldHVybiBvdXQ7XG59O1xuXG4vKipcbiAqIFNldCBhIG1hdDIgdG8gdGhlIGlkZW50aXR5IG1hdHJpeFxuICpcbiAqIEBwYXJhbSB7bWF0Mn0gb3V0IHRoZSByZWNlaXZpbmcgbWF0cml4XG4gKiBAcmV0dXJucyB7bWF0Mn0gb3V0XG4gKi9cbm1hdDIuaWRlbnRpdHkgPSBmdW5jdGlvbihvdXQpIHtcbiAgICBvdXRbMF0gPSAxO1xuICAgIG91dFsxXSA9IDA7XG4gICAgb3V0WzJdID0gMDtcbiAgICBvdXRbM10gPSAxO1xuICAgIHJldHVybiBvdXQ7XG59O1xuXG4vKipcbiAqIENyZWF0ZSBhIG5ldyBtYXQyIHdpdGggdGhlIGdpdmVuIHZhbHVlc1xuICpcbiAqIEBwYXJhbSB7TnVtYmVyfSBtMDAgQ29tcG9uZW50IGluIGNvbHVtbiAwLCByb3cgMCBwb3NpdGlvbiAoaW5kZXggMClcbiAqIEBwYXJhbSB7TnVtYmVyfSBtMDEgQ29tcG9uZW50IGluIGNvbHVtbiAwLCByb3cgMSBwb3NpdGlvbiAoaW5kZXggMSlcbiAqIEBwYXJhbSB7TnVtYmVyfSBtMTAgQ29tcG9uZW50IGluIGNvbHVtbiAxLCByb3cgMCBwb3NpdGlvbiAoaW5kZXggMilcbiAqIEBwYXJhbSB7TnVtYmVyfSBtMTEgQ29tcG9uZW50IGluIGNvbHVtbiAxLCByb3cgMSBwb3NpdGlvbiAoaW5kZXggMylcbiAqIEByZXR1cm5zIHttYXQyfSBvdXQgQSBuZXcgMngyIG1hdHJpeFxuICovXG5tYXQyLmZyb21WYWx1ZXMgPSBmdW5jdGlvbihtMDAsIG0wMSwgbTEwLCBtMTEpIHtcbiAgICB2YXIgb3V0ID0gbmV3IGdsTWF0cml4LkFSUkFZX1RZUEUoNCk7XG4gICAgb3V0WzBdID0gbTAwO1xuICAgIG91dFsxXSA9IG0wMTtcbiAgICBvdXRbMl0gPSBtMTA7XG4gICAgb3V0WzNdID0gbTExO1xuICAgIHJldHVybiBvdXQ7XG59O1xuXG4vKipcbiAqIFNldCB0aGUgY29tcG9uZW50cyBvZiBhIG1hdDIgdG8gdGhlIGdpdmVuIHZhbHVlc1xuICpcbiAqIEBwYXJhbSB7bWF0Mn0gb3V0IHRoZSByZWNlaXZpbmcgbWF0cml4XG4gKiBAcGFyYW0ge051bWJlcn0gbTAwIENvbXBvbmVudCBpbiBjb2x1bW4gMCwgcm93IDAgcG9zaXRpb24gKGluZGV4IDApXG4gKiBAcGFyYW0ge051bWJlcn0gbTAxIENvbXBvbmVudCBpbiBjb2x1bW4gMCwgcm93IDEgcG9zaXRpb24gKGluZGV4IDEpXG4gKiBAcGFyYW0ge051bWJlcn0gbTEwIENvbXBvbmVudCBpbiBjb2x1bW4gMSwgcm93IDAgcG9zaXRpb24gKGluZGV4IDIpXG4gKiBAcGFyYW0ge051bWJlcn0gbTExIENvbXBvbmVudCBpbiBjb2x1bW4gMSwgcm93IDEgcG9zaXRpb24gKGluZGV4IDMpXG4gKiBAcmV0dXJucyB7bWF0Mn0gb3V0XG4gKi9cbm1hdDIuc2V0ID0gZnVuY3Rpb24ob3V0LCBtMDAsIG0wMSwgbTEwLCBtMTEpIHtcbiAgICBvdXRbMF0gPSBtMDA7XG4gICAgb3V0WzFdID0gbTAxO1xuICAgIG91dFsyXSA9IG0xMDtcbiAgICBvdXRbM10gPSBtMTE7XG4gICAgcmV0dXJuIG91dDtcbn07XG5cblxuLyoqXG4gKiBUcmFuc3Bvc2UgdGhlIHZhbHVlcyBvZiBhIG1hdDJcbiAqXG4gKiBAcGFyYW0ge21hdDJ9IG91dCB0aGUgcmVjZWl2aW5nIG1hdHJpeFxuICogQHBhcmFtIHttYXQyfSBhIHRoZSBzb3VyY2UgbWF0cml4XG4gKiBAcmV0dXJucyB7bWF0Mn0gb3V0XG4gKi9cbm1hdDIudHJhbnNwb3NlID0gZnVuY3Rpb24ob3V0LCBhKSB7XG4gICAgLy8gSWYgd2UgYXJlIHRyYW5zcG9zaW5nIG91cnNlbHZlcyB3ZSBjYW4gc2tpcCBhIGZldyBzdGVwcyBidXQgaGF2ZSB0byBjYWNoZSBzb21lIHZhbHVlc1xuICAgIGlmIChvdXQgPT09IGEpIHtcbiAgICAgICAgdmFyIGExID0gYVsxXTtcbiAgICAgICAgb3V0WzFdID0gYVsyXTtcbiAgICAgICAgb3V0WzJdID0gYTE7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgb3V0WzBdID0gYVswXTtcbiAgICAgICAgb3V0WzFdID0gYVsyXTtcbiAgICAgICAgb3V0WzJdID0gYVsxXTtcbiAgICAgICAgb3V0WzNdID0gYVszXTtcbiAgICB9XG4gICAgXG4gICAgcmV0dXJuIG91dDtcbn07XG5cbi8qKlxuICogSW52ZXJ0cyBhIG1hdDJcbiAqXG4gKiBAcGFyYW0ge21hdDJ9IG91dCB0aGUgcmVjZWl2aW5nIG1hdHJpeFxuICogQHBhcmFtIHttYXQyfSBhIHRoZSBzb3VyY2UgbWF0cml4XG4gKiBAcmV0dXJucyB7bWF0Mn0gb3V0XG4gKi9cbm1hdDIuaW52ZXJ0ID0gZnVuY3Rpb24ob3V0LCBhKSB7XG4gICAgdmFyIGEwID0gYVswXSwgYTEgPSBhWzFdLCBhMiA9IGFbMl0sIGEzID0gYVszXSxcblxuICAgICAgICAvLyBDYWxjdWxhdGUgdGhlIGRldGVybWluYW50XG4gICAgICAgIGRldCA9IGEwICogYTMgLSBhMiAqIGExO1xuXG4gICAgaWYgKCFkZXQpIHtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIGRldCA9IDEuMCAvIGRldDtcbiAgICBcbiAgICBvdXRbMF0gPSAgYTMgKiBkZXQ7XG4gICAgb3V0WzFdID0gLWExICogZGV0O1xuICAgIG91dFsyXSA9IC1hMiAqIGRldDtcbiAgICBvdXRbM10gPSAgYTAgKiBkZXQ7XG5cbiAgICByZXR1cm4gb3V0O1xufTtcblxuLyoqXG4gKiBDYWxjdWxhdGVzIHRoZSBhZGp1Z2F0ZSBvZiBhIG1hdDJcbiAqXG4gKiBAcGFyYW0ge21hdDJ9IG91dCB0aGUgcmVjZWl2aW5nIG1hdHJpeFxuICogQHBhcmFtIHttYXQyfSBhIHRoZSBzb3VyY2UgbWF0cml4XG4gKiBAcmV0dXJucyB7bWF0Mn0gb3V0XG4gKi9cbm1hdDIuYWRqb2ludCA9IGZ1bmN0aW9uKG91dCwgYSkge1xuICAgIC8vIENhY2hpbmcgdGhpcyB2YWx1ZSBpcyBuZXNzZWNhcnkgaWYgb3V0ID09IGFcbiAgICB2YXIgYTAgPSBhWzBdO1xuICAgIG91dFswXSA9ICBhWzNdO1xuICAgIG91dFsxXSA9IC1hWzFdO1xuICAgIG91dFsyXSA9IC1hWzJdO1xuICAgIG91dFszXSA9ICBhMDtcblxuICAgIHJldHVybiBvdXQ7XG59O1xuXG4vKipcbiAqIENhbGN1bGF0ZXMgdGhlIGRldGVybWluYW50IG9mIGEgbWF0MlxuICpcbiAqIEBwYXJhbSB7bWF0Mn0gYSB0aGUgc291cmNlIG1hdHJpeFxuICogQHJldHVybnMge051bWJlcn0gZGV0ZXJtaW5hbnQgb2YgYVxuICovXG5tYXQyLmRldGVybWluYW50ID0gZnVuY3Rpb24gKGEpIHtcbiAgICByZXR1cm4gYVswXSAqIGFbM10gLSBhWzJdICogYVsxXTtcbn07XG5cbi8qKlxuICogTXVsdGlwbGllcyB0d28gbWF0MidzXG4gKlxuICogQHBhcmFtIHttYXQyfSBvdXQgdGhlIHJlY2VpdmluZyBtYXRyaXhcbiAqIEBwYXJhbSB7bWF0Mn0gYSB0aGUgZmlyc3Qgb3BlcmFuZFxuICogQHBhcmFtIHttYXQyfSBiIHRoZSBzZWNvbmQgb3BlcmFuZFxuICogQHJldHVybnMge21hdDJ9IG91dFxuICovXG5tYXQyLm11bHRpcGx5ID0gZnVuY3Rpb24gKG91dCwgYSwgYikge1xuICAgIHZhciBhMCA9IGFbMF0sIGExID0gYVsxXSwgYTIgPSBhWzJdLCBhMyA9IGFbM107XG4gICAgdmFyIGIwID0gYlswXSwgYjEgPSBiWzFdLCBiMiA9IGJbMl0sIGIzID0gYlszXTtcbiAgICBvdXRbMF0gPSBhMCAqIGIwICsgYTIgKiBiMTtcbiAgICBvdXRbMV0gPSBhMSAqIGIwICsgYTMgKiBiMTtcbiAgICBvdXRbMl0gPSBhMCAqIGIyICsgYTIgKiBiMztcbiAgICBvdXRbM10gPSBhMSAqIGIyICsgYTMgKiBiMztcbiAgICByZXR1cm4gb3V0O1xufTtcblxuLyoqXG4gKiBBbGlhcyBmb3Ige0BsaW5rIG1hdDIubXVsdGlwbHl9XG4gKiBAZnVuY3Rpb25cbiAqL1xubWF0Mi5tdWwgPSBtYXQyLm11bHRpcGx5O1xuXG4vKipcbiAqIFJvdGF0ZXMgYSBtYXQyIGJ5IHRoZSBnaXZlbiBhbmdsZVxuICpcbiAqIEBwYXJhbSB7bWF0Mn0gb3V0IHRoZSByZWNlaXZpbmcgbWF0cml4XG4gKiBAcGFyYW0ge21hdDJ9IGEgdGhlIG1hdHJpeCB0byByb3RhdGVcbiAqIEBwYXJhbSB7TnVtYmVyfSByYWQgdGhlIGFuZ2xlIHRvIHJvdGF0ZSB0aGUgbWF0cml4IGJ5XG4gKiBAcmV0dXJucyB7bWF0Mn0gb3V0XG4gKi9cbm1hdDIucm90YXRlID0gZnVuY3Rpb24gKG91dCwgYSwgcmFkKSB7XG4gICAgdmFyIGEwID0gYVswXSwgYTEgPSBhWzFdLCBhMiA9IGFbMl0sIGEzID0gYVszXSxcbiAgICAgICAgcyA9IE1hdGguc2luKHJhZCksXG4gICAgICAgIGMgPSBNYXRoLmNvcyhyYWQpO1xuICAgIG91dFswXSA9IGEwICogIGMgKyBhMiAqIHM7XG4gICAgb3V0WzFdID0gYTEgKiAgYyArIGEzICogcztcbiAgICBvdXRbMl0gPSBhMCAqIC1zICsgYTIgKiBjO1xuICAgIG91dFszXSA9IGExICogLXMgKyBhMyAqIGM7XG4gICAgcmV0dXJuIG91dDtcbn07XG5cbi8qKlxuICogU2NhbGVzIHRoZSBtYXQyIGJ5IHRoZSBkaW1lbnNpb25zIGluIHRoZSBnaXZlbiB2ZWMyXG4gKlxuICogQHBhcmFtIHttYXQyfSBvdXQgdGhlIHJlY2VpdmluZyBtYXRyaXhcbiAqIEBwYXJhbSB7bWF0Mn0gYSB0aGUgbWF0cml4IHRvIHJvdGF0ZVxuICogQHBhcmFtIHt2ZWMyfSB2IHRoZSB2ZWMyIHRvIHNjYWxlIHRoZSBtYXRyaXggYnlcbiAqIEByZXR1cm5zIHttYXQyfSBvdXRcbiAqKi9cbm1hdDIuc2NhbGUgPSBmdW5jdGlvbihvdXQsIGEsIHYpIHtcbiAgICB2YXIgYTAgPSBhWzBdLCBhMSA9IGFbMV0sIGEyID0gYVsyXSwgYTMgPSBhWzNdLFxuICAgICAgICB2MCA9IHZbMF0sIHYxID0gdlsxXTtcbiAgICBvdXRbMF0gPSBhMCAqIHYwO1xuICAgIG91dFsxXSA9IGExICogdjA7XG4gICAgb3V0WzJdID0gYTIgKiB2MTtcbiAgICBvdXRbM10gPSBhMyAqIHYxO1xuICAgIHJldHVybiBvdXQ7XG59O1xuXG4vKipcbiAqIENyZWF0ZXMgYSBtYXRyaXggZnJvbSBhIGdpdmVuIGFuZ2xlXG4gKiBUaGlzIGlzIGVxdWl2YWxlbnQgdG8gKGJ1dCBtdWNoIGZhc3RlciB0aGFuKTpcbiAqXG4gKiAgICAgbWF0Mi5pZGVudGl0eShkZXN0KTtcbiAqICAgICBtYXQyLnJvdGF0ZShkZXN0LCBkZXN0LCByYWQpO1xuICpcbiAqIEBwYXJhbSB7bWF0Mn0gb3V0IG1hdDIgcmVjZWl2aW5nIG9wZXJhdGlvbiByZXN1bHRcbiAqIEBwYXJhbSB7TnVtYmVyfSByYWQgdGhlIGFuZ2xlIHRvIHJvdGF0ZSB0aGUgbWF0cml4IGJ5XG4gKiBAcmV0dXJucyB7bWF0Mn0gb3V0XG4gKi9cbm1hdDIuZnJvbVJvdGF0aW9uID0gZnVuY3Rpb24ob3V0LCByYWQpIHtcbiAgICB2YXIgcyA9IE1hdGguc2luKHJhZCksXG4gICAgICAgIGMgPSBNYXRoLmNvcyhyYWQpO1xuICAgIG91dFswXSA9IGM7XG4gICAgb3V0WzFdID0gcztcbiAgICBvdXRbMl0gPSAtcztcbiAgICBvdXRbM10gPSBjO1xuICAgIHJldHVybiBvdXQ7XG59XG5cbi8qKlxuICogQ3JlYXRlcyBhIG1hdHJpeCBmcm9tIGEgdmVjdG9yIHNjYWxpbmdcbiAqIFRoaXMgaXMgZXF1aXZhbGVudCB0byAoYnV0IG11Y2ggZmFzdGVyIHRoYW4pOlxuICpcbiAqICAgICBtYXQyLmlkZW50aXR5KGRlc3QpO1xuICogICAgIG1hdDIuc2NhbGUoZGVzdCwgZGVzdCwgdmVjKTtcbiAqXG4gKiBAcGFyYW0ge21hdDJ9IG91dCBtYXQyIHJlY2VpdmluZyBvcGVyYXRpb24gcmVzdWx0XG4gKiBAcGFyYW0ge3ZlYzJ9IHYgU2NhbGluZyB2ZWN0b3JcbiAqIEByZXR1cm5zIHttYXQyfSBvdXRcbiAqL1xubWF0Mi5mcm9tU2NhbGluZyA9IGZ1bmN0aW9uKG91dCwgdikge1xuICAgIG91dFswXSA9IHZbMF07XG4gICAgb3V0WzFdID0gMDtcbiAgICBvdXRbMl0gPSAwO1xuICAgIG91dFszXSA9IHZbMV07XG4gICAgcmV0dXJuIG91dDtcbn1cblxuLyoqXG4gKiBSZXR1cm5zIGEgc3RyaW5nIHJlcHJlc2VudGF0aW9uIG9mIGEgbWF0MlxuICpcbiAqIEBwYXJhbSB7bWF0Mn0gbWF0IG1hdHJpeCB0byByZXByZXNlbnQgYXMgYSBzdHJpbmdcbiAqIEByZXR1cm5zIHtTdHJpbmd9IHN0cmluZyByZXByZXNlbnRhdGlvbiBvZiB0aGUgbWF0cml4XG4gKi9cbm1hdDIuc3RyID0gZnVuY3Rpb24gKGEpIHtcbiAgICByZXR1cm4gJ21hdDIoJyArIGFbMF0gKyAnLCAnICsgYVsxXSArICcsICcgKyBhWzJdICsgJywgJyArIGFbM10gKyAnKSc7XG59O1xuXG4vKipcbiAqIFJldHVybnMgRnJvYmVuaXVzIG5vcm0gb2YgYSBtYXQyXG4gKlxuICogQHBhcmFtIHttYXQyfSBhIHRoZSBtYXRyaXggdG8gY2FsY3VsYXRlIEZyb2Jlbml1cyBub3JtIG9mXG4gKiBAcmV0dXJucyB7TnVtYmVyfSBGcm9iZW5pdXMgbm9ybVxuICovXG5tYXQyLmZyb2IgPSBmdW5jdGlvbiAoYSkge1xuICAgIHJldHVybihNYXRoLnNxcnQoTWF0aC5wb3coYVswXSwgMikgKyBNYXRoLnBvdyhhWzFdLCAyKSArIE1hdGgucG93KGFbMl0sIDIpICsgTWF0aC5wb3coYVszXSwgMikpKVxufTtcblxuLyoqXG4gKiBSZXR1cm5zIEwsIEQgYW5kIFUgbWF0cmljZXMgKExvd2VyIHRyaWFuZ3VsYXIsIERpYWdvbmFsIGFuZCBVcHBlciB0cmlhbmd1bGFyKSBieSBmYWN0b3JpemluZyB0aGUgaW5wdXQgbWF0cml4XG4gKiBAcGFyYW0ge21hdDJ9IEwgdGhlIGxvd2VyIHRyaWFuZ3VsYXIgbWF0cml4IFxuICogQHBhcmFtIHttYXQyfSBEIHRoZSBkaWFnb25hbCBtYXRyaXggXG4gKiBAcGFyYW0ge21hdDJ9IFUgdGhlIHVwcGVyIHRyaWFuZ3VsYXIgbWF0cml4IFxuICogQHBhcmFtIHttYXQyfSBhIHRoZSBpbnB1dCBtYXRyaXggdG8gZmFjdG9yaXplXG4gKi9cblxubWF0Mi5MRFUgPSBmdW5jdGlvbiAoTCwgRCwgVSwgYSkgeyBcbiAgICBMWzJdID0gYVsyXS9hWzBdOyBcbiAgICBVWzBdID0gYVswXTsgXG4gICAgVVsxXSA9IGFbMV07IFxuICAgIFVbM10gPSBhWzNdIC0gTFsyXSAqIFVbMV07IFxuICAgIHJldHVybiBbTCwgRCwgVV07ICAgICAgIFxufTsgXG5cbi8qKlxuICogQWRkcyB0d28gbWF0MidzXG4gKlxuICogQHBhcmFtIHttYXQyfSBvdXQgdGhlIHJlY2VpdmluZyBtYXRyaXhcbiAqIEBwYXJhbSB7bWF0Mn0gYSB0aGUgZmlyc3Qgb3BlcmFuZFxuICogQHBhcmFtIHttYXQyfSBiIHRoZSBzZWNvbmQgb3BlcmFuZFxuICogQHJldHVybnMge21hdDJ9IG91dFxuICovXG5tYXQyLmFkZCA9IGZ1bmN0aW9uKG91dCwgYSwgYikge1xuICAgIG91dFswXSA9IGFbMF0gKyBiWzBdO1xuICAgIG91dFsxXSA9IGFbMV0gKyBiWzFdO1xuICAgIG91dFsyXSA9IGFbMl0gKyBiWzJdO1xuICAgIG91dFszXSA9IGFbM10gKyBiWzNdO1xuICAgIHJldHVybiBvdXQ7XG59O1xuXG4vKipcbiAqIFN1YnRyYWN0cyBtYXRyaXggYiBmcm9tIG1hdHJpeCBhXG4gKlxuICogQHBhcmFtIHttYXQyfSBvdXQgdGhlIHJlY2VpdmluZyBtYXRyaXhcbiAqIEBwYXJhbSB7bWF0Mn0gYSB0aGUgZmlyc3Qgb3BlcmFuZFxuICogQHBhcmFtIHttYXQyfSBiIHRoZSBzZWNvbmQgb3BlcmFuZFxuICogQHJldHVybnMge21hdDJ9IG91dFxuICovXG5tYXQyLnN1YnRyYWN0ID0gZnVuY3Rpb24ob3V0LCBhLCBiKSB7XG4gICAgb3V0WzBdID0gYVswXSAtIGJbMF07XG4gICAgb3V0WzFdID0gYVsxXSAtIGJbMV07XG4gICAgb3V0WzJdID0gYVsyXSAtIGJbMl07XG4gICAgb3V0WzNdID0gYVszXSAtIGJbM107XG4gICAgcmV0dXJuIG91dDtcbn07XG5cbi8qKlxuICogQWxpYXMgZm9yIHtAbGluayBtYXQyLnN1YnRyYWN0fVxuICogQGZ1bmN0aW9uXG4gKi9cbm1hdDIuc3ViID0gbWF0Mi5zdWJ0cmFjdDtcblxuLyoqXG4gKiBSZXR1cm5zIHdoZXRoZXIgb3Igbm90IHRoZSBtYXRyaWNlcyBoYXZlIGV4YWN0bHkgdGhlIHNhbWUgZWxlbWVudHMgaW4gdGhlIHNhbWUgcG9zaXRpb24gKHdoZW4gY29tcGFyZWQgd2l0aCA9PT0pXG4gKlxuICogQHBhcmFtIHttYXQyfSBhIFRoZSBmaXJzdCBtYXRyaXguXG4gKiBAcGFyYW0ge21hdDJ9IGIgVGhlIHNlY29uZCBtYXRyaXguXG4gKiBAcmV0dXJucyB7Qm9vbGVhbn0gVHJ1ZSBpZiB0aGUgbWF0cmljZXMgYXJlIGVxdWFsLCBmYWxzZSBvdGhlcndpc2UuXG4gKi9cbm1hdDIuZXhhY3RFcXVhbHMgPSBmdW5jdGlvbiAoYSwgYikge1xuICAgIHJldHVybiBhWzBdID09PSBiWzBdICYmIGFbMV0gPT09IGJbMV0gJiYgYVsyXSA9PT0gYlsyXSAmJiBhWzNdID09PSBiWzNdO1xufTtcblxuLyoqXG4gKiBSZXR1cm5zIHdoZXRoZXIgb3Igbm90IHRoZSBtYXRyaWNlcyBoYXZlIGFwcHJveGltYXRlbHkgdGhlIHNhbWUgZWxlbWVudHMgaW4gdGhlIHNhbWUgcG9zaXRpb24uXG4gKlxuICogQHBhcmFtIHttYXQyfSBhIFRoZSBmaXJzdCBtYXRyaXguXG4gKiBAcGFyYW0ge21hdDJ9IGIgVGhlIHNlY29uZCBtYXRyaXguXG4gKiBAcmV0dXJucyB7Qm9vbGVhbn0gVHJ1ZSBpZiB0aGUgbWF0cmljZXMgYXJlIGVxdWFsLCBmYWxzZSBvdGhlcndpc2UuXG4gKi9cbm1hdDIuZXF1YWxzID0gZnVuY3Rpb24gKGEsIGIpIHtcbiAgICB2YXIgYTAgPSBhWzBdLCBhMSA9IGFbMV0sIGEyID0gYVsyXSwgYTMgPSBhWzNdO1xuICAgIHZhciBiMCA9IGJbMF0sIGIxID0gYlsxXSwgYjIgPSBiWzJdLCBiMyA9IGJbM107XG4gICAgcmV0dXJuIChNYXRoLmFicyhhMCAtIGIwKSA8PSBnbE1hdHJpeC5FUFNJTE9OKk1hdGgubWF4KDEuMCwgTWF0aC5hYnMoYTApLCBNYXRoLmFicyhiMCkpICYmXG4gICAgICAgICAgICBNYXRoLmFicyhhMSAtIGIxKSA8PSBnbE1hdHJpeC5FUFNJTE9OKk1hdGgubWF4KDEuMCwgTWF0aC5hYnMoYTEpLCBNYXRoLmFicyhiMSkpICYmXG4gICAgICAgICAgICBNYXRoLmFicyhhMiAtIGIyKSA8PSBnbE1hdHJpeC5FUFNJTE9OKk1hdGgubWF4KDEuMCwgTWF0aC5hYnMoYTIpLCBNYXRoLmFicyhiMikpICYmXG4gICAgICAgICAgICBNYXRoLmFicyhhMyAtIGIzKSA8PSBnbE1hdHJpeC5FUFNJTE9OKk1hdGgubWF4KDEuMCwgTWF0aC5hYnMoYTMpLCBNYXRoLmFicyhiMykpKTtcbn07XG5cbi8qKlxuICogTXVsdGlwbHkgZWFjaCBlbGVtZW50IG9mIHRoZSBtYXRyaXggYnkgYSBzY2FsYXIuXG4gKlxuICogQHBhcmFtIHttYXQyfSBvdXQgdGhlIHJlY2VpdmluZyBtYXRyaXhcbiAqIEBwYXJhbSB7bWF0Mn0gYSB0aGUgbWF0cml4IHRvIHNjYWxlXG4gKiBAcGFyYW0ge051bWJlcn0gYiBhbW91bnQgdG8gc2NhbGUgdGhlIG1hdHJpeCdzIGVsZW1lbnRzIGJ5XG4gKiBAcmV0dXJucyB7bWF0Mn0gb3V0XG4gKi9cbm1hdDIubXVsdGlwbHlTY2FsYXIgPSBmdW5jdGlvbihvdXQsIGEsIGIpIHtcbiAgICBvdXRbMF0gPSBhWzBdICogYjtcbiAgICBvdXRbMV0gPSBhWzFdICogYjtcbiAgICBvdXRbMl0gPSBhWzJdICogYjtcbiAgICBvdXRbM10gPSBhWzNdICogYjtcbiAgICByZXR1cm4gb3V0O1xufTtcblxuLyoqXG4gKiBBZGRzIHR3byBtYXQyJ3MgYWZ0ZXIgbXVsdGlwbHlpbmcgZWFjaCBlbGVtZW50IG9mIHRoZSBzZWNvbmQgb3BlcmFuZCBieSBhIHNjYWxhciB2YWx1ZS5cbiAqXG4gKiBAcGFyYW0ge21hdDJ9IG91dCB0aGUgcmVjZWl2aW5nIHZlY3RvclxuICogQHBhcmFtIHttYXQyfSBhIHRoZSBmaXJzdCBvcGVyYW5kXG4gKiBAcGFyYW0ge21hdDJ9IGIgdGhlIHNlY29uZCBvcGVyYW5kXG4gKiBAcGFyYW0ge051bWJlcn0gc2NhbGUgdGhlIGFtb3VudCB0byBzY2FsZSBiJ3MgZWxlbWVudHMgYnkgYmVmb3JlIGFkZGluZ1xuICogQHJldHVybnMge21hdDJ9IG91dFxuICovXG5tYXQyLm11bHRpcGx5U2NhbGFyQW5kQWRkID0gZnVuY3Rpb24ob3V0LCBhLCBiLCBzY2FsZSkge1xuICAgIG91dFswXSA9IGFbMF0gKyAoYlswXSAqIHNjYWxlKTtcbiAgICBvdXRbMV0gPSBhWzFdICsgKGJbMV0gKiBzY2FsZSk7XG4gICAgb3V0WzJdID0gYVsyXSArIChiWzJdICogc2NhbGUpO1xuICAgIG91dFszXSA9IGFbM10gKyAoYlszXSAqIHNjYWxlKTtcbiAgICByZXR1cm4gb3V0O1xufTtcblxubW9kdWxlLmV4cG9ydHMgPSBtYXQyO1xuIiwiLyogQ29weXJpZ2h0IChjKSAyMDE1LCBCcmFuZG9uIEpvbmVzLCBDb2xpbiBNYWNLZW56aWUgSVYuXG5cblBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmluZyBhIGNvcHlcbm9mIHRoaXMgc29mdHdhcmUgYW5kIGFzc29jaWF0ZWQgZG9jdW1lbnRhdGlvbiBmaWxlcyAodGhlIFwiU29mdHdhcmVcIiksIHRvIGRlYWxcbmluIHRoZSBTb2Z0d2FyZSB3aXRob3V0IHJlc3RyaWN0aW9uLCBpbmNsdWRpbmcgd2l0aG91dCBsaW1pdGF0aW9uIHRoZSByaWdodHNcbnRvIHVzZSwgY29weSwgbW9kaWZ5LCBtZXJnZSwgcHVibGlzaCwgZGlzdHJpYnV0ZSwgc3VibGljZW5zZSwgYW5kL29yIHNlbGxcbmNvcGllcyBvZiB0aGUgU29mdHdhcmUsIGFuZCB0byBwZXJtaXQgcGVyc29ucyB0byB3aG9tIHRoZSBTb2Z0d2FyZSBpc1xuZnVybmlzaGVkIHRvIGRvIHNvLCBzdWJqZWN0IHRvIHRoZSBmb2xsb3dpbmcgY29uZGl0aW9uczpcblxuVGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGVybWlzc2lvbiBub3RpY2Ugc2hhbGwgYmUgaW5jbHVkZWQgaW5cbmFsbCBjb3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9ydGlvbnMgb2YgdGhlIFNvZnR3YXJlLlxuXG5USEUgU09GVFdBUkUgSVMgUFJPVklERUQgXCJBUyBJU1wiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTIE9SXG5JTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSxcbkZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORCBOT05JTkZSSU5HRU1FTlQuIElOIE5PIEVWRU5UIFNIQUxMIFRIRVxuQVVUSE9SUyBPUiBDT1BZUklHSFQgSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUlxuTElBQklMSVRZLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgVE9SVCBPUiBPVEhFUldJU0UsIEFSSVNJTkcgRlJPTSxcbk9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFNPRlRXQVJFIE9SIFRIRSBVU0UgT1IgT1RIRVIgREVBTElOR1MgSU5cblRIRSBTT0ZUV0FSRS4gKi9cblxudmFyIGdsTWF0cml4ID0gcmVxdWlyZShcIi4vY29tbW9uLmpzXCIpO1xuXG4vKipcbiAqIEBjbGFzcyAyeDMgTWF0cml4XG4gKiBAbmFtZSBtYXQyZFxuICogXG4gKiBAZGVzY3JpcHRpb24gXG4gKiBBIG1hdDJkIGNvbnRhaW5zIHNpeCBlbGVtZW50cyBkZWZpbmVkIGFzOlxuICogPHByZT5cbiAqIFthLCBjLCB0eCxcbiAqICBiLCBkLCB0eV1cbiAqIDwvcHJlPlxuICogVGhpcyBpcyBhIHNob3J0IGZvcm0gZm9yIHRoZSAzeDMgbWF0cml4OlxuICogPHByZT5cbiAqIFthLCBjLCB0eCxcbiAqICBiLCBkLCB0eSxcbiAqICAwLCAwLCAxXVxuICogPC9wcmU+XG4gKiBUaGUgbGFzdCByb3cgaXMgaWdub3JlZCBzbyB0aGUgYXJyYXkgaXMgc2hvcnRlciBhbmQgb3BlcmF0aW9ucyBhcmUgZmFzdGVyLlxuICovXG52YXIgbWF0MmQgPSB7fTtcblxuLyoqXG4gKiBDcmVhdGVzIGEgbmV3IGlkZW50aXR5IG1hdDJkXG4gKlxuICogQHJldHVybnMge21hdDJkfSBhIG5ldyAyeDMgbWF0cml4XG4gKi9cbm1hdDJkLmNyZWF0ZSA9IGZ1bmN0aW9uKCkge1xuICAgIHZhciBvdXQgPSBuZXcgZ2xNYXRyaXguQVJSQVlfVFlQRSg2KTtcbiAgICBvdXRbMF0gPSAxO1xuICAgIG91dFsxXSA9IDA7XG4gICAgb3V0WzJdID0gMDtcbiAgICBvdXRbM10gPSAxO1xuICAgIG91dFs0XSA9IDA7XG4gICAgb3V0WzVdID0gMDtcbiAgICByZXR1cm4gb3V0O1xufTtcblxuLyoqXG4gKiBDcmVhdGVzIGEgbmV3IG1hdDJkIGluaXRpYWxpemVkIHdpdGggdmFsdWVzIGZyb20gYW4gZXhpc3RpbmcgbWF0cml4XG4gKlxuICogQHBhcmFtIHttYXQyZH0gYSBtYXRyaXggdG8gY2xvbmVcbiAqIEByZXR1cm5zIHttYXQyZH0gYSBuZXcgMngzIG1hdHJpeFxuICovXG5tYXQyZC5jbG9uZSA9IGZ1bmN0aW9uKGEpIHtcbiAgICB2YXIgb3V0ID0gbmV3IGdsTWF0cml4LkFSUkFZX1RZUEUoNik7XG4gICAgb3V0WzBdID0gYVswXTtcbiAgICBvdXRbMV0gPSBhWzFdO1xuICAgIG91dFsyXSA9IGFbMl07XG4gICAgb3V0WzNdID0gYVszXTtcbiAgICBvdXRbNF0gPSBhWzRdO1xuICAgIG91dFs1XSA9IGFbNV07XG4gICAgcmV0dXJuIG91dDtcbn07XG5cbi8qKlxuICogQ29weSB0aGUgdmFsdWVzIGZyb20gb25lIG1hdDJkIHRvIGFub3RoZXJcbiAqXG4gKiBAcGFyYW0ge21hdDJkfSBvdXQgdGhlIHJlY2VpdmluZyBtYXRyaXhcbiAqIEBwYXJhbSB7bWF0MmR9IGEgdGhlIHNvdXJjZSBtYXRyaXhcbiAqIEByZXR1cm5zIHttYXQyZH0gb3V0XG4gKi9cbm1hdDJkLmNvcHkgPSBmdW5jdGlvbihvdXQsIGEpIHtcbiAgICBvdXRbMF0gPSBhWzBdO1xuICAgIG91dFsxXSA9IGFbMV07XG4gICAgb3V0WzJdID0gYVsyXTtcbiAgICBvdXRbM10gPSBhWzNdO1xuICAgIG91dFs0XSA9IGFbNF07XG4gICAgb3V0WzVdID0gYVs1XTtcbiAgICByZXR1cm4gb3V0O1xufTtcblxuLyoqXG4gKiBTZXQgYSBtYXQyZCB0byB0aGUgaWRlbnRpdHkgbWF0cml4XG4gKlxuICogQHBhcmFtIHttYXQyZH0gb3V0IHRoZSByZWNlaXZpbmcgbWF0cml4XG4gKiBAcmV0dXJucyB7bWF0MmR9IG91dFxuICovXG5tYXQyZC5pZGVudGl0eSA9IGZ1bmN0aW9uKG91dCkge1xuICAgIG91dFswXSA9IDE7XG4gICAgb3V0WzFdID0gMDtcbiAgICBvdXRbMl0gPSAwO1xuICAgIG91dFszXSA9IDE7XG4gICAgb3V0WzRdID0gMDtcbiAgICBvdXRbNV0gPSAwO1xuICAgIHJldHVybiBvdXQ7XG59O1xuXG4vKipcbiAqIENyZWF0ZSBhIG5ldyBtYXQyZCB3aXRoIHRoZSBnaXZlbiB2YWx1ZXNcbiAqXG4gKiBAcGFyYW0ge051bWJlcn0gYSBDb21wb25lbnQgQSAoaW5kZXggMClcbiAqIEBwYXJhbSB7TnVtYmVyfSBiIENvbXBvbmVudCBCIChpbmRleCAxKVxuICogQHBhcmFtIHtOdW1iZXJ9IGMgQ29tcG9uZW50IEMgKGluZGV4IDIpXG4gKiBAcGFyYW0ge051bWJlcn0gZCBDb21wb25lbnQgRCAoaW5kZXggMylcbiAqIEBwYXJhbSB7TnVtYmVyfSB0eCBDb21wb25lbnQgVFggKGluZGV4IDQpXG4gKiBAcGFyYW0ge051bWJlcn0gdHkgQ29tcG9uZW50IFRZIChpbmRleCA1KVxuICogQHJldHVybnMge21hdDJkfSBBIG5ldyBtYXQyZFxuICovXG5tYXQyZC5mcm9tVmFsdWVzID0gZnVuY3Rpb24oYSwgYiwgYywgZCwgdHgsIHR5KSB7XG4gICAgdmFyIG91dCA9IG5ldyBnbE1hdHJpeC5BUlJBWV9UWVBFKDYpO1xuICAgIG91dFswXSA9IGE7XG4gICAgb3V0WzFdID0gYjtcbiAgICBvdXRbMl0gPSBjO1xuICAgIG91dFszXSA9IGQ7XG4gICAgb3V0WzRdID0gdHg7XG4gICAgb3V0WzVdID0gdHk7XG4gICAgcmV0dXJuIG91dDtcbn07XG5cbi8qKlxuICogU2V0IHRoZSBjb21wb25lbnRzIG9mIGEgbWF0MmQgdG8gdGhlIGdpdmVuIHZhbHVlc1xuICpcbiAqIEBwYXJhbSB7bWF0MmR9IG91dCB0aGUgcmVjZWl2aW5nIG1hdHJpeFxuICogQHBhcmFtIHtOdW1iZXJ9IGEgQ29tcG9uZW50IEEgKGluZGV4IDApXG4gKiBAcGFyYW0ge051bWJlcn0gYiBDb21wb25lbnQgQiAoaW5kZXggMSlcbiAqIEBwYXJhbSB7TnVtYmVyfSBjIENvbXBvbmVudCBDIChpbmRleCAyKVxuICogQHBhcmFtIHtOdW1iZXJ9IGQgQ29tcG9uZW50IEQgKGluZGV4IDMpXG4gKiBAcGFyYW0ge051bWJlcn0gdHggQ29tcG9uZW50IFRYIChpbmRleCA0KVxuICogQHBhcmFtIHtOdW1iZXJ9IHR5IENvbXBvbmVudCBUWSAoaW5kZXggNSlcbiAqIEByZXR1cm5zIHttYXQyZH0gb3V0XG4gKi9cbm1hdDJkLnNldCA9IGZ1bmN0aW9uKG91dCwgYSwgYiwgYywgZCwgdHgsIHR5KSB7XG4gICAgb3V0WzBdID0gYTtcbiAgICBvdXRbMV0gPSBiO1xuICAgIG91dFsyXSA9IGM7XG4gICAgb3V0WzNdID0gZDtcbiAgICBvdXRbNF0gPSB0eDtcbiAgICBvdXRbNV0gPSB0eTtcbiAgICByZXR1cm4gb3V0O1xufTtcblxuLyoqXG4gKiBJbnZlcnRzIGEgbWF0MmRcbiAqXG4gKiBAcGFyYW0ge21hdDJkfSBvdXQgdGhlIHJlY2VpdmluZyBtYXRyaXhcbiAqIEBwYXJhbSB7bWF0MmR9IGEgdGhlIHNvdXJjZSBtYXRyaXhcbiAqIEByZXR1cm5zIHttYXQyZH0gb3V0XG4gKi9cbm1hdDJkLmludmVydCA9IGZ1bmN0aW9uKG91dCwgYSkge1xuICAgIHZhciBhYSA9IGFbMF0sIGFiID0gYVsxXSwgYWMgPSBhWzJdLCBhZCA9IGFbM10sXG4gICAgICAgIGF0eCA9IGFbNF0sIGF0eSA9IGFbNV07XG5cbiAgICB2YXIgZGV0ID0gYWEgKiBhZCAtIGFiICogYWM7XG4gICAgaWYoIWRldCl7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICBkZXQgPSAxLjAgLyBkZXQ7XG5cbiAgICBvdXRbMF0gPSBhZCAqIGRldDtcbiAgICBvdXRbMV0gPSAtYWIgKiBkZXQ7XG4gICAgb3V0WzJdID0gLWFjICogZGV0O1xuICAgIG91dFszXSA9IGFhICogZGV0O1xuICAgIG91dFs0XSA9IChhYyAqIGF0eSAtIGFkICogYXR4KSAqIGRldDtcbiAgICBvdXRbNV0gPSAoYWIgKiBhdHggLSBhYSAqIGF0eSkgKiBkZXQ7XG4gICAgcmV0dXJuIG91dDtcbn07XG5cbi8qKlxuICogQ2FsY3VsYXRlcyB0aGUgZGV0ZXJtaW5hbnQgb2YgYSBtYXQyZFxuICpcbiAqIEBwYXJhbSB7bWF0MmR9IGEgdGhlIHNvdXJjZSBtYXRyaXhcbiAqIEByZXR1cm5zIHtOdW1iZXJ9IGRldGVybWluYW50IG9mIGFcbiAqL1xubWF0MmQuZGV0ZXJtaW5hbnQgPSBmdW5jdGlvbiAoYSkge1xuICAgIHJldHVybiBhWzBdICogYVszXSAtIGFbMV0gKiBhWzJdO1xufTtcblxuLyoqXG4gKiBNdWx0aXBsaWVzIHR3byBtYXQyZCdzXG4gKlxuICogQHBhcmFtIHttYXQyZH0gb3V0IHRoZSByZWNlaXZpbmcgbWF0cml4XG4gKiBAcGFyYW0ge21hdDJkfSBhIHRoZSBmaXJzdCBvcGVyYW5kXG4gKiBAcGFyYW0ge21hdDJkfSBiIHRoZSBzZWNvbmQgb3BlcmFuZFxuICogQHJldHVybnMge21hdDJkfSBvdXRcbiAqL1xubWF0MmQubXVsdGlwbHkgPSBmdW5jdGlvbiAob3V0LCBhLCBiKSB7XG4gICAgdmFyIGEwID0gYVswXSwgYTEgPSBhWzFdLCBhMiA9IGFbMl0sIGEzID0gYVszXSwgYTQgPSBhWzRdLCBhNSA9IGFbNV0sXG4gICAgICAgIGIwID0gYlswXSwgYjEgPSBiWzFdLCBiMiA9IGJbMl0sIGIzID0gYlszXSwgYjQgPSBiWzRdLCBiNSA9IGJbNV07XG4gICAgb3V0WzBdID0gYTAgKiBiMCArIGEyICogYjE7XG4gICAgb3V0WzFdID0gYTEgKiBiMCArIGEzICogYjE7XG4gICAgb3V0WzJdID0gYTAgKiBiMiArIGEyICogYjM7XG4gICAgb3V0WzNdID0gYTEgKiBiMiArIGEzICogYjM7XG4gICAgb3V0WzRdID0gYTAgKiBiNCArIGEyICogYjUgKyBhNDtcbiAgICBvdXRbNV0gPSBhMSAqIGI0ICsgYTMgKiBiNSArIGE1O1xuICAgIHJldHVybiBvdXQ7XG59O1xuXG4vKipcbiAqIEFsaWFzIGZvciB7QGxpbmsgbWF0MmQubXVsdGlwbHl9XG4gKiBAZnVuY3Rpb25cbiAqL1xubWF0MmQubXVsID0gbWF0MmQubXVsdGlwbHk7XG5cbi8qKlxuICogUm90YXRlcyBhIG1hdDJkIGJ5IHRoZSBnaXZlbiBhbmdsZVxuICpcbiAqIEBwYXJhbSB7bWF0MmR9IG91dCB0aGUgcmVjZWl2aW5nIG1hdHJpeFxuICogQHBhcmFtIHttYXQyZH0gYSB0aGUgbWF0cml4IHRvIHJvdGF0ZVxuICogQHBhcmFtIHtOdW1iZXJ9IHJhZCB0aGUgYW5nbGUgdG8gcm90YXRlIHRoZSBtYXRyaXggYnlcbiAqIEByZXR1cm5zIHttYXQyZH0gb3V0XG4gKi9cbm1hdDJkLnJvdGF0ZSA9IGZ1bmN0aW9uIChvdXQsIGEsIHJhZCkge1xuICAgIHZhciBhMCA9IGFbMF0sIGExID0gYVsxXSwgYTIgPSBhWzJdLCBhMyA9IGFbM10sIGE0ID0gYVs0XSwgYTUgPSBhWzVdLFxuICAgICAgICBzID0gTWF0aC5zaW4ocmFkKSxcbiAgICAgICAgYyA9IE1hdGguY29zKHJhZCk7XG4gICAgb3V0WzBdID0gYTAgKiAgYyArIGEyICogcztcbiAgICBvdXRbMV0gPSBhMSAqICBjICsgYTMgKiBzO1xuICAgIG91dFsyXSA9IGEwICogLXMgKyBhMiAqIGM7XG4gICAgb3V0WzNdID0gYTEgKiAtcyArIGEzICogYztcbiAgICBvdXRbNF0gPSBhNDtcbiAgICBvdXRbNV0gPSBhNTtcbiAgICByZXR1cm4gb3V0O1xufTtcblxuLyoqXG4gKiBTY2FsZXMgdGhlIG1hdDJkIGJ5IHRoZSBkaW1lbnNpb25zIGluIHRoZSBnaXZlbiB2ZWMyXG4gKlxuICogQHBhcmFtIHttYXQyZH0gb3V0IHRoZSByZWNlaXZpbmcgbWF0cml4XG4gKiBAcGFyYW0ge21hdDJkfSBhIHRoZSBtYXRyaXggdG8gdHJhbnNsYXRlXG4gKiBAcGFyYW0ge3ZlYzJ9IHYgdGhlIHZlYzIgdG8gc2NhbGUgdGhlIG1hdHJpeCBieVxuICogQHJldHVybnMge21hdDJkfSBvdXRcbiAqKi9cbm1hdDJkLnNjYWxlID0gZnVuY3Rpb24ob3V0LCBhLCB2KSB7XG4gICAgdmFyIGEwID0gYVswXSwgYTEgPSBhWzFdLCBhMiA9IGFbMl0sIGEzID0gYVszXSwgYTQgPSBhWzRdLCBhNSA9IGFbNV0sXG4gICAgICAgIHYwID0gdlswXSwgdjEgPSB2WzFdO1xuICAgIG91dFswXSA9IGEwICogdjA7XG4gICAgb3V0WzFdID0gYTEgKiB2MDtcbiAgICBvdXRbMl0gPSBhMiAqIHYxO1xuICAgIG91dFszXSA9IGEzICogdjE7XG4gICAgb3V0WzRdID0gYTQ7XG4gICAgb3V0WzVdID0gYTU7XG4gICAgcmV0dXJuIG91dDtcbn07XG5cbi8qKlxuICogVHJhbnNsYXRlcyB0aGUgbWF0MmQgYnkgdGhlIGRpbWVuc2lvbnMgaW4gdGhlIGdpdmVuIHZlYzJcbiAqXG4gKiBAcGFyYW0ge21hdDJkfSBvdXQgdGhlIHJlY2VpdmluZyBtYXRyaXhcbiAqIEBwYXJhbSB7bWF0MmR9IGEgdGhlIG1hdHJpeCB0byB0cmFuc2xhdGVcbiAqIEBwYXJhbSB7dmVjMn0gdiB0aGUgdmVjMiB0byB0cmFuc2xhdGUgdGhlIG1hdHJpeCBieVxuICogQHJldHVybnMge21hdDJkfSBvdXRcbiAqKi9cbm1hdDJkLnRyYW5zbGF0ZSA9IGZ1bmN0aW9uKG91dCwgYSwgdikge1xuICAgIHZhciBhMCA9IGFbMF0sIGExID0gYVsxXSwgYTIgPSBhWzJdLCBhMyA9IGFbM10sIGE0ID0gYVs0XSwgYTUgPSBhWzVdLFxuICAgICAgICB2MCA9IHZbMF0sIHYxID0gdlsxXTtcbiAgICBvdXRbMF0gPSBhMDtcbiAgICBvdXRbMV0gPSBhMTtcbiAgICBvdXRbMl0gPSBhMjtcbiAgICBvdXRbM10gPSBhMztcbiAgICBvdXRbNF0gPSBhMCAqIHYwICsgYTIgKiB2MSArIGE0O1xuICAgIG91dFs1XSA9IGExICogdjAgKyBhMyAqIHYxICsgYTU7XG4gICAgcmV0dXJuIG91dDtcbn07XG5cbi8qKlxuICogQ3JlYXRlcyBhIG1hdHJpeCBmcm9tIGEgZ2l2ZW4gYW5nbGVcbiAqIFRoaXMgaXMgZXF1aXZhbGVudCB0byAoYnV0IG11Y2ggZmFzdGVyIHRoYW4pOlxuICpcbiAqICAgICBtYXQyZC5pZGVudGl0eShkZXN0KTtcbiAqICAgICBtYXQyZC5yb3RhdGUoZGVzdCwgZGVzdCwgcmFkKTtcbiAqXG4gKiBAcGFyYW0ge21hdDJkfSBvdXQgbWF0MmQgcmVjZWl2aW5nIG9wZXJhdGlvbiByZXN1bHRcbiAqIEBwYXJhbSB7TnVtYmVyfSByYWQgdGhlIGFuZ2xlIHRvIHJvdGF0ZSB0aGUgbWF0cml4IGJ5XG4gKiBAcmV0dXJucyB7bWF0MmR9IG91dFxuICovXG5tYXQyZC5mcm9tUm90YXRpb24gPSBmdW5jdGlvbihvdXQsIHJhZCkge1xuICAgIHZhciBzID0gTWF0aC5zaW4ocmFkKSwgYyA9IE1hdGguY29zKHJhZCk7XG4gICAgb3V0WzBdID0gYztcbiAgICBvdXRbMV0gPSBzO1xuICAgIG91dFsyXSA9IC1zO1xuICAgIG91dFszXSA9IGM7XG4gICAgb3V0WzRdID0gMDtcbiAgICBvdXRbNV0gPSAwO1xuICAgIHJldHVybiBvdXQ7XG59XG5cbi8qKlxuICogQ3JlYXRlcyBhIG1hdHJpeCBmcm9tIGEgdmVjdG9yIHNjYWxpbmdcbiAqIFRoaXMgaXMgZXF1aXZhbGVudCB0byAoYnV0IG11Y2ggZmFzdGVyIHRoYW4pOlxuICpcbiAqICAgICBtYXQyZC5pZGVudGl0eShkZXN0KTtcbiAqICAgICBtYXQyZC5zY2FsZShkZXN0LCBkZXN0LCB2ZWMpO1xuICpcbiAqIEBwYXJhbSB7bWF0MmR9IG91dCBtYXQyZCByZWNlaXZpbmcgb3BlcmF0aW9uIHJlc3VsdFxuICogQHBhcmFtIHt2ZWMyfSB2IFNjYWxpbmcgdmVjdG9yXG4gKiBAcmV0dXJucyB7bWF0MmR9IG91dFxuICovXG5tYXQyZC5mcm9tU2NhbGluZyA9IGZ1bmN0aW9uKG91dCwgdikge1xuICAgIG91dFswXSA9IHZbMF07XG4gICAgb3V0WzFdID0gMDtcbiAgICBvdXRbMl0gPSAwO1xuICAgIG91dFszXSA9IHZbMV07XG4gICAgb3V0WzRdID0gMDtcbiAgICBvdXRbNV0gPSAwO1xuICAgIHJldHVybiBvdXQ7XG59XG5cbi8qKlxuICogQ3JlYXRlcyBhIG1hdHJpeCBmcm9tIGEgdmVjdG9yIHRyYW5zbGF0aW9uXG4gKiBUaGlzIGlzIGVxdWl2YWxlbnQgdG8gKGJ1dCBtdWNoIGZhc3RlciB0aGFuKTpcbiAqXG4gKiAgICAgbWF0MmQuaWRlbnRpdHkoZGVzdCk7XG4gKiAgICAgbWF0MmQudHJhbnNsYXRlKGRlc3QsIGRlc3QsIHZlYyk7XG4gKlxuICogQHBhcmFtIHttYXQyZH0gb3V0IG1hdDJkIHJlY2VpdmluZyBvcGVyYXRpb24gcmVzdWx0XG4gKiBAcGFyYW0ge3ZlYzJ9IHYgVHJhbnNsYXRpb24gdmVjdG9yXG4gKiBAcmV0dXJucyB7bWF0MmR9IG91dFxuICovXG5tYXQyZC5mcm9tVHJhbnNsYXRpb24gPSBmdW5jdGlvbihvdXQsIHYpIHtcbiAgICBvdXRbMF0gPSAxO1xuICAgIG91dFsxXSA9IDA7XG4gICAgb3V0WzJdID0gMDtcbiAgICBvdXRbM10gPSAxO1xuICAgIG91dFs0XSA9IHZbMF07XG4gICAgb3V0WzVdID0gdlsxXTtcbiAgICByZXR1cm4gb3V0O1xufVxuXG4vKipcbiAqIFJldHVybnMgYSBzdHJpbmcgcmVwcmVzZW50YXRpb24gb2YgYSBtYXQyZFxuICpcbiAqIEBwYXJhbSB7bWF0MmR9IGEgbWF0cml4IHRvIHJlcHJlc2VudCBhcyBhIHN0cmluZ1xuICogQHJldHVybnMge1N0cmluZ30gc3RyaW5nIHJlcHJlc2VudGF0aW9uIG9mIHRoZSBtYXRyaXhcbiAqL1xubWF0MmQuc3RyID0gZnVuY3Rpb24gKGEpIHtcbiAgICByZXR1cm4gJ21hdDJkKCcgKyBhWzBdICsgJywgJyArIGFbMV0gKyAnLCAnICsgYVsyXSArICcsICcgKyBcbiAgICAgICAgICAgICAgICAgICAgYVszXSArICcsICcgKyBhWzRdICsgJywgJyArIGFbNV0gKyAnKSc7XG59O1xuXG4vKipcbiAqIFJldHVybnMgRnJvYmVuaXVzIG5vcm0gb2YgYSBtYXQyZFxuICpcbiAqIEBwYXJhbSB7bWF0MmR9IGEgdGhlIG1hdHJpeCB0byBjYWxjdWxhdGUgRnJvYmVuaXVzIG5vcm0gb2ZcbiAqIEByZXR1cm5zIHtOdW1iZXJ9IEZyb2Jlbml1cyBub3JtXG4gKi9cbm1hdDJkLmZyb2IgPSBmdW5jdGlvbiAoYSkgeyBcbiAgICByZXR1cm4oTWF0aC5zcXJ0KE1hdGgucG93KGFbMF0sIDIpICsgTWF0aC5wb3coYVsxXSwgMikgKyBNYXRoLnBvdyhhWzJdLCAyKSArIE1hdGgucG93KGFbM10sIDIpICsgTWF0aC5wb3coYVs0XSwgMikgKyBNYXRoLnBvdyhhWzVdLCAyKSArIDEpKVxufTsgXG5cbi8qKlxuICogQWRkcyB0d28gbWF0MmQnc1xuICpcbiAqIEBwYXJhbSB7bWF0MmR9IG91dCB0aGUgcmVjZWl2aW5nIG1hdHJpeFxuICogQHBhcmFtIHttYXQyZH0gYSB0aGUgZmlyc3Qgb3BlcmFuZFxuICogQHBhcmFtIHttYXQyZH0gYiB0aGUgc2Vjb25kIG9wZXJhbmRcbiAqIEByZXR1cm5zIHttYXQyZH0gb3V0XG4gKi9cbm1hdDJkLmFkZCA9IGZ1bmN0aW9uKG91dCwgYSwgYikge1xuICAgIG91dFswXSA9IGFbMF0gKyBiWzBdO1xuICAgIG91dFsxXSA9IGFbMV0gKyBiWzFdO1xuICAgIG91dFsyXSA9IGFbMl0gKyBiWzJdO1xuICAgIG91dFszXSA9IGFbM10gKyBiWzNdO1xuICAgIG91dFs0XSA9IGFbNF0gKyBiWzRdO1xuICAgIG91dFs1XSA9IGFbNV0gKyBiWzVdO1xuICAgIHJldHVybiBvdXQ7XG59O1xuXG4vKipcbiAqIFN1YnRyYWN0cyBtYXRyaXggYiBmcm9tIG1hdHJpeCBhXG4gKlxuICogQHBhcmFtIHttYXQyZH0gb3V0IHRoZSByZWNlaXZpbmcgbWF0cml4XG4gKiBAcGFyYW0ge21hdDJkfSBhIHRoZSBmaXJzdCBvcGVyYW5kXG4gKiBAcGFyYW0ge21hdDJkfSBiIHRoZSBzZWNvbmQgb3BlcmFuZFxuICogQHJldHVybnMge21hdDJkfSBvdXRcbiAqL1xubWF0MmQuc3VidHJhY3QgPSBmdW5jdGlvbihvdXQsIGEsIGIpIHtcbiAgICBvdXRbMF0gPSBhWzBdIC0gYlswXTtcbiAgICBvdXRbMV0gPSBhWzFdIC0gYlsxXTtcbiAgICBvdXRbMl0gPSBhWzJdIC0gYlsyXTtcbiAgICBvdXRbM10gPSBhWzNdIC0gYlszXTtcbiAgICBvdXRbNF0gPSBhWzRdIC0gYls0XTtcbiAgICBvdXRbNV0gPSBhWzVdIC0gYls1XTtcbiAgICByZXR1cm4gb3V0O1xufTtcblxuLyoqXG4gKiBBbGlhcyBmb3Ige0BsaW5rIG1hdDJkLnN1YnRyYWN0fVxuICogQGZ1bmN0aW9uXG4gKi9cbm1hdDJkLnN1YiA9IG1hdDJkLnN1YnRyYWN0O1xuXG4vKipcbiAqIE11bHRpcGx5IGVhY2ggZWxlbWVudCBvZiB0aGUgbWF0cml4IGJ5IGEgc2NhbGFyLlxuICpcbiAqIEBwYXJhbSB7bWF0MmR9IG91dCB0aGUgcmVjZWl2aW5nIG1hdHJpeFxuICogQHBhcmFtIHttYXQyZH0gYSB0aGUgbWF0cml4IHRvIHNjYWxlXG4gKiBAcGFyYW0ge051bWJlcn0gYiBhbW91bnQgdG8gc2NhbGUgdGhlIG1hdHJpeCdzIGVsZW1lbnRzIGJ5XG4gKiBAcmV0dXJucyB7bWF0MmR9IG91dFxuICovXG5tYXQyZC5tdWx0aXBseVNjYWxhciA9IGZ1bmN0aW9uKG91dCwgYSwgYikge1xuICAgIG91dFswXSA9IGFbMF0gKiBiO1xuICAgIG91dFsxXSA9IGFbMV0gKiBiO1xuICAgIG91dFsyXSA9IGFbMl0gKiBiO1xuICAgIG91dFszXSA9IGFbM10gKiBiO1xuICAgIG91dFs0XSA9IGFbNF0gKiBiO1xuICAgIG91dFs1XSA9IGFbNV0gKiBiO1xuICAgIHJldHVybiBvdXQ7XG59O1xuXG4vKipcbiAqIEFkZHMgdHdvIG1hdDJkJ3MgYWZ0ZXIgbXVsdGlwbHlpbmcgZWFjaCBlbGVtZW50IG9mIHRoZSBzZWNvbmQgb3BlcmFuZCBieSBhIHNjYWxhciB2YWx1ZS5cbiAqXG4gKiBAcGFyYW0ge21hdDJkfSBvdXQgdGhlIHJlY2VpdmluZyB2ZWN0b3JcbiAqIEBwYXJhbSB7bWF0MmR9IGEgdGhlIGZpcnN0IG9wZXJhbmRcbiAqIEBwYXJhbSB7bWF0MmR9IGIgdGhlIHNlY29uZCBvcGVyYW5kXG4gKiBAcGFyYW0ge051bWJlcn0gc2NhbGUgdGhlIGFtb3VudCB0byBzY2FsZSBiJ3MgZWxlbWVudHMgYnkgYmVmb3JlIGFkZGluZ1xuICogQHJldHVybnMge21hdDJkfSBvdXRcbiAqL1xubWF0MmQubXVsdGlwbHlTY2FsYXJBbmRBZGQgPSBmdW5jdGlvbihvdXQsIGEsIGIsIHNjYWxlKSB7XG4gICAgb3V0WzBdID0gYVswXSArIChiWzBdICogc2NhbGUpO1xuICAgIG91dFsxXSA9IGFbMV0gKyAoYlsxXSAqIHNjYWxlKTtcbiAgICBvdXRbMl0gPSBhWzJdICsgKGJbMl0gKiBzY2FsZSk7XG4gICAgb3V0WzNdID0gYVszXSArIChiWzNdICogc2NhbGUpO1xuICAgIG91dFs0XSA9IGFbNF0gKyAoYls0XSAqIHNjYWxlKTtcbiAgICBvdXRbNV0gPSBhWzVdICsgKGJbNV0gKiBzY2FsZSk7XG4gICAgcmV0dXJuIG91dDtcbn07XG5cbi8qKlxuICogUmV0dXJucyB3aGV0aGVyIG9yIG5vdCB0aGUgbWF0cmljZXMgaGF2ZSBleGFjdGx5IHRoZSBzYW1lIGVsZW1lbnRzIGluIHRoZSBzYW1lIHBvc2l0aW9uICh3aGVuIGNvbXBhcmVkIHdpdGggPT09KVxuICpcbiAqIEBwYXJhbSB7bWF0MmR9IGEgVGhlIGZpcnN0IG1hdHJpeC5cbiAqIEBwYXJhbSB7bWF0MmR9IGIgVGhlIHNlY29uZCBtYXRyaXguXG4gKiBAcmV0dXJucyB7Qm9vbGVhbn0gVHJ1ZSBpZiB0aGUgbWF0cmljZXMgYXJlIGVxdWFsLCBmYWxzZSBvdGhlcndpc2UuXG4gKi9cbm1hdDJkLmV4YWN0RXF1YWxzID0gZnVuY3Rpb24gKGEsIGIpIHtcbiAgICByZXR1cm4gYVswXSA9PT0gYlswXSAmJiBhWzFdID09PSBiWzFdICYmIGFbMl0gPT09IGJbMl0gJiYgYVszXSA9PT0gYlszXSAmJiBhWzRdID09PSBiWzRdICYmIGFbNV0gPT09IGJbNV07XG59O1xuXG4vKipcbiAqIFJldHVybnMgd2hldGhlciBvciBub3QgdGhlIG1hdHJpY2VzIGhhdmUgYXBwcm94aW1hdGVseSB0aGUgc2FtZSBlbGVtZW50cyBpbiB0aGUgc2FtZSBwb3NpdGlvbi5cbiAqXG4gKiBAcGFyYW0ge21hdDJkfSBhIFRoZSBmaXJzdCBtYXRyaXguXG4gKiBAcGFyYW0ge21hdDJkfSBiIFRoZSBzZWNvbmQgbWF0cml4LlxuICogQHJldHVybnMge0Jvb2xlYW59IFRydWUgaWYgdGhlIG1hdHJpY2VzIGFyZSBlcXVhbCwgZmFsc2Ugb3RoZXJ3aXNlLlxuICovXG5tYXQyZC5lcXVhbHMgPSBmdW5jdGlvbiAoYSwgYikge1xuICAgIHZhciBhMCA9IGFbMF0sIGExID0gYVsxXSwgYTIgPSBhWzJdLCBhMyA9IGFbM10sIGE0ID0gYVs0XSwgYTUgPSBhWzVdO1xuICAgIHZhciBiMCA9IGJbMF0sIGIxID0gYlsxXSwgYjIgPSBiWzJdLCBiMyA9IGJbM10sIGI0ID0gYls0XSwgYjUgPSBiWzVdO1xuICAgIHJldHVybiAoTWF0aC5hYnMoYTAgLSBiMCkgPD0gZ2xNYXRyaXguRVBTSUxPTipNYXRoLm1heCgxLjAsIE1hdGguYWJzKGEwKSwgTWF0aC5hYnMoYjApKSAmJlxuICAgICAgICAgICAgTWF0aC5hYnMoYTEgLSBiMSkgPD0gZ2xNYXRyaXguRVBTSUxPTipNYXRoLm1heCgxLjAsIE1hdGguYWJzKGExKSwgTWF0aC5hYnMoYjEpKSAmJlxuICAgICAgICAgICAgTWF0aC5hYnMoYTIgLSBiMikgPD0gZ2xNYXRyaXguRVBTSUxPTipNYXRoLm1heCgxLjAsIE1hdGguYWJzKGEyKSwgTWF0aC5hYnMoYjIpKSAmJlxuICAgICAgICAgICAgTWF0aC5hYnMoYTMgLSBiMykgPD0gZ2xNYXRyaXguRVBTSUxPTipNYXRoLm1heCgxLjAsIE1hdGguYWJzKGEzKSwgTWF0aC5hYnMoYjMpKSAmJlxuICAgICAgICAgICAgTWF0aC5hYnMoYTQgLSBiNCkgPD0gZ2xNYXRyaXguRVBTSUxPTipNYXRoLm1heCgxLjAsIE1hdGguYWJzKGE0KSwgTWF0aC5hYnMoYjQpKSAmJlxuICAgICAgICAgICAgTWF0aC5hYnMoYTUgLSBiNSkgPD0gZ2xNYXRyaXguRVBTSUxPTipNYXRoLm1heCgxLjAsIE1hdGguYWJzKGE1KSwgTWF0aC5hYnMoYjUpKSk7XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IG1hdDJkO1xuIiwiLyogQ29weXJpZ2h0IChjKSAyMDE1LCBCcmFuZG9uIEpvbmVzLCBDb2xpbiBNYWNLZW56aWUgSVYuXG5cblBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmluZyBhIGNvcHlcbm9mIHRoaXMgc29mdHdhcmUgYW5kIGFzc29jaWF0ZWQgZG9jdW1lbnRhdGlvbiBmaWxlcyAodGhlIFwiU29mdHdhcmVcIiksIHRvIGRlYWxcbmluIHRoZSBTb2Z0d2FyZSB3aXRob3V0IHJlc3RyaWN0aW9uLCBpbmNsdWRpbmcgd2l0aG91dCBsaW1pdGF0aW9uIHRoZSByaWdodHNcbnRvIHVzZSwgY29weSwgbW9kaWZ5LCBtZXJnZSwgcHVibGlzaCwgZGlzdHJpYnV0ZSwgc3VibGljZW5zZSwgYW5kL29yIHNlbGxcbmNvcGllcyBvZiB0aGUgU29mdHdhcmUsIGFuZCB0byBwZXJtaXQgcGVyc29ucyB0byB3aG9tIHRoZSBTb2Z0d2FyZSBpc1xuZnVybmlzaGVkIHRvIGRvIHNvLCBzdWJqZWN0IHRvIHRoZSBmb2xsb3dpbmcgY29uZGl0aW9uczpcblxuVGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGVybWlzc2lvbiBub3RpY2Ugc2hhbGwgYmUgaW5jbHVkZWQgaW5cbmFsbCBjb3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9ydGlvbnMgb2YgdGhlIFNvZnR3YXJlLlxuXG5USEUgU09GVFdBUkUgSVMgUFJPVklERUQgXCJBUyBJU1wiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTIE9SXG5JTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSxcbkZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORCBOT05JTkZSSU5HRU1FTlQuIElOIE5PIEVWRU5UIFNIQUxMIFRIRVxuQVVUSE9SUyBPUiBDT1BZUklHSFQgSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUlxuTElBQklMSVRZLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgVE9SVCBPUiBPVEhFUldJU0UsIEFSSVNJTkcgRlJPTSxcbk9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFNPRlRXQVJFIE9SIFRIRSBVU0UgT1IgT1RIRVIgREVBTElOR1MgSU5cblRIRSBTT0ZUV0FSRS4gKi9cblxudmFyIGdsTWF0cml4ID0gcmVxdWlyZShcIi4vY29tbW9uLmpzXCIpO1xuXG4vKipcbiAqIEBjbGFzcyAzeDMgTWF0cml4XG4gKiBAbmFtZSBtYXQzXG4gKi9cbnZhciBtYXQzID0ge307XG5cbi8qKlxuICogQ3JlYXRlcyBhIG5ldyBpZGVudGl0eSBtYXQzXG4gKlxuICogQHJldHVybnMge21hdDN9IGEgbmV3IDN4MyBtYXRyaXhcbiAqL1xubWF0My5jcmVhdGUgPSBmdW5jdGlvbigpIHtcbiAgICB2YXIgb3V0ID0gbmV3IGdsTWF0cml4LkFSUkFZX1RZUEUoOSk7XG4gICAgb3V0WzBdID0gMTtcbiAgICBvdXRbMV0gPSAwO1xuICAgIG91dFsyXSA9IDA7XG4gICAgb3V0WzNdID0gMDtcbiAgICBvdXRbNF0gPSAxO1xuICAgIG91dFs1XSA9IDA7XG4gICAgb3V0WzZdID0gMDtcbiAgICBvdXRbN10gPSAwO1xuICAgIG91dFs4XSA9IDE7XG4gICAgcmV0dXJuIG91dDtcbn07XG5cbi8qKlxuICogQ29waWVzIHRoZSB1cHBlci1sZWZ0IDN4MyB2YWx1ZXMgaW50byB0aGUgZ2l2ZW4gbWF0My5cbiAqXG4gKiBAcGFyYW0ge21hdDN9IG91dCB0aGUgcmVjZWl2aW5nIDN4MyBtYXRyaXhcbiAqIEBwYXJhbSB7bWF0NH0gYSAgIHRoZSBzb3VyY2UgNHg0IG1hdHJpeFxuICogQHJldHVybnMge21hdDN9IG91dFxuICovXG5tYXQzLmZyb21NYXQ0ID0gZnVuY3Rpb24ob3V0LCBhKSB7XG4gICAgb3V0WzBdID0gYVswXTtcbiAgICBvdXRbMV0gPSBhWzFdO1xuICAgIG91dFsyXSA9IGFbMl07XG4gICAgb3V0WzNdID0gYVs0XTtcbiAgICBvdXRbNF0gPSBhWzVdO1xuICAgIG91dFs1XSA9IGFbNl07XG4gICAgb3V0WzZdID0gYVs4XTtcbiAgICBvdXRbN10gPSBhWzldO1xuICAgIG91dFs4XSA9IGFbMTBdO1xuICAgIHJldHVybiBvdXQ7XG59O1xuXG4vKipcbiAqIENyZWF0ZXMgYSBuZXcgbWF0MyBpbml0aWFsaXplZCB3aXRoIHZhbHVlcyBmcm9tIGFuIGV4aXN0aW5nIG1hdHJpeFxuICpcbiAqIEBwYXJhbSB7bWF0M30gYSBtYXRyaXggdG8gY2xvbmVcbiAqIEByZXR1cm5zIHttYXQzfSBhIG5ldyAzeDMgbWF0cml4XG4gKi9cbm1hdDMuY2xvbmUgPSBmdW5jdGlvbihhKSB7XG4gICAgdmFyIG91dCA9IG5ldyBnbE1hdHJpeC5BUlJBWV9UWVBFKDkpO1xuICAgIG91dFswXSA9IGFbMF07XG4gICAgb3V0WzFdID0gYVsxXTtcbiAgICBvdXRbMl0gPSBhWzJdO1xuICAgIG91dFszXSA9IGFbM107XG4gICAgb3V0WzRdID0gYVs0XTtcbiAgICBvdXRbNV0gPSBhWzVdO1xuICAgIG91dFs2XSA9IGFbNl07XG4gICAgb3V0WzddID0gYVs3XTtcbiAgICBvdXRbOF0gPSBhWzhdO1xuICAgIHJldHVybiBvdXQ7XG59O1xuXG4vKipcbiAqIENvcHkgdGhlIHZhbHVlcyBmcm9tIG9uZSBtYXQzIHRvIGFub3RoZXJcbiAqXG4gKiBAcGFyYW0ge21hdDN9IG91dCB0aGUgcmVjZWl2aW5nIG1hdHJpeFxuICogQHBhcmFtIHttYXQzfSBhIHRoZSBzb3VyY2UgbWF0cml4XG4gKiBAcmV0dXJucyB7bWF0M30gb3V0XG4gKi9cbm1hdDMuY29weSA9IGZ1bmN0aW9uKG91dCwgYSkge1xuICAgIG91dFswXSA9IGFbMF07XG4gICAgb3V0WzFdID0gYVsxXTtcbiAgICBvdXRbMl0gPSBhWzJdO1xuICAgIG91dFszXSA9IGFbM107XG4gICAgb3V0WzRdID0gYVs0XTtcbiAgICBvdXRbNV0gPSBhWzVdO1xuICAgIG91dFs2XSA9IGFbNl07XG4gICAgb3V0WzddID0gYVs3XTtcbiAgICBvdXRbOF0gPSBhWzhdO1xuICAgIHJldHVybiBvdXQ7XG59O1xuXG4vKipcbiAqIENyZWF0ZSBhIG5ldyBtYXQzIHdpdGggdGhlIGdpdmVuIHZhbHVlc1xuICpcbiAqIEBwYXJhbSB7TnVtYmVyfSBtMDAgQ29tcG9uZW50IGluIGNvbHVtbiAwLCByb3cgMCBwb3NpdGlvbiAoaW5kZXggMClcbiAqIEBwYXJhbSB7TnVtYmVyfSBtMDEgQ29tcG9uZW50IGluIGNvbHVtbiAwLCByb3cgMSBwb3NpdGlvbiAoaW5kZXggMSlcbiAqIEBwYXJhbSB7TnVtYmVyfSBtMDIgQ29tcG9uZW50IGluIGNvbHVtbiAwLCByb3cgMiBwb3NpdGlvbiAoaW5kZXggMilcbiAqIEBwYXJhbSB7TnVtYmVyfSBtMTAgQ29tcG9uZW50IGluIGNvbHVtbiAxLCByb3cgMCBwb3NpdGlvbiAoaW5kZXggMylcbiAqIEBwYXJhbSB7TnVtYmVyfSBtMTEgQ29tcG9uZW50IGluIGNvbHVtbiAxLCByb3cgMSBwb3NpdGlvbiAoaW5kZXggNClcbiAqIEBwYXJhbSB7TnVtYmVyfSBtMTIgQ29tcG9uZW50IGluIGNvbHVtbiAxLCByb3cgMiBwb3NpdGlvbiAoaW5kZXggNSlcbiAqIEBwYXJhbSB7TnVtYmVyfSBtMjAgQ29tcG9uZW50IGluIGNvbHVtbiAyLCByb3cgMCBwb3NpdGlvbiAoaW5kZXggNilcbiAqIEBwYXJhbSB7TnVtYmVyfSBtMjEgQ29tcG9uZW50IGluIGNvbHVtbiAyLCByb3cgMSBwb3NpdGlvbiAoaW5kZXggNylcbiAqIEBwYXJhbSB7TnVtYmVyfSBtMjIgQ29tcG9uZW50IGluIGNvbHVtbiAyLCByb3cgMiBwb3NpdGlvbiAoaW5kZXggOClcbiAqIEByZXR1cm5zIHttYXQzfSBBIG5ldyBtYXQzXG4gKi9cbm1hdDMuZnJvbVZhbHVlcyA9IGZ1bmN0aW9uKG0wMCwgbTAxLCBtMDIsIG0xMCwgbTExLCBtMTIsIG0yMCwgbTIxLCBtMjIpIHtcbiAgICB2YXIgb3V0ID0gbmV3IGdsTWF0cml4LkFSUkFZX1RZUEUoOSk7XG4gICAgb3V0WzBdID0gbTAwO1xuICAgIG91dFsxXSA9IG0wMTtcbiAgICBvdXRbMl0gPSBtMDI7XG4gICAgb3V0WzNdID0gbTEwO1xuICAgIG91dFs0XSA9IG0xMTtcbiAgICBvdXRbNV0gPSBtMTI7XG4gICAgb3V0WzZdID0gbTIwO1xuICAgIG91dFs3XSA9IG0yMTtcbiAgICBvdXRbOF0gPSBtMjI7XG4gICAgcmV0dXJuIG91dDtcbn07XG5cbi8qKlxuICogU2V0IHRoZSBjb21wb25lbnRzIG9mIGEgbWF0MyB0byB0aGUgZ2l2ZW4gdmFsdWVzXG4gKlxuICogQHBhcmFtIHttYXQzfSBvdXQgdGhlIHJlY2VpdmluZyBtYXRyaXhcbiAqIEBwYXJhbSB7TnVtYmVyfSBtMDAgQ29tcG9uZW50IGluIGNvbHVtbiAwLCByb3cgMCBwb3NpdGlvbiAoaW5kZXggMClcbiAqIEBwYXJhbSB7TnVtYmVyfSBtMDEgQ29tcG9uZW50IGluIGNvbHVtbiAwLCByb3cgMSBwb3NpdGlvbiAoaW5kZXggMSlcbiAqIEBwYXJhbSB7TnVtYmVyfSBtMDIgQ29tcG9uZW50IGluIGNvbHVtbiAwLCByb3cgMiBwb3NpdGlvbiAoaW5kZXggMilcbiAqIEBwYXJhbSB7TnVtYmVyfSBtMTAgQ29tcG9uZW50IGluIGNvbHVtbiAxLCByb3cgMCBwb3NpdGlvbiAoaW5kZXggMylcbiAqIEBwYXJhbSB7TnVtYmVyfSBtMTEgQ29tcG9uZW50IGluIGNvbHVtbiAxLCByb3cgMSBwb3NpdGlvbiAoaW5kZXggNClcbiAqIEBwYXJhbSB7TnVtYmVyfSBtMTIgQ29tcG9uZW50IGluIGNvbHVtbiAxLCByb3cgMiBwb3NpdGlvbiAoaW5kZXggNSlcbiAqIEBwYXJhbSB7TnVtYmVyfSBtMjAgQ29tcG9uZW50IGluIGNvbHVtbiAyLCByb3cgMCBwb3NpdGlvbiAoaW5kZXggNilcbiAqIEBwYXJhbSB7TnVtYmVyfSBtMjEgQ29tcG9uZW50IGluIGNvbHVtbiAyLCByb3cgMSBwb3NpdGlvbiAoaW5kZXggNylcbiAqIEBwYXJhbSB7TnVtYmVyfSBtMjIgQ29tcG9uZW50IGluIGNvbHVtbiAyLCByb3cgMiBwb3NpdGlvbiAoaW5kZXggOClcbiAqIEByZXR1cm5zIHttYXQzfSBvdXRcbiAqL1xubWF0My5zZXQgPSBmdW5jdGlvbihvdXQsIG0wMCwgbTAxLCBtMDIsIG0xMCwgbTExLCBtMTIsIG0yMCwgbTIxLCBtMjIpIHtcbiAgICBvdXRbMF0gPSBtMDA7XG4gICAgb3V0WzFdID0gbTAxO1xuICAgIG91dFsyXSA9IG0wMjtcbiAgICBvdXRbM10gPSBtMTA7XG4gICAgb3V0WzRdID0gbTExO1xuICAgIG91dFs1XSA9IG0xMjtcbiAgICBvdXRbNl0gPSBtMjA7XG4gICAgb3V0WzddID0gbTIxO1xuICAgIG91dFs4XSA9IG0yMjtcbiAgICByZXR1cm4gb3V0O1xufTtcblxuLyoqXG4gKiBTZXQgYSBtYXQzIHRvIHRoZSBpZGVudGl0eSBtYXRyaXhcbiAqXG4gKiBAcGFyYW0ge21hdDN9IG91dCB0aGUgcmVjZWl2aW5nIG1hdHJpeFxuICogQHJldHVybnMge21hdDN9IG91dFxuICovXG5tYXQzLmlkZW50aXR5ID0gZnVuY3Rpb24ob3V0KSB7XG4gICAgb3V0WzBdID0gMTtcbiAgICBvdXRbMV0gPSAwO1xuICAgIG91dFsyXSA9IDA7XG4gICAgb3V0WzNdID0gMDtcbiAgICBvdXRbNF0gPSAxO1xuICAgIG91dFs1XSA9IDA7XG4gICAgb3V0WzZdID0gMDtcbiAgICBvdXRbN10gPSAwO1xuICAgIG91dFs4XSA9IDE7XG4gICAgcmV0dXJuIG91dDtcbn07XG5cbi8qKlxuICogVHJhbnNwb3NlIHRoZSB2YWx1ZXMgb2YgYSBtYXQzXG4gKlxuICogQHBhcmFtIHttYXQzfSBvdXQgdGhlIHJlY2VpdmluZyBtYXRyaXhcbiAqIEBwYXJhbSB7bWF0M30gYSB0aGUgc291cmNlIG1hdHJpeFxuICogQHJldHVybnMge21hdDN9IG91dFxuICovXG5tYXQzLnRyYW5zcG9zZSA9IGZ1bmN0aW9uKG91dCwgYSkge1xuICAgIC8vIElmIHdlIGFyZSB0cmFuc3Bvc2luZyBvdXJzZWx2ZXMgd2UgY2FuIHNraXAgYSBmZXcgc3RlcHMgYnV0IGhhdmUgdG8gY2FjaGUgc29tZSB2YWx1ZXNcbiAgICBpZiAob3V0ID09PSBhKSB7XG4gICAgICAgIHZhciBhMDEgPSBhWzFdLCBhMDIgPSBhWzJdLCBhMTIgPSBhWzVdO1xuICAgICAgICBvdXRbMV0gPSBhWzNdO1xuICAgICAgICBvdXRbMl0gPSBhWzZdO1xuICAgICAgICBvdXRbM10gPSBhMDE7XG4gICAgICAgIG91dFs1XSA9IGFbN107XG4gICAgICAgIG91dFs2XSA9IGEwMjtcbiAgICAgICAgb3V0WzddID0gYTEyO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIG91dFswXSA9IGFbMF07XG4gICAgICAgIG91dFsxXSA9IGFbM107XG4gICAgICAgIG91dFsyXSA9IGFbNl07XG4gICAgICAgIG91dFszXSA9IGFbMV07XG4gICAgICAgIG91dFs0XSA9IGFbNF07XG4gICAgICAgIG91dFs1XSA9IGFbN107XG4gICAgICAgIG91dFs2XSA9IGFbMl07XG4gICAgICAgIG91dFs3XSA9IGFbNV07XG4gICAgICAgIG91dFs4XSA9IGFbOF07XG4gICAgfVxuICAgIFxuICAgIHJldHVybiBvdXQ7XG59O1xuXG4vKipcbiAqIEludmVydHMgYSBtYXQzXG4gKlxuICogQHBhcmFtIHttYXQzfSBvdXQgdGhlIHJlY2VpdmluZyBtYXRyaXhcbiAqIEBwYXJhbSB7bWF0M30gYSB0aGUgc291cmNlIG1hdHJpeFxuICogQHJldHVybnMge21hdDN9IG91dFxuICovXG5tYXQzLmludmVydCA9IGZ1bmN0aW9uKG91dCwgYSkge1xuICAgIHZhciBhMDAgPSBhWzBdLCBhMDEgPSBhWzFdLCBhMDIgPSBhWzJdLFxuICAgICAgICBhMTAgPSBhWzNdLCBhMTEgPSBhWzRdLCBhMTIgPSBhWzVdLFxuICAgICAgICBhMjAgPSBhWzZdLCBhMjEgPSBhWzddLCBhMjIgPSBhWzhdLFxuXG4gICAgICAgIGIwMSA9IGEyMiAqIGExMSAtIGExMiAqIGEyMSxcbiAgICAgICAgYjExID0gLWEyMiAqIGExMCArIGExMiAqIGEyMCxcbiAgICAgICAgYjIxID0gYTIxICogYTEwIC0gYTExICogYTIwLFxuXG4gICAgICAgIC8vIENhbGN1bGF0ZSB0aGUgZGV0ZXJtaW5hbnRcbiAgICAgICAgZGV0ID0gYTAwICogYjAxICsgYTAxICogYjExICsgYTAyICogYjIxO1xuXG4gICAgaWYgKCFkZXQpIHsgXG4gICAgICAgIHJldHVybiBudWxsOyBcbiAgICB9XG4gICAgZGV0ID0gMS4wIC8gZGV0O1xuXG4gICAgb3V0WzBdID0gYjAxICogZGV0O1xuICAgIG91dFsxXSA9ICgtYTIyICogYTAxICsgYTAyICogYTIxKSAqIGRldDtcbiAgICBvdXRbMl0gPSAoYTEyICogYTAxIC0gYTAyICogYTExKSAqIGRldDtcbiAgICBvdXRbM10gPSBiMTEgKiBkZXQ7XG4gICAgb3V0WzRdID0gKGEyMiAqIGEwMCAtIGEwMiAqIGEyMCkgKiBkZXQ7XG4gICAgb3V0WzVdID0gKC1hMTIgKiBhMDAgKyBhMDIgKiBhMTApICogZGV0O1xuICAgIG91dFs2XSA9IGIyMSAqIGRldDtcbiAgICBvdXRbN10gPSAoLWEyMSAqIGEwMCArIGEwMSAqIGEyMCkgKiBkZXQ7XG4gICAgb3V0WzhdID0gKGExMSAqIGEwMCAtIGEwMSAqIGExMCkgKiBkZXQ7XG4gICAgcmV0dXJuIG91dDtcbn07XG5cbi8qKlxuICogQ2FsY3VsYXRlcyB0aGUgYWRqdWdhdGUgb2YgYSBtYXQzXG4gKlxuICogQHBhcmFtIHttYXQzfSBvdXQgdGhlIHJlY2VpdmluZyBtYXRyaXhcbiAqIEBwYXJhbSB7bWF0M30gYSB0aGUgc291cmNlIG1hdHJpeFxuICogQHJldHVybnMge21hdDN9IG91dFxuICovXG5tYXQzLmFkam9pbnQgPSBmdW5jdGlvbihvdXQsIGEpIHtcbiAgICB2YXIgYTAwID0gYVswXSwgYTAxID0gYVsxXSwgYTAyID0gYVsyXSxcbiAgICAgICAgYTEwID0gYVszXSwgYTExID0gYVs0XSwgYTEyID0gYVs1XSxcbiAgICAgICAgYTIwID0gYVs2XSwgYTIxID0gYVs3XSwgYTIyID0gYVs4XTtcblxuICAgIG91dFswXSA9IChhMTEgKiBhMjIgLSBhMTIgKiBhMjEpO1xuICAgIG91dFsxXSA9IChhMDIgKiBhMjEgLSBhMDEgKiBhMjIpO1xuICAgIG91dFsyXSA9IChhMDEgKiBhMTIgLSBhMDIgKiBhMTEpO1xuICAgIG91dFszXSA9IChhMTIgKiBhMjAgLSBhMTAgKiBhMjIpO1xuICAgIG91dFs0XSA9IChhMDAgKiBhMjIgLSBhMDIgKiBhMjApO1xuICAgIG91dFs1XSA9IChhMDIgKiBhMTAgLSBhMDAgKiBhMTIpO1xuICAgIG91dFs2XSA9IChhMTAgKiBhMjEgLSBhMTEgKiBhMjApO1xuICAgIG91dFs3XSA9IChhMDEgKiBhMjAgLSBhMDAgKiBhMjEpO1xuICAgIG91dFs4XSA9IChhMDAgKiBhMTEgLSBhMDEgKiBhMTApO1xuICAgIHJldHVybiBvdXQ7XG59O1xuXG4vKipcbiAqIENhbGN1bGF0ZXMgdGhlIGRldGVybWluYW50IG9mIGEgbWF0M1xuICpcbiAqIEBwYXJhbSB7bWF0M30gYSB0aGUgc291cmNlIG1hdHJpeFxuICogQHJldHVybnMge051bWJlcn0gZGV0ZXJtaW5hbnQgb2YgYVxuICovXG5tYXQzLmRldGVybWluYW50ID0gZnVuY3Rpb24gKGEpIHtcbiAgICB2YXIgYTAwID0gYVswXSwgYTAxID0gYVsxXSwgYTAyID0gYVsyXSxcbiAgICAgICAgYTEwID0gYVszXSwgYTExID0gYVs0XSwgYTEyID0gYVs1XSxcbiAgICAgICAgYTIwID0gYVs2XSwgYTIxID0gYVs3XSwgYTIyID0gYVs4XTtcblxuICAgIHJldHVybiBhMDAgKiAoYTIyICogYTExIC0gYTEyICogYTIxKSArIGEwMSAqICgtYTIyICogYTEwICsgYTEyICogYTIwKSArIGEwMiAqIChhMjEgKiBhMTAgLSBhMTEgKiBhMjApO1xufTtcblxuLyoqXG4gKiBNdWx0aXBsaWVzIHR3byBtYXQzJ3NcbiAqXG4gKiBAcGFyYW0ge21hdDN9IG91dCB0aGUgcmVjZWl2aW5nIG1hdHJpeFxuICogQHBhcmFtIHttYXQzfSBhIHRoZSBmaXJzdCBvcGVyYW5kXG4gKiBAcGFyYW0ge21hdDN9IGIgdGhlIHNlY29uZCBvcGVyYW5kXG4gKiBAcmV0dXJucyB7bWF0M30gb3V0XG4gKi9cbm1hdDMubXVsdGlwbHkgPSBmdW5jdGlvbiAob3V0LCBhLCBiKSB7XG4gICAgdmFyIGEwMCA9IGFbMF0sIGEwMSA9IGFbMV0sIGEwMiA9IGFbMl0sXG4gICAgICAgIGExMCA9IGFbM10sIGExMSA9IGFbNF0sIGExMiA9IGFbNV0sXG4gICAgICAgIGEyMCA9IGFbNl0sIGEyMSA9IGFbN10sIGEyMiA9IGFbOF0sXG5cbiAgICAgICAgYjAwID0gYlswXSwgYjAxID0gYlsxXSwgYjAyID0gYlsyXSxcbiAgICAgICAgYjEwID0gYlszXSwgYjExID0gYls0XSwgYjEyID0gYls1XSxcbiAgICAgICAgYjIwID0gYls2XSwgYjIxID0gYls3XSwgYjIyID0gYls4XTtcblxuICAgIG91dFswXSA9IGIwMCAqIGEwMCArIGIwMSAqIGExMCArIGIwMiAqIGEyMDtcbiAgICBvdXRbMV0gPSBiMDAgKiBhMDEgKyBiMDEgKiBhMTEgKyBiMDIgKiBhMjE7XG4gICAgb3V0WzJdID0gYjAwICogYTAyICsgYjAxICogYTEyICsgYjAyICogYTIyO1xuXG4gICAgb3V0WzNdID0gYjEwICogYTAwICsgYjExICogYTEwICsgYjEyICogYTIwO1xuICAgIG91dFs0XSA9IGIxMCAqIGEwMSArIGIxMSAqIGExMSArIGIxMiAqIGEyMTtcbiAgICBvdXRbNV0gPSBiMTAgKiBhMDIgKyBiMTEgKiBhMTIgKyBiMTIgKiBhMjI7XG5cbiAgICBvdXRbNl0gPSBiMjAgKiBhMDAgKyBiMjEgKiBhMTAgKyBiMjIgKiBhMjA7XG4gICAgb3V0WzddID0gYjIwICogYTAxICsgYjIxICogYTExICsgYjIyICogYTIxO1xuICAgIG91dFs4XSA9IGIyMCAqIGEwMiArIGIyMSAqIGExMiArIGIyMiAqIGEyMjtcbiAgICByZXR1cm4gb3V0O1xufTtcblxuLyoqXG4gKiBBbGlhcyBmb3Ige0BsaW5rIG1hdDMubXVsdGlwbHl9XG4gKiBAZnVuY3Rpb25cbiAqL1xubWF0My5tdWwgPSBtYXQzLm11bHRpcGx5O1xuXG4vKipcbiAqIFRyYW5zbGF0ZSBhIG1hdDMgYnkgdGhlIGdpdmVuIHZlY3RvclxuICpcbiAqIEBwYXJhbSB7bWF0M30gb3V0IHRoZSByZWNlaXZpbmcgbWF0cml4XG4gKiBAcGFyYW0ge21hdDN9IGEgdGhlIG1hdHJpeCB0byB0cmFuc2xhdGVcbiAqIEBwYXJhbSB7dmVjMn0gdiB2ZWN0b3IgdG8gdHJhbnNsYXRlIGJ5XG4gKiBAcmV0dXJucyB7bWF0M30gb3V0XG4gKi9cbm1hdDMudHJhbnNsYXRlID0gZnVuY3Rpb24ob3V0LCBhLCB2KSB7XG4gICAgdmFyIGEwMCA9IGFbMF0sIGEwMSA9IGFbMV0sIGEwMiA9IGFbMl0sXG4gICAgICAgIGExMCA9IGFbM10sIGExMSA9IGFbNF0sIGExMiA9IGFbNV0sXG4gICAgICAgIGEyMCA9IGFbNl0sIGEyMSA9IGFbN10sIGEyMiA9IGFbOF0sXG4gICAgICAgIHggPSB2WzBdLCB5ID0gdlsxXTtcblxuICAgIG91dFswXSA9IGEwMDtcbiAgICBvdXRbMV0gPSBhMDE7XG4gICAgb3V0WzJdID0gYTAyO1xuXG4gICAgb3V0WzNdID0gYTEwO1xuICAgIG91dFs0XSA9IGExMTtcbiAgICBvdXRbNV0gPSBhMTI7XG5cbiAgICBvdXRbNl0gPSB4ICogYTAwICsgeSAqIGExMCArIGEyMDtcbiAgICBvdXRbN10gPSB4ICogYTAxICsgeSAqIGExMSArIGEyMTtcbiAgICBvdXRbOF0gPSB4ICogYTAyICsgeSAqIGExMiArIGEyMjtcbiAgICByZXR1cm4gb3V0O1xufTtcblxuLyoqXG4gKiBSb3RhdGVzIGEgbWF0MyBieSB0aGUgZ2l2ZW4gYW5nbGVcbiAqXG4gKiBAcGFyYW0ge21hdDN9IG91dCB0aGUgcmVjZWl2aW5nIG1hdHJpeFxuICogQHBhcmFtIHttYXQzfSBhIHRoZSBtYXRyaXggdG8gcm90YXRlXG4gKiBAcGFyYW0ge051bWJlcn0gcmFkIHRoZSBhbmdsZSB0byByb3RhdGUgdGhlIG1hdHJpeCBieVxuICogQHJldHVybnMge21hdDN9IG91dFxuICovXG5tYXQzLnJvdGF0ZSA9IGZ1bmN0aW9uIChvdXQsIGEsIHJhZCkge1xuICAgIHZhciBhMDAgPSBhWzBdLCBhMDEgPSBhWzFdLCBhMDIgPSBhWzJdLFxuICAgICAgICBhMTAgPSBhWzNdLCBhMTEgPSBhWzRdLCBhMTIgPSBhWzVdLFxuICAgICAgICBhMjAgPSBhWzZdLCBhMjEgPSBhWzddLCBhMjIgPSBhWzhdLFxuXG4gICAgICAgIHMgPSBNYXRoLnNpbihyYWQpLFxuICAgICAgICBjID0gTWF0aC5jb3MocmFkKTtcblxuICAgIG91dFswXSA9IGMgKiBhMDAgKyBzICogYTEwO1xuICAgIG91dFsxXSA9IGMgKiBhMDEgKyBzICogYTExO1xuICAgIG91dFsyXSA9IGMgKiBhMDIgKyBzICogYTEyO1xuXG4gICAgb3V0WzNdID0gYyAqIGExMCAtIHMgKiBhMDA7XG4gICAgb3V0WzRdID0gYyAqIGExMSAtIHMgKiBhMDE7XG4gICAgb3V0WzVdID0gYyAqIGExMiAtIHMgKiBhMDI7XG5cbiAgICBvdXRbNl0gPSBhMjA7XG4gICAgb3V0WzddID0gYTIxO1xuICAgIG91dFs4XSA9IGEyMjtcbiAgICByZXR1cm4gb3V0O1xufTtcblxuLyoqXG4gKiBTY2FsZXMgdGhlIG1hdDMgYnkgdGhlIGRpbWVuc2lvbnMgaW4gdGhlIGdpdmVuIHZlYzJcbiAqXG4gKiBAcGFyYW0ge21hdDN9IG91dCB0aGUgcmVjZWl2aW5nIG1hdHJpeFxuICogQHBhcmFtIHttYXQzfSBhIHRoZSBtYXRyaXggdG8gcm90YXRlXG4gKiBAcGFyYW0ge3ZlYzJ9IHYgdGhlIHZlYzIgdG8gc2NhbGUgdGhlIG1hdHJpeCBieVxuICogQHJldHVybnMge21hdDN9IG91dFxuICoqL1xubWF0My5zY2FsZSA9IGZ1bmN0aW9uKG91dCwgYSwgdikge1xuICAgIHZhciB4ID0gdlswXSwgeSA9IHZbMV07XG5cbiAgICBvdXRbMF0gPSB4ICogYVswXTtcbiAgICBvdXRbMV0gPSB4ICogYVsxXTtcbiAgICBvdXRbMl0gPSB4ICogYVsyXTtcblxuICAgIG91dFszXSA9IHkgKiBhWzNdO1xuICAgIG91dFs0XSA9IHkgKiBhWzRdO1xuICAgIG91dFs1XSA9IHkgKiBhWzVdO1xuXG4gICAgb3V0WzZdID0gYVs2XTtcbiAgICBvdXRbN10gPSBhWzddO1xuICAgIG91dFs4XSA9IGFbOF07XG4gICAgcmV0dXJuIG91dDtcbn07XG5cbi8qKlxuICogQ3JlYXRlcyBhIG1hdHJpeCBmcm9tIGEgdmVjdG9yIHRyYW5zbGF0aW9uXG4gKiBUaGlzIGlzIGVxdWl2YWxlbnQgdG8gKGJ1dCBtdWNoIGZhc3RlciB0aGFuKTpcbiAqXG4gKiAgICAgbWF0My5pZGVudGl0eShkZXN0KTtcbiAqICAgICBtYXQzLnRyYW5zbGF0ZShkZXN0LCBkZXN0LCB2ZWMpO1xuICpcbiAqIEBwYXJhbSB7bWF0M30gb3V0IG1hdDMgcmVjZWl2aW5nIG9wZXJhdGlvbiByZXN1bHRcbiAqIEBwYXJhbSB7dmVjMn0gdiBUcmFuc2xhdGlvbiB2ZWN0b3JcbiAqIEByZXR1cm5zIHttYXQzfSBvdXRcbiAqL1xubWF0My5mcm9tVHJhbnNsYXRpb24gPSBmdW5jdGlvbihvdXQsIHYpIHtcbiAgICBvdXRbMF0gPSAxO1xuICAgIG91dFsxXSA9IDA7XG4gICAgb3V0WzJdID0gMDtcbiAgICBvdXRbM10gPSAwO1xuICAgIG91dFs0XSA9IDE7XG4gICAgb3V0WzVdID0gMDtcbiAgICBvdXRbNl0gPSB2WzBdO1xuICAgIG91dFs3XSA9IHZbMV07XG4gICAgb3V0WzhdID0gMTtcbiAgICByZXR1cm4gb3V0O1xufVxuXG4vKipcbiAqIENyZWF0ZXMgYSBtYXRyaXggZnJvbSBhIGdpdmVuIGFuZ2xlXG4gKiBUaGlzIGlzIGVxdWl2YWxlbnQgdG8gKGJ1dCBtdWNoIGZhc3RlciB0aGFuKTpcbiAqXG4gKiAgICAgbWF0My5pZGVudGl0eShkZXN0KTtcbiAqICAgICBtYXQzLnJvdGF0ZShkZXN0LCBkZXN0LCByYWQpO1xuICpcbiAqIEBwYXJhbSB7bWF0M30gb3V0IG1hdDMgcmVjZWl2aW5nIG9wZXJhdGlvbiByZXN1bHRcbiAqIEBwYXJhbSB7TnVtYmVyfSByYWQgdGhlIGFuZ2xlIHRvIHJvdGF0ZSB0aGUgbWF0cml4IGJ5XG4gKiBAcmV0dXJucyB7bWF0M30gb3V0XG4gKi9cbm1hdDMuZnJvbVJvdGF0aW9uID0gZnVuY3Rpb24ob3V0LCByYWQpIHtcbiAgICB2YXIgcyA9IE1hdGguc2luKHJhZCksIGMgPSBNYXRoLmNvcyhyYWQpO1xuXG4gICAgb3V0WzBdID0gYztcbiAgICBvdXRbMV0gPSBzO1xuICAgIG91dFsyXSA9IDA7XG5cbiAgICBvdXRbM10gPSAtcztcbiAgICBvdXRbNF0gPSBjO1xuICAgIG91dFs1XSA9IDA7XG5cbiAgICBvdXRbNl0gPSAwO1xuICAgIG91dFs3XSA9IDA7XG4gICAgb3V0WzhdID0gMTtcbiAgICByZXR1cm4gb3V0O1xufVxuXG4vKipcbiAqIENyZWF0ZXMgYSBtYXRyaXggZnJvbSBhIHZlY3RvciBzY2FsaW5nXG4gKiBUaGlzIGlzIGVxdWl2YWxlbnQgdG8gKGJ1dCBtdWNoIGZhc3RlciB0aGFuKTpcbiAqXG4gKiAgICAgbWF0My5pZGVudGl0eShkZXN0KTtcbiAqICAgICBtYXQzLnNjYWxlKGRlc3QsIGRlc3QsIHZlYyk7XG4gKlxuICogQHBhcmFtIHttYXQzfSBvdXQgbWF0MyByZWNlaXZpbmcgb3BlcmF0aW9uIHJlc3VsdFxuICogQHBhcmFtIHt2ZWMyfSB2IFNjYWxpbmcgdmVjdG9yXG4gKiBAcmV0dXJucyB7bWF0M30gb3V0XG4gKi9cbm1hdDMuZnJvbVNjYWxpbmcgPSBmdW5jdGlvbihvdXQsIHYpIHtcbiAgICBvdXRbMF0gPSB2WzBdO1xuICAgIG91dFsxXSA9IDA7XG4gICAgb3V0WzJdID0gMDtcblxuICAgIG91dFszXSA9IDA7XG4gICAgb3V0WzRdID0gdlsxXTtcbiAgICBvdXRbNV0gPSAwO1xuXG4gICAgb3V0WzZdID0gMDtcbiAgICBvdXRbN10gPSAwO1xuICAgIG91dFs4XSA9IDE7XG4gICAgcmV0dXJuIG91dDtcbn1cblxuLyoqXG4gKiBDb3BpZXMgdGhlIHZhbHVlcyBmcm9tIGEgbWF0MmQgaW50byBhIG1hdDNcbiAqXG4gKiBAcGFyYW0ge21hdDN9IG91dCB0aGUgcmVjZWl2aW5nIG1hdHJpeFxuICogQHBhcmFtIHttYXQyZH0gYSB0aGUgbWF0cml4IHRvIGNvcHlcbiAqIEByZXR1cm5zIHttYXQzfSBvdXRcbiAqKi9cbm1hdDMuZnJvbU1hdDJkID0gZnVuY3Rpb24ob3V0LCBhKSB7XG4gICAgb3V0WzBdID0gYVswXTtcbiAgICBvdXRbMV0gPSBhWzFdO1xuICAgIG91dFsyXSA9IDA7XG5cbiAgICBvdXRbM10gPSBhWzJdO1xuICAgIG91dFs0XSA9IGFbM107XG4gICAgb3V0WzVdID0gMDtcblxuICAgIG91dFs2XSA9IGFbNF07XG4gICAgb3V0WzddID0gYVs1XTtcbiAgICBvdXRbOF0gPSAxO1xuICAgIHJldHVybiBvdXQ7XG59O1xuXG4vKipcbiogQ2FsY3VsYXRlcyBhIDN4MyBtYXRyaXggZnJvbSB0aGUgZ2l2ZW4gcXVhdGVybmlvblxuKlxuKiBAcGFyYW0ge21hdDN9IG91dCBtYXQzIHJlY2VpdmluZyBvcGVyYXRpb24gcmVzdWx0XG4qIEBwYXJhbSB7cXVhdH0gcSBRdWF0ZXJuaW9uIHRvIGNyZWF0ZSBtYXRyaXggZnJvbVxuKlxuKiBAcmV0dXJucyB7bWF0M30gb3V0XG4qL1xubWF0My5mcm9tUXVhdCA9IGZ1bmN0aW9uIChvdXQsIHEpIHtcbiAgICB2YXIgeCA9IHFbMF0sIHkgPSBxWzFdLCB6ID0gcVsyXSwgdyA9IHFbM10sXG4gICAgICAgIHgyID0geCArIHgsXG4gICAgICAgIHkyID0geSArIHksXG4gICAgICAgIHoyID0geiArIHosXG5cbiAgICAgICAgeHggPSB4ICogeDIsXG4gICAgICAgIHl4ID0geSAqIHgyLFxuICAgICAgICB5eSA9IHkgKiB5MixcbiAgICAgICAgenggPSB6ICogeDIsXG4gICAgICAgIHp5ID0geiAqIHkyLFxuICAgICAgICB6eiA9IHogKiB6MixcbiAgICAgICAgd3ggPSB3ICogeDIsXG4gICAgICAgIHd5ID0gdyAqIHkyLFxuICAgICAgICB3eiA9IHcgKiB6MjtcblxuICAgIG91dFswXSA9IDEgLSB5eSAtIHp6O1xuICAgIG91dFszXSA9IHl4IC0gd3o7XG4gICAgb3V0WzZdID0genggKyB3eTtcblxuICAgIG91dFsxXSA9IHl4ICsgd3o7XG4gICAgb3V0WzRdID0gMSAtIHh4IC0geno7XG4gICAgb3V0WzddID0genkgLSB3eDtcblxuICAgIG91dFsyXSA9IHp4IC0gd3k7XG4gICAgb3V0WzVdID0genkgKyB3eDtcbiAgICBvdXRbOF0gPSAxIC0geHggLSB5eTtcblxuICAgIHJldHVybiBvdXQ7XG59O1xuXG4vKipcbiogQ2FsY3VsYXRlcyBhIDN4MyBub3JtYWwgbWF0cml4ICh0cmFuc3Bvc2UgaW52ZXJzZSkgZnJvbSB0aGUgNHg0IG1hdHJpeFxuKlxuKiBAcGFyYW0ge21hdDN9IG91dCBtYXQzIHJlY2VpdmluZyBvcGVyYXRpb24gcmVzdWx0XG4qIEBwYXJhbSB7bWF0NH0gYSBNYXQ0IHRvIGRlcml2ZSB0aGUgbm9ybWFsIG1hdHJpeCBmcm9tXG4qXG4qIEByZXR1cm5zIHttYXQzfSBvdXRcbiovXG5tYXQzLm5vcm1hbEZyb21NYXQ0ID0gZnVuY3Rpb24gKG91dCwgYSkge1xuICAgIHZhciBhMDAgPSBhWzBdLCBhMDEgPSBhWzFdLCBhMDIgPSBhWzJdLCBhMDMgPSBhWzNdLFxuICAgICAgICBhMTAgPSBhWzRdLCBhMTEgPSBhWzVdLCBhMTIgPSBhWzZdLCBhMTMgPSBhWzddLFxuICAgICAgICBhMjAgPSBhWzhdLCBhMjEgPSBhWzldLCBhMjIgPSBhWzEwXSwgYTIzID0gYVsxMV0sXG4gICAgICAgIGEzMCA9IGFbMTJdLCBhMzEgPSBhWzEzXSwgYTMyID0gYVsxNF0sIGEzMyA9IGFbMTVdLFxuXG4gICAgICAgIGIwMCA9IGEwMCAqIGExMSAtIGEwMSAqIGExMCxcbiAgICAgICAgYjAxID0gYTAwICogYTEyIC0gYTAyICogYTEwLFxuICAgICAgICBiMDIgPSBhMDAgKiBhMTMgLSBhMDMgKiBhMTAsXG4gICAgICAgIGIwMyA9IGEwMSAqIGExMiAtIGEwMiAqIGExMSxcbiAgICAgICAgYjA0ID0gYTAxICogYTEzIC0gYTAzICogYTExLFxuICAgICAgICBiMDUgPSBhMDIgKiBhMTMgLSBhMDMgKiBhMTIsXG4gICAgICAgIGIwNiA9IGEyMCAqIGEzMSAtIGEyMSAqIGEzMCxcbiAgICAgICAgYjA3ID0gYTIwICogYTMyIC0gYTIyICogYTMwLFxuICAgICAgICBiMDggPSBhMjAgKiBhMzMgLSBhMjMgKiBhMzAsXG4gICAgICAgIGIwOSA9IGEyMSAqIGEzMiAtIGEyMiAqIGEzMSxcbiAgICAgICAgYjEwID0gYTIxICogYTMzIC0gYTIzICogYTMxLFxuICAgICAgICBiMTEgPSBhMjIgKiBhMzMgLSBhMjMgKiBhMzIsXG5cbiAgICAgICAgLy8gQ2FsY3VsYXRlIHRoZSBkZXRlcm1pbmFudFxuICAgICAgICBkZXQgPSBiMDAgKiBiMTEgLSBiMDEgKiBiMTAgKyBiMDIgKiBiMDkgKyBiMDMgKiBiMDggLSBiMDQgKiBiMDcgKyBiMDUgKiBiMDY7XG5cbiAgICBpZiAoIWRldCkgeyBcbiAgICAgICAgcmV0dXJuIG51bGw7IFxuICAgIH1cbiAgICBkZXQgPSAxLjAgLyBkZXQ7XG5cbiAgICBvdXRbMF0gPSAoYTExICogYjExIC0gYTEyICogYjEwICsgYTEzICogYjA5KSAqIGRldDtcbiAgICBvdXRbMV0gPSAoYTEyICogYjA4IC0gYTEwICogYjExIC0gYTEzICogYjA3KSAqIGRldDtcbiAgICBvdXRbMl0gPSAoYTEwICogYjEwIC0gYTExICogYjA4ICsgYTEzICogYjA2KSAqIGRldDtcblxuICAgIG91dFszXSA9IChhMDIgKiBiMTAgLSBhMDEgKiBiMTEgLSBhMDMgKiBiMDkpICogZGV0O1xuICAgIG91dFs0XSA9IChhMDAgKiBiMTEgLSBhMDIgKiBiMDggKyBhMDMgKiBiMDcpICogZGV0O1xuICAgIG91dFs1XSA9IChhMDEgKiBiMDggLSBhMDAgKiBiMTAgLSBhMDMgKiBiMDYpICogZGV0O1xuXG4gICAgb3V0WzZdID0gKGEzMSAqIGIwNSAtIGEzMiAqIGIwNCArIGEzMyAqIGIwMykgKiBkZXQ7XG4gICAgb3V0WzddID0gKGEzMiAqIGIwMiAtIGEzMCAqIGIwNSAtIGEzMyAqIGIwMSkgKiBkZXQ7XG4gICAgb3V0WzhdID0gKGEzMCAqIGIwNCAtIGEzMSAqIGIwMiArIGEzMyAqIGIwMCkgKiBkZXQ7XG5cbiAgICByZXR1cm4gb3V0O1xufTtcblxuLyoqXG4gKiBSZXR1cm5zIGEgc3RyaW5nIHJlcHJlc2VudGF0aW9uIG9mIGEgbWF0M1xuICpcbiAqIEBwYXJhbSB7bWF0M30gbWF0IG1hdHJpeCB0byByZXByZXNlbnQgYXMgYSBzdHJpbmdcbiAqIEByZXR1cm5zIHtTdHJpbmd9IHN0cmluZyByZXByZXNlbnRhdGlvbiBvZiB0aGUgbWF0cml4XG4gKi9cbm1hdDMuc3RyID0gZnVuY3Rpb24gKGEpIHtcbiAgICByZXR1cm4gJ21hdDMoJyArIGFbMF0gKyAnLCAnICsgYVsxXSArICcsICcgKyBhWzJdICsgJywgJyArIFxuICAgICAgICAgICAgICAgICAgICBhWzNdICsgJywgJyArIGFbNF0gKyAnLCAnICsgYVs1XSArICcsICcgKyBcbiAgICAgICAgICAgICAgICAgICAgYVs2XSArICcsICcgKyBhWzddICsgJywgJyArIGFbOF0gKyAnKSc7XG59O1xuXG4vKipcbiAqIFJldHVybnMgRnJvYmVuaXVzIG5vcm0gb2YgYSBtYXQzXG4gKlxuICogQHBhcmFtIHttYXQzfSBhIHRoZSBtYXRyaXggdG8gY2FsY3VsYXRlIEZyb2Jlbml1cyBub3JtIG9mXG4gKiBAcmV0dXJucyB7TnVtYmVyfSBGcm9iZW5pdXMgbm9ybVxuICovXG5tYXQzLmZyb2IgPSBmdW5jdGlvbiAoYSkge1xuICAgIHJldHVybihNYXRoLnNxcnQoTWF0aC5wb3coYVswXSwgMikgKyBNYXRoLnBvdyhhWzFdLCAyKSArIE1hdGgucG93KGFbMl0sIDIpICsgTWF0aC5wb3coYVszXSwgMikgKyBNYXRoLnBvdyhhWzRdLCAyKSArIE1hdGgucG93KGFbNV0sIDIpICsgTWF0aC5wb3coYVs2XSwgMikgKyBNYXRoLnBvdyhhWzddLCAyKSArIE1hdGgucG93KGFbOF0sIDIpKSlcbn07XG5cbi8qKlxuICogQWRkcyB0d28gbWF0MydzXG4gKlxuICogQHBhcmFtIHttYXQzfSBvdXQgdGhlIHJlY2VpdmluZyBtYXRyaXhcbiAqIEBwYXJhbSB7bWF0M30gYSB0aGUgZmlyc3Qgb3BlcmFuZFxuICogQHBhcmFtIHttYXQzfSBiIHRoZSBzZWNvbmQgb3BlcmFuZFxuICogQHJldHVybnMge21hdDN9IG91dFxuICovXG5tYXQzLmFkZCA9IGZ1bmN0aW9uKG91dCwgYSwgYikge1xuICAgIG91dFswXSA9IGFbMF0gKyBiWzBdO1xuICAgIG91dFsxXSA9IGFbMV0gKyBiWzFdO1xuICAgIG91dFsyXSA9IGFbMl0gKyBiWzJdO1xuICAgIG91dFszXSA9IGFbM10gKyBiWzNdO1xuICAgIG91dFs0XSA9IGFbNF0gKyBiWzRdO1xuICAgIG91dFs1XSA9IGFbNV0gKyBiWzVdO1xuICAgIG91dFs2XSA9IGFbNl0gKyBiWzZdO1xuICAgIG91dFs3XSA9IGFbN10gKyBiWzddO1xuICAgIG91dFs4XSA9IGFbOF0gKyBiWzhdO1xuICAgIHJldHVybiBvdXQ7XG59O1xuXG4vKipcbiAqIFN1YnRyYWN0cyBtYXRyaXggYiBmcm9tIG1hdHJpeCBhXG4gKlxuICogQHBhcmFtIHttYXQzfSBvdXQgdGhlIHJlY2VpdmluZyBtYXRyaXhcbiAqIEBwYXJhbSB7bWF0M30gYSB0aGUgZmlyc3Qgb3BlcmFuZFxuICogQHBhcmFtIHttYXQzfSBiIHRoZSBzZWNvbmQgb3BlcmFuZFxuICogQHJldHVybnMge21hdDN9IG91dFxuICovXG5tYXQzLnN1YnRyYWN0ID0gZnVuY3Rpb24ob3V0LCBhLCBiKSB7XG4gICAgb3V0WzBdID0gYVswXSAtIGJbMF07XG4gICAgb3V0WzFdID0gYVsxXSAtIGJbMV07XG4gICAgb3V0WzJdID0gYVsyXSAtIGJbMl07XG4gICAgb3V0WzNdID0gYVszXSAtIGJbM107XG4gICAgb3V0WzRdID0gYVs0XSAtIGJbNF07XG4gICAgb3V0WzVdID0gYVs1XSAtIGJbNV07XG4gICAgb3V0WzZdID0gYVs2XSAtIGJbNl07XG4gICAgb3V0WzddID0gYVs3XSAtIGJbN107XG4gICAgb3V0WzhdID0gYVs4XSAtIGJbOF07XG4gICAgcmV0dXJuIG91dDtcbn07XG5cbi8qKlxuICogQWxpYXMgZm9yIHtAbGluayBtYXQzLnN1YnRyYWN0fVxuICogQGZ1bmN0aW9uXG4gKi9cbm1hdDMuc3ViID0gbWF0My5zdWJ0cmFjdDtcblxuLyoqXG4gKiBNdWx0aXBseSBlYWNoIGVsZW1lbnQgb2YgdGhlIG1hdHJpeCBieSBhIHNjYWxhci5cbiAqXG4gKiBAcGFyYW0ge21hdDN9IG91dCB0aGUgcmVjZWl2aW5nIG1hdHJpeFxuICogQHBhcmFtIHttYXQzfSBhIHRoZSBtYXRyaXggdG8gc2NhbGVcbiAqIEBwYXJhbSB7TnVtYmVyfSBiIGFtb3VudCB0byBzY2FsZSB0aGUgbWF0cml4J3MgZWxlbWVudHMgYnlcbiAqIEByZXR1cm5zIHttYXQzfSBvdXRcbiAqL1xubWF0My5tdWx0aXBseVNjYWxhciA9IGZ1bmN0aW9uKG91dCwgYSwgYikge1xuICAgIG91dFswXSA9IGFbMF0gKiBiO1xuICAgIG91dFsxXSA9IGFbMV0gKiBiO1xuICAgIG91dFsyXSA9IGFbMl0gKiBiO1xuICAgIG91dFszXSA9IGFbM10gKiBiO1xuICAgIG91dFs0XSA9IGFbNF0gKiBiO1xuICAgIG91dFs1XSA9IGFbNV0gKiBiO1xuICAgIG91dFs2XSA9IGFbNl0gKiBiO1xuICAgIG91dFs3XSA9IGFbN10gKiBiO1xuICAgIG91dFs4XSA9IGFbOF0gKiBiO1xuICAgIHJldHVybiBvdXQ7XG59O1xuXG4vKipcbiAqIEFkZHMgdHdvIG1hdDMncyBhZnRlciBtdWx0aXBseWluZyBlYWNoIGVsZW1lbnQgb2YgdGhlIHNlY29uZCBvcGVyYW5kIGJ5IGEgc2NhbGFyIHZhbHVlLlxuICpcbiAqIEBwYXJhbSB7bWF0M30gb3V0IHRoZSByZWNlaXZpbmcgdmVjdG9yXG4gKiBAcGFyYW0ge21hdDN9IGEgdGhlIGZpcnN0IG9wZXJhbmRcbiAqIEBwYXJhbSB7bWF0M30gYiB0aGUgc2Vjb25kIG9wZXJhbmRcbiAqIEBwYXJhbSB7TnVtYmVyfSBzY2FsZSB0aGUgYW1vdW50IHRvIHNjYWxlIGIncyBlbGVtZW50cyBieSBiZWZvcmUgYWRkaW5nXG4gKiBAcmV0dXJucyB7bWF0M30gb3V0XG4gKi9cbm1hdDMubXVsdGlwbHlTY2FsYXJBbmRBZGQgPSBmdW5jdGlvbihvdXQsIGEsIGIsIHNjYWxlKSB7XG4gICAgb3V0WzBdID0gYVswXSArIChiWzBdICogc2NhbGUpO1xuICAgIG91dFsxXSA9IGFbMV0gKyAoYlsxXSAqIHNjYWxlKTtcbiAgICBvdXRbMl0gPSBhWzJdICsgKGJbMl0gKiBzY2FsZSk7XG4gICAgb3V0WzNdID0gYVszXSArIChiWzNdICogc2NhbGUpO1xuICAgIG91dFs0XSA9IGFbNF0gKyAoYls0XSAqIHNjYWxlKTtcbiAgICBvdXRbNV0gPSBhWzVdICsgKGJbNV0gKiBzY2FsZSk7XG4gICAgb3V0WzZdID0gYVs2XSArIChiWzZdICogc2NhbGUpO1xuICAgIG91dFs3XSA9IGFbN10gKyAoYls3XSAqIHNjYWxlKTtcbiAgICBvdXRbOF0gPSBhWzhdICsgKGJbOF0gKiBzY2FsZSk7XG4gICAgcmV0dXJuIG91dDtcbn07XG5cbi8qXG4gKiBSZXR1cm5zIHdoZXRoZXIgb3Igbm90IHRoZSBtYXRyaWNlcyBoYXZlIGV4YWN0bHkgdGhlIHNhbWUgZWxlbWVudHMgaW4gdGhlIHNhbWUgcG9zaXRpb24gKHdoZW4gY29tcGFyZWQgd2l0aCA9PT0pXG4gKlxuICogQHBhcmFtIHttYXQzfSBhIFRoZSBmaXJzdCBtYXRyaXguXG4gKiBAcGFyYW0ge21hdDN9IGIgVGhlIHNlY29uZCBtYXRyaXguXG4gKiBAcmV0dXJucyB7Qm9vbGVhbn0gVHJ1ZSBpZiB0aGUgbWF0cmljZXMgYXJlIGVxdWFsLCBmYWxzZSBvdGhlcndpc2UuXG4gKi9cbm1hdDMuZXhhY3RFcXVhbHMgPSBmdW5jdGlvbiAoYSwgYikge1xuICAgIHJldHVybiBhWzBdID09PSBiWzBdICYmIGFbMV0gPT09IGJbMV0gJiYgYVsyXSA9PT0gYlsyXSAmJiBcbiAgICAgICAgICAgYVszXSA9PT0gYlszXSAmJiBhWzRdID09PSBiWzRdICYmIGFbNV0gPT09IGJbNV0gJiZcbiAgICAgICAgICAgYVs2XSA9PT0gYls2XSAmJiBhWzddID09PSBiWzddICYmIGFbOF0gPT09IGJbOF07XG59O1xuXG4vKipcbiAqIFJldHVybnMgd2hldGhlciBvciBub3QgdGhlIG1hdHJpY2VzIGhhdmUgYXBwcm94aW1hdGVseSB0aGUgc2FtZSBlbGVtZW50cyBpbiB0aGUgc2FtZSBwb3NpdGlvbi5cbiAqXG4gKiBAcGFyYW0ge21hdDN9IGEgVGhlIGZpcnN0IG1hdHJpeC5cbiAqIEBwYXJhbSB7bWF0M30gYiBUaGUgc2Vjb25kIG1hdHJpeC5cbiAqIEByZXR1cm5zIHtCb29sZWFufSBUcnVlIGlmIHRoZSBtYXRyaWNlcyBhcmUgZXF1YWwsIGZhbHNlIG90aGVyd2lzZS5cbiAqL1xubWF0My5lcXVhbHMgPSBmdW5jdGlvbiAoYSwgYikge1xuICAgIHZhciBhMCA9IGFbMF0sIGExID0gYVsxXSwgYTIgPSBhWzJdLCBhMyA9IGFbM10sIGE0ID0gYVs0XSwgYTUgPSBhWzVdLCBhNiA9IGFbNl0sIGE3ID0gYVs3XSwgYTggPSBhWzhdO1xuICAgIHZhciBiMCA9IGJbMF0sIGIxID0gYlsxXSwgYjIgPSBiWzJdLCBiMyA9IGJbM10sIGI0ID0gYls0XSwgYjUgPSBiWzVdLCBiNiA9IGFbNl0sIGI3ID0gYls3XSwgYjggPSBiWzhdO1xuICAgIHJldHVybiAoTWF0aC5hYnMoYTAgLSBiMCkgPD0gZ2xNYXRyaXguRVBTSUxPTipNYXRoLm1heCgxLjAsIE1hdGguYWJzKGEwKSwgTWF0aC5hYnMoYjApKSAmJlxuICAgICAgICAgICAgTWF0aC5hYnMoYTEgLSBiMSkgPD0gZ2xNYXRyaXguRVBTSUxPTipNYXRoLm1heCgxLjAsIE1hdGguYWJzKGExKSwgTWF0aC5hYnMoYjEpKSAmJlxuICAgICAgICAgICAgTWF0aC5hYnMoYTIgLSBiMikgPD0gZ2xNYXRyaXguRVBTSUxPTipNYXRoLm1heCgxLjAsIE1hdGguYWJzKGEyKSwgTWF0aC5hYnMoYjIpKSAmJlxuICAgICAgICAgICAgTWF0aC5hYnMoYTMgLSBiMykgPD0gZ2xNYXRyaXguRVBTSUxPTipNYXRoLm1heCgxLjAsIE1hdGguYWJzKGEzKSwgTWF0aC5hYnMoYjMpKSAmJlxuICAgICAgICAgICAgTWF0aC5hYnMoYTQgLSBiNCkgPD0gZ2xNYXRyaXguRVBTSUxPTipNYXRoLm1heCgxLjAsIE1hdGguYWJzKGE0KSwgTWF0aC5hYnMoYjQpKSAmJlxuICAgICAgICAgICAgTWF0aC5hYnMoYTUgLSBiNSkgPD0gZ2xNYXRyaXguRVBTSUxPTipNYXRoLm1heCgxLjAsIE1hdGguYWJzKGE1KSwgTWF0aC5hYnMoYjUpKSAmJlxuICAgICAgICAgICAgTWF0aC5hYnMoYTYgLSBiNikgPD0gZ2xNYXRyaXguRVBTSUxPTipNYXRoLm1heCgxLjAsIE1hdGguYWJzKGE2KSwgTWF0aC5hYnMoYjYpKSAmJlxuICAgICAgICAgICAgTWF0aC5hYnMoYTcgLSBiNykgPD0gZ2xNYXRyaXguRVBTSUxPTipNYXRoLm1heCgxLjAsIE1hdGguYWJzKGE3KSwgTWF0aC5hYnMoYjcpKSAmJlxuICAgICAgICAgICAgTWF0aC5hYnMoYTggLSBiOCkgPD0gZ2xNYXRyaXguRVBTSUxPTipNYXRoLm1heCgxLjAsIE1hdGguYWJzKGE4KSwgTWF0aC5hYnMoYjgpKSk7XG59O1xuXG5cbm1vZHVsZS5leHBvcnRzID0gbWF0MztcbiIsIi8qIENvcHlyaWdodCAoYykgMjAxNSwgQnJhbmRvbiBKb25lcywgQ29saW4gTWFjS2VuemllIElWLlxuXG5QZXJtaXNzaW9uIGlzIGhlcmVieSBncmFudGVkLCBmcmVlIG9mIGNoYXJnZSwgdG8gYW55IHBlcnNvbiBvYnRhaW5pbmcgYSBjb3B5XG5vZiB0aGlzIHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGRvY3VtZW50YXRpb24gZmlsZXMgKHRoZSBcIlNvZnR3YXJlXCIpLCB0byBkZWFsXG5pbiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbiB0aGUgcmlnaHRzXG50byB1c2UsIGNvcHksIG1vZGlmeSwgbWVyZ2UsIHB1Ymxpc2gsIGRpc3RyaWJ1dGUsIHN1YmxpY2Vuc2UsIGFuZC9vciBzZWxsXG5jb3BpZXMgb2YgdGhlIFNvZnR3YXJlLCBhbmQgdG8gcGVybWl0IHBlcnNvbnMgdG8gd2hvbSB0aGUgU29mdHdhcmUgaXNcbmZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6XG5cblRoZSBhYm92ZSBjb3B5cmlnaHQgbm90aWNlIGFuZCB0aGlzIHBlcm1pc3Npb24gbm90aWNlIHNoYWxsIGJlIGluY2x1ZGVkIGluXG5hbGwgY29waWVzIG9yIHN1YnN0YW50aWFsIHBvcnRpb25zIG9mIHRoZSBTb2Z0d2FyZS5cblxuVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEIFwiQVMgSVNcIiwgV0lUSE9VVCBXQVJSQU5UWSBPRiBBTlkgS0lORCwgRVhQUkVTUyBPUlxuSU1QTElFRCwgSU5DTFVESU5HIEJVVCBOT1QgTElNSVRFRCBUTyBUSEUgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFksXG5GSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQgTk9OSU5GUklOR0VNRU5ULiBJTiBOTyBFVkVOVCBTSEFMTCBUSEVcbkFVVEhPUlMgT1IgQ09QWVJJR0hUIEhPTERFUlMgQkUgTElBQkxFIEZPUiBBTlkgQ0xBSU0sIERBTUFHRVMgT1IgT1RIRVJcbkxJQUJJTElUWSwgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIFRPUlQgT1IgT1RIRVJXSVNFLCBBUklTSU5HIEZST00sXG5PVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SIE9USEVSIERFQUxJTkdTIElOXG5USEUgU09GVFdBUkUuICovXG5cbnZhciBnbE1hdHJpeCA9IHJlcXVpcmUoXCIuL2NvbW1vbi5qc1wiKTtcblxuLyoqXG4gKiBAY2xhc3MgNHg0IE1hdHJpeFxuICogQG5hbWUgbWF0NFxuICovXG52YXIgbWF0NCA9IHtcbiAgc2NhbGFyOiB7fSxcbiAgU0lNRDoge30sXG59O1xuXG4vKipcbiAqIENyZWF0ZXMgYSBuZXcgaWRlbnRpdHkgbWF0NFxuICpcbiAqIEByZXR1cm5zIHttYXQ0fSBhIG5ldyA0eDQgbWF0cml4XG4gKi9cbm1hdDQuY3JlYXRlID0gZnVuY3Rpb24oKSB7XG4gICAgdmFyIG91dCA9IG5ldyBnbE1hdHJpeC5BUlJBWV9UWVBFKDE2KTtcbiAgICBvdXRbMF0gPSAxO1xuICAgIG91dFsxXSA9IDA7XG4gICAgb3V0WzJdID0gMDtcbiAgICBvdXRbM10gPSAwO1xuICAgIG91dFs0XSA9IDA7XG4gICAgb3V0WzVdID0gMTtcbiAgICBvdXRbNl0gPSAwO1xuICAgIG91dFs3XSA9IDA7XG4gICAgb3V0WzhdID0gMDtcbiAgICBvdXRbOV0gPSAwO1xuICAgIG91dFsxMF0gPSAxO1xuICAgIG91dFsxMV0gPSAwO1xuICAgIG91dFsxMl0gPSAwO1xuICAgIG91dFsxM10gPSAwO1xuICAgIG91dFsxNF0gPSAwO1xuICAgIG91dFsxNV0gPSAxO1xuICAgIHJldHVybiBvdXQ7XG59O1xuXG4vKipcbiAqIENyZWF0ZXMgYSBuZXcgbWF0NCBpbml0aWFsaXplZCB3aXRoIHZhbHVlcyBmcm9tIGFuIGV4aXN0aW5nIG1hdHJpeFxuICpcbiAqIEBwYXJhbSB7bWF0NH0gYSBtYXRyaXggdG8gY2xvbmVcbiAqIEByZXR1cm5zIHttYXQ0fSBhIG5ldyA0eDQgbWF0cml4XG4gKi9cbm1hdDQuY2xvbmUgPSBmdW5jdGlvbihhKSB7XG4gICAgdmFyIG91dCA9IG5ldyBnbE1hdHJpeC5BUlJBWV9UWVBFKDE2KTtcbiAgICBvdXRbMF0gPSBhWzBdO1xuICAgIG91dFsxXSA9IGFbMV07XG4gICAgb3V0WzJdID0gYVsyXTtcbiAgICBvdXRbM10gPSBhWzNdO1xuICAgIG91dFs0XSA9IGFbNF07XG4gICAgb3V0WzVdID0gYVs1XTtcbiAgICBvdXRbNl0gPSBhWzZdO1xuICAgIG91dFs3XSA9IGFbN107XG4gICAgb3V0WzhdID0gYVs4XTtcbiAgICBvdXRbOV0gPSBhWzldO1xuICAgIG91dFsxMF0gPSBhWzEwXTtcbiAgICBvdXRbMTFdID0gYVsxMV07XG4gICAgb3V0WzEyXSA9IGFbMTJdO1xuICAgIG91dFsxM10gPSBhWzEzXTtcbiAgICBvdXRbMTRdID0gYVsxNF07XG4gICAgb3V0WzE1XSA9IGFbMTVdO1xuICAgIHJldHVybiBvdXQ7XG59O1xuXG4vKipcbiAqIENvcHkgdGhlIHZhbHVlcyBmcm9tIG9uZSBtYXQ0IHRvIGFub3RoZXJcbiAqXG4gKiBAcGFyYW0ge21hdDR9IG91dCB0aGUgcmVjZWl2aW5nIG1hdHJpeFxuICogQHBhcmFtIHttYXQ0fSBhIHRoZSBzb3VyY2UgbWF0cml4XG4gKiBAcmV0dXJucyB7bWF0NH0gb3V0XG4gKi9cbm1hdDQuY29weSA9IGZ1bmN0aW9uKG91dCwgYSkge1xuICAgIG91dFswXSA9IGFbMF07XG4gICAgb3V0WzFdID0gYVsxXTtcbiAgICBvdXRbMl0gPSBhWzJdO1xuICAgIG91dFszXSA9IGFbM107XG4gICAgb3V0WzRdID0gYVs0XTtcbiAgICBvdXRbNV0gPSBhWzVdO1xuICAgIG91dFs2XSA9IGFbNl07XG4gICAgb3V0WzddID0gYVs3XTtcbiAgICBvdXRbOF0gPSBhWzhdO1xuICAgIG91dFs5XSA9IGFbOV07XG4gICAgb3V0WzEwXSA9IGFbMTBdO1xuICAgIG91dFsxMV0gPSBhWzExXTtcbiAgICBvdXRbMTJdID0gYVsxMl07XG4gICAgb3V0WzEzXSA9IGFbMTNdO1xuICAgIG91dFsxNF0gPSBhWzE0XTtcbiAgICBvdXRbMTVdID0gYVsxNV07XG4gICAgcmV0dXJuIG91dDtcbn07XG5cbi8qKlxuICogQ3JlYXRlIGEgbmV3IG1hdDQgd2l0aCB0aGUgZ2l2ZW4gdmFsdWVzXG4gKlxuICogQHBhcmFtIHtOdW1iZXJ9IG0wMCBDb21wb25lbnQgaW4gY29sdW1uIDAsIHJvdyAwIHBvc2l0aW9uIChpbmRleCAwKVxuICogQHBhcmFtIHtOdW1iZXJ9IG0wMSBDb21wb25lbnQgaW4gY29sdW1uIDAsIHJvdyAxIHBvc2l0aW9uIChpbmRleCAxKVxuICogQHBhcmFtIHtOdW1iZXJ9IG0wMiBDb21wb25lbnQgaW4gY29sdW1uIDAsIHJvdyAyIHBvc2l0aW9uIChpbmRleCAyKVxuICogQHBhcmFtIHtOdW1iZXJ9IG0wMyBDb21wb25lbnQgaW4gY29sdW1uIDAsIHJvdyAzIHBvc2l0aW9uIChpbmRleCAzKVxuICogQHBhcmFtIHtOdW1iZXJ9IG0xMCBDb21wb25lbnQgaW4gY29sdW1uIDEsIHJvdyAwIHBvc2l0aW9uIChpbmRleCA0KVxuICogQHBhcmFtIHtOdW1iZXJ9IG0xMSBDb21wb25lbnQgaW4gY29sdW1uIDEsIHJvdyAxIHBvc2l0aW9uIChpbmRleCA1KVxuICogQHBhcmFtIHtOdW1iZXJ9IG0xMiBDb21wb25lbnQgaW4gY29sdW1uIDEsIHJvdyAyIHBvc2l0aW9uIChpbmRleCA2KVxuICogQHBhcmFtIHtOdW1iZXJ9IG0xMyBDb21wb25lbnQgaW4gY29sdW1uIDEsIHJvdyAzIHBvc2l0aW9uIChpbmRleCA3KVxuICogQHBhcmFtIHtOdW1iZXJ9IG0yMCBDb21wb25lbnQgaW4gY29sdW1uIDIsIHJvdyAwIHBvc2l0aW9uIChpbmRleCA4KVxuICogQHBhcmFtIHtOdW1iZXJ9IG0yMSBDb21wb25lbnQgaW4gY29sdW1uIDIsIHJvdyAxIHBvc2l0aW9uIChpbmRleCA5KVxuICogQHBhcmFtIHtOdW1iZXJ9IG0yMiBDb21wb25lbnQgaW4gY29sdW1uIDIsIHJvdyAyIHBvc2l0aW9uIChpbmRleCAxMClcbiAqIEBwYXJhbSB7TnVtYmVyfSBtMjMgQ29tcG9uZW50IGluIGNvbHVtbiAyLCByb3cgMyBwb3NpdGlvbiAoaW5kZXggMTEpXG4gKiBAcGFyYW0ge051bWJlcn0gbTMwIENvbXBvbmVudCBpbiBjb2x1bW4gMywgcm93IDAgcG9zaXRpb24gKGluZGV4IDEyKVxuICogQHBhcmFtIHtOdW1iZXJ9IG0zMSBDb21wb25lbnQgaW4gY29sdW1uIDMsIHJvdyAxIHBvc2l0aW9uIChpbmRleCAxMylcbiAqIEBwYXJhbSB7TnVtYmVyfSBtMzIgQ29tcG9uZW50IGluIGNvbHVtbiAzLCByb3cgMiBwb3NpdGlvbiAoaW5kZXggMTQpXG4gKiBAcGFyYW0ge051bWJlcn0gbTMzIENvbXBvbmVudCBpbiBjb2x1bW4gMywgcm93IDMgcG9zaXRpb24gKGluZGV4IDE1KVxuICogQHJldHVybnMge21hdDR9IEEgbmV3IG1hdDRcbiAqL1xubWF0NC5mcm9tVmFsdWVzID0gZnVuY3Rpb24obTAwLCBtMDEsIG0wMiwgbTAzLCBtMTAsIG0xMSwgbTEyLCBtMTMsIG0yMCwgbTIxLCBtMjIsIG0yMywgbTMwLCBtMzEsIG0zMiwgbTMzKSB7XG4gICAgdmFyIG91dCA9IG5ldyBnbE1hdHJpeC5BUlJBWV9UWVBFKDE2KTtcbiAgICBvdXRbMF0gPSBtMDA7XG4gICAgb3V0WzFdID0gbTAxO1xuICAgIG91dFsyXSA9IG0wMjtcbiAgICBvdXRbM10gPSBtMDM7XG4gICAgb3V0WzRdID0gbTEwO1xuICAgIG91dFs1XSA9IG0xMTtcbiAgICBvdXRbNl0gPSBtMTI7XG4gICAgb3V0WzddID0gbTEzO1xuICAgIG91dFs4XSA9IG0yMDtcbiAgICBvdXRbOV0gPSBtMjE7XG4gICAgb3V0WzEwXSA9IG0yMjtcbiAgICBvdXRbMTFdID0gbTIzO1xuICAgIG91dFsxMl0gPSBtMzA7XG4gICAgb3V0WzEzXSA9IG0zMTtcbiAgICBvdXRbMTRdID0gbTMyO1xuICAgIG91dFsxNV0gPSBtMzM7XG4gICAgcmV0dXJuIG91dDtcbn07XG5cbi8qKlxuICogU2V0IHRoZSBjb21wb25lbnRzIG9mIGEgbWF0NCB0byB0aGUgZ2l2ZW4gdmFsdWVzXG4gKlxuICogQHBhcmFtIHttYXQ0fSBvdXQgdGhlIHJlY2VpdmluZyBtYXRyaXhcbiAqIEBwYXJhbSB7TnVtYmVyfSBtMDAgQ29tcG9uZW50IGluIGNvbHVtbiAwLCByb3cgMCBwb3NpdGlvbiAoaW5kZXggMClcbiAqIEBwYXJhbSB7TnVtYmVyfSBtMDEgQ29tcG9uZW50IGluIGNvbHVtbiAwLCByb3cgMSBwb3NpdGlvbiAoaW5kZXggMSlcbiAqIEBwYXJhbSB7TnVtYmVyfSBtMDIgQ29tcG9uZW50IGluIGNvbHVtbiAwLCByb3cgMiBwb3NpdGlvbiAoaW5kZXggMilcbiAqIEBwYXJhbSB7TnVtYmVyfSBtMDMgQ29tcG9uZW50IGluIGNvbHVtbiAwLCByb3cgMyBwb3NpdGlvbiAoaW5kZXggMylcbiAqIEBwYXJhbSB7TnVtYmVyfSBtMTAgQ29tcG9uZW50IGluIGNvbHVtbiAxLCByb3cgMCBwb3NpdGlvbiAoaW5kZXggNClcbiAqIEBwYXJhbSB7TnVtYmVyfSBtMTEgQ29tcG9uZW50IGluIGNvbHVtbiAxLCByb3cgMSBwb3NpdGlvbiAoaW5kZXggNSlcbiAqIEBwYXJhbSB7TnVtYmVyfSBtMTIgQ29tcG9uZW50IGluIGNvbHVtbiAxLCByb3cgMiBwb3NpdGlvbiAoaW5kZXggNilcbiAqIEBwYXJhbSB7TnVtYmVyfSBtMTMgQ29tcG9uZW50IGluIGNvbHVtbiAxLCByb3cgMyBwb3NpdGlvbiAoaW5kZXggNylcbiAqIEBwYXJhbSB7TnVtYmVyfSBtMjAgQ29tcG9uZW50IGluIGNvbHVtbiAyLCByb3cgMCBwb3NpdGlvbiAoaW5kZXggOClcbiAqIEBwYXJhbSB7TnVtYmVyfSBtMjEgQ29tcG9uZW50IGluIGNvbHVtbiAyLCByb3cgMSBwb3NpdGlvbiAoaW5kZXggOSlcbiAqIEBwYXJhbSB7TnVtYmVyfSBtMjIgQ29tcG9uZW50IGluIGNvbHVtbiAyLCByb3cgMiBwb3NpdGlvbiAoaW5kZXggMTApXG4gKiBAcGFyYW0ge051bWJlcn0gbTIzIENvbXBvbmVudCBpbiBjb2x1bW4gMiwgcm93IDMgcG9zaXRpb24gKGluZGV4IDExKVxuICogQHBhcmFtIHtOdW1iZXJ9IG0zMCBDb21wb25lbnQgaW4gY29sdW1uIDMsIHJvdyAwIHBvc2l0aW9uIChpbmRleCAxMilcbiAqIEBwYXJhbSB7TnVtYmVyfSBtMzEgQ29tcG9uZW50IGluIGNvbHVtbiAzLCByb3cgMSBwb3NpdGlvbiAoaW5kZXggMTMpXG4gKiBAcGFyYW0ge051bWJlcn0gbTMyIENvbXBvbmVudCBpbiBjb2x1bW4gMywgcm93IDIgcG9zaXRpb24gKGluZGV4IDE0KVxuICogQHBhcmFtIHtOdW1iZXJ9IG0zMyBDb21wb25lbnQgaW4gY29sdW1uIDMsIHJvdyAzIHBvc2l0aW9uIChpbmRleCAxNSlcbiAqIEByZXR1cm5zIHttYXQ0fSBvdXRcbiAqL1xubWF0NC5zZXQgPSBmdW5jdGlvbihvdXQsIG0wMCwgbTAxLCBtMDIsIG0wMywgbTEwLCBtMTEsIG0xMiwgbTEzLCBtMjAsIG0yMSwgbTIyLCBtMjMsIG0zMCwgbTMxLCBtMzIsIG0zMykge1xuICAgIG91dFswXSA9IG0wMDtcbiAgICBvdXRbMV0gPSBtMDE7XG4gICAgb3V0WzJdID0gbTAyO1xuICAgIG91dFszXSA9IG0wMztcbiAgICBvdXRbNF0gPSBtMTA7XG4gICAgb3V0WzVdID0gbTExO1xuICAgIG91dFs2XSA9IG0xMjtcbiAgICBvdXRbN10gPSBtMTM7XG4gICAgb3V0WzhdID0gbTIwO1xuICAgIG91dFs5XSA9IG0yMTtcbiAgICBvdXRbMTBdID0gbTIyO1xuICAgIG91dFsxMV0gPSBtMjM7XG4gICAgb3V0WzEyXSA9IG0zMDtcbiAgICBvdXRbMTNdID0gbTMxO1xuICAgIG91dFsxNF0gPSBtMzI7XG4gICAgb3V0WzE1XSA9IG0zMztcbiAgICByZXR1cm4gb3V0O1xufTtcblxuXG4vKipcbiAqIFNldCBhIG1hdDQgdG8gdGhlIGlkZW50aXR5IG1hdHJpeFxuICpcbiAqIEBwYXJhbSB7bWF0NH0gb3V0IHRoZSByZWNlaXZpbmcgbWF0cml4XG4gKiBAcmV0dXJucyB7bWF0NH0gb3V0XG4gKi9cbm1hdDQuaWRlbnRpdHkgPSBmdW5jdGlvbihvdXQpIHtcbiAgICBvdXRbMF0gPSAxO1xuICAgIG91dFsxXSA9IDA7XG4gICAgb3V0WzJdID0gMDtcbiAgICBvdXRbM10gPSAwO1xuICAgIG91dFs0XSA9IDA7XG4gICAgb3V0WzVdID0gMTtcbiAgICBvdXRbNl0gPSAwO1xuICAgIG91dFs3XSA9IDA7XG4gICAgb3V0WzhdID0gMDtcbiAgICBvdXRbOV0gPSAwO1xuICAgIG91dFsxMF0gPSAxO1xuICAgIG91dFsxMV0gPSAwO1xuICAgIG91dFsxMl0gPSAwO1xuICAgIG91dFsxM10gPSAwO1xuICAgIG91dFsxNF0gPSAwO1xuICAgIG91dFsxNV0gPSAxO1xuICAgIHJldHVybiBvdXQ7XG59O1xuXG4vKipcbiAqIFRyYW5zcG9zZSB0aGUgdmFsdWVzIG9mIGEgbWF0NCBub3QgdXNpbmcgU0lNRFxuICpcbiAqIEBwYXJhbSB7bWF0NH0gb3V0IHRoZSByZWNlaXZpbmcgbWF0cml4XG4gKiBAcGFyYW0ge21hdDR9IGEgdGhlIHNvdXJjZSBtYXRyaXhcbiAqIEByZXR1cm5zIHttYXQ0fSBvdXRcbiAqL1xubWF0NC5zY2FsYXIudHJhbnNwb3NlID0gZnVuY3Rpb24ob3V0LCBhKSB7XG4gICAgLy8gSWYgd2UgYXJlIHRyYW5zcG9zaW5nIG91cnNlbHZlcyB3ZSBjYW4gc2tpcCBhIGZldyBzdGVwcyBidXQgaGF2ZSB0byBjYWNoZSBzb21lIHZhbHVlc1xuICAgIGlmIChvdXQgPT09IGEpIHtcbiAgICAgICAgdmFyIGEwMSA9IGFbMV0sIGEwMiA9IGFbMl0sIGEwMyA9IGFbM10sXG4gICAgICAgICAgICBhMTIgPSBhWzZdLCBhMTMgPSBhWzddLFxuICAgICAgICAgICAgYTIzID0gYVsxMV07XG5cbiAgICAgICAgb3V0WzFdID0gYVs0XTtcbiAgICAgICAgb3V0WzJdID0gYVs4XTtcbiAgICAgICAgb3V0WzNdID0gYVsxMl07XG4gICAgICAgIG91dFs0XSA9IGEwMTtcbiAgICAgICAgb3V0WzZdID0gYVs5XTtcbiAgICAgICAgb3V0WzddID0gYVsxM107XG4gICAgICAgIG91dFs4XSA9IGEwMjtcbiAgICAgICAgb3V0WzldID0gYTEyO1xuICAgICAgICBvdXRbMTFdID0gYVsxNF07XG4gICAgICAgIG91dFsxMl0gPSBhMDM7XG4gICAgICAgIG91dFsxM10gPSBhMTM7XG4gICAgICAgIG91dFsxNF0gPSBhMjM7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgb3V0WzBdID0gYVswXTtcbiAgICAgICAgb3V0WzFdID0gYVs0XTtcbiAgICAgICAgb3V0WzJdID0gYVs4XTtcbiAgICAgICAgb3V0WzNdID0gYVsxMl07XG4gICAgICAgIG91dFs0XSA9IGFbMV07XG4gICAgICAgIG91dFs1XSA9IGFbNV07XG4gICAgICAgIG91dFs2XSA9IGFbOV07XG4gICAgICAgIG91dFs3XSA9IGFbMTNdO1xuICAgICAgICBvdXRbOF0gPSBhWzJdO1xuICAgICAgICBvdXRbOV0gPSBhWzZdO1xuICAgICAgICBvdXRbMTBdID0gYVsxMF07XG4gICAgICAgIG91dFsxMV0gPSBhWzE0XTtcbiAgICAgICAgb3V0WzEyXSA9IGFbM107XG4gICAgICAgIG91dFsxM10gPSBhWzddO1xuICAgICAgICBvdXRbMTRdID0gYVsxMV07XG4gICAgICAgIG91dFsxNV0gPSBhWzE1XTtcbiAgICB9XG5cbiAgICByZXR1cm4gb3V0O1xufTtcblxuLyoqXG4gKiBUcmFuc3Bvc2UgdGhlIHZhbHVlcyBvZiBhIG1hdDQgdXNpbmcgU0lNRFxuICpcbiAqIEBwYXJhbSB7bWF0NH0gb3V0IHRoZSByZWNlaXZpbmcgbWF0cml4XG4gKiBAcGFyYW0ge21hdDR9IGEgdGhlIHNvdXJjZSBtYXRyaXhcbiAqIEByZXR1cm5zIHttYXQ0fSBvdXRcbiAqL1xubWF0NC5TSU1ELnRyYW5zcG9zZSA9IGZ1bmN0aW9uKG91dCwgYSkge1xuICAgIHZhciBhMCwgYTEsIGEyLCBhMyxcbiAgICAgICAgdG1wMDEsIHRtcDIzLFxuICAgICAgICBvdXQwLCBvdXQxLCBvdXQyLCBvdXQzO1xuXG4gICAgYTAgPSBTSU1ELkZsb2F0MzJ4NC5sb2FkKGEsIDApO1xuICAgIGExID0gU0lNRC5GbG9hdDMyeDQubG9hZChhLCA0KTtcbiAgICBhMiA9IFNJTUQuRmxvYXQzMng0LmxvYWQoYSwgOCk7XG4gICAgYTMgPSBTSU1ELkZsb2F0MzJ4NC5sb2FkKGEsIDEyKTtcblxuICAgIHRtcDAxID0gU0lNRC5GbG9hdDMyeDQuc2h1ZmZsZShhMCwgYTEsIDAsIDEsIDQsIDUpO1xuICAgIHRtcDIzID0gU0lNRC5GbG9hdDMyeDQuc2h1ZmZsZShhMiwgYTMsIDAsIDEsIDQsIDUpO1xuICAgIG91dDAgID0gU0lNRC5GbG9hdDMyeDQuc2h1ZmZsZSh0bXAwMSwgdG1wMjMsIDAsIDIsIDQsIDYpO1xuICAgIG91dDEgID0gU0lNRC5GbG9hdDMyeDQuc2h1ZmZsZSh0bXAwMSwgdG1wMjMsIDEsIDMsIDUsIDcpO1xuICAgIFNJTUQuRmxvYXQzMng0LnN0b3JlKG91dCwgMCwgIG91dDApO1xuICAgIFNJTUQuRmxvYXQzMng0LnN0b3JlKG91dCwgNCwgIG91dDEpO1xuXG4gICAgdG1wMDEgPSBTSU1ELkZsb2F0MzJ4NC5zaHVmZmxlKGEwLCBhMSwgMiwgMywgNiwgNyk7XG4gICAgdG1wMjMgPSBTSU1ELkZsb2F0MzJ4NC5zaHVmZmxlKGEyLCBhMywgMiwgMywgNiwgNyk7XG4gICAgb3V0MiAgPSBTSU1ELkZsb2F0MzJ4NC5zaHVmZmxlKHRtcDAxLCB0bXAyMywgMCwgMiwgNCwgNik7XG4gICAgb3V0MyAgPSBTSU1ELkZsb2F0MzJ4NC5zaHVmZmxlKHRtcDAxLCB0bXAyMywgMSwgMywgNSwgNyk7XG4gICAgU0lNRC5GbG9hdDMyeDQuc3RvcmUob3V0LCA4LCAgb3V0Mik7XG4gICAgU0lNRC5GbG9hdDMyeDQuc3RvcmUob3V0LCAxMiwgb3V0Myk7XG5cbiAgICByZXR1cm4gb3V0O1xufTtcblxuLyoqXG4gKiBUcmFuc3BzZSBhIG1hdDQgdXNpbmcgU0lNRCBpZiBhdmFpbGFibGUgYW5kIGVuYWJsZWRcbiAqXG4gKiBAcGFyYW0ge21hdDR9IG91dCB0aGUgcmVjZWl2aW5nIG1hdHJpeFxuICogQHBhcmFtIHttYXQ0fSBhIHRoZSBzb3VyY2UgbWF0cml4XG4gKiBAcmV0dXJucyB7bWF0NH0gb3V0XG4gKi9cbm1hdDQudHJhbnNwb3NlID0gZ2xNYXRyaXguVVNFX1NJTUQgPyBtYXQ0LlNJTUQudHJhbnNwb3NlIDogbWF0NC5zY2FsYXIudHJhbnNwb3NlO1xuXG4vKipcbiAqIEludmVydHMgYSBtYXQ0IG5vdCB1c2luZyBTSU1EXG4gKlxuICogQHBhcmFtIHttYXQ0fSBvdXQgdGhlIHJlY2VpdmluZyBtYXRyaXhcbiAqIEBwYXJhbSB7bWF0NH0gYSB0aGUgc291cmNlIG1hdHJpeFxuICogQHJldHVybnMge21hdDR9IG91dFxuICovXG5tYXQ0LnNjYWxhci5pbnZlcnQgPSBmdW5jdGlvbihvdXQsIGEpIHtcbiAgICB2YXIgYTAwID0gYVswXSwgYTAxID0gYVsxXSwgYTAyID0gYVsyXSwgYTAzID0gYVszXSxcbiAgICAgICAgYTEwID0gYVs0XSwgYTExID0gYVs1XSwgYTEyID0gYVs2XSwgYTEzID0gYVs3XSxcbiAgICAgICAgYTIwID0gYVs4XSwgYTIxID0gYVs5XSwgYTIyID0gYVsxMF0sIGEyMyA9IGFbMTFdLFxuICAgICAgICBhMzAgPSBhWzEyXSwgYTMxID0gYVsxM10sIGEzMiA9IGFbMTRdLCBhMzMgPSBhWzE1XSxcblxuICAgICAgICBiMDAgPSBhMDAgKiBhMTEgLSBhMDEgKiBhMTAsXG4gICAgICAgIGIwMSA9IGEwMCAqIGExMiAtIGEwMiAqIGExMCxcbiAgICAgICAgYjAyID0gYTAwICogYTEzIC0gYTAzICogYTEwLFxuICAgICAgICBiMDMgPSBhMDEgKiBhMTIgLSBhMDIgKiBhMTEsXG4gICAgICAgIGIwNCA9IGEwMSAqIGExMyAtIGEwMyAqIGExMSxcbiAgICAgICAgYjA1ID0gYTAyICogYTEzIC0gYTAzICogYTEyLFxuICAgICAgICBiMDYgPSBhMjAgKiBhMzEgLSBhMjEgKiBhMzAsXG4gICAgICAgIGIwNyA9IGEyMCAqIGEzMiAtIGEyMiAqIGEzMCxcbiAgICAgICAgYjA4ID0gYTIwICogYTMzIC0gYTIzICogYTMwLFxuICAgICAgICBiMDkgPSBhMjEgKiBhMzIgLSBhMjIgKiBhMzEsXG4gICAgICAgIGIxMCA9IGEyMSAqIGEzMyAtIGEyMyAqIGEzMSxcbiAgICAgICAgYjExID0gYTIyICogYTMzIC0gYTIzICogYTMyLFxuXG4gICAgICAgIC8vIENhbGN1bGF0ZSB0aGUgZGV0ZXJtaW5hbnRcbiAgICAgICAgZGV0ID0gYjAwICogYjExIC0gYjAxICogYjEwICsgYjAyICogYjA5ICsgYjAzICogYjA4IC0gYjA0ICogYjA3ICsgYjA1ICogYjA2O1xuXG4gICAgaWYgKCFkZXQpIHtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIGRldCA9IDEuMCAvIGRldDtcblxuICAgIG91dFswXSA9IChhMTEgKiBiMTEgLSBhMTIgKiBiMTAgKyBhMTMgKiBiMDkpICogZGV0O1xuICAgIG91dFsxXSA9IChhMDIgKiBiMTAgLSBhMDEgKiBiMTEgLSBhMDMgKiBiMDkpICogZGV0O1xuICAgIG91dFsyXSA9IChhMzEgKiBiMDUgLSBhMzIgKiBiMDQgKyBhMzMgKiBiMDMpICogZGV0O1xuICAgIG91dFszXSA9IChhMjIgKiBiMDQgLSBhMjEgKiBiMDUgLSBhMjMgKiBiMDMpICogZGV0O1xuICAgIG91dFs0XSA9IChhMTIgKiBiMDggLSBhMTAgKiBiMTEgLSBhMTMgKiBiMDcpICogZGV0O1xuICAgIG91dFs1XSA9IChhMDAgKiBiMTEgLSBhMDIgKiBiMDggKyBhMDMgKiBiMDcpICogZGV0O1xuICAgIG91dFs2XSA9IChhMzIgKiBiMDIgLSBhMzAgKiBiMDUgLSBhMzMgKiBiMDEpICogZGV0O1xuICAgIG91dFs3XSA9IChhMjAgKiBiMDUgLSBhMjIgKiBiMDIgKyBhMjMgKiBiMDEpICogZGV0O1xuICAgIG91dFs4XSA9IChhMTAgKiBiMTAgLSBhMTEgKiBiMDggKyBhMTMgKiBiMDYpICogZGV0O1xuICAgIG91dFs5XSA9IChhMDEgKiBiMDggLSBhMDAgKiBiMTAgLSBhMDMgKiBiMDYpICogZGV0O1xuICAgIG91dFsxMF0gPSAoYTMwICogYjA0IC0gYTMxICogYjAyICsgYTMzICogYjAwKSAqIGRldDtcbiAgICBvdXRbMTFdID0gKGEyMSAqIGIwMiAtIGEyMCAqIGIwNCAtIGEyMyAqIGIwMCkgKiBkZXQ7XG4gICAgb3V0WzEyXSA9IChhMTEgKiBiMDcgLSBhMTAgKiBiMDkgLSBhMTIgKiBiMDYpICogZGV0O1xuICAgIG91dFsxM10gPSAoYTAwICogYjA5IC0gYTAxICogYjA3ICsgYTAyICogYjA2KSAqIGRldDtcbiAgICBvdXRbMTRdID0gKGEzMSAqIGIwMSAtIGEzMCAqIGIwMyAtIGEzMiAqIGIwMCkgKiBkZXQ7XG4gICAgb3V0WzE1XSA9IChhMjAgKiBiMDMgLSBhMjEgKiBiMDEgKyBhMjIgKiBiMDApICogZGV0O1xuXG4gICAgcmV0dXJuIG91dDtcbn07XG5cbi8qKlxuICogSW52ZXJ0cyBhIG1hdDQgdXNpbmcgU0lNRFxuICpcbiAqIEBwYXJhbSB7bWF0NH0gb3V0IHRoZSByZWNlaXZpbmcgbWF0cml4XG4gKiBAcGFyYW0ge21hdDR9IGEgdGhlIHNvdXJjZSBtYXRyaXhcbiAqIEByZXR1cm5zIHttYXQ0fSBvdXRcbiAqL1xubWF0NC5TSU1ELmludmVydCA9IGZ1bmN0aW9uKG91dCwgYSkge1xuICB2YXIgcm93MCwgcm93MSwgcm93Miwgcm93MyxcbiAgICAgIHRtcDEsXG4gICAgICBtaW5vcjAsIG1pbm9yMSwgbWlub3IyLCBtaW5vcjMsXG4gICAgICBkZXQsXG4gICAgICBhMCA9IFNJTUQuRmxvYXQzMng0LmxvYWQoYSwgMCksXG4gICAgICBhMSA9IFNJTUQuRmxvYXQzMng0LmxvYWQoYSwgNCksXG4gICAgICBhMiA9IFNJTUQuRmxvYXQzMng0LmxvYWQoYSwgOCksXG4gICAgICBhMyA9IFNJTUQuRmxvYXQzMng0LmxvYWQoYSwgMTIpO1xuXG4gIC8vIENvbXB1dGUgbWF0cml4IGFkanVnYXRlXG4gIHRtcDEgPSBTSU1ELkZsb2F0MzJ4NC5zaHVmZmxlKGEwLCBhMSwgMCwgMSwgNCwgNSk7XG4gIHJvdzEgPSBTSU1ELkZsb2F0MzJ4NC5zaHVmZmxlKGEyLCBhMywgMCwgMSwgNCwgNSk7XG4gIHJvdzAgPSBTSU1ELkZsb2F0MzJ4NC5zaHVmZmxlKHRtcDEsIHJvdzEsIDAsIDIsIDQsIDYpO1xuICByb3cxID0gU0lNRC5GbG9hdDMyeDQuc2h1ZmZsZShyb3cxLCB0bXAxLCAxLCAzLCA1LCA3KTtcbiAgdG1wMSA9IFNJTUQuRmxvYXQzMng0LnNodWZmbGUoYTAsIGExLCAyLCAzLCA2LCA3KTtcbiAgcm93MyA9IFNJTUQuRmxvYXQzMng0LnNodWZmbGUoYTIsIGEzLCAyLCAzLCA2LCA3KTtcbiAgcm93MiA9IFNJTUQuRmxvYXQzMng0LnNodWZmbGUodG1wMSwgcm93MywgMCwgMiwgNCwgNik7XG4gIHJvdzMgPSBTSU1ELkZsb2F0MzJ4NC5zaHVmZmxlKHJvdzMsIHRtcDEsIDEsIDMsIDUsIDcpO1xuXG4gIHRtcDEgICA9IFNJTUQuRmxvYXQzMng0Lm11bChyb3cyLCByb3czKTtcbiAgdG1wMSAgID0gU0lNRC5GbG9hdDMyeDQuc3dpenpsZSh0bXAxLCAxLCAwLCAzLCAyKTtcbiAgbWlub3IwID0gU0lNRC5GbG9hdDMyeDQubXVsKHJvdzEsIHRtcDEpO1xuICBtaW5vcjEgPSBTSU1ELkZsb2F0MzJ4NC5tdWwocm93MCwgdG1wMSk7XG4gIHRtcDEgICA9IFNJTUQuRmxvYXQzMng0LnN3aXp6bGUodG1wMSwgMiwgMywgMCwgMSk7XG4gIG1pbm9yMCA9IFNJTUQuRmxvYXQzMng0LnN1YihTSU1ELkZsb2F0MzJ4NC5tdWwocm93MSwgdG1wMSksIG1pbm9yMCk7XG4gIG1pbm9yMSA9IFNJTUQuRmxvYXQzMng0LnN1YihTSU1ELkZsb2F0MzJ4NC5tdWwocm93MCwgdG1wMSksIG1pbm9yMSk7XG4gIG1pbm9yMSA9IFNJTUQuRmxvYXQzMng0LnN3aXp6bGUobWlub3IxLCAyLCAzLCAwLCAxKTtcblxuICB0bXAxICAgPSBTSU1ELkZsb2F0MzJ4NC5tdWwocm93MSwgcm93Mik7XG4gIHRtcDEgICA9IFNJTUQuRmxvYXQzMng0LnN3aXp6bGUodG1wMSwgMSwgMCwgMywgMik7XG4gIG1pbm9yMCA9IFNJTUQuRmxvYXQzMng0LmFkZChTSU1ELkZsb2F0MzJ4NC5tdWwocm93MywgdG1wMSksIG1pbm9yMCk7XG4gIG1pbm9yMyA9IFNJTUQuRmxvYXQzMng0Lm11bChyb3cwLCB0bXAxKTtcbiAgdG1wMSAgID0gU0lNRC5GbG9hdDMyeDQuc3dpenpsZSh0bXAxLCAyLCAzLCAwLCAxKTtcbiAgbWlub3IwID0gU0lNRC5GbG9hdDMyeDQuc3ViKG1pbm9yMCwgU0lNRC5GbG9hdDMyeDQubXVsKHJvdzMsIHRtcDEpKTtcbiAgbWlub3IzID0gU0lNRC5GbG9hdDMyeDQuc3ViKFNJTUQuRmxvYXQzMng0Lm11bChyb3cwLCB0bXAxKSwgbWlub3IzKTtcbiAgbWlub3IzID0gU0lNRC5GbG9hdDMyeDQuc3dpenpsZShtaW5vcjMsIDIsIDMsIDAsIDEpO1xuXG4gIHRtcDEgICA9IFNJTUQuRmxvYXQzMng0Lm11bChTSU1ELkZsb2F0MzJ4NC5zd2l6emxlKHJvdzEsIDIsIDMsIDAsIDEpLCByb3czKTtcbiAgdG1wMSAgID0gU0lNRC5GbG9hdDMyeDQuc3dpenpsZSh0bXAxLCAxLCAwLCAzLCAyKTtcbiAgcm93MiAgID0gU0lNRC5GbG9hdDMyeDQuc3dpenpsZShyb3cyLCAyLCAzLCAwLCAxKTtcbiAgbWlub3IwID0gU0lNRC5GbG9hdDMyeDQuYWRkKFNJTUQuRmxvYXQzMng0Lm11bChyb3cyLCB0bXAxKSwgbWlub3IwKTtcbiAgbWlub3IyID0gU0lNRC5GbG9hdDMyeDQubXVsKHJvdzAsIHRtcDEpO1xuICB0bXAxICAgPSBTSU1ELkZsb2F0MzJ4NC5zd2l6emxlKHRtcDEsIDIsIDMsIDAsIDEpO1xuICBtaW5vcjAgPSBTSU1ELkZsb2F0MzJ4NC5zdWIobWlub3IwLCBTSU1ELkZsb2F0MzJ4NC5tdWwocm93MiwgdG1wMSkpO1xuICBtaW5vcjIgPSBTSU1ELkZsb2F0MzJ4NC5zdWIoU0lNRC5GbG9hdDMyeDQubXVsKHJvdzAsIHRtcDEpLCBtaW5vcjIpO1xuICBtaW5vcjIgPSBTSU1ELkZsb2F0MzJ4NC5zd2l6emxlKG1pbm9yMiwgMiwgMywgMCwgMSk7XG5cbiAgdG1wMSAgID0gU0lNRC5GbG9hdDMyeDQubXVsKHJvdzAsIHJvdzEpO1xuICB0bXAxICAgPSBTSU1ELkZsb2F0MzJ4NC5zd2l6emxlKHRtcDEsIDEsIDAsIDMsIDIpO1xuICBtaW5vcjIgPSBTSU1ELkZsb2F0MzJ4NC5hZGQoU0lNRC5GbG9hdDMyeDQubXVsKHJvdzMsIHRtcDEpLCBtaW5vcjIpO1xuICBtaW5vcjMgPSBTSU1ELkZsb2F0MzJ4NC5zdWIoU0lNRC5GbG9hdDMyeDQubXVsKHJvdzIsIHRtcDEpLCBtaW5vcjMpO1xuICB0bXAxICAgPSBTSU1ELkZsb2F0MzJ4NC5zd2l6emxlKHRtcDEsIDIsIDMsIDAsIDEpO1xuICBtaW5vcjIgPSBTSU1ELkZsb2F0MzJ4NC5zdWIoU0lNRC5GbG9hdDMyeDQubXVsKHJvdzMsIHRtcDEpLCBtaW5vcjIpO1xuICBtaW5vcjMgPSBTSU1ELkZsb2F0MzJ4NC5zdWIobWlub3IzLCBTSU1ELkZsb2F0MzJ4NC5tdWwocm93MiwgdG1wMSkpO1xuXG4gIHRtcDEgICA9IFNJTUQuRmxvYXQzMng0Lm11bChyb3cwLCByb3czKTtcbiAgdG1wMSAgID0gU0lNRC5GbG9hdDMyeDQuc3dpenpsZSh0bXAxLCAxLCAwLCAzLCAyKTtcbiAgbWlub3IxID0gU0lNRC5GbG9hdDMyeDQuc3ViKG1pbm9yMSwgU0lNRC5GbG9hdDMyeDQubXVsKHJvdzIsIHRtcDEpKTtcbiAgbWlub3IyID0gU0lNRC5GbG9hdDMyeDQuYWRkKFNJTUQuRmxvYXQzMng0Lm11bChyb3cxLCB0bXAxKSwgbWlub3IyKTtcbiAgdG1wMSAgID0gU0lNRC5GbG9hdDMyeDQuc3dpenpsZSh0bXAxLCAyLCAzLCAwLCAxKTtcbiAgbWlub3IxID0gU0lNRC5GbG9hdDMyeDQuYWRkKFNJTUQuRmxvYXQzMng0Lm11bChyb3cyLCB0bXAxKSwgbWlub3IxKTtcbiAgbWlub3IyID0gU0lNRC5GbG9hdDMyeDQuc3ViKG1pbm9yMiwgU0lNRC5GbG9hdDMyeDQubXVsKHJvdzEsIHRtcDEpKTtcblxuICB0bXAxICAgPSBTSU1ELkZsb2F0MzJ4NC5tdWwocm93MCwgcm93Mik7XG4gIHRtcDEgICA9IFNJTUQuRmxvYXQzMng0LnN3aXp6bGUodG1wMSwgMSwgMCwgMywgMik7XG4gIG1pbm9yMSA9IFNJTUQuRmxvYXQzMng0LmFkZChTSU1ELkZsb2F0MzJ4NC5tdWwocm93MywgdG1wMSksIG1pbm9yMSk7XG4gIG1pbm9yMyA9IFNJTUQuRmxvYXQzMng0LnN1YihtaW5vcjMsIFNJTUQuRmxvYXQzMng0Lm11bChyb3cxLCB0bXAxKSk7XG4gIHRtcDEgICA9IFNJTUQuRmxvYXQzMng0LnN3aXp6bGUodG1wMSwgMiwgMywgMCwgMSk7XG4gIG1pbm9yMSA9IFNJTUQuRmxvYXQzMng0LnN1YihtaW5vcjEsIFNJTUQuRmxvYXQzMng0Lm11bChyb3czLCB0bXAxKSk7XG4gIG1pbm9yMyA9IFNJTUQuRmxvYXQzMng0LmFkZChTSU1ELkZsb2F0MzJ4NC5tdWwocm93MSwgdG1wMSksIG1pbm9yMyk7XG5cbiAgLy8gQ29tcHV0ZSBtYXRyaXggZGV0ZXJtaW5hbnRcbiAgZGV0ICAgPSBTSU1ELkZsb2F0MzJ4NC5tdWwocm93MCwgbWlub3IwKTtcbiAgZGV0ICAgPSBTSU1ELkZsb2F0MzJ4NC5hZGQoU0lNRC5GbG9hdDMyeDQuc3dpenpsZShkZXQsIDIsIDMsIDAsIDEpLCBkZXQpO1xuICBkZXQgICA9IFNJTUQuRmxvYXQzMng0LmFkZChTSU1ELkZsb2F0MzJ4NC5zd2l6emxlKGRldCwgMSwgMCwgMywgMiksIGRldCk7XG4gIHRtcDEgID0gU0lNRC5GbG9hdDMyeDQucmVjaXByb2NhbEFwcHJveGltYXRpb24oZGV0KTtcbiAgZGV0ICAgPSBTSU1ELkZsb2F0MzJ4NC5zdWIoXG4gICAgICAgICAgICAgICBTSU1ELkZsb2F0MzJ4NC5hZGQodG1wMSwgdG1wMSksXG4gICAgICAgICAgICAgICBTSU1ELkZsb2F0MzJ4NC5tdWwoZGV0LCBTSU1ELkZsb2F0MzJ4NC5tdWwodG1wMSwgdG1wMSkpKTtcbiAgZGV0ICAgPSBTSU1ELkZsb2F0MzJ4NC5zd2l6emxlKGRldCwgMCwgMCwgMCwgMCk7XG4gIGlmICghZGV0KSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgfVxuXG4gIC8vIENvbXB1dGUgbWF0cml4IGludmVyc2VcbiAgU0lNRC5GbG9hdDMyeDQuc3RvcmUob3V0LCAwLCAgU0lNRC5GbG9hdDMyeDQubXVsKGRldCwgbWlub3IwKSk7XG4gIFNJTUQuRmxvYXQzMng0LnN0b3JlKG91dCwgNCwgIFNJTUQuRmxvYXQzMng0Lm11bChkZXQsIG1pbm9yMSkpO1xuICBTSU1ELkZsb2F0MzJ4NC5zdG9yZShvdXQsIDgsICBTSU1ELkZsb2F0MzJ4NC5tdWwoZGV0LCBtaW5vcjIpKTtcbiAgU0lNRC5GbG9hdDMyeDQuc3RvcmUob3V0LCAxMiwgU0lNRC5GbG9hdDMyeDQubXVsKGRldCwgbWlub3IzKSk7XG4gIHJldHVybiBvdXQ7XG59XG5cbi8qKlxuICogSW52ZXJ0cyBhIG1hdDQgdXNpbmcgU0lNRCBpZiBhdmFpbGFibGUgYW5kIGVuYWJsZWRcbiAqXG4gKiBAcGFyYW0ge21hdDR9IG91dCB0aGUgcmVjZWl2aW5nIG1hdHJpeFxuICogQHBhcmFtIHttYXQ0fSBhIHRoZSBzb3VyY2UgbWF0cml4XG4gKiBAcmV0dXJucyB7bWF0NH0gb3V0XG4gKi9cbm1hdDQuaW52ZXJ0ID0gZ2xNYXRyaXguVVNFX1NJTUQgPyBtYXQ0LlNJTUQuaW52ZXJ0IDogbWF0NC5zY2FsYXIuaW52ZXJ0O1xuXG4vKipcbiAqIENhbGN1bGF0ZXMgdGhlIGFkanVnYXRlIG9mIGEgbWF0NCBub3QgdXNpbmcgU0lNRFxuICpcbiAqIEBwYXJhbSB7bWF0NH0gb3V0IHRoZSByZWNlaXZpbmcgbWF0cml4XG4gKiBAcGFyYW0ge21hdDR9IGEgdGhlIHNvdXJjZSBtYXRyaXhcbiAqIEByZXR1cm5zIHttYXQ0fSBvdXRcbiAqL1xubWF0NC5zY2FsYXIuYWRqb2ludCA9IGZ1bmN0aW9uKG91dCwgYSkge1xuICAgIHZhciBhMDAgPSBhWzBdLCBhMDEgPSBhWzFdLCBhMDIgPSBhWzJdLCBhMDMgPSBhWzNdLFxuICAgICAgICBhMTAgPSBhWzRdLCBhMTEgPSBhWzVdLCBhMTIgPSBhWzZdLCBhMTMgPSBhWzddLFxuICAgICAgICBhMjAgPSBhWzhdLCBhMjEgPSBhWzldLCBhMjIgPSBhWzEwXSwgYTIzID0gYVsxMV0sXG4gICAgICAgIGEzMCA9IGFbMTJdLCBhMzEgPSBhWzEzXSwgYTMyID0gYVsxNF0sIGEzMyA9IGFbMTVdO1xuXG4gICAgb3V0WzBdICA9ICAoYTExICogKGEyMiAqIGEzMyAtIGEyMyAqIGEzMikgLSBhMjEgKiAoYTEyICogYTMzIC0gYTEzICogYTMyKSArIGEzMSAqIChhMTIgKiBhMjMgLSBhMTMgKiBhMjIpKTtcbiAgICBvdXRbMV0gID0gLShhMDEgKiAoYTIyICogYTMzIC0gYTIzICogYTMyKSAtIGEyMSAqIChhMDIgKiBhMzMgLSBhMDMgKiBhMzIpICsgYTMxICogKGEwMiAqIGEyMyAtIGEwMyAqIGEyMikpO1xuICAgIG91dFsyXSAgPSAgKGEwMSAqIChhMTIgKiBhMzMgLSBhMTMgKiBhMzIpIC0gYTExICogKGEwMiAqIGEzMyAtIGEwMyAqIGEzMikgKyBhMzEgKiAoYTAyICogYTEzIC0gYTAzICogYTEyKSk7XG4gICAgb3V0WzNdICA9IC0oYTAxICogKGExMiAqIGEyMyAtIGExMyAqIGEyMikgLSBhMTEgKiAoYTAyICogYTIzIC0gYTAzICogYTIyKSArIGEyMSAqIChhMDIgKiBhMTMgLSBhMDMgKiBhMTIpKTtcbiAgICBvdXRbNF0gID0gLShhMTAgKiAoYTIyICogYTMzIC0gYTIzICogYTMyKSAtIGEyMCAqIChhMTIgKiBhMzMgLSBhMTMgKiBhMzIpICsgYTMwICogKGExMiAqIGEyMyAtIGExMyAqIGEyMikpO1xuICAgIG91dFs1XSAgPSAgKGEwMCAqIChhMjIgKiBhMzMgLSBhMjMgKiBhMzIpIC0gYTIwICogKGEwMiAqIGEzMyAtIGEwMyAqIGEzMikgKyBhMzAgKiAoYTAyICogYTIzIC0gYTAzICogYTIyKSk7XG4gICAgb3V0WzZdICA9IC0oYTAwICogKGExMiAqIGEzMyAtIGExMyAqIGEzMikgLSBhMTAgKiAoYTAyICogYTMzIC0gYTAzICogYTMyKSArIGEzMCAqIChhMDIgKiBhMTMgLSBhMDMgKiBhMTIpKTtcbiAgICBvdXRbN10gID0gIChhMDAgKiAoYTEyICogYTIzIC0gYTEzICogYTIyKSAtIGExMCAqIChhMDIgKiBhMjMgLSBhMDMgKiBhMjIpICsgYTIwICogKGEwMiAqIGExMyAtIGEwMyAqIGExMikpO1xuICAgIG91dFs4XSAgPSAgKGExMCAqIChhMjEgKiBhMzMgLSBhMjMgKiBhMzEpIC0gYTIwICogKGExMSAqIGEzMyAtIGExMyAqIGEzMSkgKyBhMzAgKiAoYTExICogYTIzIC0gYTEzICogYTIxKSk7XG4gICAgb3V0WzldICA9IC0oYTAwICogKGEyMSAqIGEzMyAtIGEyMyAqIGEzMSkgLSBhMjAgKiAoYTAxICogYTMzIC0gYTAzICogYTMxKSArIGEzMCAqIChhMDEgKiBhMjMgLSBhMDMgKiBhMjEpKTtcbiAgICBvdXRbMTBdID0gIChhMDAgKiAoYTExICogYTMzIC0gYTEzICogYTMxKSAtIGExMCAqIChhMDEgKiBhMzMgLSBhMDMgKiBhMzEpICsgYTMwICogKGEwMSAqIGExMyAtIGEwMyAqIGExMSkpO1xuICAgIG91dFsxMV0gPSAtKGEwMCAqIChhMTEgKiBhMjMgLSBhMTMgKiBhMjEpIC0gYTEwICogKGEwMSAqIGEyMyAtIGEwMyAqIGEyMSkgKyBhMjAgKiAoYTAxICogYTEzIC0gYTAzICogYTExKSk7XG4gICAgb3V0WzEyXSA9IC0oYTEwICogKGEyMSAqIGEzMiAtIGEyMiAqIGEzMSkgLSBhMjAgKiAoYTExICogYTMyIC0gYTEyICogYTMxKSArIGEzMCAqIChhMTEgKiBhMjIgLSBhMTIgKiBhMjEpKTtcbiAgICBvdXRbMTNdID0gIChhMDAgKiAoYTIxICogYTMyIC0gYTIyICogYTMxKSAtIGEyMCAqIChhMDEgKiBhMzIgLSBhMDIgKiBhMzEpICsgYTMwICogKGEwMSAqIGEyMiAtIGEwMiAqIGEyMSkpO1xuICAgIG91dFsxNF0gPSAtKGEwMCAqIChhMTEgKiBhMzIgLSBhMTIgKiBhMzEpIC0gYTEwICogKGEwMSAqIGEzMiAtIGEwMiAqIGEzMSkgKyBhMzAgKiAoYTAxICogYTEyIC0gYTAyICogYTExKSk7XG4gICAgb3V0WzE1XSA9ICAoYTAwICogKGExMSAqIGEyMiAtIGExMiAqIGEyMSkgLSBhMTAgKiAoYTAxICogYTIyIC0gYTAyICogYTIxKSArIGEyMCAqIChhMDEgKiBhMTIgLSBhMDIgKiBhMTEpKTtcbiAgICByZXR1cm4gb3V0O1xufTtcblxuLyoqXG4gKiBDYWxjdWxhdGVzIHRoZSBhZGp1Z2F0ZSBvZiBhIG1hdDQgdXNpbmcgU0lNRFxuICpcbiAqIEBwYXJhbSB7bWF0NH0gb3V0IHRoZSByZWNlaXZpbmcgbWF0cml4XG4gKiBAcGFyYW0ge21hdDR9IGEgdGhlIHNvdXJjZSBtYXRyaXhcbiAqIEByZXR1cm5zIHttYXQ0fSBvdXRcbiAqL1xubWF0NC5TSU1ELmFkam9pbnQgPSBmdW5jdGlvbihvdXQsIGEpIHtcbiAgdmFyIGEwLCBhMSwgYTIsIGEzO1xuICB2YXIgcm93MCwgcm93MSwgcm93Miwgcm93MztcbiAgdmFyIHRtcDE7XG4gIHZhciBtaW5vcjAsIG1pbm9yMSwgbWlub3IyLCBtaW5vcjM7XG5cbiAgdmFyIGEwID0gU0lNRC5GbG9hdDMyeDQubG9hZChhLCAwKTtcbiAgdmFyIGExID0gU0lNRC5GbG9hdDMyeDQubG9hZChhLCA0KTtcbiAgdmFyIGEyID0gU0lNRC5GbG9hdDMyeDQubG9hZChhLCA4KTtcbiAgdmFyIGEzID0gU0lNRC5GbG9hdDMyeDQubG9hZChhLCAxMik7XG5cbiAgLy8gVHJhbnNwb3NlIHRoZSBzb3VyY2UgbWF0cml4LiAgU29ydCBvZi4gIE5vdCBhIHRydWUgdHJhbnNwb3NlIG9wZXJhdGlvblxuICB0bXAxID0gU0lNRC5GbG9hdDMyeDQuc2h1ZmZsZShhMCwgYTEsIDAsIDEsIDQsIDUpO1xuICByb3cxID0gU0lNRC5GbG9hdDMyeDQuc2h1ZmZsZShhMiwgYTMsIDAsIDEsIDQsIDUpO1xuICByb3cwID0gU0lNRC5GbG9hdDMyeDQuc2h1ZmZsZSh0bXAxLCByb3cxLCAwLCAyLCA0LCA2KTtcbiAgcm93MSA9IFNJTUQuRmxvYXQzMng0LnNodWZmbGUocm93MSwgdG1wMSwgMSwgMywgNSwgNyk7XG5cbiAgdG1wMSA9IFNJTUQuRmxvYXQzMng0LnNodWZmbGUoYTAsIGExLCAyLCAzLCA2LCA3KTtcbiAgcm93MyA9IFNJTUQuRmxvYXQzMng0LnNodWZmbGUoYTIsIGEzLCAyLCAzLCA2LCA3KTtcbiAgcm93MiA9IFNJTUQuRmxvYXQzMng0LnNodWZmbGUodG1wMSwgcm93MywgMCwgMiwgNCwgNik7XG4gIHJvdzMgPSBTSU1ELkZsb2F0MzJ4NC5zaHVmZmxlKHJvdzMsIHRtcDEsIDEsIDMsIDUsIDcpO1xuXG4gIHRtcDEgICA9IFNJTUQuRmxvYXQzMng0Lm11bChyb3cyLCByb3czKTtcbiAgdG1wMSAgID0gU0lNRC5GbG9hdDMyeDQuc3dpenpsZSh0bXAxLCAxLCAwLCAzLCAyKTtcbiAgbWlub3IwID0gU0lNRC5GbG9hdDMyeDQubXVsKHJvdzEsIHRtcDEpO1xuICBtaW5vcjEgPSBTSU1ELkZsb2F0MzJ4NC5tdWwocm93MCwgdG1wMSk7XG4gIHRtcDEgICA9IFNJTUQuRmxvYXQzMng0LnN3aXp6bGUodG1wMSwgMiwgMywgMCwgMSk7XG4gIG1pbm9yMCA9IFNJTUQuRmxvYXQzMng0LnN1YihTSU1ELkZsb2F0MzJ4NC5tdWwocm93MSwgdG1wMSksIG1pbm9yMCk7XG4gIG1pbm9yMSA9IFNJTUQuRmxvYXQzMng0LnN1YihTSU1ELkZsb2F0MzJ4NC5tdWwocm93MCwgdG1wMSksIG1pbm9yMSk7XG4gIG1pbm9yMSA9IFNJTUQuRmxvYXQzMng0LnN3aXp6bGUobWlub3IxLCAyLCAzLCAwLCAxKTtcblxuICB0bXAxICAgPSBTSU1ELkZsb2F0MzJ4NC5tdWwocm93MSwgcm93Mik7XG4gIHRtcDEgICA9IFNJTUQuRmxvYXQzMng0LnN3aXp6bGUodG1wMSwgMSwgMCwgMywgMik7XG4gIG1pbm9yMCA9IFNJTUQuRmxvYXQzMng0LmFkZChTSU1ELkZsb2F0MzJ4NC5tdWwocm93MywgdG1wMSksIG1pbm9yMCk7XG4gIG1pbm9yMyA9IFNJTUQuRmxvYXQzMng0Lm11bChyb3cwLCB0bXAxKTtcbiAgdG1wMSAgID0gU0lNRC5GbG9hdDMyeDQuc3dpenpsZSh0bXAxLCAyLCAzLCAwLCAxKTtcbiAgbWlub3IwID0gU0lNRC5GbG9hdDMyeDQuc3ViKG1pbm9yMCwgU0lNRC5GbG9hdDMyeDQubXVsKHJvdzMsIHRtcDEpKTtcbiAgbWlub3IzID0gU0lNRC5GbG9hdDMyeDQuc3ViKFNJTUQuRmxvYXQzMng0Lm11bChyb3cwLCB0bXAxKSwgbWlub3IzKTtcbiAgbWlub3IzID0gU0lNRC5GbG9hdDMyeDQuc3dpenpsZShtaW5vcjMsIDIsIDMsIDAsIDEpO1xuXG4gIHRtcDEgICA9IFNJTUQuRmxvYXQzMng0Lm11bChTSU1ELkZsb2F0MzJ4NC5zd2l6emxlKHJvdzEsIDIsIDMsIDAsIDEpLCByb3czKTtcbiAgdG1wMSAgID0gU0lNRC5GbG9hdDMyeDQuc3dpenpsZSh0bXAxLCAxLCAwLCAzLCAyKTtcbiAgcm93MiAgID0gU0lNRC5GbG9hdDMyeDQuc3dpenpsZShyb3cyLCAyLCAzLCAwLCAxKTtcbiAgbWlub3IwID0gU0lNRC5GbG9hdDMyeDQuYWRkKFNJTUQuRmxvYXQzMng0Lm11bChyb3cyLCB0bXAxKSwgbWlub3IwKTtcbiAgbWlub3IyID0gU0lNRC5GbG9hdDMyeDQubXVsKHJvdzAsIHRtcDEpO1xuICB0bXAxICAgPSBTSU1ELkZsb2F0MzJ4NC5zd2l6emxlKHRtcDEsIDIsIDMsIDAsIDEpO1xuICBtaW5vcjAgPSBTSU1ELkZsb2F0MzJ4NC5zdWIobWlub3IwLCBTSU1ELkZsb2F0MzJ4NC5tdWwocm93MiwgdG1wMSkpO1xuICBtaW5vcjIgPSBTSU1ELkZsb2F0MzJ4NC5zdWIoU0lNRC5GbG9hdDMyeDQubXVsKHJvdzAsIHRtcDEpLCBtaW5vcjIpO1xuICBtaW5vcjIgPSBTSU1ELkZsb2F0MzJ4NC5zd2l6emxlKG1pbm9yMiwgMiwgMywgMCwgMSk7XG5cbiAgdG1wMSAgID0gU0lNRC5GbG9hdDMyeDQubXVsKHJvdzAsIHJvdzEpO1xuICB0bXAxICAgPSBTSU1ELkZsb2F0MzJ4NC5zd2l6emxlKHRtcDEsIDEsIDAsIDMsIDIpO1xuICBtaW5vcjIgPSBTSU1ELkZsb2F0MzJ4NC5hZGQoU0lNRC5GbG9hdDMyeDQubXVsKHJvdzMsIHRtcDEpLCBtaW5vcjIpO1xuICBtaW5vcjMgPSBTSU1ELkZsb2F0MzJ4NC5zdWIoU0lNRC5GbG9hdDMyeDQubXVsKHJvdzIsIHRtcDEpLCBtaW5vcjMpO1xuICB0bXAxICAgPSBTSU1ELkZsb2F0MzJ4NC5zd2l6emxlKHRtcDEsIDIsIDMsIDAsIDEpO1xuICBtaW5vcjIgPSBTSU1ELkZsb2F0MzJ4NC5zdWIoU0lNRC5GbG9hdDMyeDQubXVsKHJvdzMsIHRtcDEpLCBtaW5vcjIpO1xuICBtaW5vcjMgPSBTSU1ELkZsb2F0MzJ4NC5zdWIobWlub3IzLCBTSU1ELkZsb2F0MzJ4NC5tdWwocm93MiwgdG1wMSkpO1xuXG4gIHRtcDEgICA9IFNJTUQuRmxvYXQzMng0Lm11bChyb3cwLCByb3czKTtcbiAgdG1wMSAgID0gU0lNRC5GbG9hdDMyeDQuc3dpenpsZSh0bXAxLCAxLCAwLCAzLCAyKTtcbiAgbWlub3IxID0gU0lNRC5GbG9hdDMyeDQuc3ViKG1pbm9yMSwgU0lNRC5GbG9hdDMyeDQubXVsKHJvdzIsIHRtcDEpKTtcbiAgbWlub3IyID0gU0lNRC5GbG9hdDMyeDQuYWRkKFNJTUQuRmxvYXQzMng0Lm11bChyb3cxLCB0bXAxKSwgbWlub3IyKTtcbiAgdG1wMSAgID0gU0lNRC5GbG9hdDMyeDQuc3dpenpsZSh0bXAxLCAyLCAzLCAwLCAxKTtcbiAgbWlub3IxID0gU0lNRC5GbG9hdDMyeDQuYWRkKFNJTUQuRmxvYXQzMng0Lm11bChyb3cyLCB0bXAxKSwgbWlub3IxKTtcbiAgbWlub3IyID0gU0lNRC5GbG9hdDMyeDQuc3ViKG1pbm9yMiwgU0lNRC5GbG9hdDMyeDQubXVsKHJvdzEsIHRtcDEpKTtcblxuICB0bXAxICAgPSBTSU1ELkZsb2F0MzJ4NC5tdWwocm93MCwgcm93Mik7XG4gIHRtcDEgICA9IFNJTUQuRmxvYXQzMng0LnN3aXp6bGUodG1wMSwgMSwgMCwgMywgMik7XG4gIG1pbm9yMSA9IFNJTUQuRmxvYXQzMng0LmFkZChTSU1ELkZsb2F0MzJ4NC5tdWwocm93MywgdG1wMSksIG1pbm9yMSk7XG4gIG1pbm9yMyA9IFNJTUQuRmxvYXQzMng0LnN1YihtaW5vcjMsIFNJTUQuRmxvYXQzMng0Lm11bChyb3cxLCB0bXAxKSk7XG4gIHRtcDEgICA9IFNJTUQuRmxvYXQzMng0LnN3aXp6bGUodG1wMSwgMiwgMywgMCwgMSk7XG4gIG1pbm9yMSA9IFNJTUQuRmxvYXQzMng0LnN1YihtaW5vcjEsIFNJTUQuRmxvYXQzMng0Lm11bChyb3czLCB0bXAxKSk7XG4gIG1pbm9yMyA9IFNJTUQuRmxvYXQzMng0LmFkZChTSU1ELkZsb2F0MzJ4NC5tdWwocm93MSwgdG1wMSksIG1pbm9yMyk7XG5cbiAgU0lNRC5GbG9hdDMyeDQuc3RvcmUob3V0LCAwLCAgbWlub3IwKTtcbiAgU0lNRC5GbG9hdDMyeDQuc3RvcmUob3V0LCA0LCAgbWlub3IxKTtcbiAgU0lNRC5GbG9hdDMyeDQuc3RvcmUob3V0LCA4LCAgbWlub3IyKTtcbiAgU0lNRC5GbG9hdDMyeDQuc3RvcmUob3V0LCAxMiwgbWlub3IzKTtcbiAgcmV0dXJuIG91dDtcbn07XG5cbi8qKlxuICogQ2FsY3VsYXRlcyB0aGUgYWRqdWdhdGUgb2YgYSBtYXQ0IHVzaW5nIFNJTUQgaWYgYXZhaWxhYmxlIGFuZCBlbmFibGVkXG4gKlxuICogQHBhcmFtIHttYXQ0fSBvdXQgdGhlIHJlY2VpdmluZyBtYXRyaXhcbiAqIEBwYXJhbSB7bWF0NH0gYSB0aGUgc291cmNlIG1hdHJpeFxuICogQHJldHVybnMge21hdDR9IG91dFxuICovXG4gbWF0NC5hZGpvaW50ID0gZ2xNYXRyaXguVVNFX1NJTUQgPyBtYXQ0LlNJTUQuYWRqb2ludCA6IG1hdDQuc2NhbGFyLmFkam9pbnQ7XG5cbi8qKlxuICogQ2FsY3VsYXRlcyB0aGUgZGV0ZXJtaW5hbnQgb2YgYSBtYXQ0XG4gKlxuICogQHBhcmFtIHttYXQ0fSBhIHRoZSBzb3VyY2UgbWF0cml4XG4gKiBAcmV0dXJucyB7TnVtYmVyfSBkZXRlcm1pbmFudCBvZiBhXG4gKi9cbm1hdDQuZGV0ZXJtaW5hbnQgPSBmdW5jdGlvbiAoYSkge1xuICAgIHZhciBhMDAgPSBhWzBdLCBhMDEgPSBhWzFdLCBhMDIgPSBhWzJdLCBhMDMgPSBhWzNdLFxuICAgICAgICBhMTAgPSBhWzRdLCBhMTEgPSBhWzVdLCBhMTIgPSBhWzZdLCBhMTMgPSBhWzddLFxuICAgICAgICBhMjAgPSBhWzhdLCBhMjEgPSBhWzldLCBhMjIgPSBhWzEwXSwgYTIzID0gYVsxMV0sXG4gICAgICAgIGEzMCA9IGFbMTJdLCBhMzEgPSBhWzEzXSwgYTMyID0gYVsxNF0sIGEzMyA9IGFbMTVdLFxuXG4gICAgICAgIGIwMCA9IGEwMCAqIGExMSAtIGEwMSAqIGExMCxcbiAgICAgICAgYjAxID0gYTAwICogYTEyIC0gYTAyICogYTEwLFxuICAgICAgICBiMDIgPSBhMDAgKiBhMTMgLSBhMDMgKiBhMTAsXG4gICAgICAgIGIwMyA9IGEwMSAqIGExMiAtIGEwMiAqIGExMSxcbiAgICAgICAgYjA0ID0gYTAxICogYTEzIC0gYTAzICogYTExLFxuICAgICAgICBiMDUgPSBhMDIgKiBhMTMgLSBhMDMgKiBhMTIsXG4gICAgICAgIGIwNiA9IGEyMCAqIGEzMSAtIGEyMSAqIGEzMCxcbiAgICAgICAgYjA3ID0gYTIwICogYTMyIC0gYTIyICogYTMwLFxuICAgICAgICBiMDggPSBhMjAgKiBhMzMgLSBhMjMgKiBhMzAsXG4gICAgICAgIGIwOSA9IGEyMSAqIGEzMiAtIGEyMiAqIGEzMSxcbiAgICAgICAgYjEwID0gYTIxICogYTMzIC0gYTIzICogYTMxLFxuICAgICAgICBiMTEgPSBhMjIgKiBhMzMgLSBhMjMgKiBhMzI7XG5cbiAgICAvLyBDYWxjdWxhdGUgdGhlIGRldGVybWluYW50XG4gICAgcmV0dXJuIGIwMCAqIGIxMSAtIGIwMSAqIGIxMCArIGIwMiAqIGIwOSArIGIwMyAqIGIwOCAtIGIwNCAqIGIwNyArIGIwNSAqIGIwNjtcbn07XG5cbi8qKlxuICogTXVsdGlwbGllcyB0d28gbWF0NCdzIGV4cGxpY2l0bHkgdXNpbmcgU0lNRFxuICpcbiAqIEBwYXJhbSB7bWF0NH0gb3V0IHRoZSByZWNlaXZpbmcgbWF0cml4XG4gKiBAcGFyYW0ge21hdDR9IGEgdGhlIGZpcnN0IG9wZXJhbmQsIG11c3QgYmUgYSBGbG9hdDMyQXJyYXlcbiAqIEBwYXJhbSB7bWF0NH0gYiB0aGUgc2Vjb25kIG9wZXJhbmQsIG11c3QgYmUgYSBGbG9hdDMyQXJyYXlcbiAqIEByZXR1cm5zIHttYXQ0fSBvdXRcbiAqL1xubWF0NC5TSU1ELm11bHRpcGx5ID0gZnVuY3Rpb24gKG91dCwgYSwgYikge1xuICAgIHZhciBhMCA9IFNJTUQuRmxvYXQzMng0LmxvYWQoYSwgMCk7XG4gICAgdmFyIGExID0gU0lNRC5GbG9hdDMyeDQubG9hZChhLCA0KTtcbiAgICB2YXIgYTIgPSBTSU1ELkZsb2F0MzJ4NC5sb2FkKGEsIDgpO1xuICAgIHZhciBhMyA9IFNJTUQuRmxvYXQzMng0LmxvYWQoYSwgMTIpO1xuXG4gICAgdmFyIGIwID0gU0lNRC5GbG9hdDMyeDQubG9hZChiLCAwKTtcbiAgICB2YXIgb3V0MCA9IFNJTUQuRmxvYXQzMng0LmFkZChcbiAgICAgICAgICAgICAgICAgICBTSU1ELkZsb2F0MzJ4NC5tdWwoU0lNRC5GbG9hdDMyeDQuc3dpenpsZShiMCwgMCwgMCwgMCwgMCksIGEwKSxcbiAgICAgICAgICAgICAgICAgICBTSU1ELkZsb2F0MzJ4NC5hZGQoXG4gICAgICAgICAgICAgICAgICAgICAgIFNJTUQuRmxvYXQzMng0Lm11bChTSU1ELkZsb2F0MzJ4NC5zd2l6emxlKGIwLCAxLCAxLCAxLCAxKSwgYTEpLFxuICAgICAgICAgICAgICAgICAgICAgICBTSU1ELkZsb2F0MzJ4NC5hZGQoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICBTSU1ELkZsb2F0MzJ4NC5tdWwoU0lNRC5GbG9hdDMyeDQuc3dpenpsZShiMCwgMiwgMiwgMiwgMiksIGEyKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgIFNJTUQuRmxvYXQzMng0Lm11bChTSU1ELkZsb2F0MzJ4NC5zd2l6emxlKGIwLCAzLCAzLCAzLCAzKSwgYTMpKSkpO1xuICAgIFNJTUQuRmxvYXQzMng0LnN0b3JlKG91dCwgMCwgb3V0MCk7XG5cbiAgICB2YXIgYjEgPSBTSU1ELkZsb2F0MzJ4NC5sb2FkKGIsIDQpO1xuICAgIHZhciBvdXQxID0gU0lNRC5GbG9hdDMyeDQuYWRkKFxuICAgICAgICAgICAgICAgICAgIFNJTUQuRmxvYXQzMng0Lm11bChTSU1ELkZsb2F0MzJ4NC5zd2l6emxlKGIxLCAwLCAwLCAwLCAwKSwgYTApLFxuICAgICAgICAgICAgICAgICAgIFNJTUQuRmxvYXQzMng0LmFkZChcbiAgICAgICAgICAgICAgICAgICAgICAgU0lNRC5GbG9hdDMyeDQubXVsKFNJTUQuRmxvYXQzMng0LnN3aXp6bGUoYjEsIDEsIDEsIDEsIDEpLCBhMSksXG4gICAgICAgICAgICAgICAgICAgICAgIFNJTUQuRmxvYXQzMng0LmFkZChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgIFNJTUQuRmxvYXQzMng0Lm11bChTSU1ELkZsb2F0MzJ4NC5zd2l6emxlKGIxLCAyLCAyLCAyLCAyKSwgYTIpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgU0lNRC5GbG9hdDMyeDQubXVsKFNJTUQuRmxvYXQzMng0LnN3aXp6bGUoYjEsIDMsIDMsIDMsIDMpLCBhMykpKSk7XG4gICAgU0lNRC5GbG9hdDMyeDQuc3RvcmUob3V0LCA0LCBvdXQxKTtcblxuICAgIHZhciBiMiA9IFNJTUQuRmxvYXQzMng0LmxvYWQoYiwgOCk7XG4gICAgdmFyIG91dDIgPSBTSU1ELkZsb2F0MzJ4NC5hZGQoXG4gICAgICAgICAgICAgICAgICAgU0lNRC5GbG9hdDMyeDQubXVsKFNJTUQuRmxvYXQzMng0LnN3aXp6bGUoYjIsIDAsIDAsIDAsIDApLCBhMCksXG4gICAgICAgICAgICAgICAgICAgU0lNRC5GbG9hdDMyeDQuYWRkKFxuICAgICAgICAgICAgICAgICAgICAgICBTSU1ELkZsb2F0MzJ4NC5tdWwoU0lNRC5GbG9hdDMyeDQuc3dpenpsZShiMiwgMSwgMSwgMSwgMSksIGExKSxcbiAgICAgICAgICAgICAgICAgICAgICAgU0lNRC5GbG9hdDMyeDQuYWRkKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNJTUQuRmxvYXQzMng0Lm11bChTSU1ELkZsb2F0MzJ4NC5zd2l6emxlKGIyLCAyLCAyLCAyLCAyKSwgYTIpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNJTUQuRmxvYXQzMng0Lm11bChTSU1ELkZsb2F0MzJ4NC5zd2l6emxlKGIyLCAzLCAzLCAzLCAzKSwgYTMpKSkpO1xuICAgIFNJTUQuRmxvYXQzMng0LnN0b3JlKG91dCwgOCwgb3V0Mik7XG5cbiAgICB2YXIgYjMgPSBTSU1ELkZsb2F0MzJ4NC5sb2FkKGIsIDEyKTtcbiAgICB2YXIgb3V0MyA9IFNJTUQuRmxvYXQzMng0LmFkZChcbiAgICAgICAgICAgICAgICAgICBTSU1ELkZsb2F0MzJ4NC5tdWwoU0lNRC5GbG9hdDMyeDQuc3dpenpsZShiMywgMCwgMCwgMCwgMCksIGEwKSxcbiAgICAgICAgICAgICAgICAgICBTSU1ELkZsb2F0MzJ4NC5hZGQoXG4gICAgICAgICAgICAgICAgICAgICAgICBTSU1ELkZsb2F0MzJ4NC5tdWwoU0lNRC5GbG9hdDMyeDQuc3dpenpsZShiMywgMSwgMSwgMSwgMSksIGExKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFNJTUQuRmxvYXQzMng0LmFkZChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBTSU1ELkZsb2F0MzJ4NC5tdWwoU0lNRC5GbG9hdDMyeDQuc3dpenpsZShiMywgMiwgMiwgMiwgMiksIGEyKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBTSU1ELkZsb2F0MzJ4NC5tdWwoU0lNRC5GbG9hdDMyeDQuc3dpenpsZShiMywgMywgMywgMywgMyksIGEzKSkpKTtcbiAgICBTSU1ELkZsb2F0MzJ4NC5zdG9yZShvdXQsIDEyLCBvdXQzKTtcblxuICAgIHJldHVybiBvdXQ7XG59O1xuXG4vKipcbiAqIE11bHRpcGxpZXMgdHdvIG1hdDQncyBleHBsaWNpdGx5IG5vdCB1c2luZyBTSU1EXG4gKlxuICogQHBhcmFtIHttYXQ0fSBvdXQgdGhlIHJlY2VpdmluZyBtYXRyaXhcbiAqIEBwYXJhbSB7bWF0NH0gYSB0aGUgZmlyc3Qgb3BlcmFuZFxuICogQHBhcmFtIHttYXQ0fSBiIHRoZSBzZWNvbmQgb3BlcmFuZFxuICogQHJldHVybnMge21hdDR9IG91dFxuICovXG5tYXQ0LnNjYWxhci5tdWx0aXBseSA9IGZ1bmN0aW9uIChvdXQsIGEsIGIpIHtcbiAgICB2YXIgYTAwID0gYVswXSwgYTAxID0gYVsxXSwgYTAyID0gYVsyXSwgYTAzID0gYVszXSxcbiAgICAgICAgYTEwID0gYVs0XSwgYTExID0gYVs1XSwgYTEyID0gYVs2XSwgYTEzID0gYVs3XSxcbiAgICAgICAgYTIwID0gYVs4XSwgYTIxID0gYVs5XSwgYTIyID0gYVsxMF0sIGEyMyA9IGFbMTFdLFxuICAgICAgICBhMzAgPSBhWzEyXSwgYTMxID0gYVsxM10sIGEzMiA9IGFbMTRdLCBhMzMgPSBhWzE1XTtcblxuICAgIC8vIENhY2hlIG9ubHkgdGhlIGN1cnJlbnQgbGluZSBvZiB0aGUgc2Vjb25kIG1hdHJpeFxuICAgIHZhciBiMCAgPSBiWzBdLCBiMSA9IGJbMV0sIGIyID0gYlsyXSwgYjMgPSBiWzNdO1xuICAgIG91dFswXSA9IGIwKmEwMCArIGIxKmExMCArIGIyKmEyMCArIGIzKmEzMDtcbiAgICBvdXRbMV0gPSBiMCphMDEgKyBiMSphMTEgKyBiMiphMjEgKyBiMyphMzE7XG4gICAgb3V0WzJdID0gYjAqYTAyICsgYjEqYTEyICsgYjIqYTIyICsgYjMqYTMyO1xuICAgIG91dFszXSA9IGIwKmEwMyArIGIxKmExMyArIGIyKmEyMyArIGIzKmEzMztcblxuICAgIGIwID0gYls0XTsgYjEgPSBiWzVdOyBiMiA9IGJbNl07IGIzID0gYls3XTtcbiAgICBvdXRbNF0gPSBiMCphMDAgKyBiMSphMTAgKyBiMiphMjAgKyBiMyphMzA7XG4gICAgb3V0WzVdID0gYjAqYTAxICsgYjEqYTExICsgYjIqYTIxICsgYjMqYTMxO1xuICAgIG91dFs2XSA9IGIwKmEwMiArIGIxKmExMiArIGIyKmEyMiArIGIzKmEzMjtcbiAgICBvdXRbN10gPSBiMCphMDMgKyBiMSphMTMgKyBiMiphMjMgKyBiMyphMzM7XG5cbiAgICBiMCA9IGJbOF07IGIxID0gYls5XTsgYjIgPSBiWzEwXTsgYjMgPSBiWzExXTtcbiAgICBvdXRbOF0gPSBiMCphMDAgKyBiMSphMTAgKyBiMiphMjAgKyBiMyphMzA7XG4gICAgb3V0WzldID0gYjAqYTAxICsgYjEqYTExICsgYjIqYTIxICsgYjMqYTMxO1xuICAgIG91dFsxMF0gPSBiMCphMDIgKyBiMSphMTIgKyBiMiphMjIgKyBiMyphMzI7XG4gICAgb3V0WzExXSA9IGIwKmEwMyArIGIxKmExMyArIGIyKmEyMyArIGIzKmEzMztcblxuICAgIGIwID0gYlsxMl07IGIxID0gYlsxM107IGIyID0gYlsxNF07IGIzID0gYlsxNV07XG4gICAgb3V0WzEyXSA9IGIwKmEwMCArIGIxKmExMCArIGIyKmEyMCArIGIzKmEzMDtcbiAgICBvdXRbMTNdID0gYjAqYTAxICsgYjEqYTExICsgYjIqYTIxICsgYjMqYTMxO1xuICAgIG91dFsxNF0gPSBiMCphMDIgKyBiMSphMTIgKyBiMiphMjIgKyBiMyphMzI7XG4gICAgb3V0WzE1XSA9IGIwKmEwMyArIGIxKmExMyArIGIyKmEyMyArIGIzKmEzMztcbiAgICByZXR1cm4gb3V0O1xufTtcblxuLyoqXG4gKiBNdWx0aXBsaWVzIHR3byBtYXQ0J3MgdXNpbmcgU0lNRCBpZiBhdmFpbGFibGUgYW5kIGVuYWJsZWRcbiAqXG4gKiBAcGFyYW0ge21hdDR9IG91dCB0aGUgcmVjZWl2aW5nIG1hdHJpeFxuICogQHBhcmFtIHttYXQ0fSBhIHRoZSBmaXJzdCBvcGVyYW5kXG4gKiBAcGFyYW0ge21hdDR9IGIgdGhlIHNlY29uZCBvcGVyYW5kXG4gKiBAcmV0dXJucyB7bWF0NH0gb3V0XG4gKi9cbm1hdDQubXVsdGlwbHkgPSBnbE1hdHJpeC5VU0VfU0lNRCA/IG1hdDQuU0lNRC5tdWx0aXBseSA6IG1hdDQuc2NhbGFyLm11bHRpcGx5O1xuXG4vKipcbiAqIEFsaWFzIGZvciB7QGxpbmsgbWF0NC5tdWx0aXBseX1cbiAqIEBmdW5jdGlvblxuICovXG5tYXQ0Lm11bCA9IG1hdDQubXVsdGlwbHk7XG5cbi8qKlxuICogVHJhbnNsYXRlIGEgbWF0NCBieSB0aGUgZ2l2ZW4gdmVjdG9yIG5vdCB1c2luZyBTSU1EXG4gKlxuICogQHBhcmFtIHttYXQ0fSBvdXQgdGhlIHJlY2VpdmluZyBtYXRyaXhcbiAqIEBwYXJhbSB7bWF0NH0gYSB0aGUgbWF0cml4IHRvIHRyYW5zbGF0ZVxuICogQHBhcmFtIHt2ZWMzfSB2IHZlY3RvciB0byB0cmFuc2xhdGUgYnlcbiAqIEByZXR1cm5zIHttYXQ0fSBvdXRcbiAqL1xubWF0NC5zY2FsYXIudHJhbnNsYXRlID0gZnVuY3Rpb24gKG91dCwgYSwgdikge1xuICAgIHZhciB4ID0gdlswXSwgeSA9IHZbMV0sIHogPSB2WzJdLFxuICAgICAgICBhMDAsIGEwMSwgYTAyLCBhMDMsXG4gICAgICAgIGExMCwgYTExLCBhMTIsIGExMyxcbiAgICAgICAgYTIwLCBhMjEsIGEyMiwgYTIzO1xuXG4gICAgaWYgKGEgPT09IG91dCkge1xuICAgICAgICBvdXRbMTJdID0gYVswXSAqIHggKyBhWzRdICogeSArIGFbOF0gKiB6ICsgYVsxMl07XG4gICAgICAgIG91dFsxM10gPSBhWzFdICogeCArIGFbNV0gKiB5ICsgYVs5XSAqIHogKyBhWzEzXTtcbiAgICAgICAgb3V0WzE0XSA9IGFbMl0gKiB4ICsgYVs2XSAqIHkgKyBhWzEwXSAqIHogKyBhWzE0XTtcbiAgICAgICAgb3V0WzE1XSA9IGFbM10gKiB4ICsgYVs3XSAqIHkgKyBhWzExXSAqIHogKyBhWzE1XTtcbiAgICB9IGVsc2Uge1xuICAgICAgICBhMDAgPSBhWzBdOyBhMDEgPSBhWzFdOyBhMDIgPSBhWzJdOyBhMDMgPSBhWzNdO1xuICAgICAgICBhMTAgPSBhWzRdOyBhMTEgPSBhWzVdOyBhMTIgPSBhWzZdOyBhMTMgPSBhWzddO1xuICAgICAgICBhMjAgPSBhWzhdOyBhMjEgPSBhWzldOyBhMjIgPSBhWzEwXTsgYTIzID0gYVsxMV07XG5cbiAgICAgICAgb3V0WzBdID0gYTAwOyBvdXRbMV0gPSBhMDE7IG91dFsyXSA9IGEwMjsgb3V0WzNdID0gYTAzO1xuICAgICAgICBvdXRbNF0gPSBhMTA7IG91dFs1XSA9IGExMTsgb3V0WzZdID0gYTEyOyBvdXRbN10gPSBhMTM7XG4gICAgICAgIG91dFs4XSA9IGEyMDsgb3V0WzldID0gYTIxOyBvdXRbMTBdID0gYTIyOyBvdXRbMTFdID0gYTIzO1xuXG4gICAgICAgIG91dFsxMl0gPSBhMDAgKiB4ICsgYTEwICogeSArIGEyMCAqIHogKyBhWzEyXTtcbiAgICAgICAgb3V0WzEzXSA9IGEwMSAqIHggKyBhMTEgKiB5ICsgYTIxICogeiArIGFbMTNdO1xuICAgICAgICBvdXRbMTRdID0gYTAyICogeCArIGExMiAqIHkgKyBhMjIgKiB6ICsgYVsxNF07XG4gICAgICAgIG91dFsxNV0gPSBhMDMgKiB4ICsgYTEzICogeSArIGEyMyAqIHogKyBhWzE1XTtcbiAgICB9XG5cbiAgICByZXR1cm4gb3V0O1xufTtcblxuLyoqXG4gKiBUcmFuc2xhdGVzIGEgbWF0NCBieSB0aGUgZ2l2ZW4gdmVjdG9yIHVzaW5nIFNJTURcbiAqXG4gKiBAcGFyYW0ge21hdDR9IG91dCB0aGUgcmVjZWl2aW5nIG1hdHJpeFxuICogQHBhcmFtIHttYXQ0fSBhIHRoZSBtYXRyaXggdG8gdHJhbnNsYXRlXG4gKiBAcGFyYW0ge3ZlYzN9IHYgdmVjdG9yIHRvIHRyYW5zbGF0ZSBieVxuICogQHJldHVybnMge21hdDR9IG91dFxuICovXG5tYXQ0LlNJTUQudHJhbnNsYXRlID0gZnVuY3Rpb24gKG91dCwgYSwgdikge1xuICAgIHZhciBhMCA9IFNJTUQuRmxvYXQzMng0LmxvYWQoYSwgMCksXG4gICAgICAgIGExID0gU0lNRC5GbG9hdDMyeDQubG9hZChhLCA0KSxcbiAgICAgICAgYTIgPSBTSU1ELkZsb2F0MzJ4NC5sb2FkKGEsIDgpLFxuICAgICAgICBhMyA9IFNJTUQuRmxvYXQzMng0LmxvYWQoYSwgMTIpLFxuICAgICAgICB2ZWMgPSBTSU1ELkZsb2F0MzJ4NCh2WzBdLCB2WzFdLCB2WzJdICwgMCk7XG5cbiAgICBpZiAoYSAhPT0gb3V0KSB7XG4gICAgICAgIG91dFswXSA9IGFbMF07IG91dFsxXSA9IGFbMV07IG91dFsyXSA9IGFbMl07IG91dFszXSA9IGFbM107XG4gICAgICAgIG91dFs0XSA9IGFbNF07IG91dFs1XSA9IGFbNV07IG91dFs2XSA9IGFbNl07IG91dFs3XSA9IGFbN107XG4gICAgICAgIG91dFs4XSA9IGFbOF07IG91dFs5XSA9IGFbOV07IG91dFsxMF0gPSBhWzEwXTsgb3V0WzExXSA9IGFbMTFdO1xuICAgIH1cblxuICAgIGEwID0gU0lNRC5GbG9hdDMyeDQubXVsKGEwLCBTSU1ELkZsb2F0MzJ4NC5zd2l6emxlKHZlYywgMCwgMCwgMCwgMCkpO1xuICAgIGExID0gU0lNRC5GbG9hdDMyeDQubXVsKGExLCBTSU1ELkZsb2F0MzJ4NC5zd2l6emxlKHZlYywgMSwgMSwgMSwgMSkpO1xuICAgIGEyID0gU0lNRC5GbG9hdDMyeDQubXVsKGEyLCBTSU1ELkZsb2F0MzJ4NC5zd2l6emxlKHZlYywgMiwgMiwgMiwgMikpO1xuXG4gICAgdmFyIHQwID0gU0lNRC5GbG9hdDMyeDQuYWRkKGEwLCBTSU1ELkZsb2F0MzJ4NC5hZGQoYTEsIFNJTUQuRmxvYXQzMng0LmFkZChhMiwgYTMpKSk7XG4gICAgU0lNRC5GbG9hdDMyeDQuc3RvcmUob3V0LCAxMiwgdDApO1xuXG4gICAgcmV0dXJuIG91dDtcbn07XG5cbi8qKlxuICogVHJhbnNsYXRlcyBhIG1hdDQgYnkgdGhlIGdpdmVuIHZlY3RvciB1c2luZyBTSU1EIGlmIGF2YWlsYWJsZSBhbmQgZW5hYmxlZFxuICpcbiAqIEBwYXJhbSB7bWF0NH0gb3V0IHRoZSByZWNlaXZpbmcgbWF0cml4XG4gKiBAcGFyYW0ge21hdDR9IGEgdGhlIG1hdHJpeCB0byB0cmFuc2xhdGVcbiAqIEBwYXJhbSB7dmVjM30gdiB2ZWN0b3IgdG8gdHJhbnNsYXRlIGJ5XG4gKiBAcmV0dXJucyB7bWF0NH0gb3V0XG4gKi9cbm1hdDQudHJhbnNsYXRlID0gZ2xNYXRyaXguVVNFX1NJTUQgPyBtYXQ0LlNJTUQudHJhbnNsYXRlIDogbWF0NC5zY2FsYXIudHJhbnNsYXRlO1xuXG4vKipcbiAqIFNjYWxlcyB0aGUgbWF0NCBieSB0aGUgZGltZW5zaW9ucyBpbiB0aGUgZ2l2ZW4gdmVjMyBub3QgdXNpbmcgdmVjdG9yaXphdGlvblxuICpcbiAqIEBwYXJhbSB7bWF0NH0gb3V0IHRoZSByZWNlaXZpbmcgbWF0cml4XG4gKiBAcGFyYW0ge21hdDR9IGEgdGhlIG1hdHJpeCB0byBzY2FsZVxuICogQHBhcmFtIHt2ZWMzfSB2IHRoZSB2ZWMzIHRvIHNjYWxlIHRoZSBtYXRyaXggYnlcbiAqIEByZXR1cm5zIHttYXQ0fSBvdXRcbiAqKi9cbm1hdDQuc2NhbGFyLnNjYWxlID0gZnVuY3Rpb24ob3V0LCBhLCB2KSB7XG4gICAgdmFyIHggPSB2WzBdLCB5ID0gdlsxXSwgeiA9IHZbMl07XG5cbiAgICBvdXRbMF0gPSBhWzBdICogeDtcbiAgICBvdXRbMV0gPSBhWzFdICogeDtcbiAgICBvdXRbMl0gPSBhWzJdICogeDtcbiAgICBvdXRbM10gPSBhWzNdICogeDtcbiAgICBvdXRbNF0gPSBhWzRdICogeTtcbiAgICBvdXRbNV0gPSBhWzVdICogeTtcbiAgICBvdXRbNl0gPSBhWzZdICogeTtcbiAgICBvdXRbN10gPSBhWzddICogeTtcbiAgICBvdXRbOF0gPSBhWzhdICogejtcbiAgICBvdXRbOV0gPSBhWzldICogejtcbiAgICBvdXRbMTBdID0gYVsxMF0gKiB6O1xuICAgIG91dFsxMV0gPSBhWzExXSAqIHo7XG4gICAgb3V0WzEyXSA9IGFbMTJdO1xuICAgIG91dFsxM10gPSBhWzEzXTtcbiAgICBvdXRbMTRdID0gYVsxNF07XG4gICAgb3V0WzE1XSA9IGFbMTVdO1xuICAgIHJldHVybiBvdXQ7XG59O1xuXG4vKipcbiAqIFNjYWxlcyB0aGUgbWF0NCBieSB0aGUgZGltZW5zaW9ucyBpbiB0aGUgZ2l2ZW4gdmVjMyB1c2luZyB2ZWN0b3JpemF0aW9uXG4gKlxuICogQHBhcmFtIHttYXQ0fSBvdXQgdGhlIHJlY2VpdmluZyBtYXRyaXhcbiAqIEBwYXJhbSB7bWF0NH0gYSB0aGUgbWF0cml4IHRvIHNjYWxlXG4gKiBAcGFyYW0ge3ZlYzN9IHYgdGhlIHZlYzMgdG8gc2NhbGUgdGhlIG1hdHJpeCBieVxuICogQHJldHVybnMge21hdDR9IG91dFxuICoqL1xubWF0NC5TSU1ELnNjYWxlID0gZnVuY3Rpb24ob3V0LCBhLCB2KSB7XG4gICAgdmFyIGEwLCBhMSwgYTI7XG4gICAgdmFyIHZlYyA9IFNJTUQuRmxvYXQzMng0KHZbMF0sIHZbMV0sIHZbMl0sIDApO1xuXG4gICAgYTAgPSBTSU1ELkZsb2F0MzJ4NC5sb2FkKGEsIDApO1xuICAgIFNJTUQuRmxvYXQzMng0LnN0b3JlKFxuICAgICAgICBvdXQsIDAsIFNJTUQuRmxvYXQzMng0Lm11bChhMCwgU0lNRC5GbG9hdDMyeDQuc3dpenpsZSh2ZWMsIDAsIDAsIDAsIDApKSk7XG5cbiAgICBhMSA9IFNJTUQuRmxvYXQzMng0LmxvYWQoYSwgNCk7XG4gICAgU0lNRC5GbG9hdDMyeDQuc3RvcmUoXG4gICAgICAgIG91dCwgNCwgU0lNRC5GbG9hdDMyeDQubXVsKGExLCBTSU1ELkZsb2F0MzJ4NC5zd2l6emxlKHZlYywgMSwgMSwgMSwgMSkpKTtcblxuICAgIGEyID0gU0lNRC5GbG9hdDMyeDQubG9hZChhLCA4KTtcbiAgICBTSU1ELkZsb2F0MzJ4NC5zdG9yZShcbiAgICAgICAgb3V0LCA4LCBTSU1ELkZsb2F0MzJ4NC5tdWwoYTIsIFNJTUQuRmxvYXQzMng0LnN3aXp6bGUodmVjLCAyLCAyLCAyLCAyKSkpO1xuXG4gICAgb3V0WzEyXSA9IGFbMTJdO1xuICAgIG91dFsxM10gPSBhWzEzXTtcbiAgICBvdXRbMTRdID0gYVsxNF07XG4gICAgb3V0WzE1XSA9IGFbMTVdO1xuICAgIHJldHVybiBvdXQ7XG59O1xuXG4vKipcbiAqIFNjYWxlcyB0aGUgbWF0NCBieSB0aGUgZGltZW5zaW9ucyBpbiB0aGUgZ2l2ZW4gdmVjMyB1c2luZyBTSU1EIGlmIGF2YWlsYWJsZSBhbmQgZW5hYmxlZFxuICpcbiAqIEBwYXJhbSB7bWF0NH0gb3V0IHRoZSByZWNlaXZpbmcgbWF0cml4XG4gKiBAcGFyYW0ge21hdDR9IGEgdGhlIG1hdHJpeCB0byBzY2FsZVxuICogQHBhcmFtIHt2ZWMzfSB2IHRoZSB2ZWMzIHRvIHNjYWxlIHRoZSBtYXRyaXggYnlcbiAqIEByZXR1cm5zIHttYXQ0fSBvdXRcbiAqL1xubWF0NC5zY2FsZSA9IGdsTWF0cml4LlVTRV9TSU1EID8gbWF0NC5TSU1ELnNjYWxlIDogbWF0NC5zY2FsYXIuc2NhbGU7XG5cbi8qKlxuICogUm90YXRlcyBhIG1hdDQgYnkgdGhlIGdpdmVuIGFuZ2xlIGFyb3VuZCB0aGUgZ2l2ZW4gYXhpc1xuICpcbiAqIEBwYXJhbSB7bWF0NH0gb3V0IHRoZSByZWNlaXZpbmcgbWF0cml4XG4gKiBAcGFyYW0ge21hdDR9IGEgdGhlIG1hdHJpeCB0byByb3RhdGVcbiAqIEBwYXJhbSB7TnVtYmVyfSByYWQgdGhlIGFuZ2xlIHRvIHJvdGF0ZSB0aGUgbWF0cml4IGJ5XG4gKiBAcGFyYW0ge3ZlYzN9IGF4aXMgdGhlIGF4aXMgdG8gcm90YXRlIGFyb3VuZFxuICogQHJldHVybnMge21hdDR9IG91dFxuICovXG5tYXQ0LnJvdGF0ZSA9IGZ1bmN0aW9uIChvdXQsIGEsIHJhZCwgYXhpcykge1xuICAgIHZhciB4ID0gYXhpc1swXSwgeSA9IGF4aXNbMV0sIHogPSBheGlzWzJdLFxuICAgICAgICBsZW4gPSBNYXRoLnNxcnQoeCAqIHggKyB5ICogeSArIHogKiB6KSxcbiAgICAgICAgcywgYywgdCxcbiAgICAgICAgYTAwLCBhMDEsIGEwMiwgYTAzLFxuICAgICAgICBhMTAsIGExMSwgYTEyLCBhMTMsXG4gICAgICAgIGEyMCwgYTIxLCBhMjIsIGEyMyxcbiAgICAgICAgYjAwLCBiMDEsIGIwMixcbiAgICAgICAgYjEwLCBiMTEsIGIxMixcbiAgICAgICAgYjIwLCBiMjEsIGIyMjtcblxuICAgIGlmIChNYXRoLmFicyhsZW4pIDwgZ2xNYXRyaXguRVBTSUxPTikgeyByZXR1cm4gbnVsbDsgfVxuXG4gICAgbGVuID0gMSAvIGxlbjtcbiAgICB4ICo9IGxlbjtcbiAgICB5ICo9IGxlbjtcbiAgICB6ICo9IGxlbjtcblxuICAgIHMgPSBNYXRoLnNpbihyYWQpO1xuICAgIGMgPSBNYXRoLmNvcyhyYWQpO1xuICAgIHQgPSAxIC0gYztcblxuICAgIGEwMCA9IGFbMF07IGEwMSA9IGFbMV07IGEwMiA9IGFbMl07IGEwMyA9IGFbM107XG4gICAgYTEwID0gYVs0XTsgYTExID0gYVs1XTsgYTEyID0gYVs2XTsgYTEzID0gYVs3XTtcbiAgICBhMjAgPSBhWzhdOyBhMjEgPSBhWzldOyBhMjIgPSBhWzEwXTsgYTIzID0gYVsxMV07XG5cbiAgICAvLyBDb25zdHJ1Y3QgdGhlIGVsZW1lbnRzIG9mIHRoZSByb3RhdGlvbiBtYXRyaXhcbiAgICBiMDAgPSB4ICogeCAqIHQgKyBjOyBiMDEgPSB5ICogeCAqIHQgKyB6ICogczsgYjAyID0geiAqIHggKiB0IC0geSAqIHM7XG4gICAgYjEwID0geCAqIHkgKiB0IC0geiAqIHM7IGIxMSA9IHkgKiB5ICogdCArIGM7IGIxMiA9IHogKiB5ICogdCArIHggKiBzO1xuICAgIGIyMCA9IHggKiB6ICogdCArIHkgKiBzOyBiMjEgPSB5ICogeiAqIHQgLSB4ICogczsgYjIyID0geiAqIHogKiB0ICsgYztcblxuICAgIC8vIFBlcmZvcm0gcm90YXRpb24tc3BlY2lmaWMgbWF0cml4IG11bHRpcGxpY2F0aW9uXG4gICAgb3V0WzBdID0gYTAwICogYjAwICsgYTEwICogYjAxICsgYTIwICogYjAyO1xuICAgIG91dFsxXSA9IGEwMSAqIGIwMCArIGExMSAqIGIwMSArIGEyMSAqIGIwMjtcbiAgICBvdXRbMl0gPSBhMDIgKiBiMDAgKyBhMTIgKiBiMDEgKyBhMjIgKiBiMDI7XG4gICAgb3V0WzNdID0gYTAzICogYjAwICsgYTEzICogYjAxICsgYTIzICogYjAyO1xuICAgIG91dFs0XSA9IGEwMCAqIGIxMCArIGExMCAqIGIxMSArIGEyMCAqIGIxMjtcbiAgICBvdXRbNV0gPSBhMDEgKiBiMTAgKyBhMTEgKiBiMTEgKyBhMjEgKiBiMTI7XG4gICAgb3V0WzZdID0gYTAyICogYjEwICsgYTEyICogYjExICsgYTIyICogYjEyO1xuICAgIG91dFs3XSA9IGEwMyAqIGIxMCArIGExMyAqIGIxMSArIGEyMyAqIGIxMjtcbiAgICBvdXRbOF0gPSBhMDAgKiBiMjAgKyBhMTAgKiBiMjEgKyBhMjAgKiBiMjI7XG4gICAgb3V0WzldID0gYTAxICogYjIwICsgYTExICogYjIxICsgYTIxICogYjIyO1xuICAgIG91dFsxMF0gPSBhMDIgKiBiMjAgKyBhMTIgKiBiMjEgKyBhMjIgKiBiMjI7XG4gICAgb3V0WzExXSA9IGEwMyAqIGIyMCArIGExMyAqIGIyMSArIGEyMyAqIGIyMjtcblxuICAgIGlmIChhICE9PSBvdXQpIHsgLy8gSWYgdGhlIHNvdXJjZSBhbmQgZGVzdGluYXRpb24gZGlmZmVyLCBjb3B5IHRoZSB1bmNoYW5nZWQgbGFzdCByb3dcbiAgICAgICAgb3V0WzEyXSA9IGFbMTJdO1xuICAgICAgICBvdXRbMTNdID0gYVsxM107XG4gICAgICAgIG91dFsxNF0gPSBhWzE0XTtcbiAgICAgICAgb3V0WzE1XSA9IGFbMTVdO1xuICAgIH1cbiAgICByZXR1cm4gb3V0O1xufTtcblxuLyoqXG4gKiBSb3RhdGVzIGEgbWF0cml4IGJ5IHRoZSBnaXZlbiBhbmdsZSBhcm91bmQgdGhlIFggYXhpcyBub3QgdXNpbmcgU0lNRFxuICpcbiAqIEBwYXJhbSB7bWF0NH0gb3V0IHRoZSByZWNlaXZpbmcgbWF0cml4XG4gKiBAcGFyYW0ge21hdDR9IGEgdGhlIG1hdHJpeCB0byByb3RhdGVcbiAqIEBwYXJhbSB7TnVtYmVyfSByYWQgdGhlIGFuZ2xlIHRvIHJvdGF0ZSB0aGUgbWF0cml4IGJ5XG4gKiBAcmV0dXJucyB7bWF0NH0gb3V0XG4gKi9cbm1hdDQuc2NhbGFyLnJvdGF0ZVggPSBmdW5jdGlvbiAob3V0LCBhLCByYWQpIHtcbiAgICB2YXIgcyA9IE1hdGguc2luKHJhZCksXG4gICAgICAgIGMgPSBNYXRoLmNvcyhyYWQpLFxuICAgICAgICBhMTAgPSBhWzRdLFxuICAgICAgICBhMTEgPSBhWzVdLFxuICAgICAgICBhMTIgPSBhWzZdLFxuICAgICAgICBhMTMgPSBhWzddLFxuICAgICAgICBhMjAgPSBhWzhdLFxuICAgICAgICBhMjEgPSBhWzldLFxuICAgICAgICBhMjIgPSBhWzEwXSxcbiAgICAgICAgYTIzID0gYVsxMV07XG5cbiAgICBpZiAoYSAhPT0gb3V0KSB7IC8vIElmIHRoZSBzb3VyY2UgYW5kIGRlc3RpbmF0aW9uIGRpZmZlciwgY29weSB0aGUgdW5jaGFuZ2VkIHJvd3NcbiAgICAgICAgb3V0WzBdICA9IGFbMF07XG4gICAgICAgIG91dFsxXSAgPSBhWzFdO1xuICAgICAgICBvdXRbMl0gID0gYVsyXTtcbiAgICAgICAgb3V0WzNdICA9IGFbM107XG4gICAgICAgIG91dFsxMl0gPSBhWzEyXTtcbiAgICAgICAgb3V0WzEzXSA9IGFbMTNdO1xuICAgICAgICBvdXRbMTRdID0gYVsxNF07XG4gICAgICAgIG91dFsxNV0gPSBhWzE1XTtcbiAgICB9XG5cbiAgICAvLyBQZXJmb3JtIGF4aXMtc3BlY2lmaWMgbWF0cml4IG11bHRpcGxpY2F0aW9uXG4gICAgb3V0WzRdID0gYTEwICogYyArIGEyMCAqIHM7XG4gICAgb3V0WzVdID0gYTExICogYyArIGEyMSAqIHM7XG4gICAgb3V0WzZdID0gYTEyICogYyArIGEyMiAqIHM7XG4gICAgb3V0WzddID0gYTEzICogYyArIGEyMyAqIHM7XG4gICAgb3V0WzhdID0gYTIwICogYyAtIGExMCAqIHM7XG4gICAgb3V0WzldID0gYTIxICogYyAtIGExMSAqIHM7XG4gICAgb3V0WzEwXSA9IGEyMiAqIGMgLSBhMTIgKiBzO1xuICAgIG91dFsxMV0gPSBhMjMgKiBjIC0gYTEzICogcztcbiAgICByZXR1cm4gb3V0O1xufTtcblxuLyoqXG4gKiBSb3RhdGVzIGEgbWF0cml4IGJ5IHRoZSBnaXZlbiBhbmdsZSBhcm91bmQgdGhlIFggYXhpcyB1c2luZyBTSU1EXG4gKlxuICogQHBhcmFtIHttYXQ0fSBvdXQgdGhlIHJlY2VpdmluZyBtYXRyaXhcbiAqIEBwYXJhbSB7bWF0NH0gYSB0aGUgbWF0cml4IHRvIHJvdGF0ZVxuICogQHBhcmFtIHtOdW1iZXJ9IHJhZCB0aGUgYW5nbGUgdG8gcm90YXRlIHRoZSBtYXRyaXggYnlcbiAqIEByZXR1cm5zIHttYXQ0fSBvdXRcbiAqL1xubWF0NC5TSU1ELnJvdGF0ZVggPSBmdW5jdGlvbiAob3V0LCBhLCByYWQpIHtcbiAgICB2YXIgcyA9IFNJTUQuRmxvYXQzMng0LnNwbGF0KE1hdGguc2luKHJhZCkpLFxuICAgICAgICBjID0gU0lNRC5GbG9hdDMyeDQuc3BsYXQoTWF0aC5jb3MocmFkKSk7XG5cbiAgICBpZiAoYSAhPT0gb3V0KSB7IC8vIElmIHRoZSBzb3VyY2UgYW5kIGRlc3RpbmF0aW9uIGRpZmZlciwgY29weSB0aGUgdW5jaGFuZ2VkIHJvd3NcbiAgICAgIG91dFswXSAgPSBhWzBdO1xuICAgICAgb3V0WzFdICA9IGFbMV07XG4gICAgICBvdXRbMl0gID0gYVsyXTtcbiAgICAgIG91dFszXSAgPSBhWzNdO1xuICAgICAgb3V0WzEyXSA9IGFbMTJdO1xuICAgICAgb3V0WzEzXSA9IGFbMTNdO1xuICAgICAgb3V0WzE0XSA9IGFbMTRdO1xuICAgICAgb3V0WzE1XSA9IGFbMTVdO1xuICAgIH1cblxuICAgIC8vIFBlcmZvcm0gYXhpcy1zcGVjaWZpYyBtYXRyaXggbXVsdGlwbGljYXRpb25cbiAgICB2YXIgYV8xID0gU0lNRC5GbG9hdDMyeDQubG9hZChhLCA0KTtcbiAgICB2YXIgYV8yID0gU0lNRC5GbG9hdDMyeDQubG9hZChhLCA4KTtcbiAgICBTSU1ELkZsb2F0MzJ4NC5zdG9yZShvdXQsIDQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgU0lNRC5GbG9hdDMyeDQuYWRkKFNJTUQuRmxvYXQzMng0Lm11bChhXzEsIGMpLCBTSU1ELkZsb2F0MzJ4NC5tdWwoYV8yLCBzKSkpO1xuICAgIFNJTUQuRmxvYXQzMng0LnN0b3JlKG91dCwgOCxcbiAgICAgICAgICAgICAgICAgICAgICAgICBTSU1ELkZsb2F0MzJ4NC5zdWIoU0lNRC5GbG9hdDMyeDQubXVsKGFfMiwgYyksIFNJTUQuRmxvYXQzMng0Lm11bChhXzEsIHMpKSk7XG4gICAgcmV0dXJuIG91dDtcbn07XG5cbi8qKlxuICogUm90YXRlcyBhIG1hdHJpeCBieSB0aGUgZ2l2ZW4gYW5nbGUgYXJvdW5kIHRoZSBYIGF4aXMgdXNpbmcgU0lNRCBpZiBhdmFpbGFiZSBhbmQgZW5hYmxlZFxuICpcbiAqIEBwYXJhbSB7bWF0NH0gb3V0IHRoZSByZWNlaXZpbmcgbWF0cml4XG4gKiBAcGFyYW0ge21hdDR9IGEgdGhlIG1hdHJpeCB0byByb3RhdGVcbiAqIEBwYXJhbSB7TnVtYmVyfSByYWQgdGhlIGFuZ2xlIHRvIHJvdGF0ZSB0aGUgbWF0cml4IGJ5XG4gKiBAcmV0dXJucyB7bWF0NH0gb3V0XG4gKi9cbm1hdDQucm90YXRlWCA9IGdsTWF0cml4LlVTRV9TSU1EID8gbWF0NC5TSU1ELnJvdGF0ZVggOiBtYXQ0LnNjYWxhci5yb3RhdGVYO1xuXG4vKipcbiAqIFJvdGF0ZXMgYSBtYXRyaXggYnkgdGhlIGdpdmVuIGFuZ2xlIGFyb3VuZCB0aGUgWSBheGlzIG5vdCB1c2luZyBTSU1EXG4gKlxuICogQHBhcmFtIHttYXQ0fSBvdXQgdGhlIHJlY2VpdmluZyBtYXRyaXhcbiAqIEBwYXJhbSB7bWF0NH0gYSB0aGUgbWF0cml4IHRvIHJvdGF0ZVxuICogQHBhcmFtIHtOdW1iZXJ9IHJhZCB0aGUgYW5nbGUgdG8gcm90YXRlIHRoZSBtYXRyaXggYnlcbiAqIEByZXR1cm5zIHttYXQ0fSBvdXRcbiAqL1xubWF0NC5zY2FsYXIucm90YXRlWSA9IGZ1bmN0aW9uIChvdXQsIGEsIHJhZCkge1xuICAgIHZhciBzID0gTWF0aC5zaW4ocmFkKSxcbiAgICAgICAgYyA9IE1hdGguY29zKHJhZCksXG4gICAgICAgIGEwMCA9IGFbMF0sXG4gICAgICAgIGEwMSA9IGFbMV0sXG4gICAgICAgIGEwMiA9IGFbMl0sXG4gICAgICAgIGEwMyA9IGFbM10sXG4gICAgICAgIGEyMCA9IGFbOF0sXG4gICAgICAgIGEyMSA9IGFbOV0sXG4gICAgICAgIGEyMiA9IGFbMTBdLFxuICAgICAgICBhMjMgPSBhWzExXTtcblxuICAgIGlmIChhICE9PSBvdXQpIHsgLy8gSWYgdGhlIHNvdXJjZSBhbmQgZGVzdGluYXRpb24gZGlmZmVyLCBjb3B5IHRoZSB1bmNoYW5nZWQgcm93c1xuICAgICAgICBvdXRbNF0gID0gYVs0XTtcbiAgICAgICAgb3V0WzVdICA9IGFbNV07XG4gICAgICAgIG91dFs2XSAgPSBhWzZdO1xuICAgICAgICBvdXRbN10gID0gYVs3XTtcbiAgICAgICAgb3V0WzEyXSA9IGFbMTJdO1xuICAgICAgICBvdXRbMTNdID0gYVsxM107XG4gICAgICAgIG91dFsxNF0gPSBhWzE0XTtcbiAgICAgICAgb3V0WzE1XSA9IGFbMTVdO1xuICAgIH1cblxuICAgIC8vIFBlcmZvcm0gYXhpcy1zcGVjaWZpYyBtYXRyaXggbXVsdGlwbGljYXRpb25cbiAgICBvdXRbMF0gPSBhMDAgKiBjIC0gYTIwICogcztcbiAgICBvdXRbMV0gPSBhMDEgKiBjIC0gYTIxICogcztcbiAgICBvdXRbMl0gPSBhMDIgKiBjIC0gYTIyICogcztcbiAgICBvdXRbM10gPSBhMDMgKiBjIC0gYTIzICogcztcbiAgICBvdXRbOF0gPSBhMDAgKiBzICsgYTIwICogYztcbiAgICBvdXRbOV0gPSBhMDEgKiBzICsgYTIxICogYztcbiAgICBvdXRbMTBdID0gYTAyICogcyArIGEyMiAqIGM7XG4gICAgb3V0WzExXSA9IGEwMyAqIHMgKyBhMjMgKiBjO1xuICAgIHJldHVybiBvdXQ7XG59O1xuXG4vKipcbiAqIFJvdGF0ZXMgYSBtYXRyaXggYnkgdGhlIGdpdmVuIGFuZ2xlIGFyb3VuZCB0aGUgWSBheGlzIHVzaW5nIFNJTURcbiAqXG4gKiBAcGFyYW0ge21hdDR9IG91dCB0aGUgcmVjZWl2aW5nIG1hdHJpeFxuICogQHBhcmFtIHttYXQ0fSBhIHRoZSBtYXRyaXggdG8gcm90YXRlXG4gKiBAcGFyYW0ge051bWJlcn0gcmFkIHRoZSBhbmdsZSB0byByb3RhdGUgdGhlIG1hdHJpeCBieVxuICogQHJldHVybnMge21hdDR9IG91dFxuICovXG5tYXQ0LlNJTUQucm90YXRlWSA9IGZ1bmN0aW9uIChvdXQsIGEsIHJhZCkge1xuICAgIHZhciBzID0gU0lNRC5GbG9hdDMyeDQuc3BsYXQoTWF0aC5zaW4ocmFkKSksXG4gICAgICAgIGMgPSBTSU1ELkZsb2F0MzJ4NC5zcGxhdChNYXRoLmNvcyhyYWQpKTtcblxuICAgIGlmIChhICE9PSBvdXQpIHsgLy8gSWYgdGhlIHNvdXJjZSBhbmQgZGVzdGluYXRpb24gZGlmZmVyLCBjb3B5IHRoZSB1bmNoYW5nZWQgcm93c1xuICAgICAgICBvdXRbNF0gID0gYVs0XTtcbiAgICAgICAgb3V0WzVdICA9IGFbNV07XG4gICAgICAgIG91dFs2XSAgPSBhWzZdO1xuICAgICAgICBvdXRbN10gID0gYVs3XTtcbiAgICAgICAgb3V0WzEyXSA9IGFbMTJdO1xuICAgICAgICBvdXRbMTNdID0gYVsxM107XG4gICAgICAgIG91dFsxNF0gPSBhWzE0XTtcbiAgICAgICAgb3V0WzE1XSA9IGFbMTVdO1xuICAgIH1cblxuICAgIC8vIFBlcmZvcm0gYXhpcy1zcGVjaWZpYyBtYXRyaXggbXVsdGlwbGljYXRpb25cbiAgICB2YXIgYV8wID0gU0lNRC5GbG9hdDMyeDQubG9hZChhLCAwKTtcbiAgICB2YXIgYV8yID0gU0lNRC5GbG9hdDMyeDQubG9hZChhLCA4KTtcbiAgICBTSU1ELkZsb2F0MzJ4NC5zdG9yZShvdXQsIDAsXG4gICAgICAgICAgICAgICAgICAgICAgICAgU0lNRC5GbG9hdDMyeDQuc3ViKFNJTUQuRmxvYXQzMng0Lm11bChhXzAsIGMpLCBTSU1ELkZsb2F0MzJ4NC5tdWwoYV8yLCBzKSkpO1xuICAgIFNJTUQuRmxvYXQzMng0LnN0b3JlKG91dCwgOCxcbiAgICAgICAgICAgICAgICAgICAgICAgICBTSU1ELkZsb2F0MzJ4NC5hZGQoU0lNRC5GbG9hdDMyeDQubXVsKGFfMCwgcyksIFNJTUQuRmxvYXQzMng0Lm11bChhXzIsIGMpKSk7XG4gICAgcmV0dXJuIG91dDtcbn07XG5cbi8qKlxuICogUm90YXRlcyBhIG1hdHJpeCBieSB0aGUgZ2l2ZW4gYW5nbGUgYXJvdW5kIHRoZSBZIGF4aXMgaWYgU0lNRCBhdmFpbGFibGUgYW5kIGVuYWJsZWRcbiAqXG4gKiBAcGFyYW0ge21hdDR9IG91dCB0aGUgcmVjZWl2aW5nIG1hdHJpeFxuICogQHBhcmFtIHttYXQ0fSBhIHRoZSBtYXRyaXggdG8gcm90YXRlXG4gKiBAcGFyYW0ge051bWJlcn0gcmFkIHRoZSBhbmdsZSB0byByb3RhdGUgdGhlIG1hdHJpeCBieVxuICogQHJldHVybnMge21hdDR9IG91dFxuICovXG4gbWF0NC5yb3RhdGVZID0gZ2xNYXRyaXguVVNFX1NJTUQgPyBtYXQ0LlNJTUQucm90YXRlWSA6IG1hdDQuc2NhbGFyLnJvdGF0ZVk7XG5cbi8qKlxuICogUm90YXRlcyBhIG1hdHJpeCBieSB0aGUgZ2l2ZW4gYW5nbGUgYXJvdW5kIHRoZSBaIGF4aXMgbm90IHVzaW5nIFNJTURcbiAqXG4gKiBAcGFyYW0ge21hdDR9IG91dCB0aGUgcmVjZWl2aW5nIG1hdHJpeFxuICogQHBhcmFtIHttYXQ0fSBhIHRoZSBtYXRyaXggdG8gcm90YXRlXG4gKiBAcGFyYW0ge051bWJlcn0gcmFkIHRoZSBhbmdsZSB0byByb3RhdGUgdGhlIG1hdHJpeCBieVxuICogQHJldHVybnMge21hdDR9IG91dFxuICovXG5tYXQ0LnNjYWxhci5yb3RhdGVaID0gZnVuY3Rpb24gKG91dCwgYSwgcmFkKSB7XG4gICAgdmFyIHMgPSBNYXRoLnNpbihyYWQpLFxuICAgICAgICBjID0gTWF0aC5jb3MocmFkKSxcbiAgICAgICAgYTAwID0gYVswXSxcbiAgICAgICAgYTAxID0gYVsxXSxcbiAgICAgICAgYTAyID0gYVsyXSxcbiAgICAgICAgYTAzID0gYVszXSxcbiAgICAgICAgYTEwID0gYVs0XSxcbiAgICAgICAgYTExID0gYVs1XSxcbiAgICAgICAgYTEyID0gYVs2XSxcbiAgICAgICAgYTEzID0gYVs3XTtcblxuICAgIGlmIChhICE9PSBvdXQpIHsgLy8gSWYgdGhlIHNvdXJjZSBhbmQgZGVzdGluYXRpb24gZGlmZmVyLCBjb3B5IHRoZSB1bmNoYW5nZWQgbGFzdCByb3dcbiAgICAgICAgb3V0WzhdICA9IGFbOF07XG4gICAgICAgIG91dFs5XSAgPSBhWzldO1xuICAgICAgICBvdXRbMTBdID0gYVsxMF07XG4gICAgICAgIG91dFsxMV0gPSBhWzExXTtcbiAgICAgICAgb3V0WzEyXSA9IGFbMTJdO1xuICAgICAgICBvdXRbMTNdID0gYVsxM107XG4gICAgICAgIG91dFsxNF0gPSBhWzE0XTtcbiAgICAgICAgb3V0WzE1XSA9IGFbMTVdO1xuICAgIH1cblxuICAgIC8vIFBlcmZvcm0gYXhpcy1zcGVjaWZpYyBtYXRyaXggbXVsdGlwbGljYXRpb25cbiAgICBvdXRbMF0gPSBhMDAgKiBjICsgYTEwICogcztcbiAgICBvdXRbMV0gPSBhMDEgKiBjICsgYTExICogcztcbiAgICBvdXRbMl0gPSBhMDIgKiBjICsgYTEyICogcztcbiAgICBvdXRbM10gPSBhMDMgKiBjICsgYTEzICogcztcbiAgICBvdXRbNF0gPSBhMTAgKiBjIC0gYTAwICogcztcbiAgICBvdXRbNV0gPSBhMTEgKiBjIC0gYTAxICogcztcbiAgICBvdXRbNl0gPSBhMTIgKiBjIC0gYTAyICogcztcbiAgICBvdXRbN10gPSBhMTMgKiBjIC0gYTAzICogcztcbiAgICByZXR1cm4gb3V0O1xufTtcblxuLyoqXG4gKiBSb3RhdGVzIGEgbWF0cml4IGJ5IHRoZSBnaXZlbiBhbmdsZSBhcm91bmQgdGhlIFogYXhpcyB1c2luZyBTSU1EXG4gKlxuICogQHBhcmFtIHttYXQ0fSBvdXQgdGhlIHJlY2VpdmluZyBtYXRyaXhcbiAqIEBwYXJhbSB7bWF0NH0gYSB0aGUgbWF0cml4IHRvIHJvdGF0ZVxuICogQHBhcmFtIHtOdW1iZXJ9IHJhZCB0aGUgYW5nbGUgdG8gcm90YXRlIHRoZSBtYXRyaXggYnlcbiAqIEByZXR1cm5zIHttYXQ0fSBvdXRcbiAqL1xubWF0NC5TSU1ELnJvdGF0ZVogPSBmdW5jdGlvbiAob3V0LCBhLCByYWQpIHtcbiAgICB2YXIgcyA9IFNJTUQuRmxvYXQzMng0LnNwbGF0KE1hdGguc2luKHJhZCkpLFxuICAgICAgICBjID0gU0lNRC5GbG9hdDMyeDQuc3BsYXQoTWF0aC5jb3MocmFkKSk7XG5cbiAgICBpZiAoYSAhPT0gb3V0KSB7IC8vIElmIHRoZSBzb3VyY2UgYW5kIGRlc3RpbmF0aW9uIGRpZmZlciwgY29weSB0aGUgdW5jaGFuZ2VkIGxhc3Qgcm93XG4gICAgICAgIG91dFs4XSAgPSBhWzhdO1xuICAgICAgICBvdXRbOV0gID0gYVs5XTtcbiAgICAgICAgb3V0WzEwXSA9IGFbMTBdO1xuICAgICAgICBvdXRbMTFdID0gYVsxMV07XG4gICAgICAgIG91dFsxMl0gPSBhWzEyXTtcbiAgICAgICAgb3V0WzEzXSA9IGFbMTNdO1xuICAgICAgICBvdXRbMTRdID0gYVsxNF07XG4gICAgICAgIG91dFsxNV0gPSBhWzE1XTtcbiAgICB9XG5cbiAgICAvLyBQZXJmb3JtIGF4aXMtc3BlY2lmaWMgbWF0cml4IG11bHRpcGxpY2F0aW9uXG4gICAgdmFyIGFfMCA9IFNJTUQuRmxvYXQzMng0LmxvYWQoYSwgMCk7XG4gICAgdmFyIGFfMSA9IFNJTUQuRmxvYXQzMng0LmxvYWQoYSwgNCk7XG4gICAgU0lNRC5GbG9hdDMyeDQuc3RvcmUob3V0LCAwLFxuICAgICAgICAgICAgICAgICAgICAgICAgIFNJTUQuRmxvYXQzMng0LmFkZChTSU1ELkZsb2F0MzJ4NC5tdWwoYV8wLCBjKSwgU0lNRC5GbG9hdDMyeDQubXVsKGFfMSwgcykpKTtcbiAgICBTSU1ELkZsb2F0MzJ4NC5zdG9yZShvdXQsIDQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgU0lNRC5GbG9hdDMyeDQuc3ViKFNJTUQuRmxvYXQzMng0Lm11bChhXzEsIGMpLCBTSU1ELkZsb2F0MzJ4NC5tdWwoYV8wLCBzKSkpO1xuICAgIHJldHVybiBvdXQ7XG59O1xuXG4vKipcbiAqIFJvdGF0ZXMgYSBtYXRyaXggYnkgdGhlIGdpdmVuIGFuZ2xlIGFyb3VuZCB0aGUgWiBheGlzIGlmIFNJTUQgYXZhaWxhYmxlIGFuZCBlbmFibGVkXG4gKlxuICogQHBhcmFtIHttYXQ0fSBvdXQgdGhlIHJlY2VpdmluZyBtYXRyaXhcbiAqIEBwYXJhbSB7bWF0NH0gYSB0aGUgbWF0cml4IHRvIHJvdGF0ZVxuICogQHBhcmFtIHtOdW1iZXJ9IHJhZCB0aGUgYW5nbGUgdG8gcm90YXRlIHRoZSBtYXRyaXggYnlcbiAqIEByZXR1cm5zIHttYXQ0fSBvdXRcbiAqL1xuIG1hdDQucm90YXRlWiA9IGdsTWF0cml4LlVTRV9TSU1EID8gbWF0NC5TSU1ELnJvdGF0ZVogOiBtYXQ0LnNjYWxhci5yb3RhdGVaO1xuXG4vKipcbiAqIENyZWF0ZXMgYSBtYXRyaXggZnJvbSBhIHZlY3RvciB0cmFuc2xhdGlvblxuICogVGhpcyBpcyBlcXVpdmFsZW50IHRvIChidXQgbXVjaCBmYXN0ZXIgdGhhbik6XG4gKlxuICogICAgIG1hdDQuaWRlbnRpdHkoZGVzdCk7XG4gKiAgICAgbWF0NC50cmFuc2xhdGUoZGVzdCwgZGVzdCwgdmVjKTtcbiAqXG4gKiBAcGFyYW0ge21hdDR9IG91dCBtYXQ0IHJlY2VpdmluZyBvcGVyYXRpb24gcmVzdWx0XG4gKiBAcGFyYW0ge3ZlYzN9IHYgVHJhbnNsYXRpb24gdmVjdG9yXG4gKiBAcmV0dXJucyB7bWF0NH0gb3V0XG4gKi9cbm1hdDQuZnJvbVRyYW5zbGF0aW9uID0gZnVuY3Rpb24ob3V0LCB2KSB7XG4gICAgb3V0WzBdID0gMTtcbiAgICBvdXRbMV0gPSAwO1xuICAgIG91dFsyXSA9IDA7XG4gICAgb3V0WzNdID0gMDtcbiAgICBvdXRbNF0gPSAwO1xuICAgIG91dFs1XSA9IDE7XG4gICAgb3V0WzZdID0gMDtcbiAgICBvdXRbN10gPSAwO1xuICAgIG91dFs4XSA9IDA7XG4gICAgb3V0WzldID0gMDtcbiAgICBvdXRbMTBdID0gMTtcbiAgICBvdXRbMTFdID0gMDtcbiAgICBvdXRbMTJdID0gdlswXTtcbiAgICBvdXRbMTNdID0gdlsxXTtcbiAgICBvdXRbMTRdID0gdlsyXTtcbiAgICBvdXRbMTVdID0gMTtcbiAgICByZXR1cm4gb3V0O1xufVxuXG4vKipcbiAqIENyZWF0ZXMgYSBtYXRyaXggZnJvbSBhIHZlY3RvciBzY2FsaW5nXG4gKiBUaGlzIGlzIGVxdWl2YWxlbnQgdG8gKGJ1dCBtdWNoIGZhc3RlciB0aGFuKTpcbiAqXG4gKiAgICAgbWF0NC5pZGVudGl0eShkZXN0KTtcbiAqICAgICBtYXQ0LnNjYWxlKGRlc3QsIGRlc3QsIHZlYyk7XG4gKlxuICogQHBhcmFtIHttYXQ0fSBvdXQgbWF0NCByZWNlaXZpbmcgb3BlcmF0aW9uIHJlc3VsdFxuICogQHBhcmFtIHt2ZWMzfSB2IFNjYWxpbmcgdmVjdG9yXG4gKiBAcmV0dXJucyB7bWF0NH0gb3V0XG4gKi9cbm1hdDQuZnJvbVNjYWxpbmcgPSBmdW5jdGlvbihvdXQsIHYpIHtcbiAgICBvdXRbMF0gPSB2WzBdO1xuICAgIG91dFsxXSA9IDA7XG4gICAgb3V0WzJdID0gMDtcbiAgICBvdXRbM10gPSAwO1xuICAgIG91dFs0XSA9IDA7XG4gICAgb3V0WzVdID0gdlsxXTtcbiAgICBvdXRbNl0gPSAwO1xuICAgIG91dFs3XSA9IDA7XG4gICAgb3V0WzhdID0gMDtcbiAgICBvdXRbOV0gPSAwO1xuICAgIG91dFsxMF0gPSB2WzJdO1xuICAgIG91dFsxMV0gPSAwO1xuICAgIG91dFsxMl0gPSAwO1xuICAgIG91dFsxM10gPSAwO1xuICAgIG91dFsxNF0gPSAwO1xuICAgIG91dFsxNV0gPSAxO1xuICAgIHJldHVybiBvdXQ7XG59XG5cbi8qKlxuICogQ3JlYXRlcyBhIG1hdHJpeCBmcm9tIGEgZ2l2ZW4gYW5nbGUgYXJvdW5kIGEgZ2l2ZW4gYXhpc1xuICogVGhpcyBpcyBlcXVpdmFsZW50IHRvIChidXQgbXVjaCBmYXN0ZXIgdGhhbik6XG4gKlxuICogICAgIG1hdDQuaWRlbnRpdHkoZGVzdCk7XG4gKiAgICAgbWF0NC5yb3RhdGUoZGVzdCwgZGVzdCwgcmFkLCBheGlzKTtcbiAqXG4gKiBAcGFyYW0ge21hdDR9IG91dCBtYXQ0IHJlY2VpdmluZyBvcGVyYXRpb24gcmVzdWx0XG4gKiBAcGFyYW0ge051bWJlcn0gcmFkIHRoZSBhbmdsZSB0byByb3RhdGUgdGhlIG1hdHJpeCBieVxuICogQHBhcmFtIHt2ZWMzfSBheGlzIHRoZSBheGlzIHRvIHJvdGF0ZSBhcm91bmRcbiAqIEByZXR1cm5zIHttYXQ0fSBvdXRcbiAqL1xubWF0NC5mcm9tUm90YXRpb24gPSBmdW5jdGlvbihvdXQsIHJhZCwgYXhpcykge1xuICAgIHZhciB4ID0gYXhpc1swXSwgeSA9IGF4aXNbMV0sIHogPSBheGlzWzJdLFxuICAgICAgICBsZW4gPSBNYXRoLnNxcnQoeCAqIHggKyB5ICogeSArIHogKiB6KSxcbiAgICAgICAgcywgYywgdDtcblxuICAgIGlmIChNYXRoLmFicyhsZW4pIDwgZ2xNYXRyaXguRVBTSUxPTikgeyByZXR1cm4gbnVsbDsgfVxuXG4gICAgbGVuID0gMSAvIGxlbjtcbiAgICB4ICo9IGxlbjtcbiAgICB5ICo9IGxlbjtcbiAgICB6ICo9IGxlbjtcblxuICAgIHMgPSBNYXRoLnNpbihyYWQpO1xuICAgIGMgPSBNYXRoLmNvcyhyYWQpO1xuICAgIHQgPSAxIC0gYztcblxuICAgIC8vIFBlcmZvcm0gcm90YXRpb24tc3BlY2lmaWMgbWF0cml4IG11bHRpcGxpY2F0aW9uXG4gICAgb3V0WzBdID0geCAqIHggKiB0ICsgYztcbiAgICBvdXRbMV0gPSB5ICogeCAqIHQgKyB6ICogcztcbiAgICBvdXRbMl0gPSB6ICogeCAqIHQgLSB5ICogcztcbiAgICBvdXRbM10gPSAwO1xuICAgIG91dFs0XSA9IHggKiB5ICogdCAtIHogKiBzO1xuICAgIG91dFs1XSA9IHkgKiB5ICogdCArIGM7XG4gICAgb3V0WzZdID0geiAqIHkgKiB0ICsgeCAqIHM7XG4gICAgb3V0WzddID0gMDtcbiAgICBvdXRbOF0gPSB4ICogeiAqIHQgKyB5ICogcztcbiAgICBvdXRbOV0gPSB5ICogeiAqIHQgLSB4ICogcztcbiAgICBvdXRbMTBdID0geiAqIHogKiB0ICsgYztcbiAgICBvdXRbMTFdID0gMDtcbiAgICBvdXRbMTJdID0gMDtcbiAgICBvdXRbMTNdID0gMDtcbiAgICBvdXRbMTRdID0gMDtcbiAgICBvdXRbMTVdID0gMTtcbiAgICByZXR1cm4gb3V0O1xufVxuXG4vKipcbiAqIENyZWF0ZXMgYSBtYXRyaXggZnJvbSB0aGUgZ2l2ZW4gYW5nbGUgYXJvdW5kIHRoZSBYIGF4aXNcbiAqIFRoaXMgaXMgZXF1aXZhbGVudCB0byAoYnV0IG11Y2ggZmFzdGVyIHRoYW4pOlxuICpcbiAqICAgICBtYXQ0LmlkZW50aXR5KGRlc3QpO1xuICogICAgIG1hdDQucm90YXRlWChkZXN0LCBkZXN0LCByYWQpO1xuICpcbiAqIEBwYXJhbSB7bWF0NH0gb3V0IG1hdDQgcmVjZWl2aW5nIG9wZXJhdGlvbiByZXN1bHRcbiAqIEBwYXJhbSB7TnVtYmVyfSByYWQgdGhlIGFuZ2xlIHRvIHJvdGF0ZSB0aGUgbWF0cml4IGJ5XG4gKiBAcmV0dXJucyB7bWF0NH0gb3V0XG4gKi9cbm1hdDQuZnJvbVhSb3RhdGlvbiA9IGZ1bmN0aW9uKG91dCwgcmFkKSB7XG4gICAgdmFyIHMgPSBNYXRoLnNpbihyYWQpLFxuICAgICAgICBjID0gTWF0aC5jb3MocmFkKTtcblxuICAgIC8vIFBlcmZvcm0gYXhpcy1zcGVjaWZpYyBtYXRyaXggbXVsdGlwbGljYXRpb25cbiAgICBvdXRbMF0gID0gMTtcbiAgICBvdXRbMV0gID0gMDtcbiAgICBvdXRbMl0gID0gMDtcbiAgICBvdXRbM10gID0gMDtcbiAgICBvdXRbNF0gPSAwO1xuICAgIG91dFs1XSA9IGM7XG4gICAgb3V0WzZdID0gcztcbiAgICBvdXRbN10gPSAwO1xuICAgIG91dFs4XSA9IDA7XG4gICAgb3V0WzldID0gLXM7XG4gICAgb3V0WzEwXSA9IGM7XG4gICAgb3V0WzExXSA9IDA7XG4gICAgb3V0WzEyXSA9IDA7XG4gICAgb3V0WzEzXSA9IDA7XG4gICAgb3V0WzE0XSA9IDA7XG4gICAgb3V0WzE1XSA9IDE7XG4gICAgcmV0dXJuIG91dDtcbn1cblxuLyoqXG4gKiBDcmVhdGVzIGEgbWF0cml4IGZyb20gdGhlIGdpdmVuIGFuZ2xlIGFyb3VuZCB0aGUgWSBheGlzXG4gKiBUaGlzIGlzIGVxdWl2YWxlbnQgdG8gKGJ1dCBtdWNoIGZhc3RlciB0aGFuKTpcbiAqXG4gKiAgICAgbWF0NC5pZGVudGl0eShkZXN0KTtcbiAqICAgICBtYXQ0LnJvdGF0ZVkoZGVzdCwgZGVzdCwgcmFkKTtcbiAqXG4gKiBAcGFyYW0ge21hdDR9IG91dCBtYXQ0IHJlY2VpdmluZyBvcGVyYXRpb24gcmVzdWx0XG4gKiBAcGFyYW0ge051bWJlcn0gcmFkIHRoZSBhbmdsZSB0byByb3RhdGUgdGhlIG1hdHJpeCBieVxuICogQHJldHVybnMge21hdDR9IG91dFxuICovXG5tYXQ0LmZyb21ZUm90YXRpb24gPSBmdW5jdGlvbihvdXQsIHJhZCkge1xuICAgIHZhciBzID0gTWF0aC5zaW4ocmFkKSxcbiAgICAgICAgYyA9IE1hdGguY29zKHJhZCk7XG5cbiAgICAvLyBQZXJmb3JtIGF4aXMtc3BlY2lmaWMgbWF0cml4IG11bHRpcGxpY2F0aW9uXG4gICAgb3V0WzBdICA9IGM7XG4gICAgb3V0WzFdICA9IDA7XG4gICAgb3V0WzJdICA9IC1zO1xuICAgIG91dFszXSAgPSAwO1xuICAgIG91dFs0XSA9IDA7XG4gICAgb3V0WzVdID0gMTtcbiAgICBvdXRbNl0gPSAwO1xuICAgIG91dFs3XSA9IDA7XG4gICAgb3V0WzhdID0gcztcbiAgICBvdXRbOV0gPSAwO1xuICAgIG91dFsxMF0gPSBjO1xuICAgIG91dFsxMV0gPSAwO1xuICAgIG91dFsxMl0gPSAwO1xuICAgIG91dFsxM10gPSAwO1xuICAgIG91dFsxNF0gPSAwO1xuICAgIG91dFsxNV0gPSAxO1xuICAgIHJldHVybiBvdXQ7XG59XG5cbi8qKlxuICogQ3JlYXRlcyBhIG1hdHJpeCBmcm9tIHRoZSBnaXZlbiBhbmdsZSBhcm91bmQgdGhlIFogYXhpc1xuICogVGhpcyBpcyBlcXVpdmFsZW50IHRvIChidXQgbXVjaCBmYXN0ZXIgdGhhbik6XG4gKlxuICogICAgIG1hdDQuaWRlbnRpdHkoZGVzdCk7XG4gKiAgICAgbWF0NC5yb3RhdGVaKGRlc3QsIGRlc3QsIHJhZCk7XG4gKlxuICogQHBhcmFtIHttYXQ0fSBvdXQgbWF0NCByZWNlaXZpbmcgb3BlcmF0aW9uIHJlc3VsdFxuICogQHBhcmFtIHtOdW1iZXJ9IHJhZCB0aGUgYW5nbGUgdG8gcm90YXRlIHRoZSBtYXRyaXggYnlcbiAqIEByZXR1cm5zIHttYXQ0fSBvdXRcbiAqL1xubWF0NC5mcm9tWlJvdGF0aW9uID0gZnVuY3Rpb24ob3V0LCByYWQpIHtcbiAgICB2YXIgcyA9IE1hdGguc2luKHJhZCksXG4gICAgICAgIGMgPSBNYXRoLmNvcyhyYWQpO1xuXG4gICAgLy8gUGVyZm9ybSBheGlzLXNwZWNpZmljIG1hdHJpeCBtdWx0aXBsaWNhdGlvblxuICAgIG91dFswXSAgPSBjO1xuICAgIG91dFsxXSAgPSBzO1xuICAgIG91dFsyXSAgPSAwO1xuICAgIG91dFszXSAgPSAwO1xuICAgIG91dFs0XSA9IC1zO1xuICAgIG91dFs1XSA9IGM7XG4gICAgb3V0WzZdID0gMDtcbiAgICBvdXRbN10gPSAwO1xuICAgIG91dFs4XSA9IDA7XG4gICAgb3V0WzldID0gMDtcbiAgICBvdXRbMTBdID0gMTtcbiAgICBvdXRbMTFdID0gMDtcbiAgICBvdXRbMTJdID0gMDtcbiAgICBvdXRbMTNdID0gMDtcbiAgICBvdXRbMTRdID0gMDtcbiAgICBvdXRbMTVdID0gMTtcbiAgICByZXR1cm4gb3V0O1xufVxuXG4vKipcbiAqIENyZWF0ZXMgYSBtYXRyaXggZnJvbSBhIHF1YXRlcm5pb24gcm90YXRpb24gYW5kIHZlY3RvciB0cmFuc2xhdGlvblxuICogVGhpcyBpcyBlcXVpdmFsZW50IHRvIChidXQgbXVjaCBmYXN0ZXIgdGhhbik6XG4gKlxuICogICAgIG1hdDQuaWRlbnRpdHkoZGVzdCk7XG4gKiAgICAgbWF0NC50cmFuc2xhdGUoZGVzdCwgdmVjKTtcbiAqICAgICB2YXIgcXVhdE1hdCA9IG1hdDQuY3JlYXRlKCk7XG4gKiAgICAgcXVhdDQudG9NYXQ0KHF1YXQsIHF1YXRNYXQpO1xuICogICAgIG1hdDQubXVsdGlwbHkoZGVzdCwgcXVhdE1hdCk7XG4gKlxuICogQHBhcmFtIHttYXQ0fSBvdXQgbWF0NCByZWNlaXZpbmcgb3BlcmF0aW9uIHJlc3VsdFxuICogQHBhcmFtIHtxdWF0NH0gcSBSb3RhdGlvbiBxdWF0ZXJuaW9uXG4gKiBAcGFyYW0ge3ZlYzN9IHYgVHJhbnNsYXRpb24gdmVjdG9yXG4gKiBAcmV0dXJucyB7bWF0NH0gb3V0XG4gKi9cbm1hdDQuZnJvbVJvdGF0aW9uVHJhbnNsYXRpb24gPSBmdW5jdGlvbiAob3V0LCBxLCB2KSB7XG4gICAgLy8gUXVhdGVybmlvbiBtYXRoXG4gICAgdmFyIHggPSBxWzBdLCB5ID0gcVsxXSwgeiA9IHFbMl0sIHcgPSBxWzNdLFxuICAgICAgICB4MiA9IHggKyB4LFxuICAgICAgICB5MiA9IHkgKyB5LFxuICAgICAgICB6MiA9IHogKyB6LFxuXG4gICAgICAgIHh4ID0geCAqIHgyLFxuICAgICAgICB4eSA9IHggKiB5MixcbiAgICAgICAgeHogPSB4ICogejIsXG4gICAgICAgIHl5ID0geSAqIHkyLFxuICAgICAgICB5eiA9IHkgKiB6MixcbiAgICAgICAgenogPSB6ICogejIsXG4gICAgICAgIHd4ID0gdyAqIHgyLFxuICAgICAgICB3eSA9IHcgKiB5MixcbiAgICAgICAgd3ogPSB3ICogejI7XG5cbiAgICBvdXRbMF0gPSAxIC0gKHl5ICsgenopO1xuICAgIG91dFsxXSA9IHh5ICsgd3o7XG4gICAgb3V0WzJdID0geHogLSB3eTtcbiAgICBvdXRbM10gPSAwO1xuICAgIG91dFs0XSA9IHh5IC0gd3o7XG4gICAgb3V0WzVdID0gMSAtICh4eCArIHp6KTtcbiAgICBvdXRbNl0gPSB5eiArIHd4O1xuICAgIG91dFs3XSA9IDA7XG4gICAgb3V0WzhdID0geHogKyB3eTtcbiAgICBvdXRbOV0gPSB5eiAtIHd4O1xuICAgIG91dFsxMF0gPSAxIC0gKHh4ICsgeXkpO1xuICAgIG91dFsxMV0gPSAwO1xuICAgIG91dFsxMl0gPSB2WzBdO1xuICAgIG91dFsxM10gPSB2WzFdO1xuICAgIG91dFsxNF0gPSB2WzJdO1xuICAgIG91dFsxNV0gPSAxO1xuXG4gICAgcmV0dXJuIG91dDtcbn07XG5cbi8qKlxuICogUmV0dXJucyB0aGUgdHJhbnNsYXRpb24gdmVjdG9yIGNvbXBvbmVudCBvZiBhIHRyYW5zZm9ybWF0aW9uXG4gKiAgbWF0cml4LiBJZiBhIG1hdHJpeCBpcyBidWlsdCB3aXRoIGZyb21Sb3RhdGlvblRyYW5zbGF0aW9uLFxuICogIHRoZSByZXR1cm5lZCB2ZWN0b3Igd2lsbCBiZSB0aGUgc2FtZSBhcyB0aGUgdHJhbnNsYXRpb24gdmVjdG9yXG4gKiAgb3JpZ2luYWxseSBzdXBwbGllZC5cbiAqIEBwYXJhbSAge3ZlYzN9IG91dCBWZWN0b3IgdG8gcmVjZWl2ZSB0cmFuc2xhdGlvbiBjb21wb25lbnRcbiAqIEBwYXJhbSAge21hdDR9IG1hdCBNYXRyaXggdG8gYmUgZGVjb21wb3NlZCAoaW5wdXQpXG4gKiBAcmV0dXJuIHt2ZWMzfSBvdXRcbiAqL1xubWF0NC5nZXRUcmFuc2xhdGlvbiA9IGZ1bmN0aW9uIChvdXQsIG1hdCkge1xuICBvdXRbMF0gPSBtYXRbMTJdO1xuICBvdXRbMV0gPSBtYXRbMTNdO1xuICBvdXRbMl0gPSBtYXRbMTRdO1xuXG4gIHJldHVybiBvdXQ7XG59O1xuXG4vKipcbiAqIFJldHVybnMgYSBxdWF0ZXJuaW9uIHJlcHJlc2VudGluZyB0aGUgcm90YXRpb25hbCBjb21wb25lbnRcbiAqICBvZiBhIHRyYW5zZm9ybWF0aW9uIG1hdHJpeC4gSWYgYSBtYXRyaXggaXMgYnVpbHQgd2l0aFxuICogIGZyb21Sb3RhdGlvblRyYW5zbGF0aW9uLCB0aGUgcmV0dXJuZWQgcXVhdGVybmlvbiB3aWxsIGJlIHRoZVxuICogIHNhbWUgYXMgdGhlIHF1YXRlcm5pb24gb3JpZ2luYWxseSBzdXBwbGllZC5cbiAqIEBwYXJhbSB7cXVhdH0gb3V0IFF1YXRlcm5pb24gdG8gcmVjZWl2ZSB0aGUgcm90YXRpb24gY29tcG9uZW50XG4gKiBAcGFyYW0ge21hdDR9IG1hdCBNYXRyaXggdG8gYmUgZGVjb21wb3NlZCAoaW5wdXQpXG4gKiBAcmV0dXJuIHtxdWF0fSBvdXRcbiAqL1xubWF0NC5nZXRSb3RhdGlvbiA9IGZ1bmN0aW9uIChvdXQsIG1hdCkge1xuICAvLyBBbGdvcml0aG0gdGFrZW4gZnJvbSBodHRwOi8vd3d3LmV1Y2xpZGVhbnNwYWNlLmNvbS9tYXRocy9nZW9tZXRyeS9yb3RhdGlvbnMvY29udmVyc2lvbnMvbWF0cml4VG9RdWF0ZXJuaW9uL2luZGV4Lmh0bVxuICB2YXIgdHJhY2UgPSBtYXRbMF0gKyBtYXRbNV0gKyBtYXRbMTBdO1xuICB2YXIgUyA9IDA7XG5cbiAgaWYgKHRyYWNlID4gMCkgeyBcbiAgICBTID0gTWF0aC5zcXJ0KHRyYWNlICsgMS4wKSAqIDI7XG4gICAgb3V0WzNdID0gMC4yNSAqIFM7XG4gICAgb3V0WzBdID0gKG1hdFs2XSAtIG1hdFs5XSkgLyBTO1xuICAgIG91dFsxXSA9IChtYXRbOF0gLSBtYXRbMl0pIC8gUzsgXG4gICAgb3V0WzJdID0gKG1hdFsxXSAtIG1hdFs0XSkgLyBTOyBcbiAgfSBlbHNlIGlmICgobWF0WzBdID4gbWF0WzVdKSYobWF0WzBdID4gbWF0WzEwXSkpIHsgXG4gICAgUyA9IE1hdGguc3FydCgxLjAgKyBtYXRbMF0gLSBtYXRbNV0gLSBtYXRbMTBdKSAqIDI7XG4gICAgb3V0WzNdID0gKG1hdFs2XSAtIG1hdFs5XSkgLyBTO1xuICAgIG91dFswXSA9IDAuMjUgKiBTO1xuICAgIG91dFsxXSA9IChtYXRbMV0gKyBtYXRbNF0pIC8gUzsgXG4gICAgb3V0WzJdID0gKG1hdFs4XSArIG1hdFsyXSkgLyBTOyBcbiAgfSBlbHNlIGlmIChtYXRbNV0gPiBtYXRbMTBdKSB7IFxuICAgIFMgPSBNYXRoLnNxcnQoMS4wICsgbWF0WzVdIC0gbWF0WzBdIC0gbWF0WzEwXSkgKiAyO1xuICAgIG91dFszXSA9IChtYXRbOF0gLSBtYXRbMl0pIC8gUztcbiAgICBvdXRbMF0gPSAobWF0WzFdICsgbWF0WzRdKSAvIFM7IFxuICAgIG91dFsxXSA9IDAuMjUgKiBTO1xuICAgIG91dFsyXSA9IChtYXRbNl0gKyBtYXRbOV0pIC8gUzsgXG4gIH0gZWxzZSB7IFxuICAgIFMgPSBNYXRoLnNxcnQoMS4wICsgbWF0WzEwXSAtIG1hdFswXSAtIG1hdFs1XSkgKiAyO1xuICAgIG91dFszXSA9IChtYXRbMV0gLSBtYXRbNF0pIC8gUztcbiAgICBvdXRbMF0gPSAobWF0WzhdICsgbWF0WzJdKSAvIFM7XG4gICAgb3V0WzFdID0gKG1hdFs2XSArIG1hdFs5XSkgLyBTO1xuICAgIG91dFsyXSA9IDAuMjUgKiBTO1xuICB9XG5cbiAgcmV0dXJuIG91dDtcbn07XG5cbi8qKlxuICogQ3JlYXRlcyBhIG1hdHJpeCBmcm9tIGEgcXVhdGVybmlvbiByb3RhdGlvbiwgdmVjdG9yIHRyYW5zbGF0aW9uIGFuZCB2ZWN0b3Igc2NhbGVcbiAqIFRoaXMgaXMgZXF1aXZhbGVudCB0byAoYnV0IG11Y2ggZmFzdGVyIHRoYW4pOlxuICpcbiAqICAgICBtYXQ0LmlkZW50aXR5KGRlc3QpO1xuICogICAgIG1hdDQudHJhbnNsYXRlKGRlc3QsIHZlYyk7XG4gKiAgICAgdmFyIHF1YXRNYXQgPSBtYXQ0LmNyZWF0ZSgpO1xuICogICAgIHF1YXQ0LnRvTWF0NChxdWF0LCBxdWF0TWF0KTtcbiAqICAgICBtYXQ0Lm11bHRpcGx5KGRlc3QsIHF1YXRNYXQpO1xuICogICAgIG1hdDQuc2NhbGUoZGVzdCwgc2NhbGUpXG4gKlxuICogQHBhcmFtIHttYXQ0fSBvdXQgbWF0NCByZWNlaXZpbmcgb3BlcmF0aW9uIHJlc3VsdFxuICogQHBhcmFtIHtxdWF0NH0gcSBSb3RhdGlvbiBxdWF0ZXJuaW9uXG4gKiBAcGFyYW0ge3ZlYzN9IHYgVHJhbnNsYXRpb24gdmVjdG9yXG4gKiBAcGFyYW0ge3ZlYzN9IHMgU2NhbGluZyB2ZWN0b3JcbiAqIEByZXR1cm5zIHttYXQ0fSBvdXRcbiAqL1xubWF0NC5mcm9tUm90YXRpb25UcmFuc2xhdGlvblNjYWxlID0gZnVuY3Rpb24gKG91dCwgcSwgdiwgcykge1xuICAgIC8vIFF1YXRlcm5pb24gbWF0aFxuICAgIHZhciB4ID0gcVswXSwgeSA9IHFbMV0sIHogPSBxWzJdLCB3ID0gcVszXSxcbiAgICAgICAgeDIgPSB4ICsgeCxcbiAgICAgICAgeTIgPSB5ICsgeSxcbiAgICAgICAgejIgPSB6ICsgeixcblxuICAgICAgICB4eCA9IHggKiB4MixcbiAgICAgICAgeHkgPSB4ICogeTIsXG4gICAgICAgIHh6ID0geCAqIHoyLFxuICAgICAgICB5eSA9IHkgKiB5MixcbiAgICAgICAgeXogPSB5ICogejIsXG4gICAgICAgIHp6ID0geiAqIHoyLFxuICAgICAgICB3eCA9IHcgKiB4MixcbiAgICAgICAgd3kgPSB3ICogeTIsXG4gICAgICAgIHd6ID0gdyAqIHoyLFxuICAgICAgICBzeCA9IHNbMF0sXG4gICAgICAgIHN5ID0gc1sxXSxcbiAgICAgICAgc3ogPSBzWzJdO1xuXG4gICAgb3V0WzBdID0gKDEgLSAoeXkgKyB6eikpICogc3g7XG4gICAgb3V0WzFdID0gKHh5ICsgd3opICogc3g7XG4gICAgb3V0WzJdID0gKHh6IC0gd3kpICogc3g7XG4gICAgb3V0WzNdID0gMDtcbiAgICBvdXRbNF0gPSAoeHkgLSB3eikgKiBzeTtcbiAgICBvdXRbNV0gPSAoMSAtICh4eCArIHp6KSkgKiBzeTtcbiAgICBvdXRbNl0gPSAoeXogKyB3eCkgKiBzeTtcbiAgICBvdXRbN10gPSAwO1xuICAgIG91dFs4XSA9ICh4eiArIHd5KSAqIHN6O1xuICAgIG91dFs5XSA9ICh5eiAtIHd4KSAqIHN6O1xuICAgIG91dFsxMF0gPSAoMSAtICh4eCArIHl5KSkgKiBzejtcbiAgICBvdXRbMTFdID0gMDtcbiAgICBvdXRbMTJdID0gdlswXTtcbiAgICBvdXRbMTNdID0gdlsxXTtcbiAgICBvdXRbMTRdID0gdlsyXTtcbiAgICBvdXRbMTVdID0gMTtcblxuICAgIHJldHVybiBvdXQ7XG59O1xuXG4vKipcbiAqIENyZWF0ZXMgYSBtYXRyaXggZnJvbSBhIHF1YXRlcm5pb24gcm90YXRpb24sIHZlY3RvciB0cmFuc2xhdGlvbiBhbmQgdmVjdG9yIHNjYWxlLCByb3RhdGluZyBhbmQgc2NhbGluZyBhcm91bmQgdGhlIGdpdmVuIG9yaWdpblxuICogVGhpcyBpcyBlcXVpdmFsZW50IHRvIChidXQgbXVjaCBmYXN0ZXIgdGhhbik6XG4gKlxuICogICAgIG1hdDQuaWRlbnRpdHkoZGVzdCk7XG4gKiAgICAgbWF0NC50cmFuc2xhdGUoZGVzdCwgdmVjKTtcbiAqICAgICBtYXQ0LnRyYW5zbGF0ZShkZXN0LCBvcmlnaW4pO1xuICogICAgIHZhciBxdWF0TWF0ID0gbWF0NC5jcmVhdGUoKTtcbiAqICAgICBxdWF0NC50b01hdDQocXVhdCwgcXVhdE1hdCk7XG4gKiAgICAgbWF0NC5tdWx0aXBseShkZXN0LCBxdWF0TWF0KTtcbiAqICAgICBtYXQ0LnNjYWxlKGRlc3QsIHNjYWxlKVxuICogICAgIG1hdDQudHJhbnNsYXRlKGRlc3QsIG5lZ2F0aXZlT3JpZ2luKTtcbiAqXG4gKiBAcGFyYW0ge21hdDR9IG91dCBtYXQ0IHJlY2VpdmluZyBvcGVyYXRpb24gcmVzdWx0XG4gKiBAcGFyYW0ge3F1YXQ0fSBxIFJvdGF0aW9uIHF1YXRlcm5pb25cbiAqIEBwYXJhbSB7dmVjM30gdiBUcmFuc2xhdGlvbiB2ZWN0b3JcbiAqIEBwYXJhbSB7dmVjM30gcyBTY2FsaW5nIHZlY3RvclxuICogQHBhcmFtIHt2ZWMzfSBvIFRoZSBvcmlnaW4gdmVjdG9yIGFyb3VuZCB3aGljaCB0byBzY2FsZSBhbmQgcm90YXRlXG4gKiBAcmV0dXJucyB7bWF0NH0gb3V0XG4gKi9cbm1hdDQuZnJvbVJvdGF0aW9uVHJhbnNsYXRpb25TY2FsZU9yaWdpbiA9IGZ1bmN0aW9uIChvdXQsIHEsIHYsIHMsIG8pIHtcbiAgLy8gUXVhdGVybmlvbiBtYXRoXG4gIHZhciB4ID0gcVswXSwgeSA9IHFbMV0sIHogPSBxWzJdLCB3ID0gcVszXSxcbiAgICAgIHgyID0geCArIHgsXG4gICAgICB5MiA9IHkgKyB5LFxuICAgICAgejIgPSB6ICsgeixcblxuICAgICAgeHggPSB4ICogeDIsXG4gICAgICB4eSA9IHggKiB5MixcbiAgICAgIHh6ID0geCAqIHoyLFxuICAgICAgeXkgPSB5ICogeTIsXG4gICAgICB5eiA9IHkgKiB6MixcbiAgICAgIHp6ID0geiAqIHoyLFxuICAgICAgd3ggPSB3ICogeDIsXG4gICAgICB3eSA9IHcgKiB5MixcbiAgICAgIHd6ID0gdyAqIHoyLFxuXG4gICAgICBzeCA9IHNbMF0sXG4gICAgICBzeSA9IHNbMV0sXG4gICAgICBzeiA9IHNbMl0sXG5cbiAgICAgIG94ID0gb1swXSxcbiAgICAgIG95ID0gb1sxXSxcbiAgICAgIG96ID0gb1syXTtcblxuICBvdXRbMF0gPSAoMSAtICh5eSArIHp6KSkgKiBzeDtcbiAgb3V0WzFdID0gKHh5ICsgd3opICogc3g7XG4gIG91dFsyXSA9ICh4eiAtIHd5KSAqIHN4O1xuICBvdXRbM10gPSAwO1xuICBvdXRbNF0gPSAoeHkgLSB3eikgKiBzeTtcbiAgb3V0WzVdID0gKDEgLSAoeHggKyB6eikpICogc3k7XG4gIG91dFs2XSA9ICh5eiArIHd4KSAqIHN5O1xuICBvdXRbN10gPSAwO1xuICBvdXRbOF0gPSAoeHogKyB3eSkgKiBzejtcbiAgb3V0WzldID0gKHl6IC0gd3gpICogc3o7XG4gIG91dFsxMF0gPSAoMSAtICh4eCArIHl5KSkgKiBzejtcbiAgb3V0WzExXSA9IDA7XG4gIG91dFsxMl0gPSB2WzBdICsgb3ggLSAob3V0WzBdICogb3ggKyBvdXRbNF0gKiBveSArIG91dFs4XSAqIG96KTtcbiAgb3V0WzEzXSA9IHZbMV0gKyBveSAtIChvdXRbMV0gKiBveCArIG91dFs1XSAqIG95ICsgb3V0WzldICogb3opO1xuICBvdXRbMTRdID0gdlsyXSArIG96IC0gKG91dFsyXSAqIG94ICsgb3V0WzZdICogb3kgKyBvdXRbMTBdICogb3opO1xuICBvdXRbMTVdID0gMTtcblxuICByZXR1cm4gb3V0O1xufTtcblxuLyoqXG4gKiBDYWxjdWxhdGVzIGEgNHg0IG1hdHJpeCBmcm9tIHRoZSBnaXZlbiBxdWF0ZXJuaW9uXG4gKlxuICogQHBhcmFtIHttYXQ0fSBvdXQgbWF0NCByZWNlaXZpbmcgb3BlcmF0aW9uIHJlc3VsdFxuICogQHBhcmFtIHtxdWF0fSBxIFF1YXRlcm5pb24gdG8gY3JlYXRlIG1hdHJpeCBmcm9tXG4gKlxuICogQHJldHVybnMge21hdDR9IG91dFxuICovXG5tYXQ0LmZyb21RdWF0ID0gZnVuY3Rpb24gKG91dCwgcSkge1xuICAgIHZhciB4ID0gcVswXSwgeSA9IHFbMV0sIHogPSBxWzJdLCB3ID0gcVszXSxcbiAgICAgICAgeDIgPSB4ICsgeCxcbiAgICAgICAgeTIgPSB5ICsgeSxcbiAgICAgICAgejIgPSB6ICsgeixcblxuICAgICAgICB4eCA9IHggKiB4MixcbiAgICAgICAgeXggPSB5ICogeDIsXG4gICAgICAgIHl5ID0geSAqIHkyLFxuICAgICAgICB6eCA9IHogKiB4MixcbiAgICAgICAgenkgPSB6ICogeTIsXG4gICAgICAgIHp6ID0geiAqIHoyLFxuICAgICAgICB3eCA9IHcgKiB4MixcbiAgICAgICAgd3kgPSB3ICogeTIsXG4gICAgICAgIHd6ID0gdyAqIHoyO1xuXG4gICAgb3V0WzBdID0gMSAtIHl5IC0geno7XG4gICAgb3V0WzFdID0geXggKyB3ejtcbiAgICBvdXRbMl0gPSB6eCAtIHd5O1xuICAgIG91dFszXSA9IDA7XG5cbiAgICBvdXRbNF0gPSB5eCAtIHd6O1xuICAgIG91dFs1XSA9IDEgLSB4eCAtIHp6O1xuICAgIG91dFs2XSA9IHp5ICsgd3g7XG4gICAgb3V0WzddID0gMDtcblxuICAgIG91dFs4XSA9IHp4ICsgd3k7XG4gICAgb3V0WzldID0genkgLSB3eDtcbiAgICBvdXRbMTBdID0gMSAtIHh4IC0geXk7XG4gICAgb3V0WzExXSA9IDA7XG5cbiAgICBvdXRbMTJdID0gMDtcbiAgICBvdXRbMTNdID0gMDtcbiAgICBvdXRbMTRdID0gMDtcbiAgICBvdXRbMTVdID0gMTtcblxuICAgIHJldHVybiBvdXQ7XG59O1xuXG4vKipcbiAqIEdlbmVyYXRlcyBhIGZydXN0dW0gbWF0cml4IHdpdGggdGhlIGdpdmVuIGJvdW5kc1xuICpcbiAqIEBwYXJhbSB7bWF0NH0gb3V0IG1hdDQgZnJ1c3R1bSBtYXRyaXggd2lsbCBiZSB3cml0dGVuIGludG9cbiAqIEBwYXJhbSB7TnVtYmVyfSBsZWZ0IExlZnQgYm91bmQgb2YgdGhlIGZydXN0dW1cbiAqIEBwYXJhbSB7TnVtYmVyfSByaWdodCBSaWdodCBib3VuZCBvZiB0aGUgZnJ1c3R1bVxuICogQHBhcmFtIHtOdW1iZXJ9IGJvdHRvbSBCb3R0b20gYm91bmQgb2YgdGhlIGZydXN0dW1cbiAqIEBwYXJhbSB7TnVtYmVyfSB0b3AgVG9wIGJvdW5kIG9mIHRoZSBmcnVzdHVtXG4gKiBAcGFyYW0ge051bWJlcn0gbmVhciBOZWFyIGJvdW5kIG9mIHRoZSBmcnVzdHVtXG4gKiBAcGFyYW0ge051bWJlcn0gZmFyIEZhciBib3VuZCBvZiB0aGUgZnJ1c3R1bVxuICogQHJldHVybnMge21hdDR9IG91dFxuICovXG5tYXQ0LmZydXN0dW0gPSBmdW5jdGlvbiAob3V0LCBsZWZ0LCByaWdodCwgYm90dG9tLCB0b3AsIG5lYXIsIGZhcikge1xuICAgIHZhciBybCA9IDEgLyAocmlnaHQgLSBsZWZ0KSxcbiAgICAgICAgdGIgPSAxIC8gKHRvcCAtIGJvdHRvbSksXG4gICAgICAgIG5mID0gMSAvIChuZWFyIC0gZmFyKTtcbiAgICBvdXRbMF0gPSAobmVhciAqIDIpICogcmw7XG4gICAgb3V0WzFdID0gMDtcbiAgICBvdXRbMl0gPSAwO1xuICAgIG91dFszXSA9IDA7XG4gICAgb3V0WzRdID0gMDtcbiAgICBvdXRbNV0gPSAobmVhciAqIDIpICogdGI7XG4gICAgb3V0WzZdID0gMDtcbiAgICBvdXRbN10gPSAwO1xuICAgIG91dFs4XSA9IChyaWdodCArIGxlZnQpICogcmw7XG4gICAgb3V0WzldID0gKHRvcCArIGJvdHRvbSkgKiB0YjtcbiAgICBvdXRbMTBdID0gKGZhciArIG5lYXIpICogbmY7XG4gICAgb3V0WzExXSA9IC0xO1xuICAgIG91dFsxMl0gPSAwO1xuICAgIG91dFsxM10gPSAwO1xuICAgIG91dFsxNF0gPSAoZmFyICogbmVhciAqIDIpICogbmY7XG4gICAgb3V0WzE1XSA9IDA7XG4gICAgcmV0dXJuIG91dDtcbn07XG5cbi8qKlxuICogR2VuZXJhdGVzIGEgcGVyc3BlY3RpdmUgcHJvamVjdGlvbiBtYXRyaXggd2l0aCB0aGUgZ2l2ZW4gYm91bmRzXG4gKlxuICogQHBhcmFtIHttYXQ0fSBvdXQgbWF0NCBmcnVzdHVtIG1hdHJpeCB3aWxsIGJlIHdyaXR0ZW4gaW50b1xuICogQHBhcmFtIHtudW1iZXJ9IGZvdnkgVmVydGljYWwgZmllbGQgb2YgdmlldyBpbiByYWRpYW5zXG4gKiBAcGFyYW0ge251bWJlcn0gYXNwZWN0IEFzcGVjdCByYXRpby4gdHlwaWNhbGx5IHZpZXdwb3J0IHdpZHRoL2hlaWdodFxuICogQHBhcmFtIHtudW1iZXJ9IG5lYXIgTmVhciBib3VuZCBvZiB0aGUgZnJ1c3R1bVxuICogQHBhcmFtIHtudW1iZXJ9IGZhciBGYXIgYm91bmQgb2YgdGhlIGZydXN0dW1cbiAqIEByZXR1cm5zIHttYXQ0fSBvdXRcbiAqL1xubWF0NC5wZXJzcGVjdGl2ZSA9IGZ1bmN0aW9uIChvdXQsIGZvdnksIGFzcGVjdCwgbmVhciwgZmFyKSB7XG4gICAgdmFyIGYgPSAxLjAgLyBNYXRoLnRhbihmb3Z5IC8gMiksXG4gICAgICAgIG5mID0gMSAvIChuZWFyIC0gZmFyKTtcbiAgICBvdXRbMF0gPSBmIC8gYXNwZWN0O1xuICAgIG91dFsxXSA9IDA7XG4gICAgb3V0WzJdID0gMDtcbiAgICBvdXRbM10gPSAwO1xuICAgIG91dFs0XSA9IDA7XG4gICAgb3V0WzVdID0gZjtcbiAgICBvdXRbNl0gPSAwO1xuICAgIG91dFs3XSA9IDA7XG4gICAgb3V0WzhdID0gMDtcbiAgICBvdXRbOV0gPSAwO1xuICAgIG91dFsxMF0gPSAoZmFyICsgbmVhcikgKiBuZjtcbiAgICBvdXRbMTFdID0gLTE7XG4gICAgb3V0WzEyXSA9IDA7XG4gICAgb3V0WzEzXSA9IDA7XG4gICAgb3V0WzE0XSA9ICgyICogZmFyICogbmVhcikgKiBuZjtcbiAgICBvdXRbMTVdID0gMDtcbiAgICByZXR1cm4gb3V0O1xufTtcblxuLyoqXG4gKiBHZW5lcmF0ZXMgYSBwZXJzcGVjdGl2ZSBwcm9qZWN0aW9uIG1hdHJpeCB3aXRoIHRoZSBnaXZlbiBmaWVsZCBvZiB2aWV3LlxuICogVGhpcyBpcyBwcmltYXJpbHkgdXNlZnVsIGZvciBnZW5lcmF0aW5nIHByb2plY3Rpb24gbWF0cmljZXMgdG8gYmUgdXNlZFxuICogd2l0aCB0aGUgc3RpbGwgZXhwZXJpZW1lbnRhbCBXZWJWUiBBUEkuXG4gKlxuICogQHBhcmFtIHttYXQ0fSBvdXQgbWF0NCBmcnVzdHVtIG1hdHJpeCB3aWxsIGJlIHdyaXR0ZW4gaW50b1xuICogQHBhcmFtIHtPYmplY3R9IGZvdiBPYmplY3QgY29udGFpbmluZyB0aGUgZm9sbG93aW5nIHZhbHVlczogdXBEZWdyZWVzLCBkb3duRGVncmVlcywgbGVmdERlZ3JlZXMsIHJpZ2h0RGVncmVlc1xuICogQHBhcmFtIHtudW1iZXJ9IG5lYXIgTmVhciBib3VuZCBvZiB0aGUgZnJ1c3R1bVxuICogQHBhcmFtIHtudW1iZXJ9IGZhciBGYXIgYm91bmQgb2YgdGhlIGZydXN0dW1cbiAqIEByZXR1cm5zIHttYXQ0fSBvdXRcbiAqL1xubWF0NC5wZXJzcGVjdGl2ZUZyb21GaWVsZE9mVmlldyA9IGZ1bmN0aW9uIChvdXQsIGZvdiwgbmVhciwgZmFyKSB7XG4gICAgdmFyIHVwVGFuID0gTWF0aC50YW4oZm92LnVwRGVncmVlcyAqIE1hdGguUEkvMTgwLjApLFxuICAgICAgICBkb3duVGFuID0gTWF0aC50YW4oZm92LmRvd25EZWdyZWVzICogTWF0aC5QSS8xODAuMCksXG4gICAgICAgIGxlZnRUYW4gPSBNYXRoLnRhbihmb3YubGVmdERlZ3JlZXMgKiBNYXRoLlBJLzE4MC4wKSxcbiAgICAgICAgcmlnaHRUYW4gPSBNYXRoLnRhbihmb3YucmlnaHREZWdyZWVzICogTWF0aC5QSS8xODAuMCksXG4gICAgICAgIHhTY2FsZSA9IDIuMCAvIChsZWZ0VGFuICsgcmlnaHRUYW4pLFxuICAgICAgICB5U2NhbGUgPSAyLjAgLyAodXBUYW4gKyBkb3duVGFuKTtcblxuICAgIG91dFswXSA9IHhTY2FsZTtcbiAgICBvdXRbMV0gPSAwLjA7XG4gICAgb3V0WzJdID0gMC4wO1xuICAgIG91dFszXSA9IDAuMDtcbiAgICBvdXRbNF0gPSAwLjA7XG4gICAgb3V0WzVdID0geVNjYWxlO1xuICAgIG91dFs2XSA9IDAuMDtcbiAgICBvdXRbN10gPSAwLjA7XG4gICAgb3V0WzhdID0gLSgobGVmdFRhbiAtIHJpZ2h0VGFuKSAqIHhTY2FsZSAqIDAuNSk7XG4gICAgb3V0WzldID0gKCh1cFRhbiAtIGRvd25UYW4pICogeVNjYWxlICogMC41KTtcbiAgICBvdXRbMTBdID0gZmFyIC8gKG5lYXIgLSBmYXIpO1xuICAgIG91dFsxMV0gPSAtMS4wO1xuICAgIG91dFsxMl0gPSAwLjA7XG4gICAgb3V0WzEzXSA9IDAuMDtcbiAgICBvdXRbMTRdID0gKGZhciAqIG5lYXIpIC8gKG5lYXIgLSBmYXIpO1xuICAgIG91dFsxNV0gPSAwLjA7XG4gICAgcmV0dXJuIG91dDtcbn1cblxuLyoqXG4gKiBHZW5lcmF0ZXMgYSBvcnRob2dvbmFsIHByb2plY3Rpb24gbWF0cml4IHdpdGggdGhlIGdpdmVuIGJvdW5kc1xuICpcbiAqIEBwYXJhbSB7bWF0NH0gb3V0IG1hdDQgZnJ1c3R1bSBtYXRyaXggd2lsbCBiZSB3cml0dGVuIGludG9cbiAqIEBwYXJhbSB7bnVtYmVyfSBsZWZ0IExlZnQgYm91bmQgb2YgdGhlIGZydXN0dW1cbiAqIEBwYXJhbSB7bnVtYmVyfSByaWdodCBSaWdodCBib3VuZCBvZiB0aGUgZnJ1c3R1bVxuICogQHBhcmFtIHtudW1iZXJ9IGJvdHRvbSBCb3R0b20gYm91bmQgb2YgdGhlIGZydXN0dW1cbiAqIEBwYXJhbSB7bnVtYmVyfSB0b3AgVG9wIGJvdW5kIG9mIHRoZSBmcnVzdHVtXG4gKiBAcGFyYW0ge251bWJlcn0gbmVhciBOZWFyIGJvdW5kIG9mIHRoZSBmcnVzdHVtXG4gKiBAcGFyYW0ge251bWJlcn0gZmFyIEZhciBib3VuZCBvZiB0aGUgZnJ1c3R1bVxuICogQHJldHVybnMge21hdDR9IG91dFxuICovXG5tYXQ0Lm9ydGhvID0gZnVuY3Rpb24gKG91dCwgbGVmdCwgcmlnaHQsIGJvdHRvbSwgdG9wLCBuZWFyLCBmYXIpIHtcbiAgICB2YXIgbHIgPSAxIC8gKGxlZnQgLSByaWdodCksXG4gICAgICAgIGJ0ID0gMSAvIChib3R0b20gLSB0b3ApLFxuICAgICAgICBuZiA9IDEgLyAobmVhciAtIGZhcik7XG4gICAgb3V0WzBdID0gLTIgKiBscjtcbiAgICBvdXRbMV0gPSAwO1xuICAgIG91dFsyXSA9IDA7XG4gICAgb3V0WzNdID0gMDtcbiAgICBvdXRbNF0gPSAwO1xuICAgIG91dFs1XSA9IC0yICogYnQ7XG4gICAgb3V0WzZdID0gMDtcbiAgICBvdXRbN10gPSAwO1xuICAgIG91dFs4XSA9IDA7XG4gICAgb3V0WzldID0gMDtcbiAgICBvdXRbMTBdID0gMiAqIG5mO1xuICAgIG91dFsxMV0gPSAwO1xuICAgIG91dFsxMl0gPSAobGVmdCArIHJpZ2h0KSAqIGxyO1xuICAgIG91dFsxM10gPSAodG9wICsgYm90dG9tKSAqIGJ0O1xuICAgIG91dFsxNF0gPSAoZmFyICsgbmVhcikgKiBuZjtcbiAgICBvdXRbMTVdID0gMTtcbiAgICByZXR1cm4gb3V0O1xufTtcblxuLyoqXG4gKiBHZW5lcmF0ZXMgYSBsb29rLWF0IG1hdHJpeCB3aXRoIHRoZSBnaXZlbiBleWUgcG9zaXRpb24sIGZvY2FsIHBvaW50LCBhbmQgdXAgYXhpc1xuICpcbiAqIEBwYXJhbSB7bWF0NH0gb3V0IG1hdDQgZnJ1c3R1bSBtYXRyaXggd2lsbCBiZSB3cml0dGVuIGludG9cbiAqIEBwYXJhbSB7dmVjM30gZXllIFBvc2l0aW9uIG9mIHRoZSB2aWV3ZXJcbiAqIEBwYXJhbSB7dmVjM30gY2VudGVyIFBvaW50IHRoZSB2aWV3ZXIgaXMgbG9va2luZyBhdFxuICogQHBhcmFtIHt2ZWMzfSB1cCB2ZWMzIHBvaW50aW5nIHVwXG4gKiBAcmV0dXJucyB7bWF0NH0gb3V0XG4gKi9cbm1hdDQubG9va0F0ID0gZnVuY3Rpb24gKG91dCwgZXllLCBjZW50ZXIsIHVwKSB7XG4gICAgdmFyIHgwLCB4MSwgeDIsIHkwLCB5MSwgeTIsIHowLCB6MSwgejIsIGxlbixcbiAgICAgICAgZXlleCA9IGV5ZVswXSxcbiAgICAgICAgZXlleSA9IGV5ZVsxXSxcbiAgICAgICAgZXlleiA9IGV5ZVsyXSxcbiAgICAgICAgdXB4ID0gdXBbMF0sXG4gICAgICAgIHVweSA9IHVwWzFdLFxuICAgICAgICB1cHogPSB1cFsyXSxcbiAgICAgICAgY2VudGVyeCA9IGNlbnRlclswXSxcbiAgICAgICAgY2VudGVyeSA9IGNlbnRlclsxXSxcbiAgICAgICAgY2VudGVyeiA9IGNlbnRlclsyXTtcblxuICAgIGlmIChNYXRoLmFicyhleWV4IC0gY2VudGVyeCkgPCBnbE1hdHJpeC5FUFNJTE9OICYmXG4gICAgICAgIE1hdGguYWJzKGV5ZXkgLSBjZW50ZXJ5KSA8IGdsTWF0cml4LkVQU0lMT04gJiZcbiAgICAgICAgTWF0aC5hYnMoZXlleiAtIGNlbnRlcnopIDwgZ2xNYXRyaXguRVBTSUxPTikge1xuICAgICAgICByZXR1cm4gbWF0NC5pZGVudGl0eShvdXQpO1xuICAgIH1cblxuICAgIHowID0gZXlleCAtIGNlbnRlcng7XG4gICAgejEgPSBleWV5IC0gY2VudGVyeTtcbiAgICB6MiA9IGV5ZXogLSBjZW50ZXJ6O1xuXG4gICAgbGVuID0gMSAvIE1hdGguc3FydCh6MCAqIHowICsgejEgKiB6MSArIHoyICogejIpO1xuICAgIHowICo9IGxlbjtcbiAgICB6MSAqPSBsZW47XG4gICAgejIgKj0gbGVuO1xuXG4gICAgeDAgPSB1cHkgKiB6MiAtIHVweiAqIHoxO1xuICAgIHgxID0gdXB6ICogejAgLSB1cHggKiB6MjtcbiAgICB4MiA9IHVweCAqIHoxIC0gdXB5ICogejA7XG4gICAgbGVuID0gTWF0aC5zcXJ0KHgwICogeDAgKyB4MSAqIHgxICsgeDIgKiB4Mik7XG4gICAgaWYgKCFsZW4pIHtcbiAgICAgICAgeDAgPSAwO1xuICAgICAgICB4MSA9IDA7XG4gICAgICAgIHgyID0gMDtcbiAgICB9IGVsc2Uge1xuICAgICAgICBsZW4gPSAxIC8gbGVuO1xuICAgICAgICB4MCAqPSBsZW47XG4gICAgICAgIHgxICo9IGxlbjtcbiAgICAgICAgeDIgKj0gbGVuO1xuICAgIH1cblxuICAgIHkwID0gejEgKiB4MiAtIHoyICogeDE7XG4gICAgeTEgPSB6MiAqIHgwIC0gejAgKiB4MjtcbiAgICB5MiA9IHowICogeDEgLSB6MSAqIHgwO1xuXG4gICAgbGVuID0gTWF0aC5zcXJ0KHkwICogeTAgKyB5MSAqIHkxICsgeTIgKiB5Mik7XG4gICAgaWYgKCFsZW4pIHtcbiAgICAgICAgeTAgPSAwO1xuICAgICAgICB5MSA9IDA7XG4gICAgICAgIHkyID0gMDtcbiAgICB9IGVsc2Uge1xuICAgICAgICBsZW4gPSAxIC8gbGVuO1xuICAgICAgICB5MCAqPSBsZW47XG4gICAgICAgIHkxICo9IGxlbjtcbiAgICAgICAgeTIgKj0gbGVuO1xuICAgIH1cblxuICAgIG91dFswXSA9IHgwO1xuICAgIG91dFsxXSA9IHkwO1xuICAgIG91dFsyXSA9IHowO1xuICAgIG91dFszXSA9IDA7XG4gICAgb3V0WzRdID0geDE7XG4gICAgb3V0WzVdID0geTE7XG4gICAgb3V0WzZdID0gejE7XG4gICAgb3V0WzddID0gMDtcbiAgICBvdXRbOF0gPSB4MjtcbiAgICBvdXRbOV0gPSB5MjtcbiAgICBvdXRbMTBdID0gejI7XG4gICAgb3V0WzExXSA9IDA7XG4gICAgb3V0WzEyXSA9IC0oeDAgKiBleWV4ICsgeDEgKiBleWV5ICsgeDIgKiBleWV6KTtcbiAgICBvdXRbMTNdID0gLSh5MCAqIGV5ZXggKyB5MSAqIGV5ZXkgKyB5MiAqIGV5ZXopO1xuICAgIG91dFsxNF0gPSAtKHowICogZXlleCArIHoxICogZXlleSArIHoyICogZXlleik7XG4gICAgb3V0WzE1XSA9IDE7XG5cbiAgICByZXR1cm4gb3V0O1xufTtcblxuLyoqXG4gKiBSZXR1cm5zIGEgc3RyaW5nIHJlcHJlc2VudGF0aW9uIG9mIGEgbWF0NFxuICpcbiAqIEBwYXJhbSB7bWF0NH0gbWF0IG1hdHJpeCB0byByZXByZXNlbnQgYXMgYSBzdHJpbmdcbiAqIEByZXR1cm5zIHtTdHJpbmd9IHN0cmluZyByZXByZXNlbnRhdGlvbiBvZiB0aGUgbWF0cml4XG4gKi9cbm1hdDQuc3RyID0gZnVuY3Rpb24gKGEpIHtcbiAgICByZXR1cm4gJ21hdDQoJyArIGFbMF0gKyAnLCAnICsgYVsxXSArICcsICcgKyBhWzJdICsgJywgJyArIGFbM10gKyAnLCAnICtcbiAgICAgICAgICAgICAgICAgICAgYVs0XSArICcsICcgKyBhWzVdICsgJywgJyArIGFbNl0gKyAnLCAnICsgYVs3XSArICcsICcgK1xuICAgICAgICAgICAgICAgICAgICBhWzhdICsgJywgJyArIGFbOV0gKyAnLCAnICsgYVsxMF0gKyAnLCAnICsgYVsxMV0gKyAnLCAnICtcbiAgICAgICAgICAgICAgICAgICAgYVsxMl0gKyAnLCAnICsgYVsxM10gKyAnLCAnICsgYVsxNF0gKyAnLCAnICsgYVsxNV0gKyAnKSc7XG59O1xuXG4vKipcbiAqIFJldHVybnMgRnJvYmVuaXVzIG5vcm0gb2YgYSBtYXQ0XG4gKlxuICogQHBhcmFtIHttYXQ0fSBhIHRoZSBtYXRyaXggdG8gY2FsY3VsYXRlIEZyb2Jlbml1cyBub3JtIG9mXG4gKiBAcmV0dXJucyB7TnVtYmVyfSBGcm9iZW5pdXMgbm9ybVxuICovXG5tYXQ0LmZyb2IgPSBmdW5jdGlvbiAoYSkge1xuICAgIHJldHVybihNYXRoLnNxcnQoTWF0aC5wb3coYVswXSwgMikgKyBNYXRoLnBvdyhhWzFdLCAyKSArIE1hdGgucG93KGFbMl0sIDIpICsgTWF0aC5wb3coYVszXSwgMikgKyBNYXRoLnBvdyhhWzRdLCAyKSArIE1hdGgucG93KGFbNV0sIDIpICsgTWF0aC5wb3coYVs2XSwgMikgKyBNYXRoLnBvdyhhWzddLCAyKSArIE1hdGgucG93KGFbOF0sIDIpICsgTWF0aC5wb3coYVs5XSwgMikgKyBNYXRoLnBvdyhhWzEwXSwgMikgKyBNYXRoLnBvdyhhWzExXSwgMikgKyBNYXRoLnBvdyhhWzEyXSwgMikgKyBNYXRoLnBvdyhhWzEzXSwgMikgKyBNYXRoLnBvdyhhWzE0XSwgMikgKyBNYXRoLnBvdyhhWzE1XSwgMikgKSlcbn07XG5cbi8qKlxuICogQWRkcyB0d28gbWF0NCdzXG4gKlxuICogQHBhcmFtIHttYXQ0fSBvdXQgdGhlIHJlY2VpdmluZyBtYXRyaXhcbiAqIEBwYXJhbSB7bWF0NH0gYSB0aGUgZmlyc3Qgb3BlcmFuZFxuICogQHBhcmFtIHttYXQ0fSBiIHRoZSBzZWNvbmQgb3BlcmFuZFxuICogQHJldHVybnMge21hdDR9IG91dFxuICovXG5tYXQ0LmFkZCA9IGZ1bmN0aW9uKG91dCwgYSwgYikge1xuICAgIG91dFswXSA9IGFbMF0gKyBiWzBdO1xuICAgIG91dFsxXSA9IGFbMV0gKyBiWzFdO1xuICAgIG91dFsyXSA9IGFbMl0gKyBiWzJdO1xuICAgIG91dFszXSA9IGFbM10gKyBiWzNdO1xuICAgIG91dFs0XSA9IGFbNF0gKyBiWzRdO1xuICAgIG91dFs1XSA9IGFbNV0gKyBiWzVdO1xuICAgIG91dFs2XSA9IGFbNl0gKyBiWzZdO1xuICAgIG91dFs3XSA9IGFbN10gKyBiWzddO1xuICAgIG91dFs4XSA9IGFbOF0gKyBiWzhdO1xuICAgIG91dFs5XSA9IGFbOV0gKyBiWzldO1xuICAgIG91dFsxMF0gPSBhWzEwXSArIGJbMTBdO1xuICAgIG91dFsxMV0gPSBhWzExXSArIGJbMTFdO1xuICAgIG91dFsxMl0gPSBhWzEyXSArIGJbMTJdO1xuICAgIG91dFsxM10gPSBhWzEzXSArIGJbMTNdO1xuICAgIG91dFsxNF0gPSBhWzE0XSArIGJbMTRdO1xuICAgIG91dFsxNV0gPSBhWzE1XSArIGJbMTVdO1xuICAgIHJldHVybiBvdXQ7XG59O1xuXG4vKipcbiAqIFN1YnRyYWN0cyBtYXRyaXggYiBmcm9tIG1hdHJpeCBhXG4gKlxuICogQHBhcmFtIHttYXQ0fSBvdXQgdGhlIHJlY2VpdmluZyBtYXRyaXhcbiAqIEBwYXJhbSB7bWF0NH0gYSB0aGUgZmlyc3Qgb3BlcmFuZFxuICogQHBhcmFtIHttYXQ0fSBiIHRoZSBzZWNvbmQgb3BlcmFuZFxuICogQHJldHVybnMge21hdDR9IG91dFxuICovXG5tYXQ0LnN1YnRyYWN0ID0gZnVuY3Rpb24ob3V0LCBhLCBiKSB7XG4gICAgb3V0WzBdID0gYVswXSAtIGJbMF07XG4gICAgb3V0WzFdID0gYVsxXSAtIGJbMV07XG4gICAgb3V0WzJdID0gYVsyXSAtIGJbMl07XG4gICAgb3V0WzNdID0gYVszXSAtIGJbM107XG4gICAgb3V0WzRdID0gYVs0XSAtIGJbNF07XG4gICAgb3V0WzVdID0gYVs1XSAtIGJbNV07XG4gICAgb3V0WzZdID0gYVs2XSAtIGJbNl07XG4gICAgb3V0WzddID0gYVs3XSAtIGJbN107XG4gICAgb3V0WzhdID0gYVs4XSAtIGJbOF07XG4gICAgb3V0WzldID0gYVs5XSAtIGJbOV07XG4gICAgb3V0WzEwXSA9IGFbMTBdIC0gYlsxMF07XG4gICAgb3V0WzExXSA9IGFbMTFdIC0gYlsxMV07XG4gICAgb3V0WzEyXSA9IGFbMTJdIC0gYlsxMl07XG4gICAgb3V0WzEzXSA9IGFbMTNdIC0gYlsxM107XG4gICAgb3V0WzE0XSA9IGFbMTRdIC0gYlsxNF07XG4gICAgb3V0WzE1XSA9IGFbMTVdIC0gYlsxNV07XG4gICAgcmV0dXJuIG91dDtcbn07XG5cbi8qKlxuICogQWxpYXMgZm9yIHtAbGluayBtYXQ0LnN1YnRyYWN0fVxuICogQGZ1bmN0aW9uXG4gKi9cbm1hdDQuc3ViID0gbWF0NC5zdWJ0cmFjdDtcblxuLyoqXG4gKiBNdWx0aXBseSBlYWNoIGVsZW1lbnQgb2YgdGhlIG1hdHJpeCBieSBhIHNjYWxhci5cbiAqXG4gKiBAcGFyYW0ge21hdDR9IG91dCB0aGUgcmVjZWl2aW5nIG1hdHJpeFxuICogQHBhcmFtIHttYXQ0fSBhIHRoZSBtYXRyaXggdG8gc2NhbGVcbiAqIEBwYXJhbSB7TnVtYmVyfSBiIGFtb3VudCB0byBzY2FsZSB0aGUgbWF0cml4J3MgZWxlbWVudHMgYnlcbiAqIEByZXR1cm5zIHttYXQ0fSBvdXRcbiAqL1xubWF0NC5tdWx0aXBseVNjYWxhciA9IGZ1bmN0aW9uKG91dCwgYSwgYikge1xuICAgIG91dFswXSA9IGFbMF0gKiBiO1xuICAgIG91dFsxXSA9IGFbMV0gKiBiO1xuICAgIG91dFsyXSA9IGFbMl0gKiBiO1xuICAgIG91dFszXSA9IGFbM10gKiBiO1xuICAgIG91dFs0XSA9IGFbNF0gKiBiO1xuICAgIG91dFs1XSA9IGFbNV0gKiBiO1xuICAgIG91dFs2XSA9IGFbNl0gKiBiO1xuICAgIG91dFs3XSA9IGFbN10gKiBiO1xuICAgIG91dFs4XSA9IGFbOF0gKiBiO1xuICAgIG91dFs5XSA9IGFbOV0gKiBiO1xuICAgIG91dFsxMF0gPSBhWzEwXSAqIGI7XG4gICAgb3V0WzExXSA9IGFbMTFdICogYjtcbiAgICBvdXRbMTJdID0gYVsxMl0gKiBiO1xuICAgIG91dFsxM10gPSBhWzEzXSAqIGI7XG4gICAgb3V0WzE0XSA9IGFbMTRdICogYjtcbiAgICBvdXRbMTVdID0gYVsxNV0gKiBiO1xuICAgIHJldHVybiBvdXQ7XG59O1xuXG4vKipcbiAqIEFkZHMgdHdvIG1hdDQncyBhZnRlciBtdWx0aXBseWluZyBlYWNoIGVsZW1lbnQgb2YgdGhlIHNlY29uZCBvcGVyYW5kIGJ5IGEgc2NhbGFyIHZhbHVlLlxuICpcbiAqIEBwYXJhbSB7bWF0NH0gb3V0IHRoZSByZWNlaXZpbmcgdmVjdG9yXG4gKiBAcGFyYW0ge21hdDR9IGEgdGhlIGZpcnN0IG9wZXJhbmRcbiAqIEBwYXJhbSB7bWF0NH0gYiB0aGUgc2Vjb25kIG9wZXJhbmRcbiAqIEBwYXJhbSB7TnVtYmVyfSBzY2FsZSB0aGUgYW1vdW50IHRvIHNjYWxlIGIncyBlbGVtZW50cyBieSBiZWZvcmUgYWRkaW5nXG4gKiBAcmV0dXJucyB7bWF0NH0gb3V0XG4gKi9cbm1hdDQubXVsdGlwbHlTY2FsYXJBbmRBZGQgPSBmdW5jdGlvbihvdXQsIGEsIGIsIHNjYWxlKSB7XG4gICAgb3V0WzBdID0gYVswXSArIChiWzBdICogc2NhbGUpO1xuICAgIG91dFsxXSA9IGFbMV0gKyAoYlsxXSAqIHNjYWxlKTtcbiAgICBvdXRbMl0gPSBhWzJdICsgKGJbMl0gKiBzY2FsZSk7XG4gICAgb3V0WzNdID0gYVszXSArIChiWzNdICogc2NhbGUpO1xuICAgIG91dFs0XSA9IGFbNF0gKyAoYls0XSAqIHNjYWxlKTtcbiAgICBvdXRbNV0gPSBhWzVdICsgKGJbNV0gKiBzY2FsZSk7XG4gICAgb3V0WzZdID0gYVs2XSArIChiWzZdICogc2NhbGUpO1xuICAgIG91dFs3XSA9IGFbN10gKyAoYls3XSAqIHNjYWxlKTtcbiAgICBvdXRbOF0gPSBhWzhdICsgKGJbOF0gKiBzY2FsZSk7XG4gICAgb3V0WzldID0gYVs5XSArIChiWzldICogc2NhbGUpO1xuICAgIG91dFsxMF0gPSBhWzEwXSArIChiWzEwXSAqIHNjYWxlKTtcbiAgICBvdXRbMTFdID0gYVsxMV0gKyAoYlsxMV0gKiBzY2FsZSk7XG4gICAgb3V0WzEyXSA9IGFbMTJdICsgKGJbMTJdICogc2NhbGUpO1xuICAgIG91dFsxM10gPSBhWzEzXSArIChiWzEzXSAqIHNjYWxlKTtcbiAgICBvdXRbMTRdID0gYVsxNF0gKyAoYlsxNF0gKiBzY2FsZSk7XG4gICAgb3V0WzE1XSA9IGFbMTVdICsgKGJbMTVdICogc2NhbGUpO1xuICAgIHJldHVybiBvdXQ7XG59O1xuXG4vKipcbiAqIFJldHVybnMgd2hldGhlciBvciBub3QgdGhlIG1hdHJpY2VzIGhhdmUgZXhhY3RseSB0aGUgc2FtZSBlbGVtZW50cyBpbiB0aGUgc2FtZSBwb3NpdGlvbiAod2hlbiBjb21wYXJlZCB3aXRoID09PSlcbiAqXG4gKiBAcGFyYW0ge21hdDR9IGEgVGhlIGZpcnN0IG1hdHJpeC5cbiAqIEBwYXJhbSB7bWF0NH0gYiBUaGUgc2Vjb25kIG1hdHJpeC5cbiAqIEByZXR1cm5zIHtCb29sZWFufSBUcnVlIGlmIHRoZSBtYXRyaWNlcyBhcmUgZXF1YWwsIGZhbHNlIG90aGVyd2lzZS5cbiAqL1xubWF0NC5leGFjdEVxdWFscyA9IGZ1bmN0aW9uIChhLCBiKSB7XG4gICAgcmV0dXJuIGFbMF0gPT09IGJbMF0gJiYgYVsxXSA9PT0gYlsxXSAmJiBhWzJdID09PSBiWzJdICYmIGFbM10gPT09IGJbM10gJiYgXG4gICAgICAgICAgIGFbNF0gPT09IGJbNF0gJiYgYVs1XSA9PT0gYls1XSAmJiBhWzZdID09PSBiWzZdICYmIGFbN10gPT09IGJbN10gJiYgXG4gICAgICAgICAgIGFbOF0gPT09IGJbOF0gJiYgYVs5XSA9PT0gYls5XSAmJiBhWzEwXSA9PT0gYlsxMF0gJiYgYVsxMV0gPT09IGJbMTFdICYmXG4gICAgICAgICAgIGFbMTJdID09PSBiWzEyXSAmJiBhWzEzXSA9PT0gYlsxM10gJiYgYVsxNF0gPT09IGJbMTRdICYmIGFbMTVdID09PSBiWzE1XTtcbn07XG5cbi8qKlxuICogUmV0dXJucyB3aGV0aGVyIG9yIG5vdCB0aGUgbWF0cmljZXMgaGF2ZSBhcHByb3hpbWF0ZWx5IHRoZSBzYW1lIGVsZW1lbnRzIGluIHRoZSBzYW1lIHBvc2l0aW9uLlxuICpcbiAqIEBwYXJhbSB7bWF0NH0gYSBUaGUgZmlyc3QgbWF0cml4LlxuICogQHBhcmFtIHttYXQ0fSBiIFRoZSBzZWNvbmQgbWF0cml4LlxuICogQHJldHVybnMge0Jvb2xlYW59IFRydWUgaWYgdGhlIG1hdHJpY2VzIGFyZSBlcXVhbCwgZmFsc2Ugb3RoZXJ3aXNlLlxuICovXG5tYXQ0LmVxdWFscyA9IGZ1bmN0aW9uIChhLCBiKSB7XG4gICAgdmFyIGEwICA9IGFbMF0sICBhMSAgPSBhWzFdLCAgYTIgID0gYVsyXSwgIGEzICA9IGFbM10sXG4gICAgICAgIGE0ICA9IGFbNF0sICBhNSAgPSBhWzVdLCAgYTYgID0gYVs2XSwgIGE3ICA9IGFbN10sIFxuICAgICAgICBhOCAgPSBhWzhdLCAgYTkgID0gYVs5XSwgIGExMCA9IGFbMTBdLCBhMTEgPSBhWzExXSwgXG4gICAgICAgIGExMiA9IGFbMTJdLCBhMTMgPSBhWzEzXSwgYTE0ID0gYVsxNF0sIGExNSA9IGFbMTVdO1xuXG4gICAgdmFyIGIwICA9IGJbMF0sICBiMSAgPSBiWzFdLCAgYjIgID0gYlsyXSwgIGIzICA9IGJbM10sXG4gICAgICAgIGI0ICA9IGJbNF0sICBiNSAgPSBiWzVdLCAgYjYgID0gYls2XSwgIGI3ICA9IGJbN10sIFxuICAgICAgICBiOCAgPSBiWzhdLCAgYjkgID0gYls5XSwgIGIxMCA9IGJbMTBdLCBiMTEgPSBiWzExXSwgXG4gICAgICAgIGIxMiA9IGJbMTJdLCBiMTMgPSBiWzEzXSwgYjE0ID0gYlsxNF0sIGIxNSA9IGJbMTVdO1xuXG4gICAgcmV0dXJuIChNYXRoLmFicyhhMCAtIGIwKSA8PSBnbE1hdHJpeC5FUFNJTE9OKk1hdGgubWF4KDEuMCwgTWF0aC5hYnMoYTApLCBNYXRoLmFicyhiMCkpICYmXG4gICAgICAgICAgICBNYXRoLmFicyhhMSAtIGIxKSA8PSBnbE1hdHJpeC5FUFNJTE9OKk1hdGgubWF4KDEuMCwgTWF0aC5hYnMoYTEpLCBNYXRoLmFicyhiMSkpICYmXG4gICAgICAgICAgICBNYXRoLmFicyhhMiAtIGIyKSA8PSBnbE1hdHJpeC5FUFNJTE9OKk1hdGgubWF4KDEuMCwgTWF0aC5hYnMoYTIpLCBNYXRoLmFicyhiMikpICYmXG4gICAgICAgICAgICBNYXRoLmFicyhhMyAtIGIzKSA8PSBnbE1hdHJpeC5FUFNJTE9OKk1hdGgubWF4KDEuMCwgTWF0aC5hYnMoYTMpLCBNYXRoLmFicyhiMykpICYmXG4gICAgICAgICAgICBNYXRoLmFicyhhNCAtIGI0KSA8PSBnbE1hdHJpeC5FUFNJTE9OKk1hdGgubWF4KDEuMCwgTWF0aC5hYnMoYTQpLCBNYXRoLmFicyhiNCkpICYmXG4gICAgICAgICAgICBNYXRoLmFicyhhNSAtIGI1KSA8PSBnbE1hdHJpeC5FUFNJTE9OKk1hdGgubWF4KDEuMCwgTWF0aC5hYnMoYTUpLCBNYXRoLmFicyhiNSkpICYmXG4gICAgICAgICAgICBNYXRoLmFicyhhNiAtIGI2KSA8PSBnbE1hdHJpeC5FUFNJTE9OKk1hdGgubWF4KDEuMCwgTWF0aC5hYnMoYTYpLCBNYXRoLmFicyhiNikpICYmXG4gICAgICAgICAgICBNYXRoLmFicyhhNyAtIGI3KSA8PSBnbE1hdHJpeC5FUFNJTE9OKk1hdGgubWF4KDEuMCwgTWF0aC5hYnMoYTcpLCBNYXRoLmFicyhiNykpICYmXG4gICAgICAgICAgICBNYXRoLmFicyhhOCAtIGI4KSA8PSBnbE1hdHJpeC5FUFNJTE9OKk1hdGgubWF4KDEuMCwgTWF0aC5hYnMoYTgpLCBNYXRoLmFicyhiOCkpICYmXG4gICAgICAgICAgICBNYXRoLmFicyhhOSAtIGI5KSA8PSBnbE1hdHJpeC5FUFNJTE9OKk1hdGgubWF4KDEuMCwgTWF0aC5hYnMoYTkpLCBNYXRoLmFicyhiOSkpICYmXG4gICAgICAgICAgICBNYXRoLmFicyhhMTAgLSBiMTApIDw9IGdsTWF0cml4LkVQU0lMT04qTWF0aC5tYXgoMS4wLCBNYXRoLmFicyhhMTApLCBNYXRoLmFicyhiMTApKSAmJlxuICAgICAgICAgICAgTWF0aC5hYnMoYTExIC0gYjExKSA8PSBnbE1hdHJpeC5FUFNJTE9OKk1hdGgubWF4KDEuMCwgTWF0aC5hYnMoYTExKSwgTWF0aC5hYnMoYjExKSkgJiZcbiAgICAgICAgICAgIE1hdGguYWJzKGExMiAtIGIxMikgPD0gZ2xNYXRyaXguRVBTSUxPTipNYXRoLm1heCgxLjAsIE1hdGguYWJzKGExMiksIE1hdGguYWJzKGIxMikpICYmXG4gICAgICAgICAgICBNYXRoLmFicyhhMTMgLSBiMTMpIDw9IGdsTWF0cml4LkVQU0lMT04qTWF0aC5tYXgoMS4wLCBNYXRoLmFicyhhMTMpLCBNYXRoLmFicyhiMTMpKSAmJlxuICAgICAgICAgICAgTWF0aC5hYnMoYTE0IC0gYjE0KSA8PSBnbE1hdHJpeC5FUFNJTE9OKk1hdGgubWF4KDEuMCwgTWF0aC5hYnMoYTE0KSwgTWF0aC5hYnMoYjE0KSkgJiZcbiAgICAgICAgICAgIE1hdGguYWJzKGExNSAtIGIxNSkgPD0gZ2xNYXRyaXguRVBTSUxPTipNYXRoLm1heCgxLjAsIE1hdGguYWJzKGExNSksIE1hdGguYWJzKGIxNSkpKTtcbn07XG5cblxuXG5tb2R1bGUuZXhwb3J0cyA9IG1hdDQ7XG4iLCIvKiBDb3B5cmlnaHQgKGMpIDIwMTUsIEJyYW5kb24gSm9uZXMsIENvbGluIE1hY0tlbnppZSBJVi5cblxuUGVybWlzc2lvbiBpcyBoZXJlYnkgZ3JhbnRlZCwgZnJlZSBvZiBjaGFyZ2UsIHRvIGFueSBwZXJzb24gb2J0YWluaW5nIGEgY29weVxub2YgdGhpcyBzb2Z0d2FyZSBhbmQgYXNzb2NpYXRlZCBkb2N1bWVudGF0aW9uIGZpbGVzICh0aGUgXCJTb2Z0d2FyZVwiKSwgdG8gZGVhbFxuaW4gdGhlIFNvZnR3YXJlIHdpdGhvdXQgcmVzdHJpY3Rpb24sIGluY2x1ZGluZyB3aXRob3V0IGxpbWl0YXRpb24gdGhlIHJpZ2h0c1xudG8gdXNlLCBjb3B5LCBtb2RpZnksIG1lcmdlLCBwdWJsaXNoLCBkaXN0cmlidXRlLCBzdWJsaWNlbnNlLCBhbmQvb3Igc2VsbFxuY29waWVzIG9mIHRoZSBTb2Z0d2FyZSwgYW5kIHRvIHBlcm1pdCBwZXJzb25zIHRvIHdob20gdGhlIFNvZnR3YXJlIGlzXG5mdXJuaXNoZWQgdG8gZG8gc28sIHN1YmplY3QgdG8gdGhlIGZvbGxvd2luZyBjb25kaXRpb25zOlxuXG5UaGUgYWJvdmUgY29weXJpZ2h0IG5vdGljZSBhbmQgdGhpcyBwZXJtaXNzaW9uIG5vdGljZSBzaGFsbCBiZSBpbmNsdWRlZCBpblxuYWxsIGNvcGllcyBvciBzdWJzdGFudGlhbCBwb3J0aW9ucyBvZiB0aGUgU29mdHdhcmUuXG5cblRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCBcIkFTIElTXCIsIFdJVEhPVVQgV0FSUkFOVFkgT0YgQU5ZIEtJTkQsIEVYUFJFU1MgT1JcbklNUExJRUQsIElOQ0xVRElORyBCVVQgTk9UIExJTUlURUQgVE8gVEhFIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZLFxuRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UgQU5EIE5PTklORlJJTkdFTUVOVC4gSU4gTk8gRVZFTlQgU0hBTEwgVEhFXG5BVVRIT1JTIE9SIENPUFlSSUdIVCBIT0xERVJTIEJFIExJQUJMRSBGT1IgQU5ZIENMQUlNLCBEQU1BR0VTIE9SIE9USEVSXG5MSUFCSUxJVFksIFdIRVRIRVIgSU4gQU4gQUNUSU9OIE9GIENPTlRSQUNULCBUT1JUIE9SIE9USEVSV0lTRSwgQVJJU0lORyBGUk9NLFxuT1VUIE9GIE9SIElOIENPTk5FQ1RJT04gV0lUSCBUSEUgU09GVFdBUkUgT1IgVEhFIFVTRSBPUiBPVEhFUiBERUFMSU5HUyBJTlxuVEhFIFNPRlRXQVJFLiAqL1xuXG52YXIgZ2xNYXRyaXggPSByZXF1aXJlKFwiLi9jb21tb24uanNcIik7XG52YXIgbWF0MyA9IHJlcXVpcmUoXCIuL21hdDMuanNcIik7XG52YXIgdmVjMyA9IHJlcXVpcmUoXCIuL3ZlYzMuanNcIik7XG52YXIgdmVjNCA9IHJlcXVpcmUoXCIuL3ZlYzQuanNcIik7XG5cbi8qKlxuICogQGNsYXNzIFF1YXRlcm5pb25cbiAqIEBuYW1lIHF1YXRcbiAqL1xudmFyIHF1YXQgPSB7fTtcblxuLyoqXG4gKiBDcmVhdGVzIGEgbmV3IGlkZW50aXR5IHF1YXRcbiAqXG4gKiBAcmV0dXJucyB7cXVhdH0gYSBuZXcgcXVhdGVybmlvblxuICovXG5xdWF0LmNyZWF0ZSA9IGZ1bmN0aW9uKCkge1xuICAgIHZhciBvdXQgPSBuZXcgZ2xNYXRyaXguQVJSQVlfVFlQRSg0KTtcbiAgICBvdXRbMF0gPSAwO1xuICAgIG91dFsxXSA9IDA7XG4gICAgb3V0WzJdID0gMDtcbiAgICBvdXRbM10gPSAxO1xuICAgIHJldHVybiBvdXQ7XG59O1xuXG4vKipcbiAqIFNldHMgYSBxdWF0ZXJuaW9uIHRvIHJlcHJlc2VudCB0aGUgc2hvcnRlc3Qgcm90YXRpb24gZnJvbSBvbmVcbiAqIHZlY3RvciB0byBhbm90aGVyLlxuICpcbiAqIEJvdGggdmVjdG9ycyBhcmUgYXNzdW1lZCB0byBiZSB1bml0IGxlbmd0aC5cbiAqXG4gKiBAcGFyYW0ge3F1YXR9IG91dCB0aGUgcmVjZWl2aW5nIHF1YXRlcm5pb24uXG4gKiBAcGFyYW0ge3ZlYzN9IGEgdGhlIGluaXRpYWwgdmVjdG9yXG4gKiBAcGFyYW0ge3ZlYzN9IGIgdGhlIGRlc3RpbmF0aW9uIHZlY3RvclxuICogQHJldHVybnMge3F1YXR9IG91dFxuICovXG5xdWF0LnJvdGF0aW9uVG8gPSAoZnVuY3Rpb24oKSB7XG4gICAgdmFyIHRtcHZlYzMgPSB2ZWMzLmNyZWF0ZSgpO1xuICAgIHZhciB4VW5pdFZlYzMgPSB2ZWMzLmZyb21WYWx1ZXMoMSwwLDApO1xuICAgIHZhciB5VW5pdFZlYzMgPSB2ZWMzLmZyb21WYWx1ZXMoMCwxLDApO1xuXG4gICAgcmV0dXJuIGZ1bmN0aW9uKG91dCwgYSwgYikge1xuICAgICAgICB2YXIgZG90ID0gdmVjMy5kb3QoYSwgYik7XG4gICAgICAgIGlmIChkb3QgPCAtMC45OTk5OTkpIHtcbiAgICAgICAgICAgIHZlYzMuY3Jvc3ModG1wdmVjMywgeFVuaXRWZWMzLCBhKTtcbiAgICAgICAgICAgIGlmICh2ZWMzLmxlbmd0aCh0bXB2ZWMzKSA8IDAuMDAwMDAxKVxuICAgICAgICAgICAgICAgIHZlYzMuY3Jvc3ModG1wdmVjMywgeVVuaXRWZWMzLCBhKTtcbiAgICAgICAgICAgIHZlYzMubm9ybWFsaXplKHRtcHZlYzMsIHRtcHZlYzMpO1xuICAgICAgICAgICAgcXVhdC5zZXRBeGlzQW5nbGUob3V0LCB0bXB2ZWMzLCBNYXRoLlBJKTtcbiAgICAgICAgICAgIHJldHVybiBvdXQ7XG4gICAgICAgIH0gZWxzZSBpZiAoZG90ID4gMC45OTk5OTkpIHtcbiAgICAgICAgICAgIG91dFswXSA9IDA7XG4gICAgICAgICAgICBvdXRbMV0gPSAwO1xuICAgICAgICAgICAgb3V0WzJdID0gMDtcbiAgICAgICAgICAgIG91dFszXSA9IDE7XG4gICAgICAgICAgICByZXR1cm4gb3V0O1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdmVjMy5jcm9zcyh0bXB2ZWMzLCBhLCBiKTtcbiAgICAgICAgICAgIG91dFswXSA9IHRtcHZlYzNbMF07XG4gICAgICAgICAgICBvdXRbMV0gPSB0bXB2ZWMzWzFdO1xuICAgICAgICAgICAgb3V0WzJdID0gdG1wdmVjM1syXTtcbiAgICAgICAgICAgIG91dFszXSA9IDEgKyBkb3Q7XG4gICAgICAgICAgICByZXR1cm4gcXVhdC5ub3JtYWxpemUob3V0LCBvdXQpO1xuICAgICAgICB9XG4gICAgfTtcbn0pKCk7XG5cbi8qKlxuICogU2V0cyB0aGUgc3BlY2lmaWVkIHF1YXRlcm5pb24gd2l0aCB2YWx1ZXMgY29ycmVzcG9uZGluZyB0byB0aGUgZ2l2ZW5cbiAqIGF4ZXMuIEVhY2ggYXhpcyBpcyBhIHZlYzMgYW5kIGlzIGV4cGVjdGVkIHRvIGJlIHVuaXQgbGVuZ3RoIGFuZFxuICogcGVycGVuZGljdWxhciB0byBhbGwgb3RoZXIgc3BlY2lmaWVkIGF4ZXMuXG4gKlxuICogQHBhcmFtIHt2ZWMzfSB2aWV3ICB0aGUgdmVjdG9yIHJlcHJlc2VudGluZyB0aGUgdmlld2luZyBkaXJlY3Rpb25cbiAqIEBwYXJhbSB7dmVjM30gcmlnaHQgdGhlIHZlY3RvciByZXByZXNlbnRpbmcgdGhlIGxvY2FsIFwicmlnaHRcIiBkaXJlY3Rpb25cbiAqIEBwYXJhbSB7dmVjM30gdXAgICAgdGhlIHZlY3RvciByZXByZXNlbnRpbmcgdGhlIGxvY2FsIFwidXBcIiBkaXJlY3Rpb25cbiAqIEByZXR1cm5zIHtxdWF0fSBvdXRcbiAqL1xucXVhdC5zZXRBeGVzID0gKGZ1bmN0aW9uKCkge1xuICAgIHZhciBtYXRyID0gbWF0My5jcmVhdGUoKTtcblxuICAgIHJldHVybiBmdW5jdGlvbihvdXQsIHZpZXcsIHJpZ2h0LCB1cCkge1xuICAgICAgICBtYXRyWzBdID0gcmlnaHRbMF07XG4gICAgICAgIG1hdHJbM10gPSByaWdodFsxXTtcbiAgICAgICAgbWF0cls2XSA9IHJpZ2h0WzJdO1xuXG4gICAgICAgIG1hdHJbMV0gPSB1cFswXTtcbiAgICAgICAgbWF0cls0XSA9IHVwWzFdO1xuICAgICAgICBtYXRyWzddID0gdXBbMl07XG5cbiAgICAgICAgbWF0clsyXSA9IC12aWV3WzBdO1xuICAgICAgICBtYXRyWzVdID0gLXZpZXdbMV07XG4gICAgICAgIG1hdHJbOF0gPSAtdmlld1syXTtcblxuICAgICAgICByZXR1cm4gcXVhdC5ub3JtYWxpemUob3V0LCBxdWF0LmZyb21NYXQzKG91dCwgbWF0cikpO1xuICAgIH07XG59KSgpO1xuXG4vKipcbiAqIENyZWF0ZXMgYSBuZXcgcXVhdCBpbml0aWFsaXplZCB3aXRoIHZhbHVlcyBmcm9tIGFuIGV4aXN0aW5nIHF1YXRlcm5pb25cbiAqXG4gKiBAcGFyYW0ge3F1YXR9IGEgcXVhdGVybmlvbiB0byBjbG9uZVxuICogQHJldHVybnMge3F1YXR9IGEgbmV3IHF1YXRlcm5pb25cbiAqIEBmdW5jdGlvblxuICovXG5xdWF0LmNsb25lID0gdmVjNC5jbG9uZTtcblxuLyoqXG4gKiBDcmVhdGVzIGEgbmV3IHF1YXQgaW5pdGlhbGl6ZWQgd2l0aCB0aGUgZ2l2ZW4gdmFsdWVzXG4gKlxuICogQHBhcmFtIHtOdW1iZXJ9IHggWCBjb21wb25lbnRcbiAqIEBwYXJhbSB7TnVtYmVyfSB5IFkgY29tcG9uZW50XG4gKiBAcGFyYW0ge051bWJlcn0geiBaIGNvbXBvbmVudFxuICogQHBhcmFtIHtOdW1iZXJ9IHcgVyBjb21wb25lbnRcbiAqIEByZXR1cm5zIHtxdWF0fSBhIG5ldyBxdWF0ZXJuaW9uXG4gKiBAZnVuY3Rpb25cbiAqL1xucXVhdC5mcm9tVmFsdWVzID0gdmVjNC5mcm9tVmFsdWVzO1xuXG4vKipcbiAqIENvcHkgdGhlIHZhbHVlcyBmcm9tIG9uZSBxdWF0IHRvIGFub3RoZXJcbiAqXG4gKiBAcGFyYW0ge3F1YXR9IG91dCB0aGUgcmVjZWl2aW5nIHF1YXRlcm5pb25cbiAqIEBwYXJhbSB7cXVhdH0gYSB0aGUgc291cmNlIHF1YXRlcm5pb25cbiAqIEByZXR1cm5zIHtxdWF0fSBvdXRcbiAqIEBmdW5jdGlvblxuICovXG5xdWF0LmNvcHkgPSB2ZWM0LmNvcHk7XG5cbi8qKlxuICogU2V0IHRoZSBjb21wb25lbnRzIG9mIGEgcXVhdCB0byB0aGUgZ2l2ZW4gdmFsdWVzXG4gKlxuICogQHBhcmFtIHtxdWF0fSBvdXQgdGhlIHJlY2VpdmluZyBxdWF0ZXJuaW9uXG4gKiBAcGFyYW0ge051bWJlcn0geCBYIGNvbXBvbmVudFxuICogQHBhcmFtIHtOdW1iZXJ9IHkgWSBjb21wb25lbnRcbiAqIEBwYXJhbSB7TnVtYmVyfSB6IFogY29tcG9uZW50XG4gKiBAcGFyYW0ge051bWJlcn0gdyBXIGNvbXBvbmVudFxuICogQHJldHVybnMge3F1YXR9IG91dFxuICogQGZ1bmN0aW9uXG4gKi9cbnF1YXQuc2V0ID0gdmVjNC5zZXQ7XG5cbi8qKlxuICogU2V0IGEgcXVhdCB0byB0aGUgaWRlbnRpdHkgcXVhdGVybmlvblxuICpcbiAqIEBwYXJhbSB7cXVhdH0gb3V0IHRoZSByZWNlaXZpbmcgcXVhdGVybmlvblxuICogQHJldHVybnMge3F1YXR9IG91dFxuICovXG5xdWF0LmlkZW50aXR5ID0gZnVuY3Rpb24ob3V0KSB7XG4gICAgb3V0WzBdID0gMDtcbiAgICBvdXRbMV0gPSAwO1xuICAgIG91dFsyXSA9IDA7XG4gICAgb3V0WzNdID0gMTtcbiAgICByZXR1cm4gb3V0O1xufTtcblxuLyoqXG4gKiBTZXRzIGEgcXVhdCBmcm9tIHRoZSBnaXZlbiBhbmdsZSBhbmQgcm90YXRpb24gYXhpcyxcbiAqIHRoZW4gcmV0dXJucyBpdC5cbiAqXG4gKiBAcGFyYW0ge3F1YXR9IG91dCB0aGUgcmVjZWl2aW5nIHF1YXRlcm5pb25cbiAqIEBwYXJhbSB7dmVjM30gYXhpcyB0aGUgYXhpcyBhcm91bmQgd2hpY2ggdG8gcm90YXRlXG4gKiBAcGFyYW0ge051bWJlcn0gcmFkIHRoZSBhbmdsZSBpbiByYWRpYW5zXG4gKiBAcmV0dXJucyB7cXVhdH0gb3V0XG4gKiovXG5xdWF0LnNldEF4aXNBbmdsZSA9IGZ1bmN0aW9uKG91dCwgYXhpcywgcmFkKSB7XG4gICAgcmFkID0gcmFkICogMC41O1xuICAgIHZhciBzID0gTWF0aC5zaW4ocmFkKTtcbiAgICBvdXRbMF0gPSBzICogYXhpc1swXTtcbiAgICBvdXRbMV0gPSBzICogYXhpc1sxXTtcbiAgICBvdXRbMl0gPSBzICogYXhpc1syXTtcbiAgICBvdXRbM10gPSBNYXRoLmNvcyhyYWQpO1xuICAgIHJldHVybiBvdXQ7XG59O1xuXG4vKipcbiAqIEdldHMgdGhlIHJvdGF0aW9uIGF4aXMgYW5kIGFuZ2xlIGZvciBhIGdpdmVuXG4gKiAgcXVhdGVybmlvbi4gSWYgYSBxdWF0ZXJuaW9uIGlzIGNyZWF0ZWQgd2l0aFxuICogIHNldEF4aXNBbmdsZSwgdGhpcyBtZXRob2Qgd2lsbCByZXR1cm4gdGhlIHNhbWVcbiAqICB2YWx1ZXMgYXMgcHJvdmlkaWVkIGluIHRoZSBvcmlnaW5hbCBwYXJhbWV0ZXIgbGlzdFxuICogIE9SIGZ1bmN0aW9uYWxseSBlcXVpdmFsZW50IHZhbHVlcy5cbiAqIEV4YW1wbGU6IFRoZSBxdWF0ZXJuaW9uIGZvcm1lZCBieSBheGlzIFswLCAwLCAxXSBhbmRcbiAqICBhbmdsZSAtOTAgaXMgdGhlIHNhbWUgYXMgdGhlIHF1YXRlcm5pb24gZm9ybWVkIGJ5XG4gKiAgWzAsIDAsIDFdIGFuZCAyNzAuIFRoaXMgbWV0aG9kIGZhdm9ycyB0aGUgbGF0dGVyLlxuICogQHBhcmFtICB7dmVjM30gb3V0X2F4aXMgIFZlY3RvciByZWNlaXZpbmcgdGhlIGF4aXMgb2Ygcm90YXRpb25cbiAqIEBwYXJhbSAge3F1YXR9IHEgICAgIFF1YXRlcm5pb24gdG8gYmUgZGVjb21wb3NlZFxuICogQHJldHVybiB7TnVtYmVyfSAgICAgQW5nbGUsIGluIHJhZGlhbnMsIG9mIHRoZSByb3RhdGlvblxuICovXG5xdWF0LmdldEF4aXNBbmdsZSA9IGZ1bmN0aW9uKG91dF9heGlzLCBxKSB7XG4gICAgdmFyIHJhZCA9IE1hdGguYWNvcyhxWzNdKSAqIDIuMDtcbiAgICB2YXIgcyA9IE1hdGguc2luKHJhZCAvIDIuMCk7XG4gICAgaWYgKHMgIT0gMC4wKSB7XG4gICAgICAgIG91dF9heGlzWzBdID0gcVswXSAvIHM7XG4gICAgICAgIG91dF9heGlzWzFdID0gcVsxXSAvIHM7XG4gICAgICAgIG91dF9heGlzWzJdID0gcVsyXSAvIHM7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgLy8gSWYgcyBpcyB6ZXJvLCByZXR1cm4gYW55IGF4aXMgKG5vIHJvdGF0aW9uIC0gYXhpcyBkb2VzIG5vdCBtYXR0ZXIpXG4gICAgICAgIG91dF9heGlzWzBdID0gMTtcbiAgICAgICAgb3V0X2F4aXNbMV0gPSAwO1xuICAgICAgICBvdXRfYXhpc1syXSA9IDA7XG4gICAgfVxuICAgIHJldHVybiByYWQ7XG59O1xuXG4vKipcbiAqIEFkZHMgdHdvIHF1YXQnc1xuICpcbiAqIEBwYXJhbSB7cXVhdH0gb3V0IHRoZSByZWNlaXZpbmcgcXVhdGVybmlvblxuICogQHBhcmFtIHtxdWF0fSBhIHRoZSBmaXJzdCBvcGVyYW5kXG4gKiBAcGFyYW0ge3F1YXR9IGIgdGhlIHNlY29uZCBvcGVyYW5kXG4gKiBAcmV0dXJucyB7cXVhdH0gb3V0XG4gKiBAZnVuY3Rpb25cbiAqL1xucXVhdC5hZGQgPSB2ZWM0LmFkZDtcblxuLyoqXG4gKiBNdWx0aXBsaWVzIHR3byBxdWF0J3NcbiAqXG4gKiBAcGFyYW0ge3F1YXR9IG91dCB0aGUgcmVjZWl2aW5nIHF1YXRlcm5pb25cbiAqIEBwYXJhbSB7cXVhdH0gYSB0aGUgZmlyc3Qgb3BlcmFuZFxuICogQHBhcmFtIHtxdWF0fSBiIHRoZSBzZWNvbmQgb3BlcmFuZFxuICogQHJldHVybnMge3F1YXR9IG91dFxuICovXG5xdWF0Lm11bHRpcGx5ID0gZnVuY3Rpb24ob3V0LCBhLCBiKSB7XG4gICAgdmFyIGF4ID0gYVswXSwgYXkgPSBhWzFdLCBheiA9IGFbMl0sIGF3ID0gYVszXSxcbiAgICAgICAgYnggPSBiWzBdLCBieSA9IGJbMV0sIGJ6ID0gYlsyXSwgYncgPSBiWzNdO1xuXG4gICAgb3V0WzBdID0gYXggKiBidyArIGF3ICogYnggKyBheSAqIGJ6IC0gYXogKiBieTtcbiAgICBvdXRbMV0gPSBheSAqIGJ3ICsgYXcgKiBieSArIGF6ICogYnggLSBheCAqIGJ6O1xuICAgIG91dFsyXSA9IGF6ICogYncgKyBhdyAqIGJ6ICsgYXggKiBieSAtIGF5ICogYng7XG4gICAgb3V0WzNdID0gYXcgKiBidyAtIGF4ICogYnggLSBheSAqIGJ5IC0gYXogKiBiejtcbiAgICByZXR1cm4gb3V0O1xufTtcblxuLyoqXG4gKiBBbGlhcyBmb3Ige0BsaW5rIHF1YXQubXVsdGlwbHl9XG4gKiBAZnVuY3Rpb25cbiAqL1xucXVhdC5tdWwgPSBxdWF0Lm11bHRpcGx5O1xuXG4vKipcbiAqIFNjYWxlcyBhIHF1YXQgYnkgYSBzY2FsYXIgbnVtYmVyXG4gKlxuICogQHBhcmFtIHtxdWF0fSBvdXQgdGhlIHJlY2VpdmluZyB2ZWN0b3JcbiAqIEBwYXJhbSB7cXVhdH0gYSB0aGUgdmVjdG9yIHRvIHNjYWxlXG4gKiBAcGFyYW0ge051bWJlcn0gYiBhbW91bnQgdG8gc2NhbGUgdGhlIHZlY3RvciBieVxuICogQHJldHVybnMge3F1YXR9IG91dFxuICogQGZ1bmN0aW9uXG4gKi9cbnF1YXQuc2NhbGUgPSB2ZWM0LnNjYWxlO1xuXG4vKipcbiAqIFJvdGF0ZXMgYSBxdWF0ZXJuaW9uIGJ5IHRoZSBnaXZlbiBhbmdsZSBhYm91dCB0aGUgWCBheGlzXG4gKlxuICogQHBhcmFtIHtxdWF0fSBvdXQgcXVhdCByZWNlaXZpbmcgb3BlcmF0aW9uIHJlc3VsdFxuICogQHBhcmFtIHtxdWF0fSBhIHF1YXQgdG8gcm90YXRlXG4gKiBAcGFyYW0ge251bWJlcn0gcmFkIGFuZ2xlIChpbiByYWRpYW5zKSB0byByb3RhdGVcbiAqIEByZXR1cm5zIHtxdWF0fSBvdXRcbiAqL1xucXVhdC5yb3RhdGVYID0gZnVuY3Rpb24gKG91dCwgYSwgcmFkKSB7XG4gICAgcmFkICo9IDAuNTsgXG5cbiAgICB2YXIgYXggPSBhWzBdLCBheSA9IGFbMV0sIGF6ID0gYVsyXSwgYXcgPSBhWzNdLFxuICAgICAgICBieCA9IE1hdGguc2luKHJhZCksIGJ3ID0gTWF0aC5jb3MocmFkKTtcblxuICAgIG91dFswXSA9IGF4ICogYncgKyBhdyAqIGJ4O1xuICAgIG91dFsxXSA9IGF5ICogYncgKyBheiAqIGJ4O1xuICAgIG91dFsyXSA9IGF6ICogYncgLSBheSAqIGJ4O1xuICAgIG91dFszXSA9IGF3ICogYncgLSBheCAqIGJ4O1xuICAgIHJldHVybiBvdXQ7XG59O1xuXG4vKipcbiAqIFJvdGF0ZXMgYSBxdWF0ZXJuaW9uIGJ5IHRoZSBnaXZlbiBhbmdsZSBhYm91dCB0aGUgWSBheGlzXG4gKlxuICogQHBhcmFtIHtxdWF0fSBvdXQgcXVhdCByZWNlaXZpbmcgb3BlcmF0aW9uIHJlc3VsdFxuICogQHBhcmFtIHtxdWF0fSBhIHF1YXQgdG8gcm90YXRlXG4gKiBAcGFyYW0ge251bWJlcn0gcmFkIGFuZ2xlIChpbiByYWRpYW5zKSB0byByb3RhdGVcbiAqIEByZXR1cm5zIHtxdWF0fSBvdXRcbiAqL1xucXVhdC5yb3RhdGVZID0gZnVuY3Rpb24gKG91dCwgYSwgcmFkKSB7XG4gICAgcmFkICo9IDAuNTsgXG5cbiAgICB2YXIgYXggPSBhWzBdLCBheSA9IGFbMV0sIGF6ID0gYVsyXSwgYXcgPSBhWzNdLFxuICAgICAgICBieSA9IE1hdGguc2luKHJhZCksIGJ3ID0gTWF0aC5jb3MocmFkKTtcblxuICAgIG91dFswXSA9IGF4ICogYncgLSBheiAqIGJ5O1xuICAgIG91dFsxXSA9IGF5ICogYncgKyBhdyAqIGJ5O1xuICAgIG91dFsyXSA9IGF6ICogYncgKyBheCAqIGJ5O1xuICAgIG91dFszXSA9IGF3ICogYncgLSBheSAqIGJ5O1xuICAgIHJldHVybiBvdXQ7XG59O1xuXG4vKipcbiAqIFJvdGF0ZXMgYSBxdWF0ZXJuaW9uIGJ5IHRoZSBnaXZlbiBhbmdsZSBhYm91dCB0aGUgWiBheGlzXG4gKlxuICogQHBhcmFtIHtxdWF0fSBvdXQgcXVhdCByZWNlaXZpbmcgb3BlcmF0aW9uIHJlc3VsdFxuICogQHBhcmFtIHtxdWF0fSBhIHF1YXQgdG8gcm90YXRlXG4gKiBAcGFyYW0ge251bWJlcn0gcmFkIGFuZ2xlIChpbiByYWRpYW5zKSB0byByb3RhdGVcbiAqIEByZXR1cm5zIHtxdWF0fSBvdXRcbiAqL1xucXVhdC5yb3RhdGVaID0gZnVuY3Rpb24gKG91dCwgYSwgcmFkKSB7XG4gICAgcmFkICo9IDAuNTsgXG5cbiAgICB2YXIgYXggPSBhWzBdLCBheSA9IGFbMV0sIGF6ID0gYVsyXSwgYXcgPSBhWzNdLFxuICAgICAgICBieiA9IE1hdGguc2luKHJhZCksIGJ3ID0gTWF0aC5jb3MocmFkKTtcblxuICAgIG91dFswXSA9IGF4ICogYncgKyBheSAqIGJ6O1xuICAgIG91dFsxXSA9IGF5ICogYncgLSBheCAqIGJ6O1xuICAgIG91dFsyXSA9IGF6ICogYncgKyBhdyAqIGJ6O1xuICAgIG91dFszXSA9IGF3ICogYncgLSBheiAqIGJ6O1xuICAgIHJldHVybiBvdXQ7XG59O1xuXG4vKipcbiAqIENhbGN1bGF0ZXMgdGhlIFcgY29tcG9uZW50IG9mIGEgcXVhdCBmcm9tIHRoZSBYLCBZLCBhbmQgWiBjb21wb25lbnRzLlxuICogQXNzdW1lcyB0aGF0IHF1YXRlcm5pb24gaXMgMSB1bml0IGluIGxlbmd0aC5cbiAqIEFueSBleGlzdGluZyBXIGNvbXBvbmVudCB3aWxsIGJlIGlnbm9yZWQuXG4gKlxuICogQHBhcmFtIHtxdWF0fSBvdXQgdGhlIHJlY2VpdmluZyBxdWF0ZXJuaW9uXG4gKiBAcGFyYW0ge3F1YXR9IGEgcXVhdCB0byBjYWxjdWxhdGUgVyBjb21wb25lbnQgb2ZcbiAqIEByZXR1cm5zIHtxdWF0fSBvdXRcbiAqL1xucXVhdC5jYWxjdWxhdGVXID0gZnVuY3Rpb24gKG91dCwgYSkge1xuICAgIHZhciB4ID0gYVswXSwgeSA9IGFbMV0sIHogPSBhWzJdO1xuXG4gICAgb3V0WzBdID0geDtcbiAgICBvdXRbMV0gPSB5O1xuICAgIG91dFsyXSA9IHo7XG4gICAgb3V0WzNdID0gTWF0aC5zcXJ0KE1hdGguYWJzKDEuMCAtIHggKiB4IC0geSAqIHkgLSB6ICogeikpO1xuICAgIHJldHVybiBvdXQ7XG59O1xuXG4vKipcbiAqIENhbGN1bGF0ZXMgdGhlIGRvdCBwcm9kdWN0IG9mIHR3byBxdWF0J3NcbiAqXG4gKiBAcGFyYW0ge3F1YXR9IGEgdGhlIGZpcnN0IG9wZXJhbmRcbiAqIEBwYXJhbSB7cXVhdH0gYiB0aGUgc2Vjb25kIG9wZXJhbmRcbiAqIEByZXR1cm5zIHtOdW1iZXJ9IGRvdCBwcm9kdWN0IG9mIGEgYW5kIGJcbiAqIEBmdW5jdGlvblxuICovXG5xdWF0LmRvdCA9IHZlYzQuZG90O1xuXG4vKipcbiAqIFBlcmZvcm1zIGEgbGluZWFyIGludGVycG9sYXRpb24gYmV0d2VlbiB0d28gcXVhdCdzXG4gKlxuICogQHBhcmFtIHtxdWF0fSBvdXQgdGhlIHJlY2VpdmluZyBxdWF0ZXJuaW9uXG4gKiBAcGFyYW0ge3F1YXR9IGEgdGhlIGZpcnN0IG9wZXJhbmRcbiAqIEBwYXJhbSB7cXVhdH0gYiB0aGUgc2Vjb25kIG9wZXJhbmRcbiAqIEBwYXJhbSB7TnVtYmVyfSB0IGludGVycG9sYXRpb24gYW1vdW50IGJldHdlZW4gdGhlIHR3byBpbnB1dHNcbiAqIEByZXR1cm5zIHtxdWF0fSBvdXRcbiAqIEBmdW5jdGlvblxuICovXG5xdWF0LmxlcnAgPSB2ZWM0LmxlcnA7XG5cbi8qKlxuICogUGVyZm9ybXMgYSBzcGhlcmljYWwgbGluZWFyIGludGVycG9sYXRpb24gYmV0d2VlbiB0d28gcXVhdFxuICpcbiAqIEBwYXJhbSB7cXVhdH0gb3V0IHRoZSByZWNlaXZpbmcgcXVhdGVybmlvblxuICogQHBhcmFtIHtxdWF0fSBhIHRoZSBmaXJzdCBvcGVyYW5kXG4gKiBAcGFyYW0ge3F1YXR9IGIgdGhlIHNlY29uZCBvcGVyYW5kXG4gKiBAcGFyYW0ge051bWJlcn0gdCBpbnRlcnBvbGF0aW9uIGFtb3VudCBiZXR3ZWVuIHRoZSB0d28gaW5wdXRzXG4gKiBAcmV0dXJucyB7cXVhdH0gb3V0XG4gKi9cbnF1YXQuc2xlcnAgPSBmdW5jdGlvbiAob3V0LCBhLCBiLCB0KSB7XG4gICAgLy8gYmVuY2htYXJrczpcbiAgICAvLyAgICBodHRwOi8vanNwZXJmLmNvbS9xdWF0ZXJuaW9uLXNsZXJwLWltcGxlbWVudGF0aW9uc1xuXG4gICAgdmFyIGF4ID0gYVswXSwgYXkgPSBhWzFdLCBheiA9IGFbMl0sIGF3ID0gYVszXSxcbiAgICAgICAgYnggPSBiWzBdLCBieSA9IGJbMV0sIGJ6ID0gYlsyXSwgYncgPSBiWzNdO1xuXG4gICAgdmFyICAgICAgICBvbWVnYSwgY29zb20sIHNpbm9tLCBzY2FsZTAsIHNjYWxlMTtcblxuICAgIC8vIGNhbGMgY29zaW5lXG4gICAgY29zb20gPSBheCAqIGJ4ICsgYXkgKiBieSArIGF6ICogYnogKyBhdyAqIGJ3O1xuICAgIC8vIGFkanVzdCBzaWducyAoaWYgbmVjZXNzYXJ5KVxuICAgIGlmICggY29zb20gPCAwLjAgKSB7XG4gICAgICAgIGNvc29tID0gLWNvc29tO1xuICAgICAgICBieCA9IC0gYng7XG4gICAgICAgIGJ5ID0gLSBieTtcbiAgICAgICAgYnogPSAtIGJ6O1xuICAgICAgICBidyA9IC0gYnc7XG4gICAgfVxuICAgIC8vIGNhbGN1bGF0ZSBjb2VmZmljaWVudHNcbiAgICBpZiAoICgxLjAgLSBjb3NvbSkgPiAwLjAwMDAwMSApIHtcbiAgICAgICAgLy8gc3RhbmRhcmQgY2FzZSAoc2xlcnApXG4gICAgICAgIG9tZWdhICA9IE1hdGguYWNvcyhjb3NvbSk7XG4gICAgICAgIHNpbm9tICA9IE1hdGguc2luKG9tZWdhKTtcbiAgICAgICAgc2NhbGUwID0gTWF0aC5zaW4oKDEuMCAtIHQpICogb21lZ2EpIC8gc2lub207XG4gICAgICAgIHNjYWxlMSA9IE1hdGguc2luKHQgKiBvbWVnYSkgLyBzaW5vbTtcbiAgICB9IGVsc2UgeyAgICAgICAgXG4gICAgICAgIC8vIFwiZnJvbVwiIGFuZCBcInRvXCIgcXVhdGVybmlvbnMgYXJlIHZlcnkgY2xvc2UgXG4gICAgICAgIC8vICAuLi4gc28gd2UgY2FuIGRvIGEgbGluZWFyIGludGVycG9sYXRpb25cbiAgICAgICAgc2NhbGUwID0gMS4wIC0gdDtcbiAgICAgICAgc2NhbGUxID0gdDtcbiAgICB9XG4gICAgLy8gY2FsY3VsYXRlIGZpbmFsIHZhbHVlc1xuICAgIG91dFswXSA9IHNjYWxlMCAqIGF4ICsgc2NhbGUxICogYng7XG4gICAgb3V0WzFdID0gc2NhbGUwICogYXkgKyBzY2FsZTEgKiBieTtcbiAgICBvdXRbMl0gPSBzY2FsZTAgKiBheiArIHNjYWxlMSAqIGJ6O1xuICAgIG91dFszXSA9IHNjYWxlMCAqIGF3ICsgc2NhbGUxICogYnc7XG4gICAgXG4gICAgcmV0dXJuIG91dDtcbn07XG5cbi8qKlxuICogUGVyZm9ybXMgYSBzcGhlcmljYWwgbGluZWFyIGludGVycG9sYXRpb24gd2l0aCB0d28gY29udHJvbCBwb2ludHNcbiAqXG4gKiBAcGFyYW0ge3F1YXR9IG91dCB0aGUgcmVjZWl2aW5nIHF1YXRlcm5pb25cbiAqIEBwYXJhbSB7cXVhdH0gYSB0aGUgZmlyc3Qgb3BlcmFuZFxuICogQHBhcmFtIHtxdWF0fSBiIHRoZSBzZWNvbmQgb3BlcmFuZFxuICogQHBhcmFtIHtxdWF0fSBjIHRoZSB0aGlyZCBvcGVyYW5kXG4gKiBAcGFyYW0ge3F1YXR9IGQgdGhlIGZvdXJ0aCBvcGVyYW5kXG4gKiBAcGFyYW0ge051bWJlcn0gdCBpbnRlcnBvbGF0aW9uIGFtb3VudFxuICogQHJldHVybnMge3F1YXR9IG91dFxuICovXG5xdWF0LnNxbGVycCA9IChmdW5jdGlvbiAoKSB7XG4gIHZhciB0ZW1wMSA9IHF1YXQuY3JlYXRlKCk7XG4gIHZhciB0ZW1wMiA9IHF1YXQuY3JlYXRlKCk7XG4gIFxuICByZXR1cm4gZnVuY3Rpb24gKG91dCwgYSwgYiwgYywgZCwgdCkge1xuICAgIHF1YXQuc2xlcnAodGVtcDEsIGEsIGQsIHQpO1xuICAgIHF1YXQuc2xlcnAodGVtcDIsIGIsIGMsIHQpO1xuICAgIHF1YXQuc2xlcnAob3V0LCB0ZW1wMSwgdGVtcDIsIDIgKiB0ICogKDEgLSB0KSk7XG4gICAgXG4gICAgcmV0dXJuIG91dDtcbiAgfTtcbn0oKSk7XG5cbi8qKlxuICogQ2FsY3VsYXRlcyB0aGUgaW52ZXJzZSBvZiBhIHF1YXRcbiAqXG4gKiBAcGFyYW0ge3F1YXR9IG91dCB0aGUgcmVjZWl2aW5nIHF1YXRlcm5pb25cbiAqIEBwYXJhbSB7cXVhdH0gYSBxdWF0IHRvIGNhbGN1bGF0ZSBpbnZlcnNlIG9mXG4gKiBAcmV0dXJucyB7cXVhdH0gb3V0XG4gKi9cbnF1YXQuaW52ZXJ0ID0gZnVuY3Rpb24ob3V0LCBhKSB7XG4gICAgdmFyIGEwID0gYVswXSwgYTEgPSBhWzFdLCBhMiA9IGFbMl0sIGEzID0gYVszXSxcbiAgICAgICAgZG90ID0gYTAqYTAgKyBhMSphMSArIGEyKmEyICsgYTMqYTMsXG4gICAgICAgIGludkRvdCA9IGRvdCA/IDEuMC9kb3QgOiAwO1xuICAgIFxuICAgIC8vIFRPRE86IFdvdWxkIGJlIGZhc3RlciB0byByZXR1cm4gWzAsMCwwLDBdIGltbWVkaWF0ZWx5IGlmIGRvdCA9PSAwXG5cbiAgICBvdXRbMF0gPSAtYTAqaW52RG90O1xuICAgIG91dFsxXSA9IC1hMSppbnZEb3Q7XG4gICAgb3V0WzJdID0gLWEyKmludkRvdDtcbiAgICBvdXRbM10gPSBhMyppbnZEb3Q7XG4gICAgcmV0dXJuIG91dDtcbn07XG5cbi8qKlxuICogQ2FsY3VsYXRlcyB0aGUgY29uanVnYXRlIG9mIGEgcXVhdFxuICogSWYgdGhlIHF1YXRlcm5pb24gaXMgbm9ybWFsaXplZCwgdGhpcyBmdW5jdGlvbiBpcyBmYXN0ZXIgdGhhbiBxdWF0LmludmVyc2UgYW5kIHByb2R1Y2VzIHRoZSBzYW1lIHJlc3VsdC5cbiAqXG4gKiBAcGFyYW0ge3F1YXR9IG91dCB0aGUgcmVjZWl2aW5nIHF1YXRlcm5pb25cbiAqIEBwYXJhbSB7cXVhdH0gYSBxdWF0IHRvIGNhbGN1bGF0ZSBjb25qdWdhdGUgb2ZcbiAqIEByZXR1cm5zIHtxdWF0fSBvdXRcbiAqL1xucXVhdC5jb25qdWdhdGUgPSBmdW5jdGlvbiAob3V0LCBhKSB7XG4gICAgb3V0WzBdID0gLWFbMF07XG4gICAgb3V0WzFdID0gLWFbMV07XG4gICAgb3V0WzJdID0gLWFbMl07XG4gICAgb3V0WzNdID0gYVszXTtcbiAgICByZXR1cm4gb3V0O1xufTtcblxuLyoqXG4gKiBDYWxjdWxhdGVzIHRoZSBsZW5ndGggb2YgYSBxdWF0XG4gKlxuICogQHBhcmFtIHtxdWF0fSBhIHZlY3RvciB0byBjYWxjdWxhdGUgbGVuZ3RoIG9mXG4gKiBAcmV0dXJucyB7TnVtYmVyfSBsZW5ndGggb2YgYVxuICogQGZ1bmN0aW9uXG4gKi9cbnF1YXQubGVuZ3RoID0gdmVjNC5sZW5ndGg7XG5cbi8qKlxuICogQWxpYXMgZm9yIHtAbGluayBxdWF0Lmxlbmd0aH1cbiAqIEBmdW5jdGlvblxuICovXG5xdWF0LmxlbiA9IHF1YXQubGVuZ3RoO1xuXG4vKipcbiAqIENhbGN1bGF0ZXMgdGhlIHNxdWFyZWQgbGVuZ3RoIG9mIGEgcXVhdFxuICpcbiAqIEBwYXJhbSB7cXVhdH0gYSB2ZWN0b3IgdG8gY2FsY3VsYXRlIHNxdWFyZWQgbGVuZ3RoIG9mXG4gKiBAcmV0dXJucyB7TnVtYmVyfSBzcXVhcmVkIGxlbmd0aCBvZiBhXG4gKiBAZnVuY3Rpb25cbiAqL1xucXVhdC5zcXVhcmVkTGVuZ3RoID0gdmVjNC5zcXVhcmVkTGVuZ3RoO1xuXG4vKipcbiAqIEFsaWFzIGZvciB7QGxpbmsgcXVhdC5zcXVhcmVkTGVuZ3RofVxuICogQGZ1bmN0aW9uXG4gKi9cbnF1YXQuc3FyTGVuID0gcXVhdC5zcXVhcmVkTGVuZ3RoO1xuXG4vKipcbiAqIE5vcm1hbGl6ZSBhIHF1YXRcbiAqXG4gKiBAcGFyYW0ge3F1YXR9IG91dCB0aGUgcmVjZWl2aW5nIHF1YXRlcm5pb25cbiAqIEBwYXJhbSB7cXVhdH0gYSBxdWF0ZXJuaW9uIHRvIG5vcm1hbGl6ZVxuICogQHJldHVybnMge3F1YXR9IG91dFxuICogQGZ1bmN0aW9uXG4gKi9cbnF1YXQubm9ybWFsaXplID0gdmVjNC5ub3JtYWxpemU7XG5cbi8qKlxuICogQ3JlYXRlcyBhIHF1YXRlcm5pb24gZnJvbSB0aGUgZ2l2ZW4gM3gzIHJvdGF0aW9uIG1hdHJpeC5cbiAqXG4gKiBOT1RFOiBUaGUgcmVzdWx0YW50IHF1YXRlcm5pb24gaXMgbm90IG5vcm1hbGl6ZWQsIHNvIHlvdSBzaG91bGQgYmUgc3VyZVxuICogdG8gcmVub3JtYWxpemUgdGhlIHF1YXRlcm5pb24geW91cnNlbGYgd2hlcmUgbmVjZXNzYXJ5LlxuICpcbiAqIEBwYXJhbSB7cXVhdH0gb3V0IHRoZSByZWNlaXZpbmcgcXVhdGVybmlvblxuICogQHBhcmFtIHttYXQzfSBtIHJvdGF0aW9uIG1hdHJpeFxuICogQHJldHVybnMge3F1YXR9IG91dFxuICogQGZ1bmN0aW9uXG4gKi9cbnF1YXQuZnJvbU1hdDMgPSBmdW5jdGlvbihvdXQsIG0pIHtcbiAgICAvLyBBbGdvcml0aG0gaW4gS2VuIFNob2VtYWtlJ3MgYXJ0aWNsZSBpbiAxOTg3IFNJR0dSQVBIIGNvdXJzZSBub3Rlc1xuICAgIC8vIGFydGljbGUgXCJRdWF0ZXJuaW9uIENhbGN1bHVzIGFuZCBGYXN0IEFuaW1hdGlvblwiLlxuICAgIHZhciBmVHJhY2UgPSBtWzBdICsgbVs0XSArIG1bOF07XG4gICAgdmFyIGZSb290O1xuXG4gICAgaWYgKCBmVHJhY2UgPiAwLjAgKSB7XG4gICAgICAgIC8vIHx3fCA+IDEvMiwgbWF5IGFzIHdlbGwgY2hvb3NlIHcgPiAxLzJcbiAgICAgICAgZlJvb3QgPSBNYXRoLnNxcnQoZlRyYWNlICsgMS4wKTsgIC8vIDJ3XG4gICAgICAgIG91dFszXSA9IDAuNSAqIGZSb290O1xuICAgICAgICBmUm9vdCA9IDAuNS9mUm9vdDsgIC8vIDEvKDR3KVxuICAgICAgICBvdXRbMF0gPSAobVs1XS1tWzddKSpmUm9vdDtcbiAgICAgICAgb3V0WzFdID0gKG1bNl0tbVsyXSkqZlJvb3Q7XG4gICAgICAgIG91dFsyXSA9IChtWzFdLW1bM10pKmZSb290O1xuICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIHx3fCA8PSAxLzJcbiAgICAgICAgdmFyIGkgPSAwO1xuICAgICAgICBpZiAoIG1bNF0gPiBtWzBdIClcbiAgICAgICAgICBpID0gMTtcbiAgICAgICAgaWYgKCBtWzhdID4gbVtpKjMraV0gKVxuICAgICAgICAgIGkgPSAyO1xuICAgICAgICB2YXIgaiA9IChpKzEpJTM7XG4gICAgICAgIHZhciBrID0gKGkrMiklMztcbiAgICAgICAgXG4gICAgICAgIGZSb290ID0gTWF0aC5zcXJ0KG1baSozK2ldLW1baiozK2pdLW1bayozK2tdICsgMS4wKTtcbiAgICAgICAgb3V0W2ldID0gMC41ICogZlJvb3Q7XG4gICAgICAgIGZSb290ID0gMC41IC8gZlJvb3Q7XG4gICAgICAgIG91dFszXSA9IChtW2oqMytrXSAtIG1bayozK2pdKSAqIGZSb290O1xuICAgICAgICBvdXRbal0gPSAobVtqKjMraV0gKyBtW2kqMytqXSkgKiBmUm9vdDtcbiAgICAgICAgb3V0W2tdID0gKG1bayozK2ldICsgbVtpKjMra10pICogZlJvb3Q7XG4gICAgfVxuICAgIFxuICAgIHJldHVybiBvdXQ7XG59O1xuXG4vKipcbiAqIFJldHVybnMgYSBzdHJpbmcgcmVwcmVzZW50YXRpb24gb2YgYSBxdWF0ZW5pb25cbiAqXG4gKiBAcGFyYW0ge3F1YXR9IHZlYyB2ZWN0b3IgdG8gcmVwcmVzZW50IGFzIGEgc3RyaW5nXG4gKiBAcmV0dXJucyB7U3RyaW5nfSBzdHJpbmcgcmVwcmVzZW50YXRpb24gb2YgdGhlIHZlY3RvclxuICovXG5xdWF0LnN0ciA9IGZ1bmN0aW9uIChhKSB7XG4gICAgcmV0dXJuICdxdWF0KCcgKyBhWzBdICsgJywgJyArIGFbMV0gKyAnLCAnICsgYVsyXSArICcsICcgKyBhWzNdICsgJyknO1xufTtcblxuLyoqXG4gKiBSZXR1cm5zIHdoZXRoZXIgb3Igbm90IHRoZSBxdWF0ZXJuaW9ucyBoYXZlIGV4YWN0bHkgdGhlIHNhbWUgZWxlbWVudHMgaW4gdGhlIHNhbWUgcG9zaXRpb24gKHdoZW4gY29tcGFyZWQgd2l0aCA9PT0pXG4gKlxuICogQHBhcmFtIHtxdWF0fSBhIFRoZSBmaXJzdCBxdWF0ZXJuaW9uLlxuICogQHBhcmFtIHtxdWF0fSBiIFRoZSBzZWNvbmQgcXVhdGVybmlvbi5cbiAqIEByZXR1cm5zIHtCb29sZWFufSBUcnVlIGlmIHRoZSB2ZWN0b3JzIGFyZSBlcXVhbCwgZmFsc2Ugb3RoZXJ3aXNlLlxuICovXG5xdWF0LmV4YWN0RXF1YWxzID0gdmVjNC5leGFjdEVxdWFscztcblxuLyoqXG4gKiBSZXR1cm5zIHdoZXRoZXIgb3Igbm90IHRoZSBxdWF0ZXJuaW9ucyBoYXZlIGFwcHJveGltYXRlbHkgdGhlIHNhbWUgZWxlbWVudHMgaW4gdGhlIHNhbWUgcG9zaXRpb24uXG4gKlxuICogQHBhcmFtIHtxdWF0fSBhIFRoZSBmaXJzdCB2ZWN0b3IuXG4gKiBAcGFyYW0ge3F1YXR9IGIgVGhlIHNlY29uZCB2ZWN0b3IuXG4gKiBAcmV0dXJucyB7Qm9vbGVhbn0gVHJ1ZSBpZiB0aGUgdmVjdG9ycyBhcmUgZXF1YWwsIGZhbHNlIG90aGVyd2lzZS5cbiAqL1xucXVhdC5lcXVhbHMgPSB2ZWM0LmVxdWFscztcblxubW9kdWxlLmV4cG9ydHMgPSBxdWF0O1xuIiwiLyogQ29weXJpZ2h0IChjKSAyMDE1LCBCcmFuZG9uIEpvbmVzLCBDb2xpbiBNYWNLZW56aWUgSVYuXG5cblBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmluZyBhIGNvcHlcbm9mIHRoaXMgc29mdHdhcmUgYW5kIGFzc29jaWF0ZWQgZG9jdW1lbnRhdGlvbiBmaWxlcyAodGhlIFwiU29mdHdhcmVcIiksIHRvIGRlYWxcbmluIHRoZSBTb2Z0d2FyZSB3aXRob3V0IHJlc3RyaWN0aW9uLCBpbmNsdWRpbmcgd2l0aG91dCBsaW1pdGF0aW9uIHRoZSByaWdodHNcbnRvIHVzZSwgY29weSwgbW9kaWZ5LCBtZXJnZSwgcHVibGlzaCwgZGlzdHJpYnV0ZSwgc3VibGljZW5zZSwgYW5kL29yIHNlbGxcbmNvcGllcyBvZiB0aGUgU29mdHdhcmUsIGFuZCB0byBwZXJtaXQgcGVyc29ucyB0byB3aG9tIHRoZSBTb2Z0d2FyZSBpc1xuZnVybmlzaGVkIHRvIGRvIHNvLCBzdWJqZWN0IHRvIHRoZSBmb2xsb3dpbmcgY29uZGl0aW9uczpcblxuVGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGVybWlzc2lvbiBub3RpY2Ugc2hhbGwgYmUgaW5jbHVkZWQgaW5cbmFsbCBjb3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9ydGlvbnMgb2YgdGhlIFNvZnR3YXJlLlxuXG5USEUgU09GVFdBUkUgSVMgUFJPVklERUQgXCJBUyBJU1wiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTIE9SXG5JTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSxcbkZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORCBOT05JTkZSSU5HRU1FTlQuIElOIE5PIEVWRU5UIFNIQUxMIFRIRVxuQVVUSE9SUyBPUiBDT1BZUklHSFQgSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUlxuTElBQklMSVRZLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgVE9SVCBPUiBPVEhFUldJU0UsIEFSSVNJTkcgRlJPTSxcbk9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFNPRlRXQVJFIE9SIFRIRSBVU0UgT1IgT1RIRVIgREVBTElOR1MgSU5cblRIRSBTT0ZUV0FSRS4gKi9cblxudmFyIGdsTWF0cml4ID0gcmVxdWlyZShcIi4vY29tbW9uLmpzXCIpO1xuXG4vKipcbiAqIEBjbGFzcyAyIERpbWVuc2lvbmFsIFZlY3RvclxuICogQG5hbWUgdmVjMlxuICovXG52YXIgdmVjMiA9IHt9O1xuXG4vKipcbiAqIENyZWF0ZXMgYSBuZXcsIGVtcHR5IHZlYzJcbiAqXG4gKiBAcmV0dXJucyB7dmVjMn0gYSBuZXcgMkQgdmVjdG9yXG4gKi9cbnZlYzIuY3JlYXRlID0gZnVuY3Rpb24oKSB7XG4gICAgdmFyIG91dCA9IG5ldyBnbE1hdHJpeC5BUlJBWV9UWVBFKDIpO1xuICAgIG91dFswXSA9IDA7XG4gICAgb3V0WzFdID0gMDtcbiAgICByZXR1cm4gb3V0O1xufTtcblxuLyoqXG4gKiBDcmVhdGVzIGEgbmV3IHZlYzIgaW5pdGlhbGl6ZWQgd2l0aCB2YWx1ZXMgZnJvbSBhbiBleGlzdGluZyB2ZWN0b3JcbiAqXG4gKiBAcGFyYW0ge3ZlYzJ9IGEgdmVjdG9yIHRvIGNsb25lXG4gKiBAcmV0dXJucyB7dmVjMn0gYSBuZXcgMkQgdmVjdG9yXG4gKi9cbnZlYzIuY2xvbmUgPSBmdW5jdGlvbihhKSB7XG4gICAgdmFyIG91dCA9IG5ldyBnbE1hdHJpeC5BUlJBWV9UWVBFKDIpO1xuICAgIG91dFswXSA9IGFbMF07XG4gICAgb3V0WzFdID0gYVsxXTtcbiAgICByZXR1cm4gb3V0O1xufTtcblxuLyoqXG4gKiBDcmVhdGVzIGEgbmV3IHZlYzIgaW5pdGlhbGl6ZWQgd2l0aCB0aGUgZ2l2ZW4gdmFsdWVzXG4gKlxuICogQHBhcmFtIHtOdW1iZXJ9IHggWCBjb21wb25lbnRcbiAqIEBwYXJhbSB7TnVtYmVyfSB5IFkgY29tcG9uZW50XG4gKiBAcmV0dXJucyB7dmVjMn0gYSBuZXcgMkQgdmVjdG9yXG4gKi9cbnZlYzIuZnJvbVZhbHVlcyA9IGZ1bmN0aW9uKHgsIHkpIHtcbiAgICB2YXIgb3V0ID0gbmV3IGdsTWF0cml4LkFSUkFZX1RZUEUoMik7XG4gICAgb3V0WzBdID0geDtcbiAgICBvdXRbMV0gPSB5O1xuICAgIHJldHVybiBvdXQ7XG59O1xuXG4vKipcbiAqIENvcHkgdGhlIHZhbHVlcyBmcm9tIG9uZSB2ZWMyIHRvIGFub3RoZXJcbiAqXG4gKiBAcGFyYW0ge3ZlYzJ9IG91dCB0aGUgcmVjZWl2aW5nIHZlY3RvclxuICogQHBhcmFtIHt2ZWMyfSBhIHRoZSBzb3VyY2UgdmVjdG9yXG4gKiBAcmV0dXJucyB7dmVjMn0gb3V0XG4gKi9cbnZlYzIuY29weSA9IGZ1bmN0aW9uKG91dCwgYSkge1xuICAgIG91dFswXSA9IGFbMF07XG4gICAgb3V0WzFdID0gYVsxXTtcbiAgICByZXR1cm4gb3V0O1xufTtcblxuLyoqXG4gKiBTZXQgdGhlIGNvbXBvbmVudHMgb2YgYSB2ZWMyIHRvIHRoZSBnaXZlbiB2YWx1ZXNcbiAqXG4gKiBAcGFyYW0ge3ZlYzJ9IG91dCB0aGUgcmVjZWl2aW5nIHZlY3RvclxuICogQHBhcmFtIHtOdW1iZXJ9IHggWCBjb21wb25lbnRcbiAqIEBwYXJhbSB7TnVtYmVyfSB5IFkgY29tcG9uZW50XG4gKiBAcmV0dXJucyB7dmVjMn0gb3V0XG4gKi9cbnZlYzIuc2V0ID0gZnVuY3Rpb24ob3V0LCB4LCB5KSB7XG4gICAgb3V0WzBdID0geDtcbiAgICBvdXRbMV0gPSB5O1xuICAgIHJldHVybiBvdXQ7XG59O1xuXG4vKipcbiAqIEFkZHMgdHdvIHZlYzInc1xuICpcbiAqIEBwYXJhbSB7dmVjMn0gb3V0IHRoZSByZWNlaXZpbmcgdmVjdG9yXG4gKiBAcGFyYW0ge3ZlYzJ9IGEgdGhlIGZpcnN0IG9wZXJhbmRcbiAqIEBwYXJhbSB7dmVjMn0gYiB0aGUgc2Vjb25kIG9wZXJhbmRcbiAqIEByZXR1cm5zIHt2ZWMyfSBvdXRcbiAqL1xudmVjMi5hZGQgPSBmdW5jdGlvbihvdXQsIGEsIGIpIHtcbiAgICBvdXRbMF0gPSBhWzBdICsgYlswXTtcbiAgICBvdXRbMV0gPSBhWzFdICsgYlsxXTtcbiAgICByZXR1cm4gb3V0O1xufTtcblxuLyoqXG4gKiBTdWJ0cmFjdHMgdmVjdG9yIGIgZnJvbSB2ZWN0b3IgYVxuICpcbiAqIEBwYXJhbSB7dmVjMn0gb3V0IHRoZSByZWNlaXZpbmcgdmVjdG9yXG4gKiBAcGFyYW0ge3ZlYzJ9IGEgdGhlIGZpcnN0IG9wZXJhbmRcbiAqIEBwYXJhbSB7dmVjMn0gYiB0aGUgc2Vjb25kIG9wZXJhbmRcbiAqIEByZXR1cm5zIHt2ZWMyfSBvdXRcbiAqL1xudmVjMi5zdWJ0cmFjdCA9IGZ1bmN0aW9uKG91dCwgYSwgYikge1xuICAgIG91dFswXSA9IGFbMF0gLSBiWzBdO1xuICAgIG91dFsxXSA9IGFbMV0gLSBiWzFdO1xuICAgIHJldHVybiBvdXQ7XG59O1xuXG4vKipcbiAqIEFsaWFzIGZvciB7QGxpbmsgdmVjMi5zdWJ0cmFjdH1cbiAqIEBmdW5jdGlvblxuICovXG52ZWMyLnN1YiA9IHZlYzIuc3VidHJhY3Q7XG5cbi8qKlxuICogTXVsdGlwbGllcyB0d28gdmVjMidzXG4gKlxuICogQHBhcmFtIHt2ZWMyfSBvdXQgdGhlIHJlY2VpdmluZyB2ZWN0b3JcbiAqIEBwYXJhbSB7dmVjMn0gYSB0aGUgZmlyc3Qgb3BlcmFuZFxuICogQHBhcmFtIHt2ZWMyfSBiIHRoZSBzZWNvbmQgb3BlcmFuZFxuICogQHJldHVybnMge3ZlYzJ9IG91dFxuICovXG52ZWMyLm11bHRpcGx5ID0gZnVuY3Rpb24ob3V0LCBhLCBiKSB7XG4gICAgb3V0WzBdID0gYVswXSAqIGJbMF07XG4gICAgb3V0WzFdID0gYVsxXSAqIGJbMV07XG4gICAgcmV0dXJuIG91dDtcbn07XG5cbi8qKlxuICogQWxpYXMgZm9yIHtAbGluayB2ZWMyLm11bHRpcGx5fVxuICogQGZ1bmN0aW9uXG4gKi9cbnZlYzIubXVsID0gdmVjMi5tdWx0aXBseTtcblxuLyoqXG4gKiBEaXZpZGVzIHR3byB2ZWMyJ3NcbiAqXG4gKiBAcGFyYW0ge3ZlYzJ9IG91dCB0aGUgcmVjZWl2aW5nIHZlY3RvclxuICogQHBhcmFtIHt2ZWMyfSBhIHRoZSBmaXJzdCBvcGVyYW5kXG4gKiBAcGFyYW0ge3ZlYzJ9IGIgdGhlIHNlY29uZCBvcGVyYW5kXG4gKiBAcmV0dXJucyB7dmVjMn0gb3V0XG4gKi9cbnZlYzIuZGl2aWRlID0gZnVuY3Rpb24ob3V0LCBhLCBiKSB7XG4gICAgb3V0WzBdID0gYVswXSAvIGJbMF07XG4gICAgb3V0WzFdID0gYVsxXSAvIGJbMV07XG4gICAgcmV0dXJuIG91dDtcbn07XG5cbi8qKlxuICogQWxpYXMgZm9yIHtAbGluayB2ZWMyLmRpdmlkZX1cbiAqIEBmdW5jdGlvblxuICovXG52ZWMyLmRpdiA9IHZlYzIuZGl2aWRlO1xuXG4vKipcbiAqIE1hdGguY2VpbCB0aGUgY29tcG9uZW50cyBvZiBhIHZlYzJcbiAqXG4gKiBAcGFyYW0ge3ZlYzJ9IG91dCB0aGUgcmVjZWl2aW5nIHZlY3RvclxuICogQHBhcmFtIHt2ZWMyfSBhIHZlY3RvciB0byBjZWlsXG4gKiBAcmV0dXJucyB7dmVjMn0gb3V0XG4gKi9cbnZlYzIuY2VpbCA9IGZ1bmN0aW9uIChvdXQsIGEpIHtcbiAgICBvdXRbMF0gPSBNYXRoLmNlaWwoYVswXSk7XG4gICAgb3V0WzFdID0gTWF0aC5jZWlsKGFbMV0pO1xuICAgIHJldHVybiBvdXQ7XG59O1xuXG4vKipcbiAqIE1hdGguZmxvb3IgdGhlIGNvbXBvbmVudHMgb2YgYSB2ZWMyXG4gKlxuICogQHBhcmFtIHt2ZWMyfSBvdXQgdGhlIHJlY2VpdmluZyB2ZWN0b3JcbiAqIEBwYXJhbSB7dmVjMn0gYSB2ZWN0b3IgdG8gZmxvb3JcbiAqIEByZXR1cm5zIHt2ZWMyfSBvdXRcbiAqL1xudmVjMi5mbG9vciA9IGZ1bmN0aW9uIChvdXQsIGEpIHtcbiAgICBvdXRbMF0gPSBNYXRoLmZsb29yKGFbMF0pO1xuICAgIG91dFsxXSA9IE1hdGguZmxvb3IoYVsxXSk7XG4gICAgcmV0dXJuIG91dDtcbn07XG5cbi8qKlxuICogUmV0dXJucyB0aGUgbWluaW11bSBvZiB0d28gdmVjMidzXG4gKlxuICogQHBhcmFtIHt2ZWMyfSBvdXQgdGhlIHJlY2VpdmluZyB2ZWN0b3JcbiAqIEBwYXJhbSB7dmVjMn0gYSB0aGUgZmlyc3Qgb3BlcmFuZFxuICogQHBhcmFtIHt2ZWMyfSBiIHRoZSBzZWNvbmQgb3BlcmFuZFxuICogQHJldHVybnMge3ZlYzJ9IG91dFxuICovXG52ZWMyLm1pbiA9IGZ1bmN0aW9uKG91dCwgYSwgYikge1xuICAgIG91dFswXSA9IE1hdGgubWluKGFbMF0sIGJbMF0pO1xuICAgIG91dFsxXSA9IE1hdGgubWluKGFbMV0sIGJbMV0pO1xuICAgIHJldHVybiBvdXQ7XG59O1xuXG4vKipcbiAqIFJldHVybnMgdGhlIG1heGltdW0gb2YgdHdvIHZlYzInc1xuICpcbiAqIEBwYXJhbSB7dmVjMn0gb3V0IHRoZSByZWNlaXZpbmcgdmVjdG9yXG4gKiBAcGFyYW0ge3ZlYzJ9IGEgdGhlIGZpcnN0IG9wZXJhbmRcbiAqIEBwYXJhbSB7dmVjMn0gYiB0aGUgc2Vjb25kIG9wZXJhbmRcbiAqIEByZXR1cm5zIHt2ZWMyfSBvdXRcbiAqL1xudmVjMi5tYXggPSBmdW5jdGlvbihvdXQsIGEsIGIpIHtcbiAgICBvdXRbMF0gPSBNYXRoLm1heChhWzBdLCBiWzBdKTtcbiAgICBvdXRbMV0gPSBNYXRoLm1heChhWzFdLCBiWzFdKTtcbiAgICByZXR1cm4gb3V0O1xufTtcblxuLyoqXG4gKiBNYXRoLnJvdW5kIHRoZSBjb21wb25lbnRzIG9mIGEgdmVjMlxuICpcbiAqIEBwYXJhbSB7dmVjMn0gb3V0IHRoZSByZWNlaXZpbmcgdmVjdG9yXG4gKiBAcGFyYW0ge3ZlYzJ9IGEgdmVjdG9yIHRvIHJvdW5kXG4gKiBAcmV0dXJucyB7dmVjMn0gb3V0XG4gKi9cbnZlYzIucm91bmQgPSBmdW5jdGlvbiAob3V0LCBhKSB7XG4gICAgb3V0WzBdID0gTWF0aC5yb3VuZChhWzBdKTtcbiAgICBvdXRbMV0gPSBNYXRoLnJvdW5kKGFbMV0pO1xuICAgIHJldHVybiBvdXQ7XG59O1xuXG4vKipcbiAqIFNjYWxlcyBhIHZlYzIgYnkgYSBzY2FsYXIgbnVtYmVyXG4gKlxuICogQHBhcmFtIHt2ZWMyfSBvdXQgdGhlIHJlY2VpdmluZyB2ZWN0b3JcbiAqIEBwYXJhbSB7dmVjMn0gYSB0aGUgdmVjdG9yIHRvIHNjYWxlXG4gKiBAcGFyYW0ge051bWJlcn0gYiBhbW91bnQgdG8gc2NhbGUgdGhlIHZlY3RvciBieVxuICogQHJldHVybnMge3ZlYzJ9IG91dFxuICovXG52ZWMyLnNjYWxlID0gZnVuY3Rpb24ob3V0LCBhLCBiKSB7XG4gICAgb3V0WzBdID0gYVswXSAqIGI7XG4gICAgb3V0WzFdID0gYVsxXSAqIGI7XG4gICAgcmV0dXJuIG91dDtcbn07XG5cbi8qKlxuICogQWRkcyB0d28gdmVjMidzIGFmdGVyIHNjYWxpbmcgdGhlIHNlY29uZCBvcGVyYW5kIGJ5IGEgc2NhbGFyIHZhbHVlXG4gKlxuICogQHBhcmFtIHt2ZWMyfSBvdXQgdGhlIHJlY2VpdmluZyB2ZWN0b3JcbiAqIEBwYXJhbSB7dmVjMn0gYSB0aGUgZmlyc3Qgb3BlcmFuZFxuICogQHBhcmFtIHt2ZWMyfSBiIHRoZSBzZWNvbmQgb3BlcmFuZFxuICogQHBhcmFtIHtOdW1iZXJ9IHNjYWxlIHRoZSBhbW91bnQgdG8gc2NhbGUgYiBieSBiZWZvcmUgYWRkaW5nXG4gKiBAcmV0dXJucyB7dmVjMn0gb3V0XG4gKi9cbnZlYzIuc2NhbGVBbmRBZGQgPSBmdW5jdGlvbihvdXQsIGEsIGIsIHNjYWxlKSB7XG4gICAgb3V0WzBdID0gYVswXSArIChiWzBdICogc2NhbGUpO1xuICAgIG91dFsxXSA9IGFbMV0gKyAoYlsxXSAqIHNjYWxlKTtcbiAgICByZXR1cm4gb3V0O1xufTtcblxuLyoqXG4gKiBDYWxjdWxhdGVzIHRoZSBldWNsaWRpYW4gZGlzdGFuY2UgYmV0d2VlbiB0d28gdmVjMidzXG4gKlxuICogQHBhcmFtIHt2ZWMyfSBhIHRoZSBmaXJzdCBvcGVyYW5kXG4gKiBAcGFyYW0ge3ZlYzJ9IGIgdGhlIHNlY29uZCBvcGVyYW5kXG4gKiBAcmV0dXJucyB7TnVtYmVyfSBkaXN0YW5jZSBiZXR3ZWVuIGEgYW5kIGJcbiAqL1xudmVjMi5kaXN0YW5jZSA9IGZ1bmN0aW9uKGEsIGIpIHtcbiAgICB2YXIgeCA9IGJbMF0gLSBhWzBdLFxuICAgICAgICB5ID0gYlsxXSAtIGFbMV07XG4gICAgcmV0dXJuIE1hdGguc3FydCh4KnggKyB5KnkpO1xufTtcblxuLyoqXG4gKiBBbGlhcyBmb3Ige0BsaW5rIHZlYzIuZGlzdGFuY2V9XG4gKiBAZnVuY3Rpb25cbiAqL1xudmVjMi5kaXN0ID0gdmVjMi5kaXN0YW5jZTtcblxuLyoqXG4gKiBDYWxjdWxhdGVzIHRoZSBzcXVhcmVkIGV1Y2xpZGlhbiBkaXN0YW5jZSBiZXR3ZWVuIHR3byB2ZWMyJ3NcbiAqXG4gKiBAcGFyYW0ge3ZlYzJ9IGEgdGhlIGZpcnN0IG9wZXJhbmRcbiAqIEBwYXJhbSB7dmVjMn0gYiB0aGUgc2Vjb25kIG9wZXJhbmRcbiAqIEByZXR1cm5zIHtOdW1iZXJ9IHNxdWFyZWQgZGlzdGFuY2UgYmV0d2VlbiBhIGFuZCBiXG4gKi9cbnZlYzIuc3F1YXJlZERpc3RhbmNlID0gZnVuY3Rpb24oYSwgYikge1xuICAgIHZhciB4ID0gYlswXSAtIGFbMF0sXG4gICAgICAgIHkgPSBiWzFdIC0gYVsxXTtcbiAgICByZXR1cm4geCp4ICsgeSp5O1xufTtcblxuLyoqXG4gKiBBbGlhcyBmb3Ige0BsaW5rIHZlYzIuc3F1YXJlZERpc3RhbmNlfVxuICogQGZ1bmN0aW9uXG4gKi9cbnZlYzIuc3FyRGlzdCA9IHZlYzIuc3F1YXJlZERpc3RhbmNlO1xuXG4vKipcbiAqIENhbGN1bGF0ZXMgdGhlIGxlbmd0aCBvZiBhIHZlYzJcbiAqXG4gKiBAcGFyYW0ge3ZlYzJ9IGEgdmVjdG9yIHRvIGNhbGN1bGF0ZSBsZW5ndGggb2ZcbiAqIEByZXR1cm5zIHtOdW1iZXJ9IGxlbmd0aCBvZiBhXG4gKi9cbnZlYzIubGVuZ3RoID0gZnVuY3Rpb24gKGEpIHtcbiAgICB2YXIgeCA9IGFbMF0sXG4gICAgICAgIHkgPSBhWzFdO1xuICAgIHJldHVybiBNYXRoLnNxcnQoeCp4ICsgeSp5KTtcbn07XG5cbi8qKlxuICogQWxpYXMgZm9yIHtAbGluayB2ZWMyLmxlbmd0aH1cbiAqIEBmdW5jdGlvblxuICovXG52ZWMyLmxlbiA9IHZlYzIubGVuZ3RoO1xuXG4vKipcbiAqIENhbGN1bGF0ZXMgdGhlIHNxdWFyZWQgbGVuZ3RoIG9mIGEgdmVjMlxuICpcbiAqIEBwYXJhbSB7dmVjMn0gYSB2ZWN0b3IgdG8gY2FsY3VsYXRlIHNxdWFyZWQgbGVuZ3RoIG9mXG4gKiBAcmV0dXJucyB7TnVtYmVyfSBzcXVhcmVkIGxlbmd0aCBvZiBhXG4gKi9cbnZlYzIuc3F1YXJlZExlbmd0aCA9IGZ1bmN0aW9uIChhKSB7XG4gICAgdmFyIHggPSBhWzBdLFxuICAgICAgICB5ID0gYVsxXTtcbiAgICByZXR1cm4geCp4ICsgeSp5O1xufTtcblxuLyoqXG4gKiBBbGlhcyBmb3Ige0BsaW5rIHZlYzIuc3F1YXJlZExlbmd0aH1cbiAqIEBmdW5jdGlvblxuICovXG52ZWMyLnNxckxlbiA9IHZlYzIuc3F1YXJlZExlbmd0aDtcblxuLyoqXG4gKiBOZWdhdGVzIHRoZSBjb21wb25lbnRzIG9mIGEgdmVjMlxuICpcbiAqIEBwYXJhbSB7dmVjMn0gb3V0IHRoZSByZWNlaXZpbmcgdmVjdG9yXG4gKiBAcGFyYW0ge3ZlYzJ9IGEgdmVjdG9yIHRvIG5lZ2F0ZVxuICogQHJldHVybnMge3ZlYzJ9IG91dFxuICovXG52ZWMyLm5lZ2F0ZSA9IGZ1bmN0aW9uKG91dCwgYSkge1xuICAgIG91dFswXSA9IC1hWzBdO1xuICAgIG91dFsxXSA9IC1hWzFdO1xuICAgIHJldHVybiBvdXQ7XG59O1xuXG4vKipcbiAqIFJldHVybnMgdGhlIGludmVyc2Ugb2YgdGhlIGNvbXBvbmVudHMgb2YgYSB2ZWMyXG4gKlxuICogQHBhcmFtIHt2ZWMyfSBvdXQgdGhlIHJlY2VpdmluZyB2ZWN0b3JcbiAqIEBwYXJhbSB7dmVjMn0gYSB2ZWN0b3IgdG8gaW52ZXJ0XG4gKiBAcmV0dXJucyB7dmVjMn0gb3V0XG4gKi9cbnZlYzIuaW52ZXJzZSA9IGZ1bmN0aW9uKG91dCwgYSkge1xuICBvdXRbMF0gPSAxLjAgLyBhWzBdO1xuICBvdXRbMV0gPSAxLjAgLyBhWzFdO1xuICByZXR1cm4gb3V0O1xufTtcblxuLyoqXG4gKiBOb3JtYWxpemUgYSB2ZWMyXG4gKlxuICogQHBhcmFtIHt2ZWMyfSBvdXQgdGhlIHJlY2VpdmluZyB2ZWN0b3JcbiAqIEBwYXJhbSB7dmVjMn0gYSB2ZWN0b3IgdG8gbm9ybWFsaXplXG4gKiBAcmV0dXJucyB7dmVjMn0gb3V0XG4gKi9cbnZlYzIubm9ybWFsaXplID0gZnVuY3Rpb24ob3V0LCBhKSB7XG4gICAgdmFyIHggPSBhWzBdLFxuICAgICAgICB5ID0gYVsxXTtcbiAgICB2YXIgbGVuID0geCp4ICsgeSp5O1xuICAgIGlmIChsZW4gPiAwKSB7XG4gICAgICAgIC8vVE9ETzogZXZhbHVhdGUgdXNlIG9mIGdsbV9pbnZzcXJ0IGhlcmU/XG4gICAgICAgIGxlbiA9IDEgLyBNYXRoLnNxcnQobGVuKTtcbiAgICAgICAgb3V0WzBdID0gYVswXSAqIGxlbjtcbiAgICAgICAgb3V0WzFdID0gYVsxXSAqIGxlbjtcbiAgICB9XG4gICAgcmV0dXJuIG91dDtcbn07XG5cbi8qKlxuICogQ2FsY3VsYXRlcyB0aGUgZG90IHByb2R1Y3Qgb2YgdHdvIHZlYzInc1xuICpcbiAqIEBwYXJhbSB7dmVjMn0gYSB0aGUgZmlyc3Qgb3BlcmFuZFxuICogQHBhcmFtIHt2ZWMyfSBiIHRoZSBzZWNvbmQgb3BlcmFuZFxuICogQHJldHVybnMge051bWJlcn0gZG90IHByb2R1Y3Qgb2YgYSBhbmQgYlxuICovXG52ZWMyLmRvdCA9IGZ1bmN0aW9uIChhLCBiKSB7XG4gICAgcmV0dXJuIGFbMF0gKiBiWzBdICsgYVsxXSAqIGJbMV07XG59O1xuXG4vKipcbiAqIENvbXB1dGVzIHRoZSBjcm9zcyBwcm9kdWN0IG9mIHR3byB2ZWMyJ3NcbiAqIE5vdGUgdGhhdCB0aGUgY3Jvc3MgcHJvZHVjdCBtdXN0IGJ5IGRlZmluaXRpb24gcHJvZHVjZSBhIDNEIHZlY3RvclxuICpcbiAqIEBwYXJhbSB7dmVjM30gb3V0IHRoZSByZWNlaXZpbmcgdmVjdG9yXG4gKiBAcGFyYW0ge3ZlYzJ9IGEgdGhlIGZpcnN0IG9wZXJhbmRcbiAqIEBwYXJhbSB7dmVjMn0gYiB0aGUgc2Vjb25kIG9wZXJhbmRcbiAqIEByZXR1cm5zIHt2ZWMzfSBvdXRcbiAqL1xudmVjMi5jcm9zcyA9IGZ1bmN0aW9uKG91dCwgYSwgYikge1xuICAgIHZhciB6ID0gYVswXSAqIGJbMV0gLSBhWzFdICogYlswXTtcbiAgICBvdXRbMF0gPSBvdXRbMV0gPSAwO1xuICAgIG91dFsyXSA9IHo7XG4gICAgcmV0dXJuIG91dDtcbn07XG5cbi8qKlxuICogUGVyZm9ybXMgYSBsaW5lYXIgaW50ZXJwb2xhdGlvbiBiZXR3ZWVuIHR3byB2ZWMyJ3NcbiAqXG4gKiBAcGFyYW0ge3ZlYzJ9IG91dCB0aGUgcmVjZWl2aW5nIHZlY3RvclxuICogQHBhcmFtIHt2ZWMyfSBhIHRoZSBmaXJzdCBvcGVyYW5kXG4gKiBAcGFyYW0ge3ZlYzJ9IGIgdGhlIHNlY29uZCBvcGVyYW5kXG4gKiBAcGFyYW0ge051bWJlcn0gdCBpbnRlcnBvbGF0aW9uIGFtb3VudCBiZXR3ZWVuIHRoZSB0d28gaW5wdXRzXG4gKiBAcmV0dXJucyB7dmVjMn0gb3V0XG4gKi9cbnZlYzIubGVycCA9IGZ1bmN0aW9uIChvdXQsIGEsIGIsIHQpIHtcbiAgICB2YXIgYXggPSBhWzBdLFxuICAgICAgICBheSA9IGFbMV07XG4gICAgb3V0WzBdID0gYXggKyB0ICogKGJbMF0gLSBheCk7XG4gICAgb3V0WzFdID0gYXkgKyB0ICogKGJbMV0gLSBheSk7XG4gICAgcmV0dXJuIG91dDtcbn07XG5cbi8qKlxuICogR2VuZXJhdGVzIGEgcmFuZG9tIHZlY3RvciB3aXRoIHRoZSBnaXZlbiBzY2FsZVxuICpcbiAqIEBwYXJhbSB7dmVjMn0gb3V0IHRoZSByZWNlaXZpbmcgdmVjdG9yXG4gKiBAcGFyYW0ge051bWJlcn0gW3NjYWxlXSBMZW5ndGggb2YgdGhlIHJlc3VsdGluZyB2ZWN0b3IuIElmIG9tbWl0dGVkLCBhIHVuaXQgdmVjdG9yIHdpbGwgYmUgcmV0dXJuZWRcbiAqIEByZXR1cm5zIHt2ZWMyfSBvdXRcbiAqL1xudmVjMi5yYW5kb20gPSBmdW5jdGlvbiAob3V0LCBzY2FsZSkge1xuICAgIHNjYWxlID0gc2NhbGUgfHwgMS4wO1xuICAgIHZhciByID0gZ2xNYXRyaXguUkFORE9NKCkgKiAyLjAgKiBNYXRoLlBJO1xuICAgIG91dFswXSA9IE1hdGguY29zKHIpICogc2NhbGU7XG4gICAgb3V0WzFdID0gTWF0aC5zaW4ocikgKiBzY2FsZTtcbiAgICByZXR1cm4gb3V0O1xufTtcblxuLyoqXG4gKiBUcmFuc2Zvcm1zIHRoZSB2ZWMyIHdpdGggYSBtYXQyXG4gKlxuICogQHBhcmFtIHt2ZWMyfSBvdXQgdGhlIHJlY2VpdmluZyB2ZWN0b3JcbiAqIEBwYXJhbSB7dmVjMn0gYSB0aGUgdmVjdG9yIHRvIHRyYW5zZm9ybVxuICogQHBhcmFtIHttYXQyfSBtIG1hdHJpeCB0byB0cmFuc2Zvcm0gd2l0aFxuICogQHJldHVybnMge3ZlYzJ9IG91dFxuICovXG52ZWMyLnRyYW5zZm9ybU1hdDIgPSBmdW5jdGlvbihvdXQsIGEsIG0pIHtcbiAgICB2YXIgeCA9IGFbMF0sXG4gICAgICAgIHkgPSBhWzFdO1xuICAgIG91dFswXSA9IG1bMF0gKiB4ICsgbVsyXSAqIHk7XG4gICAgb3V0WzFdID0gbVsxXSAqIHggKyBtWzNdICogeTtcbiAgICByZXR1cm4gb3V0O1xufTtcblxuLyoqXG4gKiBUcmFuc2Zvcm1zIHRoZSB2ZWMyIHdpdGggYSBtYXQyZFxuICpcbiAqIEBwYXJhbSB7dmVjMn0gb3V0IHRoZSByZWNlaXZpbmcgdmVjdG9yXG4gKiBAcGFyYW0ge3ZlYzJ9IGEgdGhlIHZlY3RvciB0byB0cmFuc2Zvcm1cbiAqIEBwYXJhbSB7bWF0MmR9IG0gbWF0cml4IHRvIHRyYW5zZm9ybSB3aXRoXG4gKiBAcmV0dXJucyB7dmVjMn0gb3V0XG4gKi9cbnZlYzIudHJhbnNmb3JtTWF0MmQgPSBmdW5jdGlvbihvdXQsIGEsIG0pIHtcbiAgICB2YXIgeCA9IGFbMF0sXG4gICAgICAgIHkgPSBhWzFdO1xuICAgIG91dFswXSA9IG1bMF0gKiB4ICsgbVsyXSAqIHkgKyBtWzRdO1xuICAgIG91dFsxXSA9IG1bMV0gKiB4ICsgbVszXSAqIHkgKyBtWzVdO1xuICAgIHJldHVybiBvdXQ7XG59O1xuXG4vKipcbiAqIFRyYW5zZm9ybXMgdGhlIHZlYzIgd2l0aCBhIG1hdDNcbiAqIDNyZCB2ZWN0b3IgY29tcG9uZW50IGlzIGltcGxpY2l0bHkgJzEnXG4gKlxuICogQHBhcmFtIHt2ZWMyfSBvdXQgdGhlIHJlY2VpdmluZyB2ZWN0b3JcbiAqIEBwYXJhbSB7dmVjMn0gYSB0aGUgdmVjdG9yIHRvIHRyYW5zZm9ybVxuICogQHBhcmFtIHttYXQzfSBtIG1hdHJpeCB0byB0cmFuc2Zvcm0gd2l0aFxuICogQHJldHVybnMge3ZlYzJ9IG91dFxuICovXG52ZWMyLnRyYW5zZm9ybU1hdDMgPSBmdW5jdGlvbihvdXQsIGEsIG0pIHtcbiAgICB2YXIgeCA9IGFbMF0sXG4gICAgICAgIHkgPSBhWzFdO1xuICAgIG91dFswXSA9IG1bMF0gKiB4ICsgbVszXSAqIHkgKyBtWzZdO1xuICAgIG91dFsxXSA9IG1bMV0gKiB4ICsgbVs0XSAqIHkgKyBtWzddO1xuICAgIHJldHVybiBvdXQ7XG59O1xuXG4vKipcbiAqIFRyYW5zZm9ybXMgdGhlIHZlYzIgd2l0aCBhIG1hdDRcbiAqIDNyZCB2ZWN0b3IgY29tcG9uZW50IGlzIGltcGxpY2l0bHkgJzAnXG4gKiA0dGggdmVjdG9yIGNvbXBvbmVudCBpcyBpbXBsaWNpdGx5ICcxJ1xuICpcbiAqIEBwYXJhbSB7dmVjMn0gb3V0IHRoZSByZWNlaXZpbmcgdmVjdG9yXG4gKiBAcGFyYW0ge3ZlYzJ9IGEgdGhlIHZlY3RvciB0byB0cmFuc2Zvcm1cbiAqIEBwYXJhbSB7bWF0NH0gbSBtYXRyaXggdG8gdHJhbnNmb3JtIHdpdGhcbiAqIEByZXR1cm5zIHt2ZWMyfSBvdXRcbiAqL1xudmVjMi50cmFuc2Zvcm1NYXQ0ID0gZnVuY3Rpb24ob3V0LCBhLCBtKSB7XG4gICAgdmFyIHggPSBhWzBdLCBcbiAgICAgICAgeSA9IGFbMV07XG4gICAgb3V0WzBdID0gbVswXSAqIHggKyBtWzRdICogeSArIG1bMTJdO1xuICAgIG91dFsxXSA9IG1bMV0gKiB4ICsgbVs1XSAqIHkgKyBtWzEzXTtcbiAgICByZXR1cm4gb3V0O1xufTtcblxuLyoqXG4gKiBQZXJmb3JtIHNvbWUgb3BlcmF0aW9uIG92ZXIgYW4gYXJyYXkgb2YgdmVjMnMuXG4gKlxuICogQHBhcmFtIHtBcnJheX0gYSB0aGUgYXJyYXkgb2YgdmVjdG9ycyB0byBpdGVyYXRlIG92ZXJcbiAqIEBwYXJhbSB7TnVtYmVyfSBzdHJpZGUgTnVtYmVyIG9mIGVsZW1lbnRzIGJldHdlZW4gdGhlIHN0YXJ0IG9mIGVhY2ggdmVjMi4gSWYgMCBhc3N1bWVzIHRpZ2h0bHkgcGFja2VkXG4gKiBAcGFyYW0ge051bWJlcn0gb2Zmc2V0IE51bWJlciBvZiBlbGVtZW50cyB0byBza2lwIGF0IHRoZSBiZWdpbm5pbmcgb2YgdGhlIGFycmF5XG4gKiBAcGFyYW0ge051bWJlcn0gY291bnQgTnVtYmVyIG9mIHZlYzJzIHRvIGl0ZXJhdGUgb3Zlci4gSWYgMCBpdGVyYXRlcyBvdmVyIGVudGlyZSBhcnJheVxuICogQHBhcmFtIHtGdW5jdGlvbn0gZm4gRnVuY3Rpb24gdG8gY2FsbCBmb3IgZWFjaCB2ZWN0b3IgaW4gdGhlIGFycmF5XG4gKiBAcGFyYW0ge09iamVjdH0gW2FyZ10gYWRkaXRpb25hbCBhcmd1bWVudCB0byBwYXNzIHRvIGZuXG4gKiBAcmV0dXJucyB7QXJyYXl9IGFcbiAqIEBmdW5jdGlvblxuICovXG52ZWMyLmZvckVhY2ggPSAoZnVuY3Rpb24oKSB7XG4gICAgdmFyIHZlYyA9IHZlYzIuY3JlYXRlKCk7XG5cbiAgICByZXR1cm4gZnVuY3Rpb24oYSwgc3RyaWRlLCBvZmZzZXQsIGNvdW50LCBmbiwgYXJnKSB7XG4gICAgICAgIHZhciBpLCBsO1xuICAgICAgICBpZighc3RyaWRlKSB7XG4gICAgICAgICAgICBzdHJpZGUgPSAyO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYoIW9mZnNldCkge1xuICAgICAgICAgICAgb2Zmc2V0ID0gMDtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgaWYoY291bnQpIHtcbiAgICAgICAgICAgIGwgPSBNYXRoLm1pbigoY291bnQgKiBzdHJpZGUpICsgb2Zmc2V0LCBhLmxlbmd0aCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBsID0gYS5sZW5ndGg7XG4gICAgICAgIH1cblxuICAgICAgICBmb3IoaSA9IG9mZnNldDsgaSA8IGw7IGkgKz0gc3RyaWRlKSB7XG4gICAgICAgICAgICB2ZWNbMF0gPSBhW2ldOyB2ZWNbMV0gPSBhW2krMV07XG4gICAgICAgICAgICBmbih2ZWMsIHZlYywgYXJnKTtcbiAgICAgICAgICAgIGFbaV0gPSB2ZWNbMF07IGFbaSsxXSA9IHZlY1sxXTtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgcmV0dXJuIGE7XG4gICAgfTtcbn0pKCk7XG5cbi8qKlxuICogUmV0dXJucyBhIHN0cmluZyByZXByZXNlbnRhdGlvbiBvZiBhIHZlY3RvclxuICpcbiAqIEBwYXJhbSB7dmVjMn0gdmVjIHZlY3RvciB0byByZXByZXNlbnQgYXMgYSBzdHJpbmdcbiAqIEByZXR1cm5zIHtTdHJpbmd9IHN0cmluZyByZXByZXNlbnRhdGlvbiBvZiB0aGUgdmVjdG9yXG4gKi9cbnZlYzIuc3RyID0gZnVuY3Rpb24gKGEpIHtcbiAgICByZXR1cm4gJ3ZlYzIoJyArIGFbMF0gKyAnLCAnICsgYVsxXSArICcpJztcbn07XG5cbi8qKlxuICogUmV0dXJucyB3aGV0aGVyIG9yIG5vdCB0aGUgdmVjdG9ycyBleGFjdGx5IGhhdmUgdGhlIHNhbWUgZWxlbWVudHMgaW4gdGhlIHNhbWUgcG9zaXRpb24gKHdoZW4gY29tcGFyZWQgd2l0aCA9PT0pXG4gKlxuICogQHBhcmFtIHt2ZWMyfSBhIFRoZSBmaXJzdCB2ZWN0b3IuXG4gKiBAcGFyYW0ge3ZlYzJ9IGIgVGhlIHNlY29uZCB2ZWN0b3IuXG4gKiBAcmV0dXJucyB7Qm9vbGVhbn0gVHJ1ZSBpZiB0aGUgdmVjdG9ycyBhcmUgZXF1YWwsIGZhbHNlIG90aGVyd2lzZS5cbiAqL1xudmVjMi5leGFjdEVxdWFscyA9IGZ1bmN0aW9uIChhLCBiKSB7XG4gICAgcmV0dXJuIGFbMF0gPT09IGJbMF0gJiYgYVsxXSA9PT0gYlsxXTtcbn07XG5cbi8qKlxuICogUmV0dXJucyB3aGV0aGVyIG9yIG5vdCB0aGUgdmVjdG9ycyBoYXZlIGFwcHJveGltYXRlbHkgdGhlIHNhbWUgZWxlbWVudHMgaW4gdGhlIHNhbWUgcG9zaXRpb24uXG4gKlxuICogQHBhcmFtIHt2ZWMyfSBhIFRoZSBmaXJzdCB2ZWN0b3IuXG4gKiBAcGFyYW0ge3ZlYzJ9IGIgVGhlIHNlY29uZCB2ZWN0b3IuXG4gKiBAcmV0dXJucyB7Qm9vbGVhbn0gVHJ1ZSBpZiB0aGUgdmVjdG9ycyBhcmUgZXF1YWwsIGZhbHNlIG90aGVyd2lzZS5cbiAqL1xudmVjMi5lcXVhbHMgPSBmdW5jdGlvbiAoYSwgYikge1xuICAgIHZhciBhMCA9IGFbMF0sIGExID0gYVsxXTtcbiAgICB2YXIgYjAgPSBiWzBdLCBiMSA9IGJbMV07XG4gICAgcmV0dXJuIChNYXRoLmFicyhhMCAtIGIwKSA8PSBnbE1hdHJpeC5FUFNJTE9OKk1hdGgubWF4KDEuMCwgTWF0aC5hYnMoYTApLCBNYXRoLmFicyhiMCkpICYmXG4gICAgICAgICAgICBNYXRoLmFicyhhMSAtIGIxKSA8PSBnbE1hdHJpeC5FUFNJTE9OKk1hdGgubWF4KDEuMCwgTWF0aC5hYnMoYTEpLCBNYXRoLmFicyhiMSkpKTtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gdmVjMjtcbiIsIi8qIENvcHlyaWdodCAoYykgMjAxNSwgQnJhbmRvbiBKb25lcywgQ29saW4gTWFjS2VuemllIElWLlxuXG5QZXJtaXNzaW9uIGlzIGhlcmVieSBncmFudGVkLCBmcmVlIG9mIGNoYXJnZSwgdG8gYW55IHBlcnNvbiBvYnRhaW5pbmcgYSBjb3B5XG5vZiB0aGlzIHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGRvY3VtZW50YXRpb24gZmlsZXMgKHRoZSBcIlNvZnR3YXJlXCIpLCB0byBkZWFsXG5pbiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbiB0aGUgcmlnaHRzXG50byB1c2UsIGNvcHksIG1vZGlmeSwgbWVyZ2UsIHB1Ymxpc2gsIGRpc3RyaWJ1dGUsIHN1YmxpY2Vuc2UsIGFuZC9vciBzZWxsXG5jb3BpZXMgb2YgdGhlIFNvZnR3YXJlLCBhbmQgdG8gcGVybWl0IHBlcnNvbnMgdG8gd2hvbSB0aGUgU29mdHdhcmUgaXNcbmZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6XG5cblRoZSBhYm92ZSBjb3B5cmlnaHQgbm90aWNlIGFuZCB0aGlzIHBlcm1pc3Npb24gbm90aWNlIHNoYWxsIGJlIGluY2x1ZGVkIGluXG5hbGwgY29waWVzIG9yIHN1YnN0YW50aWFsIHBvcnRpb25zIG9mIHRoZSBTb2Z0d2FyZS5cblxuVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEIFwiQVMgSVNcIiwgV0lUSE9VVCBXQVJSQU5UWSBPRiBBTlkgS0lORCwgRVhQUkVTUyBPUlxuSU1QTElFRCwgSU5DTFVESU5HIEJVVCBOT1QgTElNSVRFRCBUTyBUSEUgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFksXG5GSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQgTk9OSU5GUklOR0VNRU5ULiBJTiBOTyBFVkVOVCBTSEFMTCBUSEVcbkFVVEhPUlMgT1IgQ09QWVJJR0hUIEhPTERFUlMgQkUgTElBQkxFIEZPUiBBTlkgQ0xBSU0sIERBTUFHRVMgT1IgT1RIRVJcbkxJQUJJTElUWSwgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIFRPUlQgT1IgT1RIRVJXSVNFLCBBUklTSU5HIEZST00sXG5PVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SIE9USEVSIERFQUxJTkdTIElOXG5USEUgU09GVFdBUkUuICovXG5cbnZhciBnbE1hdHJpeCA9IHJlcXVpcmUoXCIuL2NvbW1vbi5qc1wiKTtcblxuLyoqXG4gKiBAY2xhc3MgMyBEaW1lbnNpb25hbCBWZWN0b3JcbiAqIEBuYW1lIHZlYzNcbiAqL1xudmFyIHZlYzMgPSB7fTtcblxuLyoqXG4gKiBDcmVhdGVzIGEgbmV3LCBlbXB0eSB2ZWMzXG4gKlxuICogQHJldHVybnMge3ZlYzN9IGEgbmV3IDNEIHZlY3RvclxuICovXG52ZWMzLmNyZWF0ZSA9IGZ1bmN0aW9uKCkge1xuICAgIHZhciBvdXQgPSBuZXcgZ2xNYXRyaXguQVJSQVlfVFlQRSgzKTtcbiAgICBvdXRbMF0gPSAwO1xuICAgIG91dFsxXSA9IDA7XG4gICAgb3V0WzJdID0gMDtcbiAgICByZXR1cm4gb3V0O1xufTtcblxuLyoqXG4gKiBDcmVhdGVzIGEgbmV3IHZlYzMgaW5pdGlhbGl6ZWQgd2l0aCB2YWx1ZXMgZnJvbSBhbiBleGlzdGluZyB2ZWN0b3JcbiAqXG4gKiBAcGFyYW0ge3ZlYzN9IGEgdmVjdG9yIHRvIGNsb25lXG4gKiBAcmV0dXJucyB7dmVjM30gYSBuZXcgM0QgdmVjdG9yXG4gKi9cbnZlYzMuY2xvbmUgPSBmdW5jdGlvbihhKSB7XG4gICAgdmFyIG91dCA9IG5ldyBnbE1hdHJpeC5BUlJBWV9UWVBFKDMpO1xuICAgIG91dFswXSA9IGFbMF07XG4gICAgb3V0WzFdID0gYVsxXTtcbiAgICBvdXRbMl0gPSBhWzJdO1xuICAgIHJldHVybiBvdXQ7XG59O1xuXG4vKipcbiAqIENyZWF0ZXMgYSBuZXcgdmVjMyBpbml0aWFsaXplZCB3aXRoIHRoZSBnaXZlbiB2YWx1ZXNcbiAqXG4gKiBAcGFyYW0ge051bWJlcn0geCBYIGNvbXBvbmVudFxuICogQHBhcmFtIHtOdW1iZXJ9IHkgWSBjb21wb25lbnRcbiAqIEBwYXJhbSB7TnVtYmVyfSB6IFogY29tcG9uZW50XG4gKiBAcmV0dXJucyB7dmVjM30gYSBuZXcgM0QgdmVjdG9yXG4gKi9cbnZlYzMuZnJvbVZhbHVlcyA9IGZ1bmN0aW9uKHgsIHksIHopIHtcbiAgICB2YXIgb3V0ID0gbmV3IGdsTWF0cml4LkFSUkFZX1RZUEUoMyk7XG4gICAgb3V0WzBdID0geDtcbiAgICBvdXRbMV0gPSB5O1xuICAgIG91dFsyXSA9IHo7XG4gICAgcmV0dXJuIG91dDtcbn07XG5cbi8qKlxuICogQ29weSB0aGUgdmFsdWVzIGZyb20gb25lIHZlYzMgdG8gYW5vdGhlclxuICpcbiAqIEBwYXJhbSB7dmVjM30gb3V0IHRoZSByZWNlaXZpbmcgdmVjdG9yXG4gKiBAcGFyYW0ge3ZlYzN9IGEgdGhlIHNvdXJjZSB2ZWN0b3JcbiAqIEByZXR1cm5zIHt2ZWMzfSBvdXRcbiAqL1xudmVjMy5jb3B5ID0gZnVuY3Rpb24ob3V0LCBhKSB7XG4gICAgb3V0WzBdID0gYVswXTtcbiAgICBvdXRbMV0gPSBhWzFdO1xuICAgIG91dFsyXSA9IGFbMl07XG4gICAgcmV0dXJuIG91dDtcbn07XG5cbi8qKlxuICogU2V0IHRoZSBjb21wb25lbnRzIG9mIGEgdmVjMyB0byB0aGUgZ2l2ZW4gdmFsdWVzXG4gKlxuICogQHBhcmFtIHt2ZWMzfSBvdXQgdGhlIHJlY2VpdmluZyB2ZWN0b3JcbiAqIEBwYXJhbSB7TnVtYmVyfSB4IFggY29tcG9uZW50XG4gKiBAcGFyYW0ge051bWJlcn0geSBZIGNvbXBvbmVudFxuICogQHBhcmFtIHtOdW1iZXJ9IHogWiBjb21wb25lbnRcbiAqIEByZXR1cm5zIHt2ZWMzfSBvdXRcbiAqL1xudmVjMy5zZXQgPSBmdW5jdGlvbihvdXQsIHgsIHksIHopIHtcbiAgICBvdXRbMF0gPSB4O1xuICAgIG91dFsxXSA9IHk7XG4gICAgb3V0WzJdID0gejtcbiAgICByZXR1cm4gb3V0O1xufTtcblxuLyoqXG4gKiBBZGRzIHR3byB2ZWMzJ3NcbiAqXG4gKiBAcGFyYW0ge3ZlYzN9IG91dCB0aGUgcmVjZWl2aW5nIHZlY3RvclxuICogQHBhcmFtIHt2ZWMzfSBhIHRoZSBmaXJzdCBvcGVyYW5kXG4gKiBAcGFyYW0ge3ZlYzN9IGIgdGhlIHNlY29uZCBvcGVyYW5kXG4gKiBAcmV0dXJucyB7dmVjM30gb3V0XG4gKi9cbnZlYzMuYWRkID0gZnVuY3Rpb24ob3V0LCBhLCBiKSB7XG4gICAgb3V0WzBdID0gYVswXSArIGJbMF07XG4gICAgb3V0WzFdID0gYVsxXSArIGJbMV07XG4gICAgb3V0WzJdID0gYVsyXSArIGJbMl07XG4gICAgcmV0dXJuIG91dDtcbn07XG5cbi8qKlxuICogU3VidHJhY3RzIHZlY3RvciBiIGZyb20gdmVjdG9yIGFcbiAqXG4gKiBAcGFyYW0ge3ZlYzN9IG91dCB0aGUgcmVjZWl2aW5nIHZlY3RvclxuICogQHBhcmFtIHt2ZWMzfSBhIHRoZSBmaXJzdCBvcGVyYW5kXG4gKiBAcGFyYW0ge3ZlYzN9IGIgdGhlIHNlY29uZCBvcGVyYW5kXG4gKiBAcmV0dXJucyB7dmVjM30gb3V0XG4gKi9cbnZlYzMuc3VidHJhY3QgPSBmdW5jdGlvbihvdXQsIGEsIGIpIHtcbiAgICBvdXRbMF0gPSBhWzBdIC0gYlswXTtcbiAgICBvdXRbMV0gPSBhWzFdIC0gYlsxXTtcbiAgICBvdXRbMl0gPSBhWzJdIC0gYlsyXTtcbiAgICByZXR1cm4gb3V0O1xufTtcblxuLyoqXG4gKiBBbGlhcyBmb3Ige0BsaW5rIHZlYzMuc3VidHJhY3R9XG4gKiBAZnVuY3Rpb25cbiAqL1xudmVjMy5zdWIgPSB2ZWMzLnN1YnRyYWN0O1xuXG4vKipcbiAqIE11bHRpcGxpZXMgdHdvIHZlYzMnc1xuICpcbiAqIEBwYXJhbSB7dmVjM30gb3V0IHRoZSByZWNlaXZpbmcgdmVjdG9yXG4gKiBAcGFyYW0ge3ZlYzN9IGEgdGhlIGZpcnN0IG9wZXJhbmRcbiAqIEBwYXJhbSB7dmVjM30gYiB0aGUgc2Vjb25kIG9wZXJhbmRcbiAqIEByZXR1cm5zIHt2ZWMzfSBvdXRcbiAqL1xudmVjMy5tdWx0aXBseSA9IGZ1bmN0aW9uKG91dCwgYSwgYikge1xuICAgIG91dFswXSA9IGFbMF0gKiBiWzBdO1xuICAgIG91dFsxXSA9IGFbMV0gKiBiWzFdO1xuICAgIG91dFsyXSA9IGFbMl0gKiBiWzJdO1xuICAgIHJldHVybiBvdXQ7XG59O1xuXG4vKipcbiAqIEFsaWFzIGZvciB7QGxpbmsgdmVjMy5tdWx0aXBseX1cbiAqIEBmdW5jdGlvblxuICovXG52ZWMzLm11bCA9IHZlYzMubXVsdGlwbHk7XG5cbi8qKlxuICogRGl2aWRlcyB0d28gdmVjMydzXG4gKlxuICogQHBhcmFtIHt2ZWMzfSBvdXQgdGhlIHJlY2VpdmluZyB2ZWN0b3JcbiAqIEBwYXJhbSB7dmVjM30gYSB0aGUgZmlyc3Qgb3BlcmFuZFxuICogQHBhcmFtIHt2ZWMzfSBiIHRoZSBzZWNvbmQgb3BlcmFuZFxuICogQHJldHVybnMge3ZlYzN9IG91dFxuICovXG52ZWMzLmRpdmlkZSA9IGZ1bmN0aW9uKG91dCwgYSwgYikge1xuICAgIG91dFswXSA9IGFbMF0gLyBiWzBdO1xuICAgIG91dFsxXSA9IGFbMV0gLyBiWzFdO1xuICAgIG91dFsyXSA9IGFbMl0gLyBiWzJdO1xuICAgIHJldHVybiBvdXQ7XG59O1xuXG4vKipcbiAqIEFsaWFzIGZvciB7QGxpbmsgdmVjMy5kaXZpZGV9XG4gKiBAZnVuY3Rpb25cbiAqL1xudmVjMy5kaXYgPSB2ZWMzLmRpdmlkZTtcblxuLyoqXG4gKiBNYXRoLmNlaWwgdGhlIGNvbXBvbmVudHMgb2YgYSB2ZWMzXG4gKlxuICogQHBhcmFtIHt2ZWMzfSBvdXQgdGhlIHJlY2VpdmluZyB2ZWN0b3JcbiAqIEBwYXJhbSB7dmVjM30gYSB2ZWN0b3IgdG8gY2VpbFxuICogQHJldHVybnMge3ZlYzN9IG91dFxuICovXG52ZWMzLmNlaWwgPSBmdW5jdGlvbiAob3V0LCBhKSB7XG4gICAgb3V0WzBdID0gTWF0aC5jZWlsKGFbMF0pO1xuICAgIG91dFsxXSA9IE1hdGguY2VpbChhWzFdKTtcbiAgICBvdXRbMl0gPSBNYXRoLmNlaWwoYVsyXSk7XG4gICAgcmV0dXJuIG91dDtcbn07XG5cbi8qKlxuICogTWF0aC5mbG9vciB0aGUgY29tcG9uZW50cyBvZiBhIHZlYzNcbiAqXG4gKiBAcGFyYW0ge3ZlYzN9IG91dCB0aGUgcmVjZWl2aW5nIHZlY3RvclxuICogQHBhcmFtIHt2ZWMzfSBhIHZlY3RvciB0byBmbG9vclxuICogQHJldHVybnMge3ZlYzN9IG91dFxuICovXG52ZWMzLmZsb29yID0gZnVuY3Rpb24gKG91dCwgYSkge1xuICAgIG91dFswXSA9IE1hdGguZmxvb3IoYVswXSk7XG4gICAgb3V0WzFdID0gTWF0aC5mbG9vcihhWzFdKTtcbiAgICBvdXRbMl0gPSBNYXRoLmZsb29yKGFbMl0pO1xuICAgIHJldHVybiBvdXQ7XG59O1xuXG4vKipcbiAqIFJldHVybnMgdGhlIG1pbmltdW0gb2YgdHdvIHZlYzMnc1xuICpcbiAqIEBwYXJhbSB7dmVjM30gb3V0IHRoZSByZWNlaXZpbmcgdmVjdG9yXG4gKiBAcGFyYW0ge3ZlYzN9IGEgdGhlIGZpcnN0IG9wZXJhbmRcbiAqIEBwYXJhbSB7dmVjM30gYiB0aGUgc2Vjb25kIG9wZXJhbmRcbiAqIEByZXR1cm5zIHt2ZWMzfSBvdXRcbiAqL1xudmVjMy5taW4gPSBmdW5jdGlvbihvdXQsIGEsIGIpIHtcbiAgICBvdXRbMF0gPSBNYXRoLm1pbihhWzBdLCBiWzBdKTtcbiAgICBvdXRbMV0gPSBNYXRoLm1pbihhWzFdLCBiWzFdKTtcbiAgICBvdXRbMl0gPSBNYXRoLm1pbihhWzJdLCBiWzJdKTtcbiAgICByZXR1cm4gb3V0O1xufTtcblxuLyoqXG4gKiBSZXR1cm5zIHRoZSBtYXhpbXVtIG9mIHR3byB2ZWMzJ3NcbiAqXG4gKiBAcGFyYW0ge3ZlYzN9IG91dCB0aGUgcmVjZWl2aW5nIHZlY3RvclxuICogQHBhcmFtIHt2ZWMzfSBhIHRoZSBmaXJzdCBvcGVyYW5kXG4gKiBAcGFyYW0ge3ZlYzN9IGIgdGhlIHNlY29uZCBvcGVyYW5kXG4gKiBAcmV0dXJucyB7dmVjM30gb3V0XG4gKi9cbnZlYzMubWF4ID0gZnVuY3Rpb24ob3V0LCBhLCBiKSB7XG4gICAgb3V0WzBdID0gTWF0aC5tYXgoYVswXSwgYlswXSk7XG4gICAgb3V0WzFdID0gTWF0aC5tYXgoYVsxXSwgYlsxXSk7XG4gICAgb3V0WzJdID0gTWF0aC5tYXgoYVsyXSwgYlsyXSk7XG4gICAgcmV0dXJuIG91dDtcbn07XG5cbi8qKlxuICogTWF0aC5yb3VuZCB0aGUgY29tcG9uZW50cyBvZiBhIHZlYzNcbiAqXG4gKiBAcGFyYW0ge3ZlYzN9IG91dCB0aGUgcmVjZWl2aW5nIHZlY3RvclxuICogQHBhcmFtIHt2ZWMzfSBhIHZlY3RvciB0byByb3VuZFxuICogQHJldHVybnMge3ZlYzN9IG91dFxuICovXG52ZWMzLnJvdW5kID0gZnVuY3Rpb24gKG91dCwgYSkge1xuICAgIG91dFswXSA9IE1hdGgucm91bmQoYVswXSk7XG4gICAgb3V0WzFdID0gTWF0aC5yb3VuZChhWzFdKTtcbiAgICBvdXRbMl0gPSBNYXRoLnJvdW5kKGFbMl0pO1xuICAgIHJldHVybiBvdXQ7XG59O1xuXG4vKipcbiAqIFNjYWxlcyBhIHZlYzMgYnkgYSBzY2FsYXIgbnVtYmVyXG4gKlxuICogQHBhcmFtIHt2ZWMzfSBvdXQgdGhlIHJlY2VpdmluZyB2ZWN0b3JcbiAqIEBwYXJhbSB7dmVjM30gYSB0aGUgdmVjdG9yIHRvIHNjYWxlXG4gKiBAcGFyYW0ge051bWJlcn0gYiBhbW91bnQgdG8gc2NhbGUgdGhlIHZlY3RvciBieVxuICogQHJldHVybnMge3ZlYzN9IG91dFxuICovXG52ZWMzLnNjYWxlID0gZnVuY3Rpb24ob3V0LCBhLCBiKSB7XG4gICAgb3V0WzBdID0gYVswXSAqIGI7XG4gICAgb3V0WzFdID0gYVsxXSAqIGI7XG4gICAgb3V0WzJdID0gYVsyXSAqIGI7XG4gICAgcmV0dXJuIG91dDtcbn07XG5cbi8qKlxuICogQWRkcyB0d28gdmVjMydzIGFmdGVyIHNjYWxpbmcgdGhlIHNlY29uZCBvcGVyYW5kIGJ5IGEgc2NhbGFyIHZhbHVlXG4gKlxuICogQHBhcmFtIHt2ZWMzfSBvdXQgdGhlIHJlY2VpdmluZyB2ZWN0b3JcbiAqIEBwYXJhbSB7dmVjM30gYSB0aGUgZmlyc3Qgb3BlcmFuZFxuICogQHBhcmFtIHt2ZWMzfSBiIHRoZSBzZWNvbmQgb3BlcmFuZFxuICogQHBhcmFtIHtOdW1iZXJ9IHNjYWxlIHRoZSBhbW91bnQgdG8gc2NhbGUgYiBieSBiZWZvcmUgYWRkaW5nXG4gKiBAcmV0dXJucyB7dmVjM30gb3V0XG4gKi9cbnZlYzMuc2NhbGVBbmRBZGQgPSBmdW5jdGlvbihvdXQsIGEsIGIsIHNjYWxlKSB7XG4gICAgb3V0WzBdID0gYVswXSArIChiWzBdICogc2NhbGUpO1xuICAgIG91dFsxXSA9IGFbMV0gKyAoYlsxXSAqIHNjYWxlKTtcbiAgICBvdXRbMl0gPSBhWzJdICsgKGJbMl0gKiBzY2FsZSk7XG4gICAgcmV0dXJuIG91dDtcbn07XG5cbi8qKlxuICogQ2FsY3VsYXRlcyB0aGUgZXVjbGlkaWFuIGRpc3RhbmNlIGJldHdlZW4gdHdvIHZlYzMnc1xuICpcbiAqIEBwYXJhbSB7dmVjM30gYSB0aGUgZmlyc3Qgb3BlcmFuZFxuICogQHBhcmFtIHt2ZWMzfSBiIHRoZSBzZWNvbmQgb3BlcmFuZFxuICogQHJldHVybnMge051bWJlcn0gZGlzdGFuY2UgYmV0d2VlbiBhIGFuZCBiXG4gKi9cbnZlYzMuZGlzdGFuY2UgPSBmdW5jdGlvbihhLCBiKSB7XG4gICAgdmFyIHggPSBiWzBdIC0gYVswXSxcbiAgICAgICAgeSA9IGJbMV0gLSBhWzFdLFxuICAgICAgICB6ID0gYlsyXSAtIGFbMl07XG4gICAgcmV0dXJuIE1hdGguc3FydCh4KnggKyB5KnkgKyB6KnopO1xufTtcblxuLyoqXG4gKiBBbGlhcyBmb3Ige0BsaW5rIHZlYzMuZGlzdGFuY2V9XG4gKiBAZnVuY3Rpb25cbiAqL1xudmVjMy5kaXN0ID0gdmVjMy5kaXN0YW5jZTtcblxuLyoqXG4gKiBDYWxjdWxhdGVzIHRoZSBzcXVhcmVkIGV1Y2xpZGlhbiBkaXN0YW5jZSBiZXR3ZWVuIHR3byB2ZWMzJ3NcbiAqXG4gKiBAcGFyYW0ge3ZlYzN9IGEgdGhlIGZpcnN0IG9wZXJhbmRcbiAqIEBwYXJhbSB7dmVjM30gYiB0aGUgc2Vjb25kIG9wZXJhbmRcbiAqIEByZXR1cm5zIHtOdW1iZXJ9IHNxdWFyZWQgZGlzdGFuY2UgYmV0d2VlbiBhIGFuZCBiXG4gKi9cbnZlYzMuc3F1YXJlZERpc3RhbmNlID0gZnVuY3Rpb24oYSwgYikge1xuICAgIHZhciB4ID0gYlswXSAtIGFbMF0sXG4gICAgICAgIHkgPSBiWzFdIC0gYVsxXSxcbiAgICAgICAgeiA9IGJbMl0gLSBhWzJdO1xuICAgIHJldHVybiB4KnggKyB5KnkgKyB6Kno7XG59O1xuXG4vKipcbiAqIEFsaWFzIGZvciB7QGxpbmsgdmVjMy5zcXVhcmVkRGlzdGFuY2V9XG4gKiBAZnVuY3Rpb25cbiAqL1xudmVjMy5zcXJEaXN0ID0gdmVjMy5zcXVhcmVkRGlzdGFuY2U7XG5cbi8qKlxuICogQ2FsY3VsYXRlcyB0aGUgbGVuZ3RoIG9mIGEgdmVjM1xuICpcbiAqIEBwYXJhbSB7dmVjM30gYSB2ZWN0b3IgdG8gY2FsY3VsYXRlIGxlbmd0aCBvZlxuICogQHJldHVybnMge051bWJlcn0gbGVuZ3RoIG9mIGFcbiAqL1xudmVjMy5sZW5ndGggPSBmdW5jdGlvbiAoYSkge1xuICAgIHZhciB4ID0gYVswXSxcbiAgICAgICAgeSA9IGFbMV0sXG4gICAgICAgIHogPSBhWzJdO1xuICAgIHJldHVybiBNYXRoLnNxcnQoeCp4ICsgeSp5ICsgeip6KTtcbn07XG5cbi8qKlxuICogQWxpYXMgZm9yIHtAbGluayB2ZWMzLmxlbmd0aH1cbiAqIEBmdW5jdGlvblxuICovXG52ZWMzLmxlbiA9IHZlYzMubGVuZ3RoO1xuXG4vKipcbiAqIENhbGN1bGF0ZXMgdGhlIHNxdWFyZWQgbGVuZ3RoIG9mIGEgdmVjM1xuICpcbiAqIEBwYXJhbSB7dmVjM30gYSB2ZWN0b3IgdG8gY2FsY3VsYXRlIHNxdWFyZWQgbGVuZ3RoIG9mXG4gKiBAcmV0dXJucyB7TnVtYmVyfSBzcXVhcmVkIGxlbmd0aCBvZiBhXG4gKi9cbnZlYzMuc3F1YXJlZExlbmd0aCA9IGZ1bmN0aW9uIChhKSB7XG4gICAgdmFyIHggPSBhWzBdLFxuICAgICAgICB5ID0gYVsxXSxcbiAgICAgICAgeiA9IGFbMl07XG4gICAgcmV0dXJuIHgqeCArIHkqeSArIHoqejtcbn07XG5cbi8qKlxuICogQWxpYXMgZm9yIHtAbGluayB2ZWMzLnNxdWFyZWRMZW5ndGh9XG4gKiBAZnVuY3Rpb25cbiAqL1xudmVjMy5zcXJMZW4gPSB2ZWMzLnNxdWFyZWRMZW5ndGg7XG5cbi8qKlxuICogTmVnYXRlcyB0aGUgY29tcG9uZW50cyBvZiBhIHZlYzNcbiAqXG4gKiBAcGFyYW0ge3ZlYzN9IG91dCB0aGUgcmVjZWl2aW5nIHZlY3RvclxuICogQHBhcmFtIHt2ZWMzfSBhIHZlY3RvciB0byBuZWdhdGVcbiAqIEByZXR1cm5zIHt2ZWMzfSBvdXRcbiAqL1xudmVjMy5uZWdhdGUgPSBmdW5jdGlvbihvdXQsIGEpIHtcbiAgICBvdXRbMF0gPSAtYVswXTtcbiAgICBvdXRbMV0gPSAtYVsxXTtcbiAgICBvdXRbMl0gPSAtYVsyXTtcbiAgICByZXR1cm4gb3V0O1xufTtcblxuLyoqXG4gKiBSZXR1cm5zIHRoZSBpbnZlcnNlIG9mIHRoZSBjb21wb25lbnRzIG9mIGEgdmVjM1xuICpcbiAqIEBwYXJhbSB7dmVjM30gb3V0IHRoZSByZWNlaXZpbmcgdmVjdG9yXG4gKiBAcGFyYW0ge3ZlYzN9IGEgdmVjdG9yIHRvIGludmVydFxuICogQHJldHVybnMge3ZlYzN9IG91dFxuICovXG52ZWMzLmludmVyc2UgPSBmdW5jdGlvbihvdXQsIGEpIHtcbiAgb3V0WzBdID0gMS4wIC8gYVswXTtcbiAgb3V0WzFdID0gMS4wIC8gYVsxXTtcbiAgb3V0WzJdID0gMS4wIC8gYVsyXTtcbiAgcmV0dXJuIG91dDtcbn07XG5cbi8qKlxuICogTm9ybWFsaXplIGEgdmVjM1xuICpcbiAqIEBwYXJhbSB7dmVjM30gb3V0IHRoZSByZWNlaXZpbmcgdmVjdG9yXG4gKiBAcGFyYW0ge3ZlYzN9IGEgdmVjdG9yIHRvIG5vcm1hbGl6ZVxuICogQHJldHVybnMge3ZlYzN9IG91dFxuICovXG52ZWMzLm5vcm1hbGl6ZSA9IGZ1bmN0aW9uKG91dCwgYSkge1xuICAgIHZhciB4ID0gYVswXSxcbiAgICAgICAgeSA9IGFbMV0sXG4gICAgICAgIHogPSBhWzJdO1xuICAgIHZhciBsZW4gPSB4KnggKyB5KnkgKyB6Kno7XG4gICAgaWYgKGxlbiA+IDApIHtcbiAgICAgICAgLy9UT0RPOiBldmFsdWF0ZSB1c2Ugb2YgZ2xtX2ludnNxcnQgaGVyZT9cbiAgICAgICAgbGVuID0gMSAvIE1hdGguc3FydChsZW4pO1xuICAgICAgICBvdXRbMF0gPSBhWzBdICogbGVuO1xuICAgICAgICBvdXRbMV0gPSBhWzFdICogbGVuO1xuICAgICAgICBvdXRbMl0gPSBhWzJdICogbGVuO1xuICAgIH1cbiAgICByZXR1cm4gb3V0O1xufTtcblxuLyoqXG4gKiBDYWxjdWxhdGVzIHRoZSBkb3QgcHJvZHVjdCBvZiB0d28gdmVjMydzXG4gKlxuICogQHBhcmFtIHt2ZWMzfSBhIHRoZSBmaXJzdCBvcGVyYW5kXG4gKiBAcGFyYW0ge3ZlYzN9IGIgdGhlIHNlY29uZCBvcGVyYW5kXG4gKiBAcmV0dXJucyB7TnVtYmVyfSBkb3QgcHJvZHVjdCBvZiBhIGFuZCBiXG4gKi9cbnZlYzMuZG90ID0gZnVuY3Rpb24gKGEsIGIpIHtcbiAgICByZXR1cm4gYVswXSAqIGJbMF0gKyBhWzFdICogYlsxXSArIGFbMl0gKiBiWzJdO1xufTtcblxuLyoqXG4gKiBDb21wdXRlcyB0aGUgY3Jvc3MgcHJvZHVjdCBvZiB0d28gdmVjMydzXG4gKlxuICogQHBhcmFtIHt2ZWMzfSBvdXQgdGhlIHJlY2VpdmluZyB2ZWN0b3JcbiAqIEBwYXJhbSB7dmVjM30gYSB0aGUgZmlyc3Qgb3BlcmFuZFxuICogQHBhcmFtIHt2ZWMzfSBiIHRoZSBzZWNvbmQgb3BlcmFuZFxuICogQHJldHVybnMge3ZlYzN9IG91dFxuICovXG52ZWMzLmNyb3NzID0gZnVuY3Rpb24ob3V0LCBhLCBiKSB7XG4gICAgdmFyIGF4ID0gYVswXSwgYXkgPSBhWzFdLCBheiA9IGFbMl0sXG4gICAgICAgIGJ4ID0gYlswXSwgYnkgPSBiWzFdLCBieiA9IGJbMl07XG5cbiAgICBvdXRbMF0gPSBheSAqIGJ6IC0gYXogKiBieTtcbiAgICBvdXRbMV0gPSBheiAqIGJ4IC0gYXggKiBiejtcbiAgICBvdXRbMl0gPSBheCAqIGJ5IC0gYXkgKiBieDtcbiAgICByZXR1cm4gb3V0O1xufTtcblxuLyoqXG4gKiBQZXJmb3JtcyBhIGxpbmVhciBpbnRlcnBvbGF0aW9uIGJldHdlZW4gdHdvIHZlYzMnc1xuICpcbiAqIEBwYXJhbSB7dmVjM30gb3V0IHRoZSByZWNlaXZpbmcgdmVjdG9yXG4gKiBAcGFyYW0ge3ZlYzN9IGEgdGhlIGZpcnN0IG9wZXJhbmRcbiAqIEBwYXJhbSB7dmVjM30gYiB0aGUgc2Vjb25kIG9wZXJhbmRcbiAqIEBwYXJhbSB7TnVtYmVyfSB0IGludGVycG9sYXRpb24gYW1vdW50IGJldHdlZW4gdGhlIHR3byBpbnB1dHNcbiAqIEByZXR1cm5zIHt2ZWMzfSBvdXRcbiAqL1xudmVjMy5sZXJwID0gZnVuY3Rpb24gKG91dCwgYSwgYiwgdCkge1xuICAgIHZhciBheCA9IGFbMF0sXG4gICAgICAgIGF5ID0gYVsxXSxcbiAgICAgICAgYXogPSBhWzJdO1xuICAgIG91dFswXSA9IGF4ICsgdCAqIChiWzBdIC0gYXgpO1xuICAgIG91dFsxXSA9IGF5ICsgdCAqIChiWzFdIC0gYXkpO1xuICAgIG91dFsyXSA9IGF6ICsgdCAqIChiWzJdIC0gYXopO1xuICAgIHJldHVybiBvdXQ7XG59O1xuXG4vKipcbiAqIFBlcmZvcm1zIGEgaGVybWl0ZSBpbnRlcnBvbGF0aW9uIHdpdGggdHdvIGNvbnRyb2wgcG9pbnRzXG4gKlxuICogQHBhcmFtIHt2ZWMzfSBvdXQgdGhlIHJlY2VpdmluZyB2ZWN0b3JcbiAqIEBwYXJhbSB7dmVjM30gYSB0aGUgZmlyc3Qgb3BlcmFuZFxuICogQHBhcmFtIHt2ZWMzfSBiIHRoZSBzZWNvbmQgb3BlcmFuZFxuICogQHBhcmFtIHt2ZWMzfSBjIHRoZSB0aGlyZCBvcGVyYW5kXG4gKiBAcGFyYW0ge3ZlYzN9IGQgdGhlIGZvdXJ0aCBvcGVyYW5kXG4gKiBAcGFyYW0ge051bWJlcn0gdCBpbnRlcnBvbGF0aW9uIGFtb3VudCBiZXR3ZWVuIHRoZSB0d28gaW5wdXRzXG4gKiBAcmV0dXJucyB7dmVjM30gb3V0XG4gKi9cbnZlYzMuaGVybWl0ZSA9IGZ1bmN0aW9uIChvdXQsIGEsIGIsIGMsIGQsIHQpIHtcbiAgdmFyIGZhY3RvclRpbWVzMiA9IHQgKiB0LFxuICAgICAgZmFjdG9yMSA9IGZhY3RvclRpbWVzMiAqICgyICogdCAtIDMpICsgMSxcbiAgICAgIGZhY3RvcjIgPSBmYWN0b3JUaW1lczIgKiAodCAtIDIpICsgdCxcbiAgICAgIGZhY3RvcjMgPSBmYWN0b3JUaW1lczIgKiAodCAtIDEpLFxuICAgICAgZmFjdG9yNCA9IGZhY3RvclRpbWVzMiAqICgzIC0gMiAqIHQpO1xuICBcbiAgb3V0WzBdID0gYVswXSAqIGZhY3RvcjEgKyBiWzBdICogZmFjdG9yMiArIGNbMF0gKiBmYWN0b3IzICsgZFswXSAqIGZhY3RvcjQ7XG4gIG91dFsxXSA9IGFbMV0gKiBmYWN0b3IxICsgYlsxXSAqIGZhY3RvcjIgKyBjWzFdICogZmFjdG9yMyArIGRbMV0gKiBmYWN0b3I0O1xuICBvdXRbMl0gPSBhWzJdICogZmFjdG9yMSArIGJbMl0gKiBmYWN0b3IyICsgY1syXSAqIGZhY3RvcjMgKyBkWzJdICogZmFjdG9yNDtcbiAgXG4gIHJldHVybiBvdXQ7XG59O1xuXG4vKipcbiAqIFBlcmZvcm1zIGEgYmV6aWVyIGludGVycG9sYXRpb24gd2l0aCB0d28gY29udHJvbCBwb2ludHNcbiAqXG4gKiBAcGFyYW0ge3ZlYzN9IG91dCB0aGUgcmVjZWl2aW5nIHZlY3RvclxuICogQHBhcmFtIHt2ZWMzfSBhIHRoZSBmaXJzdCBvcGVyYW5kXG4gKiBAcGFyYW0ge3ZlYzN9IGIgdGhlIHNlY29uZCBvcGVyYW5kXG4gKiBAcGFyYW0ge3ZlYzN9IGMgdGhlIHRoaXJkIG9wZXJhbmRcbiAqIEBwYXJhbSB7dmVjM30gZCB0aGUgZm91cnRoIG9wZXJhbmRcbiAqIEBwYXJhbSB7TnVtYmVyfSB0IGludGVycG9sYXRpb24gYW1vdW50IGJldHdlZW4gdGhlIHR3byBpbnB1dHNcbiAqIEByZXR1cm5zIHt2ZWMzfSBvdXRcbiAqL1xudmVjMy5iZXppZXIgPSBmdW5jdGlvbiAob3V0LCBhLCBiLCBjLCBkLCB0KSB7XG4gIHZhciBpbnZlcnNlRmFjdG9yID0gMSAtIHQsXG4gICAgICBpbnZlcnNlRmFjdG9yVGltZXNUd28gPSBpbnZlcnNlRmFjdG9yICogaW52ZXJzZUZhY3RvcixcbiAgICAgIGZhY3RvclRpbWVzMiA9IHQgKiB0LFxuICAgICAgZmFjdG9yMSA9IGludmVyc2VGYWN0b3JUaW1lc1R3byAqIGludmVyc2VGYWN0b3IsXG4gICAgICBmYWN0b3IyID0gMyAqIHQgKiBpbnZlcnNlRmFjdG9yVGltZXNUd28sXG4gICAgICBmYWN0b3IzID0gMyAqIGZhY3RvclRpbWVzMiAqIGludmVyc2VGYWN0b3IsXG4gICAgICBmYWN0b3I0ID0gZmFjdG9yVGltZXMyICogdDtcbiAgXG4gIG91dFswXSA9IGFbMF0gKiBmYWN0b3IxICsgYlswXSAqIGZhY3RvcjIgKyBjWzBdICogZmFjdG9yMyArIGRbMF0gKiBmYWN0b3I0O1xuICBvdXRbMV0gPSBhWzFdICogZmFjdG9yMSArIGJbMV0gKiBmYWN0b3IyICsgY1sxXSAqIGZhY3RvcjMgKyBkWzFdICogZmFjdG9yNDtcbiAgb3V0WzJdID0gYVsyXSAqIGZhY3RvcjEgKyBiWzJdICogZmFjdG9yMiArIGNbMl0gKiBmYWN0b3IzICsgZFsyXSAqIGZhY3RvcjQ7XG4gIFxuICByZXR1cm4gb3V0O1xufTtcblxuLyoqXG4gKiBHZW5lcmF0ZXMgYSByYW5kb20gdmVjdG9yIHdpdGggdGhlIGdpdmVuIHNjYWxlXG4gKlxuICogQHBhcmFtIHt2ZWMzfSBvdXQgdGhlIHJlY2VpdmluZyB2ZWN0b3JcbiAqIEBwYXJhbSB7TnVtYmVyfSBbc2NhbGVdIExlbmd0aCBvZiB0aGUgcmVzdWx0aW5nIHZlY3Rvci4gSWYgb21taXR0ZWQsIGEgdW5pdCB2ZWN0b3Igd2lsbCBiZSByZXR1cm5lZFxuICogQHJldHVybnMge3ZlYzN9IG91dFxuICovXG52ZWMzLnJhbmRvbSA9IGZ1bmN0aW9uIChvdXQsIHNjYWxlKSB7XG4gICAgc2NhbGUgPSBzY2FsZSB8fCAxLjA7XG5cbiAgICB2YXIgciA9IGdsTWF0cml4LlJBTkRPTSgpICogMi4wICogTWF0aC5QSTtcbiAgICB2YXIgeiA9IChnbE1hdHJpeC5SQU5ET00oKSAqIDIuMCkgLSAxLjA7XG4gICAgdmFyIHpTY2FsZSA9IE1hdGguc3FydCgxLjAteip6KSAqIHNjYWxlO1xuXG4gICAgb3V0WzBdID0gTWF0aC5jb3MocikgKiB6U2NhbGU7XG4gICAgb3V0WzFdID0gTWF0aC5zaW4ocikgKiB6U2NhbGU7XG4gICAgb3V0WzJdID0geiAqIHNjYWxlO1xuICAgIHJldHVybiBvdXQ7XG59O1xuXG4vKipcbiAqIFRyYW5zZm9ybXMgdGhlIHZlYzMgd2l0aCBhIG1hdDQuXG4gKiA0dGggdmVjdG9yIGNvbXBvbmVudCBpcyBpbXBsaWNpdGx5ICcxJ1xuICpcbiAqIEBwYXJhbSB7dmVjM30gb3V0IHRoZSByZWNlaXZpbmcgdmVjdG9yXG4gKiBAcGFyYW0ge3ZlYzN9IGEgdGhlIHZlY3RvciB0byB0cmFuc2Zvcm1cbiAqIEBwYXJhbSB7bWF0NH0gbSBtYXRyaXggdG8gdHJhbnNmb3JtIHdpdGhcbiAqIEByZXR1cm5zIHt2ZWMzfSBvdXRcbiAqL1xudmVjMy50cmFuc2Zvcm1NYXQ0ID0gZnVuY3Rpb24ob3V0LCBhLCBtKSB7XG4gICAgdmFyIHggPSBhWzBdLCB5ID0gYVsxXSwgeiA9IGFbMl0sXG4gICAgICAgIHcgPSBtWzNdICogeCArIG1bN10gKiB5ICsgbVsxMV0gKiB6ICsgbVsxNV07XG4gICAgdyA9IHcgfHwgMS4wO1xuICAgIG91dFswXSA9IChtWzBdICogeCArIG1bNF0gKiB5ICsgbVs4XSAqIHogKyBtWzEyXSkgLyB3O1xuICAgIG91dFsxXSA9IChtWzFdICogeCArIG1bNV0gKiB5ICsgbVs5XSAqIHogKyBtWzEzXSkgLyB3O1xuICAgIG91dFsyXSA9IChtWzJdICogeCArIG1bNl0gKiB5ICsgbVsxMF0gKiB6ICsgbVsxNF0pIC8gdztcbiAgICByZXR1cm4gb3V0O1xufTtcblxuLyoqXG4gKiBUcmFuc2Zvcm1zIHRoZSB2ZWMzIHdpdGggYSBtYXQzLlxuICpcbiAqIEBwYXJhbSB7dmVjM30gb3V0IHRoZSByZWNlaXZpbmcgdmVjdG9yXG4gKiBAcGFyYW0ge3ZlYzN9IGEgdGhlIHZlY3RvciB0byB0cmFuc2Zvcm1cbiAqIEBwYXJhbSB7bWF0NH0gbSB0aGUgM3gzIG1hdHJpeCB0byB0cmFuc2Zvcm0gd2l0aFxuICogQHJldHVybnMge3ZlYzN9IG91dFxuICovXG52ZWMzLnRyYW5zZm9ybU1hdDMgPSBmdW5jdGlvbihvdXQsIGEsIG0pIHtcbiAgICB2YXIgeCA9IGFbMF0sIHkgPSBhWzFdLCB6ID0gYVsyXTtcbiAgICBvdXRbMF0gPSB4ICogbVswXSArIHkgKiBtWzNdICsgeiAqIG1bNl07XG4gICAgb3V0WzFdID0geCAqIG1bMV0gKyB5ICogbVs0XSArIHogKiBtWzddO1xuICAgIG91dFsyXSA9IHggKiBtWzJdICsgeSAqIG1bNV0gKyB6ICogbVs4XTtcbiAgICByZXR1cm4gb3V0O1xufTtcblxuLyoqXG4gKiBUcmFuc2Zvcm1zIHRoZSB2ZWMzIHdpdGggYSBxdWF0XG4gKlxuICogQHBhcmFtIHt2ZWMzfSBvdXQgdGhlIHJlY2VpdmluZyB2ZWN0b3JcbiAqIEBwYXJhbSB7dmVjM30gYSB0aGUgdmVjdG9yIHRvIHRyYW5zZm9ybVxuICogQHBhcmFtIHtxdWF0fSBxIHF1YXRlcm5pb24gdG8gdHJhbnNmb3JtIHdpdGhcbiAqIEByZXR1cm5zIHt2ZWMzfSBvdXRcbiAqL1xudmVjMy50cmFuc2Zvcm1RdWF0ID0gZnVuY3Rpb24ob3V0LCBhLCBxKSB7XG4gICAgLy8gYmVuY2htYXJrczogaHR0cDovL2pzcGVyZi5jb20vcXVhdGVybmlvbi10cmFuc2Zvcm0tdmVjMy1pbXBsZW1lbnRhdGlvbnNcblxuICAgIHZhciB4ID0gYVswXSwgeSA9IGFbMV0sIHogPSBhWzJdLFxuICAgICAgICBxeCA9IHFbMF0sIHF5ID0gcVsxXSwgcXogPSBxWzJdLCBxdyA9IHFbM10sXG5cbiAgICAgICAgLy8gY2FsY3VsYXRlIHF1YXQgKiB2ZWNcbiAgICAgICAgaXggPSBxdyAqIHggKyBxeSAqIHogLSBxeiAqIHksXG4gICAgICAgIGl5ID0gcXcgKiB5ICsgcXogKiB4IC0gcXggKiB6LFxuICAgICAgICBpeiA9IHF3ICogeiArIHF4ICogeSAtIHF5ICogeCxcbiAgICAgICAgaXcgPSAtcXggKiB4IC0gcXkgKiB5IC0gcXogKiB6O1xuXG4gICAgLy8gY2FsY3VsYXRlIHJlc3VsdCAqIGludmVyc2UgcXVhdFxuICAgIG91dFswXSA9IGl4ICogcXcgKyBpdyAqIC1xeCArIGl5ICogLXF6IC0gaXogKiAtcXk7XG4gICAgb3V0WzFdID0gaXkgKiBxdyArIGl3ICogLXF5ICsgaXogKiAtcXggLSBpeCAqIC1xejtcbiAgICBvdXRbMl0gPSBpeiAqIHF3ICsgaXcgKiAtcXogKyBpeCAqIC1xeSAtIGl5ICogLXF4O1xuICAgIHJldHVybiBvdXQ7XG59O1xuXG4vKipcbiAqIFJvdGF0ZSBhIDNEIHZlY3RvciBhcm91bmQgdGhlIHgtYXhpc1xuICogQHBhcmFtIHt2ZWMzfSBvdXQgVGhlIHJlY2VpdmluZyB2ZWMzXG4gKiBAcGFyYW0ge3ZlYzN9IGEgVGhlIHZlYzMgcG9pbnQgdG8gcm90YXRlXG4gKiBAcGFyYW0ge3ZlYzN9IGIgVGhlIG9yaWdpbiBvZiB0aGUgcm90YXRpb25cbiAqIEBwYXJhbSB7TnVtYmVyfSBjIFRoZSBhbmdsZSBvZiByb3RhdGlvblxuICogQHJldHVybnMge3ZlYzN9IG91dFxuICovXG52ZWMzLnJvdGF0ZVggPSBmdW5jdGlvbihvdXQsIGEsIGIsIGMpe1xuICAgdmFyIHAgPSBbXSwgcj1bXTtcblx0ICAvL1RyYW5zbGF0ZSBwb2ludCB0byB0aGUgb3JpZ2luXG5cdCAgcFswXSA9IGFbMF0gLSBiWzBdO1xuXHQgIHBbMV0gPSBhWzFdIC0gYlsxXTtcbiAgXHRwWzJdID0gYVsyXSAtIGJbMl07XG5cblx0ICAvL3BlcmZvcm0gcm90YXRpb25cblx0ICByWzBdID0gcFswXTtcblx0ICByWzFdID0gcFsxXSpNYXRoLmNvcyhjKSAtIHBbMl0qTWF0aC5zaW4oYyk7XG5cdCAgclsyXSA9IHBbMV0qTWF0aC5zaW4oYykgKyBwWzJdKk1hdGguY29zKGMpO1xuXG5cdCAgLy90cmFuc2xhdGUgdG8gY29ycmVjdCBwb3NpdGlvblxuXHQgIG91dFswXSA9IHJbMF0gKyBiWzBdO1xuXHQgIG91dFsxXSA9IHJbMV0gKyBiWzFdO1xuXHQgIG91dFsyXSA9IHJbMl0gKyBiWzJdO1xuXG4gIFx0cmV0dXJuIG91dDtcbn07XG5cbi8qKlxuICogUm90YXRlIGEgM0QgdmVjdG9yIGFyb3VuZCB0aGUgeS1heGlzXG4gKiBAcGFyYW0ge3ZlYzN9IG91dCBUaGUgcmVjZWl2aW5nIHZlYzNcbiAqIEBwYXJhbSB7dmVjM30gYSBUaGUgdmVjMyBwb2ludCB0byByb3RhdGVcbiAqIEBwYXJhbSB7dmVjM30gYiBUaGUgb3JpZ2luIG9mIHRoZSByb3RhdGlvblxuICogQHBhcmFtIHtOdW1iZXJ9IGMgVGhlIGFuZ2xlIG9mIHJvdGF0aW9uXG4gKiBAcmV0dXJucyB7dmVjM30gb3V0XG4gKi9cbnZlYzMucm90YXRlWSA9IGZ1bmN0aW9uKG91dCwgYSwgYiwgYyl7XG4gIFx0dmFyIHAgPSBbXSwgcj1bXTtcbiAgXHQvL1RyYW5zbGF0ZSBwb2ludCB0byB0aGUgb3JpZ2luXG4gIFx0cFswXSA9IGFbMF0gLSBiWzBdO1xuICBcdHBbMV0gPSBhWzFdIC0gYlsxXTtcbiAgXHRwWzJdID0gYVsyXSAtIGJbMl07XG4gIFxuICBcdC8vcGVyZm9ybSByb3RhdGlvblxuICBcdHJbMF0gPSBwWzJdKk1hdGguc2luKGMpICsgcFswXSpNYXRoLmNvcyhjKTtcbiAgXHRyWzFdID0gcFsxXTtcbiAgXHRyWzJdID0gcFsyXSpNYXRoLmNvcyhjKSAtIHBbMF0qTWF0aC5zaW4oYyk7XG4gIFxuICBcdC8vdHJhbnNsYXRlIHRvIGNvcnJlY3QgcG9zaXRpb25cbiAgXHRvdXRbMF0gPSByWzBdICsgYlswXTtcbiAgXHRvdXRbMV0gPSByWzFdICsgYlsxXTtcbiAgXHRvdXRbMl0gPSByWzJdICsgYlsyXTtcbiAgXG4gIFx0cmV0dXJuIG91dDtcbn07XG5cbi8qKlxuICogUm90YXRlIGEgM0QgdmVjdG9yIGFyb3VuZCB0aGUgei1heGlzXG4gKiBAcGFyYW0ge3ZlYzN9IG91dCBUaGUgcmVjZWl2aW5nIHZlYzNcbiAqIEBwYXJhbSB7dmVjM30gYSBUaGUgdmVjMyBwb2ludCB0byByb3RhdGVcbiAqIEBwYXJhbSB7dmVjM30gYiBUaGUgb3JpZ2luIG9mIHRoZSByb3RhdGlvblxuICogQHBhcmFtIHtOdW1iZXJ9IGMgVGhlIGFuZ2xlIG9mIHJvdGF0aW9uXG4gKiBAcmV0dXJucyB7dmVjM30gb3V0XG4gKi9cbnZlYzMucm90YXRlWiA9IGZ1bmN0aW9uKG91dCwgYSwgYiwgYyl7XG4gIFx0dmFyIHAgPSBbXSwgcj1bXTtcbiAgXHQvL1RyYW5zbGF0ZSBwb2ludCB0byB0aGUgb3JpZ2luXG4gIFx0cFswXSA9IGFbMF0gLSBiWzBdO1xuICBcdHBbMV0gPSBhWzFdIC0gYlsxXTtcbiAgXHRwWzJdID0gYVsyXSAtIGJbMl07XG4gIFxuICBcdC8vcGVyZm9ybSByb3RhdGlvblxuICBcdHJbMF0gPSBwWzBdKk1hdGguY29zKGMpIC0gcFsxXSpNYXRoLnNpbihjKTtcbiAgXHRyWzFdID0gcFswXSpNYXRoLnNpbihjKSArIHBbMV0qTWF0aC5jb3MoYyk7XG4gIFx0clsyXSA9IHBbMl07XG4gIFxuICBcdC8vdHJhbnNsYXRlIHRvIGNvcnJlY3QgcG9zaXRpb25cbiAgXHRvdXRbMF0gPSByWzBdICsgYlswXTtcbiAgXHRvdXRbMV0gPSByWzFdICsgYlsxXTtcbiAgXHRvdXRbMl0gPSByWzJdICsgYlsyXTtcbiAgXG4gIFx0cmV0dXJuIG91dDtcbn07XG5cbi8qKlxuICogUGVyZm9ybSBzb21lIG9wZXJhdGlvbiBvdmVyIGFuIGFycmF5IG9mIHZlYzNzLlxuICpcbiAqIEBwYXJhbSB7QXJyYXl9IGEgdGhlIGFycmF5IG9mIHZlY3RvcnMgdG8gaXRlcmF0ZSBvdmVyXG4gKiBAcGFyYW0ge051bWJlcn0gc3RyaWRlIE51bWJlciBvZiBlbGVtZW50cyBiZXR3ZWVuIHRoZSBzdGFydCBvZiBlYWNoIHZlYzMuIElmIDAgYXNzdW1lcyB0aWdodGx5IHBhY2tlZFxuICogQHBhcmFtIHtOdW1iZXJ9IG9mZnNldCBOdW1iZXIgb2YgZWxlbWVudHMgdG8gc2tpcCBhdCB0aGUgYmVnaW5uaW5nIG9mIHRoZSBhcnJheVxuICogQHBhcmFtIHtOdW1iZXJ9IGNvdW50IE51bWJlciBvZiB2ZWMzcyB0byBpdGVyYXRlIG92ZXIuIElmIDAgaXRlcmF0ZXMgb3ZlciBlbnRpcmUgYXJyYXlcbiAqIEBwYXJhbSB7RnVuY3Rpb259IGZuIEZ1bmN0aW9uIHRvIGNhbGwgZm9yIGVhY2ggdmVjdG9yIGluIHRoZSBhcnJheVxuICogQHBhcmFtIHtPYmplY3R9IFthcmddIGFkZGl0aW9uYWwgYXJndW1lbnQgdG8gcGFzcyB0byBmblxuICogQHJldHVybnMge0FycmF5fSBhXG4gKiBAZnVuY3Rpb25cbiAqL1xudmVjMy5mb3JFYWNoID0gKGZ1bmN0aW9uKCkge1xuICAgIHZhciB2ZWMgPSB2ZWMzLmNyZWF0ZSgpO1xuXG4gICAgcmV0dXJuIGZ1bmN0aW9uKGEsIHN0cmlkZSwgb2Zmc2V0LCBjb3VudCwgZm4sIGFyZykge1xuICAgICAgICB2YXIgaSwgbDtcbiAgICAgICAgaWYoIXN0cmlkZSkge1xuICAgICAgICAgICAgc3RyaWRlID0gMztcbiAgICAgICAgfVxuXG4gICAgICAgIGlmKCFvZmZzZXQpIHtcbiAgICAgICAgICAgIG9mZnNldCA9IDA7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIGlmKGNvdW50KSB7XG4gICAgICAgICAgICBsID0gTWF0aC5taW4oKGNvdW50ICogc3RyaWRlKSArIG9mZnNldCwgYS5sZW5ndGgpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgbCA9IGEubGVuZ3RoO1xuICAgICAgICB9XG5cbiAgICAgICAgZm9yKGkgPSBvZmZzZXQ7IGkgPCBsOyBpICs9IHN0cmlkZSkge1xuICAgICAgICAgICAgdmVjWzBdID0gYVtpXTsgdmVjWzFdID0gYVtpKzFdOyB2ZWNbMl0gPSBhW2krMl07XG4gICAgICAgICAgICBmbih2ZWMsIHZlYywgYXJnKTtcbiAgICAgICAgICAgIGFbaV0gPSB2ZWNbMF07IGFbaSsxXSA9IHZlY1sxXTsgYVtpKzJdID0gdmVjWzJdO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICByZXR1cm4gYTtcbiAgICB9O1xufSkoKTtcblxuLyoqXG4gKiBHZXQgdGhlIGFuZ2xlIGJldHdlZW4gdHdvIDNEIHZlY3RvcnNcbiAqIEBwYXJhbSB7dmVjM30gYSBUaGUgZmlyc3Qgb3BlcmFuZFxuICogQHBhcmFtIHt2ZWMzfSBiIFRoZSBzZWNvbmQgb3BlcmFuZFxuICogQHJldHVybnMge051bWJlcn0gVGhlIGFuZ2xlIGluIHJhZGlhbnNcbiAqL1xudmVjMy5hbmdsZSA9IGZ1bmN0aW9uKGEsIGIpIHtcbiAgIFxuICAgIHZhciB0ZW1wQSA9IHZlYzMuZnJvbVZhbHVlcyhhWzBdLCBhWzFdLCBhWzJdKTtcbiAgICB2YXIgdGVtcEIgPSB2ZWMzLmZyb21WYWx1ZXMoYlswXSwgYlsxXSwgYlsyXSk7XG4gXG4gICAgdmVjMy5ub3JtYWxpemUodGVtcEEsIHRlbXBBKTtcbiAgICB2ZWMzLm5vcm1hbGl6ZSh0ZW1wQiwgdGVtcEIpO1xuIFxuICAgIHZhciBjb3NpbmUgPSB2ZWMzLmRvdCh0ZW1wQSwgdGVtcEIpO1xuXG4gICAgaWYoY29zaW5lID4gMS4wKXtcbiAgICAgICAgcmV0dXJuIDA7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIE1hdGguYWNvcyhjb3NpbmUpO1xuICAgIH0gICAgIFxufTtcblxuLyoqXG4gKiBSZXR1cm5zIGEgc3RyaW5nIHJlcHJlc2VudGF0aW9uIG9mIGEgdmVjdG9yXG4gKlxuICogQHBhcmFtIHt2ZWMzfSB2ZWMgdmVjdG9yIHRvIHJlcHJlc2VudCBhcyBhIHN0cmluZ1xuICogQHJldHVybnMge1N0cmluZ30gc3RyaW5nIHJlcHJlc2VudGF0aW9uIG9mIHRoZSB2ZWN0b3JcbiAqL1xudmVjMy5zdHIgPSBmdW5jdGlvbiAoYSkge1xuICAgIHJldHVybiAndmVjMygnICsgYVswXSArICcsICcgKyBhWzFdICsgJywgJyArIGFbMl0gKyAnKSc7XG59O1xuXG4vKipcbiAqIFJldHVybnMgd2hldGhlciBvciBub3QgdGhlIHZlY3RvcnMgaGF2ZSBleGFjdGx5IHRoZSBzYW1lIGVsZW1lbnRzIGluIHRoZSBzYW1lIHBvc2l0aW9uICh3aGVuIGNvbXBhcmVkIHdpdGggPT09KVxuICpcbiAqIEBwYXJhbSB7dmVjM30gYSBUaGUgZmlyc3QgdmVjdG9yLlxuICogQHBhcmFtIHt2ZWMzfSBiIFRoZSBzZWNvbmQgdmVjdG9yLlxuICogQHJldHVybnMge0Jvb2xlYW59IFRydWUgaWYgdGhlIHZlY3RvcnMgYXJlIGVxdWFsLCBmYWxzZSBvdGhlcndpc2UuXG4gKi9cbnZlYzMuZXhhY3RFcXVhbHMgPSBmdW5jdGlvbiAoYSwgYikge1xuICAgIHJldHVybiBhWzBdID09PSBiWzBdICYmIGFbMV0gPT09IGJbMV0gJiYgYVsyXSA9PT0gYlsyXTtcbn07XG5cbi8qKlxuICogUmV0dXJucyB3aGV0aGVyIG9yIG5vdCB0aGUgdmVjdG9ycyBoYXZlIGFwcHJveGltYXRlbHkgdGhlIHNhbWUgZWxlbWVudHMgaW4gdGhlIHNhbWUgcG9zaXRpb24uXG4gKlxuICogQHBhcmFtIHt2ZWMzfSBhIFRoZSBmaXJzdCB2ZWN0b3IuXG4gKiBAcGFyYW0ge3ZlYzN9IGIgVGhlIHNlY29uZCB2ZWN0b3IuXG4gKiBAcmV0dXJucyB7Qm9vbGVhbn0gVHJ1ZSBpZiB0aGUgdmVjdG9ycyBhcmUgZXF1YWwsIGZhbHNlIG90aGVyd2lzZS5cbiAqL1xudmVjMy5lcXVhbHMgPSBmdW5jdGlvbiAoYSwgYikge1xuICAgIHZhciBhMCA9IGFbMF0sIGExID0gYVsxXSwgYTIgPSBhWzJdO1xuICAgIHZhciBiMCA9IGJbMF0sIGIxID0gYlsxXSwgYjIgPSBiWzJdO1xuICAgIHJldHVybiAoTWF0aC5hYnMoYTAgLSBiMCkgPD0gZ2xNYXRyaXguRVBTSUxPTipNYXRoLm1heCgxLjAsIE1hdGguYWJzKGEwKSwgTWF0aC5hYnMoYjApKSAmJlxuICAgICAgICAgICAgTWF0aC5hYnMoYTEgLSBiMSkgPD0gZ2xNYXRyaXguRVBTSUxPTipNYXRoLm1heCgxLjAsIE1hdGguYWJzKGExKSwgTWF0aC5hYnMoYjEpKSAmJlxuICAgICAgICAgICAgTWF0aC5hYnMoYTIgLSBiMikgPD0gZ2xNYXRyaXguRVBTSUxPTipNYXRoLm1heCgxLjAsIE1hdGguYWJzKGEyKSwgTWF0aC5hYnMoYjIpKSk7XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IHZlYzM7XG4iLCIvKiBDb3B5cmlnaHQgKGMpIDIwMTUsIEJyYW5kb24gSm9uZXMsIENvbGluIE1hY0tlbnppZSBJVi5cblxuUGVybWlzc2lvbiBpcyBoZXJlYnkgZ3JhbnRlZCwgZnJlZSBvZiBjaGFyZ2UsIHRvIGFueSBwZXJzb24gb2J0YWluaW5nIGEgY29weVxub2YgdGhpcyBzb2Z0d2FyZSBhbmQgYXNzb2NpYXRlZCBkb2N1bWVudGF0aW9uIGZpbGVzICh0aGUgXCJTb2Z0d2FyZVwiKSwgdG8gZGVhbFxuaW4gdGhlIFNvZnR3YXJlIHdpdGhvdXQgcmVzdHJpY3Rpb24sIGluY2x1ZGluZyB3aXRob3V0IGxpbWl0YXRpb24gdGhlIHJpZ2h0c1xudG8gdXNlLCBjb3B5LCBtb2RpZnksIG1lcmdlLCBwdWJsaXNoLCBkaXN0cmlidXRlLCBzdWJsaWNlbnNlLCBhbmQvb3Igc2VsbFxuY29waWVzIG9mIHRoZSBTb2Z0d2FyZSwgYW5kIHRvIHBlcm1pdCBwZXJzb25zIHRvIHdob20gdGhlIFNvZnR3YXJlIGlzXG5mdXJuaXNoZWQgdG8gZG8gc28sIHN1YmplY3QgdG8gdGhlIGZvbGxvd2luZyBjb25kaXRpb25zOlxuXG5UaGUgYWJvdmUgY29weXJpZ2h0IG5vdGljZSBhbmQgdGhpcyBwZXJtaXNzaW9uIG5vdGljZSBzaGFsbCBiZSBpbmNsdWRlZCBpblxuYWxsIGNvcGllcyBvciBzdWJzdGFudGlhbCBwb3J0aW9ucyBvZiB0aGUgU29mdHdhcmUuXG5cblRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCBcIkFTIElTXCIsIFdJVEhPVVQgV0FSUkFOVFkgT0YgQU5ZIEtJTkQsIEVYUFJFU1MgT1JcbklNUExJRUQsIElOQ0xVRElORyBCVVQgTk9UIExJTUlURUQgVE8gVEhFIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZLFxuRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UgQU5EIE5PTklORlJJTkdFTUVOVC4gSU4gTk8gRVZFTlQgU0hBTEwgVEhFXG5BVVRIT1JTIE9SIENPUFlSSUdIVCBIT0xERVJTIEJFIExJQUJMRSBGT1IgQU5ZIENMQUlNLCBEQU1BR0VTIE9SIE9USEVSXG5MSUFCSUxJVFksIFdIRVRIRVIgSU4gQU4gQUNUSU9OIE9GIENPTlRSQUNULCBUT1JUIE9SIE9USEVSV0lTRSwgQVJJU0lORyBGUk9NLFxuT1VUIE9GIE9SIElOIENPTk5FQ1RJT04gV0lUSCBUSEUgU09GVFdBUkUgT1IgVEhFIFVTRSBPUiBPVEhFUiBERUFMSU5HUyBJTlxuVEhFIFNPRlRXQVJFLiAqL1xuXG52YXIgZ2xNYXRyaXggPSByZXF1aXJlKFwiLi9jb21tb24uanNcIik7XG5cbi8qKlxuICogQGNsYXNzIDQgRGltZW5zaW9uYWwgVmVjdG9yXG4gKiBAbmFtZSB2ZWM0XG4gKi9cbnZhciB2ZWM0ID0ge307XG5cbi8qKlxuICogQ3JlYXRlcyBhIG5ldywgZW1wdHkgdmVjNFxuICpcbiAqIEByZXR1cm5zIHt2ZWM0fSBhIG5ldyA0RCB2ZWN0b3JcbiAqL1xudmVjNC5jcmVhdGUgPSBmdW5jdGlvbigpIHtcbiAgICB2YXIgb3V0ID0gbmV3IGdsTWF0cml4LkFSUkFZX1RZUEUoNCk7XG4gICAgb3V0WzBdID0gMDtcbiAgICBvdXRbMV0gPSAwO1xuICAgIG91dFsyXSA9IDA7XG4gICAgb3V0WzNdID0gMDtcbiAgICByZXR1cm4gb3V0O1xufTtcblxuLyoqXG4gKiBDcmVhdGVzIGEgbmV3IHZlYzQgaW5pdGlhbGl6ZWQgd2l0aCB2YWx1ZXMgZnJvbSBhbiBleGlzdGluZyB2ZWN0b3JcbiAqXG4gKiBAcGFyYW0ge3ZlYzR9IGEgdmVjdG9yIHRvIGNsb25lXG4gKiBAcmV0dXJucyB7dmVjNH0gYSBuZXcgNEQgdmVjdG9yXG4gKi9cbnZlYzQuY2xvbmUgPSBmdW5jdGlvbihhKSB7XG4gICAgdmFyIG91dCA9IG5ldyBnbE1hdHJpeC5BUlJBWV9UWVBFKDQpO1xuICAgIG91dFswXSA9IGFbMF07XG4gICAgb3V0WzFdID0gYVsxXTtcbiAgICBvdXRbMl0gPSBhWzJdO1xuICAgIG91dFszXSA9IGFbM107XG4gICAgcmV0dXJuIG91dDtcbn07XG5cbi8qKlxuICogQ3JlYXRlcyBhIG5ldyB2ZWM0IGluaXRpYWxpemVkIHdpdGggdGhlIGdpdmVuIHZhbHVlc1xuICpcbiAqIEBwYXJhbSB7TnVtYmVyfSB4IFggY29tcG9uZW50XG4gKiBAcGFyYW0ge051bWJlcn0geSBZIGNvbXBvbmVudFxuICogQHBhcmFtIHtOdW1iZXJ9IHogWiBjb21wb25lbnRcbiAqIEBwYXJhbSB7TnVtYmVyfSB3IFcgY29tcG9uZW50XG4gKiBAcmV0dXJucyB7dmVjNH0gYSBuZXcgNEQgdmVjdG9yXG4gKi9cbnZlYzQuZnJvbVZhbHVlcyA9IGZ1bmN0aW9uKHgsIHksIHosIHcpIHtcbiAgICB2YXIgb3V0ID0gbmV3IGdsTWF0cml4LkFSUkFZX1RZUEUoNCk7XG4gICAgb3V0WzBdID0geDtcbiAgICBvdXRbMV0gPSB5O1xuICAgIG91dFsyXSA9IHo7XG4gICAgb3V0WzNdID0gdztcbiAgICByZXR1cm4gb3V0O1xufTtcblxuLyoqXG4gKiBDb3B5IHRoZSB2YWx1ZXMgZnJvbSBvbmUgdmVjNCB0byBhbm90aGVyXG4gKlxuICogQHBhcmFtIHt2ZWM0fSBvdXQgdGhlIHJlY2VpdmluZyB2ZWN0b3JcbiAqIEBwYXJhbSB7dmVjNH0gYSB0aGUgc291cmNlIHZlY3RvclxuICogQHJldHVybnMge3ZlYzR9IG91dFxuICovXG52ZWM0LmNvcHkgPSBmdW5jdGlvbihvdXQsIGEpIHtcbiAgICBvdXRbMF0gPSBhWzBdO1xuICAgIG91dFsxXSA9IGFbMV07XG4gICAgb3V0WzJdID0gYVsyXTtcbiAgICBvdXRbM10gPSBhWzNdO1xuICAgIHJldHVybiBvdXQ7XG59O1xuXG4vKipcbiAqIFNldCB0aGUgY29tcG9uZW50cyBvZiBhIHZlYzQgdG8gdGhlIGdpdmVuIHZhbHVlc1xuICpcbiAqIEBwYXJhbSB7dmVjNH0gb3V0IHRoZSByZWNlaXZpbmcgdmVjdG9yXG4gKiBAcGFyYW0ge051bWJlcn0geCBYIGNvbXBvbmVudFxuICogQHBhcmFtIHtOdW1iZXJ9IHkgWSBjb21wb25lbnRcbiAqIEBwYXJhbSB7TnVtYmVyfSB6IFogY29tcG9uZW50XG4gKiBAcGFyYW0ge051bWJlcn0gdyBXIGNvbXBvbmVudFxuICogQHJldHVybnMge3ZlYzR9IG91dFxuICovXG52ZWM0LnNldCA9IGZ1bmN0aW9uKG91dCwgeCwgeSwgeiwgdykge1xuICAgIG91dFswXSA9IHg7XG4gICAgb3V0WzFdID0geTtcbiAgICBvdXRbMl0gPSB6O1xuICAgIG91dFszXSA9IHc7XG4gICAgcmV0dXJuIG91dDtcbn07XG5cbi8qKlxuICogQWRkcyB0d28gdmVjNCdzXG4gKlxuICogQHBhcmFtIHt2ZWM0fSBvdXQgdGhlIHJlY2VpdmluZyB2ZWN0b3JcbiAqIEBwYXJhbSB7dmVjNH0gYSB0aGUgZmlyc3Qgb3BlcmFuZFxuICogQHBhcmFtIHt2ZWM0fSBiIHRoZSBzZWNvbmQgb3BlcmFuZFxuICogQHJldHVybnMge3ZlYzR9IG91dFxuICovXG52ZWM0LmFkZCA9IGZ1bmN0aW9uKG91dCwgYSwgYikge1xuICAgIG91dFswXSA9IGFbMF0gKyBiWzBdO1xuICAgIG91dFsxXSA9IGFbMV0gKyBiWzFdO1xuICAgIG91dFsyXSA9IGFbMl0gKyBiWzJdO1xuICAgIG91dFszXSA9IGFbM10gKyBiWzNdO1xuICAgIHJldHVybiBvdXQ7XG59O1xuXG4vKipcbiAqIFN1YnRyYWN0cyB2ZWN0b3IgYiBmcm9tIHZlY3RvciBhXG4gKlxuICogQHBhcmFtIHt2ZWM0fSBvdXQgdGhlIHJlY2VpdmluZyB2ZWN0b3JcbiAqIEBwYXJhbSB7dmVjNH0gYSB0aGUgZmlyc3Qgb3BlcmFuZFxuICogQHBhcmFtIHt2ZWM0fSBiIHRoZSBzZWNvbmQgb3BlcmFuZFxuICogQHJldHVybnMge3ZlYzR9IG91dFxuICovXG52ZWM0LnN1YnRyYWN0ID0gZnVuY3Rpb24ob3V0LCBhLCBiKSB7XG4gICAgb3V0WzBdID0gYVswXSAtIGJbMF07XG4gICAgb3V0WzFdID0gYVsxXSAtIGJbMV07XG4gICAgb3V0WzJdID0gYVsyXSAtIGJbMl07XG4gICAgb3V0WzNdID0gYVszXSAtIGJbM107XG4gICAgcmV0dXJuIG91dDtcbn07XG5cbi8qKlxuICogQWxpYXMgZm9yIHtAbGluayB2ZWM0LnN1YnRyYWN0fVxuICogQGZ1bmN0aW9uXG4gKi9cbnZlYzQuc3ViID0gdmVjNC5zdWJ0cmFjdDtcblxuLyoqXG4gKiBNdWx0aXBsaWVzIHR3byB2ZWM0J3NcbiAqXG4gKiBAcGFyYW0ge3ZlYzR9IG91dCB0aGUgcmVjZWl2aW5nIHZlY3RvclxuICogQHBhcmFtIHt2ZWM0fSBhIHRoZSBmaXJzdCBvcGVyYW5kXG4gKiBAcGFyYW0ge3ZlYzR9IGIgdGhlIHNlY29uZCBvcGVyYW5kXG4gKiBAcmV0dXJucyB7dmVjNH0gb3V0XG4gKi9cbnZlYzQubXVsdGlwbHkgPSBmdW5jdGlvbihvdXQsIGEsIGIpIHtcbiAgICBvdXRbMF0gPSBhWzBdICogYlswXTtcbiAgICBvdXRbMV0gPSBhWzFdICogYlsxXTtcbiAgICBvdXRbMl0gPSBhWzJdICogYlsyXTtcbiAgICBvdXRbM10gPSBhWzNdICogYlszXTtcbiAgICByZXR1cm4gb3V0O1xufTtcblxuLyoqXG4gKiBBbGlhcyBmb3Ige0BsaW5rIHZlYzQubXVsdGlwbHl9XG4gKiBAZnVuY3Rpb25cbiAqL1xudmVjNC5tdWwgPSB2ZWM0Lm11bHRpcGx5O1xuXG4vKipcbiAqIERpdmlkZXMgdHdvIHZlYzQnc1xuICpcbiAqIEBwYXJhbSB7dmVjNH0gb3V0IHRoZSByZWNlaXZpbmcgdmVjdG9yXG4gKiBAcGFyYW0ge3ZlYzR9IGEgdGhlIGZpcnN0IG9wZXJhbmRcbiAqIEBwYXJhbSB7dmVjNH0gYiB0aGUgc2Vjb25kIG9wZXJhbmRcbiAqIEByZXR1cm5zIHt2ZWM0fSBvdXRcbiAqL1xudmVjNC5kaXZpZGUgPSBmdW5jdGlvbihvdXQsIGEsIGIpIHtcbiAgICBvdXRbMF0gPSBhWzBdIC8gYlswXTtcbiAgICBvdXRbMV0gPSBhWzFdIC8gYlsxXTtcbiAgICBvdXRbMl0gPSBhWzJdIC8gYlsyXTtcbiAgICBvdXRbM10gPSBhWzNdIC8gYlszXTtcbiAgICByZXR1cm4gb3V0O1xufTtcblxuLyoqXG4gKiBBbGlhcyBmb3Ige0BsaW5rIHZlYzQuZGl2aWRlfVxuICogQGZ1bmN0aW9uXG4gKi9cbnZlYzQuZGl2ID0gdmVjNC5kaXZpZGU7XG5cbi8qKlxuICogTWF0aC5jZWlsIHRoZSBjb21wb25lbnRzIG9mIGEgdmVjNFxuICpcbiAqIEBwYXJhbSB7dmVjNH0gb3V0IHRoZSByZWNlaXZpbmcgdmVjdG9yXG4gKiBAcGFyYW0ge3ZlYzR9IGEgdmVjdG9yIHRvIGNlaWxcbiAqIEByZXR1cm5zIHt2ZWM0fSBvdXRcbiAqL1xudmVjNC5jZWlsID0gZnVuY3Rpb24gKG91dCwgYSkge1xuICAgIG91dFswXSA9IE1hdGguY2VpbChhWzBdKTtcbiAgICBvdXRbMV0gPSBNYXRoLmNlaWwoYVsxXSk7XG4gICAgb3V0WzJdID0gTWF0aC5jZWlsKGFbMl0pO1xuICAgIG91dFszXSA9IE1hdGguY2VpbChhWzNdKTtcbiAgICByZXR1cm4gb3V0O1xufTtcblxuLyoqXG4gKiBNYXRoLmZsb29yIHRoZSBjb21wb25lbnRzIG9mIGEgdmVjNFxuICpcbiAqIEBwYXJhbSB7dmVjNH0gb3V0IHRoZSByZWNlaXZpbmcgdmVjdG9yXG4gKiBAcGFyYW0ge3ZlYzR9IGEgdmVjdG9yIHRvIGZsb29yXG4gKiBAcmV0dXJucyB7dmVjNH0gb3V0XG4gKi9cbnZlYzQuZmxvb3IgPSBmdW5jdGlvbiAob3V0LCBhKSB7XG4gICAgb3V0WzBdID0gTWF0aC5mbG9vcihhWzBdKTtcbiAgICBvdXRbMV0gPSBNYXRoLmZsb29yKGFbMV0pO1xuICAgIG91dFsyXSA9IE1hdGguZmxvb3IoYVsyXSk7XG4gICAgb3V0WzNdID0gTWF0aC5mbG9vcihhWzNdKTtcbiAgICByZXR1cm4gb3V0O1xufTtcblxuLyoqXG4gKiBSZXR1cm5zIHRoZSBtaW5pbXVtIG9mIHR3byB2ZWM0J3NcbiAqXG4gKiBAcGFyYW0ge3ZlYzR9IG91dCB0aGUgcmVjZWl2aW5nIHZlY3RvclxuICogQHBhcmFtIHt2ZWM0fSBhIHRoZSBmaXJzdCBvcGVyYW5kXG4gKiBAcGFyYW0ge3ZlYzR9IGIgdGhlIHNlY29uZCBvcGVyYW5kXG4gKiBAcmV0dXJucyB7dmVjNH0gb3V0XG4gKi9cbnZlYzQubWluID0gZnVuY3Rpb24ob3V0LCBhLCBiKSB7XG4gICAgb3V0WzBdID0gTWF0aC5taW4oYVswXSwgYlswXSk7XG4gICAgb3V0WzFdID0gTWF0aC5taW4oYVsxXSwgYlsxXSk7XG4gICAgb3V0WzJdID0gTWF0aC5taW4oYVsyXSwgYlsyXSk7XG4gICAgb3V0WzNdID0gTWF0aC5taW4oYVszXSwgYlszXSk7XG4gICAgcmV0dXJuIG91dDtcbn07XG5cbi8qKlxuICogUmV0dXJucyB0aGUgbWF4aW11bSBvZiB0d28gdmVjNCdzXG4gKlxuICogQHBhcmFtIHt2ZWM0fSBvdXQgdGhlIHJlY2VpdmluZyB2ZWN0b3JcbiAqIEBwYXJhbSB7dmVjNH0gYSB0aGUgZmlyc3Qgb3BlcmFuZFxuICogQHBhcmFtIHt2ZWM0fSBiIHRoZSBzZWNvbmQgb3BlcmFuZFxuICogQHJldHVybnMge3ZlYzR9IG91dFxuICovXG52ZWM0Lm1heCA9IGZ1bmN0aW9uKG91dCwgYSwgYikge1xuICAgIG91dFswXSA9IE1hdGgubWF4KGFbMF0sIGJbMF0pO1xuICAgIG91dFsxXSA9IE1hdGgubWF4KGFbMV0sIGJbMV0pO1xuICAgIG91dFsyXSA9IE1hdGgubWF4KGFbMl0sIGJbMl0pO1xuICAgIG91dFszXSA9IE1hdGgubWF4KGFbM10sIGJbM10pO1xuICAgIHJldHVybiBvdXQ7XG59O1xuXG4vKipcbiAqIE1hdGgucm91bmQgdGhlIGNvbXBvbmVudHMgb2YgYSB2ZWM0XG4gKlxuICogQHBhcmFtIHt2ZWM0fSBvdXQgdGhlIHJlY2VpdmluZyB2ZWN0b3JcbiAqIEBwYXJhbSB7dmVjNH0gYSB2ZWN0b3IgdG8gcm91bmRcbiAqIEByZXR1cm5zIHt2ZWM0fSBvdXRcbiAqL1xudmVjNC5yb3VuZCA9IGZ1bmN0aW9uIChvdXQsIGEpIHtcbiAgICBvdXRbMF0gPSBNYXRoLnJvdW5kKGFbMF0pO1xuICAgIG91dFsxXSA9IE1hdGgucm91bmQoYVsxXSk7XG4gICAgb3V0WzJdID0gTWF0aC5yb3VuZChhWzJdKTtcbiAgICBvdXRbM10gPSBNYXRoLnJvdW5kKGFbM10pO1xuICAgIHJldHVybiBvdXQ7XG59O1xuXG4vKipcbiAqIFNjYWxlcyBhIHZlYzQgYnkgYSBzY2FsYXIgbnVtYmVyXG4gKlxuICogQHBhcmFtIHt2ZWM0fSBvdXQgdGhlIHJlY2VpdmluZyB2ZWN0b3JcbiAqIEBwYXJhbSB7dmVjNH0gYSB0aGUgdmVjdG9yIHRvIHNjYWxlXG4gKiBAcGFyYW0ge051bWJlcn0gYiBhbW91bnQgdG8gc2NhbGUgdGhlIHZlY3RvciBieVxuICogQHJldHVybnMge3ZlYzR9IG91dFxuICovXG52ZWM0LnNjYWxlID0gZnVuY3Rpb24ob3V0LCBhLCBiKSB7XG4gICAgb3V0WzBdID0gYVswXSAqIGI7XG4gICAgb3V0WzFdID0gYVsxXSAqIGI7XG4gICAgb3V0WzJdID0gYVsyXSAqIGI7XG4gICAgb3V0WzNdID0gYVszXSAqIGI7XG4gICAgcmV0dXJuIG91dDtcbn07XG5cbi8qKlxuICogQWRkcyB0d28gdmVjNCdzIGFmdGVyIHNjYWxpbmcgdGhlIHNlY29uZCBvcGVyYW5kIGJ5IGEgc2NhbGFyIHZhbHVlXG4gKlxuICogQHBhcmFtIHt2ZWM0fSBvdXQgdGhlIHJlY2VpdmluZyB2ZWN0b3JcbiAqIEBwYXJhbSB7dmVjNH0gYSB0aGUgZmlyc3Qgb3BlcmFuZFxuICogQHBhcmFtIHt2ZWM0fSBiIHRoZSBzZWNvbmQgb3BlcmFuZFxuICogQHBhcmFtIHtOdW1iZXJ9IHNjYWxlIHRoZSBhbW91bnQgdG8gc2NhbGUgYiBieSBiZWZvcmUgYWRkaW5nXG4gKiBAcmV0dXJucyB7dmVjNH0gb3V0XG4gKi9cbnZlYzQuc2NhbGVBbmRBZGQgPSBmdW5jdGlvbihvdXQsIGEsIGIsIHNjYWxlKSB7XG4gICAgb3V0WzBdID0gYVswXSArIChiWzBdICogc2NhbGUpO1xuICAgIG91dFsxXSA9IGFbMV0gKyAoYlsxXSAqIHNjYWxlKTtcbiAgICBvdXRbMl0gPSBhWzJdICsgKGJbMl0gKiBzY2FsZSk7XG4gICAgb3V0WzNdID0gYVszXSArIChiWzNdICogc2NhbGUpO1xuICAgIHJldHVybiBvdXQ7XG59O1xuXG4vKipcbiAqIENhbGN1bGF0ZXMgdGhlIGV1Y2xpZGlhbiBkaXN0YW5jZSBiZXR3ZWVuIHR3byB2ZWM0J3NcbiAqXG4gKiBAcGFyYW0ge3ZlYzR9IGEgdGhlIGZpcnN0IG9wZXJhbmRcbiAqIEBwYXJhbSB7dmVjNH0gYiB0aGUgc2Vjb25kIG9wZXJhbmRcbiAqIEByZXR1cm5zIHtOdW1iZXJ9IGRpc3RhbmNlIGJldHdlZW4gYSBhbmQgYlxuICovXG52ZWM0LmRpc3RhbmNlID0gZnVuY3Rpb24oYSwgYikge1xuICAgIHZhciB4ID0gYlswXSAtIGFbMF0sXG4gICAgICAgIHkgPSBiWzFdIC0gYVsxXSxcbiAgICAgICAgeiA9IGJbMl0gLSBhWzJdLFxuICAgICAgICB3ID0gYlszXSAtIGFbM107XG4gICAgcmV0dXJuIE1hdGguc3FydCh4KnggKyB5KnkgKyB6KnogKyB3KncpO1xufTtcblxuLyoqXG4gKiBBbGlhcyBmb3Ige0BsaW5rIHZlYzQuZGlzdGFuY2V9XG4gKiBAZnVuY3Rpb25cbiAqL1xudmVjNC5kaXN0ID0gdmVjNC5kaXN0YW5jZTtcblxuLyoqXG4gKiBDYWxjdWxhdGVzIHRoZSBzcXVhcmVkIGV1Y2xpZGlhbiBkaXN0YW5jZSBiZXR3ZWVuIHR3byB2ZWM0J3NcbiAqXG4gKiBAcGFyYW0ge3ZlYzR9IGEgdGhlIGZpcnN0IG9wZXJhbmRcbiAqIEBwYXJhbSB7dmVjNH0gYiB0aGUgc2Vjb25kIG9wZXJhbmRcbiAqIEByZXR1cm5zIHtOdW1iZXJ9IHNxdWFyZWQgZGlzdGFuY2UgYmV0d2VlbiBhIGFuZCBiXG4gKi9cbnZlYzQuc3F1YXJlZERpc3RhbmNlID0gZnVuY3Rpb24oYSwgYikge1xuICAgIHZhciB4ID0gYlswXSAtIGFbMF0sXG4gICAgICAgIHkgPSBiWzFdIC0gYVsxXSxcbiAgICAgICAgeiA9IGJbMl0gLSBhWzJdLFxuICAgICAgICB3ID0gYlszXSAtIGFbM107XG4gICAgcmV0dXJuIHgqeCArIHkqeSArIHoqeiArIHcqdztcbn07XG5cbi8qKlxuICogQWxpYXMgZm9yIHtAbGluayB2ZWM0LnNxdWFyZWREaXN0YW5jZX1cbiAqIEBmdW5jdGlvblxuICovXG52ZWM0LnNxckRpc3QgPSB2ZWM0LnNxdWFyZWREaXN0YW5jZTtcblxuLyoqXG4gKiBDYWxjdWxhdGVzIHRoZSBsZW5ndGggb2YgYSB2ZWM0XG4gKlxuICogQHBhcmFtIHt2ZWM0fSBhIHZlY3RvciB0byBjYWxjdWxhdGUgbGVuZ3RoIG9mXG4gKiBAcmV0dXJucyB7TnVtYmVyfSBsZW5ndGggb2YgYVxuICovXG52ZWM0Lmxlbmd0aCA9IGZ1bmN0aW9uIChhKSB7XG4gICAgdmFyIHggPSBhWzBdLFxuICAgICAgICB5ID0gYVsxXSxcbiAgICAgICAgeiA9IGFbMl0sXG4gICAgICAgIHcgPSBhWzNdO1xuICAgIHJldHVybiBNYXRoLnNxcnQoeCp4ICsgeSp5ICsgeip6ICsgdyp3KTtcbn07XG5cbi8qKlxuICogQWxpYXMgZm9yIHtAbGluayB2ZWM0Lmxlbmd0aH1cbiAqIEBmdW5jdGlvblxuICovXG52ZWM0LmxlbiA9IHZlYzQubGVuZ3RoO1xuXG4vKipcbiAqIENhbGN1bGF0ZXMgdGhlIHNxdWFyZWQgbGVuZ3RoIG9mIGEgdmVjNFxuICpcbiAqIEBwYXJhbSB7dmVjNH0gYSB2ZWN0b3IgdG8gY2FsY3VsYXRlIHNxdWFyZWQgbGVuZ3RoIG9mXG4gKiBAcmV0dXJucyB7TnVtYmVyfSBzcXVhcmVkIGxlbmd0aCBvZiBhXG4gKi9cbnZlYzQuc3F1YXJlZExlbmd0aCA9IGZ1bmN0aW9uIChhKSB7XG4gICAgdmFyIHggPSBhWzBdLFxuICAgICAgICB5ID0gYVsxXSxcbiAgICAgICAgeiA9IGFbMl0sXG4gICAgICAgIHcgPSBhWzNdO1xuICAgIHJldHVybiB4KnggKyB5KnkgKyB6KnogKyB3Knc7XG59O1xuXG4vKipcbiAqIEFsaWFzIGZvciB7QGxpbmsgdmVjNC5zcXVhcmVkTGVuZ3RofVxuICogQGZ1bmN0aW9uXG4gKi9cbnZlYzQuc3FyTGVuID0gdmVjNC5zcXVhcmVkTGVuZ3RoO1xuXG4vKipcbiAqIE5lZ2F0ZXMgdGhlIGNvbXBvbmVudHMgb2YgYSB2ZWM0XG4gKlxuICogQHBhcmFtIHt2ZWM0fSBvdXQgdGhlIHJlY2VpdmluZyB2ZWN0b3JcbiAqIEBwYXJhbSB7dmVjNH0gYSB2ZWN0b3IgdG8gbmVnYXRlXG4gKiBAcmV0dXJucyB7dmVjNH0gb3V0XG4gKi9cbnZlYzQubmVnYXRlID0gZnVuY3Rpb24ob3V0LCBhKSB7XG4gICAgb3V0WzBdID0gLWFbMF07XG4gICAgb3V0WzFdID0gLWFbMV07XG4gICAgb3V0WzJdID0gLWFbMl07XG4gICAgb3V0WzNdID0gLWFbM107XG4gICAgcmV0dXJuIG91dDtcbn07XG5cbi8qKlxuICogUmV0dXJucyB0aGUgaW52ZXJzZSBvZiB0aGUgY29tcG9uZW50cyBvZiBhIHZlYzRcbiAqXG4gKiBAcGFyYW0ge3ZlYzR9IG91dCB0aGUgcmVjZWl2aW5nIHZlY3RvclxuICogQHBhcmFtIHt2ZWM0fSBhIHZlY3RvciB0byBpbnZlcnRcbiAqIEByZXR1cm5zIHt2ZWM0fSBvdXRcbiAqL1xudmVjNC5pbnZlcnNlID0gZnVuY3Rpb24ob3V0LCBhKSB7XG4gIG91dFswXSA9IDEuMCAvIGFbMF07XG4gIG91dFsxXSA9IDEuMCAvIGFbMV07XG4gIG91dFsyXSA9IDEuMCAvIGFbMl07XG4gIG91dFszXSA9IDEuMCAvIGFbM107XG4gIHJldHVybiBvdXQ7XG59O1xuXG4vKipcbiAqIE5vcm1hbGl6ZSBhIHZlYzRcbiAqXG4gKiBAcGFyYW0ge3ZlYzR9IG91dCB0aGUgcmVjZWl2aW5nIHZlY3RvclxuICogQHBhcmFtIHt2ZWM0fSBhIHZlY3RvciB0byBub3JtYWxpemVcbiAqIEByZXR1cm5zIHt2ZWM0fSBvdXRcbiAqL1xudmVjNC5ub3JtYWxpemUgPSBmdW5jdGlvbihvdXQsIGEpIHtcbiAgICB2YXIgeCA9IGFbMF0sXG4gICAgICAgIHkgPSBhWzFdLFxuICAgICAgICB6ID0gYVsyXSxcbiAgICAgICAgdyA9IGFbM107XG4gICAgdmFyIGxlbiA9IHgqeCArIHkqeSArIHoqeiArIHcqdztcbiAgICBpZiAobGVuID4gMCkge1xuICAgICAgICBsZW4gPSAxIC8gTWF0aC5zcXJ0KGxlbik7XG4gICAgICAgIG91dFswXSA9IHggKiBsZW47XG4gICAgICAgIG91dFsxXSA9IHkgKiBsZW47XG4gICAgICAgIG91dFsyXSA9IHogKiBsZW47XG4gICAgICAgIG91dFszXSA9IHcgKiBsZW47XG4gICAgfVxuICAgIHJldHVybiBvdXQ7XG59O1xuXG4vKipcbiAqIENhbGN1bGF0ZXMgdGhlIGRvdCBwcm9kdWN0IG9mIHR3byB2ZWM0J3NcbiAqXG4gKiBAcGFyYW0ge3ZlYzR9IGEgdGhlIGZpcnN0IG9wZXJhbmRcbiAqIEBwYXJhbSB7dmVjNH0gYiB0aGUgc2Vjb25kIG9wZXJhbmRcbiAqIEByZXR1cm5zIHtOdW1iZXJ9IGRvdCBwcm9kdWN0IG9mIGEgYW5kIGJcbiAqL1xudmVjNC5kb3QgPSBmdW5jdGlvbiAoYSwgYikge1xuICAgIHJldHVybiBhWzBdICogYlswXSArIGFbMV0gKiBiWzFdICsgYVsyXSAqIGJbMl0gKyBhWzNdICogYlszXTtcbn07XG5cbi8qKlxuICogUGVyZm9ybXMgYSBsaW5lYXIgaW50ZXJwb2xhdGlvbiBiZXR3ZWVuIHR3byB2ZWM0J3NcbiAqXG4gKiBAcGFyYW0ge3ZlYzR9IG91dCB0aGUgcmVjZWl2aW5nIHZlY3RvclxuICogQHBhcmFtIHt2ZWM0fSBhIHRoZSBmaXJzdCBvcGVyYW5kXG4gKiBAcGFyYW0ge3ZlYzR9IGIgdGhlIHNlY29uZCBvcGVyYW5kXG4gKiBAcGFyYW0ge051bWJlcn0gdCBpbnRlcnBvbGF0aW9uIGFtb3VudCBiZXR3ZWVuIHRoZSB0d28gaW5wdXRzXG4gKiBAcmV0dXJucyB7dmVjNH0gb3V0XG4gKi9cbnZlYzQubGVycCA9IGZ1bmN0aW9uIChvdXQsIGEsIGIsIHQpIHtcbiAgICB2YXIgYXggPSBhWzBdLFxuICAgICAgICBheSA9IGFbMV0sXG4gICAgICAgIGF6ID0gYVsyXSxcbiAgICAgICAgYXcgPSBhWzNdO1xuICAgIG91dFswXSA9IGF4ICsgdCAqIChiWzBdIC0gYXgpO1xuICAgIG91dFsxXSA9IGF5ICsgdCAqIChiWzFdIC0gYXkpO1xuICAgIG91dFsyXSA9IGF6ICsgdCAqIChiWzJdIC0gYXopO1xuICAgIG91dFszXSA9IGF3ICsgdCAqIChiWzNdIC0gYXcpO1xuICAgIHJldHVybiBvdXQ7XG59O1xuXG4vKipcbiAqIEdlbmVyYXRlcyBhIHJhbmRvbSB2ZWN0b3Igd2l0aCB0aGUgZ2l2ZW4gc2NhbGVcbiAqXG4gKiBAcGFyYW0ge3ZlYzR9IG91dCB0aGUgcmVjZWl2aW5nIHZlY3RvclxuICogQHBhcmFtIHtOdW1iZXJ9IFtzY2FsZV0gTGVuZ3RoIG9mIHRoZSByZXN1bHRpbmcgdmVjdG9yLiBJZiBvbW1pdHRlZCwgYSB1bml0IHZlY3RvciB3aWxsIGJlIHJldHVybmVkXG4gKiBAcmV0dXJucyB7dmVjNH0gb3V0XG4gKi9cbnZlYzQucmFuZG9tID0gZnVuY3Rpb24gKG91dCwgc2NhbGUpIHtcbiAgICBzY2FsZSA9IHNjYWxlIHx8IDEuMDtcblxuICAgIC8vVE9ETzogVGhpcyBpcyBhIHByZXR0eSBhd2Z1bCB3YXkgb2YgZG9pbmcgdGhpcy4gRmluZCBzb21ldGhpbmcgYmV0dGVyLlxuICAgIG91dFswXSA9IGdsTWF0cml4LlJBTkRPTSgpO1xuICAgIG91dFsxXSA9IGdsTWF0cml4LlJBTkRPTSgpO1xuICAgIG91dFsyXSA9IGdsTWF0cml4LlJBTkRPTSgpO1xuICAgIG91dFszXSA9IGdsTWF0cml4LlJBTkRPTSgpO1xuICAgIHZlYzQubm9ybWFsaXplKG91dCwgb3V0KTtcbiAgICB2ZWM0LnNjYWxlKG91dCwgb3V0LCBzY2FsZSk7XG4gICAgcmV0dXJuIG91dDtcbn07XG5cbi8qKlxuICogVHJhbnNmb3JtcyB0aGUgdmVjNCB3aXRoIGEgbWF0NC5cbiAqXG4gKiBAcGFyYW0ge3ZlYzR9IG91dCB0aGUgcmVjZWl2aW5nIHZlY3RvclxuICogQHBhcmFtIHt2ZWM0fSBhIHRoZSB2ZWN0b3IgdG8gdHJhbnNmb3JtXG4gKiBAcGFyYW0ge21hdDR9IG0gbWF0cml4IHRvIHRyYW5zZm9ybSB3aXRoXG4gKiBAcmV0dXJucyB7dmVjNH0gb3V0XG4gKi9cbnZlYzQudHJhbnNmb3JtTWF0NCA9IGZ1bmN0aW9uKG91dCwgYSwgbSkge1xuICAgIHZhciB4ID0gYVswXSwgeSA9IGFbMV0sIHogPSBhWzJdLCB3ID0gYVszXTtcbiAgICBvdXRbMF0gPSBtWzBdICogeCArIG1bNF0gKiB5ICsgbVs4XSAqIHogKyBtWzEyXSAqIHc7XG4gICAgb3V0WzFdID0gbVsxXSAqIHggKyBtWzVdICogeSArIG1bOV0gKiB6ICsgbVsxM10gKiB3O1xuICAgIG91dFsyXSA9IG1bMl0gKiB4ICsgbVs2XSAqIHkgKyBtWzEwXSAqIHogKyBtWzE0XSAqIHc7XG4gICAgb3V0WzNdID0gbVszXSAqIHggKyBtWzddICogeSArIG1bMTFdICogeiArIG1bMTVdICogdztcbiAgICByZXR1cm4gb3V0O1xufTtcblxuLyoqXG4gKiBUcmFuc2Zvcm1zIHRoZSB2ZWM0IHdpdGggYSBxdWF0XG4gKlxuICogQHBhcmFtIHt2ZWM0fSBvdXQgdGhlIHJlY2VpdmluZyB2ZWN0b3JcbiAqIEBwYXJhbSB7dmVjNH0gYSB0aGUgdmVjdG9yIHRvIHRyYW5zZm9ybVxuICogQHBhcmFtIHtxdWF0fSBxIHF1YXRlcm5pb24gdG8gdHJhbnNmb3JtIHdpdGhcbiAqIEByZXR1cm5zIHt2ZWM0fSBvdXRcbiAqL1xudmVjNC50cmFuc2Zvcm1RdWF0ID0gZnVuY3Rpb24ob3V0LCBhLCBxKSB7XG4gICAgdmFyIHggPSBhWzBdLCB5ID0gYVsxXSwgeiA9IGFbMl0sXG4gICAgICAgIHF4ID0gcVswXSwgcXkgPSBxWzFdLCBxeiA9IHFbMl0sIHF3ID0gcVszXSxcblxuICAgICAgICAvLyBjYWxjdWxhdGUgcXVhdCAqIHZlY1xuICAgICAgICBpeCA9IHF3ICogeCArIHF5ICogeiAtIHF6ICogeSxcbiAgICAgICAgaXkgPSBxdyAqIHkgKyBxeiAqIHggLSBxeCAqIHosXG4gICAgICAgIGl6ID0gcXcgKiB6ICsgcXggKiB5IC0gcXkgKiB4LFxuICAgICAgICBpdyA9IC1xeCAqIHggLSBxeSAqIHkgLSBxeiAqIHo7XG5cbiAgICAvLyBjYWxjdWxhdGUgcmVzdWx0ICogaW52ZXJzZSBxdWF0XG4gICAgb3V0WzBdID0gaXggKiBxdyArIGl3ICogLXF4ICsgaXkgKiAtcXogLSBpeiAqIC1xeTtcbiAgICBvdXRbMV0gPSBpeSAqIHF3ICsgaXcgKiAtcXkgKyBpeiAqIC1xeCAtIGl4ICogLXF6O1xuICAgIG91dFsyXSA9IGl6ICogcXcgKyBpdyAqIC1xeiArIGl4ICogLXF5IC0gaXkgKiAtcXg7XG4gICAgb3V0WzNdID0gYVszXTtcbiAgICByZXR1cm4gb3V0O1xufTtcblxuLyoqXG4gKiBQZXJmb3JtIHNvbWUgb3BlcmF0aW9uIG92ZXIgYW4gYXJyYXkgb2YgdmVjNHMuXG4gKlxuICogQHBhcmFtIHtBcnJheX0gYSB0aGUgYXJyYXkgb2YgdmVjdG9ycyB0byBpdGVyYXRlIG92ZXJcbiAqIEBwYXJhbSB7TnVtYmVyfSBzdHJpZGUgTnVtYmVyIG9mIGVsZW1lbnRzIGJldHdlZW4gdGhlIHN0YXJ0IG9mIGVhY2ggdmVjNC4gSWYgMCBhc3N1bWVzIHRpZ2h0bHkgcGFja2VkXG4gKiBAcGFyYW0ge051bWJlcn0gb2Zmc2V0IE51bWJlciBvZiBlbGVtZW50cyB0byBza2lwIGF0IHRoZSBiZWdpbm5pbmcgb2YgdGhlIGFycmF5XG4gKiBAcGFyYW0ge051bWJlcn0gY291bnQgTnVtYmVyIG9mIHZlYzRzIHRvIGl0ZXJhdGUgb3Zlci4gSWYgMCBpdGVyYXRlcyBvdmVyIGVudGlyZSBhcnJheVxuICogQHBhcmFtIHtGdW5jdGlvbn0gZm4gRnVuY3Rpb24gdG8gY2FsbCBmb3IgZWFjaCB2ZWN0b3IgaW4gdGhlIGFycmF5XG4gKiBAcGFyYW0ge09iamVjdH0gW2FyZ10gYWRkaXRpb25hbCBhcmd1bWVudCB0byBwYXNzIHRvIGZuXG4gKiBAcmV0dXJucyB7QXJyYXl9IGFcbiAqIEBmdW5jdGlvblxuICovXG52ZWM0LmZvckVhY2ggPSAoZnVuY3Rpb24oKSB7XG4gICAgdmFyIHZlYyA9IHZlYzQuY3JlYXRlKCk7XG5cbiAgICByZXR1cm4gZnVuY3Rpb24oYSwgc3RyaWRlLCBvZmZzZXQsIGNvdW50LCBmbiwgYXJnKSB7XG4gICAgICAgIHZhciBpLCBsO1xuICAgICAgICBpZighc3RyaWRlKSB7XG4gICAgICAgICAgICBzdHJpZGUgPSA0O1xuICAgICAgICB9XG5cbiAgICAgICAgaWYoIW9mZnNldCkge1xuICAgICAgICAgICAgb2Zmc2V0ID0gMDtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgaWYoY291bnQpIHtcbiAgICAgICAgICAgIGwgPSBNYXRoLm1pbigoY291bnQgKiBzdHJpZGUpICsgb2Zmc2V0LCBhLmxlbmd0aCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBsID0gYS5sZW5ndGg7XG4gICAgICAgIH1cblxuICAgICAgICBmb3IoaSA9IG9mZnNldDsgaSA8IGw7IGkgKz0gc3RyaWRlKSB7XG4gICAgICAgICAgICB2ZWNbMF0gPSBhW2ldOyB2ZWNbMV0gPSBhW2krMV07IHZlY1syXSA9IGFbaSsyXTsgdmVjWzNdID0gYVtpKzNdO1xuICAgICAgICAgICAgZm4odmVjLCB2ZWMsIGFyZyk7XG4gICAgICAgICAgICBhW2ldID0gdmVjWzBdOyBhW2krMV0gPSB2ZWNbMV07IGFbaSsyXSA9IHZlY1syXTsgYVtpKzNdID0gdmVjWzNdO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICByZXR1cm4gYTtcbiAgICB9O1xufSkoKTtcblxuLyoqXG4gKiBSZXR1cm5zIGEgc3RyaW5nIHJlcHJlc2VudGF0aW9uIG9mIGEgdmVjdG9yXG4gKlxuICogQHBhcmFtIHt2ZWM0fSB2ZWMgdmVjdG9yIHRvIHJlcHJlc2VudCBhcyBhIHN0cmluZ1xuICogQHJldHVybnMge1N0cmluZ30gc3RyaW5nIHJlcHJlc2VudGF0aW9uIG9mIHRoZSB2ZWN0b3JcbiAqL1xudmVjNC5zdHIgPSBmdW5jdGlvbiAoYSkge1xuICAgIHJldHVybiAndmVjNCgnICsgYVswXSArICcsICcgKyBhWzFdICsgJywgJyArIGFbMl0gKyAnLCAnICsgYVszXSArICcpJztcbn07XG5cbi8qKlxuICogUmV0dXJucyB3aGV0aGVyIG9yIG5vdCB0aGUgdmVjdG9ycyBoYXZlIGV4YWN0bHkgdGhlIHNhbWUgZWxlbWVudHMgaW4gdGhlIHNhbWUgcG9zaXRpb24gKHdoZW4gY29tcGFyZWQgd2l0aCA9PT0pXG4gKlxuICogQHBhcmFtIHt2ZWM0fSBhIFRoZSBmaXJzdCB2ZWN0b3IuXG4gKiBAcGFyYW0ge3ZlYzR9IGIgVGhlIHNlY29uZCB2ZWN0b3IuXG4gKiBAcmV0dXJucyB7Qm9vbGVhbn0gVHJ1ZSBpZiB0aGUgdmVjdG9ycyBhcmUgZXF1YWwsIGZhbHNlIG90aGVyd2lzZS5cbiAqL1xudmVjNC5leGFjdEVxdWFscyA9IGZ1bmN0aW9uIChhLCBiKSB7XG4gICAgcmV0dXJuIGFbMF0gPT09IGJbMF0gJiYgYVsxXSA9PT0gYlsxXSAmJiBhWzJdID09PSBiWzJdICYmIGFbM10gPT09IGJbM107XG59O1xuXG4vKipcbiAqIFJldHVybnMgd2hldGhlciBvciBub3QgdGhlIHZlY3RvcnMgaGF2ZSBhcHByb3hpbWF0ZWx5IHRoZSBzYW1lIGVsZW1lbnRzIGluIHRoZSBzYW1lIHBvc2l0aW9uLlxuICpcbiAqIEBwYXJhbSB7dmVjNH0gYSBUaGUgZmlyc3QgdmVjdG9yLlxuICogQHBhcmFtIHt2ZWM0fSBiIFRoZSBzZWNvbmQgdmVjdG9yLlxuICogQHJldHVybnMge0Jvb2xlYW59IFRydWUgaWYgdGhlIHZlY3RvcnMgYXJlIGVxdWFsLCBmYWxzZSBvdGhlcndpc2UuXG4gKi9cbnZlYzQuZXF1YWxzID0gZnVuY3Rpb24gKGEsIGIpIHtcbiAgICB2YXIgYTAgPSBhWzBdLCBhMSA9IGFbMV0sIGEyID0gYVsyXSwgYTMgPSBhWzNdO1xuICAgIHZhciBiMCA9IGJbMF0sIGIxID0gYlsxXSwgYjIgPSBiWzJdLCBiMyA9IGJbM107XG4gICAgcmV0dXJuIChNYXRoLmFicyhhMCAtIGIwKSA8PSBnbE1hdHJpeC5FUFNJTE9OKk1hdGgubWF4KDEuMCwgTWF0aC5hYnMoYTApLCBNYXRoLmFicyhiMCkpICYmXG4gICAgICAgICAgICBNYXRoLmFicyhhMSAtIGIxKSA8PSBnbE1hdHJpeC5FUFNJTE9OKk1hdGgubWF4KDEuMCwgTWF0aC5hYnMoYTEpLCBNYXRoLmFicyhiMSkpICYmXG4gICAgICAgICAgICBNYXRoLmFicyhhMiAtIGIyKSA8PSBnbE1hdHJpeC5FUFNJTE9OKk1hdGgubWF4KDEuMCwgTWF0aC5hYnMoYTIpLCBNYXRoLmFicyhiMikpICYmXG4gICAgICAgICAgICBNYXRoLmFicyhhMyAtIGIzKSA8PSBnbE1hdHJpeC5FUFNJTE9OKk1hdGgubWF4KDEuMCwgTWF0aC5hYnMoYTMpLCBNYXRoLmFicyhiMykpKTtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gdmVjNDtcbiIsInZhciBPbmNvcHJpbnRNb2RlbCA9IHJlcXVpcmUoJy4vb25jb3ByaW50bW9kZWwuanMnKTtcbnZhciBPbmNvcHJpbnRXZWJHTENlbGxWaWV3ID0gcmVxdWlyZSgnLi9vbmNvcHJpbnR3ZWJnbGNlbGx2aWV3LmpzJyk7XG52YXIgT25jb3ByaW50TGFiZWxWaWV3ID0gcmVxdWlyZSgnLi9vbmNvcHJpbnRsYWJlbHZpZXcuanMnKTtcbnZhciBPbmNvcHJpbnRSdWxlU2V0ID0gcmVxdWlyZSgnLi9vbmNvcHJpbnRydWxlc2V0LmpzJyk7XG52YXIgT25jb3ByaW50VHJhY2tPcHRpb25zVmlldyA9IHJlcXVpcmUoJy4vb25jb3ByaW50dHJhY2tvcHRpb25zdmlldy5qcycpO1xudmFyIE9uY29wcmludExlZ2VuZFZpZXcgPSByZXF1aXJlKCcuL29uY29wcmludGxlZ2VuZHJlbmRlcmVyLmpzJyk7Ly9UT0RPOiByZW5hbWVcbnZhciBPbmNvcHJpbnRUb29sVGlwID0gcmVxdWlyZSgnLi9vbmNvcHJpbnR0b29sdGlwLmpzJyk7XG52YXIgT25jb3ByaW50VHJhY2tJbmZvVmlldyA9IHJlcXVpcmUoJy4vb25jb3ByaW50dHJhY2tpbmZvdmlldy5qcycpO1xudmFyIE9uY29wcmludE1pbmltYXBWaWV3ID0gcmVxdWlyZSgnLi9vbmNvcHJpbnRtaW5pbWFwdmlldy5qcycpO1xuXG52YXIgc3ZnZmFjdG9yeSA9IHJlcXVpcmUoJy4vc3ZnZmFjdG9yeS5qcycpO1xuXG52YXIgY2xhbXAgPSBmdW5jdGlvbih2YWwsIGxvd2VyLCB1cHBlcikge1xuICAgIHJldHVybiBNYXRoLm1pbihNYXRoLm1heCh2YWwsIGxvd2VyKSwgdXBwZXIpO1xufTtcblxudmFyIE9uY29wcmludCA9IChmdW5jdGlvbiAoKSB7XG4gICAgLy8gdGhpcyBpcyB0aGUgY29udHJvbGxlclxuICAgIHZhciBuZXh0VHJhY2tJZCA9IChmdW5jdGlvbiAoKSB7XG5cdHZhciBjdHIgPSAwO1xuXHRyZXR1cm4gZnVuY3Rpb24gKCkge1xuXHQgICAgY3RyICs9IDE7XG5cdCAgICByZXR1cm4gY3RyO1xuXHR9XG4gICAgfSkoKTtcbiAgICBmdW5jdGlvbiBPbmNvcHJpbnQoY3RyX3NlbGVjdG9yLCB3aWR0aCkge1xuXHR2YXIgc2VsZiA9IHRoaXM7XG5cdHRoaXMuY3RyX3NlbGVjdG9yID0gY3RyX3NlbGVjdG9yO1xuXHRcblx0dmFyICRjdHIgPSAkKCc8c3Bhbj48L3NwYW4+JykuY3NzKHsncG9zaXRpb24nOidyZWxhdGl2ZScsICdkaXNwbGF5JzonaW5saW5lLWJsb2NrJ30pLmFwcGVuZFRvKGN0cl9zZWxlY3Rvcik7XG5cdHZhciAkb25jb3ByaW50X2N0ciA9ICQoJzxkaXY+PC9kaXY+Jylcblx0XHRcdCAgICAuY3NzKHsncG9zaXRpb24nOidyZWxhdGl2ZScsICdkaXNwbGF5JzonaW5saW5lLWJsb2NrJ30pXG5cdFx0XHQgICAgLmFwcGVuZFRvKCRjdHIpO1xuXHRcdCAgICBcblx0dmFyICR0b29sdGlwX2N0ciA9ICQoJzxzcGFuPjwvc3Bhbj4nKS5jc3Moeydwb3NpdGlvbic6J2Fic29sdXRlJ30pLmFwcGVuZFRvKGN0cl9zZWxlY3Rvcik7XG5cdHZhciAkbGVnZW5kX2N0ciA9ICQoJzxkaXY+PC9kaXY+JykuY3NzKHsncG9zaXRpb24nOidhYnNvbHV0ZScsICdkaXNwbGF5JzonaW5saW5lLWJsb2NrJywgJ3RvcCc6MCwgJ2xlZnQnOjAsICdtaW4taGVpZ2h0JzoxfSlcblx0XHRcdCAgICAuYXBwZW5kVG8oJGN0cik7XG5cdFxuXHR2YXIgJGxhYmVsX2NhbnZhcyA9ICQoJzxjYW52YXM+PC9jYW52YXM+Jylcblx0XHRcdCAgICAuY3NzKHsnZGlzcGxheSc6J2lubGluZS1ibG9jaycsIFxuXHRcdFx0XHQncG9zaXRpb24nOidhYnNvbHV0ZScsIFxuXHRcdFx0XHQnbGVmdCc6JzBweCcsIFxuXHRcdFx0XHQndG9wJzonMHB4J30pXG5cdFx0XHQgICAgLmFkZENsYXNzKFwibm9zZWxlY3RcIilcblx0XHRcdCAgICAuYXR0cih7J3dpZHRoJzonMTUwJywgJ2hlaWdodCc6JzI1MCd9KTtcblx0XHQgICAgXG5cdHZhciAkdHJhY2tfb3B0aW9uc19kaXYgPSAkKCc8ZGl2PjwvZGl2PicpXG5cdFx0XHRcdC5jc3Moeydwb3NpdGlvbic6J2Fic29sdXRlJywgXG5cdFx0XHRcdFx0J2xlZnQnOicxNTBweCcsIFxuXHRcdFx0XHRcdCd0b3AnOicwcHgnfSlcblx0XHRcdFx0LmFkZENsYXNzKFwibm9zZWxlY3RcIilcblx0XHRcdFx0LmF0dHIoeyd3aWR0aCc6JzUwJywgJ2hlaWdodCc6JzI1MCd9KTtcblx0XHRcdFxuXHR2YXIgJGxlZ2VuZF9kaXYgPSAkKCc8ZGl2PjwvZGl2PicpXG5cdFx0XHQgICAgLmNzcyh7J3Bvc2l0aW9uJzonYWJzb2x1dGUnLCBcblx0XHRcdFx0ICAgICd0b3AnOicyNTBweCcsXG5cdFx0XHRcdCAgICAnbWluLWhlaWdodCc6MX0pXG5cdFx0XHQgICAgLmFkZENsYXNzKFwibm9zZWxlY3RcIik7XG5cdFxuXHR2YXIgJGNlbGxfZGl2ID0gJCgnPGRpdj4nKVxuXHRcdFx0LmNzcyh7J3dpZHRoJzp3aWR0aCxcblx0XHRcdCAgICAnZGlzcGxheSc6J2lubGluZS1ibG9jaycsIFxuXHRcdFx0ICAgICdwb3NpdGlvbic6J2Fic29sdXRlJywgXG5cdFx0XHQgICAgJ2xlZnQnOicyMDBweCcsIFxuXHRcdFx0ICAgICd0b3AnOicwcHgnfSlcblx0XHRcdC5hZGRDbGFzcyhcIm5vc2VsZWN0XCIpO1xuXHRcdFxuXHR2YXIgJGNlbGxfY2FudmFzID0gJCgnPGNhbnZhcz48L2NhbnZhcz4nKVxuXHRcdFx0ICAgIC5hdHRyKCd3aWR0aCcsIHdpZHRoKVxuXHRcdFx0ICAgIC5jc3Moeydwb3NpdGlvbic6J2Fic29sdXRlJywgJ3RvcCc6JzBweCcsICdsZWZ0JzonMHB4J30pXG5cdFx0XHQgICAgLmFkZENsYXNzKFwibm9zZWxlY3RcIik7XG5cdFx0ICAgIFxuXHR2YXIgJGR1bW15X3Njcm9sbF9kaXYgPSAkKCc8ZGl2PicpXG5cdFx0XHRcdC5jc3Moeydwb3NpdGlvbic6J2Fic29sdXRlJyxcblx0XHRcdFx0ICAgICdvdmVyZmxvdy14Jzonc2Nyb2xsJyxcblx0XHRcdFx0ICAgICdvdmVyZmxvdy15Jzonc2Nyb2xsJyxcblx0XHRcdFx0ICAgICd0b3AnOicwJywgXG5cdFx0XHRcdCAgICAnbGVmdCc6JzBweCcsIFxuXHRcdFx0XHQgICAgJ2hlaWdodCc6JzFweCcsXG5cdFx0XHRcdH0pO1xuXHRcblx0dmFyICRkdW1teV9zY3JvbGxfZGl2X2NvbnRlbnRzID0gJCgnPGRpdj4nKS5hcHBlbmRUbygkZHVtbXlfc2Nyb2xsX2Rpdik7XG5cdFx0XHRcdFxuXHR2YXIgJGNlbGxfb3ZlcmxheV9jYW52YXMgPSAkKCc8Y2FudmFzPjwvY2FudmFzPicpXG5cdFx0XHRcdCAgICAuYXR0cignd2lkdGgnLCB3aWR0aClcblx0XHRcdFx0ICAgIC5jc3Moeydwb3NpdGlvbic6J2Fic29sdXRlJywgXG5cdFx0XHRcdFx0ICAgICd0b3AnOicwcHgnLCBcblx0XHRcdFx0XHQgICAgJ2xlZnQnOicwcHgnfSlcblx0XHRcdFx0ICAgIC5hZGRDbGFzcyhcIm5vc2VsZWN0XCIpO1xuXHRcdFx0ICAgIFxuXHR2YXIgJHRyYWNrX2luZm9fZGl2ID0gJCgnPGRpdj4nKVxuXHRcdFx0XHQuY3NzKHsncG9zaXRpb24nOidhYnNvbHV0ZSd9KTtcblx0XHRcdFxuXHR2YXIgJG1pbmltYXBfZGl2ID0gJCgnPGRpdj4nKS5jc3Moeydwb3NpdGlvbic6J2Fic29sdXRlJywgJ291dGxpbmUnOidzb2xpZCAxcHggYmxhY2snLCAnZGlzcGxheSc6ICdub25lJ30pLmFkZENsYXNzKFwibm9zZWxlY3RcIik7XG5cdFxuXHR2YXIgJG1pbmltYXBfY2FudmFzID0gJCgnPGNhbnZhcz48L2NhbnZhcz4nKVxuXHRcdFx0XHQgICAgLmF0dHIoJ3dpZHRoJywgMzAwKVxuXHRcdFx0XHQgICAgLmF0dHIoJ2hlaWdodCcsIDMwMClcblx0XHRcdFx0ICAgIC5jc3Moeydwb3NpdGlvbic6J2Fic29sdXRlJywgJ3RvcCc6JzBweCcsICdsZWZ0JzonMHB4JywgJ3otaW5kZXgnOjB9KVxuXHRcdFx0XHQgICAgLmFkZENsYXNzKFwibm9zZWxlY3RcIik7XG5cdHZhciAkbWluaW1hcF9vdmVybGF5X2NhbnZhcyA9ICQoJzxjYW52YXM+PC9jYW52YXM+Jylcblx0XHRcdFx0ICAgIC5hdHRyKCd3aWR0aCcsIDMwMClcblx0XHRcdFx0ICAgIC5hdHRyKCdoZWlnaHQnLCAzMDApXG5cdFx0XHRcdCAgICAuY3NzKHsncG9zaXRpb24nOiAnYWJzb2x1dGUnLCAndG9wJzonMHB4JywgJ2xlZnQnOicwcHgnLCAnei1pbmRleCc6MX0pXG5cdFx0XHRcdCAgICAuYWRkQ2xhc3MoXCJub3NlbGVjdFwiKTtcblx0XG5cdCRsYWJlbF9jYW52YXMuYXBwZW5kVG8oJG9uY29wcmludF9jdHIpO1xuXHQkY2VsbF9kaXYuYXBwZW5kVG8oJG9uY29wcmludF9jdHIpO1xuXHQkdHJhY2tfb3B0aW9uc19kaXYuYXBwZW5kVG8oJG9uY29wcmludF9jdHIpO1xuXHQkdHJhY2tfaW5mb19kaXYuYXBwZW5kVG8oJG9uY29wcmludF9jdHIpO1xuXHRcblx0JGxlZ2VuZF9kaXYuYXBwZW5kVG8oJGxlZ2VuZF9jdHIpO1xuXG5cdCRtaW5pbWFwX2Rpdi5hcHBlbmRUbygkY3RyKTtcblx0XG5cdCRjZWxsX2NhbnZhcy5hcHBlbmRUbygkY2VsbF9kaXYpO1xuXHQkY2VsbF9vdmVybGF5X2NhbnZhcy5hcHBlbmRUbygkY2VsbF9kaXYpO1xuXHQkZHVtbXlfc2Nyb2xsX2Rpdi5hcHBlbmRUbygkY2VsbF9kaXYpO1xuXHQkZHVtbXlfc2Nyb2xsX2Rpdi5vbihcIm1vdXNlbW92ZSBtb3VzZWRvd24gbW91c2V1cFwiLCBmdW5jdGlvbihldnQpIHtcblx0ICAgICRjZWxsX292ZXJsYXlfY2FudmFzLnRyaWdnZXIoZXZ0KTtcblx0fSk7XG5cdCRtaW5pbWFwX2NhbnZhcy5hcHBlbmRUbygkbWluaW1hcF9kaXYpO1xuXHQkbWluaW1hcF9vdmVybGF5X2NhbnZhcy5hcHBlbmRUbygkbWluaW1hcF9kaXYpO1xuXHRcblx0dGhpcy4kY3RyID0gJGN0cjtcblx0dGhpcy4kb25jb3ByaW50X2N0ciA9ICRvbmNvcHJpbnRfY3RyO1xuXHR0aGlzLiRjZWxsX2RpdiA9ICRjZWxsX2Rpdjtcblx0dGhpcy4kbGVnZW5kX2RpdiA9ICRsZWdlbmRfZGl2O1xuXHR0aGlzLiR0cmFja19vcHRpb25zX2RpdiA9ICR0cmFja19vcHRpb25zX2Rpdjtcblx0dGhpcy4kdHJhY2tfaW5mb19kaXYgPSAkdHJhY2tfaW5mb19kaXY7XG5cdHRoaXMuJGR1bW15X3Njcm9sbF9kaXYgPSAkZHVtbXlfc2Nyb2xsX2Rpdjtcblx0dGhpcy4kbWluaW1hcF9kaXYgPSAkbWluaW1hcF9kaXY7XG5cdFxuXHRcblx0XG5cdHRoaXMuJGNlbGxfY2FudmFzID0gJGNlbGxfY2FudmFzO1xuXHR0aGlzLiRjZWxsX292ZXJsYXlfY2FudmFzID0gJGNlbGxfb3ZlcmxheV9jYW52YXM7XG5cdFxuXHR0aGlzLm1vZGVsID0gbmV3IE9uY29wcmludE1vZGVsKCk7XG5cdFxuXHRcblx0dGhpcy5jZWxsX3ZpZXcgPSBuZXcgT25jb3ByaW50V2ViR0xDZWxsVmlldygkY2VsbF9kaXYsICRjZWxsX2NhbnZhcywgJGNlbGxfb3ZlcmxheV9jYW52YXMsICRkdW1teV9zY3JvbGxfZGl2X2NvbnRlbnRzLCB0aGlzLm1vZGVsLCBuZXcgT25jb3ByaW50VG9vbFRpcCgkdG9vbHRpcF9jdHIpLCBmdW5jdGlvbihsZWZ0LCByaWdodCkge1xuXHQgICAgdmFyIGVuY2xvc2VkX2lkcyA9IHNlbGYubW9kZWwuZ2V0SWRzSW5MZWZ0SW50ZXJ2YWwobGVmdCwgcmlnaHQpO1xuXHQgICAgc2VsZi5zZXRIb3J6Wm9vbShzZWxmLm1vZGVsLmdldEhvcnpab29tVG9GaXQoc2VsZi5jZWxsX3ZpZXcudmlzaWJsZV9hcmVhX3dpZHRoLCBlbmNsb3NlZF9pZHMpKTtcblx0ICAgIHNlbGYuJGR1bW15X3Njcm9sbF9kaXYuc2Nyb2xsTGVmdChzZWxmLm1vZGVsLmdldFpvb21lZENvbHVtbkxlZnQoZW5jbG9zZWRfaWRzWzBdKSk7XG5cdCAgICBzZWxmLmlkX2NsaXBib2FyZCA9IGVuY2xvc2VkX2lkcztcblx0fSxcblx0XHQoZnVuY3Rpb24gKCkge1xuXHRcdCAgICB2YXIgaGlnaGxpZ2h0X3RpbWVvdXQgPSBudWxsO1xuXHRcdCAgICB2YXIgaGlnaGxpZ2h0X3RyYWNrID0gbnVsbDtcblx0XHQgICAgcmV0dXJuIGZ1bmN0aW9uICh0cmFja19pZCwgY29sdW1uX2lkKSB7XG5cdFx0XHRpZiAodHJhY2tfaWQgPT09IG51bGwpIHtcblx0XHRcdCAgICBoaWdobGlnaHRfdHJhY2sgPSBudWxsO1xuXHRcdFx0ICAgIHNlbGYuaGlnaGxpZ2h0VHJhY2sobnVsbCk7XG5cdFx0XHQgICAgY2xlYXJUaW1lb3V0KGhpZ2hsaWdodF90aW1lb3V0KTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHQgICAgaWYgKGhpZ2hsaWdodF90cmFjayAhPT0gdHJhY2tfaWQpIHtcblx0XHRcdFx0c2VsZi5oaWdobGlnaHRUcmFjayhudWxsKTtcblx0XHRcdFx0Y2xlYXJUaW1lb3V0KGhpZ2hsaWdodF90aW1lb3V0KTtcblx0XHRcdFx0aGlnaGxpZ2h0X3RyYWNrID0gdHJhY2tfaWQ7XG5cdFx0XHRcdGhpZ2hsaWdodF90aW1lb3V0ID0gc2V0VGltZW91dChmdW5jdGlvbigpIHtcblx0XHRcdFx0ICAgIHNlbGYuaGlnaGxpZ2h0VHJhY2soaGlnaGxpZ2h0X3RyYWNrKTtcblx0XHRcdFx0fSwgMjUwKTtcblx0XHRcdCAgICB9XG5cdFx0XHR9XG5cdFx0ICAgIH07XG5cdFx0fSkoKSk7XG5cdFxuXHR0aGlzLm1pbmltYXBfdmlldyA9IG5ldyBPbmNvcHJpbnRNaW5pbWFwVmlldygkbWluaW1hcF9kaXYsICRtaW5pbWFwX2NhbnZhcywgJG1pbmltYXBfb3ZlcmxheV9jYW52YXMsIHRoaXMubW9kZWwsIHRoaXMuY2VsbF92aWV3LCAxNTAsIDE1MCwgZnVuY3Rpb24oeCx5KSB7XG5cdCAgICBzZWxmLnNldFNjcm9sbCh4LHkpO1xuXHR9LFxuXHRmdW5jdGlvbih2cCkge1xuXHQgICAgc2VsZi5zZXRWaWV3cG9ydCh2cC5jb2wsdnAuc2Nyb2xsX3lfcHJvcG9ydGlvbix2cC5udW1fY29scywgdnAuem9vbV95KTtcblx0fSxcblx0ZnVuY3Rpb24odmFsKSB7XG5cdCAgICB2YXIgcHJldl92aWV3cG9ydCA9IHNlbGYuY2VsbF92aWV3LmdldFZpZXdwb3J0T25jb3ByaW50U3BhY2Uoc2VsZi5tb2RlbCk7XG5cdCAgICB2YXIgcHJldl9jZW50ZXJfb25jX3NwYWNlID0gKHByZXZfdmlld3BvcnQubGVmdCArIHByZXZfdmlld3BvcnQucmlnaHQpIC8gMjtcblx0ICAgIHZhciBjZW50ZXJfY29sdW1uID0gTWF0aC5mbG9vcihwcmV2X2NlbnRlcl9vbmNfc3BhY2UgLyAoc2VsZi5tb2RlbC5nZXRDZWxsV2lkdGgodHJ1ZSkgKyBzZWxmLm1vZGVsLmdldENlbGxQYWRkaW5nKHRydWUpKSk7XG5cdCAgICBzZWxmLnNldEhvcnpab29tKHZhbCk7XG5cdCAgICB2YXIgdmlld3BvcnQgPSBzZWxmLmNlbGxfdmlldy5nZXRWaWV3cG9ydE9uY29wcmludFNwYWNlKHNlbGYubW9kZWwpO1xuXHQgICAgdmFyIGNlbnRlcl9jb2x1bW5feF96b29tZWQgPSBjZW50ZXJfY29sdW1uICogKHNlbGYubW9kZWwuZ2V0Q2VsbFdpZHRoKCkgKyBzZWxmLm1vZGVsLmdldENlbGxQYWRkaW5nKCkpO1xuXHQgICAgdmFyIGhhbGZfdmlld3BvcnRfd2lkdGhfem9vbWVkID0gc2VsZi5tb2RlbC5nZXRIb3J6Wm9vbSgpICogKHZpZXdwb3J0LnJpZ2h0IC0gdmlld3BvcnQubGVmdCkgLyAyO1xuXHQgICAgXG5cdCAgICBzZWxmLnNldEhvcnpTY3JvbGwoY2VudGVyX2NvbHVtbl94X3pvb21lZCAtIGhhbGZfdmlld3BvcnRfd2lkdGhfem9vbWVkKTtcblx0fSxcblx0ZnVuY3Rpb24odmFsKSB7XG5cdCAgICB2YXIgcHJldl92aWV3cG9ydCA9IHNlbGYuY2VsbF92aWV3LmdldFZpZXdwb3J0T25jb3ByaW50U3BhY2Uoc2VsZi5tb2RlbCk7XG5cdCAgICB2YXIgY2VudGVyX29uY19zcGFjZSA9IChwcmV2X3ZpZXdwb3J0LnRvcCArIHByZXZfdmlld3BvcnQuYm90dG9tKSAvIDI7XG5cdCAgICBzZWxmLnNldFZlcnRab29tKHZhbCk7XG5cdCAgICB2YXIgdmlld3BvcnQgPSBzZWxmLmNlbGxfdmlldy5nZXRWaWV3cG9ydE9uY29wcmludFNwYWNlKHNlbGYubW9kZWwpO1xuXHQgICAgdmFyIGhhbGZfdmlld3BvcnRfaGVpZ2h0X3pvb21lZCA9IHNlbGYubW9kZWwuZ2V0VmVydFpvb20oKSAqICh2aWV3cG9ydC5ib3R0b20gLSB2aWV3cG9ydC50b3ApIC8gMjtcblx0ICAgIFxuXHQgICAgc2VsZi5zZXRWZXJ0U2Nyb2xsKGNlbnRlcl9vbmNfc3BhY2UgKiBzZWxmLm1vZGVsLmdldFZlcnRab29tKCkgLSBoYWxmX3ZpZXdwb3J0X2hlaWdodF96b29tZWQpO1xuXHR9LFxuXHRmdW5jdGlvbigpIHtcblx0ICAgIHVwZGF0ZUhvcnpab29tVG9GaXQoc2VsZik7XG5cdCAgICB2YXIgbGVmdCA9IHNlbGYubW9kZWwuZ2V0Wm9vbWVkQ29sdW1uTGVmdCgpO1xuXHQgICAgc2VsZi5zZXRIb3J6U2Nyb2xsKE1hdGgubWluLmFwcGx5KG51bGwsIHNlbGYua2VlcF9ob3J6X3pvb21lZF90b19maXRfaWRzLm1hcChmdW5jdGlvbihpZCkgeyByZXR1cm4gbGVmdFtpZF07IH0pKSk7XG5cdH0sXG5cdGZ1bmN0aW9uKCkge1xuXHQgICAgc2VsZi5zZXRNaW5pbWFwVmlzaWJsZShmYWxzZSk7XG5cdH0pO1xuXHRcblx0dGhpcy50cmFja19vcHRpb25zX3ZpZXcgPSBuZXcgT25jb3ByaW50VHJhY2tPcHRpb25zVmlldygkdHJhY2tfb3B0aW9uc19kaXYsXG5cdFx0XHRcdFx0XHRcdFx0ZnVuY3Rpb24gKHRyYWNrX2lkKSB7XG5cdFx0XHRcdFx0XHRcdFx0ICAgIC8vIG1vdmUgdXBcblx0XHRcdFx0XHRcdFx0XHQgICAgdmFyIHRyYWNrcyA9IHNlbGYubW9kZWwuZ2V0Q29udGFpbmluZ1RyYWNrR3JvdXAodHJhY2tfaWQpO1xuXHRcdFx0XHRcdFx0XHRcdCAgICB2YXIgaW5kZXggPSB0cmFja3MuaW5kZXhPZih0cmFja19pZCk7XG5cdFx0XHRcdFx0XHRcdFx0ICAgIGlmIChpbmRleCA+IDApIHtcblx0XHRcdFx0XHRcdFx0XHRcdHZhciBuZXdfcHJldmlvdXNfdHJhY2sgPSBudWxsO1xuXHRcdFx0XHRcdFx0XHRcdFx0aWYgKGluZGV4ID49IDIpIHtcblx0XHRcdFx0XHRcdFx0XHRcdCAgICBuZXdfcHJldmlvdXNfdHJhY2sgPSB0cmFja3NbaW5kZXgtMl07XG5cdFx0XHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdFx0XHRzZWxmLm1vdmVUcmFjayh0cmFja19pZCwgbmV3X3ByZXZpb3VzX3RyYWNrKTtcblx0XHRcdFx0XHRcdFx0XHQgICAgfVxuXHRcdFx0XHRcdFx0XHRcdH0sXG5cdFx0XHRcdFx0XHRcdFx0ZnVuY3Rpb24gKHRyYWNrX2lkKSB7XG5cdFx0XHRcdFx0XHRcdFx0ICAgIC8vIG1vdmUgZG93blxuXHRcdFx0XHRcdFx0XHRcdCAgICB2YXIgdHJhY2tzID0gc2VsZi5tb2RlbC5nZXRDb250YWluaW5nVHJhY2tHcm91cCh0cmFja19pZCk7XG5cdFx0XHRcdFx0XHRcdFx0ICAgIHZhciBpbmRleCA9IHRyYWNrcy5pbmRleE9mKHRyYWNrX2lkKTtcblx0XHRcdFx0XHRcdFx0XHQgICAgaWYgKGluZGV4IDwgdHJhY2tzLmxlbmd0aCAtIDEpIHtcblx0XHRcdFx0XHRcdFx0XHRcdHNlbGYubW92ZVRyYWNrKHRyYWNrX2lkLCB0cmFja3NbaW5kZXgrMV0pO1xuXHRcdFx0XHRcdFx0XHRcdCAgICB9XG5cdFx0XHRcdFx0XHRcdFx0fSxcblx0XHRcdFx0XHRcdFx0XHRmdW5jdGlvbiAodHJhY2tfaWQpIHsgc2VsZi5yZW1vdmVUcmFjayh0cmFja19pZCk7IH0sXG5cdFx0XHRcdFx0XHRcdFx0ZnVuY3Rpb24gKHRyYWNrX2lkLCBkaXIpIHsgc2VsZi5zZXRUcmFja1NvcnREaXJlY3Rpb24odHJhY2tfaWQsIGRpcik7IH0sXG5cdFx0XHRcdFx0XHRcdFx0ZnVuY3Rpb24gKHRyYWNrX2lkKSB7XG5cdFx0XHRcdFx0XHRcdFx0ICAgIC8vIHJlbW92ZSBhbGwgcmVsYXRlZCBleHBhbnNpb24gdHJhY2tzXG5cdFx0XHRcdFx0XHRcdFx0ICAgIHZhciB0cmFja3NfdG9fcmVtb3ZlID0gc2VsZi5tb2RlbC50cmFja19leHBhbnNpb25fdHJhY2tzW3RyYWNrX2lkXS5zbGljZSgpLCBpO1xuXHRcdFx0XHRcdFx0XHRcdCAgICBzZWxmLnN1cHByZXNzUmVuZGVyaW5nKCk7XG5cdFx0XHRcdFx0XHRcdFx0ICAgIGZvciAoaSA9IDA7IGkgPCB0cmFja3NfdG9fcmVtb3ZlLmxlbmd0aDsgaSsrKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRzZWxmLnJlbW92ZVRyYWNrKHRyYWNrc190b19yZW1vdmVbaV0pO1xuXHRcdFx0XHRcdFx0XHRcdCAgICB9XG5cdFx0XHRcdFx0XHRcdFx0ICAgIHNlbGYucmVsZWFzZVJlbmRlcmluZygpO1xuXHRcdFx0XHRcdFx0XHRcdH0pO1xuXHR0aGlzLnRyYWNrX2luZm9fdmlldyA9IG5ldyBPbmNvcHJpbnRUcmFja0luZm9WaWV3KCR0cmFja19pbmZvX2Rpdik7XG5cdFx0XHRcdFx0XHRcdFx0XG5cdC8vdGhpcy50cmFja19pbmZvX3ZpZXcgPSBuZXcgT25jb3ByaW50VHJhY2tJbmZvVmlldygkdHJhY2tfaW5mb19kaXYpO1xuXG5cdHRoaXMubGFiZWxfdmlldyA9IG5ldyBPbmNvcHJpbnRMYWJlbFZpZXcoJGxhYmVsX2NhbnZhcywgdGhpcy5tb2RlbCwgbmV3IE9uY29wcmludFRvb2xUaXAoJHRvb2x0aXBfY3RyLCB7bm9zZWxlY3Q6IHRydWV9KSk7XG5cdHRoaXMubGFiZWxfdmlldy5zZXREcmFnQ2FsbGJhY2soZnVuY3Rpb24odGFyZ2V0X3RyYWNrLCBuZXdfcHJldmlvdXNfdHJhY2spIHtcblx0ICAgIHNlbGYubW92ZVRyYWNrKHRhcmdldF90cmFjaywgbmV3X3ByZXZpb3VzX3RyYWNrKTtcblx0fSk7XG5cdFxuXHR0aGlzLmxlZ2VuZF92aWV3ID0gbmV3IE9uY29wcmludExlZ2VuZFZpZXcoJGxlZ2VuZF9kaXYsIDEwLCAyMCk7XG5cdFxuXHR0aGlzLmtlZXBfc29ydGVkID0gZmFsc2U7XG5cdFxuXHR0aGlzLmtlZXBfaG9yel96b29tZWRfdG9fZml0ID0gZmFsc2U7XG5cdHRoaXMua2VlcF9ob3J6X3pvb21lZF90b19maXRfaWRzID0gW107XG5cdFxuXHQvLyBXZSBuZWVkIHRvIGhhbmRsZSBzY3JvbGxpbmcgdGhpcyB3YXkgYmVjYXVzZSBmb3Igc29tZSByZWFzb24gaHVnZSBcblx0Ly8gIGNhbnZhcyBlbGVtZW50cyBoYXZlIHRlcnJpYmxlIHJlc29sdXRpb24uXG5cdHZhciBjZWxsX3ZpZXcgPSB0aGlzLmNlbGxfdmlldztcblx0dmFyIG1vZGVsID0gdGhpcy5tb2RlbDtcblx0XG5cdHRoaXMudGFyZ2V0X2R1bW15X3Njcm9sbF9sZWZ0ID0gMDtcblx0dGhpcy50YXJnZXRfZHVtbXlfc2Nyb2xsX3RvcCA9IDA7XG5cdFxuXHQoZnVuY3Rpb24gc2V0VXBPbmNvcHJpbnRTY3JvbGwoKSB7XG5cdCAgICAkZHVtbXlfc2Nyb2xsX2Rpdi5zY3JvbGwoZnVuY3Rpb24gKGUpIHtcblx0XHR2YXIgZHVtbXlfc2Nyb2xsX2xlZnQgPSAkZHVtbXlfc2Nyb2xsX2Rpdi5zY3JvbGxMZWZ0KCk7XG5cdFx0dmFyIGR1bW15X3Njcm9sbF90b3AgPSAkZHVtbXlfc2Nyb2xsX2Rpdi5zY3JvbGxUb3AoKTtcblx0XHRpZiAoZHVtbXlfc2Nyb2xsX2xlZnQgIT09IHNlbGYudGFyZ2V0X2R1bW15X3Njcm9sbF9sZWZ0IHx8IGR1bW15X3Njcm9sbF90b3AgIT09IHNlbGYudGFyZ2V0X2R1bW15X3Njcm9sbF90b3ApIHtcblx0XHQgICAgLy8gSW4gc2V0RHVtbXlTY3JvbGxEaXZTY3JvbGwsIHdoZXJlIHdlIGludGVuZCB0byBzZXQgdGhlIHNjcm9sbCBwcm9ncmFtbWF0aWNhbGx5IHdpdGhvdXRcblx0XHQgICAgLy9cdHRyaWdnZXJpbmcgdGhlIGhhbmRsZXIsIHdlIHNldCB0YXJnZXRfZHVtbXlfc2Nyb2xsX2xlZnQgYW5kIHRhcmdldF9kdW1teV9zY3JvbGxfdG9wLFxuXHRcdCAgICAvL1x0c28gaWYgdGhleSdyZSBub3Qgc2V0ICh3ZSBnZXQgaW5zaWRlIHRoaXMgYmxvY2spLCB0aGVuIGl0J3MgYSB1c2VyLXRyaWdnZXJlZCBzY3JvbGwuXG5cdFx0ICAgIC8vXHRcblx0XHQgICAgLy8gU2V0IG9uY29wcmludCBzY3JvbGwgdG8gbWF0Y2hcblx0XHQgICAgc2VsZi50YXJnZXRfZHVtbXlfc2Nyb2xsX2xlZnQgPSBkdW1teV9zY3JvbGxfbGVmdDtcblx0XHQgICAgc2VsZi50YXJnZXRfZHVtbXlfc2Nyb2xsX3RvcCA9IGR1bW15X3Njcm9sbF90b3A7XG5cdFx0ICAgIHZhciBtYXhpbXVtX2R1bW15X3Njcm9sbF9kaXZfc2Nyb2xsID0gbWF4RHVtbXlTY3JvbGxEaXZTY3JvbGwob25jb3ByaW50KTtcblx0XHQgICAgdmFyIG1heGltdW1fZGl2X3Njcm9sbF9sZWZ0ID0gbWF4aW11bV9kdW1teV9zY3JvbGxfZGl2X3Njcm9sbC5sZWZ0O1xuXHRcdCAgICB2YXIgbWF4aW11bV9kaXZfc2Nyb2xsX3RvcCA9IG1heGltdW1fZHVtbXlfc2Nyb2xsX2Rpdl9zY3JvbGwudG9wO1xuXHRcdCAgICB2YXIgc2Nyb2xsX2xlZnRfcHJvcCA9IG1heGltdW1fZGl2X3Njcm9sbF9sZWZ0ID4gMCA/IGR1bW15X3Njcm9sbF9sZWZ0IC8gbWF4aW11bV9kaXZfc2Nyb2xsX2xlZnQgOiAwO1xuXHRcdCAgICB2YXIgc2Nyb2xsX3RvcF9wcm9wID0gbWF4aW11bV9kaXZfc2Nyb2xsX3RvcCA+IDAgPyBkdW1teV9zY3JvbGxfdG9wIC8gbWF4aW11bV9kaXZfc2Nyb2xsX3RvcCA6IDA7XG5cdFx0ICAgIHNjcm9sbF9sZWZ0X3Byb3AgPSBjbGFtcChzY3JvbGxfbGVmdF9wcm9wLCAwLCAxKTtcblx0XHQgICAgc2Nyb2xsX3RvcF9wcm9wID0gY2xhbXAoc2Nyb2xsX3RvcF9wcm9wLCAwLCAxKTtcblx0XHQgICAgdmFyIG1heGltdW1fc2Nyb2xsX2xlZnQgPSBtYXhPbmNvcHJpbnRTY3JvbGxMZWZ0KHNlbGYpO1xuXHRcdCAgICB2YXIgbWF4aW11bV9zY3JvbGxfdG9wID0gbWF4T25jb3ByaW50U2Nyb2xsVG9wKHNlbGYpO1xuXHRcdCAgICB2YXIgc2Nyb2xsX2xlZnQgPSBNYXRoLnJvdW5kKG1heGltdW1fc2Nyb2xsX2xlZnQgKiBzY3JvbGxfbGVmdF9wcm9wKTtcblx0XHQgICAgdmFyIHNjcm9sbF90b3AgPSBNYXRoLnJvdW5kKG1heGltdW1fc2Nyb2xsX3RvcCAqIHNjcm9sbF90b3BfcHJvcCk7XG5cdFx0ICAgIHNlbGYua2VlcF9ob3J6X3pvb21lZF90b19maXQgPSBmYWxzZTtcblxuXHRcdCAgICBkb1NldFNjcm9sbChzZWxmLCBzY3JvbGxfbGVmdCwgc2Nyb2xsX3RvcCk7XG5cdFx0fVxuXHQgICAgfSk7XG5cdH0pKCk7XG5cdFxuXHR0aGlzLmhvcnpfem9vbV9jYWxsYmFja3MgPSBbXTtcblx0dGhpcy5taW5pbWFwX2Nsb3NlX2NhbGxiYWNrcyA9IFtdO1xuXHRcblx0XG5cdCQod2luZG93KS5yZXNpemUoZnVuY3Rpb24oKSB7XG5cdCAgICByZXNpemVBbmRPcmdhbml6ZShzZWxmKTtcblx0fSk7XG5cdFxuXHRcblx0dGhpcy5pZF9jbGlwYm9hcmQgPSBbXTtcblx0dGhpcy5jbGlwYm9hcmRfY2hhbmdlX2NhbGxiYWNrcyA9IFtdO1xuICAgIH1cblxuICAgIHZhciBfU2V0TGVnZW5kVG9wID0gZnVuY3Rpb24gKG9uY29wcmludCkge1xuXHRpZiAob25jb3ByaW50Lm1vZGVsLnJlbmRlcmluZ19zdXBwcmVzc2VkX2RlcHRoID4gMCkge1xuXHQgICAgcmV0dXJuO1xuXHR9XG5cdG9uY29wcmludC4kbGVnZW5kX2Rpdi5jc3Moeyd0b3AnOiBvbmNvcHJpbnQubW9kZWwuZ2V0Q2VsbFZpZXdIZWlnaHQoKSArIDMwfSk7XG4gICAgfTtcbiAgICB2YXIgc2V0TGVnZW5kVG9wQWZ0ZXJUaW1lb3V0ID0gZnVuY3Rpb24gKG9uY29wcmludCkge1xuXHRpZiAob25jb3ByaW50Lm1vZGVsLnJlbmRlcmluZ19zdXBwcmVzc2VkX2RlcHRoID4gMCkge1xuXHQgICAgcmV0dXJuO1xuXHR9XG5cdHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuXHQgICAgb25jb3ByaW50LiRjdHIuY3NzKHsnbWluLWhlaWdodCc6IG9uY29wcmludC5tb2RlbC5nZXRDZWxsVmlld0hlaWdodCgpICsgTWF0aC5tYXgob25jb3ByaW50LiRsZWdlbmRfZGl2Lm91dGVySGVpZ2h0KCksIG9uY29wcmludC4kbWluaW1hcF9kaXYub3V0ZXJIZWlnaHQoKSkgKyAzMH0pO1xuXHQgICAgX1NldExlZ2VuZFRvcChvbmNvcHJpbnQpO1xuXHR9LCAwKTtcbiAgICB9O1xuXG4gICAgdmFyIHJlc2l6ZUFuZE9yZ2FuaXplID0gZnVuY3Rpb24gKG9uY29wcmludCkge1xuXHRpZiAob25jb3ByaW50Lm1vZGVsLnJlbmRlcmluZ19zdXBwcmVzc2VkX2RlcHRoID4gMCkge1xuXHQgICAgcmV0dXJuO1xuXHR9XG5cdHZhciBjdHJfd2lkdGggPSAkKG9uY29wcmludC5jdHJfc2VsZWN0b3IpLndpZHRoKCk7XG5cdG9uY29wcmludC4kdHJhY2tfb3B0aW9uc19kaXYuY3NzKHsnbGVmdCc6IG9uY29wcmludC5sYWJlbF92aWV3LmdldFdpZHRoKCl9KTtcblx0b25jb3ByaW50LiR0cmFja19pbmZvX2Rpdi5jc3MoeydsZWZ0Jzogb25jb3ByaW50LmxhYmVsX3ZpZXcuZ2V0V2lkdGgoKSArIG9uY29wcmludC50cmFja19vcHRpb25zX3ZpZXcuZ2V0V2lkdGgoKX0pO1xuXHR2YXIgY2VsbF9kaXZfbGVmdCA9IG9uY29wcmludC5sYWJlbF92aWV3LmdldFdpZHRoKCkgKyBvbmNvcHJpbnQudHJhY2tfb3B0aW9uc192aWV3LmdldFdpZHRoKCkgKyBvbmNvcHJpbnQudHJhY2tfaW5mb192aWV3LmdldFdpZHRoKCk7XG5cdG9uY29wcmludC4kY2VsbF9kaXYuY3NzKCdsZWZ0JywgY2VsbF9kaXZfbGVmdCk7XG5cdG9uY29wcmludC5jZWxsX3ZpZXcuc2V0V2lkdGgoY3RyX3dpZHRoIC0gY2VsbF9kaXZfbGVmdCAtIDIwLCBvbmNvcHJpbnQubW9kZWwpO1xuXG5cdF9TZXRMZWdlbmRUb3Aob25jb3ByaW50KTtcblx0b25jb3ByaW50LmxlZ2VuZF92aWV3LnNldFdpZHRoKGN0cl93aWR0aCAtIG9uY29wcmludC4kbWluaW1hcF9kaXYub3V0ZXJXaWR0aCgpIC0gMjAsIG9uY29wcmludC5tb2RlbCk7XG5cblx0b25jb3ByaW50LiRjdHIuY3NzKHsnbWluLWhlaWdodCc6IG9uY29wcmludC5tb2RlbC5nZXRDZWxsVmlld0hlaWdodCgpICsgTWF0aC5tYXgob25jb3ByaW50LiRsZWdlbmRfZGl2Lm91dGVySGVpZ2h0KCksIG9uY29wcmludC4kbWluaW1hcF9kaXYub3V0ZXJIZWlnaHQoKSkgKyAzMCxcblx0ICAgICdtaW4td2lkdGgnOiBjdHJfd2lkdGh9KTtcblxuXHRzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcblx0ICAgIGlmIChvbmNvcHJpbnQua2VlcF9ob3J6X3pvb21lZF90b19maXQpIHtcblx0XHR1cGRhdGVIb3J6Wm9vbVRvRml0KG9uY29wcmludCk7XG5cdCAgICB9XG5cdH0sIDApO1xuICAgIH07XG5cbiAgICB2YXIgcmVzaXplQW5kT3JnYW5pemVBZnRlclRpbWVvdXQgPSBmdW5jdGlvbiAob25jb3ByaW50KSB7XG5cdGlmIChvbmNvcHJpbnQubW9kZWwucmVuZGVyaW5nX3N1cHByZXNzZWRfZGVwdGggPiAwKSB7XG5cdCAgICByZXR1cm47XG5cdH1cblx0c2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG5cdCAgICByZXNpemVBbmRPcmdhbml6ZShvbmNvcHJpbnQpO1xuXHR9LCAwKTtcbiAgICB9O1xuICAgIFxuICAgIHZhciBtYXhPbmNvcHJpbnRTY3JvbGxMZWZ0ID0gZnVuY3Rpb24ob25jb3ByaW50KSB7XG5cdHJldHVybiBNYXRoLm1heCgwLCBvbmNvcHJpbnQubW9kZWwuZ2V0T25jb3ByaW50V2lkdGgoKSAtIG9uY29wcmludC5jZWxsX3ZpZXcuZ2V0V2lkdGgoKSk7XG4gICAgfTtcbiAgICBcbiAgICB2YXIgbWF4T25jb3ByaW50U2Nyb2xsVG9wID0gZnVuY3Rpb24ob25jb3ByaW50KSB7XG5cdHJldHVybiBNYXRoLm1heCgwLCBvbmNvcHJpbnQubW9kZWwuZ2V0T25jb3ByaW50SGVpZ2h0KCkgLSBvbmNvcHJpbnQubW9kZWwuZ2V0Q2VsbFZpZXdIZWlnaHQoKSk7XG4gICAgfTtcbiAgICBcbiAgICB2YXIgbWF4RHVtbXlTY3JvbGxEaXZTY3JvbGwgPSBmdW5jdGlvbihvbmNvcHJpbnQpIHtcblx0dmFyIGR1bW15X3Njcm9sbF9kaXZfY2xpZW50X3NpemUgPSBvbmNvcHJpbnQuY2VsbF92aWV3LmdldER1bW15U2Nyb2xsRGl2Q2xpZW50U2l6ZSgpO1xuXHR2YXIgbWF4aW11bV9kaXZfc2Nyb2xsX2xlZnQgPSBNYXRoLm1heCgwLCAob25jb3ByaW50LiRkdW1teV9zY3JvbGxfZGl2WzBdLnNjcm9sbFdpZHRoIC0gZHVtbXlfc2Nyb2xsX2Rpdl9jbGllbnRfc2l6ZS53aWR0aCkpO1xuXHR2YXIgbWF4aW11bV9kaXZfc2Nyb2xsX3RvcCA9IE1hdGgubWF4KDAsIChvbmNvcHJpbnQuJGR1bW15X3Njcm9sbF9kaXZbMF0uc2Nyb2xsSGVpZ2h0IC0gZHVtbXlfc2Nyb2xsX2Rpdl9jbGllbnRfc2l6ZS5oZWlnaHQpKTtcblx0cmV0dXJuIHsnbGVmdCc6IG1heGltdW1fZGl2X3Njcm9sbF9sZWZ0LCAndG9wJzogbWF4aW11bV9kaXZfc2Nyb2xsX3RvcH07XG4gICAgfTtcbiAgICBcbiAgICBPbmNvcHJpbnQucHJvdG90eXBlLnNldE1pbmltYXBWaXNpYmxlID0gZnVuY3Rpb24gKHZpc2libGUpIHtcblx0aWYgKHZpc2libGUpIHtcblx0ICAgIHRoaXMuJG1pbmltYXBfZGl2LmNzcyh7J2Rpc3BsYXknOiAnYmxvY2snLCAndG9wJzogdGhpcy5tb2RlbC5nZXRDZWxsVmlld0hlaWdodCgpICsgMzAsICdsZWZ0JzogJCh0aGlzLmN0cl9zZWxlY3Rvcikud2lkdGgoKSAtIHRoaXMuJG1pbmltYXBfZGl2Lm91dGVyV2lkdGgoKSAtIDEwfSk7XG5cdH0gZWxzZSB7XG5cdCAgICB0aGlzLiRtaW5pbWFwX2Rpdi5jc3MoJ2Rpc3BsYXknLCAnbm9uZScpO1xuXHQgICAgZXhlY3V0ZU1pbmltYXBDbG9zZUNhbGxiYWNrcyh0aGlzKTtcblx0fVxuICAgIH1cbiAgICBcbiAgICBPbmNvcHJpbnQucHJvdG90eXBlLnNjcm9sbFRvID0gZnVuY3Rpb24obGVmdCkge1xuXHR0aGlzLiRkdW1teV9zY3JvbGxfZGl2LnNjcm9sbExlZnQobGVmdCk7XG4gICAgfVxuICAgIE9uY29wcmludC5wcm90b3R5cGUub25Ib3J6Wm9vbSA9IGZ1bmN0aW9uKGNhbGxiYWNrKSB7XG5cdHRoaXMuaG9yel96b29tX2NhbGxiYWNrcy5wdXNoKGNhbGxiYWNrKTtcbiAgICB9XG4gICAgT25jb3ByaW50LnByb3RvdHlwZS5vbk1pbmltYXBDbG9zZSA9IGZ1bmN0aW9uKGNhbGxiYWNrKSB7XG5cdHRoaXMubWluaW1hcF9jbG9zZV9jYWxsYmFja3MucHVzaChjYWxsYmFjayk7XG4gICAgfVxuICAgIE9uY29wcmludC5wcm90b3R5cGUubW92ZVRyYWNrID0gZnVuY3Rpb24odGFyZ2V0X3RyYWNrLCBuZXdfcHJldmlvdXNfdHJhY2spIHtcblx0dGhpcy5tb2RlbC5tb3ZlVHJhY2sodGFyZ2V0X3RyYWNrLCBuZXdfcHJldmlvdXNfdHJhY2spO1xuXHR0aGlzLmNlbGxfdmlldy5tb3ZlVHJhY2sodGhpcy5tb2RlbCk7XG5cdHRoaXMubGFiZWxfdmlldy5tb3ZlVHJhY2sodGhpcy5tb2RlbCk7XG5cdHRoaXMudHJhY2tfb3B0aW9uc192aWV3Lm1vdmVUcmFjayh0aGlzLm1vZGVsKTtcblx0dGhpcy50cmFja19pbmZvX3ZpZXcubW92ZVRyYWNrKHRoaXMubW9kZWwpO1xuXHR0aGlzLm1pbmltYXBfdmlldy5tb3ZlVHJhY2sodGhpcy5tb2RlbCwgdGhpcy5jZWxsX3ZpZXcpO1xuXHRcblx0aWYgKHRoaXMua2VlcF9zb3J0ZWQpIHtcblx0ICAgIHRoaXMuc29ydCgpO1xuXHR9XG5cdFxuXHRyZXNpemVBbmRPcmdhbml6ZUFmdGVyVGltZW91dCh0aGlzKTtcbiAgICB9XG4gICAgT25jb3ByaW50LnByb3RvdHlwZS5zZXRUcmFja0dyb3VwT3JkZXIgPSBmdW5jdGlvbihpbmRleCwgdHJhY2tfb3JkZXIpIHtcblx0dGhpcy5tb2RlbC5zZXRUcmFja0dyb3VwT3JkZXIoaW5kZXgsIHRyYWNrX29yZGVyKTtcblx0dGhpcy5jZWxsX3ZpZXcuc2V0VHJhY2tHcm91cE9yZGVyKHRoaXMubW9kZWwpO1xuXHR0aGlzLmxhYmVsX3ZpZXcuc2V0VHJhY2tHcm91cE9yZGVyKHRoaXMubW9kZWwpO1xuXHR0aGlzLnRyYWNrX29wdGlvbnNfdmlldy5zZXRUcmFja0dyb3VwT3JkZXIodGhpcy5tb2RlbCk7XG5cdHRoaXMudHJhY2tfaW5mb192aWV3LnNldFRyYWNrR3JvdXBPcmRlcih0aGlzLm1vZGVsKTtcblx0XG5cdGlmICh0aGlzLmtlZXBfc29ydGVkKSB7XG5cdCAgICB0aGlzLnNvcnQoKTtcblx0fVxuXHRcblx0cmVzaXplQW5kT3JnYW5pemVBZnRlclRpbWVvdXQodGhpcyk7XG4gICAgfVxuICAgIFxuICAgIE9uY29wcmludC5wcm90b3R5cGUua2VlcFNvcnRlZCA9IGZ1bmN0aW9uKGtlZXBfc29ydGVkKSB7XG5cdHRoaXMua2VlcF9zb3J0ZWQgPSAodHlwZW9mIGtlZXBfc29ydGVkID09PSAndW5kZWZpbmVkJyA/IHRydWUgOiBrZWVwX3NvcnRlZCk7XG5cdGlmICh0aGlzLmtlZXBfc29ydGVkKSB7XG5cdCAgICB0aGlzLnNvcnQoKTtcblx0fVxuICAgIH1cbiAgICBcbiAgICBPbmNvcHJpbnQucHJvdG90eXBlLmFkZFRyYWNrcyA9IGZ1bmN0aW9uIChwYXJhbXNfbGlzdCkge1xuXHQvLyBVcGRhdGUgbW9kZWxcblx0dmFyIHRyYWNrX2lkcyA9IFtdO1xuXHRwYXJhbXNfbGlzdCA9IHBhcmFtc19saXN0Lm1hcChmdW5jdGlvbiAobykge1xuXHQgICAgby50cmFja19pZCA9IG5leHRUcmFja0lkKCk7XG5cdCAgICBvLnJ1bGVfc2V0ID0gT25jb3ByaW50UnVsZVNldChvLnJ1bGVfc2V0X3BhcmFtcyk7XG5cdCAgICB0cmFja19pZHMucHVzaChvLnRyYWNrX2lkKTtcblx0ICAgIHJldHVybiBvO1xuXHR9KTtcblx0XG5cdHRoaXMubW9kZWwuYWRkVHJhY2tzKHBhcmFtc19saXN0KTtcblx0Ly8gVXBkYXRlIHZpZXdzXG5cdHRoaXMuY2VsbF92aWV3LmFkZFRyYWNrcyh0aGlzLm1vZGVsLCB0cmFja19pZHMpO1xuXHR0aGlzLmxhYmVsX3ZpZXcuYWRkVHJhY2tzKHRoaXMubW9kZWwsIHRyYWNrX2lkcyk7XG5cdHRoaXMudHJhY2tfb3B0aW9uc192aWV3LmFkZFRyYWNrcyh0aGlzLm1vZGVsKTtcblx0dGhpcy50cmFja19pbmZvX3ZpZXcuYWRkVHJhY2tzKHRoaXMubW9kZWwpO1xuXHR0aGlzLmxlZ2VuZF92aWV3LmFkZFRyYWNrcyh0aGlzLm1vZGVsKTtcblx0dGhpcy5taW5pbWFwX3ZpZXcuYWRkVHJhY2tzKHRoaXMubW9kZWwsIHRoaXMuY2VsbF92aWV3KTtcblx0XG5cdGlmICh0aGlzLmtlZXBfc29ydGVkKSB7XG5cdCAgICB0aGlzLnNvcnQoKTtcblx0fVxuXHRyZXNpemVBbmRPcmdhbml6ZUFmdGVyVGltZW91dCh0aGlzKTtcblx0cmV0dXJuIHRyYWNrX2lkcztcbiAgICB9XG5cbiAgICBPbmNvcHJpbnQucHJvdG90eXBlLnJlbW92ZVRyYWNrID0gZnVuY3Rpb24gKHRyYWNrX2lkKSB7XG5cdC8vIFVwZGF0ZSBtb2RlbFxuXHR0aGlzLm1vZGVsLnJlbW92ZVRyYWNrKHRyYWNrX2lkKTtcblx0Ly8gVXBkYXRlIHZpZXdzXG5cdHRoaXMuY2VsbF92aWV3LnJlbW92ZVRyYWNrKHRoaXMubW9kZWwsIHRyYWNrX2lkKTtcblx0dGhpcy5sYWJlbF92aWV3LnJlbW92ZVRyYWNrKHRoaXMubW9kZWwsIHRyYWNrX2lkKTtcblx0dGhpcy50cmFja19vcHRpb25zX3ZpZXcucmVtb3ZlVHJhY2sodGhpcy5tb2RlbCwgdHJhY2tfaWQpO1xuXHR0aGlzLnRyYWNrX2luZm9fdmlldy5yZW1vdmVUcmFjayh0aGlzLm1vZGVsKTtcblx0dGhpcy5sZWdlbmRfdmlldy5yZW1vdmVUcmFjayh0aGlzLm1vZGVsKTtcblx0dGhpcy5taW5pbWFwX3ZpZXcucmVtb3ZlVHJhY2sodGhpcy5tb2RlbCwgdGhpcy5jZWxsX3ZpZXcpO1xuXHRcblx0aWYgKHRoaXMua2VlcF9zb3J0ZWQpIHtcblx0ICAgIHRoaXMuc29ydCgpO1xuXHR9XG5cdHJlc2l6ZUFuZE9yZ2FuaXplQWZ0ZXJUaW1lb3V0KHRoaXMpO1xuICAgIH1cbiAgICBcbiAgICBPbmNvcHJpbnQucHJvdG90eXBlLnJlbW92ZVRyYWNrcyA9IGZ1bmN0aW9uKHRyYWNrX2lkcykge1xuXHR0aGlzLmtlZXBTb3J0ZWQoZmFsc2UpO1xuXHR0aGlzLnN1cHByZXNzUmVuZGVyaW5nKCk7XG5cdGZvciAodmFyIGk9MDsgaTx0cmFja19pZHMubGVuZ3RoOyBpKyspIHtcblx0ICAgIHRoaXMucmVtb3ZlVHJhY2sodHJhY2tfaWRzW2ldKTtcblx0fVxuXHR0aGlzLmtlZXBTb3J0ZWQodHJ1ZSk7XG5cdHRoaXMucmVsZWFzZVJlbmRlcmluZygpO1xuICAgIH1cbiAgICBcbiAgICBPbmNvcHJpbnQucHJvdG90eXBlLmdldFRyYWNrcyA9IGZ1bmN0aW9uKCkge1xuXHRyZXR1cm4gdGhpcy5tb2RlbC5nZXRUcmFja3MoKS5zbGljZSgpO1xuICAgIH1cbiAgICBcbiAgICBPbmNvcHJpbnQucHJvdG90eXBlLnJlbW92ZUFsbFRyYWNrcyA9IGZ1bmN0aW9uKCkge1xuXHR2YXIgdHJhY2tfaWRzID0gdGhpcy5tb2RlbC5nZXRUcmFja3MoKTtcblx0dGhpcy5yZW1vdmVUcmFja3ModHJhY2tfaWRzKTtcbiAgICB9XG5cbiAgICBPbmNvcHJpbnQucHJvdG90eXBlLnNldEhvcnpab29tVG9GaXQgPSBmdW5jdGlvbihpZHMpIHtcblx0dGhpcy5rZWVwX2hvcnpfem9vbWVkX3RvX2ZpdCA9IHRydWU7XG5cdHRoaXMudXBkYXRlSG9yelpvb21Ub0ZpdElkcyhpZHMpO1xuXHR1cGRhdGVIb3J6Wm9vbVRvRml0KHRoaXMpO1xuICAgIH1cbiAgICBPbmNvcHJpbnQucHJvdG90eXBlLnVwZGF0ZUhvcnpab29tVG9GaXRJZHMgPSBmdW5jdGlvbihpZHMpIHtcblx0dGhpcy5rZWVwX2hvcnpfem9vbWVkX3RvX2ZpdF9pZHMgPSBpZHMuc2xpY2UoKTtcbiAgICB9XG4gICAgdmFyIHVwZGF0ZUhvcnpab29tVG9GaXQgPSBmdW5jdGlvbihvbmNvcHJpbnQpIHtcblx0b25jb3ByaW50LnNldEhvcnpab29tKGdldEhvcnpab29tVG9GaXQob25jb3ByaW50LCBvbmNvcHJpbnQua2VlcF9ob3J6X3pvb21lZF90b19maXRfaWRzKSwgdHJ1ZSk7XG4gICAgfTtcbiAgICB2YXIgZ2V0SG9yelpvb21Ub0ZpdCA9IGZ1bmN0aW9uKG9uY29wcmludCwgaWRzKSB7XG5cdGlkcyA9IGlkcyB8fCBbXTtcblx0cmV0dXJuIG9uY29wcmludC5tb2RlbC5nZXRIb3J6Wm9vbVRvRml0KG9uY29wcmludC5jZWxsX3ZpZXcudmlzaWJsZV9hcmVhX3dpZHRoLCBpZHMpO1xuICAgIH1cbiAgICB2YXIgZXhlY3V0ZUhvcnpab29tQ2FsbGJhY2tzID0gZnVuY3Rpb24ob25jb3ByaW50KSB7XG5cdGZvciAodmFyIGk9MDsgaTxvbmNvcHJpbnQuaG9yel96b29tX2NhbGxiYWNrcy5sZW5ndGg7IGkrKykge1xuXHQgICAgb25jb3ByaW50Lmhvcnpfem9vbV9jYWxsYmFja3NbaV0ob25jb3ByaW50Lm1vZGVsLmdldEhvcnpab29tKCkpO1xuXHR9XG4gICAgfTtcbiAgICBcbiAgICB2YXIgZXhlY3V0ZU1pbmltYXBDbG9zZUNhbGxiYWNrcyA9IGZ1bmN0aW9uKG9uY29wcmludCkge1xuXHRmb3IgKHZhciBpPTA7IGk8b25jb3ByaW50Lm1pbmltYXBfY2xvc2VfY2FsbGJhY2tzLmxlbmd0aDsgaSsrKSB7XG5cdCAgICBvbmNvcHJpbnQubWluaW1hcF9jbG9zZV9jYWxsYmFja3NbaV0oKTtcblx0fVxuICAgIH07XG4gICAgXG4gICAgT25jb3ByaW50LnByb3RvdHlwZS5nZXRIb3J6Wm9vbSA9IGZ1bmN0aW9uICgpIHtcblx0cmV0dXJuIHRoaXMubW9kZWwuZ2V0SG9yelpvb20oKTtcbiAgICB9XG4gICAgXG5cbiAgICBPbmNvcHJpbnQucHJvdG90eXBlLnNldEhvcnpab29tID0gZnVuY3Rpb24gKHosIHN0aWxsX2tlZXBfaG9yel96b29tZWRfdG9fZml0KSB7XG5cdHRoaXMua2VlcF9ob3J6X3pvb21lZF90b19maXQgPSB0aGlzLmtlZXBfaG9yel96b29tZWRfdG9fZml0ICYmIHN0aWxsX2tlZXBfaG9yel96b29tZWRfdG9fZml0XG5cdC8vIFVwZGF0ZSBtb2RlbFxuXHR0aGlzLm1vZGVsLnNldEhvcnpab29tKHopO1xuXHQvLyBVcGRhdGUgdmlld3Ncblx0dGhpcy5jZWxsX3ZpZXcuc2V0SG9yelpvb20odGhpcy5tb2RlbCk7XG5cdHRoaXMubWluaW1hcF92aWV3LnNldEhvcnpab29tKHRoaXMubW9kZWwsIHRoaXMuY2VsbF92aWV3KTtcblxuXHRleGVjdXRlSG9yelpvb21DYWxsYmFja3ModGhpcyk7XG5cdHJldHVybiB0aGlzLm1vZGVsLmdldEhvcnpab29tKCk7XG4gICAgfVxuICAgIFxuICAgIE9uY29wcmludC5wcm90b3R5cGUuZ2V0VmVydFpvb20gPSBmdW5jdGlvbiAoKSB7XG5cdHJldHVybiB0aGlzLm1vZGVsLmdldFZlcnRab29tKCk7XG4gICAgfVxuXG4gICAgT25jb3ByaW50LnByb3RvdHlwZS5zZXRWZXJ0Wm9vbSA9IGZ1bmN0aW9uICh6KSB7XG5cdC8vIFVwZGF0ZSBtb2RlbFxuXHR0aGlzLm1vZGVsLnNldFZlcnRab29tKHopO1xuXHQvLyBVcGRhdGUgdmlld3Ncblx0dGhpcy5jZWxsX3ZpZXcuc2V0VmVydFpvb20odGhpcy5tb2RlbCwgeik7XG5cdHRoaXMubGFiZWxfdmlldy5zZXRWZXJ0Wm9vbSh0aGlzLm1vZGVsLCB6KTtcblx0dGhpcy50cmFja19pbmZvX3ZpZXcuc2V0VmVydFpvb20odGhpcy5tb2RlbCk7XG5cdHRoaXMudHJhY2tfb3B0aW9uc192aWV3LnNldFZlcnRab29tKHRoaXMubW9kZWwpO1xuXHR0aGlzLm1pbmltYXBfdmlldy5zZXRWZXJ0Wm9vbSh0aGlzLm1vZGVsLCB0aGlzLmNlbGxfdmlldyk7XG5cdFxuXHRyZXNpemVBbmRPcmdhbml6ZUFmdGVyVGltZW91dCh0aGlzKTtcblx0cmV0dXJuIHRoaXMubW9kZWwuZ2V0VmVydFpvb20oKTtcbiAgICB9XG4gICAgXG4gICAgdmFyIGRvU2V0U2Nyb2xsID0gZnVuY3Rpb24ob25jb3ByaW50LCBzY3JvbGxfbGVmdCwgc2Nyb2xsX3RvcCkge1xuXHQvLyBVcGRhdGUgbW9kZWxcblx0c2Nyb2xsX2xlZnQgPSBNYXRoLm1pbihzY3JvbGxfbGVmdCwgbWF4T25jb3ByaW50U2Nyb2xsTGVmdChvbmNvcHJpbnQpKTtcblx0c2Nyb2xsX3RvcCA9IE1hdGgubWluKHNjcm9sbF90b3AsIG1heE9uY29wcmludFNjcm9sbFRvcChvbmNvcHJpbnQpKTtcblx0b25jb3ByaW50Lm1vZGVsLnNldFNjcm9sbChzY3JvbGxfbGVmdCwgc2Nyb2xsX3RvcCk7XG5cdC8vIFVwZGF0ZSB2aWV3c1xuXHRcblx0b25jb3ByaW50LmNlbGxfdmlldy5zZXRTY3JvbGwob25jb3ByaW50Lm1vZGVsKTtcblx0b25jb3ByaW50LmxhYmVsX3ZpZXcuc2V0U2Nyb2xsKG9uY29wcmludC5tb2RlbCk7XG5cdG9uY29wcmludC50cmFja19pbmZvX3ZpZXcuc2V0U2Nyb2xsKG9uY29wcmludC5tb2RlbCk7XG5cdG9uY29wcmludC50cmFja19vcHRpb25zX3ZpZXcuc2V0U2Nyb2xsKG9uY29wcmludC5tb2RlbCk7XG5cdG9uY29wcmludC5taW5pbWFwX3ZpZXcuc2V0U2Nyb2xsKG9uY29wcmludC5tb2RlbCwgb25jb3ByaW50LmNlbGxfdmlldyk7XG4gICAgfTtcbiBcbiAgICB2YXIgc2V0RHVtbXlTY3JvbGxEaXZTY3JvbGwgPSBmdW5jdGlvbihvbmNvcHJpbnQpIHtcblx0dmFyIHNjcm9sbF9sZWZ0ID0gb25jb3ByaW50Lm1vZGVsLmdldEhvcnpTY3JvbGwoKTtcblx0dmFyIHNjcm9sbF90b3AgPSBvbmNvcHJpbnQubW9kZWwuZ2V0VmVydFNjcm9sbCgpO1xuXHRcblx0dmFyIG1heGltdW1fc2Nyb2xsX2xlZnQgPSBtYXhPbmNvcHJpbnRTY3JvbGxMZWZ0KG9uY29wcmludCk7XG5cdHZhciBtYXhpbXVtX3Njcm9sbF90b3AgPSBtYXhPbmNvcHJpbnRTY3JvbGxUb3Aob25jb3ByaW50KTtcblx0dmFyIG9uY19zY3JvbGxfbGVmdF9wcm9wID0gbWF4aW11bV9zY3JvbGxfbGVmdCA+IDAgPyBzY3JvbGxfbGVmdC9tYXhpbXVtX3Njcm9sbF9sZWZ0IDogMDtcblx0dmFyIG9uY19zY3JvbGxfdG9wX3Byb3AgPSBtYXhpbXVtX3Njcm9sbF90b3AgPiAwID8gc2Nyb2xsX3RvcC9tYXhpbXVtX3Njcm9sbF90b3AgOiAwO1xuXHRvbmNfc2Nyb2xsX2xlZnRfcHJvcCA9IGNsYW1wKG9uY19zY3JvbGxfbGVmdF9wcm9wLCAwLCAxKTtcblx0b25jX3Njcm9sbF90b3BfcHJvcCA9IGNsYW1wKG9uY19zY3JvbGxfdG9wX3Byb3AsIDAsIDEpO1xuXHRcblx0dmFyIG1heGltdW1fZHVtbXlfc2Nyb2xsX2Rpdl9zY3JvbGwgPSBtYXhEdW1teVNjcm9sbERpdlNjcm9sbChvbmNvcHJpbnQpO1xuXHR2YXIgbWF4aW11bV9kaXZfc2Nyb2xsX2xlZnQgPSBtYXhpbXVtX2R1bW15X3Njcm9sbF9kaXZfc2Nyb2xsLmxlZnQ7XG5cdHZhciBtYXhpbXVtX2Rpdl9zY3JvbGxfdG9wID0gbWF4aW11bV9kdW1teV9zY3JvbGxfZGl2X3Njcm9sbC50b3A7XG5cdFxuXHRvbmNvcHJpbnQudGFyZ2V0X2R1bW15X3Njcm9sbF9sZWZ0ID0gTWF0aC5yb3VuZChvbmNfc2Nyb2xsX2xlZnRfcHJvcCAqIG1heGltdW1fZGl2X3Njcm9sbF9sZWZ0KTtcblx0b25jb3ByaW50LnRhcmdldF9kdW1teV9zY3JvbGxfdG9wID0gTWF0aC5yb3VuZChvbmNfc2Nyb2xsX3RvcF9wcm9wICogbWF4aW11bV9kaXZfc2Nyb2xsX3RvcCk7XG5cdG9uY29wcmludC4kZHVtbXlfc2Nyb2xsX2Rpdi5zY3JvbGxMZWZ0KG9uY29wcmludC50YXJnZXRfZHVtbXlfc2Nyb2xsX2xlZnQpO1xuXHRvbmNvcHJpbnQuJGR1bW15X3Njcm9sbF9kaXYuc2Nyb2xsVG9wKG9uY29wcmludC50YXJnZXRfZHVtbXlfc2Nyb2xsX3RvcCk7XG4gICAgfTtcbiAgICBcbiAgICBPbmNvcHJpbnQucHJvdG90eXBlLnNldFNjcm9sbCA9IGZ1bmN0aW9uKHNjcm9sbF9sZWZ0LCBzY3JvbGxfdG9wKSB7XG5cdGRvU2V0U2Nyb2xsKHRoaXMsIHNjcm9sbF9sZWZ0LCBzY3JvbGxfdG9wKTtcblx0c2V0RHVtbXlTY3JvbGxEaXZTY3JvbGwodGhpcyk7XG4gICAgfVxuICAgIFxuICAgIE9uY29wcmludC5wcm90b3R5cGUuc2V0Wm9vbSA9IGZ1bmN0aW9uKHpvb21feCwgem9vbV95KSB7XG5cdC8vIFVwZGF0ZSBtb2RlbFxuXHR0aGlzLm1vZGVsLnNldFpvb20oem9vbV94LCB6b29tX3kpO1xuXHQvLyBVcGRhdGUgdmlld3Ncblx0dGhpcy5jZWxsX3ZpZXcuc2V0Wm9vbSh0aGlzLm1vZGVsKTtcblx0dGhpcy5sYWJlbF92aWV3LnNldFpvb20odGhpcy5tb2RlbCk7XG5cdHRoaXMudHJhY2tfaW5mb192aWV3LnNldFpvb20odGhpcy5tb2RlbCk7XG5cdHRoaXMudHJhY2tfb3B0aW9uc192aWV3LnNldFpvb20odGhpcy5tb2RlbCk7XG5cdHRoaXMubWluaW1hcF92aWV3LnNldFpvb20odGhpcy5tb2RlbCwgdGhpcy5jZWxsX3ZpZXcpO1xuICAgIH1cbiAgICBcbiAgICBPbmNvcHJpbnQucHJvdG90eXBlLnNldEhvcnpTY3JvbGwgPSBmdW5jdGlvbihzKSB7XG5cdC8vIFVwZGF0ZSBtb2RlbFxuXHR0aGlzLm1vZGVsLnNldEhvcnpTY3JvbGwoTWF0aC5taW4ocywgbWF4T25jb3ByaW50U2Nyb2xsTGVmdCh0aGlzKSkpO1xuXHQvLyBVcGRhdGUgdmlld3Ncblx0dGhpcy5jZWxsX3ZpZXcuc2V0SG9yelNjcm9sbCh0aGlzLm1vZGVsKTtcblx0dGhpcy5sYWJlbF92aWV3LnNldEhvcnpTY3JvbGwodGhpcy5tb2RlbCk7XG5cdHRoaXMudHJhY2tfaW5mb192aWV3LnNldEhvcnpTY3JvbGwodGhpcy5tb2RlbCk7XG5cdHRoaXMudHJhY2tfb3B0aW9uc192aWV3LnNldEhvcnpTY3JvbGwodGhpcy5tb2RlbCk7XG5cdHRoaXMubWluaW1hcF92aWV3LnNldEhvcnpTY3JvbGwodGhpcy5tb2RlbCwgdGhpcy5jZWxsX3ZpZXcpO1xuXHQvLyBVcGRhdGUgZHVtbXkgc2Nyb2xsIGRpdlxuXHRzZXREdW1teVNjcm9sbERpdlNjcm9sbCh0aGlzKTtcblx0XG5cdHJldHVybiB0aGlzLm1vZGVsLmdldEhvcnpTY3JvbGwoKTtcbiAgICB9XG4gICAgT25jb3ByaW50LnByb3RvdHlwZS5zZXRWZXJ0U2Nyb2xsID0gZnVuY3Rpb24ocykge1xuXHQvLyBVcGRhdGUgbW9kZWxcblx0dGhpcy5tb2RlbC5zZXRWZXJ0U2Nyb2xsKE1hdGgubWluKHMsIG1heE9uY29wcmludFNjcm9sbFRvcCh0aGlzKSkpO1xuXHQvLyBVcGRhdGUgdmlld3Ncblx0dGhpcy5jZWxsX3ZpZXcuc2V0VmVydFNjcm9sbCh0aGlzLm1vZGVsKTtcblx0dGhpcy5sYWJlbF92aWV3LnNldFZlcnRTY3JvbGwodGhpcy5tb2RlbCk7XG5cdHRoaXMudHJhY2tfaW5mb192aWV3LnNldFZlcnRTY3JvbGwodGhpcy5tb2RlbCk7XG5cdHRoaXMudHJhY2tfb3B0aW9uc192aWV3LnNldFZlcnRTY3JvbGwodGhpcy5tb2RlbCk7XG5cdHRoaXMubWluaW1hcF92aWV3LnNldFZlcnRTY3JvbGwodGhpcy5tb2RlbCwgdGhpcy5jZWxsX3ZpZXcpO1xuXHQvLyBVcGRhdGUgZHVtbXkgc2Nyb2xsIGRpdlxuXHRzZXREdW1teVNjcm9sbERpdlNjcm9sbCh0aGlzKTtcblx0XG5cdHJldHVybiB0aGlzLm1vZGVsLmdldFZlcnRTY3JvbGwoKTtcbiAgICB9XG4gICAgT25jb3ByaW50LnByb3RvdHlwZS5zZXRWaWV3cG9ydCA9IGZ1bmN0aW9uKGNvbCwgc2Nyb2xsX3lfcHJvcG9ydGlvbiwgbnVtX2NvbHMsIHpvb21feSkge1xuXHQvLyBab29tXG5cdHZhciB6b29tX3ggPSB0aGlzLm1vZGVsLmdldEhvcnpab29tVG9GaXROdW1Db2xzKHRoaXMuY2VsbF92aWV3LmdldFdpZHRoKCksIG51bV9jb2xzKTtcblx0dGhpcy5zZXRab29tKHpvb21feCwgem9vbV95KTtcblx0Ly8gU2Nyb2xsXG5cdHZhciBzY3JvbGxfbGVmdCA9IE1hdGgubWluKGNvbCAqICh0aGlzLm1vZGVsLmdldENlbGxXaWR0aCgpICsgdGhpcy5tb2RlbC5nZXRDZWxsUGFkZGluZygpKSwgbWF4T25jb3ByaW50U2Nyb2xsTGVmdCh0aGlzKSk7XG5cdHZhciBzY3JvbGxfdG9wID0gTWF0aC5taW4oc2Nyb2xsX3lfcHJvcG9ydGlvbip0aGlzLm1vZGVsLmdldE9uY29wcmludEhlaWdodCgpLCBtYXhPbmNvcHJpbnRTY3JvbGxUb3AodGhpcykpO1xuXHR0aGlzLnNldFNjcm9sbChzY3JvbGxfbGVmdCwgc2Nyb2xsX3RvcCk7XG5cdFxuXHRleGVjdXRlSG9yelpvb21DYWxsYmFja3ModGhpcyk7XG4gICAgfVxuXG4gICAgT25jb3ByaW50LnByb3RvdHlwZS5nZXRUcmFja0RhdGEgPSBmdW5jdGlvbiAodHJhY2tfaWQpIHtcblx0cmV0dXJuIHRoaXMubW9kZWwuZ2V0VHJhY2tEYXRhKHRyYWNrX2lkKTtcbiAgICB9XG4gICAgXG4gICAgT25jb3ByaW50LnByb3RvdHlwZS5nZXRUcmFja0RhdGFJZEtleSA9IGZ1bmN0aW9uKHRyYWNrX2lkKSB7XG5cdHJldHVybiB0aGlzLm1vZGVsLmdldFRyYWNrRGF0YUlkS2V5KHRyYWNrX2lkKTtcbiAgICB9XG4gICAgXG4gICAgLyoqXG4gICAgICogU2V0cyB0aGUgZGF0YSBmb3IgYW4gT25jb3ByaW50IHRyYWNrLlxuICAgICAqXG4gICAgICogQHBhcmFtIHRyYWNrX2lkIC0gdGhlIElEIHRoYXQgaWRlbnRpZmllcyB0aGUgdHJhY2tcbiAgICAgKiBAcGFyYW0ge09iamVjdFtdfSBkYXRhIC0gdGhlIGxpc3Qgb2YgZGF0YSBmb3IgdGhlIGNlbGxzXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IGRhdGFfaWRfa2V5IC0gbmFtZSBvZiB0aGUgcHJvcGVydHkgb2YgdGhlXG4gICAgICogZGF0YSBvYmplY3RzIHRvIHVzZSBhcyB0aGUgKGNvbHVtbikga2V5XG4gICAgICovXG4gICAgT25jb3ByaW50LnByb3RvdHlwZS5zZXRUcmFja0RhdGEgPSBmdW5jdGlvbiAodHJhY2tfaWQsIGRhdGEsIGRhdGFfaWRfa2V5KSB7XG5cdHRoaXMubW9kZWwuc2V0VHJhY2tEYXRhKHRyYWNrX2lkLCBkYXRhLCBkYXRhX2lkX2tleSk7XG5cdHRoaXMuY2VsbF92aWV3LnNldFRyYWNrRGF0YSh0aGlzLm1vZGVsLCB0cmFja19pZCk7XG5cdHRoaXMubGVnZW5kX3ZpZXcuc2V0VHJhY2tEYXRhKHRoaXMubW9kZWwpO1xuXHR0aGlzLm1pbmltYXBfdmlldy5zZXRUcmFja0RhdGEodGhpcy5tb2RlbCwgdGhpcy5jZWxsX3ZpZXcpO1xuXHRcblx0aWYgKHRoaXMua2VlcF9zb3J0ZWQpIHtcblx0ICAgIHRoaXMuc29ydCgpO1xuXHR9XG5cdHJlc2l6ZUFuZE9yZ2FuaXplQWZ0ZXJUaW1lb3V0KHRoaXMpO1xuICAgIH1cbiAgICBcbiAgICBPbmNvcHJpbnQucHJvdG90eXBlLnNldFRyYWNrR3JvdXBTb3J0UHJpb3JpdHkgPSBmdW5jdGlvbihwcmlvcml0eSkge1xuXHR0aGlzLm1vZGVsLnNldFRyYWNrR3JvdXBTb3J0UHJpb3JpdHkocHJpb3JpdHkpO1xuXHR0aGlzLmNlbGxfdmlldy5zZXRUcmFja0dyb3VwU29ydFByaW9yaXR5KHRoaXMubW9kZWwpO1xuXHRcblx0aWYgKHRoaXMua2VlcF9zb3J0ZWQpIHtcblx0ICAgIHRoaXMuc29ydCgpO1xuXHR9XG5cdHJlc2l6ZUFuZE9yZ2FuaXplQWZ0ZXJUaW1lb3V0KHRoaXMpO1xuICAgIH1cblxuICAgIE9uY29wcmludC5wcm90b3R5cGUuc2V0VHJhY2tTb3J0RGlyZWN0aW9uID0gZnVuY3Rpb24odHJhY2tfaWQsIGRpcikge1xuXHRpZiAodGhpcy5tb2RlbC5pc1RyYWNrU29ydERpcmVjdGlvbkNoYW5nZWFibGUodHJhY2tfaWQpKSB7XG5cdCAgICB0aGlzLm1vZGVsLnNldFRyYWNrU29ydERpcmVjdGlvbih0cmFja19pZCwgZGlyKTtcblx0ICAgIFxuXHQgICAgaWYgKHRoaXMua2VlcF9zb3J0ZWQpIHtcblx0XHR0aGlzLnNvcnQoKTtcblx0ICAgIH1cblx0fVxuXHRyZXR1cm4gdGhpcy5tb2RlbC5nZXRUcmFja1NvcnREaXJlY3Rpb24odHJhY2tfaWQpO1xuICAgIH1cbiAgICBcbiAgICBPbmNvcHJpbnQucHJvdG90eXBlLnNldFRyYWNrU29ydENvbXBhcmF0b3IgPSBmdW5jdGlvbih0cmFja19pZCwgc29ydENtcEZuKSB7XG5cdHRoaXMubW9kZWwuc2V0VHJhY2tTb3J0Q29tcGFyYXRvcih0cmFja19pZCwgc29ydENtcEZuKTtcblx0aWYgKHRoaXMua2VlcF9zb3J0ZWQpIHtcblx0ICAgIHRoaXMuc29ydCgpO1xuXHR9XG4gICAgfVxuICAgIFxuICAgIE9uY29wcmludC5wcm90b3R5cGUuZ2V0VHJhY2tTb3J0RGlyZWN0aW9uID0gZnVuY3Rpb24odHJhY2tfaWQpIHtcblx0cmV0dXJuIHRoaXMubW9kZWwuZ2V0VHJhY2tTb3J0RGlyZWN0aW9uKHRyYWNrX2lkKTtcbiAgICB9XG4gICAgXG4gICAgT25jb3ByaW50LnByb3RvdHlwZS5zZXRUcmFja0luZm8gPSBmdW5jdGlvbih0cmFja19pZCwgbXNnKSB7XG5cdHRoaXMubW9kZWwuc2V0VHJhY2tJbmZvKHRyYWNrX2lkLCBtc2cpO1xuXHR0aGlzLnRyYWNrX2luZm9fdmlldy5zZXRUcmFja0luZm8odGhpcy5tb2RlbCk7XG4gICAgfVxuICAgIFxuICAgIE9uY29wcmludC5wcm90b3R5cGUuc2V0VHJhY2tUb29sdGlwRm4gPSBmdW5jdGlvbih0cmFja19pZCwgdG9vbHRpcEZuKSB7XG5cdHRoaXMubW9kZWwuc2V0VHJhY2tUb29sdGlwRm4odHJhY2tfaWQsIHRvb2x0aXBGbik7XG4gICAgfVxuICAgIFxuICAgIE9uY29wcmludC5wcm90b3R5cGUuc29ydCA9IGZ1bmN0aW9uKCkge1xuXHR0aGlzLm1vZGVsLnNvcnQoKTtcblx0dGhpcy5jZWxsX3ZpZXcuc29ydCh0aGlzLm1vZGVsKTtcblx0dGhpcy5taW5pbWFwX3ZpZXcuc29ydCh0aGlzLm1vZGVsLCB0aGlzLmNlbGxfdmlldyk7XG4gICAgfVxuICAgIFxuICAgIE9uY29wcmludC5wcm90b3R5cGUuc2hhcmVSdWxlU2V0ID0gZnVuY3Rpb24oc291cmNlX3RyYWNrX2lkLCB0YXJnZXRfdHJhY2tfaWQpIHtcblx0dGhpcy5tb2RlbC5zaGFyZVJ1bGVTZXQoc291cmNlX3RyYWNrX2lkLCB0YXJnZXRfdHJhY2tfaWQpO1xuXHR0aGlzLmNlbGxfdmlldy5zaGFyZVJ1bGVTZXQodGhpcy5tb2RlbCwgdGFyZ2V0X3RyYWNrX2lkKTtcblx0dGhpcy5sZWdlbmRfdmlldy5zaGFyZVJ1bGVTZXQodGhpcy5tb2RlbCk7XG5cdHRoaXMubWluaW1hcF92aWV3LnNoYXJlUnVsZVNldCh0aGlzLm1vZGVsLCB0aGlzLmNlbGxfdmlldyk7XG4gICAgfVxuICAgIFxuICAgIE9uY29wcmludC5wcm90b3R5cGUuc2V0UnVsZVNldCA9IGZ1bmN0aW9uKHRyYWNrX2lkLCBydWxlX3NldF9wYXJhbXMpIHtcblx0dGhpcy5tb2RlbC5zZXRSdWxlU2V0KHRyYWNrX2lkLCBPbmNvcHJpbnRSdWxlU2V0KHJ1bGVfc2V0X3BhcmFtcykpO1xuXHR0aGlzLmNlbGxfdmlldy5zZXRSdWxlU2V0KHRoaXMubW9kZWwsIHRyYWNrX2lkKTtcblx0dGhpcy5sZWdlbmRfdmlldy5zZXRSdWxlU2V0KHRoaXMubW9kZWwpO1xuXHR0aGlzLm1pbmltYXBfdmlldy5zZXRSdWxlU2V0KHRoaXMubW9kZWwsIHRoaXMuY2VsbF92aWV3KTtcblx0cmVzaXplQW5kT3JnYW5pemVBZnRlclRpbWVvdXQodGhpcyk7XG4gICAgfVxuICAgIFxuICAgIE9uY29wcmludC5wcm90b3R5cGUuc2V0U29ydENvbmZpZyA9IGZ1bmN0aW9uKHBhcmFtcykge1xuXHR0aGlzLm1vZGVsLnNldFNvcnRDb25maWcocGFyYW1zKTtcblx0dGhpcy5jZWxsX3ZpZXcuc2V0U29ydENvbmZpZyh0aGlzLm1vZGVsKTtcblx0XG5cdGlmICh0aGlzLmtlZXBfc29ydGVkKSB7XG5cdCAgICB0aGlzLnNvcnQoKTtcblx0fVxuICAgIH1cbiAgICBPbmNvcHJpbnQucHJvdG90eXBlLnNldElkT3JkZXIgPSBmdW5jdGlvbihpZHMpIHtcblx0Ly8gVXBkYXRlIG1vZGVsXG5cdHRoaXMubW9kZWwuc2V0SWRPcmRlcihpZHMpO1xuXHQvLyBVcGRhdGUgdmlld3Ncblx0dGhpcy5jZWxsX3ZpZXcuc2V0SWRPcmRlcih0aGlzLm1vZGVsLCBpZHMpO1xuXHR0aGlzLm1pbmltYXBfdmlldy5zZXRJZE9yZGVyKHRoaXMubW9kZWwsIHRoaXMuY2VsbF92aWV3KTtcblx0XG5cdGlmICh0aGlzLmtlZXBfc29ydGVkKSB7XG5cdCAgICB0aGlzLnNvcnQoKTtcblx0fVxuICAgIH1cbiAgICBcbiAgICBPbmNvcHJpbnQucHJvdG90eXBlLmRpc2FibGVJbnRlcmFjdGlvbiA9IGZ1bmN0aW9uKCkge1xuXHQvL3RoaXMubGFiZWxfdmlldy5kaXNhYmxlSW50ZXJhY3Rpb24oKTtcblx0Ly90aGlzLmNlbGxfdmlldy5kaXNhYmxlSW50ZXJhY3Rpb24oKTtcblx0dGhpcy50cmFja19vcHRpb25zX3ZpZXcuZGlzYWJsZUludGVyYWN0aW9uKCk7XG5cdC8vdGhpcy50cmFja19pbmZvX3ZpZXcuZGlzYWJsZUludGVyYWN0aW9uKCk7XG5cdC8vdGhpcy5sZWdlbmRfdmlldy5kaXNhYmxlSW50ZXJhY3Rpb24oKTtcbiAgICB9XG4gICAgT25jb3ByaW50LnByb3RvdHlwZS5lbmFibGVJbnRlcmFjdGlvbiA9IGZ1bmN0aW9uKCkge1xuXHQvL3RoaXMubGFiZWxfdmlldy5lbmFibGVJbnRlcmFjdGlvbigpO1xuXHQvL3RoaXMuY2VsbF92aWV3LmVuYWJsZUludGVyYWN0aW9uKCk7XG5cdHRoaXMudHJhY2tfb3B0aW9uc192aWV3LmVuYWJsZUludGVyYWN0aW9uKCk7XG5cdC8vdGhpcy50cmFja19pbmZvX3ZpZXcuZW5hYmxlSW50ZXJhY3Rpb24oKTtcblx0Ly90aGlzLmxlZ2VuZF92aWV3LmVuYWJsZUludGVyYWN0aW9uKCk7XG4gICAgfVxuICAgIE9uY29wcmludC5wcm90b3R5cGUuc3VwcHJlc3NSZW5kZXJpbmcgPSBmdW5jdGlvbigpIHtcblx0dGhpcy5tb2RlbC5yZW5kZXJpbmdfc3VwcHJlc3NlZF9kZXB0aCArPSAxO1xuXHR0aGlzLmxhYmVsX3ZpZXcuc3VwcHJlc3NSZW5kZXJpbmcoKTtcblx0dGhpcy5jZWxsX3ZpZXcuc3VwcHJlc3NSZW5kZXJpbmcoKTtcblx0dGhpcy50cmFja19vcHRpb25zX3ZpZXcuc3VwcHJlc3NSZW5kZXJpbmcoKTtcblx0dGhpcy50cmFja19pbmZvX3ZpZXcuc3VwcHJlc3NSZW5kZXJpbmcoKTtcblx0dGhpcy5sZWdlbmRfdmlldy5zdXBwcmVzc1JlbmRlcmluZygpO1xuXHR0aGlzLm1pbmltYXBfdmlldy5zdXBwcmVzc1JlbmRlcmluZygpO1xuICAgIH1cbiAgICBcbiAgICBPbmNvcHJpbnQucHJvdG90eXBlLnJlbGVhc2VSZW5kZXJpbmcgPSBmdW5jdGlvbigpIHtcblx0dGhpcy5tb2RlbC5yZW5kZXJpbmdfc3VwcHJlc3NlZF9kZXB0aCAtPSAxO1xuXHR0aGlzLm1vZGVsLnJlbmRlcmluZ19zdXBwcmVzc2VkX2RlcHRoID0gTWF0aC5tYXgoMCwgdGhpcy5tb2RlbC5yZW5kZXJpbmdfc3VwcHJlc3NlZF9kZXB0aCk7XG5cdGlmICh0aGlzLm1vZGVsLnJlbmRlcmluZ19zdXBwcmVzc2VkX2RlcHRoID09PSAwKSB7XG5cdCAgICB0aGlzLmxhYmVsX3ZpZXcucmVsZWFzZVJlbmRlcmluZyh0aGlzLm1vZGVsKTtcblx0ICAgIHRoaXMuY2VsbF92aWV3LnJlbGVhc2VSZW5kZXJpbmcodGhpcy5tb2RlbCk7XG5cdCAgICB0aGlzLnRyYWNrX29wdGlvbnNfdmlldy5yZWxlYXNlUmVuZGVyaW5nKHRoaXMubW9kZWwpO1xuXHQgICAgdGhpcy50cmFja19pbmZvX3ZpZXcucmVsZWFzZVJlbmRlcmluZyh0aGlzLm1vZGVsKTtcblx0ICAgIHRoaXMubGVnZW5kX3ZpZXcucmVsZWFzZVJlbmRlcmluZyh0aGlzLm1vZGVsKTtcblx0ICAgIHRoaXMubWluaW1hcF92aWV3LnJlbGVhc2VSZW5kZXJpbmcodGhpcy5tb2RlbCwgdGhpcy5jZWxsX3ZpZXcpO1xuXHQgICAgcmVzaXplQW5kT3JnYW5pemVBZnRlclRpbWVvdXQodGhpcyk7XG5cdH1cbiAgICB9XG4gICAgXG4gICAgT25jb3ByaW50LnByb3RvdHlwZS5oaWRlSWRzID0gZnVuY3Rpb24odG9faGlkZSwgc2hvd19vdGhlcnMpIHtcblx0dGhpcy5tb2RlbC5oaWRlSWRzKHRvX2hpZGUsIHNob3dfb3RoZXJzKTtcblx0dGhpcy5jZWxsX3ZpZXcuaGlkZUlkcyh0aGlzLm1vZGVsKTtcblx0dGhpcy5taW5pbWFwX3ZpZXcuaGlkZUlkcyh0aGlzLm1vZGVsLCB0aGlzLmNlbGxfdmlldyk7XG4gICAgfVxuICAgIFxuICAgIE9uY29wcmludC5wcm90b3R5cGUuaGlkZVRyYWNrTGVnZW5kcyA9IGZ1bmN0aW9uKHRyYWNrX2lkcykge1xuXHR0cmFja19pZHMgPSBbXS5jb25jYXQodHJhY2tfaWRzKTtcblx0dGhpcy5tb2RlbC5oaWRlVHJhY2tMZWdlbmRzKHRyYWNrX2lkcyk7XG5cdHRoaXMubGVnZW5kX3ZpZXcuaGlkZVRyYWNrTGVnZW5kcyh0aGlzLm1vZGVsKTtcblx0c2V0TGVnZW5kVG9wQWZ0ZXJUaW1lb3V0KHRoaXMpO1xuICAgIH1cbiAgICBcbiAgICBPbmNvcHJpbnQucHJvdG90eXBlLnNob3dUcmFja0xlZ2VuZHMgPSBmdW5jdGlvbih0cmFja19pZHMpIHtcblx0dHJhY2tfaWRzID0gW10uY29uY2F0KHRyYWNrX2lkcyk7XG5cdHRoaXMubW9kZWwuc2hvd1RyYWNrTGVnZW5kcyh0cmFja19pZHMpO1xuXHR0aGlzLmxlZ2VuZF92aWV3LnNob3dUcmFja0xlZ2VuZHModGhpcy5tb2RlbCk7XG5cdHNldExlZ2VuZFRvcEFmdGVyVGltZW91dCh0aGlzKTtcbiAgICB9XG4gICAgXG4gICAgT25jb3ByaW50LnByb3RvdHlwZS5zZXRDZWxsUGFkZGluZ09uID0gZnVuY3Rpb24oY2VsbF9wYWRkaW5nX29uKSB7XG5cdHRoaXMubW9kZWwuc2V0Q2VsbFBhZGRpbmdPbihjZWxsX3BhZGRpbmdfb24pO1xuXHR0aGlzLmNlbGxfdmlldy5zZXRDZWxsUGFkZGluZ09uKHRoaXMubW9kZWwpO1xuICAgIH1cbiAgICBcbiAgICBPbmNvcHJpbnQucHJvdG90eXBlLnRvU1ZHID0gZnVuY3Rpb24od2l0aF9iYWNrZ3JvdW5kKSB7XG5cdC8vIFJldHVybnMgc3ZnIERPTSBlbGVtZW50XG5cdHZhciByb290ID0gc3ZnZmFjdG9yeS5zdmcoMTAsIDEwKTtcblx0dGhpcy4kY3RyLmFwcGVuZChyb290KTtcblx0dmFyIGV2ZXJ5dGhpbmdfZ3JvdXAgPSBzdmdmYWN0b3J5Lmdyb3VwKDAsMCk7XG5cdHJvb3QuYXBwZW5kQ2hpbGQoZXZlcnl0aGluZ19ncm91cCk7XG5cdFxuXHR2YXIgYmdyZWN0ID0gc3ZnZmFjdG9yeS5iZ3JlY3QoMTAsMTAsJyNmZmZmZmYnKTtcblx0XG5cdGlmICh3aXRoX2JhY2tncm91bmQpIHtcblx0ICAgIGV2ZXJ5dGhpbmdfZ3JvdXAuYXBwZW5kQ2hpbGQoYmdyZWN0KTtcblx0fVxuXHRcblx0dmFyIGxhYmVsX3ZpZXdfZ3JvdXAgPSB0aGlzLmxhYmVsX3ZpZXcudG9TVkdHcm91cCh0aGlzLm1vZGVsLCB0cnVlLCAwLCAwKTtcblx0ZXZlcnl0aGluZ19ncm91cC5hcHBlbmRDaGlsZChsYWJlbF92aWV3X2dyb3VwKTtcblx0dmFyIHRyYWNrX2luZm9fZ3JvdXBfeCA9IGxhYmVsX3ZpZXdfZ3JvdXAuZ2V0QkJveCgpLndpZHRoICsgMzA7XG5cdHZhciB0cmFja19pbmZvX2dyb3VwID0gdGhpcy50cmFja19pbmZvX3ZpZXcudG9TVkdHcm91cCh0aGlzLm1vZGVsLCB0cmFja19pbmZvX2dyb3VwX3gsIDApO1xuXHRldmVyeXRoaW5nX2dyb3VwLmFwcGVuZENoaWxkKHRyYWNrX2luZm9fZ3JvdXApO1xuXHR2YXIgY2VsbF92aWV3X2dyb3VwX3ggPSB0cmFja19pbmZvX2dyb3VwX3ggKyB0cmFja19pbmZvX2dyb3VwLmdldEJCb3goKS53aWR0aCArIDEwO1xuXHRldmVyeXRoaW5nX2dyb3VwLmFwcGVuZENoaWxkKHRoaXMuY2VsbF92aWV3LnRvU1ZHR3JvdXAodGhpcy5tb2RlbCwgY2VsbF92aWV3X2dyb3VwX3gsIDApKTtcblx0ZXZlcnl0aGluZ19ncm91cC5hcHBlbmRDaGlsZCh0aGlzLmxlZ2VuZF92aWV3LnRvU1ZHR3JvdXAodGhpcy5tb2RlbCwgMCwgbGFiZWxfdmlld19ncm91cC5nZXRCQm94KCkueSArIGxhYmVsX3ZpZXdfZ3JvdXAuZ2V0QkJveCgpLmhlaWdodCsyMCkpO1xuXHRcblx0dmFyIGV2ZXJ5dGhpbmdfYm94ID0gZXZlcnl0aGluZ19ncm91cC5nZXRCQm94KCk7XG5cdHZhciBldmVyeXRoaW5nX3dpZHRoID0gZXZlcnl0aGluZ19ib3gueCArIGV2ZXJ5dGhpbmdfYm94LndpZHRoO1xuXHR2YXIgZXZlcnl0aGluZ19oZWlnaHQgPSBldmVyeXRoaW5nX2JveC55ICsgZXZlcnl0aGluZ19ib3guaGVpZ2h0O1xuXHRyb290LnNldEF0dHJpYnV0ZSgnd2lkdGgnLCBldmVyeXRoaW5nX3dpZHRoKTtcblx0cm9vdC5zZXRBdHRyaWJ1dGUoJ2hlaWdodCcsIGV2ZXJ5dGhpbmdfaGVpZ2h0KTtcblx0XG5cdGlmICh3aXRoX2JhY2tncm91bmQpIHtcblx0ICAgIGJncmVjdC5zZXRBdHRyaWJ1dGUoJ3dpZHRoJywgZXZlcnl0aGluZ193aWR0aCk7XG5cdCAgICBiZ3JlY3Quc2V0QXR0cmlidXRlKCdoZWlnaHQnLCBldmVyeXRoaW5nX2hlaWdodCk7XG5cdH1cblx0cm9vdC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHJvb3QpO1xuXHRcblx0cmV0dXJuIHJvb3Q7XG4gICAgfVxuICAgIFxuICAgIE9uY29wcmludC5wcm90b3R5cGUudG9DYW52YXMgPSBmdW5jdGlvbihjYWxsYmFjaywgcmVzb2x1dGlvbikge1xuXHQvLyBSZXR1cm5zIGRhdGEgdXJsLCByZXF1aXJlcyBJRSA+PSAxMVxuXHRcblx0dmFyIE1BWF9DQU5WQVNfU0lERSA9IDgxOTI7XG5cdHZhciBzdmcgPSB0aGlzLnRvU1ZHKHRydWUpO1xuXHRzdmcuc2V0QXR0cmlidXRlKCd4bWxucycsICdodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZycpO1xuXHR2YXIgd2lkdGggPSBwYXJzZUludChzdmcuZ2V0QXR0cmlidXRlKCd3aWR0aCcpLCAxMCk7XG5cdHZhciBoZWlnaHQgPSBwYXJzZUludChzdmcuZ2V0QXR0cmlidXRlKCdoZWlnaHQnKSwgMTApO1xuXHR2YXIgY2FudmFzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY2FudmFzJyk7XG5cdFxuXHRyZXNvbHV0aW9uID0gcmVzb2x1dGlvbiB8fCAxO1xuXHR2YXIgdHJ1bmNhdGVkID0gd2lkdGgqcmVzb2x1dGlvbiA+IE1BWF9DQU5WQVNfU0lERSB8fCBoZWlnaHQqcmVzb2x1dGlvbiA+IE1BWF9DQU5WQVNfU0lERTtcblx0Y2FudmFzLnNldEF0dHJpYnV0ZSgnd2lkdGgnLCBNYXRoLm1pbihNQVhfQ0FOVkFTX1NJREUsIHdpZHRoKnJlc29sdXRpb24pKTtcblx0Y2FudmFzLnNldEF0dHJpYnV0ZSgnaGVpZ2h0JywgTWF0aC5taW4oTUFYX0NBTlZBU19TSURFLCBoZWlnaHQqcmVzb2x1dGlvbikpO1xuXHRcblx0dmFyIGNvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG5cdGNvbnRhaW5lci5hcHBlbmRDaGlsZChzdmcpO1xuXHR2YXIgc3ZnX2RhdGFfc3RyID0gY29udGFpbmVyLmlubmVySFRNTDtcblx0dmFyIHN2Z19kYXRhX3VyaSA9IFwiZGF0YTppbWFnZS9zdmcreG1sO2Jhc2U2NCxcIit3aW5kb3cuYnRvYShzdmdfZGF0YV9zdHIpO1xuXHRcblx0dmFyIGN0eCA9IGNhbnZhcy5nZXRDb250ZXh0KCcyZCcpO1xuXHRjdHguc2V0VHJhbnNmb3JtKHJlc29sdXRpb24sMCwwLHJlc29sdXRpb24sMCwwKTtcblx0dmFyIGltZyA9IG5ldyBJbWFnZSgpO1xuXHRcblx0aW1nLm9ubG9hZCA9IGZ1bmN0aW9uKCkge1xuXHQgICAgY3R4LmRyYXdJbWFnZShpbWcsIDAsIDApO1xuXHQgICAgY2FsbGJhY2soY2FudmFzLCB0cnVuY2F0ZWQpO1xuXHR9O1xuXHRpbWcub25lcnJvciA9IGZ1bmN0aW9uKCkge1xuXHQgICAgY29uc29sZS5sb2coXCJJTUFHRSBMT0FEIEVSUk9SXCIpO1xuXHR9O1xuXHRcblx0aW1nLnNyYyA9IHN2Z19kYXRhX3VyaTtcblx0cmV0dXJuIGltZztcbiAgICB9XG4gICAgXG4gICAgT25jb3ByaW50LnByb3RvdHlwZS5oaWdobGlnaHRUcmFjayA9IGZ1bmN0aW9uKHRyYWNrX2lkKSB7XG5cdHRoaXMubGFiZWxfdmlldy5oaWdobGlnaHRUcmFjayh0cmFja19pZCwgdGhpcy5tb2RlbCk7XG4gICAgfVxuICAgIFxuICAgIE9uY29wcmludC5wcm90b3R5cGUuZ2V0SWRPcmRlciA9IGZ1bmN0aW9uKGFsbCkge1xuXHRyZXR1cm4gdGhpcy5tb2RlbC5nZXRJZE9yZGVyKGFsbCk7XG4gICAgfVxuICAgIFxuICAgIE9uY29wcmludC5wcm90b3R5cGUuc2V0SWRDbGlwYm9hcmRDb250ZW50cyA9IGZ1bmN0aW9uKGFycmF5KSB7XG5cdHRoaXMuaWRfY2xpcGJvYXJkID0gYXJyYXkuc2xpY2UoKTtcblx0Zm9yICh2YXIgaT0wOyBpPHRoaXMuY2xpcGJvYXJkX2NoYW5nZV9jYWxsYmFja3MubGVuZ3RoOyBpKyspIHtcblx0ICAgIHRoaXMuY2xpcGJvYXJkX2NoYW5nZV9jYWxsYmFja3NbaV0oYXJyYXkpO1xuXHR9XG4gICAgfVxuICAgIE9uY29wcmludC5wcm90b3R5cGUuZ2V0SWRDbGlwYm9hcmRDb250ZW50cyA9IGZ1bmN0aW9uKCkge1xuXHRyZXR1cm4gdGhpcy5pZF9jbGlwYm9hcmQuc2xpY2UoKTtcbiAgICB9XG4gICAgT25jb3ByaW50LnByb3RvdHlwZS5vbkNsaXBib2FyZENoYW5nZSA9IGZ1bmN0aW9uKGNhbGxiYWNrKSB7XG5cdHRoaXMuY2xpcGJvYXJkX2NoYW5nZV9jYWxsYmFja3MucHVzaChjYWxsYmFjayk7XG4gICAgfVxuICAgIFxuICAgIHJldHVybiBPbmNvcHJpbnQ7XG59KSgpO1xubW9kdWxlLmV4cG9ydHMgPSBPbmNvcHJpbnQ7IiwidmFyIHN2Z2ZhY3RvcnkgPSByZXF1aXJlKCcuL3N2Z2ZhY3RvcnkuanMnKTtcblxudmFyIE9uY29wcmludExhYmVsVmlldyA9IChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gT25jb3ByaW50TGFiZWxWaWV3KCRjYW52YXMsIG1vZGVsLCB0b29sdGlwKSB7XG5cdHZhciB2aWV3ID0gdGhpcztcblx0XG5cdHRoaXMuc3VwZXJzYW1wbGluZ19yYXRpbyA9IDI7XG5cdFxuXHR0aGlzLiRjYW52YXMgPSAkY2FudmFzO1xuXHR0aGlzLmJhc2VfZm9udF9zaXplID0gMTQ7XG5cdHRoaXMubW9kZWwgPSBtb2RlbDtcblx0dGhpcy50b29sdGlwID0gdG9vbHRpcDtcblx0dGhpcy50b29sdGlwLmNlbnRlciA9IGZhbHNlO1xuXHQvLyBzdHVmZiBmcm9tIG1vZGVsXG5cdHRoaXMuY2VsbF90b3BzID0ge307XG5cdHRoaXMuY2VsbF90b3BzX3ZpZXdfc3BhY2UgPSB7fTtcblx0dGhpcy5jZWxsX2hlaWdodHMgPSB7fTtcblx0dGhpcy5jZWxsX2hlaWdodHNfdmlld19zcGFjZSA9IHt9O1xuXHR0aGlzLmxhYmVsX21pZGRsZXNfdmlld19zcGFjZSA9IHt9O1xuXHR0aGlzLmxhYmVscyA9IHt9O1xuXHR0aGlzLnRyYWNrX2Rlc2NyaXB0aW9ucyA9IHt9O1xuXHR0aGlzLnRyYWNrcyA9IFtdO1xuXHR0aGlzLm1pbmltdW1fdHJhY2tfaGVpZ2h0ID0gTnVtYmVyLlBPU0lUSVZFX0lORklOSVRZO1xuXHR0aGlzLm1heGltdW1fbGFiZWxfd2lkdGggPSBOdW1iZXIuTkVHQVRJVkVfSU5GSU5JVFk7XG5cdFxuXHR0aGlzLm1heGltdW1fbGFiZWxfbGVuZ3RoID0gMTg7XG5cdHRoaXMucmVuZGVyaW5nX3N1cHByZXNzZWQgPSBmYWxzZTtcblx0XG5cdHRoaXMuaGlnaGxpZ2h0ZWRfdHJhY2sgPSBudWxsO1xuXHRcblx0c2V0VXBDb250ZXh0KHRoaXMpO1xuXHRcblx0KGZ1bmN0aW9uIHNldFVwRHJhZ2dpbmcodmlldykge1xuXHQgICAgdmlldy5kcmFnX2NhbGxiYWNrID0gZnVuY3Rpb24odGFyZ2V0X3RyYWNrLCBuZXdfcHJldmlvdXNfdHJhY2spIHt9O1xuXHQgICAgdmlldy5kcmFnZ2VkX2xhYmVsX3RyYWNrX2lkID0gbnVsbDtcblx0ICAgIHZpZXcuZHJhZ19tb3VzZV95ID0gbnVsbDtcblx0ICAgIFxuXHQgICAgdmlldy4kY2FudmFzLm9uKFwibW91c2Vkb3duXCIsIGZ1bmN0aW9uKGV2dCkge1xuXHRcdHZpZXcudG9vbHRpcC5oaWRlKCk7XG5cdFx0dmFyIHRyYWNrX2lkID0gaXNNb3VzZU9uTGFiZWwodmlldywgZXZ0Lm9mZnNldFkpO1xuXHRcdGlmICh0cmFja19pZCAhPT0gbnVsbCAmJiBtb2RlbC5nZXRDb250YWluaW5nVHJhY2tHcm91cCh0cmFja19pZCkubGVuZ3RoID4gMSkge1xuXHRcdCAgICBzdGFydERyYWdnaW5nKHZpZXcsIHRyYWNrX2lkLCBldnQub2Zmc2V0WSk7XG5cdFx0fVxuXHQgICAgfSk7XG5cdCAgICBcblx0ICAgIHZpZXcuJGNhbnZhcy5vbihcIm1vdXNlbW92ZVwiLCBmdW5jdGlvbihldnQpIHtcblx0XHRpZiAodmlldy5kcmFnZ2VkX2xhYmVsX3RyYWNrX2lkICE9PSBudWxsKSB7XG5cdFx0ICAgIHZhciB0cmFja19ncm91cCA9IG1vZGVsLmdldENvbnRhaW5pbmdUcmFja0dyb3VwKHZpZXcuZHJhZ2dlZF9sYWJlbF90cmFja19pZCk7XG5cdFx0ICAgIHZpZXcuZHJhZ19tb3VzZV95ID0gTWF0aC5taW4oZXZ0LnBhZ2VZIC0gdmlldy4kY2FudmFzLm9mZnNldCgpLnRvcCwgdmlldy50cmFja190b3BzW3RyYWNrX2dyb3VwW3RyYWNrX2dyb3VwLmxlbmd0aC0xXV0gKyBtb2RlbC5nZXRUcmFja0hlaWdodCh0cmFja19ncm91cFt0cmFja19ncm91cC5sZW5ndGgtMV0pKTtcblx0XHQgICAgdmlldy5kcmFnX21vdXNlX3kgPSBNYXRoLm1heCh2aWV3LmRyYWdfbW91c2VfeSwgdmlldy50cmFja190b3BzW3RyYWNrX2dyb3VwWzBdXS01KTtcblx0XHQgICAgcmVuZGVyQWxsTGFiZWxzKHZpZXcpO1xuXHRcdH0gZWxzZSB7XG5cdFx0ICAgIHZhciBob3ZlcmVkX3RyYWNrID0gaXNNb3VzZU9uTGFiZWwodmlldywgZXZ0LnBhZ2VZIC0gdmlldy4kY2FudmFzLm9mZnNldCgpLnRvcCk7XG5cdFx0ICAgIGlmIChob3ZlcmVkX3RyYWNrICE9PSBudWxsKSB7XG5cdFx0XHR2YXIgJHRvb2x0aXBfZGl2ID0gJCgnPGRpdj4nKTtcblx0XHRcdHZhciBvZmZzZXQgPSB2aWV3LiRjYW52YXMub2Zmc2V0KCk7ICAgXG5cdFx0XHRpZiAoaXNOZWNlc3NhcnlUb1Nob3J0ZW5MYWJlbCh2aWV3LCB2aWV3LmxhYmVsc1tob3ZlcmVkX3RyYWNrXSkpIHtcblx0XHRcdCAgICAkdG9vbHRpcF9kaXYuYXBwZW5kKCQoJzxiPicrdmlldy5sYWJlbHNbaG92ZXJlZF90cmFja10rJzwvYj4nKSk7XG5cdFx0XHR9XG5cdFx0XHR2YXIgdHJhY2tfZGVzY3JpcHRpb24gPSB2aWV3LnRyYWNrX2Rlc2NyaXB0aW9uc1tob3ZlcmVkX3RyYWNrXS5yZXBsYWNlKFwiPFwiLCBcIiZsdDtcIikucmVwbGFjZShcIj5cIiwgXCImZ3Q7XCIpO1xuXHRcdFx0aWYgKHRyYWNrX2Rlc2NyaXB0aW9uLmxlbmd0aCA+IDApIHtcblx0XHRcdCAgICAkdG9vbHRpcF9kaXYuYXBwZW5kKHRyYWNrX2Rlc2NyaXB0aW9uICsgXCI8YnI+XCIpO1xuXHRcdFx0fVxuXHRcdFx0aWYgKG1vZGVsLmdldENvbnRhaW5pbmdUcmFja0dyb3VwKGhvdmVyZWRfdHJhY2spLmxlbmd0aCA+IDEpIHtcblx0XHRcdCAgICB2aWV3LiRjYW52YXMuY3NzKCdjdXJzb3InLCAnbW92ZScpO1xuXHRcdFx0ICAgICR0b29sdGlwX2Rpdi5hcHBlbmQoXCI8Yj5ob2xkIHRvIGRyYWc8L2I+XCIpO1xuXHRcdFx0fVxuXHRcdFx0dmlldy50b29sdGlwLmZhZGVJbigyMDAsIHJlbmRlcmVkTGFiZWxXaWR0aCh2aWV3LCB2aWV3LmxhYmVsc1tob3ZlcmVkX3RyYWNrXSkgKyBvZmZzZXQubGVmdCwgdmlldy5jZWxsX3RvcHNbaG92ZXJlZF90cmFja10gKyBvZmZzZXQudG9wIC0gdmlldy5zY3JvbGxfeSwgJHRvb2x0aXBfZGl2KTtcblx0XHQgICAgfSBlbHNlIHtcblx0XHRcdHZpZXcuJGNhbnZhcy5jc3MoJ2N1cnNvcicsICdhdXRvJyk7XG5cdFx0XHR2aWV3LnRvb2x0aXAuaGlkZSgpO1xuXHRcdCAgICB9XG5cdFx0fVxuXHQgICAgfSk7XG5cdCAgICBcblx0ICAgIHZpZXcuJGNhbnZhcy5vbihcIm1vdXNldXAgbW91c2VsZWF2ZVwiLCBmdW5jdGlvbihldnQpIHtcblx0XHRpZiAodmlldy5kcmFnZ2VkX2xhYmVsX3RyYWNrX2lkICE9PSBudWxsKSB7XG5cdFx0ICAgIHZhciB0cmFja19ncm91cCA9IG1vZGVsLmdldENvbnRhaW5pbmdUcmFja0dyb3VwKHZpZXcuZHJhZ2dlZF9sYWJlbF90cmFja19pZCk7XG5cdFx0ICAgIHZhciBwcmV2aW91c190cmFja19pZCA9IGdldExhYmVsQWJvdmVNb3VzZVNwYWNlKHZpZXcsIHRyYWNrX2dyb3VwLCBldnQub2Zmc2V0WSwgdmlldy5kcmFnZ2VkX2xhYmVsX3RyYWNrX2lkKTtcblx0XHQgICAgc3RvcERyYWdnaW5nKHZpZXcsIHByZXZpb3VzX3RyYWNrX2lkKTtcblx0XHR9XG5cdFx0dmlldy50b29sdGlwLmhpZGUoKTtcblx0ICAgIH0pO1xuXHR9KSh0aGlzKTtcblx0XG4gICAgfVxuICAgIHZhciByZW5kZXJlZExhYmVsV2lkdGggPSBmdW5jdGlvbih2aWV3LCBsYWJlbCkge1xuXHRyZXR1cm4gdmlldy5jdHgubWVhc3VyZVRleHQoc2hvcnRlbkxhYmVsSWZOZWNlc3NhcnkodmlldywgbGFiZWwpKS53aWR0aC92aWV3LnN1cGVyc2FtcGxpbmdfcmF0aW87XG4gICAgfTtcbiAgICB2YXIgdXBkYXRlRnJvbU1vZGVsID0gZnVuY3Rpb24odmlldywgbW9kZWwpIHtcblx0aWYgKHZpZXcucmVuZGVyaW5nX3N1cHByZXNzZWQpIHtcblx0ICAgIHJldHVybjtcblx0fVxuXHR2aWV3LnNjcm9sbF95ID0gbW9kZWwuZ2V0VmVydFNjcm9sbCgpO1xuXHR2aWV3LnRyYWNrX3RvcHMgPSBtb2RlbC5nZXRab29tZWRUcmFja1RvcHMoKTtcblx0dmlldy5jZWxsX3RvcHMgPSBtb2RlbC5nZXRDZWxsVG9wcygpO1xuXHR2aWV3LmNlbGxfdG9wc192aWV3X3NwYWNlID0ge307XG5cdHZpZXcuY2VsbF9oZWlnaHRzID0ge307XG5cdHZpZXcudHJhY2tzID0gbW9kZWwuZ2V0VHJhY2tzKCk7XG5cdHZpZXcudHJhY2tfZGVzY3JpcHRpb25zID0ge307XG5cdFxuXHR2aWV3LmN0eC5mb250ID0gJ2JvbGQgJyt2aWV3LmdldEZvbnRTaXplKCkrJ3B4IEFyaWFsJztcblx0dmlldy5taW5pbXVtX3RyYWNrX2hlaWdodCA9IE51bWJlci5QT1NJVElWRV9JTkZJTklUWTtcblx0dmlldy5tYXhpbXVtX2xhYmVsX3dpZHRoID0gMDtcblx0Zm9yICh2YXIgaT0wOyBpPHZpZXcudHJhY2tzLmxlbmd0aDsgaSsrKSB7XG5cdCAgICB2aWV3Lm1pbmltdW1fdHJhY2tfaGVpZ2h0ID0gTWF0aC5taW4odmlldy5taW5pbXVtX3RyYWNrX2hlaWdodCwgbW9kZWwuZ2V0VHJhY2tIZWlnaHQodmlldy50cmFja3NbaV0pKTtcblx0ICAgIHZhciBzaG9ydGVuZWRfbGFiZWwgPSBzaG9ydGVuTGFiZWxJZk5lY2Vzc2FyeSh2aWV3LCB2aWV3LmxhYmVsc1t2aWV3LnRyYWNrc1tpXV0pO1xuXHQgICAgdmlldy5tYXhpbXVtX2xhYmVsX3dpZHRoID0gTWF0aC5tYXgodmlldy5tYXhpbXVtX2xhYmVsX3dpZHRoLCB2aWV3LmN0eC5tZWFzdXJlVGV4dChzaG9ydGVuZWRfbGFiZWwpLndpZHRoKTtcblx0ICAgIFxuXHQgICAgdmlldy5jZWxsX3RvcHNfdmlld19zcGFjZVt2aWV3LnRyYWNrc1tpXV0gPSB2aWV3LmNlbGxfdG9wc1t2aWV3LnRyYWNrc1tpXV0qdmlldy5zdXBlcnNhbXBsaW5nX3JhdGlvIC0gdmlldy5zY3JvbGxfeSp2aWV3LnN1cGVyc2FtcGxpbmdfcmF0aW87XG5cdCAgICB2aWV3LnRyYWNrX2Rlc2NyaXB0aW9uc1t2aWV3LnRyYWNrc1tpXV0gPSBtb2RlbC5nZXRUcmFja0Rlc2NyaXB0aW9uKHZpZXcudHJhY2tzW2ldKTtcblx0ICAgIHZpZXcuY2VsbF9oZWlnaHRzW3ZpZXcudHJhY2tzW2ldXSA9IG1vZGVsLmdldENlbGxIZWlnaHQodmlldy50cmFja3NbaV0pO1xuXHQgICAgdmlldy5jZWxsX2hlaWdodHNfdmlld19zcGFjZVt2aWV3LnRyYWNrc1tpXV0gPSB2aWV3LmNlbGxfaGVpZ2h0c1t2aWV3LnRyYWNrc1tpXV0qdmlldy5zdXBlcnNhbXBsaW5nX3JhdGlvO1xuXHQgICAgdmlldy5sYWJlbF9taWRkbGVzX3ZpZXdfc3BhY2Vbdmlldy50cmFja3NbaV1dID0gdmlldy5jZWxsX3RvcHNfdmlld19zcGFjZVt2aWV3LnRyYWNrc1tpXV0gKyB2aWV3LmNlbGxfaGVpZ2h0c192aWV3X3NwYWNlW3ZpZXcudHJhY2tzW2ldXS8yO1xuXHR9XG4gICAgfVxuICAgIHZhciBzZXRVcENvbnRleHQgPSBmdW5jdGlvbih2aWV3KSB7XG5cdHZpZXcuY3R4ID0gdmlldy4kY2FudmFzWzBdLmdldENvbnRleHQoJzJkJyk7XG5cdHZpZXcuY3R4LnRleHRBbGlnbj1cInN0YXJ0XCI7XG5cdHZpZXcuY3R4LnRleHRCYXNlbGluZT1cIm1pZGRsZVwiO1xuICAgIH1cbiAgICB2YXIgcmVzaXplQW5kQ2xlYXIgPSBmdW5jdGlvbih2aWV3LCBtb2RlbCkge1xuXHRpZiAodmlldy5yZW5kZXJpbmdfc3VwcHJlc3NlZCkge1xuXHQgICAgcmV0dXJuO1xuXHR9XG5cdHZhciB2aXNpYmxlX2hlaWdodCA9IG1vZGVsLmdldENlbGxWaWV3SGVpZ2h0KCk7XG5cdHZhciB2aXNpYmxlX3dpZHRoID0gdmlldy5nZXRXaWR0aCgpO1xuXHR2aWV3LiRjYW52YXNbMF0uaGVpZ2h0ID0gdmlldy5zdXBlcnNhbXBsaW5nX3JhdGlvKnZpc2libGVfaGVpZ2h0O1xuXHR2aWV3LiRjYW52YXNbMF0ud2lkdGggPSB2aWV3LnN1cGVyc2FtcGxpbmdfcmF0aW8qdmlzaWJsZV93aWR0aDtcblx0dmlldy4kY2FudmFzWzBdLnN0eWxlLmhlaWdodCA9IHZpc2libGVfaGVpZ2h0ICsgJ3B4Jztcblx0dmlldy4kY2FudmFzWzBdLnN0eWxlLndpZHRoID0gdmlzaWJsZV93aWR0aCArICdweCc7XG5cdHNldFVwQ29udGV4dCh2aWV3KTtcbiAgICB9XG4gICAgdmFyIGlzTmVjZXNzYXJ5VG9TaG9ydGVuTGFiZWwgPSBmdW5jdGlvbih2aWV3LCBsYWJlbCkge1xuXHRyZXR1cm4gbGFiZWwubGVuZ3RoID4gdmlldy5tYXhpbXVtX2xhYmVsX2xlbmd0aDtcbiAgICB9O1xuICAgIHZhciBzaG9ydGVuTGFiZWxJZk5lY2Vzc2FyeSA9IGZ1bmN0aW9uKHZpZXcsIGxhYmVsKSB7XG5cdGlmIChpc05lY2Vzc2FyeVRvU2hvcnRlbkxhYmVsKHZpZXcsIGxhYmVsKSkge1xuXHQgICAgcmV0dXJuIGxhYmVsLnN1YnN0cmluZygwLCB2aWV3Lm1heGltdW1fbGFiZWxfbGVuZ3RoLTMpICsgJy4uLic7XG5cdH0gZWxzZSB7XG5cdCAgICByZXR1cm4gbGFiZWw7XG5cdH1cbiAgICB9O1xuICAgIHZhciByZW5kZXJBbGxMYWJlbHMgPSBmdW5jdGlvbih2aWV3KSB7XG5cdGlmICh2aWV3LnJlbmRlcmluZ19zdXBwcmVzc2VkKSB7XG5cdCAgICByZXR1cm47XG5cdH1cblx0dmlldy5jdHguY2xlYXJSZWN0KDAsMCx2aWV3LiRjYW52YXNbMF0ud2lkdGgsdmlldy4kY2FudmFzWzBdLmhlaWdodCk7XG5cdFxuXHRpZiAodmlldy5oaWdobGlnaHRlZF90cmFjayAhPT0gbnVsbCkge1xuXHQgICAgaWYgKHZpZXcuY2VsbF90b3BzX3ZpZXdfc3BhY2UuaGFzT3duUHJvcGVydHkodmlldy5oaWdobGlnaHRlZF90cmFjaykpIHtcblx0XHR2aWV3LmN0eC5maWxsU3R5bGUgPSAncmdiYSgyNTUsMjU1LDAsMC40KSc7XG5cdFx0dmlldy5jdHguZmlsbFJlY3QoMCwgdmlldy5jZWxsX3RvcHNfdmlld19zcGFjZVt2aWV3LmhpZ2hsaWdodGVkX3RyYWNrXSwgdmlldy5nZXRXaWR0aCgpKnZpZXcuc3VwZXJzYW1wbGluZ19yYXRpbywgdmlldy5jZWxsX2hlaWdodHNfdmlld19zcGFjZVt2aWV3LmhpZ2hsaWdodGVkX3RyYWNrXSk7XG5cdCAgICB9XG5cdH1cblx0dmFyIGZvbnRfc2l6ZSA9IHZpZXcuZ2V0Rm9udFNpemUoKTtcblx0dmlldy5jdHguZm9udCA9ICdib2xkICcrZm9udF9zaXplICsncHggQXJpYWwnO1xuXHR2aWV3LmN0eC5maWxsU3R5bGUgPSAnYmxhY2snO1xuXHR2YXIgdHJhY2tzID0gdmlldy50cmFja3M7XG5cdGZvciAodmFyIGk9MDsgaTx0cmFja3MubGVuZ3RoOyBpKyspIHtcblx0ICAgIHZpZXcuY3R4LmZpbGxUZXh0KHNob3J0ZW5MYWJlbElmTmVjZXNzYXJ5KHZpZXcsIHZpZXcubGFiZWxzW3RyYWNrc1tpXV0pLCAwLCB2aWV3LmxhYmVsX21pZGRsZXNfdmlld19zcGFjZVt0cmFja3NbaV1dKTtcblx0fVxuXHRpZiAodmlldy5kcmFnZ2VkX2xhYmVsX3RyYWNrX2lkICE9PSBudWxsKSB7XG5cdCAgICB2aWV3LmN0eC5maWxsU3R5bGUgPSAncmdiYSgyNTUsMCwwLDAuOTUpJztcblx0ICAgIHZpZXcuY3R4LmZpbGxUZXh0KHNob3J0ZW5MYWJlbElmTmVjZXNzYXJ5KHZpZXcsIHZpZXcubGFiZWxzW3ZpZXcuZHJhZ2dlZF9sYWJlbF90cmFja19pZF0pLCAwLCB2aWV3LnN1cGVyc2FtcGxpbmdfcmF0aW8qdmlldy5kcmFnX21vdXNlX3kpO1xuXHQgICAgdmlldy5jdHguZmlsbFN0eWxlID0gJ3JnYmEoMCwwLDAsMC4xNSknO1xuXHQgICAgdmFyIGdyb3VwID0gdmlldy5tb2RlbC5nZXRDb250YWluaW5nVHJhY2tHcm91cCh2aWV3LmRyYWdnZWRfbGFiZWxfdHJhY2tfaWQpO1xuXHQgICAgdmFyIGxhYmVsX2Fib3ZlX21vdXNlID0gZ2V0TGFiZWxBYm92ZU1vdXNlU3BhY2UodmlldywgZ3JvdXAsIHZpZXcuZHJhZ19tb3VzZV95LCBudWxsKTtcblx0ICAgIHZhciBsYWJlbF9iZWxvd19tb3VzZSA9IGdldExhYmVsQmVsb3dNb3VzZVNwYWNlKHZpZXcsIGdyb3VwLCB2aWV3LmRyYWdfbW91c2VfeSwgbnVsbCk7XG5cdCAgICB2YXIgcmVjdF95LCByZWN0X2hlaWdodDtcblx0ICAgIGlmIChsYWJlbF9hYm92ZV9tb3VzZSA9PT0gdmlldy5kcmFnZ2VkX2xhYmVsX3RyYWNrX2lkIHx8IGxhYmVsX2JlbG93X21vdXNlID09PSB2aWV3LmRyYWdnZWRfbGFiZWxfdHJhY2tfaWQpIHtcblx0XHRyZXR1cm47XG5cdCAgICB9XG5cdCAgICBpZiAobGFiZWxfYWJvdmVfbW91c2UgIT09IG51bGwgJiYgbGFiZWxfYmVsb3dfbW91c2UgIT09IG51bGwpIHtcblx0XHRyZWN0X3kgPSB2aWV3LmNlbGxfdG9wc192aWV3X3NwYWNlW2xhYmVsX2Fib3ZlX21vdXNlXSArIHZpZXcuY2VsbF9oZWlnaHRzX3ZpZXdfc3BhY2VbbGFiZWxfYWJvdmVfbW91c2VdO1xuXHRcdHJlY3RfaGVpZ2h0ID0gdmlldy5jZWxsX3RvcHNfdmlld19zcGFjZVtsYWJlbF9iZWxvd19tb3VzZV0gLSByZWN0X3k7XG5cdCAgICB9IGVsc2UgaWYgKGxhYmVsX2Fib3ZlX21vdXNlID09PSBudWxsKSB7XG5cdFx0cmVjdF95ID0gdmlldy5jZWxsX3RvcHNfdmlld19zcGFjZVtncm91cFswXV0gLSB2aWV3LmN0eC5tZWFzdXJlVGV4dChcIm1cIikud2lkdGg7XG5cdFx0cmVjdF9oZWlnaHQgPSB2aWV3LmN0eC5tZWFzdXJlVGV4dChcIm1cIikud2lkdGg7XG5cdCAgICB9IGVsc2UgaWYgKGxhYmVsX2JlbG93X21vdXNlID09PSBudWxsKSB7XG5cdFx0cmVjdF95ID0gdmlldy5jZWxsX3RvcHNfdmlld19zcGFjZVtncm91cFtncm91cC5sZW5ndGgtMV1dICsgdmlldy5jZWxsX2hlaWdodHNfdmlld19zcGFjZVtncm91cFtncm91cC5sZW5ndGgtMV1dO1xuXHRcdHJlY3RfaGVpZ2h0ID0gdmlldy5jdHgubWVhc3VyZVRleHQoXCJtXCIpLndpZHRoO1xuXHQgICAgfVxuXHQgICAgdmlldy5jdHguZmlsbFJlY3QoMCwgcmVjdF95LCB2aWV3LmdldFdpZHRoKCkqdmlldy5zdXBlcnNhbXBsaW5nX3JhdGlvLCByZWN0X2hlaWdodCk7XG5cdH1cbiAgICB9XG4gICAgXG4gICAgdmFyIGlzTW91c2VPbkxhYmVsID0gZnVuY3Rpb24odmlldywgbW91c2VfeSkge1xuXHR2YXIgY2FuZGlkYXRlX3RyYWNrID0gZ2V0TGFiZWxBYm92ZU1vdXNlU3BhY2Uodmlldywgdmlldy50cmFja3MsIG1vdXNlX3ksIG51bGwpO1xuXHRpZiAoY2FuZGlkYXRlX3RyYWNrID09PSBudWxsKSB7XG5cdCAgICByZXR1cm4gbnVsbDtcblx0fVxuXHRpZiAobW91c2VfeSA8PSB2aWV3LmNlbGxfdG9wc1tjYW5kaWRhdGVfdHJhY2tdIC0gdmlldy5zY3JvbGxfeSArIHZpZXcuY2VsbF9oZWlnaHRzW2NhbmRpZGF0ZV90cmFja10pIHtcblx0ICAgIHJldHVybiBjYW5kaWRhdGVfdHJhY2s7XG5cdH0gZWxzZSB7XG5cdCAgICByZXR1cm4gbnVsbDtcblx0fVxuICAgIH1cbiAgICB2YXIgZ2V0TGFiZWxBYm92ZU1vdXNlU3BhY2UgPSBmdW5jdGlvbih2aWV3LCB0cmFja19pZHMsIHksIHRyYWNrX3RvX2V4Y2x1ZGUpIHtcblx0aWYgKHkgPCB2aWV3LmNlbGxfdG9wc1t0cmFja19pZHNbMF1dIC0gdmlldy5zY3JvbGxfeSkge1xuXHQgICAgcmV0dXJuIG51bGw7XG5cdH0gZWxzZSB7XG5cdCAgICB2YXIgY2FuZGlkYXRlX3RyYWNrID0gbnVsbDtcblx0ICAgIGZvciAodmFyIGk9MDsgaTx0cmFja19pZHMubGVuZ3RoOyBpKyspIHtcblx0XHRpZiAodHJhY2tfdG9fZXhjbHVkZSAhPT0gbnVsbCAmJiB0cmFja190b19leGNsdWRlID09PSB0cmFja19pZHNbaV0pIHtcblx0XHQgICAgY29udGludWU7XG5cdFx0fVxuXHRcdGlmICh2aWV3LmNlbGxfdG9wc1t0cmFja19pZHNbaV1dIC0gdmlldy5zY3JvbGxfeSA+IHkpIHtcblx0XHQgICAgYnJlYWs7XG5cdFx0fSBlbHNlIHtcblx0XHQgICAgY2FuZGlkYXRlX3RyYWNrID0gdHJhY2tfaWRzW2ldO1xuXHRcdH1cblx0ICAgIH1cblx0ICAgIHJldHVybiBjYW5kaWRhdGVfdHJhY2s7XG5cdH1cbiAgICB9XG4gICAgdmFyIGdldExhYmVsQmVsb3dNb3VzZVNwYWNlID0gZnVuY3Rpb24odmlldywgdHJhY2tfaWRzLCB5LCB0cmFja190b19leGNsdWRlKSB7XG5cdGlmICh5ID4gdmlldy5jZWxsX3RvcHNbdHJhY2tfaWRzW3RyYWNrX2lkcy5sZW5ndGgtMV1dIC0gdmlldy5zY3JvbGxfeSkge1xuXHQgICAgcmV0dXJuIG51bGw7XG5cdH0gZWxzZSB7XG5cdCAgICB2YXIgY2FuZGlkYXRlX3RyYWNrID0gbnVsbDtcblx0ICAgIGZvciAodmFyIGk9dHJhY2tfaWRzLmxlbmd0aC0xOyBpPj0wOyBpLS0pIHtcblx0XHRpZiAodHJhY2tfdG9fZXhjbHVkZSAhPT0gbnVsbCAmJiB0cmFja190b19leGNsdWRlID09PSB0cmFja19pZHNbaV0pIHtcblx0XHQgICAgY29udGludWU7XG5cdFx0fVxuXHRcdGlmICh2aWV3LmNlbGxfdG9wc1t0cmFja19pZHNbaV1dIC0gdmlldy5zY3JvbGxfeSA8IHkpIHtcblx0XHQgICAgYnJlYWs7XG5cdFx0fSBlbHNlIHtcblx0XHQgICAgY2FuZGlkYXRlX3RyYWNrID0gdHJhY2tfaWRzW2ldO1xuXHRcdH1cblx0ICAgIH1cblx0ICAgIHJldHVybiBjYW5kaWRhdGVfdHJhY2s7XG5cdH1cbiAgICB9XG4gICAgXG4gICAgdmFyIHN0YXJ0RHJhZ2dpbmcgPSBmdW5jdGlvbih2aWV3LCB0cmFja19pZCwgbW91c2VfeSkge1xuXHR2aWV3LmRyYWdnZWRfbGFiZWxfdHJhY2tfaWQgPSB0cmFja19pZDtcblx0dmlldy5kcmFnX21vdXNlX3kgPSBtb3VzZV95O1xuXHRyZW5kZXJBbGxMYWJlbHModmlldyk7XG4gICAgfVxuICAgIHZhciBzdG9wRHJhZ2dpbmcgPSBmdW5jdGlvbih2aWV3LCBuZXdfcHJldmlvdXNfdHJhY2tfaWQpIHtcblx0dmlldy5kcmFnX2NhbGxiYWNrKHZpZXcuZHJhZ2dlZF9sYWJlbF90cmFja19pZCwgbmV3X3ByZXZpb3VzX3RyYWNrX2lkKTtcblx0dmlldy5kcmFnZ2VkX2xhYmVsX3RyYWNrX2lkID0gbnVsbDtcblx0cmVuZGVyQWxsTGFiZWxzKHZpZXcpO1xuICAgIH1cbiAgICBcbiAgICBPbmNvcHJpbnRMYWJlbFZpZXcucHJvdG90eXBlLmdldFdpZHRoID0gZnVuY3Rpb24oKSB7XG5cdC8vcmV0dXJuIHRoaXMubWF4aW11bV9sYWJlbF93aWR0aCArIDIwO1xuXHRyZXR1cm4gTWF0aC5tYXgodGhpcy5tYXhpbXVtX2xhYmVsX3dpZHRoL3RoaXMuc3VwZXJzYW1wbGluZ19yYXRpbyArIDEwLCA3MCk7XG4gICAgfVxuICAgIE9uY29wcmludExhYmVsVmlldy5wcm90b3R5cGUuZ2V0Rm9udFNpemUgPSBmdW5jdGlvbihub19zdXBlcnNhbXBsaW5nX2FkanVzdG1lbnQpIHtcblx0cmV0dXJuIChub19zdXBlcnNhbXBsaW5nX2FkanVzdG1lbnQgPyAxIDogdGhpcy5zdXBlcnNhbXBsaW5nX3JhdGlvKSAqIE1hdGgubWF4KE1hdGgubWluKHRoaXMuYmFzZV9mb250X3NpemUsIHRoaXMubWluaW11bV90cmFja19oZWlnaHQpLCA3KTtcbiAgICB9XG4gICAgT25jb3ByaW50TGFiZWxWaWV3LnByb3RvdHlwZS5zZXREcmFnQ2FsbGJhY2sgPSBmdW5jdGlvbihjYWxsYmFjaykge1xuXHR0aGlzLmRyYWdfY2FsbGJhY2sgPSBjYWxsYmFjaztcbiAgICB9XG4gICAgT25jb3ByaW50TGFiZWxWaWV3LnByb3RvdHlwZS5yZW1vdmVUcmFjayA9IGZ1bmN0aW9uIChtb2RlbCwgdHJhY2tfaWQpIHtcblx0dXBkYXRlRnJvbU1vZGVsKHRoaXMsIG1vZGVsKTtcblx0cmVzaXplQW5kQ2xlYXIodGhpcywgbW9kZWwpO1xuXHRyZW5kZXJBbGxMYWJlbHModGhpcywgbW9kZWwpO1xuICAgIH1cbiAgICBPbmNvcHJpbnRMYWJlbFZpZXcucHJvdG90eXBlLm1vdmVUcmFjayA9IGZ1bmN0aW9uIChtb2RlbCkge1xuXHR1cGRhdGVGcm9tTW9kZWwodGhpcywgbW9kZWwpO1xuXHRyZXNpemVBbmRDbGVhcih0aGlzLCBtb2RlbCk7XG5cdHJlbmRlckFsbExhYmVscyh0aGlzLCBtb2RlbCk7XG4gICAgfVxuICAgIE9uY29wcmludExhYmVsVmlldy5wcm90b3R5cGUuc2V0VHJhY2tHcm91cE9yZGVyID0gZnVuY3Rpb24gKG1vZGVsKSB7XG5cdHVwZGF0ZUZyb21Nb2RlbCh0aGlzLCBtb2RlbCk7XG5cdHJlc2l6ZUFuZENsZWFyKHRoaXMsIG1vZGVsKTtcblx0cmVuZGVyQWxsTGFiZWxzKHRoaXMsIG1vZGVsKTtcbiAgICB9XG4gICAgT25jb3ByaW50TGFiZWxWaWV3LnByb3RvdHlwZS5hZGRUcmFja3MgPSBmdW5jdGlvbiAobW9kZWwsIHRyYWNrX2lkcykge1xuXHRmb3IgKHZhciBpPTA7IGk8dHJhY2tfaWRzLmxlbmd0aDsgaSsrKSB7XG5cdCAgICB0aGlzLmxhYmVsc1t0cmFja19pZHNbaV1dID0gbW9kZWwuZ2V0VHJhY2tMYWJlbCh0cmFja19pZHNbaV0pO1xuXHR9XG5cdHVwZGF0ZUZyb21Nb2RlbCh0aGlzLCBtb2RlbCk7XG5cdHJlc2l6ZUFuZENsZWFyKHRoaXMsIG1vZGVsKTtcblx0cmVuZGVyQWxsTGFiZWxzKHRoaXMsIG1vZGVsKTtcbiAgICB9XG4gICAgXG4gICAgT25jb3ByaW50TGFiZWxWaWV3LnByb3RvdHlwZS5zZXRTY3JvbGwgPSBmdW5jdGlvbihtb2RlbCkge1xuXHR0aGlzLnNldFZlcnRTY3JvbGwobW9kZWwpO1xuICAgIH1cbiAgICBcbiAgICBPbmNvcHJpbnRMYWJlbFZpZXcucHJvdG90eXBlLnNldEhvcnpTY3JvbGwgPSBmdW5jdGlvbihtb2RlbCkge1xuICAgIH1cbiAgICBcbiAgICBPbmNvcHJpbnRMYWJlbFZpZXcucHJvdG90eXBlLnNldFZpZXdwb3J0ID0gZnVuY3Rpb24obW9kZWwpIHtcblx0dGhpcy5zZXRWZXJ0U2Nyb2xsKG1vZGVsKTtcbiAgICB9XG4gICAgXG4gICAgT25jb3ByaW50TGFiZWxWaWV3LnByb3RvdHlwZS5zZXRWZXJ0U2Nyb2xsID0gZnVuY3Rpb24obW9kZWwpIHtcblx0dXBkYXRlRnJvbU1vZGVsKHRoaXMsIG1vZGVsKTtcblx0cmVzaXplQW5kQ2xlYXIodGhpcywgbW9kZWwpO1xuXHRyZW5kZXJBbGxMYWJlbHModGhpcywgbW9kZWwpO1xuICAgIH1cbiAgICBcbiAgICBPbmNvcHJpbnRMYWJlbFZpZXcucHJvdG90eXBlLnNldFZlcnRab29tID0gZnVuY3Rpb24obW9kZWwpIHtcblx0dXBkYXRlRnJvbU1vZGVsKHRoaXMsIG1vZGVsKTtcblx0cmVzaXplQW5kQ2xlYXIodGhpcywgbW9kZWwpO1xuXHRyZW5kZXJBbGxMYWJlbHModGhpcywgbW9kZWwpO1xuICAgIH1cbiAgICBcbiAgICBPbmNvcHJpbnRMYWJlbFZpZXcucHJvdG90eXBlLnNldFpvb20gPSBmdW5jdGlvbihtb2RlbCkge1xuXHR0aGlzLnNldFZlcnRab29tKG1vZGVsKTtcbiAgICB9XG4gICAgXG4gICAgT25jb3ByaW50TGFiZWxWaWV3LnByb3RvdHlwZS5oaWdobGlnaHRUcmFjayA9IGZ1bmN0aW9uKHRyYWNrX2lkLCBtb2RlbCkge1xuXHQvLyB0cmFja19pZCBpcyBhIHRyYWNrIGlkLCBvciBudWxsIHRvIGNsZWFyIGhpZ2hsaWdodFxuXHR0aGlzLmhpZ2hsaWdodGVkX3RyYWNrID0gdHJhY2tfaWQ7XG5cdHJlbmRlckFsbExhYmVscyh0aGlzLCBtb2RlbCk7XG4gICAgfVxuICAgIFxuICAgIE9uY29wcmludExhYmVsVmlldy5wcm90b3R5cGUuc3VwcHJlc3NSZW5kZXJpbmcgPSBmdW5jdGlvbigpIHtcblx0dGhpcy5yZW5kZXJpbmdfc3VwcHJlc3NlZCA9IHRydWU7XG4gICAgfVxuICAgIFxuICAgIE9uY29wcmludExhYmVsVmlldy5wcm90b3R5cGUucmVsZWFzZVJlbmRlcmluZyA9IGZ1bmN0aW9uKG1vZGVsKSB7XG5cdHRoaXMucmVuZGVyaW5nX3N1cHByZXNzZWQgPSBmYWxzZTtcblx0dXBkYXRlRnJvbU1vZGVsKHRoaXMsIG1vZGVsKTtcblx0cmVzaXplQW5kQ2xlYXIodGhpcywgbW9kZWwpO1xuXHRyZW5kZXJBbGxMYWJlbHModGhpcyk7XG4gICAgfVxuICAgIFxuICAgIE9uY29wcmludExhYmVsVmlldy5wcm90b3R5cGUudG9TVkdHcm91cCA9IGZ1bmN0aW9uKG1vZGVsLCBmdWxsX2xhYmVscywgb2Zmc2V0X3gsIG9mZnNldF95KSB7XG5cdHZhciByb290ID0gc3ZnZmFjdG9yeS5ncm91cCgob2Zmc2V0X3ggfHwgMCksIChvZmZzZXRfeSB8fCAwKSk7XG5cdHZhciBjZWxsX3RvcHMgPSBtb2RlbC5nZXRDZWxsVG9wcygpO1xuXHR2YXIgdHJhY2tzID0gbW9kZWwuZ2V0VHJhY2tzKCk7XG5cdGZvciAodmFyIGk9MDsgaTx0cmFja3MubGVuZ3RoOyBpKyspIHtcblx0ICAgIHZhciB0cmFja19pZCA9IHRyYWNrc1tpXTtcblx0ICAgIHZhciB5ID0gY2VsbF90b3BzW3RyYWNrX2lkXSArIG1vZGVsLmdldENlbGxIZWlnaHQodHJhY2tfaWQpLzI7XG5cdCAgICB2YXIgbGFiZWwgPSBtb2RlbC5nZXRUcmFja0xhYmVsKHRyYWNrX2lkKTtcblx0ICAgIHZhciB0ZXh0X2VsdCA9IHN2Z2ZhY3RvcnkudGV4dCgoZnVsbF9sYWJlbHMgPyBsYWJlbCA6IHNob3J0ZW5MYWJlbElmTmVjZXNzYXJ5KHRoaXMsIGxhYmVsKSksIDAsIHksIHRoaXMuZ2V0Rm9udFNpemUodHJ1ZSksICdBcmlhbCcsICdib2xkJywgXCJib3R0b21cIik7IFxuXHQgICAgdGV4dF9lbHQuc2V0QXR0cmlidXRlKFwiZHlcIiwgXCIwLjM1ZW1cIik7XG5cdCAgICByb290LmFwcGVuZENoaWxkKHRleHRfZWx0KTtcblx0fVxuXHRyZXR1cm4gcm9vdDtcbiAgICB9XG5cbiAgICByZXR1cm4gT25jb3ByaW50TGFiZWxWaWV3O1xufSkoKTtcblxubW9kdWxlLmV4cG9ydHMgPSBPbmNvcHJpbnRMYWJlbFZpZXc7IiwidmFyIHN2Z2ZhY3RvcnkgPSByZXF1aXJlKCcuL3N2Z2ZhY3RvcnkuanMnKTtcblxudmFyIG5vZGVJc1Zpc2libGUgPSBmdW5jdGlvbihub2RlKSB7XG4gICAgdmFyIHJldCA9IHRydWU7XG4gICAgd2hpbGUgKG5vZGUudGFnTmFtZS50b0xvd2VyQ2FzZSgpICE9PSBcImh0bWxcIikge1xuXHRpZiAoJChub2RlKS5jc3MoJ2Rpc3BsYXknKSA9PT0gJ25vbmUnKSB7XG5cdCAgICByZXQgPSBmYWxzZTtcblx0ICAgIGJyZWFrO1xuXHR9XG5cdG5vZGUgPSBub2RlLnBhcmVudE5vZGU7XG4gICAgfVxuICAgIHJldHVybiByZXQ7XG59O1xuXG52YXIgT25jb3ByaW50TGVnZW5kVmlldyA9IChmdW5jdGlvbigpIHtcbiAgICBmdW5jdGlvbiBPbmNvcHJpbnRMZWdlbmRWaWV3KCRkaXYsIGJhc2Vfd2lkdGgsIGJhc2VfaGVpZ2h0KSB7XG5cdHRoaXMuJGRpdiA9ICRkaXY7XG5cdHRoaXMuJHN2ZyA9ICQoc3ZnZmFjdG9yeS5zdmcoMjAwLDIwMCkpLmFwcGVuZFRvKHRoaXMuJGRpdik7XG5cdHRoaXMuYmFzZV93aWR0aCA9IGJhc2Vfd2lkdGg7XG5cdHRoaXMuYmFzZV9oZWlnaHQgPSBiYXNlX2hlaWdodDtcblx0dGhpcy5yZW5kZXJpbmdfc3VwcHJlc3NlZCA9IGZhbHNlO1xuXHRcblx0dGhpcy53aWR0aCA9ICRkaXYud2lkdGgoKTtcblx0XG5cdHRoaXMucnVsZV9zZXRfbGFiZWxfY29uZmlnID0ge1xuXHQgICAgd2VpZ2h0OiAnYm9sZCcsXG5cdCAgICBzaXplOiAxMixcblx0ICAgIGZvbnQ6ICdBcmlhbCdcblx0fTtcblx0dGhpcy5ydWxlX2xhYmVsX2NvbmZpZyA9IHtcblx0ICAgIHdlaWdodDogJ25vcm1hbCcsXG5cdCAgICBzaXplOiAxMixcblx0ICAgIGZvbnQ6ICdBcmlhbCdcblx0fTtcblx0XG5cdHRoaXMucGFkZGluZ19hZnRlcl9ydWxlX3NldF9sYWJlbCA9IDEwO1xuXHR0aGlzLnBhZGRpbmdfYmV0d2Vlbl9ydWxlcyA9IDIwO1xuXHR0aGlzLnBhZGRpbmdfYmV0d2Vlbl9ydWxlX3NldF9yb3dzID0gMTA7XG4gICAgfVxuICAgIFxuICAgIHZhciByZW5kZXJMZWdlbmQgPSBmdW5jdGlvbih2aWV3LCBtb2RlbCwgdGFyZ2V0X3N2Zywgc2hvd19hbGwpIHtcblx0aWYgKHZpZXcucmVuZGVyaW5nX3N1cHByZXNzZWQpIHtcblx0ICAgIHJldHVybjtcblx0fVxuXHRpZiAodHlwZW9mIHRhcmdldF9zdmcgPT09ICd1bmRlZmluZWQnKSB7XG5cdCAgICB0YXJnZXRfc3ZnID0gdmlldy4kc3ZnWzBdO1xuXHR9XG5cdGlmICghbm9kZUlzVmlzaWJsZSh0YXJnZXRfc3ZnKSkge1xuXHQgICAgcmV0dXJuO1xuXHR9XG5cdCQodGFyZ2V0X3N2ZykuZW1wdHkoKTtcblx0dmFyIGRlZnMgPSBzdmdmYWN0b3J5LmRlZnMoKTtcblx0dGFyZ2V0X3N2Zy5hcHBlbmRDaGlsZChkZWZzKTtcblx0XG5cdHZhciBldmVyeXRoaW5nX2dyb3VwID0gc3ZnZmFjdG9yeS5ncm91cCgwLDApO1xuXHR0YXJnZXRfc3ZnLmFwcGVuZENoaWxkKGV2ZXJ5dGhpbmdfZ3JvdXApO1xuXHRcblx0dmFyIHJ1bGVfc2V0cyA9IG1vZGVsLmdldFJ1bGVTZXRzKCk7XG5cdHZhciB5ID0gMDtcblx0dmFyIHJ1bGVfc3RhcnRfeCA9IDIwMDtcblx0Zm9yICh2YXIgaT0wOyBpPHJ1bGVfc2V0cy5sZW5ndGg7IGkrKykge1xuXHQgICAgaWYgKHJ1bGVfc2V0c1tpXS5leGNsdWRlX2Zyb21fbGVnZW5kICYmICFzaG93X2FsbCkge1xuXHRcdGNvbnRpbnVlO1xuXHQgICAgfVxuXHQgICAgdmFyIHJ1bGVfc2V0X2dyb3VwID0gc3ZnZmFjdG9yeS5ncm91cCgwLHkpO1xuXHQgICAgZXZlcnl0aGluZ19ncm91cC5hcHBlbmRDaGlsZChydWxlX3NldF9ncm91cCk7XG5cdCAgICAoZnVuY3Rpb24gYWRkTGFiZWwoKSB7XG5cdFx0aWYgKCh0eXBlb2YgcnVsZV9zZXRzW2ldLmxlZ2VuZF9sYWJlbCAhPT0gJ3VuZGVmaW5lZCcpICYmIHJ1bGVfc2V0c1tpXS5sZWdlbmRfbGFiZWwubGVuZ3RoID4gMCkge1xuXHRcdCAgICB2YXIgbGFiZWwgPSBzdmdmYWN0b3J5LnRleHQocnVsZV9zZXRzW2ldLmxlZ2VuZF9sYWJlbCwgMCwgMCwgMTIsICdBcmlhbCcsICdib2xkJyk7XG5cdFx0ICAgIHJ1bGVfc2V0X2dyb3VwLmFwcGVuZENoaWxkKGxhYmVsKTtcblx0XHQgICAgc3ZnZmFjdG9yeS53cmFwVGV4dChsYWJlbCwgcnVsZV9zdGFydF94KTtcblx0XHR9XG5cdCAgICB9KSgpO1xuXHQgICAgXG5cdCAgICB2YXIgeCA9IHJ1bGVfc3RhcnRfeCArIHZpZXcucGFkZGluZ19hZnRlcl9ydWxlX3NldF9sYWJlbDtcblx0ICAgIHZhciBpbl9ncm91cF95X29mZnNldCA9IDA7XG5cdCAgICBcblx0ICAgIHZhciBydWxlcyA9IG1vZGVsLmdldEFjdGl2ZVJ1bGVzKHJ1bGVfc2V0c1tpXS5ydWxlX3NldF9pZCk7XG5cdCAgICBmb3IgKHZhciBqPTA7IGo8cnVsZXMubGVuZ3RoOyBqKyspIHtcblx0XHR2YXIgcnVsZSA9IHJ1bGVzW2pdLnJ1bGU7XG5cdFx0aWYgKHJ1bGUuZXhjbHVkZV9mcm9tX2xlZ2VuZCkge1xuXHRcdCAgICBjb250aW51ZTtcblx0XHR9XG5cdFx0dmFyIGdyb3VwID0gcnVsZVRvU1ZHR3JvdXAocnVsZSwgdmlldywgbW9kZWwsIHRhcmdldF9zdmcsIGRlZnMpO1xuXHRcdGdyb3VwLnNldEF0dHJpYnV0ZSgndHJhbnNmb3JtJywgJ3RyYW5zbGF0ZSgnK3grJywnK2luX2dyb3VwX3lfb2Zmc2V0KycpJyk7XG5cdFx0cnVsZV9zZXRfZ3JvdXAuYXBwZW5kQ2hpbGQoZ3JvdXApO1xuXHRcdGlmICh4ICsgZ3JvdXAuZ2V0QkJveCgpLndpZHRoID4gdmlldy53aWR0aCkge1xuXHRcdCAgICB4ID0gcnVsZV9zdGFydF94ICsgdmlldy5wYWRkaW5nX2FmdGVyX3J1bGVfc2V0X2xhYmVsO1xuXHRcdCAgICBpbl9ncm91cF95X29mZnNldCA9IHJ1bGVfc2V0X2dyb3VwLmdldEJCb3goKS5oZWlnaHQgKyB2aWV3LnBhZGRpbmdfYmV0d2Vlbl9ydWxlX3NldF9yb3dzO1xuXHRcdCAgICBncm91cC5zZXRBdHRyaWJ1dGUoJ3RyYW5zZm9ybScsICd0cmFuc2xhdGUoJyt4KycsJytpbl9ncm91cF95X29mZnNldCsnKScpO1xuXHRcdH1cblx0XHR4ICs9IGdyb3VwLmdldEJCb3goKS53aWR0aDtcblx0XHR4ICs9IHZpZXcucGFkZGluZ19iZXR3ZWVuX3J1bGVzO1xuXHQgICAgfVxuXHQgICAgeSArPSBydWxlX3NldF9ncm91cC5nZXRCQm94KCkuaGVpZ2h0O1xuXHQgICAgeSArPSAzKnZpZXcucGFkZGluZ19iZXR3ZWVuX3J1bGVfc2V0X3Jvd3M7XG5cdH1cblx0dmFyIGV2ZXJ5dGhpbmdfYm94ID0gZXZlcnl0aGluZ19ncm91cC5nZXRCQm94KCk7XG5cdHZpZXcuJHN2Z1swXS5zZXRBdHRyaWJ1dGUoJ3dpZHRoJywgZXZlcnl0aGluZ19ib3gud2lkdGgpO1xuXHR2aWV3LiRzdmdbMF0uc2V0QXR0cmlidXRlKCdoZWlnaHQnLCBldmVyeXRoaW5nX2JveC5oZWlnaHQpO1xuICAgIH07XG4gICAgXG4gICAgdmFyIHJ1bGVUb1NWR0dyb3VwID0gZnVuY3Rpb24ocnVsZSwgdmlldywgbW9kZWwsIHRhcmdldF9zdmcsIHRhcmdldF9kZWZzKSB7XG5cdHZhciByb290ID0gc3ZnZmFjdG9yeS5ncm91cCgwLDApO1xuXHR2YXIgY29uZmlnID0gcnVsZS5nZXRMZWdlbmRDb25maWcoKTtcblx0aWYgKGNvbmZpZy50eXBlID09PSAncnVsZScpIHtcblx0ICAgIHZhciBjb25jcmV0ZV9zaGFwZXMgPSBydWxlLmFwcGx5KGNvbmZpZy50YXJnZXQsIG1vZGVsLmdldENlbGxXaWR0aCh0cnVlKSwgdmlldy5iYXNlX2hlaWdodCk7XG5cdCAgICBmb3IgKHZhciBpPTA7IGk8Y29uY3JldGVfc2hhcGVzLmxlbmd0aDsgaSsrKSB7XG5cdFx0cm9vdC5hcHBlbmRDaGlsZChzdmdmYWN0b3J5LmZyb21TaGFwZShjb25jcmV0ZV9zaGFwZXNbaV0sIDAsIDApKTtcblx0ICAgIH1cblx0ICAgIGlmICh0eXBlb2YgcnVsZS5sZWdlbmRfbGFiZWwgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0dmFyIGZvbnRfc2l6ZSA9IDEyO1xuXHRcdHZhciB0ZXh0X25vZGUgPSBzdmdmYWN0b3J5LnRleHQocnVsZS5sZWdlbmRfbGFiZWwsIG1vZGVsLmdldENlbGxXaWR0aCh0cnVlKSArIDUsIHZpZXcuYmFzZV9oZWlnaHQvMiwgZm9udF9zaXplLCAnQXJpYWwnLCAnbm9ybWFsJyk7XG5cdFx0dGFyZ2V0X3N2Zy5hcHBlbmRDaGlsZCh0ZXh0X25vZGUpO1xuXHRcdHZhciBoZWlnaHQgPSB0ZXh0X25vZGUuZ2V0QkJveCgpLmhlaWdodDtcblx0XHR0ZXh0X25vZGUuc2V0QXR0cmlidXRlKCd5JywgcGFyc2VGbG9hdCh0ZXh0X25vZGUuZ2V0QXR0cmlidXRlKCd5JykpIC0gaGVpZ2h0LzIpO1xuXHRcdHRhcmdldF9zdmcucmVtb3ZlQ2hpbGQodGV4dF9ub2RlKTtcblx0XHRyb290LmFwcGVuZENoaWxkKHRleHRfbm9kZSk7XG5cdCAgICB9XG5cdH0gZWxzZSBpZiAoY29uZmlnLnR5cGUgPT09ICdudW1iZXInKSB7XG5cdCAgICB2YXIgbnVtX2RlY2ltYWxfZGlnaXRzID0gMjtcblx0ICAgIHZhciBkaXNwbGF5X3JhbmdlID0gY29uZmlnLnJhbmdlLm1hcChmdW5jdGlvbih4KSB7XG5cdFx0dmFyIG51bV9kaWdpdF9tdWx0aXBsaWVyID0gTWF0aC5wb3coMTAsIG51bV9kZWNpbWFsX2RpZ2l0cyk7XG5cdFx0cmV0dXJuIE1hdGgucm91bmQoeCAqIG51bV9kaWdpdF9tdWx0aXBsaWVyKSAvIG51bV9kaWdpdF9tdWx0aXBsaWVyO1xuXHQgICAgfSk7XG5cdCAgICByb290LmFwcGVuZENoaWxkKHN2Z2ZhY3RvcnkudGV4dChkaXNwbGF5X3JhbmdlWzBdLCAwLCAwLCAxMiwgJ0FyaWFsJywgJ25vcm1hbCcpKTtcblx0ICAgIHJvb3QuYXBwZW5kQ2hpbGQoc3ZnZmFjdG9yeS50ZXh0KGRpc3BsYXlfcmFuZ2VbMV0sIDUwLCAwLCAxMiwgJ0FyaWFsJywgJ25vcm1hbCcpKTtcblx0ICAgIHZhciBtZXNoID0gMTAwO1xuXHQgICAgdmFyIHBvaW50cyA9IFtdO1xuXHQgICAgcG9pbnRzLnB1c2goWzUsIDIwXSk7XG5cdCAgICBmb3IgKHZhciBpPTA7IGk8bWVzaDsgaSsrKSB7XG5cdFx0dmFyIHQgPSBpL21lc2g7XG5cdFx0dmFyIGggPSBjb25maWcuaW50ZXJwRm4oKDEtdCkqY29uZmlnLnJhbmdlWzBdICsgdCpjb25maWcucmFuZ2VbMV0pO1xuXHRcdHZhciBoZWlnaHQgPSAyMCpoO1xuXHRcdHBvaW50cy5wdXNoKFs1ICsgNDAqaS9tZXNoLCAyMC1oZWlnaHRdKTtcblx0ICAgIH1cblx0ICAgIHBvaW50cy5wdXNoKFs0NSwgMjBdKTtcblx0ICAgIHJvb3QuYXBwZW5kQ2hpbGQoc3ZnZmFjdG9yeS5wYXRoKHBvaW50cywgY29uZmlnLmNvbG9yLCBjb25maWcuY29sb3IpKTtcblx0fSBlbHNlIGlmIChjb25maWcudHlwZSA9PT0gJ2dyYWRpZW50Jykge1xuXHQgICAgdmFyIG51bV9kZWNpbWFsX2RpZ2l0cyA9IDI7XG5cdCAgICB2YXIgZGlzcGxheV9yYW5nZSA9IGNvbmZpZy5yYW5nZS5tYXAoZnVuY3Rpb24oeCkge1xuXHRcdHZhciBudW1fZGlnaXRfbXVsdGlwbGllciA9IE1hdGgucG93KDEwLCBudW1fZGVjaW1hbF9kaWdpdHMpO1xuXHRcdHJldHVybiBNYXRoLnJvdW5kKHggKiBudW1fZGlnaXRfbXVsdGlwbGllcikgLyBudW1fZGlnaXRfbXVsdGlwbGllcjtcblx0ICAgIH0pO1xuXHQgICAgdmFyIGdyYWRpZW50ID0gc3ZnZmFjdG9yeS5ncmFkaWVudChjb25maWcuY29sb3JGbik7XG5cdCAgICB2YXIgZ3JhZGllbnRfaWQgPSBncmFkaWVudC5nZXRBdHRyaWJ1dGUoXCJpZFwiKTtcblx0ICAgIHRhcmdldF9kZWZzLmFwcGVuZENoaWxkKGdyYWRpZW50KTtcblx0ICAgIHJvb3QuYXBwZW5kQ2hpbGQoc3ZnZmFjdG9yeS50ZXh0KGRpc3BsYXlfcmFuZ2VbMF0sIDAsIDAsIDEyLCAnQXJpYWwnLCAnbm9ybWFsJykpO1xuXHQgICAgcm9vdC5hcHBlbmRDaGlsZChzdmdmYWN0b3J5LnRleHQoZGlzcGxheV9yYW5nZVsxXSwgMTIwLCAwLCAxMiwgJ0FyaWFsJywgJ25vcm1hbCcpKTtcblx0ICAgIHJvb3QuYXBwZW5kQ2hpbGQoc3ZnZmFjdG9yeS5yZWN0KDMwLDAsNjAsMjAsXCJ1cmwoI1wiK2dyYWRpZW50X2lkK1wiKVwiKSk7XG5cdH1cblx0cmV0dXJuIHJvb3Q7XG4gICAgfTtcbiAgICBcbiAgICBPbmNvcHJpbnRMZWdlbmRWaWV3LnByb3RvdHlwZS5zZXRXaWR0aCA9IGZ1bmN0aW9uKHcsIG1vZGVsKSB7XG5cdHRoaXMud2lkdGggPSB3O1xuXHRyZW5kZXJMZWdlbmQodGhpcywgbW9kZWwpO1xuICAgIH1cbiAgICBPbmNvcHJpbnRMZWdlbmRWaWV3LnByb3RvdHlwZS5yZW1vdmVUcmFjayA9IGZ1bmN0aW9uKG1vZGVsKSB7XG5cdHJlbmRlckxlZ2VuZCh0aGlzLCBtb2RlbCk7XG4gICAgfVxuICAgIFxuICAgIE9uY29wcmludExlZ2VuZFZpZXcucHJvdG90eXBlLmFkZFRyYWNrcyA9IGZ1bmN0aW9uKG1vZGVsKSB7XG5cdHJlbmRlckxlZ2VuZCh0aGlzLCBtb2RlbCk7XG4gICAgfVxuICAgIFxuICAgIE9uY29wcmludExlZ2VuZFZpZXcucHJvdG90eXBlLnNldFRyYWNrRGF0YSA9IGZ1bmN0aW9uKG1vZGVsKSB7XG5cdHJlbmRlckxlZ2VuZCh0aGlzLCBtb2RlbCk7XG4gICAgfVxuICAgIFxuICAgIE9uY29wcmludExlZ2VuZFZpZXcucHJvdG90eXBlLnNoYXJlUnVsZVNldCA9IGZ1bmN0aW9uKG1vZGVsKSB7XG5cdHJlbmRlckxlZ2VuZCh0aGlzLCBtb2RlbCk7XG4gICAgfVxuICAgIFxuICAgIE9uY29wcmludExlZ2VuZFZpZXcucHJvdG90eXBlLnNldFJ1bGVTZXQgPSBmdW5jdGlvbihtb2RlbCkge1xuXHRyZW5kZXJMZWdlbmQodGhpcywgbW9kZWwpO1xuICAgIH1cbiAgICBcbiAgICBPbmNvcHJpbnRMZWdlbmRWaWV3LnByb3RvdHlwZS5oaWRlVHJhY2tMZWdlbmRzID0gZnVuY3Rpb24obW9kZWwpIHtcblx0cmVuZGVyTGVnZW5kKHRoaXMsIG1vZGVsKTtcbiAgICB9XG4gICAgXG4gICAgT25jb3ByaW50TGVnZW5kVmlldy5wcm90b3R5cGUuc2hvd1RyYWNrTGVnZW5kcyA9IGZ1bmN0aW9uKG1vZGVsKSB7XG5cdHJlbmRlckxlZ2VuZCh0aGlzLCBtb2RlbCk7XG4gICAgfVxuICAgIFxuICAgIE9uY29wcmludExlZ2VuZFZpZXcucHJvdG90eXBlLnN1cHByZXNzUmVuZGVyaW5nID0gZnVuY3Rpb24oKSB7XG5cdHRoaXMucmVuZGVyaW5nX3N1cHByZXNzZWQgPSB0cnVlO1xuICAgIH1cbiAgICBcbiAgICBPbmNvcHJpbnRMZWdlbmRWaWV3LnByb3RvdHlwZS5yZWxlYXNlUmVuZGVyaW5nID0gZnVuY3Rpb24obW9kZWwpIHtcblx0dGhpcy5yZW5kZXJpbmdfc3VwcHJlc3NlZCA9IGZhbHNlO1xuXHRyZW5kZXJMZWdlbmQodGhpcywgbW9kZWwpO1xuICAgIH1cbiAgICBcbiAgICBPbmNvcHJpbnRMZWdlbmRWaWV3LnByb3RvdHlwZS50b1NWR0dyb3VwID0gZnVuY3Rpb24obW9kZWwsIG9mZnNldF94LCBvZmZzZXRfeSkge1xuXHR2YXIgcm9vdCA9IHN2Z2ZhY3RvcnkuZ3JvdXAoKG9mZnNldF94IHx8IDApLCAob2Zmc2V0X3kgfHwgMCkpO1xuXHR0aGlzLiRzdmcuYXBwZW5kKHJvb3QpO1xuXHRyZW5kZXJMZWdlbmQodGhpcywgbW9kZWwsIHJvb3QsIHRydWUpO1xuXHRyb290LnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQocm9vdCk7XG5cdHJldHVybiByb290O1xuICAgIH1cbiAgICBcbiAgICByZXR1cm4gT25jb3ByaW50TGVnZW5kVmlldztcbn0pKCk7XG5cbm1vZHVsZS5leHBvcnRzID0gT25jb3ByaW50TGVnZW5kVmlldzsiLCJ2YXIgZ2xfbWF0cml4ID0gcmVxdWlyZSgnZ2wtbWF0cml4Jyk7XG52YXIgT25jb3ByaW50Wm9vbVNsaWRlciA9IHJlcXVpcmUoJy4vb25jb3ByaW50em9vbXNsaWRlci5qcycpO1xuXG52YXIgYXJyYXlGaW5kSW5kZXggPSBmdW5jdGlvbiAoYXJyLCBjYWxsYmFjaywgc3RhcnRfaW5kZXgpIHtcbiAgICBzdGFydF9pbmRleCA9IHN0YXJ0X2luZGV4IHx8IDA7XG4gICAgZm9yICh2YXIgaSA9IHN0YXJ0X2luZGV4OyBpIDwgYXJyLmxlbmd0aDsgaSsrKSB7XG5cdGlmIChjYWxsYmFjayhhcnJbaV0pKSB7XG5cdCAgICByZXR1cm4gaTtcblx0fVxuICAgIH1cbiAgICByZXR1cm4gLTE7XG59O1xuXG52YXIgZ2V0V2ViR0xDYW52YXNDb250ZXh0ID0gZnVuY3Rpb24gKHZpZXcpIHtcbiAgICB0cnkge1xuXHR2YXIgY2FudmFzID0gdmlldy4kY2FudmFzWzBdO1xuXHR2YXIgY3R4ID0gY2FudmFzLmdldENvbnRleHQoXCJleHBlcmltZW50YWwtd2ViZ2xcIiwge2FscGhhOiBmYWxzZSwgYW50aWFsaWFzOiB0cnVlfSk7XG5cdGN0eC5jbGVhckNvbG9yKDEuMCwgMS4wLCAxLjAsIDEuMCk7XG5cdGN0eC5jbGVhcihjdHguQ09MT1JfQlVGRkVSX0JJVCB8IGN0eC5ERVBUSF9CVUZGRVJfQklUKTtcblx0Y3R4LnZpZXdwb3J0V2lkdGggPSBjYW52YXMud2lkdGg7XG5cdGN0eC52aWV3cG9ydEhlaWdodCA9IGNhbnZhcy5oZWlnaHQ7XG5cdGN0eC52aWV3cG9ydCgwLCAwLCBjdHgudmlld3BvcnRXaWR0aCwgY3R4LnZpZXdwb3J0SGVpZ2h0KTtcblx0Y3R4LmVuYWJsZShjdHguREVQVEhfVEVTVCk7XG5cdGN0eC5lbmFibGUoY3R4LkJMRU5EKTtcblx0Y3R4LmJsZW5kRXF1YXRpb24oY3R4LkZVTkNfQUREKTtcblx0Y3R4LmJsZW5kRnVuYyhjdHguU1JDX0FMUEhBLCBjdHguT05FX01JTlVTX1NSQ19BTFBIQSk7XG5cdGN0eC5kZXB0aE1hc2soZmFsc2UpO1xuXG5cdHJldHVybiBjdHg7XG4gICAgfSBjYXRjaCAoZSkge1xuXHRyZXR1cm4gbnVsbDtcbiAgICB9XG59O1xudmFyIGNyZWF0ZVNoYWRlclByb2dyYW0gPSBmdW5jdGlvbiAodmlldywgdmVydGV4X3NoYWRlciwgZnJhZ21lbnRfc2hhZGVyKSB7XG4gICAgdmFyIHByb2dyYW0gPSB2aWV3LmN0eC5jcmVhdGVQcm9ncmFtKCk7XG4gICAgdmlldy5jdHguYXR0YWNoU2hhZGVyKHByb2dyYW0sIHZlcnRleF9zaGFkZXIpO1xuICAgIHZpZXcuY3R4LmF0dGFjaFNoYWRlcihwcm9ncmFtLCBmcmFnbWVudF9zaGFkZXIpO1xuXG4gICAgdmlldy5jdHgubGlua1Byb2dyYW0ocHJvZ3JhbSk7XG5cbiAgICB2YXIgc3VjY2VzcyA9IHZpZXcuY3R4LmdldFByb2dyYW1QYXJhbWV0ZXIocHJvZ3JhbSwgdmlldy5jdHguTElOS19TVEFUVVMpO1xuICAgIGlmICghc3VjY2Vzcykge1xuXHR2YXIgbXNnID0gdmlldy5jdHguZ2V0UHJvZ3JhbUluZm9Mb2cocHJvZ3JhbSk7XG5cdHZpZXcuY3R4LmRlbGV0ZVByb2dyYW0ocHJvZ3JhbSk7XG5cdHRocm93IFwiVW5hYmxlIHRvIGxpbmsgc2hhZGVyIHByb2dyYW06IFwiICsgbXNnO1xuICAgIH1cblxuICAgIHJldHVybiBwcm9ncmFtO1xufTtcbnZhciBjcmVhdGVTaGFkZXIgPSBmdW5jdGlvbiAodmlldywgc291cmNlLCB0eXBlKSB7XG4gICAgdmFyIHNoYWRlciA9IHZpZXcuY3R4LmNyZWF0ZVNoYWRlcih2aWV3LmN0eFt0eXBlXSk7XG4gICAgdmlldy5jdHguc2hhZGVyU291cmNlKHNoYWRlciwgc291cmNlKTtcbiAgICB2aWV3LmN0eC5jb21waWxlU2hhZGVyKHNoYWRlcik7XG5cbiAgICB2YXIgc3VjY2VzcyA9IHZpZXcuY3R4LmdldFNoYWRlclBhcmFtZXRlcihzaGFkZXIsIHZpZXcuY3R4LkNPTVBJTEVfU1RBVFVTKTtcbiAgICBpZiAoIXN1Y2Nlc3MpIHtcblx0dmFyIG1zZyA9IHZpZXcuY3R4LmdldFNoYWRlckluZm9Mb2coc2hhZGVyKTtcblx0dmlldy5jdHguZGVsZXRlU2hhZGVyKHNoYWRlcik7XG5cdHRocm93IFwiVW5hYmxlIHRvIGNvbXBpbGUgc2hhZGVyOiBcIiArIG1zZztcbiAgICB9XG5cbiAgICByZXR1cm4gc2hhZGVyO1xufTtcbnZhciBnZXRXZWJHTENvbnRleHRBbmRTZXRVcE1hdHJpY2VzID0gZnVuY3Rpb24gKHZpZXcpIHtcbiAgICB2aWV3LmN0eCA9IGdldFdlYkdMQ2FudmFzQ29udGV4dCh2aWV3KTtcbiAgICAoZnVuY3Rpb24gaW5pdGlhbGl6ZU1hdHJpY2VzKHNlbGYpIHtcblx0dmFyIG12TWF0cml4ID0gZ2xfbWF0cml4Lm1hdDQuY3JlYXRlKCk7XG5cdGdsX21hdHJpeC5tYXQ0Lmxvb2tBdChtdk1hdHJpeCwgWzAsIDAsIDFdLCBbMCwgMCwgMF0sIFswLCAxLCAwXSk7XG5cdHNlbGYubXZNYXRyaXggPSBtdk1hdHJpeDtcblxuXHR2YXIgcE1hdHJpeCA9IGdsX21hdHJpeC5tYXQ0LmNyZWF0ZSgpO1xuXHRnbF9tYXRyaXgubWF0NC5vcnRobyhwTWF0cml4LCAwLCBzZWxmLmN0eC52aWV3cG9ydFdpZHRoLCBzZWxmLmN0eC52aWV3cG9ydEhlaWdodCwgMCwgLTUsIDEwMDApOyAvLyB5IGF4aXMgaW52ZXJ0ZWQgc28gdGhhdCB5IGluY3JlYXNlcyBkb3duIGxpa2UgU1ZHXG5cdHNlbGYucE1hdHJpeCA9IHBNYXRyaXg7XG4gICAgfSkodmlldyk7XG59O1xudmFyIGdldFdlYkdMQ29udGV4dEFuZFNldFVwTWF0cmljZXNBbmRTaGFkZXJzID0gZnVuY3Rpb24gKHZpZXcpIHtcbiAgICBnZXRXZWJHTENvbnRleHRBbmRTZXRVcE1hdHJpY2VzKHZpZXcpO1xuICAgIChmdW5jdGlvbiBpbml0aWFsaXplU2hhZGVycyhzZWxmKSB7Ly8gSW5pdGlhbGl6ZSBzaGFkZXJzXG5cdHZhciB2ZXJ0ZXhfc2hhZGVyX3NvdXJjZSA9IFsnYXR0cmlidXRlIHZlYzMgYVZlcnRleFBvc2l0aW9uOycsXG5cdCAgICAnYXR0cmlidXRlIHZlYzQgYVZlcnRleENvbG9yOycsXG5cdCAgICAnYXR0cmlidXRlIGZsb2F0IGFWZXJ0ZXhPbmNvcHJpbnRDb2x1bW47Jyxcblx0ICAgICd1bmlmb3JtIGZsb2F0IGNvbHVtbldpZHRoOycsXG5cdCAgICAndW5pZm9ybSBmbG9hdCB6b29tWDsnLFxuXHQgICAgJ3VuaWZvcm0gZmxvYXQgem9vbVk7Jyxcblx0ICAgICd1bmlmb3JtIG1hdDQgdU1WTWF0cml4OycsXG5cdCAgICAndW5pZm9ybSBtYXQ0IHVQTWF0cml4OycsXG5cdCAgICAndW5pZm9ybSBmbG9hdCBvZmZzZXRZOycsXG5cdCAgICAndmFyeWluZyB2ZWM0IHZDb2xvcjsnLFxuXHQgICAgJ3ZvaWQgbWFpbih2b2lkKSB7Jyxcblx0ICAgICdcdGdsX1Bvc2l0aW9uID0gdmVjNChhVmVydGV4UG9zaXRpb24sIDEuMCk7Jyxcblx0ICAgICdcdGdsX1Bvc2l0aW9uWzBdICs9IGFWZXJ0ZXhPbmNvcHJpbnRDb2x1bW4gKiBjb2x1bW5XaWR0aDsnLFxuXHQgICAgJ1x0Z2xfUG9zaXRpb25bMV0gKz0gb2Zmc2V0WTsnLFxuXHQgICAgJ1x0Z2xfUG9zaXRpb24gKj0gdmVjNCh6b29tWCwgem9vbVksIDEuMCwgMS4wKTsnLFxuXHQgICAgJ1x0Z2xfUG9zaXRpb24gPSB1UE1hdHJpeCAqIHVNVk1hdHJpeCAqIGdsX1Bvc2l0aW9uOycsXG5cdCAgICAnXHR2Q29sb3IgPSBhVmVydGV4Q29sb3I7Jyxcblx0ICAgICd9J10uam9pbignXFxuJyk7XG5cdHZhciBmcmFnbWVudF9zaGFkZXJfc291cmNlID0gWydwcmVjaXNpb24gbWVkaXVtcCBmbG9hdDsnLFxuXHQgICAgJ3ZhcnlpbmcgdmVjNCB2Q29sb3I7Jyxcblx0ICAgICcnLFxuXHQgICAgJ3ZvaWQgbWFpbih2b2lkKSB7Jyxcblx0ICAgICcgICBnbF9GcmFnQ29sb3IgPSB2Q29sb3I7Jyxcblx0ICAgICd9J10uam9pbignXFxuJyk7XG5cdHZhciB2ZXJ0ZXhfc2hhZGVyID0gY3JlYXRlU2hhZGVyKHNlbGYsIHZlcnRleF9zaGFkZXJfc291cmNlLCAnVkVSVEVYX1NIQURFUicpO1xuXHR2YXIgZnJhZ21lbnRfc2hhZGVyID0gY3JlYXRlU2hhZGVyKHNlbGYsIGZyYWdtZW50X3NoYWRlcl9zb3VyY2UsICdGUkFHTUVOVF9TSEFERVInKTtcblxuXHR2YXIgc2hhZGVyX3Byb2dyYW0gPSBjcmVhdGVTaGFkZXJQcm9ncmFtKHNlbGYsIHZlcnRleF9zaGFkZXIsIGZyYWdtZW50X3NoYWRlcik7XG5cdHNoYWRlcl9wcm9ncmFtLnZlcnRleFBvc2l0aW9uQXR0cmlidXRlID0gc2VsZi5jdHguZ2V0QXR0cmliTG9jYXRpb24oc2hhZGVyX3Byb2dyYW0sICdhVmVydGV4UG9zaXRpb24nKTtcblx0c2VsZi5jdHguZW5hYmxlVmVydGV4QXR0cmliQXJyYXkoc2hhZGVyX3Byb2dyYW0udmVydGV4UG9zaXRpb25BdHRyaWJ1dGUpO1xuXHRzaGFkZXJfcHJvZ3JhbS52ZXJ0ZXhDb2xvckF0dHJpYnV0ZSA9IHNlbGYuY3R4LmdldEF0dHJpYkxvY2F0aW9uKHNoYWRlcl9wcm9ncmFtLCAnYVZlcnRleENvbG9yJyk7XG5cdHNlbGYuY3R4LmVuYWJsZVZlcnRleEF0dHJpYkFycmF5KHNoYWRlcl9wcm9ncmFtLnZlcnRleENvbG9yQXR0cmlidXRlKTtcblx0c2hhZGVyX3Byb2dyYW0udmVydGV4T25jb3ByaW50Q29sdW1uQXR0cmlidXRlID0gc2VsZi5jdHguZ2V0QXR0cmliTG9jYXRpb24oc2hhZGVyX3Byb2dyYW0sICdhVmVydGV4T25jb3ByaW50Q29sdW1uJyk7XG5cdHNlbGYuY3R4LmVuYWJsZVZlcnRleEF0dHJpYkFycmF5KHNoYWRlcl9wcm9ncmFtLnZlcnRleE9uY29wcmludENvbHVtbkF0dHJpYnV0ZSk7XG5cblx0c2hhZGVyX3Byb2dyYW0ucE1hdHJpeFVuaWZvcm0gPSBzZWxmLmN0eC5nZXRVbmlmb3JtTG9jYXRpb24oc2hhZGVyX3Byb2dyYW0sICd1UE1hdHJpeCcpO1xuXHRzaGFkZXJfcHJvZ3JhbS5tdk1hdHJpeFVuaWZvcm0gPSBzZWxmLmN0eC5nZXRVbmlmb3JtTG9jYXRpb24oc2hhZGVyX3Byb2dyYW0sICd1TVZNYXRyaXgnKTtcblx0c2hhZGVyX3Byb2dyYW0uY29sdW1uV2lkdGhVbmlmb3JtID0gc2VsZi5jdHguZ2V0VW5pZm9ybUxvY2F0aW9uKHNoYWRlcl9wcm9ncmFtLCAnY29sdW1uV2lkdGgnKTtcblx0c2hhZGVyX3Byb2dyYW0uem9vbVhVbmlmb3JtID0gc2VsZi5jdHguZ2V0VW5pZm9ybUxvY2F0aW9uKHNoYWRlcl9wcm9ncmFtLCAnem9vbVgnKTtcblx0c2hhZGVyX3Byb2dyYW0uem9vbVlVbmlmb3JtID0gc2VsZi5jdHguZ2V0VW5pZm9ybUxvY2F0aW9uKHNoYWRlcl9wcm9ncmFtLCAnem9vbVknKTtcblx0c2hhZGVyX3Byb2dyYW0ub2Zmc2V0WVVuaWZvcm0gPSBzZWxmLmN0eC5nZXRVbmlmb3JtTG9jYXRpb24oc2hhZGVyX3Byb2dyYW0sICdvZmZzZXRZJyk7XG5cblx0c2VsZi5zaGFkZXJfcHJvZ3JhbSA9IHNoYWRlcl9wcm9ncmFtO1xuICAgIH0pKHZpZXcpO1xufTtcblxudmFyIGNsYW1wID0gZnVuY3Rpb24oeCwgbG93ZXIsIHVwcGVyKSB7XG4gICAgcmV0dXJuIE1hdGgubWF4KGxvd2VyLCBNYXRoLm1pbih1cHBlciwgeCkpO1xufTtcblxudmFyIE9uY29wcmludE1pbmltYXBWaWV3ID0gKGZ1bmN0aW9uICgpIHtcblxuICAgIGZ1bmN0aW9uIE9uY29wcmludE1pbmltYXBWaWV3KCRkaXYsICRjYW52YXMsICRvdmVybGF5X2NhbnZhcywgbW9kZWwsIGNlbGxfdmlldywgd2lkdGgsIGhlaWdodCwgZHJhZ19jYWxsYmFjaywgdmlld3BvcnRfY2FsbGJhY2ssIGhvcnpfem9vbV9jYWxsYmFjaywgdmVydF96b29tX2NhbGxiYWNrLCB6b29tX3RvX2ZpdF9jYWxsYmFjaywgY2xvc2VfY2FsbGJhY2spIHtcblx0dGhpcy4kZGl2ID0gJGRpdjtcblx0dGhpcy4kY2FudmFzID0gJGNhbnZhcztcblx0dGhpcy4kb3ZlcmxheV9jYW52YXMgPSAkb3ZlcmxheV9jYW52YXM7XG5cblx0dmFyIHNlbGYgPSB0aGlzO1xuXHR2YXIgcGFkZGluZyA9IDQ7XG5cdHZhciB2ZXJ0aWNhbF96b29tX2FyZWFfd2lkdGggPSAyMDtcblx0dmFyIGhvcml6b250YWxfem9vbV9hcmVhX2hlaWdodCA9IDIwO1xuXHR2YXIgd2luZG93X2Jhcl9oZWlnaHQgPSAyMDtcblxuXHR0aGlzLmxheW91dF9udW1iZXJzID0ge1xuXHQgICAgd2luZG93X3dpZHRoOiBwYWRkaW5nICsgd2lkdGggKyBwYWRkaW5nICsgdmVydGljYWxfem9vbV9hcmVhX3dpZHRoLFxuXHQgICAgd2luZG93X2hlaWdodDogd2luZG93X2Jhcl9oZWlnaHQgKyBwYWRkaW5nICsgaGVpZ2h0ICsgcGFkZGluZyArIGhvcml6b250YWxfem9vbV9hcmVhX2hlaWdodCxcblx0ICAgIHZlcnRpY2FsX3pvb21fYXJlYV93aWR0aDogdmVydGljYWxfem9vbV9hcmVhX3dpZHRoLFxuXHQgICAgaG9yaXpvbnRhbF96b29tX2FyZWFfaGVpZ2h0OiBob3Jpem9udGFsX3pvb21fYXJlYV9oZWlnaHQsXG5cdCAgICBwYWRkaW5nOiBwYWRkaW5nLFxuXHQgICAgd2luZG93X2Jhcl9oZWlnaHQ6IHdpbmRvd19iYXJfaGVpZ2h0LFxuXHQgICAgY2FudmFzX2xlZnQ6IHBhZGRpbmcsXG5cdCAgICBjYW52YXNfdG9wOiB3aW5kb3dfYmFyX2hlaWdodCArIHBhZGRpbmcsXG5cdH07XG5cdHRoaXMuJGRpdi5jc3MoeydtaW4td2lkdGgnOiB0aGlzLmxheW91dF9udW1iZXJzLndpbmRvd193aWR0aCxcblx0XHRcdCdtaW4taGVpZ2h0JzogdGhpcy5sYXlvdXRfbnVtYmVycy53aW5kb3dfaGVpZ2h0LFxuXHRcdFx0J291dGxpbmUnOidzb2xpZCAxcHggYmxhY2snLCAnYmFja2dyb3VuZC1jb2xvcic6JyNmZmZmZmYnfSk7XG5cdFx0ICAgIFxuXHR0aGlzLiR3aW5kb3dfYmFyID0gJCgnPGRpdj4nKS5jc3Moeydwb3NpdGlvbic6J2Fic29sdXRlJywgXG5cdFx0XHRcdFx0ICAgICdtaW4td2lkdGgnOiB0aGlzLmxheW91dF9udW1iZXJzLndpbmRvd193aWR0aCxcblx0XHRcdFx0XHQgICAgJ21pbi1oZWlnaHQnOiB0aGlzLmxheW91dF9udW1iZXJzLndpbmRvd19iYXJfaGVpZ2h0LFxuXHRcdFx0XHRcdCAgICAnYmFja2dyb3VuZC1jb2xvcic6JyNjY2NjY2MnfSlcblx0XHRcdFx0XHRcdC5hcHBlbmRUbyh0aGlzLiRkaXYpO1xuXHRcdFx0XHRcdFxuXHR0aGlzLiRjbG9zZV9idG4gPSAkKCc8ZGl2PicpLmNzcyh7J3Bvc2l0aW9uJzonYWJzb2x1dGUnLFxuXHRcdFx0XHRcdCAgICAndG9wJzogMyxcblx0XHRcdFx0XHQgICAgJ2xlZnQnOiAzLFxuXHRcdFx0XHRcdCAgICAnbWluLXdpZHRoJzogdGhpcy5sYXlvdXRfbnVtYmVycy53aW5kb3dfYmFyX2hlaWdodCAtIDYsXG5cdFx0XHRcdFx0ICAgICdtaW4taGVpZ2h0JzogdGhpcy5sYXlvdXRfbnVtYmVycy53aW5kb3dfYmFyX2hlaWdodCAtIDYsXG5cdFx0XHRcdFx0ICAgICdjdXJzb3InOiAncG9pbnRlcid9KVxuXHRcdFx0XHRcdFx0LmFwcGVuZFRvKHRoaXMuJGRpdik7XG5cdCQoJzxzcGFuPicpLmFkZENsYXNzKFwiaWNvbiBmYSBmYS10aW1lcy1jaXJjbGVcIikuY3NzKCdmb250LXNpemUnLCAodGhpcy5sYXlvdXRfbnVtYmVycy53aW5kb3dfYmFyX2hlaWdodCAtIDYpICsgXCJweFwiKS5hcHBlbmRUbyh0aGlzLiRjbG9zZV9idG4pO1xuXHRcblx0dGhpcy4kY2xvc2VfYnRuLmNsaWNrKGNsb3NlX2NhbGxiYWNrIHx8IGZ1bmN0aW9uKCl7fSk7XG5cdFxuXHR0aGlzLiRjYW52YXNbMF0ud2lkdGggPSB3aWR0aDtcblx0dGhpcy4kY2FudmFzWzBdLmhlaWdodCA9IGhlaWdodDtcblx0dGhpcy4kY2FudmFzLmNzcyh7J3RvcCc6IHRoaXMubGF5b3V0X251bWJlcnMuY2FudmFzX3RvcCwgJ2xlZnQnOnRoaXMubGF5b3V0X251bWJlcnMuY2FudmFzX2xlZnR9KTtcblx0dGhpcy4kb3ZlcmxheV9jYW52YXNbMF0ud2lkdGggPSB3aWR0aDtcblx0dGhpcy4kb3ZlcmxheV9jYW52YXNbMF0uaGVpZ2h0ID0gd2lkdGg7XG5cdHRoaXMuJG92ZXJsYXlfY2FudmFzLmNzcyh7J3RvcCc6IHRoaXMubGF5b3V0X251bWJlcnMuY2FudmFzX3RvcCwgJ2xlZnQnOnRoaXMubGF5b3V0X251bWJlcnMuY2FudmFzX2xlZnQsICdvdXRsaW5lJzonc29saWQgMXB4ICM0NDQ0NDQnfSk7XG5cdFxuXHR0aGlzLmhvcml6b250YWxfem9vbSA9IG5ldyBPbmNvcHJpbnRab29tU2xpZGVyKHRoaXMuJGRpdiwgeydidG5fc2l6ZSc6IHRoaXMubGF5b3V0X251bWJlcnMuaG9yaXpvbnRhbF96b29tX2FyZWFfaGVpZ2h0IC0gcGFkZGluZyxcblx0XHRcdFx0XHRcdFx0XHQgICAgJ2hvcml6b250YWwnOiB0cnVlLFxuXHRcdFx0XHRcdFx0XHRcdCAgICAnd2lkdGgnOiB3aWR0aCxcblx0XHRcdFx0XHRcdFx0XHQgICAgJ2luaXRfdmFsJzogbW9kZWwuZ2V0SG9yelpvb20oKSxcblx0XHRcdFx0XHRcdFx0XHQgICAgJ2xlZnQnOiBwYWRkaW5nLFxuXHRcdFx0XHRcdFx0XHRcdCAgICAndG9wJzogdGhpcy5sYXlvdXRfbnVtYmVycy5jYW52YXNfdG9wICsgaGVpZ2h0ICsgcGFkZGluZyxcblx0XHRcdFx0XHRcdFx0XHQgICAgJ29uQ2hhbmdlJzogZnVuY3Rpb24odmFsKSB7IGhvcnpfem9vbV9jYWxsYmFjayh2YWwpOyB9fSk7XG5cdHRoaXMudmVydGljYWxfem9vbSA9IG5ldyBPbmNvcHJpbnRab29tU2xpZGVyKHRoaXMuJGRpdiwgeydidG5fc2l6ZSc6IHRoaXMubGF5b3V0X251bWJlcnMudmVydGljYWxfem9vbV9hcmVhX3dpZHRoIC0gcGFkZGluZyxcblx0XHRcdFx0XHRcdFx0XHQgICAgJ3ZlcnRpY2FsJzogdHJ1ZSxcblx0XHRcdFx0XHRcdFx0XHQgICAgJ2hlaWdodCc6IGhlaWdodCxcblx0XHRcdFx0XHRcdFx0XHQgICAgJ2luaXRfdmFsJzogbW9kZWwuZ2V0VmVydFpvb20oKSxcblx0XHRcdFx0XHRcdFx0XHQgICAgJ2xlZnQnOiB0aGlzLmxheW91dF9udW1iZXJzLmNhbnZhc19sZWZ0ICsgd2lkdGggKyBwYWRkaW5nLFxuXHRcdFx0XHRcdFx0XHRcdCAgICAndG9wJzogdGhpcy5sYXlvdXRfbnVtYmVycy53aW5kb3dfYmFyX2hlaWdodCArIHBhZGRpbmcsXG5cdFx0XHRcdFx0XHRcdFx0ICAgICdvbkNoYW5nZSc6IGZ1bmN0aW9uKHZhbCkgeyB2ZXJ0X3pvb21fY2FsbGJhY2sodmFsKTsgfX0pO1x0XHRcdFx0XHRcdFx0XG5cdFxuXHQoZnVuY3Rpb24gc2V0VXBab29tVG9GaXRCdXR0b24oKSB7XG5cdCAgICB2YXIgJGJ0biA9ICQoJzxkaXY+JykuY3NzKHsncG9zaXRpb24nOiAnYWJzb2x1dGUnLFxuXHRcdCdtaW4taGVpZ2h0Jzogc2VsZi5sYXlvdXRfbnVtYmVycy5ob3Jpem9udGFsX3pvb21fYXJlYV9oZWlnaHQgLSBwYWRkaW5nLFxuXHRcdCdtaW4td2lkdGgnOiBzZWxmLmxheW91dF9udW1iZXJzLnZlcnRpY2FsX3pvb21fYXJlYV93aWR0aCAtIHBhZGRpbmcsXG5cdFx0J2JhY2tncm91bmQtY29sb3InOiAnI2ZmZmZmZicsXG5cdFx0J291dGxpbmUnOiAnc29saWQgMXB4IGJsYWNrJyxcblx0XHQnbGVmdCc6IHNlbGYubGF5b3V0X251bWJlcnMuY2FudmFzX2xlZnQgKyB3aWR0aCArIHBhZGRpbmcsXG5cdFx0J3RvcCc6IHNlbGYubGF5b3V0X251bWJlcnMuY2FudmFzX3RvcCArIGhlaWdodCArIHBhZGRpbmcsXG5cdFx0J2N1cnNvcic6ICdwb2ludGVyJ30pXG5cdFx0ICAgIC5hcHBlbmRUbygkZGl2KTtcblx0ICAgICQoXCI8aW1nPlwiKS5hcHBlbmRUbygkYnRuKS5hdHRyKHtcInNyY1wiOiBcImltYWdlcy9maXRhbHRlcmVkY2FzZXMuc3ZnXCIsXG5cdFx0XCJwcmVzZXJ2ZWFzcGVjdHJhdGlvXCI6IFwibm9uZVwiLFxuXHRcdFwid2lkdGhcIjogcGFyc2VJbnQoJGJ0bi5jc3MoJ21pbi13aWR0aCcpLDEwKSAtIDQsXG5cdFx0XCJoZWlnaHRcIjogcGFyc2VJbnQoJGJ0bi5jc3MoJ21pbi1oZWlnaHQnKSwxMCkgLSA0fSkuY3NzKHsncG9zaXRpb24nOidhYnNvbHV0ZScsICd0b3AnOiAyLCAnbGVmdCc6IDJ9KTtcblx0ICAgICRidG4uaG92ZXIoZnVuY3Rpb24gKCkge1xuXHRcdCQodGhpcykuY3NzKHsnYmFja2dyb3VuZC1jb2xvcic6ICcjY2NjY2NjJ30pO1xuXHQgICAgfSwgZnVuY3Rpb24gKCkge1xuXHRcdCQodGhpcykuY3NzKHsnYmFja2dyb3VuZC1jb2xvcic6ICcjZmZmZmZmJ30pO1xuXHQgICAgfSk7XG5cdCAgICBcblx0ICAgIHpvb21fdG9fZml0X2NhbGxiYWNrID0gem9vbV90b19maXRfY2FsbGJhY2sgfHwgZnVuY3Rpb24oKSB7fTtcblx0ICAgICRidG4uY2xpY2soem9vbV90b19maXRfY2FsbGJhY2spO1xuXHR9KSgpO1xuXHRnZXRXZWJHTENvbnRleHRBbmRTZXRVcE1hdHJpY2VzQW5kU2hhZGVycyh0aGlzKTtcblx0dGhpcy5vdmVybGF5X2N0eCA9ICRvdmVybGF5X2NhbnZhc1swXS5nZXRDb250ZXh0KFwiMmRcIik7XG5cblx0dGhpcy5pbWcgPSBuZXcgSW1hZ2UoKTtcblx0dGhpcy5jdXJyZW50X3JlY3QgPSB7J3RvcCc6IDAsICdsZWZ0JzogMCwgJ3dpZHRoJzogMCwgJ2hlaWdodCc6IDAsICdjb2wnOjAsICdudW1fY29scyc6MH07XG5cblx0dmFyIHNlbGYgPSB0aGlzO1xuXHR0aGlzLmltZy5vbmxvYWQgPSBmdW5jdGlvbiAoKSB7XG5cdCAgICBzZWxmLmN0eC5kcmF3SW1hZ2UoaW1nLCAwLCAwKTtcblx0fTtcblxuXHQvLyBTZXQgdXAgZHJhZ2dpbmdcblx0dmFyIHJlc2l6ZV9oaXRfem9uZSA9IDU7XG5cdHZhciBtb3VzZUluUmVjdERyYWdab25lID0gZnVuY3Rpb24gKHgsIHkpIHtcblx0ICAgIHJldHVybiAoKHggPj0gc2VsZi5jdXJyZW50X3JlY3QubGVmdCArIHJlc2l6ZV9oaXRfem9uZSkgJiZcblx0XHQgICAgKHggPD0gc2VsZi5jdXJyZW50X3JlY3QubGVmdCArIHNlbGYuY3VycmVudF9yZWN0LndpZHRoIC0gcmVzaXplX2hpdF96b25lKSAmJlxuXHRcdCAgICAoeSA+PSBzZWxmLmN1cnJlbnRfcmVjdC50b3AgKyByZXNpemVfaGl0X3pvbmUpICYmXG5cdFx0ICAgICh5IDw9IHNlbGYuY3VycmVudF9yZWN0LnRvcCArIHNlbGYuY3VycmVudF9yZWN0LmhlaWdodCAtIHJlc2l6ZV9oaXRfem9uZSkpO1xuXHR9O1xuXHR2YXIgbW91c2VJbnNpZGVSZWN0SGl0Wm9uZSA9IGZ1bmN0aW9uKHgseSkge1xuXHQgICAgcmV0dXJuICh4ID49IHNlbGYuY3VycmVudF9yZWN0LmxlZnQgLSByZXNpemVfaGl0X3pvbmUpICYmIFxuXHRcdCAgICAoeCA8PSBzZWxmLmN1cnJlbnRfcmVjdC5sZWZ0ICsgc2VsZi5jdXJyZW50X3JlY3Qud2lkdGggKyByZXNpemVfaGl0X3pvbmUpICYmXG5cdFx0ICAgICh5ID49IHNlbGYuY3VycmVudF9yZWN0LnRvcCAtIHJlc2l6ZV9oaXRfem9uZSkgJiYgXG5cdFx0ICAgICh5IDw9IHNlbGYuY3VycmVudF9yZWN0LnRvcCArIHNlbGYuY3VycmVudF9yZWN0LmhlaWdodCArIHJlc2l6ZV9oaXRfem9uZSk7XG5cdH07XG5cdHZhciBtb3VzZUluUmlnaHRIb3J6UmVzaXplWm9uZSA9IGZ1bmN0aW9uICh4LHkpIHtcblx0ICAgIHJldHVybiAhbW91c2VJblRvcExlZnRSZXNpemVab25lKHgseSkgJiYgIW1vdXNlSW5Ub3BSaWdodFJlc2l6ZVpvbmUoeCx5KSAmJlxuXHRcdCAgICAhbW91c2VJbkJvdHRvbUxlZnRSZXNpemVab25lKHgseSkgJiYgIW1vdXNlSW5Cb3R0b21SaWdodFJlc2l6ZVpvbmUoeCx5KSAmJlxuXHRcdCAgICBtb3VzZUluc2lkZVJlY3RIaXRab25lKHgseSkgJiZcblx0XHQgICAgKE1hdGguYWJzKHggLSAoc2VsZi5jdXJyZW50X3JlY3QubGVmdCArIHNlbGYuY3VycmVudF9yZWN0LndpZHRoKSkgPCByZXNpemVfaGl0X3pvbmUpO1xuXHR9O1xuXHR2YXIgbW91c2VJbkxlZnRIb3J6UmVzaXplWm9uZSA9IGZ1bmN0aW9uICh4LHkpIHtcblx0ICAgIHJldHVybiAhbW91c2VJblRvcExlZnRSZXNpemVab25lKHgseSkgJiYgIW1vdXNlSW5Ub3BSaWdodFJlc2l6ZVpvbmUoeCx5KSAmJlxuXHRcdCAgICAhbW91c2VJbkJvdHRvbUxlZnRSZXNpemVab25lKHgseSkgJiYgIW1vdXNlSW5Cb3R0b21SaWdodFJlc2l6ZVpvbmUoeCx5KSAmJlxuXHRcdCAgICBtb3VzZUluc2lkZVJlY3RIaXRab25lKHgseSkgJiZcblx0XHQgICAgKE1hdGguYWJzKHggLSBzZWxmLmN1cnJlbnRfcmVjdC5sZWZ0KSA8IHJlc2l6ZV9oaXRfem9uZSk7XG5cdH07XG5cdHZhciBtb3VzZUluVG9wVmVydFJlc2l6ZVpvbmUgPSBmdW5jdGlvbiAoeCx5KSB7XG5cdCAgICByZXR1cm4gIW1vdXNlSW5Ub3BMZWZ0UmVzaXplWm9uZSh4LHkpICYmICFtb3VzZUluVG9wUmlnaHRSZXNpemVab25lKHgseSkgJiZcblx0XHQgICAgIW1vdXNlSW5Cb3R0b21MZWZ0UmVzaXplWm9uZSh4LHkpICYmICFtb3VzZUluQm90dG9tUmlnaHRSZXNpemVab25lKHgseSkgJiZcblx0XHQgICAgbW91c2VJbnNpZGVSZWN0SGl0Wm9uZSh4LHkpICYmXG5cdFx0ICAgIChNYXRoLmFicyh5IC0gc2VsZi5jdXJyZW50X3JlY3QudG9wKSA8IHJlc2l6ZV9oaXRfem9uZSk7XG5cdH07XG5cdHZhciBtb3VzZUluQm90dG9tVmVydFJlc2l6ZVpvbmUgPSBmdW5jdGlvbiAoeCwgeSkge1xuXHQgICAgcmV0dXJuICFtb3VzZUluVG9wTGVmdFJlc2l6ZVpvbmUoeCwgeSkgJiYgIW1vdXNlSW5Ub3BSaWdodFJlc2l6ZVpvbmUoeCwgeSkgJiZcblx0XHQgICAgIW1vdXNlSW5Cb3R0b21MZWZ0UmVzaXplWm9uZSh4LCB5KSAmJiAhbW91c2VJbkJvdHRvbVJpZ2h0UmVzaXplWm9uZSh4LCB5KSAmJlxuXHRcdCAgICBtb3VzZUluc2lkZVJlY3RIaXRab25lKHgseSkgJiZcblx0XHQgICAgKE1hdGguYWJzKHkgLSAoc2VsZi5jdXJyZW50X3JlY3QudG9wICsgc2VsZi5jdXJyZW50X3JlY3QuaGVpZ2h0KSkgPCByZXNpemVfaGl0X3pvbmUpO1xuXHR9O1xuXHR2YXIgbW91c2VJblRvcExlZnRSZXNpemVab25lID0gZnVuY3Rpb24oeCx5KSB7XG5cdCAgICByZXR1cm4gKE1hdGguYWJzKHkgLSBzZWxmLmN1cnJlbnRfcmVjdC50b3ApIDwgcmVzaXplX2hpdF96b25lKSAmJlxuXHRcdCAgICAoTWF0aC5hYnMoeCAtIHNlbGYuY3VycmVudF9yZWN0LmxlZnQpIDwgcmVzaXplX2hpdF96b25lKTtcblx0fTtcblx0dmFyIG1vdXNlSW5Cb3R0b21MZWZ0UmVzaXplWm9uZSA9IGZ1bmN0aW9uKHgseSkge1xuXHQgICAgcmV0dXJuIChNYXRoLmFicyh5IC0gKHNlbGYuY3VycmVudF9yZWN0LnRvcCArIHNlbGYuY3VycmVudF9yZWN0LmhlaWdodCkpIDwgcmVzaXplX2hpdF96b25lKSAmJlxuXHRcdCAgICAoTWF0aC5hYnMoeCAtIHNlbGYuY3VycmVudF9yZWN0LmxlZnQpIDwgcmVzaXplX2hpdF96b25lKTtcblx0fTtcblx0dmFyIG1vdXNlSW5Ub3BSaWdodFJlc2l6ZVpvbmUgPSBmdW5jdGlvbih4LHkpIHtcblx0ICAgIHJldHVybiAoTWF0aC5hYnMoeSAtIHNlbGYuY3VycmVudF9yZWN0LnRvcCkgPCByZXNpemVfaGl0X3pvbmUpICYmXG5cdFx0ICAgIChNYXRoLmFicyh4IC0gKHNlbGYuY3VycmVudF9yZWN0LmxlZnQgKyBzZWxmLmN1cnJlbnRfcmVjdC53aWR0aCkpIDwgcmVzaXplX2hpdF96b25lKTtcblx0fTtcblx0dmFyIG1vdXNlSW5Cb3R0b21SaWdodFJlc2l6ZVpvbmUgPSBmdW5jdGlvbih4LHkpIHtcblx0ICAgIHJldHVybiAoTWF0aC5hYnMoeSAtIChzZWxmLmN1cnJlbnRfcmVjdC50b3AgKyBzZWxmLmN1cnJlbnRfcmVjdC5oZWlnaHQpKSA8IHJlc2l6ZV9oaXRfem9uZSkgJiZcblx0XHQgICAgKE1hdGguYWJzKHggLSAoc2VsZi5jdXJyZW50X3JlY3QubGVmdCArIHNlbGYuY3VycmVudF9yZWN0LndpZHRoKSkgPCByZXNpemVfaGl0X3pvbmUpO1xuXHR9O1xuXHRcblx0dGhpcy5yZXNpemVfaG92ZXIgPSBmYWxzZTtcblx0dmFyIHVwZGF0ZVJlY3RSZXNpemVIb3ZlckxvY2F0aW9uID0gZnVuY3Rpb24oeCx5KSB7XG5cdCAgICBpZiAodHlwZW9mIHggPT09IFwidW5kZWZpbmVkXCIpIHtcblx0XHRzZWxmLnJlc2l6ZV9ob3ZlciA9IGZhbHNlO1xuXHQgICAgfSBlbHNlIHtcblx0XHRpZiAobW91c2VJblJpZ2h0SG9yelJlc2l6ZVpvbmUoeCwgeSkpIHtcblx0XHQgICAgc2VsZi5yZXNpemVfaG92ZXIgPSBcInJcIjtcblx0XHR9IGVsc2UgaWYgKG1vdXNlSW5MZWZ0SG9yelJlc2l6ZVpvbmUoeCwgeSkpIHtcblx0XHQgICAgc2VsZi5yZXNpemVfaG92ZXIgPSBcImxcIjtcblx0XHR9IGVsc2UgaWYgKG1vdXNlSW5Ub3BWZXJ0UmVzaXplWm9uZSh4LCB5KSkge1xuXHRcdCAgICBzZWxmLnJlc2l6ZV9ob3ZlciA9IFwidFwiO1xuXHRcdH0gZWxzZSBpZiAobW91c2VJbkJvdHRvbVZlcnRSZXNpemVab25lKHgsIHkpKSB7XG5cdFx0ICAgIHNlbGYucmVzaXplX2hvdmVyID0gXCJiXCI7XG5cdFx0fSBlbHNlIGlmIChtb3VzZUluVG9wTGVmdFJlc2l6ZVpvbmUoeCwgeSkpIHtcblx0XHQgICAgc2VsZi5yZXNpemVfaG92ZXIgPSBcInRsXCI7XG5cdFx0fSBlbHNlIGlmIChtb3VzZUluQm90dG9tUmlnaHRSZXNpemVab25lKHgsIHkpKSB7XG5cdFx0ICAgIHNlbGYucmVzaXplX2hvdmVyID0gXCJiclwiO1xuXHRcdH0gZWxzZSBpZiAobW91c2VJbkJvdHRvbUxlZnRSZXNpemVab25lKHgsIHkpKSB7XG5cdFx0ICAgIHNlbGYucmVzaXplX2hvdmVyID0gXCJibFwiO1xuXHRcdH0gZWxzZSBpZiAobW91c2VJblRvcFJpZ2h0UmVzaXplWm9uZSh4LCB5KSkge1xuXHRcdCAgICBzZWxmLnJlc2l6ZV9ob3ZlciA9IFwidHJcIjtcblx0XHR9IGVsc2Uge1xuXHRcdCAgICBzZWxmLnJlc2l6ZV9ob3ZlciA9IGZhbHNlO1xuXHRcdH1cblx0ICAgIH1cblx0fTtcblx0dmFyIHVwZGF0ZUNTU0N1cnNvciA9IGZ1bmN0aW9uKHgsIHkpIHtcblx0ICAgIHZhciBjdXJzb3JfdmFsO1xuXHQgICAgaWYgKHR5cGVvZiB4ID09PSBcInVuZGVmaW5lZFwiKSB7XG5cdFx0Y3Vyc29yX3ZhbCA9ICdhdXRvJztcblx0ICAgIH0gZWxzZSB7XG5cdFx0aWYgKG1vdXNlSW5SZWN0RHJhZ1pvbmUoeCwgeSkpIHtcblx0XHQgICAgY3Vyc29yX3ZhbCA9ICdtb3ZlJztcblx0XHR9IGVsc2UgaWYgKG1vdXNlSW5SaWdodEhvcnpSZXNpemVab25lKHgsIHkpIHx8IG1vdXNlSW5MZWZ0SG9yelJlc2l6ZVpvbmUoeCwgeSkpIHtcblx0XHQgICAgY3Vyc29yX3ZhbCA9ICdldy1yZXNpemUnO1xuXHRcdH0gZWxzZSBpZiAobW91c2VJblRvcFZlcnRSZXNpemVab25lKHgsIHkpIHx8IG1vdXNlSW5Cb3R0b21WZXJ0UmVzaXplWm9uZSh4LCB5KSkge1xuXHRcdCAgICBjdXJzb3JfdmFsID0gJ25zLXJlc2l6ZSc7XG5cdFx0fSBlbHNlIGlmIChtb3VzZUluVG9wTGVmdFJlc2l6ZVpvbmUoeCwgeSkgfHwgbW91c2VJbkJvdHRvbVJpZ2h0UmVzaXplWm9uZSh4LCB5KSkge1xuXHRcdCAgICBjdXJzb3JfdmFsID0gJ253c2UtcmVzaXplJztcblx0XHR9IGVsc2UgaWYgKG1vdXNlSW5Cb3R0b21MZWZ0UmVzaXplWm9uZSh4LCB5KSB8fCBtb3VzZUluVG9wUmlnaHRSZXNpemVab25lKHgsIHkpKSB7XG5cdFx0ICAgIGN1cnNvcl92YWwgPSAnbmVzdy1yZXNpemUnO1xuXHRcdH0gZWxzZSB7XG5cdFx0ICAgIGN1cnNvcl92YWwgPSAnYXV0byc7XG5cdFx0fVxuXHQgICAgfVxuXHQgICAgJGRpdi5jc3MoJ2N1cnNvcicsIGN1cnNvcl92YWwpO1xuXHR9O1xuXHR2YXIgZ2V0Q2FudmFzTW91c2UgPSBmdW5jdGlvbih2aWV3LCBkaXZfbW91c2VfeCwgZGl2X21vdXNlX3kpIHtcblx0ICAgIHZhciBjYW52X3RvcCA9IHBhcnNlSW50KHZpZXcuJGNhbnZhc1swXS5zdHlsZS50b3AsIDEwKTtcblx0ICAgIHZhciBjYW52X2xlZnQgPSBwYXJzZUludCh2aWV3LiRjYW52YXNbMF0uc3R5bGUubGVmdCwgMTApO1xuXHQgICAgdmFyIGNhbnZfd2lkdGggPSBwYXJzZUludCh2aWV3LiRjYW52YXNbMF0ud2lkdGgsIDEwKTtcblx0ICAgIHZhciBjYW52X2hlaWdodCA9IHBhcnNlSW50KHZpZXcuJGNhbnZhc1swXS5oZWlnaHQsIDEwKTtcblx0ICAgIFxuXHQgICAgdmFyIG1vdXNlX3ggPSBkaXZfbW91c2VfeCAtIGNhbnZfbGVmdDtcblx0ICAgIHZhciBtb3VzZV95ID0gZGl2X21vdXNlX3kgLSBjYW52X3RvcDtcblx0ICAgIFxuXHQgICAgdmFyIG91dHNpZGUgPSBtb3VzZV94IDwgMCB8fCBtb3VzZV94ID49IGNhbnZfd2lkdGggfHwgbW91c2VfeSA8IDAgfHwgbW91c2VfeSA+PSBjYW52X2hlaWdodDtcblx0ICAgIFxuXHQgICAgcmV0dXJuIHsnbW91c2VfeCc6IG1vdXNlX3gsXG5cdFx0ICAgICdtb3VzZV95JzogbW91c2VfeSxcblx0XHQgICAgJ291dHNpZGUnOiBvdXRzaWRlfTtcblx0fTtcblx0dmFyIGRyYWdnaW5nID0gZmFsc2U7XG5cdHZhciBkcmFnX3R5cGUgPSBmYWxzZTtcblx0dmFyIGRyYWdfc3RhcnRfY29sID0gLTE7XG5cdHZhciBkcmFnX3N0YXJ0X3ZlcnRfc2Nyb2xsID0gLTE7XG5cdHZhciBkcmFnX3N0YXJ0X3ggPSAtMTtcblx0dmFyIGRyYWdfc3RhcnRfeSA9IC0xO1xuXHR2YXIgZHJhZ19zdGFydF92ZXJ0X3pvb20gPSAtMTtcblx0dmFyIHlfcmF0aW8gPSAtMTtcblx0JChkb2N1bWVudCkub24oXCJtb3VzZWRvd25cIiwgZnVuY3Rpb24gKGV2dCkge1xuXHQgICAgdmFyIG9mZnNldCA9IHNlbGYuJGRpdi5vZmZzZXQoKTtcblx0ICAgIHZhciBvdmVybGF5X21vdXNlX3ggPSBldnQucGFnZVggLSBvZmZzZXQubGVmdDtcblx0ICAgIHZhciBvdmVybGF5X21vdXNlX3kgPSBldnQucGFnZVkgLSBvZmZzZXQudG9wO1xuXHQgICAgdmFyIG1vdXNlID0gZ2V0Q2FudmFzTW91c2Uoc2VsZiwgb3ZlcmxheV9tb3VzZV94LCBvdmVybGF5X21vdXNlX3kpO1xuXHQgICAgXG5cdCAgICBpZiAoIW1vdXNlLm91dHNpZGUpIHtcblx0XHR2YXIgbW91c2VfeCA9IG1vdXNlLm1vdXNlX3g7XG5cdFx0dmFyIG1vdXNlX3kgPSBtb3VzZS5tb3VzZV95O1xuXHRcdGRyYWdnaW5nID0gZmFsc2U7XG5cdFx0ZHJhZ190eXBlID0gZmFsc2U7XG5cblxuXHRcdHlfcmF0aW8gPSBtb2RlbC5nZXRPbmNvcHJpbnRIZWlnaHQoKSAvIHBhcnNlSW50KHNlbGYuJGNhbnZhc1swXS5oZWlnaHQsIDEwKTtcblx0XHRpZiAobW91c2VJblJlY3REcmFnWm9uZShtb3VzZV94LCBtb3VzZV95KSkge1xuXHRcdCAgICBkcmFnX3R5cGUgPSBcIm1vdmVcIjtcblx0XHR9IGVsc2UgaWYgKG1vdXNlSW5SaWdodEhvcnpSZXNpemVab25lKG1vdXNlX3gsIG1vdXNlX3kpKSB7XG5cdFx0ICAgIGRyYWdfdHlwZSA9IFwicmVzaXplX3JcIjtcblx0XHR9IGVsc2UgaWYgKG1vdXNlSW5MZWZ0SG9yelJlc2l6ZVpvbmUobW91c2VfeCwgbW91c2VfeSkpIHtcblx0XHQgICAgZHJhZ190eXBlID0gXCJyZXNpemVfbFwiO1xuXHRcdH0gZWxzZSBpZiAobW91c2VJblRvcFZlcnRSZXNpemVab25lKG1vdXNlX3gsIG1vdXNlX3kpKSB7XG5cdFx0ICAgIGRyYWdfdHlwZSA9IFwicmVzaXplX3RcIjtcblx0XHR9IGVsc2UgaWYgKG1vdXNlSW5Cb3R0b21WZXJ0UmVzaXplWm9uZShtb3VzZV94LCBtb3VzZV95KSkge1xuXHRcdCAgICBkcmFnX3R5cGUgPSBcInJlc2l6ZV9iXCI7XG5cdFx0fSBlbHNlIGlmIChtb3VzZUluVG9wUmlnaHRSZXNpemVab25lKG1vdXNlX3gsIG1vdXNlX3kpKSB7XG5cdFx0ICAgIGRyYWdfdHlwZSA9IFwicmVzaXplX3RyXCI7XG5cdFx0fSBlbHNlIGlmIChtb3VzZUluQm90dG9tUmlnaHRSZXNpemVab25lKG1vdXNlX3gsIG1vdXNlX3kpKSB7XG5cdFx0ICAgIGRyYWdfdHlwZSA9IFwicmVzaXplX2JyXCI7XG5cdFx0fSBlbHNlIGlmIChtb3VzZUluVG9wTGVmdFJlc2l6ZVpvbmUobW91c2VfeCwgbW91c2VfeSkpIHtcblx0XHQgICAgZHJhZ190eXBlID0gXCJyZXNpemVfdGxcIjtcblx0XHR9IGVsc2UgaWYgKG1vdXNlSW5Cb3R0b21MZWZ0UmVzaXplWm9uZShtb3VzZV94LCBtb3VzZV95KSkge1xuXHRcdCAgICBkcmFnX3R5cGUgPSBcInJlc2l6ZV9ibFwiO1xuXHRcdH1cblx0XHRpZiAoZHJhZ190eXBlICE9PSBmYWxzZSkge1xuXHRcdCAgICBkcmFnZ2luZyA9IHRydWU7XG5cdFx0ICAgIGRyYWdfc3RhcnRfeCA9IG1vdXNlX3g7XG5cdFx0ICAgIGRyYWdfc3RhcnRfeSA9IG1vdXNlX3k7XG5cdFx0ICAgIGRyYWdfc3RhcnRfY29sID0gTWF0aC5mbG9vcihtb2RlbC5nZXRIb3J6U2Nyb2xsKCkgLyAobW9kZWwuZ2V0Q2VsbFdpZHRoKCkgKyBtb2RlbC5nZXRDZWxsUGFkZGluZygpKSk7XG5cdFx0ICAgIGRyYWdfc3RhcnRfdmVydF9zY3JvbGwgPSBtb2RlbC5nZXRWZXJ0U2Nyb2xsKCk7XG5cdFx0ICAgIGRyYWdfc3RhcnRfdmVydF96b29tID0gbW9kZWwuZ2V0VmVydFpvb20oKTtcblx0XHQgICAgZHJhZ19zdGFydF9yZWN0ID0gc2VsZi5jdXJyZW50X3JlY3Q7XG5cdFx0fVxuXHQgICAgfVxuXHR9KTtcblx0JChkb2N1bWVudCkub24oXCJtb3VzZW1vdmVcIiwgZnVuY3Rpb24gKGV2dCkge1xuXHQgICAgdmFyIG9mZnNldCA9IHNlbGYuJGRpdi5vZmZzZXQoKTtcblx0ICAgIHZhciBvdmVybGF5X21vdXNlX3ggPSBldnQucGFnZVggLSBvZmZzZXQubGVmdDtcblx0ICAgIHZhciBvdmVybGF5X21vdXNlX3kgPSBldnQucGFnZVkgLSBvZmZzZXQudG9wO1xuXHQgICAgdmFyIG1vdXNlID0gZ2V0Q2FudmFzTW91c2Uoc2VsZiwgb3ZlcmxheV9tb3VzZV94LCBvdmVybGF5X21vdXNlX3kpO1xuXHQgICAgdmFyIG1vdXNlX3ggPSBtb3VzZS5tb3VzZV94O1xuXHQgICAgdmFyIG1vdXNlX3kgPSBtb3VzZS5tb3VzZV95O1xuXHQgICAgdmFyIHpvb20gPSBnZXRab29tKHNlbGYsIG1vZGVsKTtcblx0ICAgIHZhciBjZWxsX3dpZHRoID0gbW9kZWwuZ2V0Q2VsbFdpZHRoKHRydWUpKnpvb20ueDtcblx0ICAgIGlmIChkcmFnZ2luZykge1xuXHRcdGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdHZhciBkZWx0YV9jb2wgPSBNYXRoLmZsb29yKG1vdXNlX3ggLyBjZWxsX3dpZHRoKSAtIE1hdGguZmxvb3IoZHJhZ19zdGFydF94IC8gY2VsbF93aWR0aCk7XG5cdFx0dmFyIGRlbHRhX3kgPSBtb3VzZV95IC0gZHJhZ19zdGFydF95O1xuXHRcdGlmIChkcmFnX3R5cGUgPT09IFwibW92ZVwiKSB7XG5cdFx0ICAgIHZhciBkZWx0YV95X3Njcm9sbCA9IGRlbHRhX3kgKiB5X3JhdGlvO1xuXHRcdCAgICBkcmFnX2NhbGxiYWNrKChkcmFnX3N0YXJ0X2NvbCArIGRlbHRhX2NvbCkqKG1vZGVsLmdldENlbGxXaWR0aCgpICsgbW9kZWwuZ2V0Q2VsbFBhZGRpbmcoKSksIGRyYWdfc3RhcnRfdmVydF9zY3JvbGwgKyBkZWx0YV95X3Njcm9sbCk7XG5cdFx0fSBlbHNlIHtcblx0XHQgICAgdmFyIHJlbmRlcl9yZWN0O1xuXHRcdCAgICB2YXIgem9vbSA9IGdldFpvb20oc2VsZiwgbW9kZWwpO1xuXHRcdCAgICB2YXIgbWF4X251bV9jb2xzID0gbW9kZWwuZ2V0SWRPcmRlcigpLmxlbmd0aDtcblx0XHQgICAgdmFyIG1pbl9udW1fY29scyA9IE1hdGguY2VpbChjZWxsX3ZpZXcuZ2V0V2lkdGgoKSAvIChtb2RlbC5nZXRDZWxsV2lkdGgodHJ1ZSkgKyBtb2RlbC5nZXRDZWxsUGFkZGluZyh0cnVlLCB0cnVlKSkpO1xuXHRcdCAgICB2YXIgbWF4X2hlaWdodCA9IG1vZGVsLmdldE9uY29wcmludEhlaWdodCh0cnVlKSAqIHpvb20ueTtcblx0XHQgICAgdmFyIG1pbl9oZWlnaHQgPSBtb2RlbC5nZXRDZWxsVmlld0hlaWdodCgpICogem9vbS55O1xuXHRcdCAgICB2YXIgZHJhZ19zdGFydF9yaWdodF9jb2wgPSBkcmFnX3N0YXJ0X3JlY3QuY29sICsgZHJhZ19zdGFydF9yZWN0Lm51bV9jb2xzO1xuXHRcdCAgICB2YXIgZHJhZ19zdGFydF9ib3R0b20gPSBkcmFnX3N0YXJ0X3JlY3QudG9wICsgZHJhZ19zdGFydF9yZWN0LmhlaWdodDtcblx0XHQgICAgaWYgKGRyYWdfdHlwZSA9PT0gXCJyZXNpemVfclwiKSB7XG5cdFx0XHQvLyBXaWR0aCBtdXN0IGJlIHZhbGlkXG5cdFx0XHRkZWx0YV9jb2wgPSBjbGFtcChkZWx0YV9jb2wsIFxuXHRcdFx0XHRcdG1pbl9udW1fY29scyAtIGRyYWdfc3RhcnRfcmVjdC5udW1fY29scyxcblx0XHRcdFx0XHRtYXhfbnVtX2NvbHMgLSBkcmFnX3N0YXJ0X3JlY3QubnVtX2NvbHMpO1xuXHRcdFx0Ly8gUmlnaHQgbXVzdCBiZSB2YWxpZFxuXHRcdFx0ZGVsdGFfY29sID0gTWF0aC5taW4oZGVsdGFfY29sLCBtYXhfbnVtX2NvbHMgLSBkcmFnX3N0YXJ0X3JpZ2h0X2NvbCk7XG5cdFx0XHRyZW5kZXJfcmVjdCA9IHtcblx0XHRcdCAgICAndG9wJzogZHJhZ19zdGFydF9yZWN0LnRvcCxcblx0XHRcdCAgICAnY29sJzogZHJhZ19zdGFydF9yZWN0LmNvbCxcblx0XHRcdCAgICAnbnVtX2NvbHMnOiBkcmFnX3N0YXJ0X3JlY3QubnVtX2NvbHMgKyBkZWx0YV9jb2wsXG5cdFx0XHQgICAgJ2hlaWdodCc6IGRyYWdfc3RhcnRfcmVjdC5oZWlnaHRcblx0XHRcdH07XG5cdFx0ICAgIH0gZWxzZSBpZiAoZHJhZ190eXBlID09PSBcInJlc2l6ZV9sXCIpIHtcblx0XHRcdC8vIFdpZHRoIG11c3QgYmUgdmFsaWRcblx0XHRcdGRlbHRhX2NvbCA9IGNsYW1wKGRlbHRhX2NvbCxcblx0XHRcdFx0XHRkcmFnX3N0YXJ0X3JlY3QubnVtX2NvbHMgLSBtYXhfbnVtX2NvbHMsXG5cdFx0XHRcdFx0ZHJhZ19zdGFydF9yZWN0Lm51bV9jb2xzIC0gbWluX251bV9jb2xzKTtcblx0XHRcdC8vIExlZnQgbXVzdCBiZSB2YWxpZFxuXHRcdFx0ZGVsdGFfY29sID0gTWF0aC5tYXgoZGVsdGFfY29sLCAtZHJhZ19zdGFydF9yZWN0LmNvbCk7XG5cdFx0XHRyZW5kZXJfcmVjdCA9IHtcblx0XHRcdCAgICAndG9wJzogZHJhZ19zdGFydF9yZWN0LnRvcCxcblx0XHRcdCAgICAnY29sJzogZHJhZ19zdGFydF9yZWN0LmNvbCArIGRlbHRhX2NvbCxcblx0XHRcdCAgICAnbnVtX2NvbHMnOiBkcmFnX3N0YXJ0X3JlY3QubnVtX2NvbHMgLSBkZWx0YV9jb2wsXG5cdFx0XHQgICAgJ2hlaWdodCc6IGRyYWdfc3RhcnRfcmVjdC5oZWlnaHRcblx0XHRcdH07XG5cdFx0ICAgIH0gZWxzZSBpZiAoZHJhZ190eXBlID09PSBcInJlc2l6ZV90XCIpIHtcblx0XHRcdC8vIEhlaWdodCBtdXN0IGJlIHZhbGlkXG5cdFx0XHRkZWx0YV95ID0gY2xhbXAoZGVsdGFfeSxcblx0XHRcdFx0XHRkcmFnX3N0YXJ0X3JlY3QuaGVpZ2h0IC0gbWF4X2hlaWdodCxcblx0XHRcdFx0XHRkcmFnX3N0YXJ0X3JlY3QuaGVpZ2h0IC0gbWluX2hlaWdodCk7XG5cdFx0XHQvLyBUb3AgbXVzdCBiZSB2YWxpZFxuXHRcdFx0ZGVsdGFfeSA9IE1hdGgubWF4KGRlbHRhX3ksIC1kcmFnX3N0YXJ0X3JlY3QudG9wKTtcblx0XHRcdHJlbmRlcl9yZWN0ID0ge1xuXHRcdFx0ICAgICd0b3AnOiBkcmFnX3N0YXJ0X3JlY3QudG9wICsgZGVsdGFfeSxcblx0XHRcdCAgICAnY29sJzogZHJhZ19zdGFydF9yZWN0LmNvbCxcblx0XHRcdCAgICAnbnVtX2NvbHMnOiBkcmFnX3N0YXJ0X3JlY3QubnVtX2NvbHMsXG5cdFx0XHQgICAgJ2hlaWdodCc6IGRyYWdfc3RhcnRfcmVjdC5oZWlnaHQgLSBkZWx0YV95XG5cdFx0XHR9O1xuXHRcdCAgICB9IGVsc2UgaWYgKGRyYWdfdHlwZSA9PT0gXCJyZXNpemVfYlwiKSB7XG5cdFx0XHQvLyBIZWlnaHQgbXVzdCBiZSB2YWxpZFxuXHRcdFx0ZGVsdGFfeSA9IGNsYW1wKGRlbHRhX3ksXG5cdFx0XHRcdFx0bWluX2hlaWdodCAtIGRyYWdfc3RhcnRfcmVjdC5oZWlnaHQsXG5cdFx0XHRcdFx0bWF4X2hlaWdodCAtIGRyYWdfc3RhcnRfcmVjdC5oZWlnaHQpO1xuXHRcdFx0Ly8gQm90dG9tIG11c3QgYmUgdmFsaWRcblx0XHRcdGRlbHRhX3kgPSBNYXRoLm1pbihkZWx0YV95LCBtYXhfaGVpZ2h0IC0gZHJhZ19zdGFydF9ib3R0b20pO1xuXHRcdFx0cmVuZGVyX3JlY3QgPSB7XG5cdFx0XHQgICAgJ3RvcCc6IGRyYWdfc3RhcnRfcmVjdC50b3AsXG5cdFx0XHQgICAgJ2NvbCc6IGRyYWdfc3RhcnRfcmVjdC5jb2wsXG5cdFx0XHQgICAgJ251bV9jb2xzJzogZHJhZ19zdGFydF9yZWN0Lm51bV9jb2xzLFxuXHRcdFx0ICAgICdoZWlnaHQnOiBkcmFnX3N0YXJ0X3JlY3QuaGVpZ2h0ICsgZGVsdGFfeVxuXHRcdFx0fTtcblx0XHQgICAgfSBlbHNlIGlmIChkcmFnX3R5cGUgPT09IFwicmVzaXplX3RyXCIpIHtcblx0XHRcdC8vIFdpZHRoIG11c3QgYmUgdmFsaWRcblx0XHRcdGRlbHRhX2NvbCA9IGNsYW1wKGRlbHRhX2NvbCwgXG5cdFx0XHRcdFx0bWluX251bV9jb2xzIC0gZHJhZ19zdGFydF9yZWN0Lm51bV9jb2xzLFxuXHRcdFx0XHRcdG1heF9udW1fY29scyAtIGRyYWdfc3RhcnRfcmVjdC5udW1fY29scyk7XG5cdFx0XHQvLyBSaWdodCBtdXN0IGJlIHZhbGlkXG5cdFx0XHRkZWx0YV9jb2wgPSBNYXRoLm1pbihkZWx0YV9jb2wsIG1heF9udW1fY29scyAtIGRyYWdfc3RhcnRfcmlnaHRfY29sKTtcblx0XHRcdC8vIEhlaWdodCBtdXN0IGJlIHZhbGlkXG5cdFx0XHRkZWx0YV95ID0gY2xhbXAoZGVsdGFfeSxcblx0XHRcdFx0XHRkcmFnX3N0YXJ0X3JlY3QuaGVpZ2h0IC0gbWF4X2hlaWdodCxcblx0XHRcdFx0XHRkcmFnX3N0YXJ0X3JlY3QuaGVpZ2h0IC0gbWluX2hlaWdodCk7XG5cdFx0XHQvLyBUb3AgbXVzdCBiZSB2YWxpZFxuXHRcdFx0ZGVsdGFfeSA9IE1hdGgubWF4KGRlbHRhX3ksIC1kcmFnX3N0YXJ0X3JlY3QudG9wKTtcblx0XHRcdHJlbmRlcl9yZWN0ID0ge1xuXHRcdFx0ICAgICd0b3AnOiBkcmFnX3N0YXJ0X3JlY3QudG9wICsgZGVsdGFfeSxcblx0XHRcdCAgICAnY29sJzogZHJhZ19zdGFydF9yZWN0LmNvbCxcblx0XHRcdCAgICAnbnVtX2NvbHMnOiBkcmFnX3N0YXJ0X3JlY3QubnVtX2NvbHMgKyBkZWx0YV9jb2wsXG5cdFx0XHQgICAgJ2hlaWdodCc6IGRyYWdfc3RhcnRfcmVjdC5oZWlnaHQgLSBkZWx0YV95XG5cdFx0XHR9O1xuXHRcdCAgICB9IGVsc2UgaWYgKGRyYWdfdHlwZSA9PT0gXCJyZXNpemVfdGxcIikge1xuXHRcdFx0Ly8gV2lkdGggbXVzdCBiZSB2YWxpZFxuXHRcdFx0ZGVsdGFfY29sID0gY2xhbXAoZGVsdGFfY29sLFxuXHRcdFx0XHRcdGRyYWdfc3RhcnRfcmVjdC5udW1fY29scyAtIG1heF9udW1fY29scyxcblx0XHRcdFx0XHRkcmFnX3N0YXJ0X3JlY3QubnVtX2NvbHMgLSBtaW5fbnVtX2NvbHMpO1xuXHRcdFx0Ly8gTGVmdCBtdXN0IGJlIHZhbGlkXG5cdFx0XHRkZWx0YV9jb2wgPSBNYXRoLm1heChkZWx0YV9jb2wsIC1kcmFnX3N0YXJ0X3JlY3QuY29sKTtcblx0XHRcdC8vIEhlaWdodCBtdXN0IGJlIHZhbGlkXG5cdFx0XHRkZWx0YV95ID0gY2xhbXAoZGVsdGFfeSxcblx0XHRcdFx0XHRkcmFnX3N0YXJ0X3JlY3QuaGVpZ2h0IC0gbWF4X2hlaWdodCxcblx0XHRcdFx0XHRkcmFnX3N0YXJ0X3JlY3QuaGVpZ2h0IC0gbWluX2hlaWdodCk7XG5cdFx0XHQvLyBUb3AgbXVzdCBiZSB2YWxpZFxuXHRcdFx0ZGVsdGFfeSA9IE1hdGgubWF4KGRlbHRhX3ksIC1kcmFnX3N0YXJ0X3JlY3QudG9wKTtcblx0XHRcdHJlbmRlcl9yZWN0ID0ge1xuXHRcdFx0ICAgICd0b3AnOiBkcmFnX3N0YXJ0X3JlY3QudG9wICsgZGVsdGFfeSxcblx0XHRcdCAgICAnY29sJzogZHJhZ19zdGFydF9yZWN0LmNvbCArIGRlbHRhX2NvbCxcblx0XHRcdCAgICAnbnVtX2NvbHMnOiBkcmFnX3N0YXJ0X3JlY3QubnVtX2NvbHMgLSBkZWx0YV9jb2wsXG5cdFx0XHQgICAgJ2hlaWdodCc6IGRyYWdfc3RhcnRfcmVjdC5oZWlnaHQgLSBkZWx0YV95XG5cdFx0XHR9O1xuXHRcdCAgICB9IGVsc2UgaWYgKGRyYWdfdHlwZSA9PT0gXCJyZXNpemVfYnJcIikge1xuXHRcdFx0Ly8gSGVpZ2h0IG11c3QgYmUgdmFsaWRcblx0XHRcdGRlbHRhX3kgPSBjbGFtcChkZWx0YV95LFxuXHRcdFx0XHRcdG1pbl9oZWlnaHQgLSBkcmFnX3N0YXJ0X3JlY3QuaGVpZ2h0LFxuXHRcdFx0XHRcdG1heF9oZWlnaHQgLSBkcmFnX3N0YXJ0X3JlY3QuaGVpZ2h0KTtcblx0XHRcdC8vIEJvdHRvbSBtdXN0IGJlIHZhbGlkXG5cdFx0XHRkZWx0YV95ID0gTWF0aC5taW4oZGVsdGFfeSwgbWF4X2hlaWdodCAtIGRyYWdfc3RhcnRfYm90dG9tKTtcblx0XHRcdC8vIFdpZHRoIG11c3QgYmUgdmFsaWRcblx0XHRcdGRlbHRhX2NvbCA9IGNsYW1wKGRlbHRhX2NvbCwgXG5cdFx0XHRcdFx0bWluX251bV9jb2xzIC0gZHJhZ19zdGFydF9yZWN0Lm51bV9jb2xzLFxuXHRcdFx0XHRcdG1heF9udW1fY29scyAtIGRyYWdfc3RhcnRfcmVjdC5udW1fY29scyk7XG5cdFx0XHQvLyBSaWdodCBtdXN0IGJlIHZhbGlkXG5cdFx0XHRkZWx0YV9jb2wgPSBNYXRoLm1pbihkZWx0YV9jb2wsIG1heF9udW1fY29scyAtIGRyYWdfc3RhcnRfcmlnaHRfY29sKTtcblx0XHRcdHJlbmRlcl9yZWN0ID0ge1xuXHRcdFx0ICAgICd0b3AnOiBkcmFnX3N0YXJ0X3JlY3QudG9wLFxuXHRcdFx0ICAgICdjb2wnOiBkcmFnX3N0YXJ0X3JlY3QuY29sLFxuXHRcdFx0ICAgICdudW1fY29scyc6IGRyYWdfc3RhcnRfcmVjdC5udW1fY29scyArIGRlbHRhX2NvbCxcblx0XHRcdCAgICAnaGVpZ2h0JzogZHJhZ19zdGFydF9yZWN0LmhlaWdodCArIGRlbHRhX3lcblx0XHRcdH07XG5cdFx0ICAgIH0gZWxzZSBpZiAoZHJhZ190eXBlID09PSBcInJlc2l6ZV9ibFwiKSB7XG5cdFx0XHQvLyBIZWlnaHQgbXVzdCBiZSB2YWxpZFxuXHRcdFx0ZGVsdGFfeSA9IGNsYW1wKGRlbHRhX3ksXG5cdFx0XHRcdFx0bWluX2hlaWdodCAtIGRyYWdfc3RhcnRfcmVjdC5oZWlnaHQsXG5cdFx0XHRcdFx0bWF4X2hlaWdodCAtIGRyYWdfc3RhcnRfcmVjdC5oZWlnaHQpO1xuXHRcdFx0Ly8gQm90dG9tIG11c3QgYmUgdmFsaWRcblx0XHRcdGRlbHRhX3kgPSBNYXRoLm1pbihkZWx0YV95LCBtYXhfaGVpZ2h0IC0gZHJhZ19zdGFydF9ib3R0b20pO1x0XHRcblx0XHRcdC8vIFdpZHRoIG11c3QgYmUgdmFsaWRcblx0XHRcdGRlbHRhX2NvbCA9IGNsYW1wKGRlbHRhX2NvbCxcblx0XHRcdFx0XHRkcmFnX3N0YXJ0X3JlY3QubnVtX2NvbHMgLSBtYXhfbnVtX2NvbHMsXG5cdFx0XHRcdFx0ZHJhZ19zdGFydF9yZWN0Lm51bV9jb2xzIC0gbWluX251bV9jb2xzKTtcblx0XHRcdC8vIExlZnQgbXVzdCBiZSB2YWxpZFxuXHRcdFx0ZGVsdGFfY29sID0gTWF0aC5tYXgoZGVsdGFfY29sLCAtZHJhZ19zdGFydF9yZWN0LmNvbCk7XG5cdFx0XHRyZW5kZXJfcmVjdCA9IHtcblx0XHRcdCAgICAndG9wJzogZHJhZ19zdGFydF9yZWN0LnRvcCxcblx0XHRcdCAgICAnY29sJzogZHJhZ19zdGFydF9yZWN0LmNvbCArIGRlbHRhX2NvbCxcblx0XHRcdCAgICAnbnVtX2NvbHMnOiBkcmFnX3N0YXJ0X3JlY3QubnVtX2NvbHMgLSBkZWx0YV9jb2wsXG5cdFx0XHQgICAgJ2hlaWdodCc6IGRyYWdfc3RhcnRfcmVjdC5oZWlnaHQgKyBkZWx0YV95XG5cdFx0XHR9O1xuXHRcdCAgICB9XG5cdFx0ICAgIHZhciBjZWxsX3dpZHRoID0gbW9kZWwuZ2V0Q2VsbFdpZHRoKHRydWUpKnpvb20ueDtcblx0XHQgICAgLy8gQ29tcHV0ZSByZW5kZXIgbGVmdCBhbmQgd2lkdGhcblx0XHQgICAgcmVuZGVyX3JlY3QubGVmdCA9IHJlbmRlcl9yZWN0LmNvbCAqIGNlbGxfd2lkdGg7XG5cdFx0ICAgIHJlbmRlcl9yZWN0LndpZHRoID0gcmVuZGVyX3JlY3QubnVtX2NvbHMgKiBjZWxsX3dpZHRoO1xuXHRcdCAgICBkcmF3T3ZlcmxheVJlY3Qoc2VsZiwgbnVsbCwgbnVsbCwgcmVuZGVyX3JlY3QpO1xuXHRcdH1cblx0ICAgIH0gZWxzZSB7XG5cdFx0aWYgKG1vdXNlLm91dHNpZGUpIHtcblx0XHQgICAgdXBkYXRlQ1NTQ3Vyc29yKCk7XG5cdFx0ICAgIHVwZGF0ZVJlY3RSZXNpemVIb3ZlckxvY2F0aW9uKCk7XG5cdFx0fSBlbHNlIHtcblx0XHQgICAgdXBkYXRlQ1NTQ3Vyc29yKG1vdXNlX3gsIG1vdXNlX3kpO1xuXHRcdCAgICB1cGRhdGVSZWN0UmVzaXplSG92ZXJMb2NhdGlvbihtb3VzZV94LCBtb3VzZV95KTtcblx0XHR9XG5cdFx0ZHJhd092ZXJsYXlSZWN0KHNlbGYsIG1vZGVsLCBjZWxsX3ZpZXcpO1xuXHQgICAgfVxuXHR9KTtcblx0dmFyIGVuZERyYWcgPSBmdW5jdGlvbigpIHtcblx0ICAgIGlmIChkcmFnZ2luZykge1xuXHRcdGlmIChbXCJyZXNpemVfdFwiLCBcInJlc2l6ZV9iXCIsIFwicmVzaXplX2xcIiwgXCJyZXNpemVfclwiLFxuXHRcdCAgICBcInJlc2l6ZV90bFwiLCBcInJlc2l6ZV90clwiLCBcInJlc2l6ZV9ibFwiLCBcInJlc2l6ZV9iclwiXS5pbmRleE9mKGRyYWdfdHlwZSkgPiAtMSkge1xuXHRcdCAgICB2aWV3cG9ydF9jYWxsYmFjayh7XG5cdFx0XHQnY29sJzogc2VsZi5jdXJyZW50X3JlY3QuY29sLFxuXHRcdFx0J3Njcm9sbF95X3Byb3BvcnRpb24nOiAoc2VsZi5jdXJyZW50X3JlY3QudG9wIC8gcGFyc2VJbnQoc2VsZi4kY2FudmFzWzBdLmhlaWdodCwgMTApKSxcblx0XHRcdCdudW1fY29scyc6IHNlbGYuY3VycmVudF9yZWN0Lm51bV9jb2xzLFxuXHRcdFx0J3pvb21feSc6IChkcmFnX3N0YXJ0X3JlY3QuaGVpZ2h0IC8gc2VsZi5jdXJyZW50X3JlY3QuaGVpZ2h0KSAqIGRyYWdfc3RhcnRfdmVydF96b29tXG5cdFx0ICAgIH0pO1xuXHRcdH1cblx0XHRkcmFnZ2luZyA9IGZhbHNlO1xuXHRcdGRyYWdfdHlwZSA9IGZhbHNlO1xuXHQgICAgfVxuXHR9O1xuXHQkKGRvY3VtZW50KS5vbihcIm1vdXNldXBcIiwgZnVuY3Rpb24gKGV2dCkge1xuXHQgICAgdmFyIG9mZnNldCA9IHNlbGYuJGRpdi5vZmZzZXQoKTtcblx0ICAgIHZhciBvdmVybGF5X21vdXNlX3ggPSBldnQucGFnZVggLSBvZmZzZXQubGVmdDtcblx0ICAgIHZhciBvdmVybGF5X21vdXNlX3kgPSBldnQucGFnZVkgLSBvZmZzZXQudG9wO1xuXHQgICAgZW5kRHJhZygpO1xuXHQgICAgdmFyIG1vdXNlID0gZ2V0Q2FudmFzTW91c2Uoc2VsZiwgb3ZlcmxheV9tb3VzZV94LCBvdmVybGF5X21vdXNlX3kpO1xuXHQgICAgaWYgKCFtb3VzZS5vdXRzaWRlKSB7XG5cdFx0dmFyIG1vdXNlX3ggPSBtb3VzZS5tb3VzZV94O1xuXHRcdHZhciBtb3VzZV95ID0gbW91c2UubW91c2VfeTtcblx0XHR1cGRhdGVDU1NDdXJzb3IobW91c2VfeCwgbW91c2VfeSk7XG5cdFx0dXBkYXRlUmVjdFJlc2l6ZUhvdmVyTG9jYXRpb24obW91c2VfeCwgbW91c2VfeSk7XG5cdCAgICB9IGVsc2Uge1xuXHRcdHVwZGF0ZUNTU0N1cnNvcigpO1xuXHRcdHVwZGF0ZVJlY3RSZXNpemVIb3ZlckxvY2F0aW9uKCk7XG5cdCAgICB9XG5cdCAgICBkcmF3T3ZlcmxheVJlY3Qoc2VsZiwgbW9kZWwsIGNlbGxfdmlldyk7XG5cdH0pO1xuXHRcblx0KGZ1bmN0aW9uIHNldFVwV2luZG93RHJhZygpIHtcblx0ICAgIHZhciBzdGFydF9tb3VzZV94O1xuXHQgICAgdmFyIHN0YXJ0X21vdXNlX3k7XG5cdCAgICB2YXIgc3RhcnRfbGVmdDtcblx0ICAgIHZhciBzdGFydF90b3A7XG5cdCAgICB2YXIgaGFuZGxlRHJhZyA9IGZ1bmN0aW9uKGV2dCkge1xuXHRcdGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdHZhciBkZWx0YV9tb3VzZV94ID0gZXZ0LnBhZ2VYIC0gc3RhcnRfbW91c2VfeDtcblx0XHR2YXIgZGVsdGFfbW91c2VfeSA9IGV2dC5wYWdlWSAtIHN0YXJ0X21vdXNlX3k7XG5cdFx0c2VsZi5zZXRXaW5kb3dQb3NpdGlvbihzdGFydF9sZWZ0ICsgZGVsdGFfbW91c2VfeCwgc3RhcnRfdG9wICsgZGVsdGFfbW91c2VfeSk7XG5cdCAgICB9O1xuXHQgICAgc2VsZi4kd2luZG93X2Jhci5ob3ZlcihmdW5jdGlvbigpIHtcblx0XHQkKHRoaXMpLmNzcyh7J2N1cnNvcic6J21vdmUnfSk7XG5cdCAgICB9LCBmdW5jdGlvbigpIHtcblx0XHQkKHRoaXMpLmNzcyh7J2N1cnNvcic6J2F1dG8nfSk7XG5cdCAgICB9KTtcblx0ICAgIFxuXHQgICAgc2VsZi4kd2luZG93X2Jhci5vbihcIm1vdXNlZG93blwiLCBmdW5jdGlvbiAoZXZ0KSB7XG5cdFx0c3RhcnRfbW91c2VfeCA9IGV2dC5wYWdlWDtcblx0XHRzdGFydF9tb3VzZV95ID0gZXZ0LnBhZ2VZO1xuXHRcdHN0YXJ0X2xlZnQgPSBwYXJzZUludChzZWxmLiRkaXYuY3NzKCdsZWZ0JyksIDEwKTtcblx0XHRzdGFydF90b3AgPSBwYXJzZUludChzZWxmLiRkaXYuY3NzKCd0b3AnKSwgMTApO1xuXHRcdCQoZG9jdW1lbnQpLm9uKFwibW91c2Vtb3ZlXCIsIGhhbmRsZURyYWcpO1xuXHQgICAgfSk7XG5cdCAgICAkKGRvY3VtZW50KS5vbihcIm1vdXNldXAgY2xpY2tcIiwgZnVuY3Rpb24gKCkge1xuXHRcdCQoZG9jdW1lbnQpLm9mZihcIm1vdXNlbW92ZVwiLCBoYW5kbGVEcmFnKTtcblx0ICAgIH0pO1xuXHR9KSgpO1xuXHRcbiAgICB9XG5cbiAgICB2YXIgZ2V0VHJhY2tCdWZmZXJzID0gZnVuY3Rpb24gKHZpZXcsIGNlbGxfdmlldywgdHJhY2tfaWQpIHtcblx0dmFyIHZlcnRleF9wb3NpdGlvbl9idWZmZXIgPSB2aWV3LmN0eC5jcmVhdGVCdWZmZXIoKTtcblx0dmFyIHZlcnRleF9jb2xvcl9idWZmZXIgPSB2aWV3LmN0eC5jcmVhdGVCdWZmZXIoKTtcblx0dmFyIHZlcnRleF9wb3NpdGlvbl9hcnJheSA9IGNlbGxfdmlldy52ZXJ0ZXhfcG9zaXRpb25fYXJyYXlbdHJhY2tfaWRdO1xuXHR2YXIgdmVydGV4X2NvbG9yX2FycmF5ID0gY2VsbF92aWV3LnZlcnRleF9jb2xvcl9hcnJheVt0cmFja19pZF07XG5cblx0dmlldy5jdHguYmluZEJ1ZmZlcih2aWV3LmN0eC5BUlJBWV9CVUZGRVIsIHZlcnRleF9wb3NpdGlvbl9idWZmZXIpO1xuXHR2aWV3LmN0eC5idWZmZXJEYXRhKHZpZXcuY3R4LkFSUkFZX0JVRkZFUiwgbmV3IEZsb2F0MzJBcnJheSh2ZXJ0ZXhfcG9zaXRpb25fYXJyYXkpLCB2aWV3LmN0eC5TVEFUSUNfRFJBVyk7XG5cdHZlcnRleF9wb3NpdGlvbl9idWZmZXIuaXRlbVNpemUgPSAzO1xuXHR2ZXJ0ZXhfcG9zaXRpb25fYnVmZmVyLm51bUl0ZW1zID0gdmVydGV4X3Bvc2l0aW9uX2FycmF5Lmxlbmd0aCAvIHZlcnRleF9wb3NpdGlvbl9idWZmZXIuaXRlbVNpemU7XG5cblx0dmlldy5jdHguYmluZEJ1ZmZlcih2aWV3LmN0eC5BUlJBWV9CVUZGRVIsIHZlcnRleF9jb2xvcl9idWZmZXIpO1xuXHR2aWV3LmN0eC5idWZmZXJEYXRhKHZpZXcuY3R4LkFSUkFZX0JVRkZFUiwgbmV3IEZsb2F0MzJBcnJheSh2ZXJ0ZXhfY29sb3JfYXJyYXkpLCB2aWV3LmN0eC5TVEFUSUNfRFJBVyk7XG5cdHZlcnRleF9jb2xvcl9idWZmZXIuaXRlbVNpemUgPSA0O1xuXHR2ZXJ0ZXhfY29sb3JfYnVmZmVyLm51bUl0ZW1zID0gdmVydGV4X2NvbG9yX2FycmF5Lmxlbmd0aCAvIHZlcnRleF9jb2xvcl9idWZmZXIuaXRlbVNpemU7XG5cblx0dmFyIHZlcnRleF9jb2x1bW5fYnVmZmVyID0gdmlldy5jdHguY3JlYXRlQnVmZmVyKCk7XG5cdHZhciB2ZXJ0ZXhfY29sdW1uX2FycmF5ID0gY2VsbF92aWV3LnZlcnRleF9jb2x1bW5fYXJyYXlbdHJhY2tfaWRdO1xuXHR2aWV3LmN0eC5iaW5kQnVmZmVyKHZpZXcuY3R4LkFSUkFZX0JVRkZFUiwgdmVydGV4X2NvbHVtbl9idWZmZXIpO1xuXHR2aWV3LmN0eC5idWZmZXJEYXRhKHZpZXcuY3R4LkFSUkFZX0JVRkZFUiwgbmV3IEZsb2F0MzJBcnJheSh2ZXJ0ZXhfY29sdW1uX2FycmF5KSwgdmlldy5jdHguU1RBVElDX0RSQVcpO1xuXHR2ZXJ0ZXhfY29sdW1uX2J1ZmZlci5pdGVtU2l6ZSA9IDE7XG5cdHZlcnRleF9jb2x1bW5fYnVmZmVyLm51bUl0ZW1zID0gdmVydGV4X2NvbHVtbl9hcnJheS5sZW5ndGggLyB2ZXJ0ZXhfY29sdW1uX2J1ZmZlci5pdGVtU2l6ZTtcblxuXHRyZXR1cm4geydwb3NpdGlvbic6IHZlcnRleF9wb3NpdGlvbl9idWZmZXIsXG5cdCAgICAnY29sb3InOiB2ZXJ0ZXhfY29sb3JfYnVmZmVyLFxuXHQgICAgJ2NvbHVtbic6IHZlcnRleF9jb2x1bW5fYnVmZmVyfTtcbiAgICB9O1xuXG4gICAgdmFyIGRyYXdPbmNvcHJpbnQgPSBmdW5jdGlvbiAodmlldywgbW9kZWwsIGNlbGxfdmlldykge1xuXHRpZiAodmlldy5yZW5kZXJpbmdfc3VwcHJlc3NlZCkge1xuXHQgICAgcmV0dXJuO1xuXHR9XG5cblx0dmFyIHpvb20gPSBnZXRab29tKHZpZXcsIG1vZGVsKTtcblxuXHR2aWV3LmN0eC5jbGVhckNvbG9yKDEuMCwgMS4wLCAxLjAsIDEuMCk7XG5cdHZpZXcuY3R4LmNsZWFyKHZpZXcuY3R4LkNPTE9SX0JVRkZFUl9CSVQgfCB2aWV3LmN0eC5ERVBUSF9CVUZGRVJfQklUKTtcblxuXHR2YXIgdHJhY2tzID0gbW9kZWwuZ2V0VHJhY2tzKCk7XG5cdGZvciAodmFyIGkgPSAwOyBpIDwgdHJhY2tzLmxlbmd0aDsgaSsrKSB7XG5cdCAgICB2YXIgdHJhY2tfaWQgPSB0cmFja3NbaV07XG5cdCAgICB2YXIgY2VsbF90b3AgPSBtb2RlbC5nZXRDZWxsVG9wcyh0cmFja19pZCwgdHJ1ZSk7XG5cdCAgICB2YXIgYnVmZmVycyA9IGdldFRyYWNrQnVmZmVycyh2aWV3LCBjZWxsX3ZpZXcsIHRyYWNrX2lkKTtcblx0ICAgIGlmIChidWZmZXJzLnBvc2l0aW9uLm51bUl0ZW1zID09PSAwKSB7XG5cdFx0Y29udGludWU7XG5cdCAgICB9XG5cblx0ICAgIHZpZXcuY3R4LnVzZVByb2dyYW0odmlldy5zaGFkZXJfcHJvZ3JhbSk7XG5cdCAgICB2aWV3LmN0eC5iaW5kQnVmZmVyKHZpZXcuY3R4LkFSUkFZX0JVRkZFUiwgYnVmZmVycy5wb3NpdGlvbik7XG5cdCAgICB2aWV3LmN0eC52ZXJ0ZXhBdHRyaWJQb2ludGVyKHZpZXcuc2hhZGVyX3Byb2dyYW0udmVydGV4UG9zaXRpb25BdHRyaWJ1dGUsIGJ1ZmZlcnMucG9zaXRpb24uaXRlbVNpemUsIHZpZXcuY3R4LkZMT0FULCBmYWxzZSwgMCwgMCk7XG5cblx0ICAgIHZpZXcuY3R4LmJpbmRCdWZmZXIodmlldy5jdHguQVJSQVlfQlVGRkVSLCBidWZmZXJzLmNvbG9yKTtcblx0ICAgIHZpZXcuY3R4LnZlcnRleEF0dHJpYlBvaW50ZXIodmlldy5zaGFkZXJfcHJvZ3JhbS52ZXJ0ZXhDb2xvckF0dHJpYnV0ZSwgYnVmZmVycy5jb2xvci5pdGVtU2l6ZSwgdmlldy5jdHguRkxPQVQsIGZhbHNlLCAwLCAwKTtcblxuXHQgICAgdmlldy5jdHguYmluZEJ1ZmZlcih2aWV3LmN0eC5BUlJBWV9CVUZGRVIsIGJ1ZmZlcnMuY29sdW1uKTtcblx0ICAgIHZpZXcuY3R4LnZlcnRleEF0dHJpYlBvaW50ZXIodmlldy5zaGFkZXJfcHJvZ3JhbS52ZXJ0ZXhPbmNvcHJpbnRDb2x1bW5BdHRyaWJ1dGUsIGJ1ZmZlcnMuY29sdW1uLml0ZW1TaXplLCB2aWV3LmN0eC5GTE9BVCwgZmFsc2UsIDAsIDApO1xuXG5cdCAgICB2aWV3LmN0eC51bmlmb3JtTWF0cml4NGZ2KHZpZXcuc2hhZGVyX3Byb2dyYW0ucE1hdHJpeFVuaWZvcm0sIGZhbHNlLCB2aWV3LnBNYXRyaXgpO1xuXHQgICAgdmlldy5jdHgudW5pZm9ybU1hdHJpeDRmdih2aWV3LnNoYWRlcl9wcm9ncmFtLm12TWF0cml4VW5pZm9ybSwgZmFsc2UsIHZpZXcubXZNYXRyaXgpO1xuXHQgICAgdmlldy5jdHgudW5pZm9ybTFmKHZpZXcuc2hhZGVyX3Byb2dyYW0uY29sdW1uV2lkdGhVbmlmb3JtLCBtb2RlbC5nZXRDZWxsV2lkdGgodHJ1ZSkpO1xuXHQgICAgdmlldy5jdHgudW5pZm9ybTFmKHZpZXcuc2hhZGVyX3Byb2dyYW0uem9vbVhVbmlmb3JtLCB6b29tLngpO1xuXHQgICAgdmlldy5jdHgudW5pZm9ybTFmKHZpZXcuc2hhZGVyX3Byb2dyYW0uem9vbVlVbmlmb3JtLCB6b29tLnkpO1xuXHQgICAgdmlldy5jdHgudW5pZm9ybTFmKHZpZXcuc2hhZGVyX3Byb2dyYW0ub2Zmc2V0WVVuaWZvcm0sIGNlbGxfdG9wKTtcblxuXHQgICAgdmlldy5jdHguZHJhd0FycmF5cyh2aWV3LmN0eC5UUklBTkdMRVMsIDAsIGJ1ZmZlcnMucG9zaXRpb24ubnVtSXRlbXMpO1xuXHR9XG4gICAgfTtcbiAgICB2YXIgZ2V0Wm9vbSA9IGZ1bmN0aW9uICh2aWV3LCBtb2RlbCkge1xuXHR2YXIgem9vbV94ID0gcGFyc2VJbnQodmlldy4kY2FudmFzWzBdLndpZHRoLCAxMCkgLyBtb2RlbC5nZXRPbmNvcHJpbnRXaWR0aE5vQ29sdW1uUGFkZGluZyh0cnVlKTtcblx0dmFyIHpvb21feSA9IHBhcnNlSW50KHZpZXcuJGNhbnZhc1swXS5oZWlnaHQsIDEwKSAvIG1vZGVsLmdldE9uY29wcmludEhlaWdodCh0cnVlKTtcblx0em9vbV94ID0gTWF0aC5tYXgoMCwgTWF0aC5taW4oMSwgem9vbV94KSk7XG5cdHpvb21feSA9IE1hdGgubWF4KDAsIE1hdGgubWluKDEsIHpvb21feSkpO1xuXHRyZXR1cm4ge1xuXHQgICAgeDogem9vbV94LFxuXHQgICAgeTogem9vbV95XG5cdH07XG4gICAgfTtcbiAgICBcbiAgICB2YXIgZHJhd092ZXJsYXlSZWN0ID0gZnVuY3Rpb24gKHZpZXcsIG1vZGVsLCBjZWxsX3ZpZXcsIG9wdF9yZWN0KSB7XG5cdGlmICh2aWV3LnJlbmRlcmluZ19zdXBwcmVzc2VkKSB7XG5cdCAgICByZXR1cm47XG5cdH1cblxuXHR2YXIgbGVmdCwgd2lkdGgsIHRvcCwgaGVpZ2h0LCBjb2wsIG51bV9jb2xzO1xuXHRpZiAob3B0X3JlY3QpIHtcblx0ICAgIGxlZnQgPSBvcHRfcmVjdC5sZWZ0O1xuXHQgICAgd2lkdGggPSBvcHRfcmVjdC53aWR0aDtcblx0ICAgIHRvcCA9IG9wdF9yZWN0LnRvcDtcblx0ICAgIGhlaWdodCA9IG9wdF9yZWN0LmhlaWdodDtcblx0ICAgIGNvbCA9IG9wdF9yZWN0LmNvbDtcblx0ICAgIG51bV9jb2xzID0gb3B0X3JlY3QubnVtX2NvbHM7XG5cdH0gZWxzZSB7XG5cdCAgICB2YXIgY2VsbF93aWR0aCA9IG1vZGVsLmdldENlbGxXaWR0aCh0cnVlKTtcblx0ICAgIHZhciBjZWxsX3BhZGRpbmcgPSBtb2RlbC5nZXRDZWxsUGFkZGluZyh0cnVlKTtcblx0ICAgIHZhciB2aWV3cG9ydCA9IGNlbGxfdmlldy5nZXRWaWV3cG9ydE9uY29wcmludFNwYWNlKG1vZGVsKTtcblxuXHQgICAgdmFyIHpvb20gPSBnZXRab29tKHZpZXcsIG1vZGVsKTtcblx0ICAgIGNvbCA9IE1hdGguZmxvb3Iodmlld3BvcnQubGVmdCAvIChjZWxsX3dpZHRoICsgY2VsbF9wYWRkaW5nKSk7XG5cdCAgICBudW1fY29scyA9IE1hdGgubWluKG1vZGVsLmdldElkT3JkZXIoKS5sZW5ndGggLSBjb2wsXG5cdFx0XHRcdE1hdGguZmxvb3Iodmlld3BvcnQucmlnaHQgLyAoY2VsbF93aWR0aCArIGNlbGxfcGFkZGluZykpIC0gTWF0aC5mbG9vcih2aWV3cG9ydC5sZWZ0IC8gKGNlbGxfd2lkdGggKyBjZWxsX3BhZGRpbmcpKSk7XG5cdCAgICBsZWZ0ID0gY29sICogY2VsbF93aWR0aCAqIHpvb20ueDtcblx0ICAgIHdpZHRoID0gbnVtX2NvbHMgKiBjZWxsX3dpZHRoICogem9vbS54O1xuXHQgICAgdG9wID0gdmlld3BvcnQudG9wICogem9vbS55O1xuXHQgICAgaGVpZ2h0ID0gKHZpZXdwb3J0LmJvdHRvbSAtIHZpZXdwb3J0LnRvcCkgKiB6b29tLnk7XG5cdH1cblxuXHR2YXIgY3R4ID0gdmlldy5vdmVybGF5X2N0eDtcblx0dmFyIGNhbnYgPSB2aWV3LiRvdmVybGF5X2NhbnZhc1swXTtcblx0dmFyIGNhbnZfd2lkdGggPSBwYXJzZUludChjYW52LndpZHRoLCAxMCk7XG5cdHZhciBjYW52X2hlaWdodCA9IHBhcnNlSW50KGNhbnYuaGVpZ2h0LCAxMCk7XG5cdFxuXHQvLyBDbGVhclxuXHRjdHguZmlsbFN0eWxlID0gXCJyZ2JhKDAsMCwwLDApXCI7XG5cdGN0eC5jbGVhclJlY3QoMCwgMCwgY2Fudl93aWR0aCwgY2Fudl9oZWlnaHQpO1xuXHQvLyBEcmF3IHJlY3RhbmdsZVxuXHRjdHguZmlsbFN0eWxlID0gXCJyZ2JhKDI1NSwyNTUsMjU1LDAuNClcIjtcblx0Y3R4LmZpbGxSZWN0KGxlZnQsIHRvcCwgd2lkdGgsIGhlaWdodCk7XG5cdC8vIERyYXcgYm9yZGVyIGxpbmUgYnkgbGluZVxuXHR2YXIgdW5ob3Zlcl9jb2xvciA9IFwicmdiYSgwLDAsMCwwLjc1KVwiO1xuXHR2YXIgaG92ZXJfY29sb3IgPSBcInJnYmEoMjU1LDAsMCwxKVwiO1xuXHR2YXIgdW5ob3Zlcl93aWR0aCA9IDE7XG5cdHZhciBob3Zlcl93aWR0aCA9IDI7XG5cdHZhciB0b3BfaXNfaG92ZXJlZCA9IHZpZXcucmVzaXplX2hvdmVyID09PSBcInRcIiB8fCB2aWV3LnJlc2l6ZV9ob3ZlciA9PT0gXCJ0clwiIHx8IHZpZXcucmVzaXplX2hvdmVyID09PSBcInRsXCI7XG5cdHZhciByaWdodF9pc19ob3ZlcmVkID0gdmlldy5yZXNpemVfaG92ZXIgPT09IFwiclwiIHx8IHZpZXcucmVzaXplX2hvdmVyID09PSBcInRyXCIgfHwgdmlldy5yZXNpemVfaG92ZXIgPT09IFwiYnJcIjtcblx0dmFyIGJvdHRvbV9pc19ob3ZlcmVkID0gdmlldy5yZXNpemVfaG92ZXIgPT09IFwiYlwiIHx8IHZpZXcucmVzaXplX2hvdmVyID09PSBcImJyXCIgfHwgdmlldy5yZXNpemVfaG92ZXIgPT09IFwiYmxcIjtcblx0dmFyIGxlZnRfaXNfaG92ZXJlZCA9IHZpZXcucmVzaXplX2hvdmVyID09PSBcImxcIiB8fCB2aWV3LnJlc2l6ZV9ob3ZlciA9PT0gXCJ0bFwiIHx8IHZpZXcucmVzaXplX2hvdmVyID09PSBcImJsXCI7XG5cdC8vIERyYXcgdG9wIGJvcmRlclxuXHRjdHguYmVnaW5QYXRoKCk7XG5cdGN0eC5tb3ZlVG8obGVmdCwgdG9wKTtcblx0Y3R4LnN0cm9rZVN0eWxlID0gdG9wX2lzX2hvdmVyZWQgPyBob3Zlcl9jb2xvciA6IHVuaG92ZXJfY29sb3I7XG5cdGN0eC5saW5lV2lkdGggPSB0b3BfaXNfaG92ZXJlZCA/IGhvdmVyX3dpZHRoIDogdW5ob3Zlcl93aWR0aDtcblx0Y3R4LmxpbmVUbyhsZWZ0K3dpZHRoLCB0b3ApO1xuXHRjdHguc3Ryb2tlKCk7XG5cdC8vIERyYXcgcmlnaHQgYm9yZGVyXG5cdGN0eC5iZWdpblBhdGgoKTtcblx0Y3R4Lm1vdmVUbyhsZWZ0K3dpZHRoLCB0b3ApO1xuXHRjdHguc3Ryb2tlU3R5bGUgPSByaWdodF9pc19ob3ZlcmVkID8gaG92ZXJfY29sb3IgOiB1bmhvdmVyX2NvbG9yO1xuXHRjdHgubGluZVdpZHRoID0gcmlnaHRfaXNfaG92ZXJlZCA/IGhvdmVyX3dpZHRoIDogdW5ob3Zlcl93aWR0aDtcblx0Y3R4LmxpbmVUbyhsZWZ0K3dpZHRoLCB0b3AraGVpZ2h0KTtcblx0Y3R4LnN0cm9rZSgpO1xuXHQvLyBEcmF3IGJvdHRvbSBib3JkZXJcblx0Y3R4LmJlZ2luUGF0aCgpO1xuXHRjdHgubW92ZVRvKGxlZnQrd2lkdGgsIHRvcCtoZWlnaHQpO1xuXHRjdHguc3Ryb2tlU3R5bGUgPSBib3R0b21faXNfaG92ZXJlZCA/IGhvdmVyX2NvbG9yIDogdW5ob3Zlcl9jb2xvcjtcblx0Y3R4LmxpbmVXaWR0aCA9IGJvdHRvbV9pc19ob3ZlcmVkID8gaG92ZXJfd2lkdGggOiB1bmhvdmVyX3dpZHRoO1xuXHRjdHgubGluZVRvKGxlZnQsIHRvcCtoZWlnaHQpO1xuXHRjdHguc3Ryb2tlKCk7XG5cdC8vIERyYXcgbGVmdCBib3JkZXJcblx0Y3R4LmJlZ2luUGF0aCgpO1xuXHRjdHgubW92ZVRvKGxlZnQsIHRvcCtoZWlnaHQpO1xuXHRjdHguc3Ryb2tlU3R5bGUgPSBsZWZ0X2lzX2hvdmVyZWQgPyBob3Zlcl9jb2xvciA6IHVuaG92ZXJfY29sb3I7XG5cdGN0eC5saW5lV2lkdGggPSBsZWZ0X2lzX2hvdmVyZWQgPyBob3Zlcl93aWR0aCA6IHVuaG92ZXJfd2lkdGg7XG5cdGN0eC5saW5lVG8obGVmdCwgdG9wKTtcblx0Y3R4LnN0cm9rZSgpO1xuXHRcblx0dmlldy5jdXJyZW50X3JlY3QgPSB7XG5cdCAgICAndG9wJzp0b3AsXG5cdCAgICAnbGVmdCc6bGVmdCxcblx0ICAgICd3aWR0aCc6d2lkdGgsXG5cdCAgICAnaGVpZ2h0JzpoZWlnaHQsXG5cdCAgICAnY29sJzogY29sLFxuXHQgICAgJ251bV9jb2xzJzogbnVtX2NvbHNcblx0fTtcbiAgICB9O1xuICAgIHZhciBkcmF3T25jb3ByaW50QW5kT3ZlcmxheVJlY3QgPSBmdW5jdGlvbiAodmlldywgbW9kZWwsIGNlbGxfdmlldykge1xuXHRpZiAodmlldy5yZW5kZXJpbmdfc3VwcHJlc3NlZCkge1xuXHQgICAgcmV0dXJuO1xuXHR9XG5cdGRyYXdPbmNvcHJpbnQodmlldywgbW9kZWwsIGNlbGxfdmlldyk7XG5cdGRyYXdPdmVybGF5UmVjdCh2aWV3LCBtb2RlbCwgY2VsbF92aWV3KTtcbiAgICB9O1xuXG4gICAgT25jb3ByaW50TWluaW1hcFZpZXcucHJvdG90eXBlLm1vdmVUcmFjayA9IGZ1bmN0aW9uIChtb2RlbCwgY2VsbF92aWV3KSB7XG5cdGRyYXdPbmNvcHJpbnRBbmRPdmVybGF5UmVjdCh0aGlzLCBtb2RlbCwgY2VsbF92aWV3KTtcbiAgICB9XG4gICAgT25jb3ByaW50TWluaW1hcFZpZXcucHJvdG90eXBlLmFkZFRyYWNrcyA9IGZ1bmN0aW9uIChtb2RlbCwgY2VsbF92aWV3KSB7XG5cdGRyYXdPbmNvcHJpbnRBbmRPdmVybGF5UmVjdCh0aGlzLCBtb2RlbCwgY2VsbF92aWV3KTtcbiAgICB9XG4gICAgT25jb3ByaW50TWluaW1hcFZpZXcucHJvdG90eXBlLnJlbW92ZVRyYWNrID0gZnVuY3Rpb24gKG1vZGVsLCBjZWxsX3ZpZXcpIHtcblx0ZHJhd09uY29wcmludEFuZE92ZXJsYXlSZWN0KHRoaXMsIG1vZGVsLCBjZWxsX3ZpZXcpO1xuICAgIH1cbiAgICBPbmNvcHJpbnRNaW5pbWFwVmlldy5wcm90b3R5cGUuc2V0SG9yelpvb20gPSBmdW5jdGlvbiAobW9kZWwsIGNlbGxfdmlldykge1xuXHRkcmF3T3ZlcmxheVJlY3QodGhpcywgbW9kZWwsIGNlbGxfdmlldyk7XG5cdHRoaXMuaG9yaXpvbnRhbF96b29tLnNldFNsaWRlclZhbHVlKG1vZGVsLmdldEhvcnpab29tKCkpO1xuICAgIH1cbiAgICBPbmNvcHJpbnRNaW5pbWFwVmlldy5wcm90b3R5cGUuc2V0VmVydFpvb20gPSBmdW5jdGlvbiAobW9kZWwsIGNlbGxfdmlldykge1xuXHRkcmF3T3ZlcmxheVJlY3QodGhpcywgbW9kZWwsIGNlbGxfdmlldyk7XG5cdHRoaXMudmVydGljYWxfem9vbS5zZXRTbGlkZXJWYWx1ZShtb2RlbC5nZXRWZXJ0Wm9vbSgpKTtcbiAgICB9XG4gICAgT25jb3ByaW50TWluaW1hcFZpZXcucHJvdG90eXBlLnNldFpvb20gPSBmdW5jdGlvbihtb2RlbCwgY2VsbF92aWV3KSB7XG5cdGRyYXdPdmVybGF5UmVjdCh0aGlzLCBtb2RlbCwgY2VsbF92aWV3KTtcblx0dGhpcy5ob3Jpem9udGFsX3pvb20uc2V0U2xpZGVyVmFsdWUobW9kZWwuZ2V0SG9yelpvb20oKSk7XG5cdHRoaXMudmVydGljYWxfem9vbS5zZXRTbGlkZXJWYWx1ZShtb2RlbC5nZXRWZXJ0Wm9vbSgpKTtcbiAgICB9XG4gICAgT25jb3ByaW50TWluaW1hcFZpZXcucHJvdG90eXBlLnNldFNjcm9sbCA9IGZ1bmN0aW9uIChtb2RlbCwgY2VsbF92aWV3KSB7XG5cdGRyYXdPdmVybGF5UmVjdCh0aGlzLCBtb2RlbCwgY2VsbF92aWV3KTtcbiAgICB9XG4gICAgT25jb3ByaW50TWluaW1hcFZpZXcucHJvdG90eXBlLnNldEhvcnpTY3JvbGwgPSBmdW5jdGlvbiAobW9kZWwsIGNlbGxfdmlldykge1xuXHRkcmF3T3ZlcmxheVJlY3QodGhpcywgbW9kZWwsIGNlbGxfdmlldyk7XG4gICAgfVxuICAgIE9uY29wcmludE1pbmltYXBWaWV3LnByb3RvdHlwZS5zZXRWZXJ0U2Nyb2xsID0gZnVuY3Rpb24gKG1vZGVsLCBjZWxsX3ZpZXcpIHtcblx0ZHJhd092ZXJsYXlSZWN0KHRoaXMsIG1vZGVsLCBjZWxsX3ZpZXcpO1xuICAgIH1cbiAgICBPbmNvcHJpbnRNaW5pbWFwVmlldy5wcm90b3R5cGUuc2V0Vmlld3BvcnQgPSBmdW5jdGlvbiAobW9kZWwsIGNlbGxfdmlldykge1xuXHRkcmF3T3ZlcmxheVJlY3QodGhpcywgbW9kZWwsIGNlbGxfdmlldyk7XG5cdHRoaXMuaG9yaXpvbnRhbF96b29tLnNldFNsaWRlclZhbHVlKG1vZGVsLmdldEhvcnpab29tKCkpO1xuXHR0aGlzLnZlcnRpY2FsX3pvb20uc2V0U2xpZGVyVmFsdWUobW9kZWwuZ2V0VmVydFpvb20oKSk7XG4gICAgfVxuICAgIE9uY29wcmludE1pbmltYXBWaWV3LnByb3RvdHlwZS5zb3J0ID0gZnVuY3Rpb24gKG1vZGVsLCBjZWxsX3ZpZXcpIHtcblx0ZHJhd09uY29wcmludEFuZE92ZXJsYXlSZWN0KHRoaXMsIG1vZGVsLCBjZWxsX3ZpZXcpO1xuICAgIH1cbiAgICBPbmNvcHJpbnRNaW5pbWFwVmlldy5wcm90b3R5cGUuc2V0VHJhY2tEYXRhID0gZnVuY3Rpb24gKG1vZGVsLCBjZWxsX3ZpZXcpIHtcblx0ZHJhd09uY29wcmludEFuZE92ZXJsYXlSZWN0KHRoaXMsIG1vZGVsLCBjZWxsX3ZpZXcpO1xuICAgIH1cbiAgICBPbmNvcHJpbnRNaW5pbWFwVmlldy5wcm90b3R5cGUuc2hhcmVSdWxlU2V0ID0gZnVuY3Rpb24gKG1vZGVsLCBjZWxsX3ZpZXcpIHtcblx0ZHJhd09uY29wcmludEFuZE92ZXJsYXlSZWN0KHRoaXMsIG1vZGVsLCBjZWxsX3ZpZXcpO1xuICAgIH1cbiAgICBPbmNvcHJpbnRNaW5pbWFwVmlldy5wcm90b3R5cGUuc2V0UnVsZVNldCA9IGZ1bmN0aW9uIChtb2RlbCwgY2VsbF92aWV3KSB7XG5cdGRyYXdPbmNvcHJpbnRBbmRPdmVybGF5UmVjdCh0aGlzLCBtb2RlbCwgY2VsbF92aWV3KTtcbiAgICB9XG4gICAgT25jb3ByaW50TWluaW1hcFZpZXcucHJvdG90eXBlLnNldElkT3JkZXIgPSBmdW5jdGlvbiAobW9kZWwsIGNlbGxfdmlldykge1xuXHRkcmF3T25jb3ByaW50QW5kT3ZlcmxheVJlY3QodGhpcywgbW9kZWwsIGNlbGxfdmlldyk7XG4gICAgfVxuICAgIE9uY29wcmludE1pbmltYXBWaWV3LnByb3RvdHlwZS5zdXBwcmVzc1JlbmRlcmluZyA9IGZ1bmN0aW9uICgpIHtcblx0dGhpcy5yZW5kZXJpbmdfc3VwcHJlc3NlZCA9IHRydWU7XG4gICAgfVxuICAgIE9uY29wcmludE1pbmltYXBWaWV3LnByb3RvdHlwZS5yZWxlYXNlUmVuZGVyaW5nID0gZnVuY3Rpb24gKG1vZGVsLCBjZWxsX3ZpZXcpIHtcblx0dGhpcy5yZW5kZXJpbmdfc3VwcHJlc3NlZCA9IGZhbHNlO1xuXHRkcmF3T25jb3ByaW50QW5kT3ZlcmxheVJlY3QodGhpcywgbW9kZWwsIGNlbGxfdmlldyk7XG4gICAgfVxuICAgIE9uY29wcmludE1pbmltYXBWaWV3LnByb3RvdHlwZS5oaWRlSWRzID0gZnVuY3Rpb24gKG1vZGVsLCBjZWxsX3ZpZXcpIHtcblx0ZHJhd09uY29wcmludEFuZE92ZXJsYXlSZWN0KHRoaXMsIG1vZGVsLCBjZWxsX3ZpZXcpO1xuICAgIH1cblxuICAgIE9uY29wcmludE1pbmltYXBWaWV3LnByb3RvdHlwZS5zZXRXaW5kb3dQb3NpdGlvbiA9IGZ1bmN0aW9uKHgsIHkpIHtcblx0dGhpcy4kZGl2LmNzcyh7J3RvcCc6IHksICdsZWZ0JzogeH0pO1xuICAgIH1cbiAgICBcbiAgICBPbmNvcHJpbnRNaW5pbWFwVmlldy5wcm90b3R5cGUuc2V0V2lkdGggPSBmdW5jdGlvbiAodywgbW9kZWwsIGNlbGxfdmlldykge1xuXHR0aGlzLiRjYW52YXNbMF0ud2lkdGggPSB3O1xuXHR0aGlzLiRvdmVybGF5X2NhbnZhc1swXS53aWR0aCA9IHc7XG5cdGdldFdlYkdMQ29udGV4dEFuZFNldFVwTWF0cmljZXNBbmRTaGFkZXJzKHRoaXMpO1xuXHR0aGlzLm92ZXJsYXlfY3R4ID0gdGhpcy4kb3ZlcmxheV9jYW52YXNbMF0uZ2V0Q29udGV4dChcIjJkXCIpO1xuXG5cdGRyYXdPbmNvcHJpbnRBbmRPdmVybGF5UmVjdCh0aGlzLCBtb2RlbCwgY2VsbF92aWV3KTtcbiAgICB9XG4gICAgcmV0dXJuIE9uY29wcmludE1pbmltYXBWaWV3O1xufSkoKTtcblxubW9kdWxlLmV4cG9ydHMgPSBPbmNvcHJpbnRNaW5pbWFwVmlldzsiLCJ2YXIgYmluYXJ5c2VhcmNoID0gcmVxdWlyZSgnLi9iaW5hcnlzZWFyY2guanMnKTtcbnZhciBDYWNoZWRQcm9wZXJ0eSA9IHJlcXVpcmUoJy4vQ2FjaGVkUHJvcGVydHkuanMnKTtcblxuZnVuY3Rpb24gaWZuZGVmKHgsIHZhbCkge1xuICAgIHJldHVybiAodHlwZW9mIHggPT09IFwidW5kZWZpbmVkXCIgPyB2YWwgOiB4KTtcbn1cblxudmFyIFVuaW9uT2ZTZXRzID0gKGZ1bmN0aW9uKCkge1xuICAgIC8vIGEgc2V0LCB0byBiZSBwYXNzZWQgaW4gYXMgYXJndW1lbnQsIGlzIGFuIG9iamVjdCB3aGVyZSB0aGUgdmFsdWVzIGFyZSB0cnV0aHlcbiAgICBmdW5jdGlvbiBVbmlvbk9mU2V0cygpIHtcblx0dGhpcy51bmlvbl9jb3VudCA9IHt9O1xuXHR0aGlzLnNldHMgPSB7fTtcbiAgICB9XG4gICAgdmFyIHNldE9mS2V5cyA9IGZ1bmN0aW9uIChvYmopIHtcblx0dmFyIHNldCA9IHt9O1xuXHRmb3IgKHZhciBrIGluIG9iaikge1xuXHQgICAgaWYgKHR5cGVvZiBvYmpba10gIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0c2V0W2tdID0gdHJ1ZTtcblx0ICAgIH1cblx0fVxuXHRyZXR1cm4gc2V0O1xuICAgIH07XG4gICAgVW5pb25PZlNldHMucHJvdG90eXBlLnB1dFNldCA9IGZ1bmN0aW9uKGlkLCBzZXQpIHtcblx0dGhpcy5yZW1vdmVTZXQoaWQpO1xuXHR0aGlzLnNldHNbaWRdID0gc2V0O1xuXHRcblx0dmFyIHVuaW9uX2NvdW50ID0gdGhpcy51bmlvbl9jb3VudDtcblx0Zm9yICh2YXIgayBpbiBzZXQpIHtcblx0ICAgIGlmIChzZXRba10pIHtcblx0XHR0aGlzLnVuaW9uX2NvdW50W2tdID0gdGhpcy51bmlvbl9jb3VudFtrXSB8fCAwO1xuXHRcdHRoaXMudW5pb25fY291bnRba10gKz0gMTtcblx0ICAgIH1cblx0fVxuICAgIH1cbiAgICBVbmlvbk9mU2V0cy5wcm90b3R5cGUucmVtb3ZlU2V0ID0gZnVuY3Rpb24oaWQpIHtcblx0dmFyIHVuaW9uX2NvdW50ID0gdGhpcy51bmlvbl9jb3VudDtcblx0dmFyIG9sZF9zZXQgPSB0aGlzLnNldHNbaWRdIHx8IHt9O1xuXHRmb3IgKHZhciBrIGluIG9sZF9zZXQpIHtcblx0ICAgIGlmIChvbGRfc2V0W2tdKSB7XG5cdFx0dW5pb25fY291bnRba10gLT0gMTtcblx0XHRpZiAodW5pb25fY291bnRba10gPT09IDApIHtcblx0XHQgICAgZGVsZXRlIHVuaW9uX2NvdW50W2tdO1xuXHRcdH1cblx0ICAgIH1cblx0fVxuXHRkZWxldGUgdGhpcy5zZXRzW2lkXTtcbiAgICB9XG4gICAgVW5pb25PZlNldHMucHJvdG90eXBlLmdldFVuaW9uID0gZnVuY3Rpb24oKSB7XG5cdHJldHVybiBzZXRPZktleXModGhpcy51bmlvbl9jb3VudCk7XG4gICAgfVxuICAgIHJldHVybiBVbmlvbk9mU2V0cztcbn0pKCk7XG5cbnZhciBzZXRVbmlvbiA9IGZ1bmN0aW9uKGxpc3Rfb2Zfc2V0cykge1xuICAgIHZhciB1bmlvbiA9IHt9O1xuICAgIGZvciAodmFyIGk9MDsgaTxsaXN0X29mX3NldHMubGVuZ3RoOyBpKyspIHtcblx0dmFyIHNldCA9IGxpc3Rfb2Zfc2V0c1tpXTtcblx0Zm9yICh2YXIgayBpbiBzZXQpIHtcblx0ICAgIGlmIChzZXQuaGFzT3duUHJvcGVydHkoaykpIHtcblx0XHR1bmlvbltrXSA9IHRydWU7XG5cdCAgICB9XG5cdH1cbiAgICB9XG4gICAgcmV0dXJuIHVuaW9uO1xufTtcblxudmFyIG9iamVjdFZhbHVlcyA9IGZ1bmN0aW9uKG9iaikge1xuICAgIHJldHVybiBPYmplY3Qua2V5cyhvYmopLm1hcChmdW5jdGlvbihrZXkpIHtcblx0cmV0dXJuIG9ialtrZXldO1xuICAgIH0pO1xufTtcblxudmFyIGFycmF5VW5pcXVlID0gZnVuY3Rpb24oYXJyKSB7XG4gICAgdmFyIHByZXNlbnQgPSB7fTtcbiAgICB2YXIgdW5pcXVlID0gW107XG4gICAgZm9yICh2YXIgaT0wOyBpPGFyci5sZW5ndGg7IGkrKykge1xuXHRpZiAodHlwZW9mIHByZXNlbnRbYXJyW2ldXSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0ICAgIHByZXNlbnRbYXJyW2ldXSA9IHRydWU7XG5cdCAgICB1bmlxdWUucHVzaChhcnJbaV0pO1xuXHR9XG4gICAgfVxuICAgIHJldHVybiB1bmlxdWU7XG59O1xuXG52YXIgY29weVNoYWxsb3dPYmplY3QgPSBmdW5jdGlvbihvYmopIHtcbiAgICB2YXIgY29weSA9IHt9O1xuICAgIGZvciAodmFyIGtleSBpbiBvYmopIHtcblx0aWYgKG9iai5oYXNPd25Qcm9wZXJ0eShrZXkpKSB7XG5cdCAgICBjb3B5W2tleV0gPSBvYmpba2V5XTtcblx0fVxuICAgIH1cbiAgICByZXR1cm4gY29weTtcbn07XG5cbnZhciBjbGFtcCA9IGZ1bmN0aW9uKHgsIGxvd2VyLCB1cHBlcikge1xuICAgIHJldHVybiBNYXRoLm1pbih1cHBlciwgTWF0aC5tYXgobG93ZXIsIHgpKTtcbn07XG5cbnZhciBPbmNvcHJpbnRNb2RlbCA9IChmdW5jdGlvbiAoKSB7XG4gICAgdmFyIE1JTl9aT09NX1BJWEVMUyA9IDEwMDtcbiAgICB2YXIgTUlOX0NFTExfSEVJR0hUX1BJWEVMUyA9IDM7XG4gICAgZnVuY3Rpb24gT25jb3ByaW50TW9kZWwoaW5pdF9jZWxsX3BhZGRpbmcsIGluaXRfY2VsbF9wYWRkaW5nX29uLFxuXHQgICAgaW5pdF9ob3J6X3pvb20sIGluaXRfdmVydF96b29tLCBcblx0ICAgIGluaXRfY2VsbF93aWR0aCwgaW5pdF90cmFja19ncm91cF9wYWRkaW5nKSB7XG5cdFx0XG5cdHZhciBtb2RlbCA9IHRoaXM7XHRcblx0XG5cdC8vIEdsb2JhbCBwcm9wZXJ0aWVzXG5cdHRoaXMuc29ydF9jb25maWcgPSB7fTtcblx0dGhpcy5yZW5kZXJpbmdfc3VwcHJlc3NlZF9kZXB0aCA9IDA7XG5cdFxuXHQvLyBSZW5kZXJpbmcgUHJvcGVydGllc1xuXHR0aGlzLm1heF9oZWlnaHQgPSA1MDA7XG5cdHRoaXMuY2VsbF93aWR0aCA9IGlmbmRlZihpbml0X2NlbGxfd2lkdGgsIDYpO1xuXHR0aGlzLmhvcnpfem9vbSA9IGlmbmRlZihpbml0X2hvcnpfem9vbSwgMSk7XG5cdHRoaXMudmVydF96b29tID0gaWZuZGVmKGluaXRfdmVydF96b29tLCAxKTtcblx0dGhpcy5ob3J6X3Njcm9sbCA9IDA7XG5cdHRoaXMudmVydF9zY3JvbGwgPSAwO1xuXHR0aGlzLmJvdHRvbV9wYWRkaW5nID0gMDtcblx0dGhpcy50cmFja19ncm91cF9wYWRkaW5nID0gaWZuZGVmKGluaXRfdHJhY2tfZ3JvdXBfcGFkZGluZywgMTApO1xuXHR0aGlzLmNlbGxfcGFkZGluZyA9IGlmbmRlZihpbml0X2NlbGxfcGFkZGluZywgMyk7XG5cdHRoaXMuY2VsbF9wYWRkaW5nX29uID0gaWZuZGVmKGluaXRfY2VsbF9wYWRkaW5nX29uLCB0cnVlKTtcblx0dGhpcy5jZWxsX3BhZGRpbmdfb2ZmX2NlbGxfd2lkdGhfdGhyZXNob2xkID0gMjtcblx0dGhpcy5jZWxsX3BhZGRpbmdfb2ZmX2JlY2F1c2Vfb2Zfem9vbSA9ICh0aGlzLmdldENlbGxXaWR0aCgpIDwgdGhpcy5jZWxsX3BhZGRpbmdfb2ZmX2NlbGxfd2lkdGhfdGhyZXNob2xkKTtcblx0dGhpcy5pZF9vcmRlciA9IFtdO1xuXHR0aGlzLmhpZGRlbl9pZHMgPSB7fTtcblx0XG5cdC8vIFRyYWNrIFByb3BlcnRpZXNcblx0dGhpcy50cmFja19sYWJlbCA9IHt9O1xuXHR0aGlzLnRyYWNrX2Rlc2NyaXB0aW9uID0ge307XG5cdHRoaXMuY2VsbF9oZWlnaHQgPSB7fTtcblx0dGhpcy50cmFja19wYWRkaW5nID0ge307XG5cdHRoaXMudHJhY2tfZGF0YV9pZF9rZXkgPSB7fTtcblx0dGhpcy50cmFja190b29sdGlwX2ZuID0ge307XG5cdHRoaXMudHJhY2tfcmVtb3ZhYmxlID0ge307XG5cdHRoaXMudHJhY2tfcmVtb3ZlX2NhbGxiYWNrID0ge307XG5cdHRoaXMudHJhY2tfc29ydF9jbXBfZm4gPSB7fTtcblx0dGhpcy50cmFja19zb3J0X2RpcmVjdGlvbl9jaGFuZ2VhYmxlID0ge307XG5cdHRoaXMudHJhY2tfc29ydF9kaXJlY3Rpb24gPSB7fTsgLy8gMTogYXNjZW5kaW5nLCAtMTogZGVzY2VuZGluZywgMDogbm90XG5cdHRoaXMudHJhY2tfZGF0YSA9IHt9O1xuXHR0aGlzLnRyYWNrX3J1bGVfc2V0X2lkID0ge307IC8vIHRyYWNrIGlkIC0+IHJ1bGUgc2V0IGlkXG5cdHRoaXMudHJhY2tfYWN0aXZlX3J1bGVzID0ge307IC8vIGZyb20gdHJhY2sgaWQgdG8gYWN0aXZlIHJ1bGUgbWFwIChtYXAgd2l0aCBydWxlIGlkcyBhcyBrZXlzKVxuXHR0aGlzLnRyYWNrX2luZm8gPSB7fTtcblx0dGhpcy50cmFja19oYXNfY29sdW1uX3NwYWNpbmcgPSB7fTsgLy8gdHJhY2sgaWQgLT4gYm9vbGVhblxuXHR0aGlzLnRyYWNrX2V4cGFuc2lvbl9pbml0X2NhbGxiYWNrID0ge307IC8vIHRyYWNrIGlkIC0+IGZ1bmN0aW9uIHRoYXQgaW5pdGlhbGl6ZXMgZXhwYW5zaW9uIGRhdGEgaWYgYXBwbGljYWJsZVxuXHR0aGlzLnRyYWNrX2V4cGFuc2lvbl9nZW5lcyA9IHt9OyAvLyB0cmFjayBpZCAtPiBhcnJheSBvZiBnZW5lIGRhdGEgdG8gZXhwYW5kIGlmIGluaXRpYWxpemVkXG5cdHRoaXMudHJhY2tfZXhwYW5zaW9uX2NhbGxiYWNrID0ge307IC8vIHRyYWNrIGlkIC0+IGZ1bmN0aW9uIHRoYXQgdGFrZXMgZ2VuZSBkYXRhIGFuZCBhZGRzIGV4cGFuc2lvbiB0cmFja3MgaWYgaW5pdGlhbGl6ZWRcblx0dGhpcy50cmFja19leHBhbnNpb25fdHJhY2tzID0ge307IC8vIHRyYWNrIGlkIC0+IGFycmF5IG9mIHRyYWNrIGlkcyBpZiBhcHBsaWNhYmxlXG5cdFxuXHQvLyBSdWxlIFNldCBQcm9wZXJ0aWVzXG5cdHRoaXMucnVsZV9zZXRzID0ge307IC8vIG1hcCBmcm9tIHJ1bGUgc2V0IGlkIHRvIHJ1bGUgc2V0XG5cdFxuXHQvLyBDYWNoZWQgYW5kIFJlY29tcHV0ZWQgUHJvcGVydGllc1xuXHR0aGlzLnZpc2libGVfaWRfb3JkZXIgPSBuZXcgQ2FjaGVkUHJvcGVydHkoW10sIGZ1bmN0aW9uICgpIHtcblx0ICAgIHZhciBoaWRkZW5faWRzID0gbW9kZWwuaGlkZGVuX2lkcztcblx0ICAgIHJldHVybiBtb2RlbC5pZF9vcmRlci5maWx0ZXIoZnVuY3Rpb24gKGlkKSB7XG5cdFx0cmV0dXJuICFoaWRkZW5faWRzW2lkXTtcblx0ICAgIH0pO1xuXHR9KTtcblx0dGhpcy50cmFja19pZF90b19kYXR1bSA9IG5ldyBDYWNoZWRQcm9wZXJ0eSh7fSwgZnVuY3Rpb24obW9kZWwsIHRyYWNrX2lkKSB7XG5cdCAgICB2YXIgY3VyciA9IG1vZGVsLnRyYWNrX2lkX3RvX2RhdHVtLmdldCgpO1xuXHQgICAgaWYgKG1vZGVsLmdldENvbnRhaW5pbmdUcmFja0dyb3VwKHRyYWNrX2lkKSAhPT0gbnVsbCkge1xuXHRcdHZhciBtYXAgPSB7fTtcblx0XHR2YXIgZGF0YSA9IG1vZGVsLmdldFRyYWNrRGF0YSh0cmFja19pZCkgfHwgW107XG5cdFx0dmFyIGRhdGFfaWRfa2V5ID0gbW9kZWwuZ2V0VHJhY2tEYXRhSWRLZXkodHJhY2tfaWQpIHx8ICcnO1xuXHRcdGZvciAodmFyIGk9MDsgaTxkYXRhLmxlbmd0aDsgaSsrKSB7XG5cdFx0ICAgIG1hcFtkYXRhW2ldW2RhdGFfaWRfa2V5XV0gPSBkYXRhW2ldO1xuXHRcdH1cblx0XHRjdXJyW3RyYWNrX2lkXSA9IG1hcDtcblx0ICAgIH0gZWxzZSB7XG5cdFx0ZGVsZXRlIGN1cnJbdHJhY2tfaWRdO1xuXHQgICAgfVxuXHQgICAgcmV0dXJuIGN1cnI7XG5cdH0pO1xuXHR0aGlzLnRyYWNrX3ByZXNlbnRfaWRzID0gbmV3IENhY2hlZFByb3BlcnR5KG5ldyBVbmlvbk9mU2V0cygpLCBmdW5jdGlvbihtb2RlbCwgdHJhY2tfaWQpIHtcblx0ICAgIHZhciB1bmlvbiA9IG1vZGVsLnRyYWNrX3ByZXNlbnRfaWRzLmdldCgpO1xuXHQgICAgaWYgKG1vZGVsLmdldENvbnRhaW5pbmdUcmFja0dyb3VwKHRyYWNrX2lkKSAhPT0gbnVsbCkge1xuXHRcdHZhciBpZHMgPSB7fTtcblx0XHR2YXIgZGF0YSA9IG1vZGVsLmdldFRyYWNrRGF0YSh0cmFja19pZCkgfHwgW107XG5cdFx0dmFyIGRhdGFfaWRfa2V5ID0gbW9kZWwuZ2V0VHJhY2tEYXRhSWRLZXkodHJhY2tfaWQpIHx8ICcnO1xuXHRcdGZvciAodmFyIGkgPSAwOyBpIDwgZGF0YS5sZW5ndGg7IGkrKykge1xuXHRcdCAgICBpZHNbZGF0YVtpXVtkYXRhX2lkX2tleV1dID0gdHJ1ZTtcblx0XHR9XG5cdFx0dW5pb24ucHV0U2V0KHRyYWNrX2lkLCBpZHMpO1xuXHQgICAgfSBlbHNlIHtcblx0XHR1bmlvbi5yZW1vdmVTZXQodHJhY2tfaWQpO1xuXHQgICAgfVxuXHQgICAgcmV0dXJuIHVuaW9uO1xuXHR9KTtcblx0dGhpcy5wcmVzZW50X2lkcyA9IG5ldyBDYWNoZWRQcm9wZXJ0eSh7fSwgZnVuY3Rpb24oKSB7XG5cdCAgICByZXR1cm4gbW9kZWwudHJhY2tfcHJlc2VudF9pZHMuZ2V0KCkuZ2V0VW5pb24oKTtcblx0fSk7XG5cdHRoaXMudHJhY2tfcHJlc2VudF9pZHMuYWRkQm91bmRQcm9wZXJ0eSh0aGlzLnByZXNlbnRfaWRzKTtcblx0XG5cdHRoaXMuaWRfdG9faW5kZXggPSBuZXcgQ2FjaGVkUHJvcGVydHkoe30sIGZ1bmN0aW9uKCkge1xuXHQgICAgdmFyIGlkX3RvX2luZGV4ID0ge307XG5cdCAgICB2YXIgaWRfb3JkZXIgPSBtb2RlbC5nZXRJZE9yZGVyKHRydWUpO1xuXHQgICAgZm9yICh2YXIgaT0wOyBpPGlkX29yZGVyLmxlbmd0aDsgaSsrKSB7XG5cdFx0aWRfdG9faW5kZXhbaWRfb3JkZXJbaV1dID0gaTtcblx0ICAgIH1cblx0ICAgIHJldHVybiBpZF90b19pbmRleDtcblx0fSk7XG5cdHRoaXMudmlzaWJsZV9pZF90b19pbmRleCA9IG5ldyBDYWNoZWRQcm9wZXJ0eSh7fSwgZnVuY3Rpb24oKSB7XG5cdCAgICB2YXIgaWRfdG9faW5kZXggPSB7fTtcblx0ICAgIHZhciBpZF9vcmRlciA9IG1vZGVsLmdldElkT3JkZXIoKTtcblx0ICAgIGZvciAodmFyIGk9MDsgaTxpZF9vcmRlci5sZW5ndGg7IGkrKykge1xuXHRcdGlkX3RvX2luZGV4W2lkX29yZGVyW2ldXSA9IGk7XG5cdCAgICB9XG5cdCAgICByZXR1cm4gaWRfdG9faW5kZXg7XG5cdH0pO1xuXHR0aGlzLnZpc2libGVfaWRfb3JkZXIuYWRkQm91bmRQcm9wZXJ0eSh0aGlzLnZpc2libGVfaWRfdG9faW5kZXgpO1xuXHRcblx0dGhpcy50cmFja19ncm91cHMgPSBbXTtcblx0dGhpcy50cmFja19ncm91cF9zb3J0X3ByaW9yaXR5ID0gW107XG5cdHRoaXMudHJhY2tfZ3JvdXBfaGVhZGVyID0gW107XG5cdFxuXHR0aGlzLnRyYWNrX3RvcHMgPSBuZXcgQ2FjaGVkUHJvcGVydHkoe30sIGZ1bmN0aW9uICgpIHtcblx0ICAgIHZhciB0b3BzID0ge307XG5cdCAgICB2YXIgZ3JvdXBzID0gbW9kZWwuZ2V0VHJhY2tHcm91cHMoKTtcblx0ICAgIHZhciB5ID0gMDtcblx0ICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZ3JvdXBzLmxlbmd0aDsgaSsrKSB7XG5cdFx0dmFyIGdyb3VwID0gZ3JvdXBzW2ldO1xuXHRcdGlmIChtb2RlbC5nZXRUcmFja0dyb3VwSGVhZGVyKGkpLmxlbmd0aCA+IDAgJiYgZ3JvdXAubGVuZ3RoID4gMCkge1xuXHRcdCAgICB5ICs9IG1vZGVsLmdldFRyYWNrR3JvdXBIZWFkZXJTaXplKCk7XG5cdFx0fVxuXHRcdGZvciAodmFyIGogPSAwOyBqIDwgZ3JvdXAubGVuZ3RoOyBqKyspIHtcblx0XHQgICAgdmFyIHRyYWNrX2lkID0gZ3JvdXBbal07XG5cdFx0ICAgIHRvcHNbdHJhY2tfaWRdID0geTtcblx0XHQgICAgeSArPSBtb2RlbC5nZXRUcmFja0hlaWdodCh0cmFja19pZCwgdHJ1ZSk7XG5cdFx0fVxuXHRcdGlmIChncm91cC5sZW5ndGggPiAwKSB7XG5cdFx0ICAgIHkgKz0gbW9kZWwuZ2V0VHJhY2tHcm91cFBhZGRpbmcodHJ1ZSk7XG5cdFx0fVxuXHQgICAgfVxuXHQgICAgcmV0dXJuIHRvcHM7XG5cdH0pO1xuXHR0aGlzLmNlbGxfdG9wcyA9IG5ldyBDYWNoZWRQcm9wZXJ0eSh7fSwgZnVuY3Rpb24oKSB7XG5cdCAgICB2YXIgdHJhY2tfdG9wcyA9IG1vZGVsLnRyYWNrX3RvcHMuZ2V0KCk7XG5cdCAgICB2YXIgY2VsbF90b3BzID0ge307XG5cdCAgICBmb3IgKHZhciBrIGluIHRyYWNrX3RvcHMpIHtcblx0XHRpZiAodHJhY2tfdG9wcy5oYXNPd25Qcm9wZXJ0eShrKSkge1xuXHRcdCAgICBjZWxsX3RvcHNba10gPSB0cmFja190b3BzW2tdICsgbW9kZWwuZ2V0VHJhY2tQYWRkaW5nKGssIHRydWUpO1xuXHRcdH1cblx0ICAgIH1cblx0ICAgIHJldHVybiBjZWxsX3RvcHM7XG5cdH0pO1xuXHR0aGlzLmxhYmVsX3RvcHMgPSBuZXcgQ2FjaGVkUHJvcGVydHkoe30sIGZ1bmN0aW9uKCkge1xuXHQgICAgcmV0dXJuIG1vZGVsLmNlbGxfdG9wcy5nZXQoKTtcblx0fSk7XG5cdFxuXHR0aGlzLnRyYWNrX3RvcHMuYWRkQm91bmRQcm9wZXJ0eSh0aGlzLmNlbGxfdG9wcyk7XG5cdHRoaXMuY2VsbF90b3BzLmFkZEJvdW5kUHJvcGVydHkodGhpcy5sYWJlbF90b3BzKTtcblx0XG5cdHRoaXMudHJhY2tfdG9wc196b29tZWQgPSBuZXcgQ2FjaGVkUHJvcGVydHkoe30sIGZ1bmN0aW9uICgpIHtcblx0ICAgIHZhciB0b3BzID0ge307XG5cdCAgICB2YXIgZ3JvdXBzID0gbW9kZWwuZ2V0VHJhY2tHcm91cHMoKTtcblx0ICAgIHZhciB5ID0gMDtcblx0ICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZ3JvdXBzLmxlbmd0aDsgaSsrKSB7XG5cdFx0dmFyIGdyb3VwID0gZ3JvdXBzW2ldO1xuXHRcdGZvciAodmFyIGogPSAwOyBqIDwgZ3JvdXAubGVuZ3RoOyBqKyspIHtcblx0XHQgICAgdmFyIHRyYWNrX2lkID0gZ3JvdXBbal07XG5cdFx0ICAgIHRvcHNbdHJhY2tfaWRdID0geTtcblx0XHQgICAgeSArPSBtb2RlbC5nZXRUcmFja0hlaWdodCh0cmFja19pZCk7XG5cdFx0fVxuXHRcdGlmIChncm91cC5sZW5ndGggPiAwKSB7XG5cdFx0ICAgIHkgKz0gbW9kZWwuZ2V0VHJhY2tHcm91cFBhZGRpbmcoKTtcblx0XHR9XG5cdCAgICB9XG5cdCAgICByZXR1cm4gdG9wcztcblx0fSk7XG5cdHRoaXMuY2VsbF90b3BzX3pvb21lZCA9IG5ldyBDYWNoZWRQcm9wZXJ0eSh7fSwgZnVuY3Rpb24oKSB7XG5cdCAgICB2YXIgdHJhY2tfdG9wcyA9IG1vZGVsLnRyYWNrX3RvcHNfem9vbWVkLmdldCgpO1xuXHQgICAgdmFyIGNlbGxfdG9wcyA9IHt9O1xuXHQgICAgZm9yICh2YXIgayBpbiB0cmFja190b3BzKSB7XG5cdFx0aWYgKHRyYWNrX3RvcHMuaGFzT3duUHJvcGVydHkoaykpIHtcblx0XHQgICAgY2VsbF90b3BzW2tdID0gdHJhY2tfdG9wc1trXSArIG1vZGVsLmdldFRyYWNrUGFkZGluZyhrKTtcblx0XHR9XG5cdCAgICB9XG5cdCAgICByZXR1cm4gY2VsbF90b3BzO1xuXHR9KTtcblx0dGhpcy5sYWJlbF90b3BzX3pvb21lZCA9IG5ldyBDYWNoZWRQcm9wZXJ0eSh7fSwgZnVuY3Rpb24oKSB7XG5cdCAgICByZXR1cm4gbW9kZWwuY2VsbF90b3BzX3pvb21lZC5nZXQoKTtcblx0fSk7XG5cdFxuXHR0aGlzLnRyYWNrX3RvcHMuYWRkQm91bmRQcm9wZXJ0eSh0aGlzLnRyYWNrX3RvcHNfem9vbWVkKTtcblx0dGhpcy50cmFja190b3BzX3pvb21lZC5hZGRCb3VuZFByb3BlcnR5KHRoaXMuY2VsbF90b3BzX3pvb21lZCk7XG5cdHRoaXMuY2VsbF90b3BzX3pvb21lZC5hZGRCb3VuZFByb3BlcnR5KHRoaXMubGFiZWxfdG9wc196b29tZWQpO1xuXHRcblx0dGhpcy5jb2x1bW5fbGVmdCA9IG5ldyBDYWNoZWRQcm9wZXJ0eSh7fSwgZnVuY3Rpb24oKSB7XG5cdCAgICB2YXIgY2VsbF93aWR0aCA9IG1vZGVsLmdldENlbGxXaWR0aCh0cnVlKTtcblx0ICAgIHZhciBjZWxsX3BhZGRpbmcgPSBtb2RlbC5nZXRDZWxsUGFkZGluZyh0cnVlKTtcblx0ICAgIHZhciBsZWZ0ID0ge307XG5cdCAgICB2YXIgaWRzID0gbW9kZWwuZ2V0SWRPcmRlcigpO1xuXHQgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBpZHMubGVuZ3RoOyBpKyspIHtcblx0XHRsZWZ0W2lkc1tpXV0gPSBpICogKGNlbGxfd2lkdGggKyBjZWxsX3BhZGRpbmcpO1xuXHQgICAgfVxuXHQgICAgcmV0dXJuIGxlZnQ7XG5cdH0pO1xuXHRcblx0dGhpcy56b29tZWRfY29sdW1uX2xlZnQgPSBuZXcgQ2FjaGVkUHJvcGVydHkoe30sIGZ1bmN0aW9uKCkge1xuXHQgICAgdmFyIGNlbGxfd2lkdGggPSBtb2RlbC5nZXRDZWxsV2lkdGgoKTtcblx0ICAgIHZhciBjZWxsX3BhZGRpbmcgPSBtb2RlbC5nZXRDZWxsUGFkZGluZygpO1xuXHQgICAgdmFyIGxlZnQgPSB7fTtcblx0ICAgIHZhciBpZHMgPSBtb2RlbC5nZXRJZE9yZGVyKCk7XG5cdCAgICBmb3IgKHZhciBpID0gMDsgaSA8IGlkcy5sZW5ndGg7IGkrKykge1xuXHRcdGxlZnRbaWRzW2ldXSA9IGkgKiAoY2VsbF93aWR0aCArIGNlbGxfcGFkZGluZyk7XG5cdCAgICB9XG5cdCAgICByZXR1cm4gbGVmdDtcblx0fSk7XG5cdHRoaXMuY29sdW1uX2xlZnRfbm9fcGFkZGluZyA9IG5ldyBDYWNoZWRQcm9wZXJ0eSh7fSwgZnVuY3Rpb24oKSB7XG5cdCAgICB2YXIgY2VsbF93aWR0aCA9IG1vZGVsLmdldENlbGxXaWR0aCh0cnVlKTtcblx0ICAgIHZhciBsZWZ0ID0ge307XG5cdCAgICB2YXIgaWRzID0gbW9kZWwuZ2V0SWRPcmRlcigpO1xuXHQgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBpZHMubGVuZ3RoOyBpKyspIHtcblx0XHRsZWZ0W2lkc1tpXV0gPSBpICogY2VsbF93aWR0aDtcblx0ICAgIH1cblx0ICAgIHJldHVybiBsZWZ0O1xuXHR9KTtcblx0dGhpcy5jb2x1bW5fbGVmdC5hZGRCb3VuZFByb3BlcnR5KHRoaXMuem9vbWVkX2NvbHVtbl9sZWZ0KTtcblx0dGhpcy5jb2x1bW5fbGVmdC5hZGRCb3VuZFByb3BlcnR5KHRoaXMuY29sdW1uX2xlZnRfbm9fcGFkZGluZyk7XG5cdFxuXHR0aGlzLnByZWNvbXB1dGVkX2NvbXBhcmF0b3IgPSBuZXcgQ2FjaGVkUHJvcGVydHkoe30sIGZ1bmN0aW9uKG1vZGVsLCB0cmFja19pZCkge1xuXHQgICAgdmFyIGN1cnJfcHJlY29tcHV0ZWRfY29tcGFyYXRvciA9IG1vZGVsLnByZWNvbXB1dGVkX2NvbXBhcmF0b3IuZ2V0KCk7XG5cdCAgICBjdXJyX3ByZWNvbXB1dGVkX2NvbXBhcmF0b3JbdHJhY2tfaWRdID0gbmV3IFByZWNvbXB1dGVkQ29tcGFyYXRvcihtb2RlbC5nZXRUcmFja0RhdGEodHJhY2tfaWQpLFxuXHRcdFx0XHRcdFx0XHRcdFx0ICAgIG1vZGVsLmdldFRyYWNrU29ydENvbXBhcmF0b3IodHJhY2tfaWQpLFxuXHRcdFx0XHRcdFx0XHRcdFx0ICAgIG1vZGVsLmdldFRyYWNrU29ydERpcmVjdGlvbih0cmFja19pZCksXG5cdFx0XHRcdFx0XHRcdFx0XHQgICAgbW9kZWwuZ2V0VHJhY2tEYXRhSWRLZXkodHJhY2tfaWQpKTtcblx0ICAgIHJldHVybiBjdXJyX3ByZWNvbXB1dGVkX2NvbXBhcmF0b3I7XG5cdH0pOy8vIHRyYWNrX2lkIC0+IFByZWNvbXB1dGVkQ29tcGFyYXRvclxuICAgIH1cblxuICAgIE9uY29wcmludE1vZGVsLnByb3RvdHlwZS50b2dnbGVDZWxsUGFkZGluZyA9IGZ1bmN0aW9uICgpIHtcblx0dGhpcy5jZWxsX3BhZGRpbmdfb24gPSAhdGhpcy5jZWxsX3BhZGRpbmdfb247XG5cdHRoaXMuY29sdW1uX2xlZnQudXBkYXRlKCk7XG5cdHJldHVybiB0aGlzLmNlbGxfcGFkZGluZ19vbjtcbiAgICB9XG5cbiAgICBPbmNvcHJpbnRNb2RlbC5wcm90b3R5cGUuZ2V0Q2VsbFBhZGRpbmcgPSBmdW5jdGlvbiAoYmFzZSwgZG9udF9jb25zaWRlcl96b29tKSB7XG5cdHJldHVybiAodGhpcy5jZWxsX3BhZGRpbmcgKiAoYmFzZSA/IDEgOiB0aGlzLmhvcnpfem9vbSkpICogKCt0aGlzLmNlbGxfcGFkZGluZ19vbikgKiAoZG9udF9jb25zaWRlcl96b29tID8gMSA6ICsoIXRoaXMuY2VsbF9wYWRkaW5nX29mZl9iZWNhdXNlX29mX3pvb20pKTtcbiAgICB9XG5cbiAgICBPbmNvcHJpbnRNb2RlbC5wcm90b3R5cGUuZ2V0SG9yelpvb20gPSBmdW5jdGlvbiAoKSB7XG5cdHJldHVybiB0aGlzLmhvcnpfem9vbTtcbiAgICB9XG5cbiAgICBPbmNvcHJpbnRNb2RlbC5wcm90b3R5cGUuZ2V0SG9yelpvb21Ub0ZpdE51bUNvbHMgPSBmdW5jdGlvbih3aWR0aCwgbnVtX2NvbHMpIHtcblx0dmFyIGNlbGxfd2lkdGggPSB0aGlzLmdldENlbGxXaWR0aCh0cnVlKTtcblx0dmFyIHpvb21faWZfY2VsbF9wYWRkaW5nX29uID0gY2xhbXAod2lkdGggLyAobnVtX2NvbHMqKGNlbGxfd2lkdGggKyB0aGlzLmNlbGxfcGFkZGluZykpLFxuXHRcdFx0XHRcdCAgICAwLDEpO1xuXHR2YXIgem9vbV9pZl9jZWxsX3BhZGRpbmdfb2ZmID0gY2xhbXAod2lkdGggLyAobnVtX2NvbHMqY2VsbF93aWR0aCksXG5cdFx0XHRcdFx0ICAgIDAsMSk7XG5cdHZhciB6b29tO1xuXHRpZiAoIXRoaXMuY2VsbF9wYWRkaW5nX29uKSB7XG5cdCAgICB6b29tID0gem9vbV9pZl9jZWxsX3BhZGRpbmdfb2ZmO1xuXHR9IGVsc2Uge1xuXHQgICAgaWYgKGNlbGxfd2lkdGggKiB6b29tX2lmX2NlbGxfcGFkZGluZ19vbiA8IHRoaXMuY2VsbF9wYWRkaW5nX29mZl9jZWxsX3dpZHRoX3RocmVzaG9sZCkge1xuXHRcdGlmIChjZWxsX3dpZHRoICogem9vbV9pZl9jZWxsX3BhZGRpbmdfb2ZmID49IHRoaXMuY2VsbF9wYWRkaW5nX29mZl9jZWxsX3dpZHRoX3RocmVzaG9sZCkge1xuXHRcdCAgICAvLyBCZWNhdXNlIG9mIGNlbGwgcGFkZGluZyB0b2dnbGluZyB0aGVyZSdzIG5vIHdheSB0byBnZXQgZXhhY3RseSB0aGUgZGVzaXJlZCBudW1iZXIgb2YgY29sdW1ucy5cblx0XHQgICAgLy8gV2UgY2FuIHNlZSB0aGlzIGJ5IGNvbnRyYWRpY3Rpb246IGlmIHdlIGFzc3VtZSB0aGF0IGNlbGwgcGFkZGluZyBpcyBvbiwgYW5kIHRyeSB0byBmaXQgZXhhY3RseVxuXHRcdCAgICAvLyBvdXIgbnVtYmVyIG9mIGNvbHVtbnMsIHdlIGVuZCB1cCB0dXJuaW5nIGNlbGwgcGFkZGluZyBvZmYgKG91dGVyIGlmIHN0YXRlbWVudCkuIElmIHdlIGFzc3VtZSB0aGF0XG5cdFx0ICAgIC8vIGNlbGwgcGFkZGluZyBpcyBvZmYgYW5kIHRyeSB0byBmaXQgb3VyIG51bWJlciBvZiBjb2x1bW5zLCB3ZSBmaW5kIHRoYXQgY2VsbCBwYWRkaW5nIGlzIG9uIChpbm5lciBpZiBzdGF0ZW1lbnQpLlxuXHRcdCAgICAvLyBUaHVzLCBpdCdzIGltcG9zc2libGUgdG8gc2hvdyB0aGlzIGV4YWN0IG51bWJlciBvZiBjb2x1bW5zIC0gd2UgZWl0aGVyIHVuZGVyIG9yIG92ZXJzaG9vdCBpdC4gV2Vcblx0XHQgICAgLy8gdGh1cyBzaG91bGQgb3ZlcnNob290IGl0IGJ5IGFzIGxpdHRsZSBhcyBwb3NzaWJsZSwgc2hvdyBhcyBmZXcgY29sdW1ucyBhcyBwb3NzaWJsZSB3aGlsZSBzdGlsbCBmaXR0aW5nXG5cdFx0ICAgIC8vIHRoaXMgYW1vdW50LiBJdCBtdXN0IGJlIGV4YWN0bHkgYXQgdGhlIHRocmVzaG9sZCBmb3Igc3dpdGNoaW5nLlxuXHRcdCAgICAvLyBcblx0XHQgICAgdmFyIHVucm91bmRlZF96b29tID0gdGhpcy5jZWxsX3BhZGRpbmdfb2ZmX2NlbGxfd2lkdGhfdGhyZXNob2xkIC8gY2VsbF93aWR0aDtcblx0XHQgICAgdmFyIHVucm91bmRlZF9udW1fY29scyA9IHdpZHRoIC8gKHVucm91bmRlZF96b29tICogY2VsbF93aWR0aCk7XG5cdFx0ICAgIHZhciByb3VuZGVkX251bV9jb2xzID0gTWF0aC5jZWlsKHVucm91bmRlZF9udW1fY29scyk7XG5cdFx0ICAgIHpvb20gPSB3aWR0aCAvIChyb3VuZGVkX251bV9jb2xzICogY2VsbF93aWR0aCk7XG5cdFx0fSBlbHNlIHtcblx0XHQgICAgem9vbSA9IHpvb21faWZfY2VsbF9wYWRkaW5nX29mZjtcblx0XHR9XG5cdCAgICB9IGVsc2Uge1xuXHRcdHpvb20gPSB6b29tX2lmX2NlbGxfcGFkZGluZ19vbjtcblx0ICAgIH1cblx0fVxuXHRyZXR1cm4gem9vbTtcbiAgICB9XG4gICAgT25jb3ByaW50TW9kZWwucHJvdG90eXBlLmdldEhvcnpab29tVG9GaXQgPSBmdW5jdGlvbih3aWR0aCwgaWRzKSB7XG5cdGlkcyA9IGlkcyB8fCBbXTtcblx0dmFyIGlkX3RvX2luZGV4X21hcCA9IHRoaXMuZ2V0VmlzaWJsZUlkVG9JbmRleE1hcCgpO1xuXHR2YXIgaW5kZXhlcyA9IGlkcy5tYXAoZnVuY3Rpb24oaWQpIHsgcmV0dXJuIGlkX3RvX2luZGV4X21hcFtpZF07IH0pO1xuXHR2YXIgbWF4ID0gTWF0aC5tYXguYXBwbHkobnVsbCwgaW5kZXhlcyk7XG5cdHZhciBtaW4gPSBNYXRoLm1pbi5hcHBseShudWxsLCBpbmRleGVzKTtcblx0dmFyIG51bV9jb2xzID0gbWF4IC0gbWluO1xuXHRyZXR1cm4gdGhpcy5nZXRIb3J6Wm9vbVRvRml0TnVtQ29scyh3aWR0aCwgbnVtX2NvbHMpO1xuICAgIH1cbiAgICBcbiAgICBPbmNvcHJpbnRNb2RlbC5wcm90b3R5cGUuZ2V0TWluSG9yelpvb20gPSBmdW5jdGlvbigpIHtcblx0cmV0dXJuIE1hdGgubWluKE1JTl9aT09NX1BJWEVMUyAvICh0aGlzLmdldElkT3JkZXIoKS5sZW5ndGgqdGhpcy5nZXRDZWxsV2lkdGgodHJ1ZSkgKyAodGhpcy5nZXRJZE9yZGVyKCkubGVuZ3RoLTEpKnRoaXMuZ2V0Q2VsbFBhZGRpbmcodHJ1ZSkpLCAxKTtcbiAgICB9XG4gICAgXG4gICAgT25jb3ByaW50TW9kZWwucHJvdG90eXBlLmdldE1pblZlcnRab29tID0gZnVuY3Rpb24oKSB7XG5cdC8vIENhbid0IHpvb20gdG8gYmUgc21hbGxlciB0aGFuIG1heCBoZWlnaHRcblx0Ly8gVGhhdCB6b29tIHdvdWxkIGJlIHoqdGhpcy5nZXRPbmNvcHJpbnRIZWlnaHQodHJ1ZSkgPSBtYXhfaGVpZ2h0XG5cdHJldHVybiB0aGlzLm1heF9oZWlnaHQgLyB0aGlzLmdldE9uY29wcmludEhlaWdodCh0cnVlKTtcbiAgICB9XG4gICAgXG4gICAgT25jb3ByaW50TW9kZWwucHJvdG90eXBlLnNldEhvcnpTY3JvbGwgPSBmdW5jdGlvbihzKSB7XG5cdHRoaXMuaG9yel9zY3JvbGwgPSBNYXRoLm1heCgwLCBzKTtcblx0cmV0dXJuIHRoaXMuaG9yel9zY3JvbGw7XG4gICAgfVxuICAgIE9uY29wcmludE1vZGVsLnByb3RvdHlwZS5zZXRWZXJ0U2Nyb2xsID0gZnVuY3Rpb24ocykge1xuXHR0aGlzLnZlcnRfc2Nyb2xsID0gTWF0aC5tYXgoMCwgcyk7XG5cdHJldHVybiB0aGlzLnZlcnRfc2Nyb2xsO1xuICAgIH1cbiAgICBPbmNvcHJpbnRNb2RlbC5wcm90b3R5cGUuc2V0U2Nyb2xsID0gZnVuY3Rpb24oaCwgdikge1xuXHR0aGlzLnNldEhvcnpTY3JvbGwoaCk7XG5cdHRoaXMuc2V0VmVydFNjcm9sbCh2KTtcbiAgICB9XG4gICAgT25jb3ByaW50TW9kZWwucHJvdG90eXBlLmdldEhvcnpTY3JvbGwgPSBmdW5jdGlvbigpIHtcblx0cmV0dXJuIHRoaXMuaG9yel9zY3JvbGw7XG4gICAgfVxuICAgIE9uY29wcmludE1vZGVsLnByb3RvdHlwZS5nZXRWZXJ0U2Nyb2xsID0gZnVuY3Rpb24oKSB7XG5cdHJldHVybiB0aGlzLnZlcnRfc2Nyb2xsO1xuICAgIH1cbiAgICBPbmNvcHJpbnRNb2RlbC5wcm90b3R5cGUuc2V0Wm9vbSA9IGZ1bmN0aW9uKHpvb21feCwgem9vbV95KSB7XG5cdHRoaXMuc2V0SG9yelpvb20oem9vbV94KTtcblx0dGhpcy5zZXRWZXJ0Wm9vbSh6b29tX3kpO1xuICAgIH1cbiAgICB2YXIgc2V0Q2VsbFBhZGRpbmdPZmZCZWNhdXNlT2Zab29tID0gZnVuY3Rpb24obW9kZWwsIHZhbCkge1xuXHRtb2RlbC5jZWxsX3BhZGRpbmdfb2ZmX2JlY2F1c2Vfb2Zfem9vbSA9IHZhbDtcblx0bW9kZWwuY29sdW1uX2xlZnQudXBkYXRlKCk7XG4gICAgfTtcbiAgICBPbmNvcHJpbnRNb2RlbC5wcm90b3R5cGUuc2V0SG9yelpvb20gPSBmdW5jdGlvbiAoeikge1xuXHR2YXIgbWluX3pvb20gPSB0aGlzLmdldE1pbkhvcnpab29tKCk7XG5cdHRoaXMuaG9yel96b29tID0gY2xhbXAoeiwgbWluX3pvb20sIDEpO1xuXHR0aGlzLmNvbHVtbl9sZWZ0LnVwZGF0ZSgpO1xuXHRcblx0aWYgKHRoaXMuZ2V0Q2VsbFdpZHRoKCkgPCB0aGlzLmNlbGxfcGFkZGluZ19vZmZfY2VsbF93aWR0aF90aHJlc2hvbGQgJiYgIXRoaXMuY2VsbF9wYWRkaW5nX29mZl9iZWNhdXNlX29mX3pvb20pIHtcblx0ICAgIHNldENlbGxQYWRkaW5nT2ZmQmVjYXVzZU9mWm9vbSh0aGlzLCB0cnVlKTtcblx0fSBlbHNlIGlmICh0aGlzLmdldENlbGxXaWR0aCgpID49IHRoaXMuY2VsbF9wYWRkaW5nX29mZl9jZWxsX3dpZHRoX3RocmVzaG9sZCAmJiB0aGlzLmNlbGxfcGFkZGluZ19vZmZfYmVjYXVzZV9vZl96b29tKSB7XG5cdCAgICBzZXRDZWxsUGFkZGluZ09mZkJlY2F1c2VPZlpvb20odGhpcywgZmFsc2UpO1xuXHR9XG5cdHJldHVybiB0aGlzLmhvcnpfem9vbTtcbiAgICB9XG4gICAgXG4gICAgXG4gICAgT25jb3ByaW50TW9kZWwucHJvdG90eXBlLmdldFZlcnRab29tID0gZnVuY3Rpb24oKSB7XG5cdHJldHVybiB0aGlzLnZlcnRfem9vbTtcbiAgICB9XG4gICAgXG4gICAgT25jb3ByaW50TW9kZWwucHJvdG90eXBlLnNldFZlcnRab29tID0gZnVuY3Rpb24gKHopIHtcblx0dmFyIG1pbl96b29tID0gdGhpcy5nZXRNaW5WZXJ0Wm9vbSgpO1xuXHR0aGlzLnZlcnRfem9vbSA9IGNsYW1wKHosIG1pbl96b29tLCAxKTtcblx0dGhpcy50cmFja190b3BzLnVwZGF0ZSgpO1xuXHRyZXR1cm4gdGhpcy52ZXJ0X3pvb207XG4gICAgfVxuXG4gICAgT25jb3ByaW50TW9kZWwucHJvdG90eXBlLmhpZGVUcmFja0xlZ2VuZHMgPSBmdW5jdGlvbih0cmFja19pZHMpIHtcblx0dHJhY2tfaWRzID0gW10uY29uY2F0KHRyYWNrX2lkcyk7XG5cdGZvciAodmFyIGk9MDsgaTx0cmFja19pZHMubGVuZ3RoOyBpKyspIHtcblx0ICAgIHRoaXMuZ2V0UnVsZVNldCh0cmFja19pZHNbaV0pLmV4Y2x1ZGVfZnJvbV9sZWdlbmQgPSB0cnVlO1xuXHR9XG4gICAgfVxuICAgIFxuICAgIE9uY29wcmludE1vZGVsLnByb3RvdHlwZS5zaG93VHJhY2tMZWdlbmRzID0gZnVuY3Rpb24odHJhY2tfaWRzKSB7XG5cdHRyYWNrX2lkcyA9IFtdLmNvbmNhdCh0cmFja19pZHMpO1xuXHRmb3IgKHZhciBpPTA7IGk8dHJhY2tfaWRzLmxlbmd0aDsgaSsrKSB7XG5cdCAgICB0aGlzLmdldFJ1bGVTZXQodHJhY2tfaWRzW2ldKS5leGNsdWRlX2Zyb21fbGVnZW5kID0gZmFsc2U7XG5cdH1cbiAgICB9XG5cbiAgICBPbmNvcHJpbnRNb2RlbC5wcm90b3R5cGUuZ2V0SWRlbnRpZmllZFNoYXBlTGlzdExpc3QgPSBmdW5jdGlvbih0cmFja19pZCwgdXNlX2Jhc2Vfc2l6ZSwgc29ydF9ieV96KSB7XG5cdHZhciBhY3RpdmVfcnVsZXMgPSB7fTtcblx0dmFyIGRhdGEgPSB0aGlzLmdldFRyYWNrRGF0YSh0cmFja19pZCk7XG5cdHZhciBpZF9rZXkgPSB0aGlzLmdldFRyYWNrRGF0YUlkS2V5KHRyYWNrX2lkKTtcblx0dmFyIHNwYWNpbmcgPSB0aGlzLmdldFRyYWNrSGFzQ29sdW1uU3BhY2luZyh0cmFja19pZCk7XG5cdHZhciB3aWR0aCA9IHRoaXMuZ2V0Q2VsbFdpZHRoKHVzZV9iYXNlX3NpemUpICsgKCFzcGFjaW5nID8gdGhpcy5nZXRDZWxsUGFkZGluZyh1c2VfYmFzZV9zaXplKSA6IDApO1xuXHR2YXIgc2hhcGVzID0gdGhpcy5nZXRSdWxlU2V0KHRyYWNrX2lkKS5hcHBseShkYXRhLCB3aWR0aCwgdGhpcy5nZXRDZWxsSGVpZ2h0KHRyYWNrX2lkLCB1c2VfYmFzZV9zaXplKSwgYWN0aXZlX3J1bGVzKTtcblx0dGhpcy50cmFja19hY3RpdmVfcnVsZXNbdHJhY2tfaWRdID0gYWN0aXZlX3J1bGVzO1xuXHRcblx0dmFyIHpfY29tcGFyYXRvciA9IGZ1bmN0aW9uKHNoYXBlQSwgc2hhcGVCKSB7XG5cdCAgICB2YXIgekEgPSBwYXJzZUZsb2F0KHNoYXBlQS56KTtcblx0ICAgIHZhciB6QiA9IHBhcnNlRmxvYXQoc2hhcGVCLnopO1xuXHQgICAgaWYgKHpBIDwgekIpIHtcblx0XHRyZXR1cm4gLTE7XG5cdCAgICB9IGVsc2UgaWYgKHpBID4gekIpIHtcblx0XHRyZXR1cm4gMTtcblx0ICAgIH0gZWxzZSB7XG5cdFx0cmV0dXJuIDA7XG5cdCAgICB9XG5cdH07XG5cdHJldHVybiBzaGFwZXMubWFwKGZ1bmN0aW9uKHNoYXBlX2xpc3QsIGluZGV4KSB7XG5cdCAgICBpZiAoc29ydF9ieV96KSB7XG5cdFx0c2hhcGVfbGlzdC5zb3J0KHpfY29tcGFyYXRvcik7XG5cdCAgICB9XG5cdCAgICByZXR1cm4ge1xuXHRcdGlkOiBkYXRhW2luZGV4XVtpZF9rZXldLFxuXHRcdHNoYXBlX2xpc3Q6IHNoYXBlX2xpc3Rcblx0ICAgIH07XG5cdH0pO1xuICAgIH1cbiAgICBcbiAgICBPbmNvcHJpbnRNb2RlbC5wcm90b3R5cGUuZ2V0QWN0aXZlUnVsZXMgPSBmdW5jdGlvbihydWxlX3NldF9pZCkge1xuXHR2YXIgbGlzdF9vZl9hY3RpdmVfcnVsZXNfbWFwcyA9IFtdO1xuXHRmb3IgKHZhciB0cmFja19pZCBpbiB0aGlzLnRyYWNrX3J1bGVfc2V0X2lkKSB7XG5cdCAgICBpZiAodGhpcy50cmFja19ydWxlX3NldF9pZC5oYXNPd25Qcm9wZXJ0eSh0cmFja19pZCkgJiYgdGhpcy50cmFja19ydWxlX3NldF9pZFt0cmFja19pZF0gPT09IHJ1bGVfc2V0X2lkKSB7XG5cdFx0bGlzdF9vZl9hY3RpdmVfcnVsZXNfbWFwcy5wdXNoKHRoaXMudHJhY2tfYWN0aXZlX3J1bGVzW3RyYWNrX2lkXSk7XG5cdCAgICB9XG5cdH1cblx0dmFyIGFjdGl2ZV9ydWxlcyA9IHNldFVuaW9uKGxpc3Rfb2ZfYWN0aXZlX3J1bGVzX21hcHMpO1xuXHRyZXR1cm4gdGhpcy5ydWxlX3NldHNbcnVsZV9zZXRfaWRdLmdldFJ1bGVzV2l0aElkKCkuZmlsdGVyKGZ1bmN0aW9uKHJ1bGVfd2l0aF9pZCkge1xuXHQgICAgcmV0dXJuICEhYWN0aXZlX3J1bGVzW3J1bGVfd2l0aF9pZC5pZF07XG5cdH0pO1xuICAgIH1cbiAgICBcbiAgICBPbmNvcHJpbnRNb2RlbC5wcm90b3R5cGUuZ2V0UnVsZVNldHMgPSBmdW5jdGlvbigpIHtcblx0Ly8gcmV0dXJuIHJ1bGUgc2V0cywgc29ydGVkIGJ5IGFzc29jaWF0aW5nIGVhY2ggd2l0aCB0aGUgbG93ZXN0IHRyYWNrIGlkIGl0cyBvblxuXHR2YXIgc2VsZiA9IHRoaXM7XG5cdHZhciBzb3J0ZWRfdHJhY2tzID0gdGhpcy5nZXRUcmFja3MoKS5zb3J0KCk7XG5cdHZhciBydWxlX3NldF9pZHMgPSBzb3J0ZWRfdHJhY2tzLm1hcChmdW5jdGlvbih0cmFja19pZCkge1xuXHQgICAgcmV0dXJuIHNlbGYudHJhY2tfcnVsZV9zZXRfaWRbdHJhY2tfaWRdO1xuXHR9KTtcblx0dmFyIHVuaXF1ZV9ydWxlX3NldF9pZHMgPSBhcnJheVVuaXF1ZShydWxlX3NldF9pZHMpO1xuXHRyZXR1cm4gdW5pcXVlX3J1bGVfc2V0X2lkcy5tYXAoZnVuY3Rpb24ocnVsZV9zZXRfaWQpIHtcblx0ICAgIHJldHVybiBzZWxmLnJ1bGVfc2V0c1tydWxlX3NldF9pZF07XG5cdH0pO1xuICAgIH1cblxuICAgIE9uY29wcmludE1vZGVsLnByb3RvdHlwZS5nZXRUcmFja0hhc0NvbHVtblNwYWNpbmcgPSBmdW5jdGlvbih0cmFja19pZCkge1xuXHRyZXR1cm4gISEodGhpcy50cmFja19oYXNfY29sdW1uX3NwYWNpbmdbdHJhY2tfaWRdKTtcbiAgICB9XG4gICAgXG4gICAgT25jb3ByaW50TW9kZWwucHJvdG90eXBlLmdldENlbGxXaWR0aCA9IGZ1bmN0aW9uIChiYXNlKSB7XG5cdHJldHVybiB0aGlzLmNlbGxfd2lkdGggKiAoYmFzZSA/IDEgOiB0aGlzLmhvcnpfem9vbSk7XG4gICAgfVxuXG4gICAgT25jb3ByaW50TW9kZWwucHJvdG90eXBlLmdldENlbGxIZWlnaHQgPSBmdW5jdGlvbiAodHJhY2tfaWQsIGJhc2UpIHtcblx0cmV0dXJuIHRoaXMuY2VsbF9oZWlnaHRbdHJhY2tfaWRdICogKGJhc2UgPyAxIDogdGhpcy52ZXJ0X3pvb20pO1xuICAgIH1cbiAgICBcbiAgICBPbmNvcHJpbnRNb2RlbC5wcm90b3R5cGUuZ2V0VHJhY2tJbmZvID0gZnVuY3Rpb24odHJhY2tfaWQpIHtcblx0cmV0dXJuIHRoaXMudHJhY2tfaW5mb1t0cmFja19pZF07XG4gICAgfVxuICAgIFxuICAgIE9uY29wcmludE1vZGVsLnByb3RvdHlwZS5zZXRUcmFja0luZm8gPSBmdW5jdGlvbih0cmFja19pZCwgbXNnKSB7XG5cdHRoaXMudHJhY2tfaW5mb1t0cmFja19pZF0gPSBtc2c7XG4gICAgfVxuICAgIFxuICAgIE9uY29wcmludE1vZGVsLnByb3RvdHlwZS5nZXRUcmFja0hlaWdodCA9IGZ1bmN0aW9uKHRyYWNrX2lkLCBiYXNlKSB7XG5cdHJldHVybiB0aGlzLmdldENlbGxIZWlnaHQodHJhY2tfaWQsIGJhc2UpICsgMip0aGlzLmdldFRyYWNrUGFkZGluZyh0cmFja19pZCwgYmFzZSk7XG4gICAgfVxuXG4gICAgT25jb3ByaW50TW9kZWwucHJvdG90eXBlLmdldFRyYWNrUGFkZGluZyA9IGZ1bmN0aW9uICh0cmFja19pZCwgYmFzZSkge1xuXHRyZXR1cm4gdGhpcy50cmFja19wYWRkaW5nW3RyYWNrX2lkXSAqIChiYXNlID8gMSA6IHRoaXMudmVydF96b29tKTtcbiAgICB9XG4gICAgT25jb3ByaW50TW9kZWwucHJvdG90eXBlLmdldEJvdHRvbVBhZGRpbmcgPSBmdW5jdGlvbigpIHtcblx0cmV0dXJuIHRoaXMuYm90dG9tX3BhZGRpbmc7XG4gICAgfVxuICAgIE9uY29wcmludE1vZGVsLnByb3RvdHlwZS5nZXRUcmFja1NvcnREaXJlY3Rpb24gPSBmdW5jdGlvbih0cmFja19pZCkge1xuXHRyZXR1cm4gdGhpcy50cmFja19zb3J0X2RpcmVjdGlvblt0cmFja19pZF07XG4gICAgfVxuICAgIE9uY29wcmludE1vZGVsLnByb3RvdHlwZS5zZXRUcmFja1NvcnREaXJlY3Rpb24gPSBmdW5jdGlvbih0cmFja19pZCwgZGlyKSB7XG5cdC8vIHNlZSBhYm92ZSBmb3IgZGlyIG9wdGlvbnNcblx0dGhpcy50cmFja19zb3J0X2RpcmVjdGlvblt0cmFja19pZF0gPSBkaXI7XG5cdHRoaXMucHJlY29tcHV0ZWRfY29tcGFyYXRvci51cGRhdGUodGhpcywgdHJhY2tfaWQpO1xuICAgIH1cbiAgICBcbiAgICBPbmNvcHJpbnRNb2RlbC5wcm90b3R5cGUuc2V0Q2VsbFBhZGRpbmdPbiA9IGZ1bmN0aW9uKGNlbGxfcGFkZGluZ19vbikge1xuXHR0aGlzLmNlbGxfcGFkZGluZ19vbiA9IGNlbGxfcGFkZGluZ19vbjtcblx0dGhpcy5jb2x1bW5fbGVmdC51cGRhdGUoKTtcbiAgICB9XG4gICAgT25jb3ByaW50TW9kZWwucHJvdG90eXBlLmdldElkT3JkZXIgPSBmdW5jdGlvbiAoYWxsKSB7XG5cdGlmIChhbGwpIHtcblx0ICAgIHJldHVybiB0aGlzLmlkX29yZGVyOyAvLyBUT0RPOiBzaG91bGQgYmUgcmVhZC1vbmx5XG5cdH0gZWxzZSB7XG5cdCAgICByZXR1cm4gdGhpcy52aXNpYmxlX2lkX29yZGVyLmdldCgpO1xuXHR9XG4gICAgfVxuICAgIE9uY29wcmludE1vZGVsLnByb3RvdHlwZS5nZXRJZFRvSW5kZXhNYXAgPSBmdW5jdGlvbigpIHtcblx0cmV0dXJuIHRoaXMuaWRfdG9faW5kZXguZ2V0KCk7XG4gICAgfVxuICAgIE9uY29wcmludE1vZGVsLnByb3RvdHlwZS5nZXRWaXNpYmxlSWRUb0luZGV4TWFwID0gZnVuY3Rpb24oKSB7XG5cdHJldHVybiB0aGlzLnZpc2libGVfaWRfdG9faW5kZXguZ2V0KCk7XG4gICAgfVxuXG4gICAgT25jb3ByaW50TW9kZWwucHJvdG90eXBlLmdldEhpZGRlbklkcyA9IGZ1bmN0aW9uICgpIHtcblx0dmFyIGhpZGRlbl9pZHMgPSB0aGlzLmhpZGRlbl9pZHM7XG5cdHJldHVybiB0aGlzLmlkX29yZGVyLmZpbHRlcihmdW5jdGlvbiAoaWQpIHtcblx0ICAgIHJldHVybiAhIWhpZGRlbl9pZHNbaWRdO1xuXHR9KTtcbiAgICB9XG5cbiAgICBPbmNvcHJpbnRNb2RlbC5wcm90b3R5cGUuc2V0SWRPcmRlciA9IGZ1bmN0aW9uIChpZHMpIHtcblx0dGhpcy5pZF9vcmRlciA9IGlkcy5zbGljZSgpO1xuXHRPYmplY3QuZnJlZXplKHRoaXMuaWRfb3JkZXIpO1xuXHR0aGlzLmlkX3RvX2luZGV4LnVwZGF0ZSgpO1xuXHR0aGlzLnZpc2libGVfaWRfb3JkZXIudXBkYXRlKCk7XG5cdHRoaXMuY29sdW1uX2xlZnQudXBkYXRlKCk7XG4gICAgfVxuXG4gICAgT25jb3ByaW50TW9kZWwucHJvdG90eXBlLmhpZGVJZHMgPSBmdW5jdGlvbiAodG9faGlkZSwgc2hvd19vdGhlcnMpIHtcblx0aWYgKHNob3dfb3RoZXJzKSB7XG5cdCAgICB0aGlzLmhpZGRlbl9pZHMgPSB7fTtcblx0fVxuXHRmb3IgKHZhciBqID0gMCwgbGVuID0gdG9faGlkZS5sZW5ndGg7IGogPCBsZW47IGorKykge1xuXHQgICAgdGhpcy5oaWRkZW5faWRzW3RvX2hpZGVbal1dID0gdHJ1ZTtcblx0fVxuXHR0aGlzLnZpc2libGVfaWRfb3JkZXIudXBkYXRlKCk7XG5cdHRoaXMuY29sdW1uX2xlZnQudXBkYXRlKCk7XG4gICAgfVxuXG4gICAgT25jb3ByaW50TW9kZWwucHJvdG90eXBlLnNldFRyYWNrR3JvdXBPcmRlciA9IGZ1bmN0aW9uKGluZGV4LCB0cmFja19vcmRlcikge1xuXHR0aGlzLnRyYWNrX2dyb3Vwc1tpbmRleF0gPSB0cmFja19vcmRlcjtcblx0XG5cdHRoaXMudHJhY2tfdG9wcy51cGRhdGUoKTtcbiAgICB9XG4gICAgXG4gICAgT25jb3ByaW50TW9kZWwucHJvdG90eXBlLm1vdmVUcmFja0dyb3VwID0gZnVuY3Rpb24gKGZyb21faW5kZXgsIHRvX2luZGV4KSB7XG5cdHZhciBuZXdfZ3JvdXBzID0gW107XG5cdHZhciBuZXdfaGVhZGVycyA9IFtdO1xuXHR2YXIgZ3JvdXBfdG9fbW92ZSA9IHRoaXMudHJhY2tfZ3JvdXBzW2Zyb21faW5kZXhdO1xuXHRmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMudHJhY2tfZ3JvdXBzLmxlbmd0aDsgaSsrKSB7XG5cdCAgICBpZiAoaSAhPT0gZnJvbV9pbmRleCAmJiBpICE9PSB0b19pbmRleCkge1xuXHRcdG5ld19ncm91cHMucHVzaCh0aGlzLnRyYWNrX2dyb3Vwc1tpXSk7XG5cdFx0bmV3X2hlYWRlcnMucHVzaCh0aGlzLnRyYWNrX2dyb3VwX2hlYWRlcltpXSk7XG5cdCAgICB9XG5cdCAgICBpZiAoaSA9PT0gdG9faW5kZXgpIHtcblx0XHRuZXdfZ3JvdXBzLnB1c2goZ3JvdXBfdG9fbW92ZSk7XG5cdFx0bmV3X2hlYWRlcnMucHVzaCh0aGlzLnRyYWNrX2dyb3VwX2hlYWRlcltmcm9tX2luZGV4XSk7XG5cdCAgICB9XG5cdH1cblx0dGhpcy50cmFja19ncm91cHMgPSBuZXdfZ3JvdXBzO1xuXHR0aGlzLnRyYWNrX2dyb3VwX2hlYWRlciA9IG5ld19oZWFkZXJzO1xuXHR0aGlzLnRyYWNrX3RvcHMudXBkYXRlKCk7XG5cdHJldHVybiB0aGlzLnRyYWNrX2dyb3VwcztcbiAgICB9XG5cbiAgICBPbmNvcHJpbnRNb2RlbC5wcm90b3R5cGUuYWRkVHJhY2tzID0gZnVuY3Rpb24gKHBhcmFtc19saXN0KSB7XG5cdGZvciAodmFyIGkgPSAwOyBpIDwgcGFyYW1zX2xpc3QubGVuZ3RoOyBpKyspIHtcblx0ICAgIHZhciBwYXJhbXMgPSBwYXJhbXNfbGlzdFtpXTtcblx0ICAgIGFkZFRyYWNrKHRoaXMsIHBhcmFtcy50cmFja19pZCwgcGFyYW1zLnRhcmdldF9ncm91cCwgcGFyYW1zLnRyYWNrX2dyb3VwX2hlYWRlcixcblx0XHQgICAgcGFyYW1zLmNlbGxfaGVpZ2h0LCBwYXJhbXMudHJhY2tfcGFkZGluZywgcGFyYW1zLmhhc19jb2x1bW5fc3BhY2luZyxcblx0XHQgICAgcGFyYW1zLmRhdGFfaWRfa2V5LCBwYXJhbXMudG9vbHRpcEZuLFxuXHRcdCAgICBwYXJhbXMucmVtb3ZhYmxlLCBwYXJhbXMucmVtb3ZlQ2FsbGJhY2ssIHBhcmFtcy5sYWJlbCwgcGFyYW1zLmRlc2NyaXB0aW9uLCBwYXJhbXMudHJhY2tfaW5mbyxcblx0XHQgICAgcGFyYW1zLnNvcnRDbXBGbiwgcGFyYW1zLnNvcnRfZGlyZWN0aW9uX2NoYW5nZWFibGUsIHBhcmFtcy5pbml0X3NvcnRfZGlyZWN0aW9uLFxuXHRcdCAgICBwYXJhbXMuZGF0YSwgcGFyYW1zLnJ1bGVfc2V0LCBwYXJhbXMuZXhwYW5zaW9uX29mLCBwYXJhbXMuZXhwYW5zaW9uSW5pdENhbGxiYWNrKTtcblx0fVxuXHR0aGlzLnRyYWNrX3RvcHMudXBkYXRlKCk7XG4gICAgfVxuICBcbiAgICB2YXIgYWRkVHJhY2sgPSBmdW5jdGlvbiAobW9kZWwsIHRyYWNrX2lkLCB0YXJnZXRfZ3JvdXAsIHRyYWNrX2dyb3VwX2hlYWRlcixcblx0ICAgIGNlbGxfaGVpZ2h0LCB0cmFja19wYWRkaW5nLCBoYXNfY29sdW1uX3NwYWNpbmcsXG5cdCAgICBkYXRhX2lkX2tleSwgdG9vbHRpcEZuLFxuXHQgICAgcmVtb3ZhYmxlLCByZW1vdmVDYWxsYmFjaywgbGFiZWwsIGRlc2NyaXB0aW9uLCB0cmFja19pbmZvLFxuXHQgICAgc29ydENtcEZuLCBzb3J0X2RpcmVjdGlvbl9jaGFuZ2VhYmxlLCBpbml0X3NvcnRfZGlyZWN0aW9uLFxuXHQgICAgZGF0YSwgcnVsZV9zZXQsIGV4cGFuc2lvbl9vZiwgZXhwYW5zaW9uSW5pdENhbGxiYWNrKSB7XG5cdG1vZGVsLnRyYWNrX2xhYmVsW3RyYWNrX2lkXSA9IGlmbmRlZihsYWJlbCwgXCJMYWJlbFwiKTtcblx0bW9kZWwudHJhY2tfZGVzY3JpcHRpb25bdHJhY2tfaWRdID0gaWZuZGVmKGRlc2NyaXB0aW9uLCBcIlwiKTtcblx0bW9kZWwuY2VsbF9oZWlnaHRbdHJhY2tfaWRdID0gaWZuZGVmKGNlbGxfaGVpZ2h0LCAyMyk7XG5cdG1vZGVsLnRyYWNrX3BhZGRpbmdbdHJhY2tfaWRdID0gaWZuZGVmKHRyYWNrX3BhZGRpbmcsIDUpO1xuXHRtb2RlbC50cmFja19oYXNfY29sdW1uX3NwYWNpbmdbdHJhY2tfaWRdID0gaWZuZGVmKGhhc19jb2x1bW5fc3BhY2luZywgdHJ1ZSk7XG5cblx0bW9kZWwudHJhY2tfdG9vbHRpcF9mblt0cmFja19pZF0gPSBpZm5kZWYodG9vbHRpcEZuLCBmdW5jdGlvbiAoZCkge1xuXHQgICAgcmV0dXJuIGQgKyAnJztcblx0fSk7XG5cdG1vZGVsLnRyYWNrX3JlbW92YWJsZVt0cmFja19pZF0gPSBpZm5kZWYocmVtb3ZhYmxlLCBmYWxzZSk7XG5cdG1vZGVsLnRyYWNrX3JlbW92ZV9jYWxsYmFja1t0cmFja19pZF0gPSBpZm5kZWYocmVtb3ZlQ2FsbGJhY2ssIGZ1bmN0aW9uKCkge30pO1xuXHRcblx0aWYgKHR5cGVvZiBleHBhbnNpb25fb2YgIT09ICd1bmRlZmluZWQnKSB7XG5cdCAgICBpZiAoIW1vZGVsLnRyYWNrX2V4cGFuc2lvbl90cmFja3MuaGFzT3duUHJvcGVydHkoZXhwYW5zaW9uX29mKSkge1xuXHRcdG1vZGVsLnRyYWNrX2V4cGFuc2lvbl90cmFja3NbZXhwYW5zaW9uX29mXSA9IFtdO1xuXHQgICAgfVxuXHQgICAgaWYgKG1vZGVsLnRyYWNrX2V4cGFuc2lvbl90cmFja3NbZXhwYW5zaW9uX29mXS5pbmRleE9mKHRyYWNrX2lkKSAhPT0gLTEpIHtcblx0XHR0aHJvdyBuZXcgRXJyb3IoJ0lsbGVnYWwgc3RhdGU6IGR1cGxpY2F0ZSBleHBhbnNpb24gdHJhY2sgSUQnKTtcblx0ICAgIH1cblx0ICAgIG1vZGVsLnRyYWNrX2V4cGFuc2lvbl90cmFja3NbZXhwYW5zaW9uX29mXS5wdXNoKHRyYWNrX2lkKTtcblx0fVxuXHRpZiAodHlwZW9mIGV4cGFuc2lvbkluaXRDYWxsYmFjayAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0ICAgIG1vZGVsLnRyYWNrX2V4cGFuc2lvbl9pbml0X2NhbGxiYWNrW3RyYWNrX2lkXSA9IGV4cGFuc2lvbkluaXRDYWxsYmFjaztcblx0fVxuXHRcblx0bW9kZWwudHJhY2tfc29ydF9jbXBfZm5bdHJhY2tfaWRdID0gaWZuZGVmKHNvcnRDbXBGbiwgZnVuY3Rpb24gKCkge1xuXHQgICAgcmV0dXJuIDA7XG5cdH0pO1xuXHRcblx0bW9kZWwudHJhY2tfc29ydF9kaXJlY3Rpb25fY2hhbmdlYWJsZVt0cmFja19pZF0gPSBpZm5kZWYoc29ydF9kaXJlY3Rpb25fY2hhbmdlYWJsZSwgZmFsc2UpO1xuXHRtb2RlbC50cmFja19kYXRhW3RyYWNrX2lkXSA9IGlmbmRlZihkYXRhLCBbXSk7XG5cdG1vZGVsLnRyYWNrX2RhdGFfaWRfa2V5W3RyYWNrX2lkXSA9IGlmbmRlZihkYXRhX2lkX2tleSwgJ2lkJyk7XG5cdFxuXHRtb2RlbC50cmFja19pbmZvW3RyYWNrX2lkXSA9IGlmbmRlZih0cmFja19pbmZvLCBcIlwiKTtcblx0XG5cdGlmICh0eXBlb2YgcnVsZV9zZXQgIT09ICd1bmRlZmluZWQnKSB7XG5cdCAgICBtb2RlbC5ydWxlX3NldHNbcnVsZV9zZXQucnVsZV9zZXRfaWRdID0gcnVsZV9zZXQ7XG5cdCAgICBtb2RlbC50cmFja19ydWxlX3NldF9pZFt0cmFja19pZF0gPSBydWxlX3NldC5ydWxlX3NldF9pZDtcblx0fVxuXG5cdG1vZGVsLnRyYWNrX3NvcnRfZGlyZWN0aW9uW3RyYWNrX2lkXSA9IGlmbmRlZihpbml0X3NvcnRfZGlyZWN0aW9uLCAxKTtcblx0XG5cdHRhcmdldF9ncm91cCA9IGlmbmRlZih0YXJnZXRfZ3JvdXAsIDApO1xuXHR3aGlsZSAodGFyZ2V0X2dyb3VwID49IG1vZGVsLnRyYWNrX2dyb3Vwcy5sZW5ndGgpIHtcblx0ICAgIG1vZGVsLnRyYWNrX2dyb3Vwcy5wdXNoKFtdKTtcblx0ICAgIG1vZGVsLnRyYWNrX2dyb3VwX2hlYWRlci5wdXNoKFwiXCIpO1xuXHR9XG5cdGlmICh0cmFja19ncm91cF9oZWFkZXIpIHtcblx0ICAgIG1vZGVsLnRyYWNrX2dyb3VwX2hlYWRlclt0YXJnZXRfZ3JvdXBdID0gdHJhY2tfZ3JvdXBfaGVhZGVyO1xuXHR9XG5cdG1vZGVsLnRyYWNrX2dyb3Vwc1t0YXJnZXRfZ3JvdXBdLnB1c2godHJhY2tfaWQpO1xuXHRcblx0XG5cdFxuXHRtb2RlbC50cmFja19pZF90b19kYXR1bS51cGRhdGUobW9kZWwsIHRyYWNrX2lkKTtcblx0bW9kZWwudHJhY2tfcHJlc2VudF9pZHMudXBkYXRlKG1vZGVsLCB0cmFja19pZCk7XG5cdG1vZGVsLnByZWNvbXB1dGVkX2NvbXBhcmF0b3IudXBkYXRlKG1vZGVsLCB0cmFja19pZCk7XG5cdFxuXHRtb2RlbC5zZXRJZE9yZGVyKE9iamVjdC5rZXlzKG1vZGVsLnByZXNlbnRfaWRzLmdldCgpKSk7XG4gICAgfVxuXG4gICAgdmFyIF9nZXRDb250YWluaW5nVHJhY2tHcm91cCA9IGZ1bmN0aW9uIChvbmNvcHJpbnRfbW9kZWwsIHRyYWNrX2lkLCByZXR1cm5fcmVmZXJlbmNlKSB7XG5cdHZhciBncm91cDtcblx0dHJhY2tfaWQgPSBwYXJzZUludCh0cmFja19pZCk7XG5cdGZvciAodmFyIGkgPSAwOyBpIDwgb25jb3ByaW50X21vZGVsLnRyYWNrX2dyb3Vwcy5sZW5ndGg7IGkrKykge1xuXHQgICAgaWYgKG9uY29wcmludF9tb2RlbC50cmFja19ncm91cHNbaV0uaW5kZXhPZih0cmFja19pZCkgPiAtMSkge1xuXHRcdGdyb3VwID0gb25jb3ByaW50X21vZGVsLnRyYWNrX2dyb3Vwc1tpXTtcblx0XHRicmVhaztcblx0ICAgIH1cblx0fVxuXHRpZiAoZ3JvdXApIHtcblx0ICAgIHJldHVybiAocmV0dXJuX3JlZmVyZW5jZSA/IGdyb3VwIDogZ3JvdXAuc2xpY2UoKSk7XG5cdH0gZWxzZSB7XG5cdCAgICByZXR1cm4gbnVsbDtcblx0fVxuICAgIH1cblxuICAgIHZhciBpc1J1bGVTZXRVc2VkID0gZnVuY3Rpb24obW9kZWwsIHJ1bGVfc2V0X2lkKSB7XG5cdHZhciB1c2VkID0gZmFsc2U7XG5cdHZhciB0cmFja3MgPSBtb2RlbC5nZXRUcmFja3MoKTtcblx0Zm9yICh2YXIgaT0wOyBpPHRyYWNrcy5sZW5ndGg7IGkrKykge1xuXHQgICAgaWYgKG1vZGVsLnRyYWNrX3J1bGVfc2V0X2lkW3RyYWNrc1tpXV0gPT09IHJ1bGVfc2V0X2lkKSB7XG5cdFx0dXNlZCA9IHRydWU7XG5cdFx0YnJlYWs7XG5cdCAgICB9XG5cdH1cblx0cmV0dXJuIHVzZWQ7XG4gICAgfVxuICAgXG4gICAgT25jb3ByaW50TW9kZWwucHJvdG90eXBlLnJlbW92ZVRyYWNrID0gZnVuY3Rpb24gKHRyYWNrX2lkKSB7XG5cdHZhciBydWxlX3NldF9pZCA9IHRoaXMudHJhY2tfcnVsZV9zZXRfaWRbdHJhY2tfaWRdO1xuXHR0aGlzLnRyYWNrX3JlbW92ZV9jYWxsYmFja1t0cmFja19pZF0odHJhY2tfaWQpO1xuXHRcblx0ZGVsZXRlIHRoaXMudHJhY2tfZGF0YVt0cmFja19pZF07XG5cdGRlbGV0ZSB0aGlzLnRyYWNrX3J1bGVfc2V0X2lkW3RyYWNrX2lkXTtcblx0ZGVsZXRlIHRoaXMudHJhY2tfbGFiZWxbdHJhY2tfaWRdO1xuXHRkZWxldGUgdGhpcy5jZWxsX2hlaWdodFt0cmFja19pZF07XG5cdGRlbGV0ZSB0aGlzLnRyYWNrX3BhZGRpbmdbdHJhY2tfaWRdO1xuXHRkZWxldGUgdGhpcy50cmFja19kYXRhX2lkX2tleVt0cmFja19pZF07XG5cdGRlbGV0ZSB0aGlzLnRyYWNrX3Rvb2x0aXBfZm5bdHJhY2tfaWRdO1xuXHRkZWxldGUgdGhpcy50cmFja19yZW1vdmFibGVbdHJhY2tfaWRdO1xuXHRkZWxldGUgdGhpcy50cmFja19yZW1vdmVfY2FsbGJhY2tbdHJhY2tfaWRdO1xuXHRkZWxldGUgdGhpcy50cmFja19zb3J0X2NtcF9mblt0cmFja19pZF07XG5cdGRlbGV0ZSB0aGlzLnRyYWNrX3NvcnRfZGlyZWN0aW9uX2NoYW5nZWFibGVbdHJhY2tfaWRdO1xuXHRkZWxldGUgdGhpcy50cmFja19zb3J0X2RpcmVjdGlvblt0cmFja19pZF07XG5cdGRlbGV0ZSB0aGlzLnRyYWNrX2luZm9bdHJhY2tfaWRdO1xuXHRkZWxldGUgdGhpcy50cmFja19oYXNfY29sdW1uX3NwYWNpbmdbdHJhY2tfaWRdO1xuXG5cdHZhciBjb250YWluaW5nX3RyYWNrX2dyb3VwID0gX2dldENvbnRhaW5pbmdUcmFja0dyb3VwKHRoaXMsIHRyYWNrX2lkLCB0cnVlKTtcblx0aWYgKGNvbnRhaW5pbmdfdHJhY2tfZ3JvdXAgIT09IG51bGwpIHtcblx0ICAgIGNvbnRhaW5pbmdfdHJhY2tfZ3JvdXAuc3BsaWNlKFxuXHRcdCAgICBjb250YWluaW5nX3RyYWNrX2dyb3VwLmluZGV4T2YodHJhY2tfaWQpLCAxKTtcblx0fVxuXHR2YXIgaSwgaW5kZXhfaW5fZ3JvdXA7XG5cdGZvciAoaSBpbiB0aGlzLnRyYWNrX2V4cGFuc2lvbl90cmFja3MpIHtcblx0ICAgIGlmICh0aGlzLnRyYWNrX2V4cGFuc2lvbl90cmFja3MuaGFzT3duUHJvcGVydHkoaSkpIHtcblx0XHRpbmRleF9pbl9ncm91cCA9IHRoaXMudHJhY2tfZXhwYW5zaW9uX3RyYWNrc1tpXS5pbmRleE9mKHRyYWNrX2lkKTtcblx0XHRpZiAoaW5kZXhfaW5fZ3JvdXAgIT09IC0xKSB7XG5cdFx0ICAgIHRoaXMudHJhY2tfZXhwYW5zaW9uX3RyYWNrc1tpXS5zcGxpY2UoaW5kZXhfaW5fZ3JvdXAsIDEpO1xuXHRcdH1cblx0ICAgIH1cblx0fVxuXHR0aGlzLnRyYWNrX3RvcHMudXBkYXRlKCk7XG5cdHRoaXMudHJhY2tfcHJlc2VudF9pZHMudXBkYXRlKHRoaXMsIHRyYWNrX2lkKTtcblx0dGhpcy50cmFja19pZF90b19kYXR1bS51cGRhdGUodGhpcywgdHJhY2tfaWQpO1xuXHR0aGlzLnNldElkT3JkZXIoT2JqZWN0LmtleXModGhpcy5wcmVzZW50X2lkcy5nZXQoKSkpO1xuXHRcblx0dmFyIHJ1bGVfc2V0X3VzZWQgPSBpc1J1bGVTZXRVc2VkKHRoaXMsIHJ1bGVfc2V0X2lkKTtcblx0aWYgKCFydWxlX3NldF91c2VkKSB7XG5cdCAgICBkZWxldGUgdGhpcy5ydWxlX3NldHNbcnVsZV9zZXRfaWRdO1xuXHR9XG4gICAgfVxuICAgIFxuICAgIE9uY29wcmludE1vZGVsLnByb3RvdHlwZS5nZXRPdmVybGFwcGluZ0NlbGwgPSBmdW5jdGlvbih4LHkpIHtcblx0Ly8gRmlyc3QsIHNlZSBpZiBpdCdzIGluIGEgY29sdW1uXG5cdHZhciBpZF9vcmRlciA9IHRoaXMuZ2V0SWRPcmRlcigpO1xuXHR2YXIgem9vbWVkX2NvbHVtbl9sZWZ0ID0gdGhpcy5nZXRab29tZWRDb2x1bW5MZWZ0KCk7XG5cdHZhciBuZWFyZXN0X2lkX2luZGV4ID0gYmluYXJ5c2VhcmNoKGlkX29yZGVyLCB4LCBmdW5jdGlvbihpZCkgeyByZXR1cm4gem9vbWVkX2NvbHVtbl9sZWZ0W2lkXTt9LCB0cnVlKTtcblx0aWYgKG5lYXJlc3RfaWRfaW5kZXggPT09IC0xKSB7XG5cdCAgICByZXR1cm4gbnVsbDtcblx0fVxuXHR2YXIgaWQgPSBpZF9vcmRlcltuZWFyZXN0X2lkX2luZGV4XTtcblx0XG5cdC8vIE5leHQsIHNlZSBpZiBpdCdzIGluIGEgdHJhY2tcblx0dmFyIHRyYWNrcyA9IHRoaXMuZ2V0VHJhY2tzKCk7XG5cdHZhciBjZWxsX3RvcHMgPSB0aGlzLmdldENlbGxUb3BzKCk7XG5cdHZhciBuZWFyZXN0X3RyYWNrX2luZGV4ID0gYmluYXJ5c2VhcmNoKHRyYWNrcywgeSwgZnVuY3Rpb24gKHRyYWNrKSB7XG5cdCAgICByZXR1cm4gY2VsbF90b3BzW3RyYWNrXTtcblx0fSwgdHJ1ZSk7XG5cdGlmIChuZWFyZXN0X3RyYWNrX2luZGV4ID09PSAtMSkge1xuXHQgICAgcmV0dXJuIG51bGw7XG5cdH1cblx0dmFyIG5lYXJlc3RfdHJhY2sgPSB0cmFja3NbbmVhcmVzdF90cmFja19pbmRleF07XG5cdFxuXHQvLyBGaW5hbGx5LCBzZWUgaWYgaXQncyBpbnNpZGUgYSBjZWxsXG5cdHZhciBoaXR6b25lX3JpZ2h0ID0gem9vbWVkX2NvbHVtbl9sZWZ0W2lkXSArIHRoaXMuZ2V0Q2VsbFdpZHRoKCk7XG5cdGlmICghdGhpcy5nZXRUcmFja0hhc0NvbHVtblNwYWNpbmcobmVhcmVzdF90cmFjaykpIHtcblx0ICAgIGhpdHpvbmVfcmlnaHQgKz0gdGhpcy5nZXRDZWxsUGFkZGluZygpO1xuXHR9XG5cdGlmICh4IDw9IGhpdHpvbmVfcmlnaHQgJiYgeSA8IGNlbGxfdG9wc1tuZWFyZXN0X3RyYWNrXSArIHRoaXMuZ2V0Q2VsbEhlaWdodChuZWFyZXN0X3RyYWNrKSkgeyAgXG5cdCAgICByZXR1cm4geydpZCc6IGlkLCAndHJhY2snOiBuZWFyZXN0X3RyYWNrLCAndG9wJzogY2VsbF90b3BzW25lYXJlc3RfdHJhY2tdLCAnbGVmdCc6IHpvb21lZF9jb2x1bW5fbGVmdFtpZF19O1xuXHR9XG5cdHJldHVybiBudWxsO1xuICAgIH07XG4gICAgXG4gICAgT25jb3ByaW50TW9kZWwucHJvdG90eXBlLmdldFRyYWNrRGF0dW0gPSBmdW5jdGlvbih0cmFja19pZCwgaWQpIHtcblx0dmFyIGRhdHVtID0gdGhpcy50cmFja19pZF90b19kYXR1bS5nZXQoKVt0cmFja19pZF1baWRdO1xuXHRpZiAodHlwZW9mIGRhdHVtID09PSAndW5kZWZpbmVkJykge1xuXHQgICAgZGF0dW0gPSBudWxsO1xuXHR9XG5cdHJldHVybiBkYXR1bTtcbiAgICB9XG4gICAgXG4gICAgT25jb3ByaW50TW9kZWwucHJvdG90eXBlLmdldFRyYWNrVG9wcyA9IGZ1bmN0aW9uIChkZXNpcmVkX3RyYWNrX2lkKSB7XG5cdGlmICh0eXBlb2YgZGVzaXJlZF90cmFja19pZCA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0ICAgIHJldHVybiBjb3B5U2hhbGxvd09iamVjdCh0aGlzLnRyYWNrX3RvcHMuZ2V0KCkpO1xuXHR9IGVsc2Uge1xuXHQgICAgcmV0dXJuIHRoaXMudHJhY2tfdG9wcy5nZXQoKVtkZXNpcmVkX3RyYWNrX2lkXTtcblx0fVxuICAgIH1cbiAgICBcbiAgICBPbmNvcHJpbnRNb2RlbC5wcm90b3R5cGUuZ2V0Wm9vbWVkVHJhY2tUb3BzID0gZnVuY3Rpb24gKGRlc2lyZWRfdHJhY2tfaWQpIHtcblx0aWYgKHR5cGVvZiBkZXNpcmVkX3RyYWNrX2lkID09PSAndW5kZWZpbmVkJykge1xuXHQgICAgcmV0dXJuIGNvcHlTaGFsbG93T2JqZWN0KHRoaXMudHJhY2tfdG9wc196b29tZWQuZ2V0KCkpO1xuXHR9IGVsc2Uge1xuXHQgICAgcmV0dXJuIHRoaXMudHJhY2tfdG9wc196b29tZWQuZ2V0KClbZGVzaXJlZF90cmFja19pZF07XG5cdH1cbiAgICB9XG4gICAgXG4gICAgT25jb3ByaW50TW9kZWwucHJvdG90eXBlLmdldENlbGxUb3BzID0gZnVuY3Rpb24oZGVzaXJlZF90cmFja19pZCwgYmFzZSkge1xuXHRpZiAodHlwZW9mIGRlc2lyZWRfdHJhY2tfaWQgPT09ICd1bmRlZmluZWQnKSB7XG5cdCAgICByZXR1cm4gY29weVNoYWxsb3dPYmplY3QoKGJhc2UgPyB0aGlzLmNlbGxfdG9wcyA6IHRoaXMuY2VsbF90b3BzX3pvb21lZCkuZ2V0KCkpO1xuXHR9IGVsc2Uge1xuXHQgICAgcmV0dXJuIChiYXNlID8gdGhpcy5jZWxsX3RvcHMgOiB0aGlzLmNlbGxfdG9wc196b29tZWQpLmdldCgpW2Rlc2lyZWRfdHJhY2tfaWRdO1xuXHR9XG4gICAgfVxuICAgIE9uY29wcmludE1vZGVsLnByb3RvdHlwZS5nZXRMYWJlbFRvcHMgPSBmdW5jdGlvbihkZXNpcmVkX3RyYWNrX2lkLCBiYXNlKSB7XG5cdGlmICh0eXBlb2YgZGVzaXJlZF90cmFja19pZCA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0ICAgIHJldHVybiBjb3B5U2hhbGxvd09iamVjdCgoYmFzZSA/IHRoaXMubGFiZWxfdG9wcyA6IHRoaXMubGFiZWxfdG9wc196b29tZWQpLmdldCgpKTtcblx0fSBlbHNlIHtcblx0ICAgIHJldHVybiAoYmFzZSA/IHRoaXMubGFiZWxfdG9wcyA6IHRoaXMubGFiZWxfdG9wc196b29tZWQpLmdldCgpW2Rlc2lyZWRfdHJhY2tfaWRdO1xuXHR9XG4gICAgfVxuICAgIFxuICAgIE9uY29wcmludE1vZGVsLnByb3RvdHlwZS5nZXRDb250YWluaW5nVHJhY2tHcm91cCA9IGZ1bmN0aW9uICh0cmFja19pZCkge1xuXHRyZXR1cm4gX2dldENvbnRhaW5pbmdUcmFja0dyb3VwKHRoaXMsIHRyYWNrX2lkLCBmYWxzZSk7XG4gICAgfVxuXG4gICAgT25jb3ByaW50TW9kZWwucHJvdG90eXBlLnNldFRyYWNrR3JvdXBIZWFkZXIgPSBmdW5jdGlvbih0cmFja19ncm91cF9pZCwgdGV4dCkge1xuXHR0aGlzLnRyYWNrX2dyb3VwX2hlYWRlclt0cmFja19ncm91cF9pZF0gPSB0ZXh0O1xuXHR0aGlzLnRyYWNrX3RvcHMudXBkYXRlKCk7XG4gICAgfVxuICAgIFxuICAgIE9uY29wcmludE1vZGVsLnByb3RvdHlwZS5nZXRUcmFja0dyb3VwSGVhZGVyID0gZnVuY3Rpb24odHJhY2tfZ3JvdXBfaWQpIHtcblx0cmV0dXJuIHRoaXMudHJhY2tfZ3JvdXBfaGVhZGVyW3RyYWNrX2dyb3VwX2lkXSB8fCBcIlwiO1xuICAgIH1cbiAgICBcbiAgICBPbmNvcHJpbnRNb2RlbC5wcm90b3R5cGUuZ2V0VHJhY2tHcm91cEhlYWRlclNpemUgPSBmdW5jdGlvbigpIHtcblx0cmV0dXJuIDIwO1xuICAgIH1cbiAgICBcbiAgICBPbmNvcHJpbnRNb2RlbC5wcm90b3R5cGUuZ2V0VHJhY2tHcm91cHMgPSBmdW5jdGlvbiAoKSB7XG5cdC8vIFRPRE86IG1ha2UgcmVhZC1vbmx5XG5cdHJldHVybiB0aGlzLnRyYWNrX2dyb3VwcztcbiAgICB9XG5cbiAgICBPbmNvcHJpbnRNb2RlbC5wcm90b3R5cGUuZ2V0VHJhY2tzID0gZnVuY3Rpb24gKCkge1xuXHR2YXIgcmV0ID0gW107XG5cdGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy50cmFja19ncm91cHMubGVuZ3RoOyBpKyspIHtcblx0ICAgIGZvciAodmFyIGogPSAwOyBqIDwgdGhpcy50cmFja19ncm91cHNbaV0ubGVuZ3RoOyBqKyspIHtcblx0XHRyZXQucHVzaCh0aGlzLnRyYWNrX2dyb3Vwc1tpXVtqXSk7XG5cdCAgICB9XG5cdH1cblx0cmV0dXJuIHJldDtcbiAgICB9XG5cbiAgICBPbmNvcHJpbnRNb2RlbC5wcm90b3R5cGUuZ2V0SWRzSW5MZWZ0SW50ZXJ2YWwgPSBmdW5jdGlvbihsZWZ0LCByaWdodCkge1xuXHR2YXIgY2VsbF93aWR0aCA9IHRoaXMuZ2V0Q2VsbFdpZHRoKCk7XG5cdHZhciBjZWxsX3BhZGRpbmcgPSB0aGlzLmdldENlbGxQYWRkaW5nKCk7XG5cdHZhciBpZF9vcmRlciA9IHRoaXMuZ2V0SWRPcmRlcigpO1xuXHRcblx0Ly8gbGVmdF9pZF9pbmRleCBhbmQgcmlnaHRfaWRfaW5kZXggYXJlIGluY2x1c2l2ZVxuXHR2YXIgbGVmdF9pZF9pbmRleCA9IE1hdGguZmxvb3IobGVmdC8oY2VsbF93aWR0aCArIGNlbGxfcGFkZGluZykpO1xuXHR2YXIgbGVmdF9yZW1haW5kZXIgPSBsZWZ0IC0gbGVmdF9pZF9pbmRleCooY2VsbF93aWR0aCArIGNlbGxfcGFkZGluZyk7XG5cdGlmIChsZWZ0X3JlbWFpbmRlciA+IGNlbGxfd2lkdGgpIHtcblx0ICAgIGxlZnRfaWRfaW5kZXggKz0gMTtcblx0fVxuXHR2YXIgcmlnaHRfaWRfaW5kZXggPSBNYXRoLmZsb29yKHJpZ2h0LyhjZWxsX3dpZHRoICsgY2VsbF9wYWRkaW5nKSk7XG5cdHJldHVybiBpZF9vcmRlci5zbGljZShsZWZ0X2lkX2luZGV4LCByaWdodF9pZF9pbmRleCsxKTtcbiAgICB9XG4gICAgT25jb3ByaW50TW9kZWwucHJvdG90eXBlLmdldENvbHVtbkxlZnQgPSBmdW5jdGlvbihpZCkge1xuXHRpZiAodHlwZW9mIGlkID09PSAndW5kZWZpbmVkJykge1xuXHQgICAgcmV0dXJuIHRoaXMuY29sdW1uX2xlZnQuZ2V0KCk7XG5cdH0gZWxzZSB7XG5cdCAgICByZXR1cm4gdGhpcy5jb2x1bW5fbGVmdC5nZXQoKVtpZF07XG5cdH1cbiAgICB9XG4gICAgXG4gICAgT25jb3ByaW50TW9kZWwucHJvdG90eXBlLmdldENvbHVtbkxlZnROb1BhZGRpbmcgPSBmdW5jdGlvbihpZCkge1xuXHRpZiAodHlwZW9mIGlkID09PSAndW5kZWZpbmVkJykge1xuXHQgICAgcmV0dXJuIHRoaXMuY29sdW1uX2xlZnRfbm9fcGFkZGluZy5nZXQoKTtcblx0fSBlbHNlIHtcblx0ICAgIHJldHVybiB0aGlzLmNvbHVtbl9sZWZ0X25vX3BhZGRpbmcuZ2V0KClbaWRdO1xuXHR9XG4gICAgfVxuICAgIFxuICAgIE9uY29wcmludE1vZGVsLnByb3RvdHlwZS5nZXRab29tZWRDb2x1bW5MZWZ0ID0gZnVuY3Rpb24oaWQpIHtcblx0aWYgKHR5cGVvZiBpZCA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0ICAgIHJldHVybiB0aGlzLnpvb21lZF9jb2x1bW5fbGVmdC5nZXQoKTtcblx0fSBlbHNlIHtcblx0ICAgIHJldHVybiB0aGlzLnpvb21lZF9jb2x1bW5fbGVmdC5nZXQoKVtpZF07XG5cdH1cbiAgICB9XG4gICAgXG4gICAgXG4gICAgT25jb3ByaW50TW9kZWwucHJvdG90eXBlLmdldE9uY29wcmludEhlaWdodCA9IGZ1bmN0aW9uKGJhc2UpIHtcblx0dmFyIHRyYWNrcyA9IHRoaXMuZ2V0VHJhY2tzKCk7XG5cdHZhciBsYXN0X3RyYWNrID0gdHJhY2tzW3RyYWNrcy5sZW5ndGgtMV07XG5cdHJldHVybiAoYmFzZSA/IHRoaXMuZ2V0VHJhY2tUb3BzKGxhc3RfdHJhY2spIDogdGhpcy5nZXRab29tZWRUcmFja1RvcHMobGFzdF90cmFjaykpK3RoaXMuZ2V0VHJhY2tIZWlnaHQobGFzdF90cmFjaywgYmFzZSlcblx0XHQgICAgKyB0aGlzLmdldEJvdHRvbVBhZGRpbmcoKTtcbiAgICB9XG4gICAgXG4gICAgT25jb3ByaW50TW9kZWwucHJvdG90eXBlLmdldE9uY29wcmludFdpZHRoID0gZnVuY3Rpb24oYmFzZSkge1xuXHRyZXR1cm4gdGhpcy5nZXRJZE9yZGVyKCkubGVuZ3RoKih0aGlzLmdldENlbGxXaWR0aChiYXNlKSArIHRoaXMuZ2V0Q2VsbFBhZGRpbmcoYmFzZSkpO1xuICAgIH1cbiAgICBcbiAgICBPbmNvcHJpbnRNb2RlbC5wcm90b3R5cGUuZ2V0T25jb3ByaW50V2lkdGhOb0NvbHVtblBhZGRpbmcgPSBmdW5jdGlvbihiYXNlKSB7XG5cdHJldHVybiB0aGlzLmdldElkT3JkZXIoKS5sZW5ndGgqdGhpcy5nZXRDZWxsV2lkdGgoYmFzZSk7XG4gICAgfVxuICAgIFxuICAgIE9uY29wcmludE1vZGVsLnByb3RvdHlwZS5nZXRDZWxsVmlld0hlaWdodCA9IGZ1bmN0aW9uKCkge1xuXHRyZXR1cm4gTWF0aC5taW4odGhpcy5tYXhfaGVpZ2h0LCB0aGlzLmdldE9uY29wcmludEhlaWdodCgpKTtcbiAgICB9XG4gICAgXG4gICAgT25jb3ByaW50TW9kZWwucHJvdG90eXBlLmdldENlbGxWaWV3V2lkdGggPSBmdW5jdGlvbigpIHtcblx0cmV0dXJuIHRoaXMuZ2V0T25jb3ByaW50V2lkdGgoKTtcbiAgICB9XG4gICAgT25jb3ByaW50TW9kZWwucHJvdG90eXBlLm1vdmVUcmFjayA9IGZ1bmN0aW9uICh0cmFja19pZCwgbmV3X3ByZXZpb3VzX3RyYWNrKSB7XG5cdHZhciB0cmFja19ncm91cCA9IF9nZXRDb250YWluaW5nVHJhY2tHcm91cCh0aGlzLCB0cmFja19pZCwgdHJ1ZSk7XG5cdGlmICh0cmFja19ncm91cCAhPT0gbnVsbCkge1xuXHQgICAgdHJhY2tfZ3JvdXAuc3BsaWNlKHRyYWNrX2dyb3VwLmluZGV4T2YodHJhY2tfaWQpLCAxKTtcblx0ICAgIHZhciBuZXdfcG9zaXRpb24gPSAobmV3X3ByZXZpb3VzX3RyYWNrID09PSBudWxsID8gMCA6IHRyYWNrX2dyb3VwLmluZGV4T2YobmV3X3ByZXZpb3VzX3RyYWNrKSsxKTtcblx0ICAgIHRyYWNrX2dyb3VwLnNwbGljZShuZXdfcG9zaXRpb24sIDAsIHRyYWNrX2lkKTtcblx0fVxuXHRcblx0dGhpcy50cmFja190b3BzLnVwZGF0ZSgpO1xuICAgIH1cblxuICAgIE9uY29wcmludE1vZGVsLnByb3RvdHlwZS5nZXRUcmFja0xhYmVsID0gZnVuY3Rpb24gKHRyYWNrX2lkKSB7XG5cdHJldHVybiB0aGlzLnRyYWNrX2xhYmVsW3RyYWNrX2lkXTtcbiAgICB9XG4gICAgXG4gICAgT25jb3ByaW50TW9kZWwucHJvdG90eXBlLmdldFRyYWNrRGVzY3JpcHRpb24gPSBmdW5jdGlvbih0cmFja19pZCkge1xuXHRyZXR1cm4gdGhpcy50cmFja19kZXNjcmlwdGlvblt0cmFja19pZF07XG4gICAgfVxuXG4gICAgT25jb3ByaW50TW9kZWwucHJvdG90eXBlLmdldFRyYWNrVG9vbHRpcEZuID0gZnVuY3Rpb24gKHRyYWNrX2lkKSB7XG5cdHJldHVybiB0aGlzLnRyYWNrX3Rvb2x0aXBfZm5bdHJhY2tfaWRdO1xuICAgIH1cbiAgICBPbmNvcHJpbnRNb2RlbC5wcm90b3R5cGUuc2V0VHJhY2tUb29sdGlwRm4gPSBmdW5jdGlvbiAodHJhY2tfaWQsIHRvb2x0aXBGbikge1xuXHR0aGlzLnRyYWNrX3Rvb2x0aXBfZm5bdHJhY2tfaWRdID0gdG9vbHRpcEZuO1xuICAgIH1cblxuICAgIE9uY29wcmludE1vZGVsLnByb3RvdHlwZS5nZXRUcmFja0RhdGFJZEtleSA9IGZ1bmN0aW9uICh0cmFja19pZCkge1xuXHRyZXR1cm4gdGhpcy50cmFja19kYXRhX2lkX2tleVt0cmFja19pZF07XG4gICAgfVxuXG4gICAgT25jb3ByaW50TW9kZWwucHJvdG90eXBlLmdldFRyYWNrR3JvdXBQYWRkaW5nID0gZnVuY3Rpb24gKGJhc2UpIHtcblx0cmV0dXJuIHRoaXMudHJhY2tfZ3JvdXBfcGFkZGluZyAqIChiYXNlID8gMSA6IHRoaXMudmVydF96b29tKTtcbiAgICB9XG4gICAgXG4gICAgT25jb3ByaW50TW9kZWwucHJvdG90eXBlLmlzVHJhY2tSZW1vdmFibGUgPSBmdW5jdGlvbiAodHJhY2tfaWQpIHtcblx0cmV0dXJuIHRoaXMudHJhY2tfcmVtb3ZhYmxlW3RyYWNrX2lkXTtcbiAgICB9XG4gICAgXG4gICAgT25jb3ByaW50TW9kZWwucHJvdG90eXBlLmlzVHJhY2tTb3J0RGlyZWN0aW9uQ2hhbmdlYWJsZSA9IGZ1bmN0aW9uICh0cmFja19pZCkge1xuXHRyZXR1cm4gdGhpcy50cmFja19zb3J0X2RpcmVjdGlvbl9jaGFuZ2VhYmxlW3RyYWNrX2lkXTtcbiAgICB9XG4gICAgXG4gICAgT25jb3ByaW50TW9kZWwucHJvdG90eXBlLmlzVHJhY2tFeHBhbmRhYmxlID0gZnVuY3Rpb24gKHRyYWNrX2lkKSB7XG5cdHJldHVybiB0aGlzLnRyYWNrX2V4cGFuc2lvbl9pbml0X2NhbGxiYWNrLmhhc093blByb3BlcnR5KHRyYWNrX2lkKSAmJlxuXHRcdCgoIXRoaXMudHJhY2tfZXhwYW5zaW9uX2dlbmVzLmhhc093blByb3BlcnR5KHRyYWNrX2lkKSkgfHxcblx0XHQgdGhpcy50cmFja19leHBhbnNpb25fZ2VuZXNbdHJhY2tfaWRdLmxlbmd0aCA+IDApO1xuICAgIH1cbiAgICBcbiAgICBPbmNvcHJpbnRNb2RlbC5wcm90b3R5cGUuaW5pdEV4cGFuc2lvbiA9IGZ1bmN0aW9uICh0cmFja19pZCkge1xuXHR0aGlzLnRyYWNrX2V4cGFuc2lvbl9pbml0X2NhbGxiYWNrW3RyYWNrX2lkXSh0cmFja19pZCk7XG4gICAgfVxuICAgIFxuICAgIE9uY29wcmludE1vZGVsLnByb3RvdHlwZS5zZXRFeHBhbnNpb25HZW5lRGF0YSA9IGZ1bmN0aW9uICh0cmFja19pZCwgZ2VuZURhdGFBcnJheSkge1xuXHR0aGlzLnRyYWNrX2V4cGFuc2lvbl9nZW5lc1t0cmFja19pZF0gPSBnZW5lRGF0YUFycmF5O1xuICAgIH1cbiAgICBcbiAgICBPbmNvcHJpbnRNb2RlbC5wcm90b3R5cGUuc2V0RXhwYW5zaW9uQ2FsbGJhY2sgPSBmdW5jdGlvbiAodHJhY2tfaWQsIGNhbGxiYWNrRm4pIHtcblx0dGhpcy50cmFja19leHBhbnNpb25fY2FsbGJhY2tbdHJhY2tfaWRdID0gY2FsbGJhY2tGbjtcbiAgICB9XG4gICAgXG4gICAgT25jb3ByaW50TW9kZWwucHJvdG90eXBlLmlzVHJhY2tFeHBhbmRlZCA9IGZ1bmN0aW9uICh0cmFja19pZCkge1xuXHRyZXR1cm4gdGhpcy50cmFja19leHBhbnNpb25fdHJhY2tzLmhhc093blByb3BlcnR5KHRyYWNrX2lkKSAmJlxuXHRcdHRoaXMudHJhY2tfZXhwYW5zaW9uX3RyYWNrc1t0cmFja19pZF0ubGVuZ3RoID4gMDtcbiAgICB9XG4gICAgXG4gICAgT25jb3ByaW50TW9kZWwucHJvdG90eXBlLmV4cGFuZFRyYWNrID0gZnVuY3Rpb24gKHRyYWNrX2lkLCBtYXhHZW5lcykge1xuXHRtYXhHZW5lcyA9IG1heEdlbmVzIHx8IDU7XG5cdC8vIHBvcCBvZmYgdGhlIGZpcnN0IGBtYXhHZW5lc2AgZ2VuZXMsIHVwIHRvIHRoZSBlbmQgb2YgdGhlIGFycmF5XG5cdHZhciBnZW5lcyA9IHRoaXMudHJhY2tfZXhwYW5zaW9uX2dlbmVzW3RyYWNrX2lkXS5zcGxpY2UoMCwgbWF4R2VuZXMpO1xuXHRyZXR1cm4gdGhpcy50cmFja19leHBhbnNpb25fY2FsbGJhY2tbdHJhY2tfaWRdKHRyYWNrX2lkLCBnZW5lcyk7XG4gICAgfVxuICAgIFxuICAgIE9uY29wcmludE1vZGVsLnByb3RvdHlwZS5nZXRSdWxlU2V0ID0gZnVuY3Rpb24gKHRyYWNrX2lkKSB7XG5cdHJldHVybiB0aGlzLnJ1bGVfc2V0c1t0aGlzLnRyYWNrX3J1bGVfc2V0X2lkW3RyYWNrX2lkXV07XG4gICAgfVxuXG4gICAgT25jb3ByaW50TW9kZWwucHJvdG90eXBlLnNoYXJlUnVsZVNldCA9IGZ1bmN0aW9uKHNvdXJjZV90cmFja19pZCwgdGFyZ2V0X3RyYWNrX2lkKSB7XG5cdHZhciBjdXJyX3J1bGVfc2V0X2lkID0gdGhpcy50cmFja19ydWxlX3NldF9pZFt0YXJnZXRfdHJhY2tfaWRdO1xuXHR2YXIgc2hvdWxkX2RlbGV0ZV9jdXJyX3J1bGVfc2V0ID0gdHJ1ZTtcblx0Zm9yICh2YXIgdHJhY2tfaWQgaW4gdGhpcy50cmFja19ydWxlX3NldF9pZCkge1xuXHQgICAgaWYgKHRoaXMudHJhY2tfcnVsZV9zZXRfaWQuaGFzT3duUHJvcGVydHkodHJhY2tfaWQpICYmIHRyYWNrX2lkICE9PSBzb3VyY2VfdHJhY2tfaWQgKyAnJykge1xuXHRcdGlmICh0aGlzLnRyYWNrX3J1bGVfc2V0X2lkW3RyYWNrX2lkXSA9PT0gY3Vycl9ydWxlX3NldF9pZCkge1xuXHRcdCAgICBzaG91bGRfZGVsZXRlX2N1cnJfcnVsZV9zZXQgPSBmYWxzZTtcblx0XHQgICAgYnJlYWs7XG5cdFx0fVxuXHQgICAgfVxuXHR9XG5cdGlmIChzaG91bGRfZGVsZXRlX2N1cnJfcnVsZV9zZXQpIHtcblx0ICAgIGRlbGV0ZSB0aGlzLnJ1bGVfc2V0c1tjdXJyX3J1bGVfc2V0X2lkXTtcblx0fVxuXHRkZWxldGUgdGhpcy50cmFja19hY3RpdmVfcnVsZXNbdGFyZ2V0X3RyYWNrX2lkXTtcblx0dGhpcy50cmFja19ydWxlX3NldF9pZFt0YXJnZXRfdHJhY2tfaWRdID0gdGhpcy50cmFja19ydWxlX3NldF9pZFtzb3VyY2VfdHJhY2tfaWRdO1xuICAgIH1cbiAgICBcbiAgICBPbmNvcHJpbnRNb2RlbC5wcm90b3R5cGUuc2V0UnVsZVNldCA9IGZ1bmN0aW9uKHRyYWNrX2lkLCBydWxlX3NldCkge1xuXHR2YXIgY3Vycl9ydWxlX3NldF9pZCA9IHRoaXMudHJhY2tfcnVsZV9zZXRfaWRbdHJhY2tfaWRdO1xuXHR0aGlzLnJ1bGVfc2V0c1tydWxlX3NldC5ydWxlX3NldF9pZF0gPSBydWxlX3NldDtcblx0dGhpcy50cmFja19ydWxlX3NldF9pZFt0cmFja19pZF0gPSBydWxlX3NldC5ydWxlX3NldF9pZDtcblx0XG5cdHZhciBydWxlX3NldF91c2VkID0gaXNSdWxlU2V0VXNlZCh0aGlzLCBjdXJyX3J1bGVfc2V0X2lkKTtcblx0aWYgKCFydWxlX3NldF91c2VkKSB7XG5cdCAgICBkZWxldGUgdGhpcy5ydWxlX3NldHNbY3Vycl9ydWxlX3NldF9pZF07XG5cdH1cbiAgICB9XG5cbiAgICBPbmNvcHJpbnRNb2RlbC5wcm90b3R5cGUuZ2V0VHJhY2tTb3J0Q29tcGFyYXRvciA9IGZ1bmN0aW9uKHRyYWNrX2lkKSB7XG5cdHJldHVybiB0aGlzLnRyYWNrX3NvcnRfY21wX2ZuW3RyYWNrX2lkXTtcbiAgICB9XG4gICAgXG4gICAgT25jb3ByaW50TW9kZWwucHJvdG90eXBlLnNldFRyYWNrU29ydENvbXBhcmF0b3IgPSBmdW5jdGlvbih0cmFja19pZCwgc29ydENtcEZuKSB7XG5cdHRoaXMudHJhY2tfc29ydF9jbXBfZm5bdHJhY2tfaWRdID0gc29ydENtcEZuO1xuXHR0aGlzLnByZWNvbXB1dGVkX2NvbXBhcmF0b3IudXBkYXRlKHRoaXMsIHRyYWNrX2lkKTtcbiAgICB9XG4gICAgXG4gICAgT25jb3ByaW50TW9kZWwucHJvdG90eXBlLmdldFRyYWNrRGF0YSA9IGZ1bmN0aW9uICh0cmFja19pZCkge1xuXHRyZXR1cm4gdGhpcy50cmFja19kYXRhW3RyYWNrX2lkXTtcbiAgICB9XG4gICAgXG4gICAgLyoqXG4gICAgICogU2V0cyB0aGUgZGF0YSBmb3IgYW4gT25jb3ByaW50IHRyYWNrLlxuICAgICAqXG4gICAgICogQHBhcmFtIHRyYWNrX2lkIC0gdGhlIElEIHRoYXQgaWRlbnRpZmllcyB0aGUgdHJhY2tcbiAgICAgKiBAcGFyYW0ge09iamVjdFtdfSBkYXRhIC0gdGhlIGxpc3Qgb2YgZGF0YSBmb3IgdGhlIGNlbGxzXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IGRhdGFfaWRfa2V5IC0gbmFtZSBvZiB0aGUgcHJvcGVydHkgb2YgdGhlXG4gICAgICogZGF0YSBvYmplY3RzIHRvIHVzZSBhcyB0aGUgKGNvbHVtbikga2V5XG4gICAgICovXG4gICAgT25jb3ByaW50TW9kZWwucHJvdG90eXBlLnNldFRyYWNrRGF0YSA9IGZ1bmN0aW9uICh0cmFja19pZCwgZGF0YSwgZGF0YV9pZF9rZXkpIHtcblx0dGhpcy50cmFja19kYXRhW3RyYWNrX2lkXSA9IGRhdGE7XG5cdHRoaXMudHJhY2tfZGF0YV9pZF9rZXlbdHJhY2tfaWRdID0gZGF0YV9pZF9rZXk7XG5cdHRoaXMudHJhY2tfaWRfdG9fZGF0dW0udXBkYXRlKHRoaXMsIHRyYWNrX2lkKTtcblx0dGhpcy50cmFja19wcmVzZW50X2lkcy51cGRhdGUodGhpcywgdHJhY2tfaWQpO1xuXHR0aGlzLnNldElkT3JkZXIoT2JqZWN0LmtleXModGhpcy5wcmVzZW50X2lkcy5nZXQoKSkpO1xuXHR0aGlzLnByZWNvbXB1dGVkX2NvbXBhcmF0b3IudXBkYXRlKHRoaXMsIHRyYWNrX2lkKTtcbiAgICB9XG4gICAgXG4gICAgT25jb3ByaW50TW9kZWwucHJvdG90eXBlLmNvbXB1dGVUcmFja0lkVG9EYXR1bSA9IGZ1bmN0aW9uKHRyYWNrX2lkKSB7XG5cdHRoaXMudHJhY2tfaWRfdG9fZGF0dW1bdHJhY2tfaWRdID0ge307XG5cdFxuXHR2YXIgdHJhY2tfZGF0YSA9IHRoaXMudHJhY2tfZGF0YVt0cmFja19pZF0gfHwgW107XG5cdHZhciB0cmFja19pZF9rZXkgPSB0aGlzLnRyYWNrX2RhdGFfaWRfa2V5W3RyYWNrX2lkXTtcblx0Zm9yICh2YXIgaT0wOyBpPHRyYWNrX2RhdGEubGVuZ3RoOyBpKyspIHtcblx0ICAgIHRoaXMudHJhY2tfaWRfdG9fZGF0dW1bdHJhY2tfaWRdW3RyYWNrX2RhdGFbaV1bdHJhY2tfaWRfa2V5XV0gPSB0cmFja19kYXRhW2ldO1xuXHR9XG4gICAgfVxuICAgIFxuICAgIE9uY29wcmludE1vZGVsLnByb3RvdHlwZS5zZXRUcmFja0dyb3VwU29ydFByaW9yaXR5ID0gZnVuY3Rpb24ocHJpb3JpdHkpIHtcblx0dGhpcy50cmFja19ncm91cF9zb3J0X3ByaW9yaXR5ID0gcHJpb3JpdHk7XG5cdHRoaXMuc29ydCgpO1xuICAgIH1cbiAgICB2YXIgc29ydEFscGhhYmV0aWNhbCA9IGZ1bmN0aW9uKG1vZGVsKSB7XG5cdHZhciBpZF9vcmRlciA9IG1vZGVsLmdldElkT3JkZXIodHJ1ZSkuc2xpY2UoKTtcblx0aWRfb3JkZXIuc29ydChmdW5jdGlvbihhLGIpIHtcblx0ICAgIHJldHVybiBhLmxvY2FsZUNvbXBhcmUoYik7XG5cdH0pO1xuXHRtb2RlbC5zZXRJZE9yZGVyKGlkX29yZGVyKTtcbiAgICB9O1xuICAgIHZhciBzb3J0QnlUcmFja3MgPSBmdW5jdGlvbihtb2RlbCkge1xuXHR2YXIgdHJhY2tfZ3JvdXBfc29ydF9wcmlvcml0eSA9IG1vZGVsLnRyYWNrX2dyb3VwX3NvcnRfcHJpb3JpdHk7XG5cdHZhciB0cmFja19ncm91cHMgPSBtb2RlbC5nZXRUcmFja0dyb3VwcygpO1xuXHR2YXIgdHJhY2tfZ3JvdXBzX2luX3NvcnRfb3JkZXI7XG5cdFxuXHRpZiAodHJhY2tfZ3JvdXBfc29ydF9wcmlvcml0eS5sZW5ndGggPCB0cmFja19ncm91cHMubGVuZ3RoKSB7XG5cdCAgICB0cmFja19ncm91cHNfaW5fc29ydF9vcmRlciA9IHRyYWNrX2dyb3Vwcztcblx0fSBlbHNlIHtcblx0ICAgIHRyYWNrX2dyb3Vwc19pbl9zb3J0X29yZGVyID0gdHJhY2tfZ3JvdXBfc29ydF9wcmlvcml0eS5tYXAoZnVuY3Rpb24oeCkge1xuXHRcdHJldHVybiB0cmFja19ncm91cHNbeF07XG5cdCAgICB9KTtcblx0fVxuXHRcblx0dmFyIHRyYWNrX3NvcnRfcHJpb3JpdHkgPSB0cmFja19ncm91cHNfaW5fc29ydF9vcmRlci5yZWR1Y2UoZnVuY3Rpb24oYWNjLCBuZXh0KSB7XG5cdCAgICByZXR1cm4gYWNjLmNvbmNhdChuZXh0KTtcblx0fSwgW10pO1xuXHRcblx0dmFyIHByZWNvbXB1dGVkX2NvbXBhcmF0b3IgPSBtb2RlbC5wcmVjb21wdXRlZF9jb21wYXJhdG9yLmdldCgpO1xuXHR2YXIgY3Vycl9pZF90b19pbmRleCA9IG1vZGVsLmdldElkVG9JbmRleE1hcCgpO1xuXHR2YXIgY29tYmluZWRDb21wYXJhdG9yID0gZnVuY3Rpb24oaWRBLCBpZEIpIHtcblx0ICAgIHZhciByZXMgPSAwO1xuXHQgICAgZm9yICh2YXIgaT0wOyBpPHRyYWNrX3NvcnRfcHJpb3JpdHkubGVuZ3RoOyBpKyspIHtcblx0XHRyZXMgPSBwcmVjb21wdXRlZF9jb21wYXJhdG9yW3RyYWNrX3NvcnRfcHJpb3JpdHlbaV1dLmNvbXBhcmUoaWRBLCBpZEIpO1xuXHRcdGlmIChyZXMgIT09IDApIHtcblx0XHQgICAgYnJlYWs7XG5cdFx0fVxuXHQgICAgfVxuXHQgICAgaWYgKHJlcyA9PT0gMCkge1xuXHRcdC8vIHN0YWJsZSBzb3J0XG5cdFx0cmVzID0gKCBjdXJyX2lkX3RvX2luZGV4W2lkQV0gPCBjdXJyX2lkX3RvX2luZGV4W2lkQl0gPyAtMSA6IDEpOyAvLyB3aWxsIG5ldmVyIGJlIHRoZSBzYW1lLCBubyBuZWVkIHRvIGNoZWNrIGZvciAwXG5cdCAgICB9XG5cdCAgICByZXR1cm4gcmVzO1xuXHR9XG5cdHZhciBpZF9vcmRlciA9IG1vZGVsLmdldElkT3JkZXIodHJ1ZSkuc2xpY2UoKTtcblx0aWRfb3JkZXIuc29ydChjb21iaW5lZENvbXBhcmF0b3IpO1xuXHRtb2RlbC5zZXRJZE9yZGVyKGlkX29yZGVyKTtcbiAgICB9O1xuICAgIE9uY29wcmludE1vZGVsLnByb3RvdHlwZS5zb3J0ID0gZnVuY3Rpb24oKSB7XG5cdHRoaXMuc29ydF9jb25maWcgPSB0aGlzLnNvcnRfY29uZmlnIHx8IHt9O1xuXHRpZiAodGhpcy5zb3J0X2NvbmZpZy50eXBlID09PSBcImFscGhhYmV0aWNhbFwiKSB7XG5cdCAgICBzb3J0QWxwaGFiZXRpY2FsKHRoaXMpO1xuXHR9IGVsc2UgaWYgKHRoaXMuc29ydF9jb25maWcudHlwZSA9PT0gXCJvcmRlclwiKSB7XG5cdCAgICB0aGlzLnNldElkT3JkZXIodGhpcy5zb3J0X2NvbmZpZy5vcmRlcik7XG5cdH0gZWxzZSB7XG5cdCAgICBzb3J0QnlUcmFja3ModGhpcyk7XG5cdH1cbiAgICB9XG4gICAgXG4gICAgT25jb3ByaW50TW9kZWwucHJvdG90eXBlLnNldFNvcnRDb25maWcgPSBmdW5jdGlvbihwYXJhbXMpIHtcblx0dGhpcy5zb3J0X2NvbmZpZyA9IHBhcmFtcztcbiAgICB9XG5cbiAgICByZXR1cm4gT25jb3ByaW50TW9kZWw7XG59KSgpO1xuXG52YXIgUHJlY29tcHV0ZWRDb21wYXJhdG9yID0gKGZ1bmN0aW9uKCkge1xuICAgIGZ1bmN0aW9uIFByZWNvbXB1dGVkQ29tcGFyYXRvcihsaXN0LCBjb21wYXJhdG9yLCBzb3J0X2RpcmVjdGlvbiwgZWxlbWVudF9pZGVudGlmaWVyX2tleSkge1xuXHR2YXIgZGlyZWN0ZWRfY29tcGFyYXRvciA9IGZ1bmN0aW9uKGQxLCBkMikge1xuXHQgICAgaWYgKHNvcnRfZGlyZWN0aW9uID09PSAwKSB7XG5cdFx0cmV0dXJuIDA7XG5cdCAgICB9XG5cdCAgICB2YXIgcmVzID0gY29tcGFyYXRvcihkMSwgZDIpO1xuXHQgICAgaWYgKHJlcyA9PT0gMikge1xuXHRcdHJldHVybiAxO1xuXHQgICAgfSBlbHNlIGlmIChyZXMgPT09IC0yKSB7XG5cdFx0cmV0dXJuIC0xO1xuXHQgICAgfSBlbHNlIHtcblx0XHRyZXR1cm4gcmVzKnNvcnRfZGlyZWN0aW9uO1xuXHQgICAgfVxuXHR9O1xuXHR2YXIgc29ydGVkX2xpc3QgPSBsaXN0LnNvcnQoZGlyZWN0ZWRfY29tcGFyYXRvcik7XG5cdHRoaXMuY2hhbmdlX3BvaW50cyA9IFtdOyAvLyBpIGlzIGEgY2hhbmdlIHBvaW50IGlmZiBjb21wKGVsdFtpXSwgZWx0W2krMV0pICE9PSAwXG5cdGZvciAodmFyIGk9MDsgaTxzb3J0ZWRfbGlzdC5sZW5ndGg7IGkrKykge1xuXHQgICAgaWYgKGkgPT09IHNvcnRlZF9saXN0Lmxlbmd0aCAtIDEpIHtcblx0XHRicmVhaztcblx0ICAgIH1cblx0ICAgIGlmIChkaXJlY3RlZF9jb21wYXJhdG9yKHNvcnRlZF9saXN0W2ldLCBzb3J0ZWRfbGlzdFtpKzFdKSAhPT0gMCkge1xuXHRcdHRoaXMuY2hhbmdlX3BvaW50cy5wdXNoKGkpO1xuXHQgICAgfVxuXHR9XG5cdC8vIE5vdGUgdGhhdCBieSB0aGlzIHByb2Nlc3MgY2hhbmdlX3BvaW50cyBpcyBzb3J0ZWRcblx0dGhpcy5pZF90b19pbmRleCA9IHt9O1xuXHRmb3IgKHZhciBpPTA7IGk8c29ydGVkX2xpc3QubGVuZ3RoOyBpKyspIHtcblx0ICAgIHRoaXMuaWRfdG9faW5kZXhbc29ydGVkX2xpc3RbaV1bZWxlbWVudF9pZGVudGlmaWVyX2tleV1dID0gaTtcblx0fVxuICAgIH1cbiAgICBQcmVjb21wdXRlZENvbXBhcmF0b3IucHJvdG90eXBlLmNvbXBhcmUgPSBmdW5jdGlvbihpZEEsIGlkQikge1xuXHR2YXIgaW5kQSA9IHRoaXMuaWRfdG9faW5kZXhbaWRBXTtcblx0dmFyIGluZEIgPSB0aGlzLmlkX3RvX2luZGV4W2lkQl07XG5cdGlmICh0eXBlb2YgaW5kQSA9PT0gJ3VuZGVmaW5lZCcgJiYgdHlwZW9mIGluZEIgPT09ICd1bmRlZmluZWQnKSB7XG5cdCAgICByZXR1cm4gMDtcblx0fSBlbHNlIGlmICh0eXBlb2YgaW5kQSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0ICAgIHJldHVybiAxO1xuXHR9IGVsc2UgaWYgKHR5cGVvZiBpbmRCID09PSAndW5kZWZpbmVkJykge1xuXHQgICAgcmV0dXJuIC0xO1xuXHR9XG5cdFxuXHR2YXIgc2hvdWxkX25lZ2F0ZV9yZXN1bHQgPSBmYWxzZTtcblx0aWYgKGluZEEgPT09IGluZEIpIHtcblx0ICAgIHJldHVybiAwO1xuXHR9IGVsc2UgaWYgKGluZEEgPiBpbmRCKSB7XG5cdCAgICAvLyBzd2l0Y2ggaWYgbmVjZXNzYXJ5IHRvIG1ha2UgcHJvY2VzcyBXTE9HXG5cdCAgICB2YXIgdG1wID0gaW5kQTtcblx0ICAgIGluZEEgPSBpbmRCO1xuXHQgICAgaW5kQiA9IHRtcDtcblx0ICAgIHNob3VsZF9uZWdhdGVfcmVzdWx0ID0gdHJ1ZTtcblx0fVxuXHQvLyBTZWUgaWYgYW55IGNoYW5nZXBvaW50cyBpbiBbaW5kQSwgaW5kQilcblx0dmFyIHVwcGVyX2JkX2V4Y2wgPSB0aGlzLmNoYW5nZV9wb2ludHMubGVuZ3RoO1xuXHR2YXIgbG93ZXJfYmRfaW5jbCA9IDA7XG5cdHZhciBtaWRkbGU7XG5cdHZhciByZXMgPSAwO1xuXHR3aGlsZSAodHJ1ZSkge1xuXHQgICAgbWlkZGxlID0gTWF0aC5mbG9vcigobG93ZXJfYmRfaW5jbCArIHVwcGVyX2JkX2V4Y2wpIC8gMik7XG5cdCAgICBpZiAobG93ZXJfYmRfaW5jbCA9PT0gdXBwZXJfYmRfZXhjbCkge1xuXHRcdGJyZWFrO1xuXHQgICAgfSBlbHNlIGlmICh0aGlzLmNoYW5nZV9wb2ludHNbbWlkZGxlXSA+PSBpbmRCKSB7XG5cdFx0dXBwZXJfYmRfZXhjbCA9IG1pZGRsZTtcblx0ICAgIH0gZWxzZSBpZiAodGhpcy5jaGFuZ2VfcG9pbnRzW21pZGRsZV0gPCBpbmRBKSB7XG5cdFx0bG93ZXJfYmRfaW5jbCA9IG1pZGRsZSsxO1xuXHQgICAgfSBlbHNlIHtcblx0XHRyZXMgPSAtMTtcblx0XHRicmVhaztcblx0ICAgIH1cblx0fVxuXHRpZiAoc2hvdWxkX25lZ2F0ZV9yZXN1bHQpIHtcblx0ICAgIHJlcyA9IHJlcyAqIC0xO1xuXHR9XG5cdHJldHVybiByZXM7XG4gICAgfVxuICAgIHJldHVybiBQcmVjb21wdXRlZENvbXBhcmF0b3I7XG59KSgpO1xubW9kdWxlLmV4cG9ydHMgPSBPbmNvcHJpbnRNb2RlbDsiLCIvKiBSdWxlOlxuICogXG4gKiBjb25kaXRpb246IGZ1bmN0aW9uIGZyb20gZGF0dW0gdG8gYm9vbGVhblxuICogc2hhcGVzIC0gYSBsaXN0IG9mIFNoYXBlc1xuICogbGVnZW5kX2xhYmVsXG4gKiBleGNsdWRlX2Zyb21fbGVnZW5kXG4gKiBcbiAqIFNoYXBlOlxuICogdHlwZVxuICogeFxuICogeVxuICogLi4uIHNoYXBlLXNwZWNpZmljIGF0dHJzIC4uLlxuICogXG4gKiBBdHRycyBieSBzaGFwZTpcbiAqIFxuICogcmVjdGFuZ2xlOiB4LCB5LCB3aWR0aCwgaGVpZ2h0LCBzdHJva2UsIHN0cm9rZS13aWR0aCwgZmlsbFxuICogdHJpYW5nbGU6IHgxLCB5MSwgeDIsIHkyLCB4MywgeTMsIHN0cm9rZSwgc3Ryb2tlLXdpZHRoLCBmaWxsXG4gKiBlbGxpcHNlOiB4LCB5LCB3aWR0aCwgaGVpZ2h0LCBzdHJva2UsIHN0cm9rZS13aWR0aCwgZmlsbFxuICogbGluZTogeDEsIHkxLCB4MiwgeTIsIHN0cm9rZSwgc3Ryb2tlLXdpZHRoXG4gKi9cblxudmFyIFNoYXBlID0gcmVxdWlyZSgnLi9vbmNvcHJpbnRzaGFwZS5qcycpO1xudmFyIGV4dHJhY3RSR0JBID0gcmVxdWlyZSgnLi9leHRyYWN0cmdiYS5qcycpO1xudmFyIGhlYXRtYXBDb2xvcnMgPSByZXF1aXJlKCcuL2hlYXRtYXBjb2xvcnMuanMnKTtcbnZhciBiaW5hcnlzZWFyY2ggPSByZXF1aXJlKCcuL2JpbmFyeXNlYXJjaC5qcycpO1xuXG5mdW5jdGlvbiBpZm5kZWYoeCwgdmFsKSB7XG4gICAgcmV0dXJuICh0eXBlb2YgeCA9PT0gXCJ1bmRlZmluZWRcIiA/IHZhbCA6IHgpO1xufVxuXG5mdW5jdGlvbiBtYWtlSWRDb3VudGVyKCkge1xuICAgIHZhciBpZCA9IDA7XG4gICAgcmV0dXJuIGZ1bmN0aW9uICgpIHtcblx0aWQgKz0gMTtcblx0cmV0dXJuIGlkO1xuICAgIH07XG59XG5cbmZ1bmN0aW9uIGludFJhbmdlKGxlbmd0aCkge1xuICAgIHZhciByZXQgPSBbXTtcbiAgICBmb3IgKHZhciBpPTA7IGk8bGVuZ3RoOyBpKyspIHtcblx0cmV0LnB1c2goaSk7XG4gICAgfVxuICAgIHJldHVybiByZXQ7XG59XG5cbmZ1bmN0aW9uIG1ha2VVbmlxdWVDb2xvckdldHRlcihpbml0X3VzZWRfY29sb3JzKSB7XG4gICAgaW5pdF91c2VkX2NvbG9ycyA9IGluaXRfdXNlZF9jb2xvcnMgfHwgW107XG4gICAgdmFyIGNvbG9ycyA9IFtcIiMzMzY2Y2NcIiwgXCIjZGMzOTEyXCIsIFwiI2ZmOTkwMFwiLCBcIiMxMDk2MThcIixcblx0XCIjOTkwMDk5XCIsIFwiIzAwOTljNlwiLCBcIiNkZDQ0NzdcIiwgXCIjNjZhYTAwXCIsXG5cdFwiI2I4MmUyZVwiLCBcIiMzMTYzOTVcIiwgXCIjOTk0NDk5XCIsIFwiIzIyYWE5OVwiLFxuXHRcIiNhYWFhMTFcIiwgXCIjNjYzM2NjXCIsIFwiI2U2NzMwMFwiLCBcIiM4YjA3MDdcIixcblx0XCIjNjUxMDY3XCIsIFwiIzMyOTI2MlwiLCBcIiM1NTc0YTZcIiwgXCIjM2IzZWFjXCIsXG5cdFwiI2I3NzMyMlwiLCBcIiMxNmQ2MjBcIiwgXCIjYjkxMzgzXCIsIFwiI2Y0MzU5ZVwiLFxuXHRcIiM5YzU5MzVcIiwgXCIjYTljNDEzXCIsIFwiIzJhNzc4ZFwiLCBcIiM2NjhkMWNcIixcblx0XCIjYmVhNDEzXCIsIFwiIzBjNTkyMlwiLCBcIiM3NDM0MTFcIl07IC8vIFNvdXJjZTogRDNcbiAgICB2YXIgaW5kZXggPSAwO1xuICAgIHZhciB1c2VkX2NvbG9ycyA9IHt9O1xuICAgIGZvciAodmFyIGk9MDsgaTxpbml0X3VzZWRfY29sb3JzLmxlbmd0aDsgaSsrKSB7XG5cdHVzZWRfY29sb3JzW2luaXRfdXNlZF9jb2xvcnNbaV1dID0gdHJ1ZTtcbiAgICB9XG4gICAgcmV0dXJuIGZ1bmN0aW9uKCkge1xuXHR2YXIgbmV4dF9jb2xvciA9IGNvbG9yc1tpbmRleCAlIGNvbG9ycy5sZW5ndGhdO1xuXHR3aGlsZSAodXNlZF9jb2xvcnNbbmV4dF9jb2xvcl0pIHtcblx0ICAgIHZhciBkYXJrZXJfbmV4dF9jb2xvciA9IGRhcmtlbkhleENvbG9yKG5leHRfY29sb3IpO1xuXHQgICAgaWYgKGRhcmtlcl9uZXh0X2NvbG9yID09PSBuZXh0X2NvbG9yKSB7XG5cdFx0YnJlYWs7XG5cdCAgICB9XG5cdCAgICBuZXh0X2NvbG9yID0gZGFya2VyX25leHRfY29sb3I7XG5cdH1cblx0dXNlZF9jb2xvcnNbbmV4dF9jb2xvcl0gPSB0cnVlO1xuXHRpbmRleCArPSAxO1xuXHRcblx0cmV0dXJuIG5leHRfY29sb3I7XG4gICAgfTtcbn07XG5cbmZ1bmN0aW9uIHNoYWxsb3dFeHRlbmQodGFyZ2V0LCBzb3VyY2UpIHtcbiAgICB2YXIgcmV0ID0ge307XG4gICAgZm9yICh2YXIga2V5IGluIHRhcmdldCkge1xuXHRpZiAodGFyZ2V0Lmhhc093blByb3BlcnR5KGtleSkpIHtcblx0ICAgIHJldFtrZXldID0gdGFyZ2V0W2tleV07XG5cdH1cbiAgICB9XG4gICAgZm9yICh2YXIga2V5IGluIHNvdXJjZSkge1xuXHRpZiAoc291cmNlLmhhc093blByb3BlcnR5KGtleSkpIHtcblx0ICAgIHJldFtrZXldID0gc291cmNlW2tleV07XG5cdH1cbiAgICB9XG4gICAgcmV0dXJuIHJldDtcbn1cblxuZnVuY3Rpb24gb2JqZWN0VmFsdWVzKG9iaikge1xuICAgIHJldHVybiBPYmplY3Qua2V5cyhvYmopLm1hcChmdW5jdGlvbihrZXkpIHsgcmV0dXJuIG9ialtrZXldOyB9KTtcbn1cblxudmFyIG1ha2VOQVNoYXBlcyA9IGZ1bmN0aW9uKHopIHtcbiAgICByZXR1cm4gW3tcblx0J3R5cGUnOiAncmVjdGFuZ2xlJyxcblx0J2ZpbGwnOiAncmdiYSgyMjQsIDIyNCwgMjI0LCAxKScsXG5cdCd6JzogelxuICAgIH1dO1xufTtcbnZhciBOQV9TVFJJTkcgPSBcIm5hXCI7XG52YXIgTkFfTEFCRUwgPSBcIk4vQVwiO1xuXG52YXIgY29sb3JUb0hleCA9IGZ1bmN0aW9uKHN0cikge1xuICAgIHZhciByO1xuICAgIHZhciBnO1xuICAgIHZhciBiO1xuICAgIHZhciByZ2JhX21hdGNoID0gc3RyLm1hdGNoKC9eW1xcc10qcmdiYVxcKFtcXHNdKihbMC05XSspW1xcc10qLFtcXHNdKihbMC05XSspW1xcc10qLFtcXHNdKihbMC05XSspW1xcc10qLFtcXHNdKihbMC05Ll0rKVtcXHNdKlxcKVtcXHNdKiQvKTtcbiAgICBpZiAocmdiYV9tYXRjaCAmJiByZ2JhX21hdGNoLmxlbmd0aCA9PT0gNSkge1xuXHRyID0gcGFyc2VJbnQocmdiYV9tYXRjaFsxXSkudG9TdHJpbmcoMTYpO1xuXHRnID0gcGFyc2VJbnQocmdiYV9tYXRjaFsyXSkudG9TdHJpbmcoMTYpO1xuXHRiID0gcGFyc2VJbnQocmdiYV9tYXRjaFszXSkudG9TdHJpbmcoMTYpO1xuXHRpZiAoci5sZW5ndGggPT09IDEpIHtcblx0ICAgIHIgPSAnMCcgKyByO1xuXHR9XG5cdGlmIChnLmxlbmd0aCA9PT0gMSkge1xuXHQgICAgZyA9ICcwJyArIGc7XG5cdH1cblx0aWYgKGIubGVuZ3RoID09PSAxKSB7XG5cdCAgICBiID0gJzAnICsgYjtcblx0fVxuXHRyZXR1cm4gJyMnICsgciArIGcgKyBiO1xuICAgIH1cbiAgICBcbiAgICB2YXIgcmdiX21hdGNoID0gc3RyLm1hdGNoKC9eW1xcc10qcmdiXFwoW1xcc10qKFswLTldKylbXFxzXSosW1xcc10qKFswLTldKylbXFxzXSosW1xcc10qKFswLTldKylbXFxzXSpcXClbXFxzXSokLyk7XG4gICAgaWYgKHJnYl9tYXRjaCAmJiByZ2JfbWF0Y2gubGVuZ3RoID09PSA0KSB7XG5cdHIgPSBwYXJzZUludChyZ2JfbWF0Y2hbMV0pLnRvU3RyaW5nKDE2KTtcblx0ZyA9IHBhcnNlSW50KHJnYl9tYXRjaFsyXSkudG9TdHJpbmcoMTYpO1xuXHRiID0gcGFyc2VJbnQocmdiX21hdGNoWzNdKS50b1N0cmluZygxNik7XG5cdGlmIChyLmxlbmd0aCA9PT0gMSkge1xuXHQgICAgciA9ICcwJyArIHI7XG5cdH1cblx0aWYgKGcubGVuZ3RoID09PSAxKSB7XG5cdCAgICBnID0gJzAnICsgZztcblx0fVxuXHRpZiAoYi5sZW5ndGggPT09IDEpIHtcblx0ICAgIGIgPSAnMCcgKyBiO1xuXHR9XG5cdHJldHVybiAnIycgKyByICsgZyArIGI7XG4gICAgfVxuICAgIFxuICAgIHJldHVybiBzdHI7XG59O1xuXG52YXIgZGFya2VuSGV4Q29sb3IgPSBmdW5jdGlvbihzdHIpIHtcbiAgICB2YXIgciA9IHN0clsxXSArIHN0clsyXTtcbiAgICB2YXIgZyA9IHN0clszXSArIHN0cls0XTtcbiAgICB2YXIgYiA9IHN0cls1XSArIHN0cls2XTtcbiAgICB2YXIgZGFya2VuSGV4Q2hhbm5lbCA9IGZ1bmN0aW9uKGMpIHtcblx0YyA9IHBhcnNlSW50KGMsIDE2KTtcblx0YyAqPSAwLjk1O1xuXHRjID0gTWF0aC5yb3VuZChjKTtcblx0YyA9IGMudG9TdHJpbmcoMTYpO1xuXHRpZiAoYy5sZW5ndGggPT09IDEpIHtcblx0ICAgIGMgPSAnMCcgKyBjO1xuXHR9XG5cdHJldHVybiBjO1xuICAgIH07XG4gICAgciA9IGRhcmtlbkhleENoYW5uZWwocik7XG4gICAgZyA9IGRhcmtlbkhleENoYW5uZWwoZyk7XG4gICAgYiA9IGRhcmtlbkhleENoYW5uZWwoYik7XG4gICAgcmV0dXJuICcjJyArIHIgKyBnICsgYjtcbn07XG5cbnZhciBSdWxlU2V0ID0gKGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgZ2V0UnVsZVNldElkID0gbWFrZUlkQ291bnRlcigpO1xuICAgIHZhciBnZXRSdWxlSWQgPSBtYWtlSWRDb3VudGVyKCk7XG5cbiAgICBmdW5jdGlvbiBSdWxlU2V0KHBhcmFtcykge1xuXHQvKiBwYXJhbXM6XG5cdCAqIC0gbGVnZW5kX2xhYmVsXG5cdCAqIC0gZXhjbHVkZV9mcm9tX2xlZ2VuZFxuXHQgKi9cblx0dGhpcy5ydWxlX3NldF9pZCA9IGdldFJ1bGVTZXRJZCgpO1xuXHR0aGlzLmxlZ2VuZF9sYWJlbCA9IHBhcmFtcy5sZWdlbmRfbGFiZWw7XG5cdHRoaXMuZXhjbHVkZV9mcm9tX2xlZ2VuZCA9IHBhcmFtcy5leGNsdWRlX2Zyb21fbGVnZW5kO1xuXHR0aGlzLmFjdGl2ZV9ydWxlX2lkcyA9IHt9O1xuXHR0aGlzLnJ1bGVzX3dpdGhfaWQgPSBbXTtcblxuICAgIH1cblxuICAgIFJ1bGVTZXQucHJvdG90eXBlLmdldExlZ2VuZExhYmVsID0gZnVuY3Rpb24gKCkge1xuXHRyZXR1cm4gdGhpcy5sZWdlbmRfbGFiZWw7XG4gICAgfVxuXG4gICAgUnVsZVNldC5wcm90b3R5cGUuZ2V0UnVsZVNldElkID0gZnVuY3Rpb24gKCkge1xuXHRyZXR1cm4gdGhpcy5ydWxlX3NldF9pZDtcbiAgICB9XG5cbiAgICBSdWxlU2V0LnByb3RvdHlwZS5hZGRSdWxlcyA9IGZ1bmN0aW9uIChsaXN0X29mX3BhcmFtcykge1xuXHR2YXIgc2VsZiA9IHRoaXM7XG5cdHJldHVybiBsaXN0X29mX3BhcmFtcy5tYXAoZnVuY3Rpb24gKHBhcmFtcykge1xuXHQgICAgcmV0dXJuIHNlbGYuYWRkUnVsZShwYXJhbXMpO1xuXHR9KTtcbiAgICB9XG5cbiAgICBSdWxlU2V0LnByb3RvdHlwZS5hZGRSdWxlID0gZnVuY3Rpb24gKHBhcmFtcykge1xuXHR2YXIgcnVsZV9pZCA9IGdldFJ1bGVJZCgpO1xuXHR0aGlzLnJ1bGVzX3dpdGhfaWQucHVzaCh7aWQ6IHJ1bGVfaWQsIHJ1bGU6IG5ldyBSdWxlKHBhcmFtcyl9KTtcblx0cmV0dXJuIHJ1bGVfaWQ7XG4gICAgfVxuXG4gICAgUnVsZVNldC5wcm90b3R5cGUucmVtb3ZlUnVsZSA9IGZ1bmN0aW9uIChydWxlX2lkKSB7XG5cdHZhciBpbmRleCA9IC0xO1xuXHRmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMucnVsZXNfd2l0aF9pZC5sZW5ndGg7IGkrKykge1xuXHQgICAgaWYgKHRoaXMucnVsZXNfd2l0aF9pZFtpXS5pZCA9PT0gcnVsZV9pZCkge1xuXHRcdGluZGV4ID0gaTtcblx0XHRicmVhaztcblx0ICAgIH1cblx0fVxuXHRpZiAoaW5kZXggPiAtMSkge1xuXHQgICAgdGhpcy5ydWxlc193aXRoX2lkLnNwbGljZShpbmRleCwgMSk7XG5cdH1cblx0ZGVsZXRlIHRoaXMuYWN0aXZlX3J1bGVfaWRzW3J1bGVfaWRdO1xuICAgIH1cblxuICAgIFJ1bGVTZXQucHJvdG90eXBlLmdldFJ1bGVXaXRoSWQgPSBmdW5jdGlvbiAocnVsZV9pZCkge1xuXHR2YXIgcmV0ID0gbnVsbDtcblx0Zm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLnJ1bGVzX3dpdGhfaWQubGVuZ3RoOyBpKyspIHtcblx0ICAgIGlmICh0aGlzLnJ1bGVzX3dpdGhfaWRbaV0uaWQgPT09IHJ1bGVfaWQpIHtcblx0XHRyZXQgPSB0aGlzLnJ1bGVzX3dpdGhfaWRbaV07XG5cdFx0YnJlYWs7XG5cdCAgICB9XG5cdH1cblx0cmV0dXJuIHJldDtcbiAgICB9XG5cbiAgICBSdWxlU2V0LnByb3RvdHlwZS5pc0V4Y2x1ZGVkRnJvbUxlZ2VuZCA9IGZ1bmN0aW9uICgpIHtcblx0cmV0dXJuIHRoaXMuZXhjbHVkZV9mcm9tX2xlZ2VuZDtcbiAgICB9XG5cbiAgICBSdWxlU2V0LnByb3RvdHlwZS5nZXRSZWNlbnRseVVzZWRSdWxlcyA9IGZ1bmN0aW9uICgpIHtcblx0dmFyIHNlbGYgPSB0aGlzO1xuXHRyZXR1cm4gT2JqZWN0LmtleXModGhpcy5hY3RpdmVfcnVsZV9pZHMpLm1hcChcblx0XHRmdW5jdGlvbiAocnVsZV9pZCkge1xuXHRcdCAgICByZXR1cm4gc2VsZi5nZXRSdWxlKHJ1bGVfaWQpO1xuXHRcdH0pO1xuICAgIH1cblxuICAgIFJ1bGVTZXQucHJvdG90eXBlLmFwcGx5UnVsZXNUb0RhdHVtID0gZnVuY3Rpb24gKHJ1bGVzX3dpdGhfaWQsIGRhdHVtLCBjZWxsX3dpZHRoLCBjZWxsX2hlaWdodCkge1xuXHR2YXIgc2hhcGVzID0gW107XG5cdHZhciBydWxlc19sZW4gPSBydWxlc193aXRoX2lkLmxlbmd0aDtcblx0Zm9yICh2YXIgaiA9IDA7IGogPCBydWxlc19sZW47IGorKykge1xuXHQgICAgc2hhcGVzID0gc2hhcGVzLmNvbmNhdChydWxlc193aXRoX2lkW2pdLnJ1bGUuYXBwbHkoZGF0dW0sIGNlbGxfd2lkdGgsIGNlbGxfaGVpZ2h0KSk7XG5cdH1cblx0cmV0dXJuIHNoYXBlcztcbiAgICB9XG4gICAgUnVsZVNldC5wcm90b3R5cGUuYXBwbHkgPSBmdW5jdGlvbiAoZGF0YSwgY2VsbF93aWR0aCwgY2VsbF9oZWlnaHQsIG91dF9hY3RpdmVfcnVsZXMpIHtcblx0Ly8gUmV0dXJucyBhIGxpc3Qgb2YgbGlzdHMgb2YgY29uY3JldGUgc2hhcGVzLCBpbiB0aGUgc2FtZSBvcmRlciBhcyBkYXRhXG5cdHZhciByZXQgPSBbXTtcblx0Zm9yICh2YXIgaSA9IDA7IGkgPCBkYXRhLmxlbmd0aDsgaSsrKSB7XG5cdCAgICB2YXIgcnVsZXMgPSB0aGlzLmdldFJ1bGVzV2l0aElkKGRhdGFbaV0pO1xuXHQgICAgaWYgKHR5cGVvZiBvdXRfYWN0aXZlX3J1bGVzICE9PSAndW5kZWZpbmVkJykge1xuXHRcdGZvciAodmFyIGogPSAwOyBqIDwgcnVsZXMubGVuZ3RoOyBqKyspIHtcblx0XHQgICAgb3V0X2FjdGl2ZV9ydWxlc1tydWxlc1tqXS5pZF0gPSB0cnVlO1xuXHRcdH1cblx0ICAgIH1cblx0ICAgIHJldC5wdXNoKHRoaXMuYXBwbHlSdWxlc1RvRGF0dW0ocnVsZXMsIGRhdGFbaV0sIGNlbGxfd2lkdGgsIGNlbGxfaGVpZ2h0KSk7XG5cdH1cblx0cmV0dXJuIHJldDtcbiAgICB9XG5cbiAgICByZXR1cm4gUnVsZVNldDtcbn0pKCk7XG5cbnZhciBMb29rdXBSdWxlU2V0ID0gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBMb29rdXBSdWxlU2V0KHBhcmFtcykge1xuXHRSdWxlU2V0LmNhbGwodGhpcywgcGFyYW1zKTtcblx0dGhpcy5sb29rdXBfbWFwX2J5X2tleV9hbmRfdmFsdWUgPSB7fTtcblx0dGhpcy5sb29rdXBfbWFwX2J5X2tleSA9IHt9O1xuXHR0aGlzLnVuaXZlcnNhbF9ydWxlcyA9IFtdO1xuXG5cdHRoaXMucnVsZV9pZF90b19jb25kaXRpb25zID0ge307XG4gICAgfVxuICAgIExvb2t1cFJ1bGVTZXQucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShSdWxlU2V0LnByb3RvdHlwZSk7XG5cbiAgICBMb29rdXBSdWxlU2V0LnByb3RvdHlwZS5nZXRSdWxlc1dpdGhJZCA9IGZ1bmN0aW9uIChkYXR1bSkge1xuXHRpZiAodHlwZW9mIGRhdHVtID09PSAndW5kZWZpbmVkJykge1xuXHQgICAgcmV0dXJuIHRoaXMucnVsZXNfd2l0aF9pZDtcblx0fVxuXHR2YXIgcmV0ID0gW107XG5cdHJldCA9IHJldC5jb25jYXQodGhpcy51bml2ZXJzYWxfcnVsZXMpO1xuXHRmb3IgKHZhciBrZXkgaW4gZGF0dW0pIHtcblx0ICAgIGlmICh0eXBlb2YgZGF0dW1ba2V5XSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHR2YXIga2V5X3J1bGUgPSB0aGlzLmxvb2t1cF9tYXBfYnlfa2V5W2tleV07XG5cdFx0aWYgKHR5cGVvZiBrZXlfcnVsZSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHQgICAgcmV0LnB1c2goa2V5X3J1bGUpO1xuXHRcdH1cblx0XHR2YXIga2V5X2FuZF92YWx1ZV9ydWxlID0gKHRoaXMubG9va3VwX21hcF9ieV9rZXlfYW5kX3ZhbHVlW2tleV0gJiYgdGhpcy5sb29rdXBfbWFwX2J5X2tleV9hbmRfdmFsdWVba2V5XVtkYXR1bVtrZXldXSkgfHwgdW5kZWZpbmVkO1xuXHRcdGlmICh0eXBlb2Yga2V5X2FuZF92YWx1ZV9ydWxlICE9PSAndW5kZWZpbmVkJykge1xuXHRcdCAgICByZXQucHVzaChrZXlfYW5kX3ZhbHVlX3J1bGUpO1xuXHRcdH1cblx0ICAgIH1cblx0fVxuXHRyZXR1cm4gcmV0O1xuICAgIH1cblxuICAgIHZhciBpbmRleFJ1bGVGb3JMb29rdXAgPSBmdW5jdGlvbiAocnVsZV9zZXQsIGNvbmRpdGlvbl9rZXksIGNvbmRpdGlvbl92YWx1ZSwgcnVsZV93aXRoX2lkKSB7XG5cdGlmIChjb25kaXRpb25fa2V5ID09PSBudWxsKSB7XG5cdCAgICBydWxlX3NldC51bml2ZXJzYWxfcnVsZXMucHVzaChydWxlX3dpdGhfaWQpO1xuXHR9IGVsc2Uge1xuXHQgICAgaWYgKGNvbmRpdGlvbl92YWx1ZSA9PT0gbnVsbCkge1xuXHRcdHJ1bGVfc2V0Lmxvb2t1cF9tYXBfYnlfa2V5W2NvbmRpdGlvbl9rZXldID0gcnVsZV93aXRoX2lkO1xuXHQgICAgfSBlbHNlIHtcblx0XHRydWxlX3NldC5sb29rdXBfbWFwX2J5X2tleV9hbmRfdmFsdWVbY29uZGl0aW9uX2tleV0gPSBydWxlX3NldC5sb29rdXBfbWFwX2J5X2tleV9hbmRfdmFsdWVbY29uZGl0aW9uX2tleV0gfHwge307XG5cdFx0cnVsZV9zZXQubG9va3VwX21hcF9ieV9rZXlfYW5kX3ZhbHVlW2NvbmRpdGlvbl9rZXldW2NvbmRpdGlvbl92YWx1ZV0gPSBydWxlX3dpdGhfaWQ7XG5cdCAgICB9XG5cdH1cblx0cnVsZV9zZXQucnVsZV9pZF90b19jb25kaXRpb25zW3J1bGVfd2l0aF9pZC5pZF0gPSBydWxlX3NldC5ydWxlX2lkX3RvX2NvbmRpdGlvbnNbcnVsZV93aXRoX2lkLmlkXSB8fCBbXTtcblx0cnVsZV9zZXQucnVsZV9pZF90b19jb25kaXRpb25zW3J1bGVfd2l0aF9pZC5pZF0ucHVzaCh7a2V5OiBjb25kaXRpb25fa2V5LCB2YWx1ZTogY29uZGl0aW9uX3ZhbHVlfSk7XG4gICAgfTtcblxuICAgIExvb2t1cFJ1bGVTZXQucHJvdG90eXBlLmFkZFJ1bGUgPSBmdW5jdGlvbiAoY29uZGl0aW9uX2tleSwgY29uZGl0aW9uX3ZhbHVlLCBwYXJhbXMpIHtcblx0dmFyIHJ1bGVfaWQgPSBSdWxlU2V0LnByb3RvdHlwZS5hZGRSdWxlLmNhbGwodGhpcywgcGFyYW1zKTtcblxuXHRpbmRleFJ1bGVGb3JMb29rdXAodGhpcywgY29uZGl0aW9uX2tleSwgY29uZGl0aW9uX3ZhbHVlLCB0aGlzLmdldFJ1bGVXaXRoSWQocnVsZV9pZCkpO1xuXG5cdHJldHVybiBydWxlX2lkO1xuICAgIH1cblxuICAgIExvb2t1cFJ1bGVTZXQucHJvdG90eXBlLmxpbmtFeGlzdGluZ1J1bGUgPSBmdW5jdGlvbiAoY29uZGl0aW9uX2tleSwgY29uZGl0aW9uX3ZhbHVlLCBleGlzdGluZ19ydWxlX2lkKSB7XG5cdGluZGV4UnVsZUZvckxvb2t1cCh0aGlzLCBjb25kaXRpb25fa2V5LCBjb25kaXRpb25fdmFsdWUsIHRoaXMuZ2V0UnVsZVdpdGhJZChleGlzdGluZ19ydWxlX2lkKSk7XG4gICAgfVxuXG4gICAgTG9va3VwUnVsZVNldC5wcm90b3R5cGUucmVtb3ZlUnVsZSA9IGZ1bmN0aW9uIChydWxlX2lkKSB7XG5cdFJ1bGVTZXQucHJvdG90eXBlLnJlbW92ZVJ1bGUuY2FsbCh0aGlzLCBydWxlX2lkKTtcblxuXHR3aGlsZSAodGhpcy5ydWxlX2lkX3RvX2NvbmRpdGlvbnNbcnVsZV9pZF0ubGVuZ3RoID4gMCkge1xuXHQgICAgdmFyIGNvbmRpdGlvbiA9IHRoaXMucnVsZV9pZF90b19jb25kaXRpb25zW3J1bGVfaWRdLnBvcCgpO1xuXHQgICAgaWYgKGNvbmRpdGlvbi5rZXkgPT09IG51bGwpIHtcblx0XHR2YXIgaW5kZXggPSAtMTtcblx0XHRmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMudW5pdmVyc2FsX3J1bGVzLmxlbmd0aDsgaSsrKSB7XG5cdFx0ICAgIGlmICh0aGlzLnVuaXZlcnNhbF9ydWxlc1tpXS5pZCA9PT0gcnVsZV9pZCkge1xuXHRcdFx0aW5kZXggPSBpO1xuXHRcdFx0YnJlYWs7XG5cdFx0ICAgIH1cblx0XHR9XG5cdFx0aWYgKGluZGV4ID4gLTEpIHtcblx0XHQgICAgdGhpcy51bml2ZXJzYWxfcnVsZXMuc3BsaWNlKGluZGV4LCAxKTtcblx0XHR9XG5cdCAgICB9IGVsc2Uge1xuXHRcdGlmIChjb25kaXRpb24udmFsdWUgPT09IG51bGwpIHtcblx0XHQgICAgZGVsZXRlIHRoaXMubG9va3VwX21hcF9ieV9rZXlbY29uZGl0aW9uLmtleV07XG5cdFx0fSBlbHNlIHtcblx0XHQgICAgZGVsZXRlIHRoaXMubG9va3VwX21hcF9ieV9rZXlfYW5kX3ZhbHVlW2NvbmRpdGlvbi5rZXldW2NvbmRpdGlvbi52YWx1ZV07XG5cdFx0fVxuXHQgICAgfVxuXHR9XG5cdGRlbGV0ZSB0aGlzLnJ1bGVfaWRfdG9fY29uZGl0aW9uc1tydWxlX2lkXTtcbiAgICB9XG4gICAgcmV0dXJuIExvb2t1cFJ1bGVTZXQ7XG59KSgpO1xuXG52YXIgQ29uZGl0aW9uUnVsZVNldCA9IChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gQ29uZGl0aW9uUnVsZVNldChwYXJhbXMpIHtcblx0UnVsZVNldC5jYWxsKHRoaXMsIHBhcmFtcyk7XG5cdHRoaXMucnVsZV9pZF90b19jb25kaXRpb24gPSB7fTtcblxuXHR0aGlzLmFkZFJ1bGUoZnVuY3Rpb24gKGQpIHtcblx0ICAgIHJldHVybiBkW05BX1NUUklOR10gPT09IHRydWU7XG5cdH0sXG5cdFx0e3NoYXBlczogbWFrZU5BU2hhcGVzKHBhcmFtcy5uYV96IHx8IDEwMDApLFxuXHRcdCAgICBsZWdlbmRfbGFiZWw6IE5BX0xBQkVMLFxuXHRcdCAgICBleGNsdWRlX2Zyb21fbGVnZW5kOiBmYWxzZSxcblx0XHQgICAgbGVnZW5kX2NvbmZpZzogeyd0eXBlJzogJ3J1bGUnLCAndGFyZ2V0JzogeyduYSc6IHRydWV9fVxuXHRcdH0pO1xuICAgIH1cbiAgICBDb25kaXRpb25SdWxlU2V0LnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoUnVsZVNldC5wcm90b3R5cGUpO1xuXG4gICAgQ29uZGl0aW9uUnVsZVNldC5wcm90b3R5cGUuZ2V0UnVsZXNXaXRoSWQgPSBmdW5jdGlvbiAoZGF0dW0pIHtcblx0aWYgKHR5cGVvZiBkYXR1bSA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0ICAgIHJldHVybiB0aGlzLnJ1bGVzX3dpdGhfaWQ7XG5cdH1cblx0dmFyIHJldCA9IFtdO1xuXHRmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMucnVsZXNfd2l0aF9pZC5sZW5ndGg7IGkrKykge1xuXHQgICAgaWYgKHRoaXMucnVsZV9pZF90b19jb25kaXRpb25bdGhpcy5ydWxlc193aXRoX2lkW2ldLmlkXShkYXR1bSkpIHtcblx0XHRyZXQucHVzaCh0aGlzLnJ1bGVzX3dpdGhfaWRbaV0pO1xuXHQgICAgfVxuXHR9XG5cdHJldHVybiByZXQ7XG4gICAgfVxuXG4gICAgQ29uZGl0aW9uUnVsZVNldC5wcm90b3R5cGUuYWRkUnVsZSA9IGZ1bmN0aW9uIChjb25kaXRpb24sIHBhcmFtcykge1xuXHR2YXIgcnVsZV9pZCA9IFJ1bGVTZXQucHJvdG90eXBlLmFkZFJ1bGUuY2FsbCh0aGlzLCBwYXJhbXMpO1xuXHR0aGlzLnJ1bGVfaWRfdG9fY29uZGl0aW9uW3J1bGVfaWRdID0gY29uZGl0aW9uO1xuXHRyZXR1cm4gcnVsZV9pZDtcbiAgICB9XG5cbiAgICBDb25kaXRpb25SdWxlU2V0LnByb3RvdHlwZS5yZW1vdmVSdWxlID0gZnVuY3Rpb24gKHJ1bGVfaWQpIHtcblx0UnVsZVNldC5wcm90b3R5cGUucmVtb3ZlUnVsZS5jYWxsKHRoaXMsIHJ1bGVfaWQpO1xuXHRkZWxldGUgdGhpcy5ydWxlX2lkX3RvX2NvbmRpdGlvbltydWxlX2lkXTtcbiAgICB9XG5cbiAgICByZXR1cm4gQ29uZGl0aW9uUnVsZVNldDtcbn0pKCk7XG5cbnZhciBDYXRlZ29yaWNhbFJ1bGVTZXQgPSAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIENhdGVnb3JpY2FsUnVsZVNldChwYXJhbXMpIHtcblx0LyogcGFyYW1zXG5cdCAqIC0gY2F0ZWdvcnlfa2V5XG5cdCAqIC0gY2F0ZWdvcnlUb0NvbG9yXG5cdCAqL1xuXHRMb29rdXBSdWxlU2V0LmNhbGwodGhpcywgcGFyYW1zKTtcblx0XG5cdHRoaXMuYWRkUnVsZShOQV9TVFJJTkcsIHRydWUsIHtcblx0ICAgIHNoYXBlczogbWFrZU5BU2hhcGVzKHBhcmFtcy5uYV96IHx8IDEwMDApLFxuXHQgICAgbGVnZW5kX2xhYmVsOiBOQV9MQUJFTCxcblx0ICAgIGV4Y2x1ZGVfZnJvbV9sZWdlbmQ6IGZhbHNlLFxuXHQgICAgbGVnZW5kX2NvbmZpZzogeyd0eXBlJzogJ3J1bGUnLCAndGFyZ2V0JzogeyduYSc6IHRydWV9fVxuXHR9KTtcblx0XG5cdHRoaXMuY2F0ZWdvcnlfa2V5ID0gcGFyYW1zLmNhdGVnb3J5X2tleTtcblx0dGhpcy5jYXRlZ29yeV90b19jb2xvciA9IGlmbmRlZihwYXJhbXMuY2F0ZWdvcnlfdG9fY29sb3IsIHt9KTtcblx0dGhpcy5nZXRVbnVzZWRDb2xvciA9IG1ha2VVbmlxdWVDb2xvckdldHRlcihvYmplY3RWYWx1ZXModGhpcy5jYXRlZ29yeV90b19jb2xvcikubWFwKGNvbG9yVG9IZXgpKTtcblx0Zm9yICh2YXIgY2F0ZWdvcnkgaW4gdGhpcy5jYXRlZ29yeV90b19jb2xvcikge1xuXHQgICAgaWYgKHRoaXMuY2F0ZWdvcnlfdG9fY29sb3IuaGFzT3duUHJvcGVydHkoY2F0ZWdvcnkpKSB7XG5cdFx0dmFyIGNvbG9yID0gdGhpcy5jYXRlZ29yeV90b19jb2xvcltjYXRlZ29yeV07XG5cdFx0YWRkQ2F0ZWdvcnlSdWxlKHRoaXMsIGNhdGVnb3J5LCBjb2xvcik7XG5cdFx0dGhpcy51c2VkX2NvbG9yc1tjb2xvclRvSGV4KGNvbG9yKV0gPSB0cnVlO1xuXHQgICAgfVxuXHR9XG4gICAgfVxuICAgIENhdGVnb3JpY2FsUnVsZVNldC5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKExvb2t1cFJ1bGVTZXQucHJvdG90eXBlKTtcblxuICAgIHZhciBhZGRDYXRlZ29yeVJ1bGUgPSBmdW5jdGlvbiAocnVsZXNldCwgY2F0ZWdvcnksIGNvbG9yKSB7XG5cdHZhciBsZWdlbmRfcnVsZV90YXJnZXQgPSB7fTtcblx0bGVnZW5kX3J1bGVfdGFyZ2V0W3J1bGVzZXQuY2F0ZWdvcnlfa2V5XSA9IGNhdGVnb3J5O1xuXHR2YXIgcnVsZV9wYXJhbXMgPSB7XG5cdCAgICBzaGFwZXM6IFt7XG5cdFx0ICAgIHR5cGU6ICdyZWN0YW5nbGUnLFxuXHRcdCAgICBmaWxsOiBjb2xvcixcblx0XHR9XSxcblx0ICAgIGxlZ2VuZF9sYWJlbDogY2F0ZWdvcnksXG5cdCAgICBleGNsdWRlX2Zyb21fbGVnZW5kOiBmYWxzZSxcblx0ICAgIGxlZ2VuZF9jb25maWc6IHsndHlwZSc6ICdydWxlJywgJ3RhcmdldCc6IGxlZ2VuZF9ydWxlX3RhcmdldH1cblx0fTtcblx0cnVsZXNldC5hZGRSdWxlKHJ1bGVzZXQuY2F0ZWdvcnlfa2V5LCBjYXRlZ29yeSwgcnVsZV9wYXJhbXMpO1xuICAgIH07XG5cbiAgICBDYXRlZ29yaWNhbFJ1bGVTZXQucHJvdG90eXBlLmFwcGx5ID0gZnVuY3Rpb24gKGRhdGEsIGNlbGxfd2lkdGgsIGNlbGxfaGVpZ2h0LCBvdXRfYWN0aXZlX3J1bGVzKSB7XG5cdC8vIEZpcnN0IGVuc3VyZSB0aGVyZSBpcyBhIGNvbG9yIGZvciBhbGwgY2F0ZWdvcmllc1xuXHRmb3IgKHZhciBpID0gMCwgZGF0YV9sZW4gPSBkYXRhLmxlbmd0aDsgaSA8IGRhdGFfbGVuOyBpKyspIHtcblx0ICAgIGlmIChkYXRhW2ldW05BX1NUUklOR10pIHtcblx0XHRjb250aW51ZTtcblx0ICAgIH1cblx0ICAgIHZhciBjYXRlZ29yeSA9IGRhdGFbaV1bdGhpcy5jYXRlZ29yeV9rZXldO1xuXHQgICAgaWYgKCF0aGlzLmNhdGVnb3J5X3RvX2NvbG9yLmhhc093blByb3BlcnR5KGNhdGVnb3J5KSkge1xuXHRcdHZhciBjb2xvciA9IHRoaXMuZ2V0VW51c2VkQ29sb3IodGhpcyk7XG5cdFx0XG5cdFx0dGhpcy5jYXRlZ29yeV90b19jb2xvcltjYXRlZ29yeV0gPSBjb2xvcjtcblx0XHRhZGRDYXRlZ29yeVJ1bGUodGhpcywgY2F0ZWdvcnksIGNvbG9yKTtcblx0ICAgIH1cblx0fVxuXHQvLyBUaGVuIHByb3BhZ2F0ZSB0aGUgY2FsbCB1cFxuXHRyZXR1cm4gTG9va3VwUnVsZVNldC5wcm90b3R5cGUuYXBwbHkuY2FsbCh0aGlzLCBkYXRhLCBjZWxsX3dpZHRoLCBjZWxsX2hlaWdodCwgb3V0X2FjdGl2ZV9ydWxlcyk7XG4gICAgfTtcblxuICAgIHJldHVybiBDYXRlZ29yaWNhbFJ1bGVTZXQ7XG59KSgpO1xuXG52YXIgTGluZWFySW50ZXJwUnVsZVNldCA9IChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gTGluZWFySW50ZXJwUnVsZVNldChwYXJhbXMpIHtcblx0LyogcGFyYW1zXG5cdCAqIC0gbG9nX3NjYWxlXG5cdCAqIC0gdmFsdWVfa2V5XG5cdCAqIC0gdmFsdWVfcmFuZ2Vcblx0ICovXG5cdENvbmRpdGlvblJ1bGVTZXQuY2FsbCh0aGlzLCBwYXJhbXMpO1xuXHR0aGlzLnZhbHVlX2tleSA9IHBhcmFtcy52YWx1ZV9rZXk7XG5cdHRoaXMudmFsdWVfcmFuZ2UgPSBwYXJhbXMudmFsdWVfcmFuZ2U7XG5cdHRoaXMubG9nX3NjYWxlID0gcGFyYW1zLmxvZ19zY2FsZTsgLy8gYm9vbGVhblxuXHR0aGlzLmluZmVycmVkX3ZhbHVlX3JhbmdlO1xuXG5cdHRoaXMubWFrZUludGVycEZuID0gZnVuY3Rpb24gKCkge1xuXHQgICAgdmFyIHJhbmdlID0gdGhpcy5nZXRFZmZlY3RpdmVWYWx1ZVJhbmdlKCk7XG5cblx0ICAgIGlmICh0aGlzLmxvZ19zY2FsZSkge1xuXHRcdHZhciBzaGlmdF90b19tYWtlX3BvcyA9IE1hdGguYWJzKHJhbmdlWzBdKSArIDE7XG5cdFx0dmFyIGxvZ19yYW5nZSA9IE1hdGgubG9nKHJhbmdlWzFdICsgc2hpZnRfdG9fbWFrZV9wb3MpIC0gTWF0aC5sb2cocmFuZ2VbMF0gKyBzaGlmdF90b19tYWtlX3Bvcyk7XG5cdFx0dmFyIGxvZ19yYW5nZV9sb3dlciA9IE1hdGgubG9nKHJhbmdlWzBdICsgc2hpZnRfdG9fbWFrZV9wb3MpO1xuXHRcdHJldHVybiBmdW5jdGlvbiAodmFsKSB7XG5cdFx0ICAgIHZhbCA9IHBhcnNlRmxvYXQodmFsKTtcblx0XHQgICAgcmV0dXJuIChNYXRoLmxvZyh2YWwgKyBzaGlmdF90b19tYWtlX3BvcykgLSBsb2dfcmFuZ2VfbG93ZXIpIC8gbG9nX3JhbmdlO1xuXHRcdH07XG5cdCAgICB9IGVsc2Uge1xuXHRcdHZhciByYW5nZV9zcHJlYWQgPSByYW5nZVsxXSAtIHJhbmdlWzBdO1xuXHRcdHZhciByYW5nZV9sb3dlciA9IHJhbmdlWzBdO1xuXHRcdHJldHVybiBmdW5jdGlvbiAodmFsKSB7XG5cdFx0ICAgIHZhbCA9IHBhcnNlRmxvYXQodmFsKTtcblx0XHQgICAgaWYgKHZhbCA8PSByYW5nZVswXSkge1xuXHRcdFx0cmV0dXJuIDA7XG5cdFx0ICAgIH0gZWxzZSBpZiAodmFsID49IHJhbmdlWzFdKSB7XG5cdFx0XHRyZXR1cm4gMTtcblx0XHQgICAgfSBlbHNlIHtcblx0XHRcdHJldHVybiAodmFsIC0gcmFuZ2VfbG93ZXIpIC8gcmFuZ2Vfc3ByZWFkO1xuXHRcdCAgICB9XG5cdFx0fTtcblx0ICAgIH1cblx0fTtcbiAgICB9XG4gICAgTGluZWFySW50ZXJwUnVsZVNldC5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKENvbmRpdGlvblJ1bGVTZXQucHJvdG90eXBlKTtcblxuICAgIExpbmVhckludGVycFJ1bGVTZXQucHJvdG90eXBlLmdldEVmZmVjdGl2ZVZhbHVlUmFuZ2UgPSBmdW5jdGlvbiAoKSB7XG5cdHZhciByZXQgPSAodGhpcy52YWx1ZV9yYW5nZSAmJiB0aGlzLnZhbHVlX3JhbmdlLnNsaWNlKCkpIHx8IFt1bmRlZmluZWQsIHVuZGVmaW5lZF07XG5cdGlmICh0eXBlb2YgcmV0WzBdID09PSBcInVuZGVmaW5lZFwiKSB7XG5cdCAgICByZXRbMF0gPSB0aGlzLmluZmVycmVkX3ZhbHVlX3JhbmdlWzBdO1xuXHR9XG5cdGlmICh0eXBlb2YgcmV0WzFdID09PSBcInVuZGVmaW5lZFwiKSB7XG5cdCAgICByZXRbMV0gPSB0aGlzLmluZmVycmVkX3ZhbHVlX3JhbmdlWzFdO1xuXHR9XG5cdGlmIChyZXRbMF0gPT09IHJldFsxXSkge1xuXHQgICAgLy8gTWFrZSBzdXJlIG5vbi1lbXB0eSBpbnRlcnZhbFxuXHQgICAgcmV0WzBdIC09IHJldFswXSAvIDI7XG5cdCAgICByZXRbMV0gKz0gcmV0WzFdIC8gMjtcblx0fVxuXHRyZXR1cm4gcmV0O1xuICAgIH07XG5cbiAgICBMaW5lYXJJbnRlcnBSdWxlU2V0LnByb3RvdHlwZS5hcHBseSA9IGZ1bmN0aW9uIChkYXRhLCBjZWxsX3dpZHRoLCBjZWxsX2hlaWdodCwgb3V0X2FjdGl2ZV9ydWxlcykge1xuXHQvLyBGaXJzdCBmaW5kIHZhbHVlIHJhbmdlXG5cdHZhciB2YWx1ZV9taW4gPSBOdW1iZXIuUE9TSVRJVkVfSU5GSU5JVFk7XG5cdHZhciB2YWx1ZV9tYXggPSBOdW1iZXIuTkVHQVRJVkVfSU5GSU5JVFk7XG5cdGZvciAodmFyIGkgPSAwLCBkYXRhbGVuID0gZGF0YS5sZW5ndGg7IGkgPCBkYXRhbGVuOyBpKyspIHtcblx0ICAgIHZhciBkID0gZGF0YVtpXTtcblx0ICAgIGlmIChpc05hTihkW3RoaXMudmFsdWVfa2V5XSkpIHtcblx0XHRjb250aW51ZTtcblx0ICAgIH1cblx0ICAgIHZhbHVlX21pbiA9IE1hdGgubWluKHZhbHVlX21pbiwgZFt0aGlzLnZhbHVlX2tleV0pO1xuXHQgICAgdmFsdWVfbWF4ID0gTWF0aC5tYXgodmFsdWVfbWF4LCBkW3RoaXMudmFsdWVfa2V5XSk7XG5cdH1cblx0aWYgKHZhbHVlX21pbiA9PT0gTnVtYmVyLlBPU0lUSVZFX0lORklOSVRZKSB7XG5cdCAgICB2YWx1ZV9taW4gPSAwO1xuXHR9XG5cdGlmICh2YWx1ZV9tYXggPT09IE51bWJlci5ORUdBVElWRV9JTkZJTklUWSkge1xuXHQgICAgdmFsdWVfbWF4ID0gMDtcblx0fVxuXHR0aGlzLmluZmVycmVkX3ZhbHVlX3JhbmdlID0gW3ZhbHVlX21pbiwgdmFsdWVfbWF4XTtcblx0dGhpcy51cGRhdGVMaW5lYXJSdWxlcygpO1xuXG5cdC8vIFRoZW4gcHJvcGFnYXRlIHRoZSBjYWxsIHVwXG5cdHJldHVybiBDb25kaXRpb25SdWxlU2V0LnByb3RvdHlwZS5hcHBseS5jYWxsKHRoaXMsIGRhdGEsIGNlbGxfd2lkdGgsIGNlbGxfaGVpZ2h0LCBvdXRfYWN0aXZlX3J1bGVzKTtcbiAgICB9O1xuXG4gICAgTGluZWFySW50ZXJwUnVsZVNldC5wcm90b3R5cGUudXBkYXRlTGluZWFyUnVsZXMgPSBmdW5jdGlvbiAoKSB7XG5cdHRocm93IFwiTm90IGltcGxlbWVudGVkIGluIGFic3RyYWN0IGNsYXNzXCI7XG4gICAgfTtcblxuICAgIHJldHVybiBMaW5lYXJJbnRlcnBSdWxlU2V0O1xufSkoKTtcblxudmFyIEdyYWRpZW50UnVsZVNldCA9IChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gR3JhZGllbnRSdWxlU2V0KHBhcmFtcykge1xuXHQvKiBwYXJhbXNcblx0ICogLSBjb2xvcnMgfHwgY29sb3JtYXBfbmFtZVxuXHQgKiAtIG51bGxfY29sb3Jcblx0ICovXG5cdExpbmVhckludGVycFJ1bGVTZXQuY2FsbCh0aGlzLCBwYXJhbXMpO1xuXG5cdHRoaXMuY29sb3JzID0gW107XG5cdGlmIChwYXJhbXMuY29sb3JzKSB7XG5cdCAgICB0aGlzLmNvbG9ycyA9IHBhcmFtcy5jb2xvcnMgfHwgW107XG5cdH0gZWxzZSBpZiAocGFyYW1zLmNvbG9ybWFwX25hbWUpIHtcblx0ICAgIHRoaXMuY29sb3JzID0gaGVhdG1hcENvbG9yc1twYXJhbXMuY29sb3JtYXBfbmFtZV0gfHwgW107XG5cdH1cblx0aWYgKHRoaXMuY29sb3JzLmxlbmd0aCA9PT0gMCkge1xuXHQgICAgdGhpcy5jb2xvcnMucHVzaChbMCwwLDAsMV0sWzI1NSwwLDAsMV0pO1xuXHR9XG5cdFxuXHR0aGlzLnZhbHVlX3N0b3BfcG9pbnRzID0gcGFyYW1zLnZhbHVlX3N0b3BfcG9pbnRzO1xuXG5cdHRoaXMuZ3JhZGllbnRfcnVsZTtcblx0dGhpcy5udWxsX2NvbG9yID0gcGFyYW1zLm51bGxfY29sb3IgfHwgXCJyZ2JhKDIxMSwyMTEsMjExLDEpXCI7XG4gICAgfVxuICAgIEdyYWRpZW50UnVsZVNldC5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKExpbmVhckludGVycFJ1bGVTZXQucHJvdG90eXBlKTtcblxuICAgIC8vIGludGVycFNjYWxlQ29sb3JzLFxuICAgIC8vIHdlcmUgYWRhcHRlZCBmcm9tIHBvbGl0aWtlbi1qb3VybmFsaXNtJ3Mgc2NhbGUtY29sb3ItcGVyY2VwdHVhbCByZXBvIG9uIEdpdGh1YlxuICAgIHZhciBsaW5JbnRlcnBDb2xvcnMgPSBmdW5jdGlvbih0LCBiZWdpbl9jb2xvciwgZW5kX2NvbG9yKSB7XG5cdC8vIDAgPD0gdCA8PSAxXG5cdC8vIGJlZ2luX2NvbG9yIGFuZCBlbmRfY29sb3IgYXJlIDQtZWxlbWVudCBhcnJheXMgaW4gKFswLDI1NV0peChbMCwyNTVdKXgoWzAsMjU1XSl4KFswLDFdKVxuXHRyZXR1cm4gW1xuXHQgICAgTWF0aC5yb3VuZChiZWdpbl9jb2xvclswXSooMS10KSArIGVuZF9jb2xvclswXSp0KSxcblx0ICAgIE1hdGgucm91bmQoYmVnaW5fY29sb3JbMV0qKDEtdCkgKyBlbmRfY29sb3JbMV0qdCksXG5cdCAgICBNYXRoLnJvdW5kKGJlZ2luX2NvbG9yWzJdKigxLXQpICsgZW5kX2NvbG9yWzJdKnQpLFxuXHQgICAgYmVnaW5fY29sb3JbM10qKDEtdCkgKyBlbmRfY29sb3JbM10qdFxuXHRdO1xuICAgIH07XG5cbiAgICBHcmFkaWVudFJ1bGVTZXQucHJvdG90eXBlLm1ha2VDb2xvckZuID0gZnVuY3Rpb24oY29sb3JzLCBpbnRlcnBGbikge1xuXHR2YXIgdmFsdWVfc3RvcF9wb2ludHMgPSB0aGlzLnZhbHVlX3N0b3BfcG9pbnRzO1xuXHR2YXIgc3RvcF9wb2ludHM7XG5cdGlmICh2YWx1ZV9zdG9wX3BvaW50cykge1xuXHQgICAgc3RvcF9wb2ludHMgPSB2YWx1ZV9zdG9wX3BvaW50cy5tYXAoaW50ZXJwRm4pO1xuXHR9IGVsc2Uge1xuXHQgICAgc3RvcF9wb2ludHMgPSBpbnRSYW5nZShjb2xvcnMubGVuZ3RoKS5tYXAoZnVuY3Rpb24oeCkgeyByZXR1cm4geC8oY29sb3JzLmxlbmd0aCAtMSk7IH0pO1xuXHR9XG5cdHJldHVybiBmdW5jdGlvbih0KSB7XG5cdCAgICAvLyAwIDw9IHQgPD0gMVxuXHQgICAgdmFyIGJlZ2luX2ludGVydmFsX2luZGV4ID0gYmluYXJ5c2VhcmNoKHN0b3BfcG9pbnRzLCB0LCBmdW5jdGlvbih4KSB7IHJldHVybiB4OyB9LCB0cnVlKTtcblx0ICAgIHZhciBlbmRfaW50ZXJ2YWxfaW5kZXggPSBNYXRoLm1pbihjb2xvcnMubGVuZ3RoIC0gMSwgYmVnaW5faW50ZXJ2YWxfaW5kZXggKyAxKTtcblx0ICAgIHZhciBzcHJlYWQgPSBzdG9wX3BvaW50c1tlbmRfaW50ZXJ2YWxfaW5kZXhdIC0gc3RvcF9wb2ludHNbYmVnaW5faW50ZXJ2YWxfaW5kZXhdO1xuXHQgICAgaWYgKHNwcmVhZCA9PT0gMCkge1xuXHRcdHJldHVybiBcInJnYmEoXCIgKyBjb2xvcnNbZW5kX2ludGVydmFsX2luZGV4XS5qb2luKFwiLFwiKSArIFwiKVwiO1xuXHQgICAgfSBlbHNlIHtcblx0XHR2YXIgaW50ZXJ2YWxfdCA9ICh0IC0gc3RvcF9wb2ludHNbYmVnaW5faW50ZXJ2YWxfaW5kZXhdKSAvIHNwcmVhZDtcblx0XHR2YXIgYmVnaW5fY29sb3IgPSBjb2xvcnNbYmVnaW5faW50ZXJ2YWxfaW5kZXhdO1xuXHRcdHZhciBlbmRfY29sb3IgPSBjb2xvcnNbZW5kX2ludGVydmFsX2luZGV4XTtcblx0XHRyZXR1cm4gXCJyZ2JhKFwiICsgbGluSW50ZXJwQ29sb3JzKGludGVydmFsX3QsIGJlZ2luX2NvbG9yLCBlbmRfY29sb3IpLmpvaW4oXCIsXCIpICsgXCIpXCI7XG5cdCAgICB9XG5cdCAgICBcblx0fTtcbiAgICB9XG5cbiAgICBHcmFkaWVudFJ1bGVTZXQucHJvdG90eXBlLnVwZGF0ZUxpbmVhclJ1bGVzID0gZnVuY3Rpb24gKCkge1xuXHRpZiAodHlwZW9mIHRoaXMuZ3JhZGllbnRfcnVsZSAhPT0gXCJ1bmRlZmluZWRcIikge1xuXHQgICAgdGhpcy5yZW1vdmVSdWxlKHRoaXMuZ3JhZGllbnRfcnVsZSk7XG5cdH1cblx0dmFyIGludGVycEZuID0gdGhpcy5tYWtlSW50ZXJwRm4oKTtcblx0dmFyIGNvbG9yRm4gPSB0aGlzLm1ha2VDb2xvckZuKHRoaXMuY29sb3JzLCBpbnRlcnBGbik7XG5cdHZhciB2YWx1ZV9rZXkgPSB0aGlzLnZhbHVlX2tleTtcblx0dmFyIG51bGxfY29sb3IgPSB0aGlzLm51bGxfY29sb3I7XG5cdFxuXHR0aGlzLmdyYWRpZW50X3J1bGUgPSB0aGlzLmFkZFJ1bGUoZnVuY3Rpb24gKGQpIHtcblx0ICAgIHJldHVybiBkW05BX1NUUklOR10gIT09IHRydWU7XG5cdH0sXG5cdFx0e3NoYXBlczogW3tcblx0XHRcdCAgICB0eXBlOiAncmVjdGFuZ2xlJyxcblx0XHRcdCAgICBmaWxsOiBmdW5jdGlvbihkKSB7XG5cdFx0XHRcdGlmIChkW3ZhbHVlX2tleV0pIHtcblx0XHRcdFx0ICAgIHZhciB0ID0gaW50ZXJwRm4oZFt2YWx1ZV9rZXldKTtcblx0XHRcdFx0ICAgIHJldHVybiBjb2xvckZuKHQpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQgICAgcmV0dXJuIG51bGxfY29sb3I7XG5cdFx0XHRcdH1cblx0XHRcdCAgICB9XG5cdFx0XHR9XSxcblx0XHQgICAgZXhjbHVkZV9mcm9tX2xlZ2VuZDogZmFsc2UsXG5cdFx0ICAgIGxlZ2VuZF9jb25maWc6IHsndHlwZSc6ICdncmFkaWVudCcsICdyYW5nZSc6IHRoaXMuZ2V0RWZmZWN0aXZlVmFsdWVSYW5nZSgpLCAnY29sb3JGbic6Y29sb3JGbn1cblx0XHR9KTtcbiAgICB9O1xuXG4gICAgcmV0dXJuIEdyYWRpZW50UnVsZVNldDtcbn0pKCk7XG5cbnZhciBCYXJSdWxlU2V0ID0gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBCYXJSdWxlU2V0KHBhcmFtcykge1xuXHRMaW5lYXJJbnRlcnBSdWxlU2V0LmNhbGwodGhpcywgcGFyYW1zKTtcblx0dGhpcy5iYXJfcnVsZTtcblx0dGhpcy5maWxsID0gcGFyYW1zLmZpbGwgfHwgJ3JnYmEoMTU2LDEyMywxMzUsMSknO1xuICAgIH1cbiAgICBCYXJSdWxlU2V0LnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoTGluZWFySW50ZXJwUnVsZVNldC5wcm90b3R5cGUpO1xuXG4gICAgQmFyUnVsZVNldC5wcm90b3R5cGUudXBkYXRlTGluZWFyUnVsZXMgPSBmdW5jdGlvbiAoKSB7XG5cdGlmICh0eXBlb2YgdGhpcy5iYXJfcnVsZSAhPT0gXCJ1bmRlZmluZWRcIikge1xuXHQgICAgdGhpcy5yZW1vdmVSdWxlKHRoaXMuYmFyX3J1bGUpO1xuXHR9XG5cdHZhciBpbnRlcnBGbiA9IHRoaXMubWFrZUludGVycEZuKCk7XG5cdHZhciB2YWx1ZV9rZXkgPSB0aGlzLnZhbHVlX2tleTtcblx0dGhpcy5iYXJfcnVsZSA9IHRoaXMuYWRkUnVsZShmdW5jdGlvbiAoZCkge1xuXHQgICAgcmV0dXJuIGRbTkFfU1RSSU5HXSAhPT0gdHJ1ZTtcblx0fSxcblx0XHR7c2hhcGVzOiBbe1xuXHRcdFx0ICAgIHR5cGU6ICdyZWN0YW5nbGUnLFxuXHRcdFx0ICAgIHk6IGZ1bmN0aW9uIChkKSB7XG5cdFx0XHRcdHZhciB0ID0gaW50ZXJwRm4oZFt2YWx1ZV9rZXldKTtcblx0XHRcdFx0cmV0dXJuICgxIC0gdCkgKiAxMDAgKyBcIiVcIjtcblx0XHRcdCAgICB9LFxuXHRcdFx0ICAgIGhlaWdodDogZnVuY3Rpb24gKGQpIHtcblx0XHRcdFx0dmFyIHQgPSBpbnRlcnBGbihkW3ZhbHVlX2tleV0pO1xuXHRcdFx0XHRyZXR1cm4gdCAqIDEwMCArIFwiJVwiO1xuXHRcdFx0ICAgIH0sXG5cdFx0XHQgICAgZmlsbDogdGhpcy5maWxsLFxuXHRcdFx0fV0sXG5cdFx0ICAgIGV4Y2x1ZGVfZnJvbV9sZWdlbmQ6IGZhbHNlLFxuXHRcdCAgICBsZWdlbmRfY29uZmlnOiB7J3R5cGUnOiAnbnVtYmVyJywgXG5cdFx0XHRcdCAgICAncmFuZ2UnOiB0aGlzLmdldEVmZmVjdGl2ZVZhbHVlUmFuZ2UoKSwgXG5cdFx0XHRcdCAgICAnY29sb3InOiB0aGlzLmZpbGwsXG5cdFx0XHRcdCAgICAnaW50ZXJwRm4nOiBpbnRlcnBGbn1cblx0XHR9KTtcbiAgICB9O1xuXG4gICAgcmV0dXJuIEJhclJ1bGVTZXQ7XG59KSgpO1xuXG52YXIgU3RhY2tlZEJhclJ1bGVTZXQgPSAoZnVuY3Rpb24oKSB7XG4gICAgZnVuY3Rpb24gU3RhY2tlZEJhclJ1bGVTZXQocGFyYW1zKSB7XG5cdC8qIHBhcmFtc1xuXHQgKiAtIGNhdGVnb3JpZXNcblx0ICogLSB2YWx1ZV9rZXlcblx0ICogLSBmaWxsc1xuXHQgKi9cblx0Q29uZGl0aW9uUnVsZVNldC5jYWxsKHRoaXMsIHBhcmFtcyk7XG5cdHZhciB2YWx1ZV9rZXkgPSBwYXJhbXMudmFsdWVfa2V5O1xuXHR2YXIgZmlsbHMgPSBwYXJhbXMuZmlsbHMgfHwgW107XG5cdHZhciBjYXRlZ29yaWVzID0gcGFyYW1zLmNhdGVnb3JpZXMgfHwgW107XG5cdHZhciBnZXRVbnVzZWRDb2xvciA9IG1ha2VVbmlxdWVDb2xvckdldHRlcihmaWxscyk7XG5cdFxuXHQvLyBJbml0aWFsaXplIHdpdGggZGVmYXVsdCB2YWx1ZXNcblx0d2hpbGUgKGZpbGxzLmxlbmd0aCA8IGNhdGVnb3JpZXMubGVuZ3RoKSB7XG5cdCAgICBmaWxscy5wdXNoKGdldFVudXNlZENvbG9yKCkpO1xuXHR9XG5cdFxuXHR2YXIgc2VsZiA9IHRoaXM7XG5cdGZvciAodmFyIGk9MDsgaSA8IGNhdGVnb3JpZXMubGVuZ3RoOyBpKyspIHtcblx0ICAgIChmdW5jdGlvbihJKSB7XG5cdFx0dmFyIGxlZ2VuZF90YXJnZXQgPSB7fTtcblx0XHRsZWdlbmRfdGFyZ2V0W3ZhbHVlX2tleV0gPSB7fTtcblx0XHRmb3IgKHZhciBqPTA7IGo8Y2F0ZWdvcmllcy5sZW5ndGg7IGorKykge1xuXHRcdCAgICBsZWdlbmRfdGFyZ2V0W3ZhbHVlX2tleV1bY2F0ZWdvcmllc1tqXV0gPSAwO1xuXHRcdH1cblx0XHRsZWdlbmRfdGFyZ2V0W3ZhbHVlX2tleV1bY2F0ZWdvcmllc1tJXV0gPSAxO1xuXHRcdHNlbGYuYWRkUnVsZShmdW5jdGlvbihkKSB7XG5cdFx0ICAgIHJldHVybiBkW05BX1NUUklOR10gIT09IHRydWU7XG5cdFx0fSxcblx0XHR7c2hhcGVzOiBbe1xuXHRcdCAgICB0eXBlOiAncmVjdGFuZ2xlJyxcblx0XHQgICAgZmlsbDogZmlsbHNbSV0sXG5cdFx0ICAgIHdpZHRoOiAnMTAwJScsXG5cdFx0ICAgIGhlaWdodDogZnVuY3Rpb24oZCkge1xuXHRcdFx0dmFyIHRvdGFsID0gMDtcblx0XHRcdGZvciAodmFyIGo9MDsgajxjYXRlZ29yaWVzLmxlbmd0aDsgaisrKSB7XG5cdFx0XHQgICAgdG90YWwgKz0gcGFyc2VGbG9hdChkW3ZhbHVlX2tleV1bY2F0ZWdvcmllc1tqXV0pO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHBhcnNlRmxvYXQoZFt2YWx1ZV9rZXldW2NhdGVnb3JpZXNbSV1dKSoxMDAvdG90YWwgKyAnJSc7XG5cdFx0ICAgIH0sXG5cdFx0ICAgIHk6IGZ1bmN0aW9uKGQpIHtcblx0XHRcdHZhciB0b3RhbCA9IDA7XG5cdFx0XHR2YXIgcHJldl92YWxzX3N1bSA9IDA7XG5cdFx0XHRmb3IgKHZhciBqPTA7IGo8Y2F0ZWdvcmllcy5sZW5ndGg7IGorKykge1xuXHRcdFx0ICAgIHZhciBuZXdfdmFsID0gcGFyc2VGbG9hdChkW3ZhbHVlX2tleV1bY2F0ZWdvcmllc1tqXV0pO1xuXHRcdFx0ICAgIGlmIChqIDwgSSkge1xuXHRcdFx0XHRwcmV2X3ZhbHNfc3VtICs9IG5ld192YWw7XG5cdFx0XHQgICAgfVxuXHRcdFx0ICAgIHRvdGFsICs9IG5ld192YWw7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcHJldl92YWxzX3N1bSoxMDAvdG90YWwgKyAnJSc7XG5cdFx0ICAgIH1cblx0XHR9XSxcblx0ICAgIGV4Y2x1ZGVfZnJvbV9sZWdlbmQ6IGZhbHNlLFxuXHQgICAgbGVnZW5kX2NvbmZpZzogeyd0eXBlJzogJ3J1bGUnLCAndGFyZ2V0JzogbGVnZW5kX3RhcmdldH0sXG5cdCAgICBsZWdlbmRfbGFiZWw6IGNhdGVnb3JpZXNbSV19KTtcblx0ICAgIH0pKGkpO1xuXHR9XG4gICAgfVxuICAgIFN0YWNrZWRCYXJSdWxlU2V0LnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoQ29uZGl0aW9uUnVsZVNldC5wcm90b3R5cGUpO1xuICAgIHJldHVybiBTdGFja2VkQmFyUnVsZVNldDtcbn0pKCk7XG52YXIgR2VuZXRpY0FsdGVyYXRpb25SdWxlU2V0ID0gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBHZW5ldGljQWx0ZXJhdGlvblJ1bGVTZXQocGFyYW1zKSB7XG5cdC8qIHBhcmFtczpcblx0ICogLSBydWxlX3BhcmFtc1xuXHQgKi9cblx0TG9va3VwUnVsZVNldC5jYWxsKHRoaXMsIHBhcmFtcyk7XG5cdChmdW5jdGlvbiBhZGRSdWxlcyhzZWxmKSB7XG5cdCAgICB2YXIgcnVsZV9wYXJhbXMgPSBwYXJhbXMucnVsZV9wYXJhbXM7XG5cdCAgICBmb3IgKHZhciBrZXkgaW4gcnVsZV9wYXJhbXMpIHtcblx0XHRpZiAocnVsZV9wYXJhbXMuaGFzT3duUHJvcGVydHkoa2V5KSkge1xuXHRcdCAgICB2YXIga2V5X3J1bGVfcGFyYW1zID0gcnVsZV9wYXJhbXNba2V5XTtcblx0XHQgICAgaWYgKGtleSA9PT0gJyonKSB7XG5cdFx0XHRzZWxmLmFkZFJ1bGUobnVsbCwgbnVsbCwgc2hhbGxvd0V4dGVuZChydWxlX3BhcmFtc1snKiddLCB7J2xlZ2VuZF9jb25maWcnOiB7J3R5cGUnOiAncnVsZScsICd0YXJnZXQnOiB7fX19KSk7XG5cdFx0ICAgIH0gZWxzZSB7XG5cdFx0XHRmb3IgKHZhciB2YWx1ZSBpbiBrZXlfcnVsZV9wYXJhbXMpIHtcblx0XHRcdCAgICBpZiAoa2V5X3J1bGVfcGFyYW1zLmhhc093blByb3BlcnR5KHZhbHVlKSkge1xuXHRcdFx0XHR2YXIgZXF1aXZfdmFsdWVzID0gdmFsdWUuc3BsaXQoXCIsXCIpO1xuXHRcdFx0XHR2YXIgbGVnZW5kX3J1bGVfdGFyZ2V0ID0ge307XG5cdFx0XHRcdGxlZ2VuZF9ydWxlX3RhcmdldFtlcXVpdl92YWx1ZXNbMF1dID0gdmFsdWU7XG5cdFx0XHRcdHZhciBydWxlX2lkID0gc2VsZi5hZGRSdWxlKGtleSwgKGVxdWl2X3ZhbHVlc1swXSA9PT0gJyonID8gbnVsbCA6IGVxdWl2X3ZhbHVlc1swXSksIHNoYWxsb3dFeHRlbmQoa2V5X3J1bGVfcGFyYW1zW3ZhbHVlXSwgeydsZWdlbmRfY29uZmlnJzogeyd0eXBlJzogJ3J1bGUnLCAndGFyZ2V0JzogbGVnZW5kX3J1bGVfdGFyZ2V0fX0pKTtcblx0XHRcdFx0Zm9yICh2YXIgaSA9IDE7IGkgPCBlcXVpdl92YWx1ZXMubGVuZ3RoOyBpKyspIHtcblx0XHRcdFx0ICAgIHNlbGYubGlua0V4aXN0aW5nUnVsZShrZXksIChlcXVpdl92YWx1ZXNbaV0gPT09ICcqJyA/IG51bGwgOiBlcXVpdl92YWx1ZXNbaV0pLCBydWxlX2lkKTtcblx0XHRcdFx0fVxuXHRcdFx0ICAgIH1cblx0XHRcdH1cblx0XHQgICAgfVxuXHRcdH1cblx0ICAgIH1cblx0fSkodGhpcyk7XG5cdHRoaXMuYWRkUnVsZShOQV9TVFJJTkcsIHRydWUsIHtcblx0ICAgIHNoYXBlczogbWFrZU5BU2hhcGVzKHBhcmFtcy5uYV96IHx8IDEpLFxuXHQgICAgbGVnZW5kX2xhYmVsOiBcIk4vU1wiLFxuXHQgICAgZXhjbHVkZV9mcm9tX2xlZ2VuZDogZmFsc2UsXG5cdCAgICBsZWdlbmRfY29uZmlnOiB7J3R5cGUnOiAncnVsZScsICd0YXJnZXQnOiB7J25hJzogdHJ1ZX19XG5cdH0pO1xuICAgIH1cbiAgICBHZW5ldGljQWx0ZXJhdGlvblJ1bGVTZXQucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShMb29rdXBSdWxlU2V0LnByb3RvdHlwZSk7XG5cbiAgICByZXR1cm4gR2VuZXRpY0FsdGVyYXRpb25SdWxlU2V0O1xufSkoKTtcblxudmFyIFJ1bGUgPSAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIFJ1bGUocGFyYW1zKSB7XG5cdHRoaXMuc2hhcGVzID0gcGFyYW1zLnNoYXBlcy5tYXAoZnVuY3Rpb24gKHNoYXBlKSB7XG5cdCAgICBpZiAoc2hhcGUudHlwZSA9PT0gJ3JlY3RhbmdsZScpIHtcblx0XHRyZXR1cm4gbmV3IFNoYXBlLlJlY3RhbmdsZShzaGFwZSk7XG5cdCAgICB9IGVsc2UgaWYgKHNoYXBlLnR5cGUgPT09ICd0cmlhbmdsZScpIHtcblx0XHRyZXR1cm4gbmV3IFNoYXBlLlRyaWFuZ2xlKHNoYXBlKTtcblx0ICAgIH0gZWxzZSBpZiAoc2hhcGUudHlwZSA9PT0gJ2VsbGlwc2UnKSB7XG5cdFx0cmV0dXJuIG5ldyBTaGFwZS5FbGxpcHNlKHNoYXBlKTtcblx0ICAgIH0gZWxzZSBpZiAoc2hhcGUudHlwZSA9PT0gJ2xpbmUnKSB7XG5cdFx0cmV0dXJuIG5ldyBTaGFwZS5MaW5lKHNoYXBlKTtcblx0ICAgIH1cblx0fSk7XG5cdHRoaXMubGVnZW5kX2xhYmVsID0gdHlwZW9mIHBhcmFtcy5sZWdlbmRfbGFiZWwgPT09IFwidW5kZWZpbmVkXCIgPyBcIlwiIDogcGFyYW1zLmxlZ2VuZF9sYWJlbDtcblx0dGhpcy5leGNsdWRlX2Zyb21fbGVnZW5kID0gcGFyYW1zLmV4Y2x1ZGVfZnJvbV9sZWdlbmQ7XG5cdHRoaXMubGVnZW5kX2NvbmZpZyA9IHBhcmFtcy5sZWdlbmRfY29uZmlnOy8vIHsndHlwZSc6J3J1bGUnLCAndGFyZ2V0JzogeydtdXRfdHlwZSc6J01JU1NFTlNFJ319IG9yIHsndHlwZSc6J251bWJlcicsICdjb2xvcic6J3JnYmEoMSwyLDMsMSksICdyYW5nZSc6W2xvd2VyLCB1cHBlcl19IG9yIHsndHlwZSc6J2dyYWRpZW50JywgJ2NvbG9yX3JhbmdlJzpbJ3JnYmEoLi4uKScgb3IgJyMuLi4nLCAncmdiYSguLi4pJyBvciAnIy4uLiddLCAnbnVtYmVyX3JhbmdlJzpbbG93ZXIsIHVwcGVyXX1cbiAgICB9XG4gICAgUnVsZS5wcm90b3R5cGUuZ2V0TGVnZW5kQ29uZmlnID0gZnVuY3Rpb24gKCkge1xuXHRyZXR1cm4gdGhpcy5sZWdlbmRfY29uZmlnO1xuICAgIH1cbiAgICBSdWxlLnByb3RvdHlwZS5hcHBseSA9IGZ1bmN0aW9uIChkLCBjZWxsX3dpZHRoLCBjZWxsX2hlaWdodCkge1xuXHQvLyBHZXRzIGNvbmNyZXRlIHNoYXBlcyAoaS5lLiBjb21wdXRlZFxuXHQvLyByZWFsIHZhbHVlcyBmcm9tIHBlcmNlbnRhZ2VzKVxuXHR2YXIgY29uY3JldGVfc2hhcGVzID0gW107XG5cdGZvciAodmFyIGkgPSAwLCBzaGFwZXNfbGVuID0gdGhpcy5zaGFwZXMubGVuZ3RoOyBpIDwgc2hhcGVzX2xlbjsgaSsrKSB7XG5cdCAgICBjb25jcmV0ZV9zaGFwZXMucHVzaCh0aGlzLnNoYXBlc1tpXS5nZXRDb21wdXRlZFBhcmFtcyhkLCBjZWxsX3dpZHRoLCBjZWxsX2hlaWdodCkpO1xuXHR9XG5cdHJldHVybiBjb25jcmV0ZV9zaGFwZXM7XG4gICAgfVxuXG4gICAgUnVsZS5wcm90b3R5cGUuaXNFeGNsdWRlZEZyb21MZWdlbmQgPSBmdW5jdGlvbiAoKSB7XG5cdHJldHVybiB0aGlzLmV4Y2x1ZGVfZnJvbV9sZWdlbmQ7XG4gICAgfVxuXG4gICAgcmV0dXJuIFJ1bGU7XG59KSgpO1xuXG5tb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChwYXJhbXMpIHtcbiAgICBpZiAocGFyYW1zLnR5cGUgPT09ICdjYXRlZ29yaWNhbCcpIHtcblx0cmV0dXJuIG5ldyBDYXRlZ29yaWNhbFJ1bGVTZXQocGFyYW1zKTtcbiAgICB9IGVsc2UgaWYgKHBhcmFtcy50eXBlID09PSAnZ3JhZGllbnQnKSB7XG5cdHJldHVybiBuZXcgR3JhZGllbnRSdWxlU2V0KHBhcmFtcyk7XG4gICAgfSBlbHNlIGlmIChwYXJhbXMudHlwZSA9PT0gJ2JhcicpIHtcblx0cmV0dXJuIG5ldyBCYXJSdWxlU2V0KHBhcmFtcyk7XG4gICAgfSBlbHNlIGlmIChwYXJhbXMudHlwZSA9PT0gJ3N0YWNrZWRfYmFyJykge1xuXHRyZXR1cm4gbmV3IFN0YWNrZWRCYXJSdWxlU2V0KHBhcmFtcyk7XG4gICAgfSBlbHNlIGlmIChwYXJhbXMudHlwZSA9PT0gJ2dlbmUnKSB7XG5cdHJldHVybiBuZXcgR2VuZXRpY0FsdGVyYXRpb25SdWxlU2V0KHBhcmFtcyk7XG4gICAgfVxufSIsInZhciBTaGFwZSA9IChmdW5jdGlvbigpIHtcbiAgICB2YXIgZGVmYXVsdF9wYXJhbWV0ZXJfdmFsdWVzID0ge1xuXHQgICAgJ3dpZHRoJzogJzEwMCUnLCBcblx0ICAgICdoZWlnaHQnOiAnMTAwJScsIFxuXHQgICAgJ3gnOiAnMCUnLCBcblx0ICAgICd5JzogJzAlJywgXG5cdCAgICAneic6IDAsXG5cdCAgICAneDEnOiAnMCUnLCBcblx0ICAgICd4Mic6ICcwJScsIFxuXHQgICAgJ3gzJzogJzAlJywgXG5cdCAgICAneTEnOiAnMCUnLCBcblx0ICAgICd5Mic6ICcwJScsIFxuXHQgICAgJ3kzJzogJzAlJyxcblx0ICAgICdzdHJva2UnOiAncmdiYSgwLDAsMCwwKScsIFxuXHQgICAgJ2ZpbGwnOiAncmdiYSgyMywyMywyMywxKScsIFxuXHQgICAgJ3N0cm9rZS13aWR0aCc6ICcwJyxcblx0ICAgICdzdHJva2Utb3BhY2l0eSc6ICcwJ1xuICAgIH07XG4gICAgdmFyIHBhcmFtZXRlcl9uYW1lX3RvX2RpbWVuc2lvbl9pbmRleCA9IHtcblx0J3N0cm9rZS13aWR0aCc6MCxcblx0J3dpZHRoJzogMCxcblx0J3gnOjAsXG5cdCd4MSc6MCxcblx0J3gyJzowLFxuXHQneDMnOjAsXG5cdCdoZWlnaHQnOjEsXG5cdCd5JzoxLFxuXHQneTEnOjEsXG5cdCd5Mic6MSxcblx0J3kzJzoxXG4gICAgfTtcbiAgICBmdW5jdGlvbiBTaGFwZShwYXJhbXMpIHtcblx0dGhpcy5wYXJhbXMgPSBwYXJhbXM7XG5cdHRoaXMucGFyYW1zX3dpdGhfdHlwZSA9IHt9O1xuXHR0aGlzLmNvbXBsZXRlV2l0aERlZmF1bHRzKCk7XG5cdHRoaXMubWFya1BhcmFtZXRlclR5cGVzKCk7XG4gICAgfVxuICAgIFNoYXBlLnByb3RvdHlwZS5jb21wbGV0ZVdpdGhEZWZhdWx0cyA9IGZ1bmN0aW9uKCkge1xuXHR2YXIgcmVxdWlyZWRfcGFyYW1ldGVycyA9IHRoaXMuZ2V0UmVxdWlyZWRQYXJhbWV0ZXJzKCk7XG5cdGZvciAodmFyIGk9MDsgaTxyZXF1aXJlZF9wYXJhbWV0ZXJzLmxlbmd0aDsgaSsrKSB7XG5cdCAgICB2YXIgcGFyYW0gPSByZXF1aXJlZF9wYXJhbWV0ZXJzW2ldO1xuXHQgICAgdGhpcy5wYXJhbXNbcGFyYW1dID0gKHR5cGVvZiB0aGlzLnBhcmFtc1twYXJhbV0gPT09ICd1bmRlZmluZWQnID8gZGVmYXVsdF9wYXJhbWV0ZXJfdmFsdWVzW3BhcmFtXSA6IHRoaXMucGFyYW1zW3BhcmFtXSk7XG5cdH1cbiAgICB9XG4gICAgU2hhcGUucHJvdG90eXBlLm1hcmtQYXJhbWV0ZXJUeXBlcyA9IGZ1bmN0aW9uKCkge1xuXHR2YXIgcGFyYW1ldGVycyA9IE9iamVjdC5rZXlzKHRoaXMucGFyYW1zKTtcblx0Zm9yICh2YXIgaT0wOyBpPHBhcmFtZXRlcnMubGVuZ3RoOyBpKyspIHtcblx0ICAgIHZhciBwYXJhbV9uYW1lID0gcGFyYW1ldGVyc1tpXTtcblx0ICAgIHZhciBwYXJhbV92YWwgPSB0aGlzLnBhcmFtc1twYXJhbV9uYW1lXTtcblx0ICAgIGlmICh0eXBlb2YgcGFyYW1fdmFsID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0dGhpcy5wYXJhbXNfd2l0aF90eXBlW3BhcmFtX25hbWVdID0geyd0eXBlJzonZnVuY3Rpb24nLCAndmFsdWUnOnBhcmFtX3ZhbH07XG5cdCAgICB9IGVsc2Uge1xuXHRcdHRoaXMucGFyYW1zX3dpdGhfdHlwZVtwYXJhbV9uYW1lXSA9IHsndHlwZSc6J3ZhbHVlJywgJ3ZhbHVlJzogcGFyYW1fdmFsfTtcblx0ICAgIH1cblx0fVxuICAgIH1cbiAgICBTaGFwZS5wcm90b3R5cGUuZ2V0Q29tcHV0ZWRQYXJhbXMgPSBmdW5jdGlvbihkLCBiYXNlX3dpZHRoLCBiYXNlX2hlaWdodCkge1xuXHR2YXIgY29tcHV0ZWRfcGFyYW1zID0ge307XG5cdHZhciBwYXJhbV9uYW1lcyA9IE9iamVjdC5rZXlzKHRoaXMucGFyYW1zX3dpdGhfdHlwZSk7XG5cdHZhciBkaW1lbnNpb25zID0gW2Jhc2Vfd2lkdGgsIGJhc2VfaGVpZ2h0XTtcblx0Zm9yICh2YXIgaT0wOyBpPHBhcmFtX25hbWVzLmxlbmd0aDsgaSsrKSB7XG5cdCAgICB2YXIgcGFyYW1fbmFtZSA9IHBhcmFtX25hbWVzW2ldO1xuXHQgICAgdmFyIHBhcmFtX3ZhbF9tYXAgPSB0aGlzLnBhcmFtc193aXRoX3R5cGVbcGFyYW1fbmFtZV07XG5cdCAgICB2YXIgcGFyYW1fdmFsID0gcGFyYW1fdmFsX21hcC52YWx1ZTtcblx0ICAgIGlmIChwYXJhbV9uYW1lICE9PSAndHlwZScpIHtcblx0XHRpZiAocGFyYW1fdmFsX21hcC50eXBlID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0ICAgIHBhcmFtX3ZhbCA9IHBhcmFtX3ZhbChkKTtcblx0XHR9XG5cdFx0aWYgKHBhcmFtX3ZhbFtwYXJhbV92YWwubGVuZ3RoLTFdID09PSAnJScpIHtcblx0XHQgICAgLy8gY2hlY2sgYSBjb3VwbGUgb2YgY29tbW9ubHktdXNlZCBzcGVjaWFsIGNhc2VzIHRvIGF2b2lkIHNsb3dlciBwYXJzZUZsb2F0IFxuXHRcdCAgICBpZiAocGFyYW1fdmFsID09PSAnMTAwJScpIHtcblx0XHRcdHBhcmFtX3ZhbCA9IDE7XG5cdFx0ICAgIH0gZWxzZSB7XG5cdFx0XHRwYXJhbV92YWwgPSBwYXJzZUZsb2F0KHBhcmFtX3ZhbCkgLyAxMDA7XG5cdFx0ICAgIH1cblx0XHQgICAgcGFyYW1fdmFsICo9IGRpbWVuc2lvbnNbcGFyYW1ldGVyX25hbWVfdG9fZGltZW5zaW9uX2luZGV4W3BhcmFtX25hbWVdXTtcblx0XHR9XG5cdCAgICB9XG5cdCAgICBjb21wdXRlZF9wYXJhbXNbcGFyYW1fbmFtZV0gPSBwYXJhbV92YWw7XG5cdH1cblx0cmV0dXJuIGNvbXB1dGVkX3BhcmFtcztcbiAgICB9O1xuICAgIHJldHVybiBTaGFwZTtcbn0pKCk7XG5cblxuXG52YXIgUmVjdGFuZ2xlID0gKGZ1bmN0aW9uKCkge1xuICAgIGZ1bmN0aW9uIFJlY3RhbmdsZShwYXJhbXMpIHtcblx0U2hhcGUuY2FsbCh0aGlzLCBwYXJhbXMpO1xuICAgIH1cbiAgICBSZWN0YW5nbGUucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShTaGFwZS5wcm90b3R5cGUpO1xuICAgIFJlY3RhbmdsZS5wcm90b3R5cGUuZ2V0UmVxdWlyZWRQYXJhbWV0ZXJzID0gZnVuY3Rpb24oKSB7XG5cdHJldHVybiBbJ3dpZHRoJywgJ2hlaWdodCcsICd4JywgJ3knLCAneicsICdzdHJva2UnLCAnZmlsbCcsICdzdHJva2Utd2lkdGgnXTsgXG4gICAgfVxuICAgIHJldHVybiBSZWN0YW5nbGU7XG59KSgpO1xuXG52YXIgVHJpYW5nbGUgPSAoZnVuY3Rpb24oKSB7XG4gICAgZnVuY3Rpb24gVHJpYW5nbGUocGFyYW1zKSB7XG5cdFNoYXBlLmNhbGwodGhpcywgcGFyYW1zKTtcbiAgICB9XG4gICAgVHJpYW5nbGUucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShTaGFwZS5wcm90b3R5cGUpO1xuICAgIFRyaWFuZ2xlLnByb3RvdHlwZS5nZXRSZXF1aXJlZFBhcmFtZXRlcnMgPSBmdW5jdGlvbigpIHtcblx0cmV0dXJuIFsneDEnLCAneDInLCAneDMnLCAneTEnLCAneTInLCAneTMnLCAneicsICdzdHJva2UnLCAnZmlsbCcsICdzdHJva2Utd2lkdGgnXTsgXG4gICAgfVxuICAgIHJldHVybiBUcmlhbmdsZTtcbn0pKCk7XG5cbnZhciBFbGxpcHNlID0gKGZ1bmN0aW9uKCkge1xuICAgIGZ1bmN0aW9uIEVsbGlwc2UocGFyYW1zKSB7XG5cdFNoYXBlLmNhbGwodGhpcywgcGFyYW1zKTtcbiAgICB9XG4gICAgRWxsaXBzZS5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKFNoYXBlLnByb3RvdHlwZSk7XG4gICAgRWxsaXBzZS5wcm90b3R5cGUuZ2V0UmVxdWlyZWRQYXJhbWV0ZXJzID0gZnVuY3Rpb24oKSB7XG5cdHJldHVybiBbJ3dpZHRoJywgJ2hlaWdodCcsICd4JywgJ3knLCAneicsICdzdHJva2UnLCAnZmlsbCcsICdzdHJva2Utd2lkdGgnXTsgXG4gICAgfVxuICAgIHJldHVybiBFbGxpcHNlO1xufSkoKTtcblxudmFyIExpbmUgPSAoZnVuY3Rpb24oKSB7XG4gICAgZnVuY3Rpb24gTGluZShwYXJhbXMpIHtcblx0U2hhcGUuY2FsbCh0aGlzLCBwYXJhbXMpO1xuICAgIH1cbiAgICBMaW5lLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoU2hhcGUucHJvdG90eXBlKTtcbiAgICBMaW5lLnByb3RvdHlwZS5nZXRSZXF1aXJlZFBhcmFtZXRlcnMgPSBmdW5jdGlvbigpIHtcblx0cmV0dXJuIFsneDEnLCAneDInLCAneTEnLCAneTInLCAneicsICdzdHJva2UnLCAnc3Ryb2tlLXdpZHRoJ107IFxuICAgIH1cbiAgICByZXR1cm4gTGluZTtcbn0pKCk7XG5cbm1vZHVsZS5leHBvcnRzID0ge1xuICAgICdSZWN0YW5nbGUnOlJlY3RhbmdsZSxcbiAgICAnVHJpYW5nbGUnOlRyaWFuZ2xlLFxuICAgICdFbGxpcHNlJzpFbGxpcHNlLFxuICAgICdMaW5lJzpMaW5lXG59OyIsInZhciBtYWtlU1ZHRWxlbWVudCA9IGZ1bmN0aW9uICh0YWcsIGF0dHJzKSB7XG4gICAgdmFyIGVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKCdodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZycsIHRhZyk7XG4gICAgZm9yICh2YXIgayBpbiBhdHRycykge1xuXHRpZiAoYXR0cnMuaGFzT3duUHJvcGVydHkoaykpIHtcblx0ICAgIGVsLnNldEF0dHJpYnV0ZShrLCBhdHRyc1trXSk7XG5cdH1cbiAgICB9XG4gICAgcmV0dXJuIGVsO1xufTtcblxudmFyIGV4dHJhY3RSR0JBID0gcmVxdWlyZSgnLi9leHRyYWN0cmdiYS5qcycpO1xuXG52YXIgZXh0cmFjdENvbG9yID0gZnVuY3Rpb24oc3RyKSB7XG4gICAgaWYgKHN0ci5pbmRleE9mKFwicmdiKFwiKSA+IC0xKSB7XG5cdHJldHVybiB7XG5cdCAgICAncmdiJzogc3RyLFxuXHQgICAgJ29wYWNpdHknOiAxXG5cdH07XG4gICAgfVxuICAgIHZhciByZ2JhX2FyciA9IGV4dHJhY3RSR0JBKHN0cik7XG4gICAgcmV0dXJuIHtcblx0J3JnYic6ICdyZ2IoJytyZ2JhX2FyclswXSoyNTUrJywnK3JnYmFfYXJyWzFdKjI1NSsnLCcrcmdiYV9hcnJbMl0qMjU1KycpJyxcblx0J29wYWNpdHknOiByZ2JhX2FyclszXVxuICAgIH07XG59O1xuXG52YXIgcmVjdGFuZ2xlVG9TVkcgPSBmdW5jdGlvbiAocGFyYW1zLCBvZmZzZXRfeCwgb2Zmc2V0X3kpIHtcbiAgICB2YXIgc3Ryb2tlX2NvbG9yID0gZXh0cmFjdENvbG9yKHBhcmFtcy5zdHJva2UpO1xuICAgIHZhciBmaWxsX2NvbG9yID0gZXh0cmFjdENvbG9yKHBhcmFtcy5maWxsKTtcbiAgICByZXR1cm4gbWFrZVNWR0VsZW1lbnQoJ3JlY3QnLCB7XG5cdHdpZHRoOiBwYXJhbXMud2lkdGgsXG5cdGhlaWdodDogcGFyYW1zLmhlaWdodCxcblx0eDogcGFyc2VGbG9hdChwYXJhbXMueCkgKyBvZmZzZXRfeCxcblx0eTogcGFyc2VGbG9hdChwYXJhbXMueSkgKyBvZmZzZXRfeSxcblx0c3Ryb2tlOiBzdHJva2VfY29sb3IucmdiLFxuXHQnc3Ryb2tlLW9wYWNpdHknOiBzdHJva2VfY29sb3Iub3BhY2l0eSxcblx0J3N0cm9rZS13aWR0aCc6IHBhcmFtc1snc3Ryb2tlLXdpZHRoJ10sXG5cdGZpbGw6IGZpbGxfY29sb3IucmdiLFxuXHQnZmlsbC1vcGFjaXR5JzogZmlsbF9jb2xvci5vcGFjaXR5XG4gICAgfSk7XG59O1xuXG52YXIgdHJpYW5nbGVUb1NWRyA9IGZ1bmN0aW9uIChwYXJhbXMsIG9mZnNldF94LCBvZmZzZXRfeSkge1xuICAgIHZhciBzdHJva2VfY29sb3IgPSBleHRyYWN0Q29sb3IocGFyYW1zLnN0cm9rZSk7XG4gICAgdmFyIGZpbGxfY29sb3IgPSBleHRyYWN0Q29sb3IocGFyYW1zLmZpbGwpO1xuICAgIHJldHVybiBtYWtlU1ZHRWxlbWVudCgncG9seWdvbicsIHtcblx0cG9pbnRzOiBbW3BhcnNlRmxvYXQocGFyYW1zLngxKSArIG9mZnNldF94LCBwYXJzZUZsb2F0KHBhcmFtcy55MSkgKyBvZmZzZXRfeV0sIFtwYXJzZUZsb2F0KHBhcmFtcy54MikgKyBvZmZzZXRfeCwgcGFyc2VGbG9hdChwYXJhbXMueTIpICsgb2Zmc2V0X3ldLCBbcGFyc2VGbG9hdChwYXJhbXMueDMpICsgb2Zmc2V0X3gsIHBhcnNlRmxvYXQocGFyYW1zLnkzKSArIG9mZnNldF95XV0ubWFwKGZ1bmN0aW9uIChhKSB7XG5cdCAgICByZXR1cm4gYVswXSArICcsJyArIGFbMV07XG5cdH0pLmpvaW4oJyAnKSxcblx0c3Ryb2tlOiBzdHJva2VfY29sb3IucmdiLFxuXHQnc3Ryb2tlLW9wYWNpdHknOiBzdHJva2VfY29sb3Iub3BhY2l0eSxcblx0J3N0cm9rZS13aWR0aCc6IHBhcmFtc1snc3Ryb2tlLXdpZHRoJ10sXG5cdGZpbGw6IGZpbGxfY29sb3IucmdiLFxuXHQnZmlsbC1vcGFjaXR5JzogZmlsbF9jb2xvci5vcGFjaXR5XG4gICAgfSk7XG59O1xuXG52YXIgZWxsaXBzZVRvU1ZHID0gZnVuY3Rpb24gKHBhcmFtcywgb2Zmc2V0X3gsIG9mZnNldF95KSB7XG4gICAgdmFyIHN0cm9rZV9jb2xvciA9IGV4dHJhY3RDb2xvcihwYXJhbXMuc3Ryb2tlKTtcbiAgICB2YXIgZmlsbF9jb2xvciA9IGV4dHJhY3RDb2xvcihwYXJhbXMuZmlsbCk7XG4gICAgcmV0dXJuIG1ha2VTVkdFbGVtZW50KCdlbGxpcHNlJywge1xuXHRyeDogcGFyc2VGbG9hdChwYXJhbXMud2lkdGgpIC8gMixcblx0aGVpZ2h0OiBwYXJzZUZsb2F0KHBhcmFtcy5oZWlnaHQpIC8gMixcblx0Y3g6IHBhcnNlRmxvYXQocGFyYW1zLngpICsgb2Zmc2V0X3gsXG5cdGN5OiBwYXJzZUZsb2F0KHBhcmFtcy55KSArIG9mZnNldF95LFxuXHRzdHJva2U6IHN0cm9rZV9jb2xvci5yZ2IsXG5cdCdzdHJva2Utb3BhY2l0eSc6IHN0cm9rZV9jb2xvci5vcGFjaXR5LFxuXHQnc3Ryb2tlLXdpZHRoJzogcGFyYW1zWydzdHJva2Utd2lkdGgnXSxcblx0ZmlsbDogZmlsbF9jb2xvci5yZ2IsXG5cdCdmaWxsLW9wYWNpdHknOiBmaWxsX2NvbG9yLm9wYWNpdHlcbiAgICB9KTtcbn07XG5cbnZhciBsaW5lVG9TVkcgPSBmdW5jdGlvbiAocGFyYW1zLCBvZmZzZXRfeCwgb2Zmc2V0X3kpIHtcbiAgICB2YXIgc3Ryb2tlX2NvbG9yID0gZXh0cmFjdENvbG9yKHBhcmFtcy5zdHJva2UpO1xuICAgIHJldHVybiBtYWtlU1ZHRWxlbWVudCgnbGluZScsIHtcblx0eDE6IHBhcnNlRmxvYXQocGFyYW1zLngxKSArIG9mZnNldF94LFxuXHR5MTogcGFyc2VGbG9hdChwYXJhbXMueTEpICsgb2Zmc2V0X3ksXG5cdHgyOiBwYXJzZUZsb2F0KHBhcmFtcy54MikgKyBvZmZzZXRfeCxcblx0eTI6IHBhcnNlRmxvYXQocGFyYW1zLnkyKSArIG9mZnNldF95LFxuXHRzdHJva2U6IHN0cm9rZV9jb2xvci5yZ2IsXG5cdCdzdHJva2Utb3BhY2l0eSc6IHN0cm9rZV9jb2xvci5vcGFjaXR5LFxuXHQnc3Ryb2tlLXdpZHRoJzogcGFyYW1zWydzdHJva2Utd2lkdGgnXSxcbiAgICB9KTtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24ob25jb3ByaW50X3NoYXBlX2NvbXB1dGVkX3BhcmFtcywgb2Zmc2V0X3gsIG9mZnNldF95KSB7XG4gICAgdmFyIHR5cGUgPSBvbmNvcHJpbnRfc2hhcGVfY29tcHV0ZWRfcGFyYW1zLnR5cGU7XG4gICAgaWYgKHR5cGUgPT09ICdyZWN0YW5nbGUnKSB7XG5cdHJldHVybiByZWN0YW5nbGVUb1NWRyhvbmNvcHJpbnRfc2hhcGVfY29tcHV0ZWRfcGFyYW1zLCBvZmZzZXRfeCwgb2Zmc2V0X3kpO1xuICAgIH0gZWxzZSBpZiAodHlwZSA9PT0gJ3RyaWFuZ2xlJykge1xuXHRyZXR1cm4gdHJpYW5nbGVUb1NWRyhvbmNvcHJpbnRfc2hhcGVfY29tcHV0ZWRfcGFyYW1zLCBvZmZzZXRfeCwgb2Zmc2V0X3kpO1xuICAgIH0gZWxzZSBpZiAodHlwZSA9PT0gJ2VsbGlwc2UnKSB7XG5cdHJldHVybiBlbGxpcHNlVG9TVkcob25jb3ByaW50X3NoYXBlX2NvbXB1dGVkX3BhcmFtcywgb2Zmc2V0X3gsIG9mZnNldF95KTtcbiAgICB9IGVsc2UgaWYgKHR5cGUgPT09ICdsaW5lJykge1xuXHRyZXR1cm4gbGluZVRvU1ZHKG9uY29wcmludF9zaGFwZV9jb21wdXRlZF9wYXJhbXMsIG9mZnNldF94LCBvZmZzZXRfeSk7XG4gICAgfVxufTsiLCJ2YXIgaGFsZnNxcnQyID0gTWF0aC5zcXJ0KDIpIC8gMjtcblxudmFyIGV4dHJhY3RSR0JBID0gZnVuY3Rpb24gKHN0cikge1xuICAgIHZhciByZXQgPSBbMCwgMCwgMCwgMV07XG4gICAgaWYgKHN0clswXSA9PT0gXCIjXCIpIHtcblx0Ly8gaGV4LCBjb252ZXJ0IHRvIHJnYmFcblx0dmFyIHIgPSBwYXJzZUludChzdHJbMV0gKyBzdHJbMl0sIDE2KTtcblx0dmFyIGcgPSBwYXJzZUludChzdHJbM10gKyBzdHJbNF0sIDE2KTtcblx0dmFyIGIgPSBwYXJzZUludChzdHJbNV0gKyBzdHJbNl0sIDE2KTtcblx0c3RyID0gJ3JnYmEoJytyKycsJytnKycsJytiKycsMSknO1xuICAgIH1cbiAgICB2YXIgbWF0Y2ggPSBzdHIubWF0Y2goL15bXFxzXSpyZ2JhXFwoW1xcc10qKFswLTldKylbXFxzXSosW1xcc10qKFswLTldKylbXFxzXSosW1xcc10qKFswLTldKylbXFxzXSosW1xcc10qKFswLTkuXSspW1xcc10qXFwpW1xcc10qJC8pO1xuICAgIGlmIChtYXRjaCAmJiBtYXRjaC5sZW5ndGggPT09IDUpIHtcblx0cmV0ID0gW3BhcnNlRmxvYXQobWF0Y2hbMV0pIC8gMjU1LFxuXHQgICAgcGFyc2VGbG9hdChtYXRjaFsyXSkgLyAyNTUsXG5cdCAgICBwYXJzZUZsb2F0KG1hdGNoWzNdKSAvIDI1NSxcblx0ICAgIHBhcnNlRmxvYXQobWF0Y2hbNF0pXTtcbiAgICB9XG4gICAgcmV0dXJuIHJldDtcbn07XG5cbnZhciBhZGRWZXJ0ZXhDb2xvciA9IGZ1bmN0aW9uICh2ZXJ0ZXhfY29sb3JfYXJyYXksIHJnYmFfc3RyLCBuX3RpbWVzKSB7XG4gICAgdmFyIGNvbG9yID0gZXh0cmFjdFJHQkEocmdiYV9zdHIpO1xuICAgIGZvciAodmFyIGggPSAwOyBoIDwgbl90aW1lczsgaCsrKSB7XG5cdHZlcnRleF9jb2xvcl9hcnJheS5wdXNoKGNvbG9yWzBdLCBjb2xvclsxXSwgY29sb3JbMl0sIGNvbG9yWzNdKTtcbiAgICB9XG59O1xuICAgIFxudmFyIHJlY3RhbmdsZVRvVmVydGV4ZXMgPSBmdW5jdGlvbihwYXJhbXMsIHpfaW5kZXgsIHRhcmdldF9wb3NpdGlvbl9hcnJheSwgdGFyZ2V0X2NvbG9yX2FycmF5KSB7XG4gICAgLy8gU3Ryb2tlXG4gICAgdmFyIHggPSBwYXJzZUZsb2F0KHBhcmFtcy54KSwgeSA9IHBhcnNlRmxvYXQocGFyYW1zLnkpLCBoZWlnaHQgPSBwYXJzZUZsb2F0KHBhcmFtcy5oZWlnaHQpLCB3aWR0aCA9IHBhcnNlRmxvYXQocGFyYW1zLndpZHRoKTtcbiAgICB2YXIgc3Ryb2tlX3dpZHRoID0gcGFyc2VGbG9hdChwYXJhbXNbJ3N0cm9rZS13aWR0aCddKTtcblxuICAgIHRhcmdldF9wb3NpdGlvbl9hcnJheS5wdXNoKHgsIHksIHpfaW5kZXgpO1xuICAgIHRhcmdldF9wb3NpdGlvbl9hcnJheS5wdXNoKHggKyB3aWR0aCwgeSwgel9pbmRleCk7XG4gICAgdGFyZ2V0X3Bvc2l0aW9uX2FycmF5LnB1c2goeCArIHdpZHRoLCB5ICsgaGVpZ2h0LCB6X2luZGV4KTtcblxuICAgIHRhcmdldF9wb3NpdGlvbl9hcnJheS5wdXNoKHgsIHksIHpfaW5kZXgpO1xuICAgIHRhcmdldF9wb3NpdGlvbl9hcnJheS5wdXNoKHggKyB3aWR0aCwgeSArIGhlaWdodCwgel9pbmRleCk7XG4gICAgdGFyZ2V0X3Bvc2l0aW9uX2FycmF5LnB1c2goeCwgeSArIGhlaWdodCwgel9pbmRleCk7XG5cbiAgICBhZGRWZXJ0ZXhDb2xvcih0YXJnZXRfY29sb3JfYXJyYXksIHBhcmFtcy5maWxsLCA2KTtcblxuICAgIGlmIChzdHJva2Vfd2lkdGggPiAwKSB7XG5cdC8vIGxlZnQgc2lkZVxuXHR0YXJnZXRfcG9zaXRpb25fYXJyYXkucHVzaCh4LCB5LCB6X2luZGV4KTtcblx0dGFyZ2V0X3Bvc2l0aW9uX2FycmF5LnB1c2goeCArIHN0cm9rZV93aWR0aCwgeSwgel9pbmRleCk7XG5cdHRhcmdldF9wb3NpdGlvbl9hcnJheS5wdXNoKHggKyBzdHJva2Vfd2lkdGgsIHkgKyBoZWlnaHQsIHpfaW5kZXgpO1xuXG5cdHRhcmdldF9wb3NpdGlvbl9hcnJheS5wdXNoKHgsIHksIHpfaW5kZXgpO1xuXHR0YXJnZXRfcG9zaXRpb25fYXJyYXkucHVzaCh4ICsgc3Ryb2tlX3dpZHRoLCB5ICsgaGVpZ2h0LCB6X2luZGV4KTtcblx0dGFyZ2V0X3Bvc2l0aW9uX2FycmF5LnB1c2goeCwgeSArIGhlaWdodCwgel9pbmRleCk7XG5cblx0Ly8gcmlnaHQgc2lkZVxuXHR0YXJnZXRfcG9zaXRpb25fYXJyYXkucHVzaCh4ICsgd2lkdGgsIHksIHpfaW5kZXgpO1xuXHR0YXJnZXRfcG9zaXRpb25fYXJyYXkucHVzaCh4ICsgd2lkdGggLSBzdHJva2Vfd2lkdGgsIHksIHpfaW5kZXgpO1xuXHR0YXJnZXRfcG9zaXRpb25fYXJyYXkucHVzaCh4ICsgd2lkdGggLSBzdHJva2Vfd2lkdGgsIHkgKyBoZWlnaHQsIHpfaW5kZXgpO1xuXG5cdHRhcmdldF9wb3NpdGlvbl9hcnJheS5wdXNoKHggKyB3aWR0aCwgeSwgel9pbmRleCk7XG5cdHRhcmdldF9wb3NpdGlvbl9hcnJheS5wdXNoKHggKyB3aWR0aCAtIHN0cm9rZV93aWR0aCwgeSArIGhlaWdodCwgel9pbmRleCk7XG5cdHRhcmdldF9wb3NpdGlvbl9hcnJheS5wdXNoKHggKyB3aWR0aCwgeSArIGhlaWdodCwgel9pbmRleCk7XG5cblx0Ly8gdG9wIHNpZGVcblx0dGFyZ2V0X3Bvc2l0aW9uX2FycmF5LnB1c2goeCwgeSwgel9pbmRleCk7XG5cdHRhcmdldF9wb3NpdGlvbl9hcnJheS5wdXNoKHggKyB3aWR0aCwgeSwgel9pbmRleCk7XG5cdHRhcmdldF9wb3NpdGlvbl9hcnJheS5wdXNoKHggKyB3aWR0aCwgeSArIHN0cm9rZV93aWR0aCwgel9pbmRleCk7XG5cblx0dGFyZ2V0X3Bvc2l0aW9uX2FycmF5LnB1c2goeCwgeSwgel9pbmRleCk7XG5cdHRhcmdldF9wb3NpdGlvbl9hcnJheS5wdXNoKHggKyB3aWR0aCwgeSArIHN0cm9rZV93aWR0aCwgel9pbmRleCk7XG5cdHRhcmdldF9wb3NpdGlvbl9hcnJheS5wdXNoKHgsIHkgKyBzdHJva2Vfd2lkdGgsIHpfaW5kZXgpO1xuXG5cdC8vIGJvdHRvbSBzaWRlXG5cdHRhcmdldF9wb3NpdGlvbl9hcnJheS5wdXNoKHgsIHkgKyBoZWlnaHQsIHpfaW5kZXgpO1xuXHR0YXJnZXRfcG9zaXRpb25fYXJyYXkucHVzaCh4ICsgd2lkdGgsIHkgKyBoZWlnaHQsIHpfaW5kZXgpO1xuXHR0YXJnZXRfcG9zaXRpb25fYXJyYXkucHVzaCh4ICsgd2lkdGgsIHkgKyBoZWlnaHQgLSBzdHJva2Vfd2lkdGgsIHpfaW5kZXgpO1xuXG5cdHRhcmdldF9wb3NpdGlvbl9hcnJheS5wdXNoKHgsIHkgKyBoZWlnaHQsIHpfaW5kZXgpO1xuXHR0YXJnZXRfcG9zaXRpb25fYXJyYXkucHVzaCh4ICsgd2lkdGgsIHkgKyBoZWlnaHQgLSBzdHJva2Vfd2lkdGgsIHpfaW5kZXgpO1xuXHR0YXJnZXRfcG9zaXRpb25fYXJyYXkucHVzaCh4LCB5ICsgaGVpZ2h0IC0gc3Ryb2tlX3dpZHRoLCB6X2luZGV4KTtcblxuXHRhZGRWZXJ0ZXhDb2xvcih0YXJnZXRfY29sb3JfYXJyYXksIHBhcmFtcy5zdHJva2UsIDYgKiA0KTtcbiAgICB9XG59O1xudmFyIHRyaWFuZ2xlVG9WZXJ0ZXhlcyA9IGZ1bmN0aW9uKHBhcmFtcywgel9pbmRleCwgdGFyZ2V0X3Bvc2l0aW9uX2FycmF5LCB0YXJnZXRfY29sb3JfYXJyYXkpIHtcbiAgICB0YXJnZXRfcG9zaXRpb25fYXJyYXkucHVzaChwYXJzZUZsb2F0KHBhcmFtcy54MSksIHBhcnNlRmxvYXQocGFyYW1zLnkxKSwgel9pbmRleCk7XG4gICAgdGFyZ2V0X3Bvc2l0aW9uX2FycmF5LnB1c2gocGFyc2VGbG9hdChwYXJhbXMueDIpLCBwYXJzZUZsb2F0KHBhcmFtcy55MiksIHpfaW5kZXgpO1xuICAgIHRhcmdldF9wb3NpdGlvbl9hcnJheS5wdXNoKHBhcnNlRmxvYXQocGFyYW1zLngzKSwgcGFyc2VGbG9hdChwYXJhbXMueTMpLCB6X2luZGV4KTtcblxuICAgIGFkZFZlcnRleENvbG9yKHRhcmdldF9jb2xvcl9hcnJheSwgcGFyYW1zLmZpbGwsIDMpO1xufTtcbnZhciBlbGxpcHNlVG9WZXJ0ZXhlcyA9IGZ1bmN0aW9uKHBhcmFtcywgel9pbmRleCwgdGFyZ2V0X3Bvc2l0aW9uX2FycmF5LCB0YXJnZXRfY29sb3JfYXJyYXkpIHtcbiAgICB2YXIgY2VudGVyID0ge3g6IHBhcnNlRmxvYXQocGFyYW1zLngpICsgcGFyc2VGbG9hdChwYXJhbXMud2lkdGgpIC8gMiwgeTogcGFyc2VGbG9hdChwYXJhbXMueSkgKyBwYXJzZUZsb2F0KHBhcmFtcy5oZWlnaHQpIC8gMn07XG4gICAgdmFyIGhvcnpyYWQgPSBwYXJzZUZsb2F0KHBhcmFtcy53aWR0aCkgLyAyO1xuICAgIHZhciB2ZXJ0cmFkID0gcGFyc2VGbG9hdChwYXJhbXMuaGVpZ2h0KSAvIDI7XG5cbiAgICB0YXJnZXRfcG9zaXRpb25fYXJyYXkucHVzaChjZW50ZXIueCwgY2VudGVyLnksIHpfaW5kZXgpO1xuICAgIHRhcmdldF9wb3NpdGlvbl9hcnJheS5wdXNoKGNlbnRlci54ICsgaG9yenJhZCwgY2VudGVyLnksIHpfaW5kZXgpO1xuICAgIHRhcmdldF9wb3NpdGlvbl9hcnJheS5wdXNoKGNlbnRlci54ICsgaGFsZnNxcnQyICogaG9yenJhZCwgY2VudGVyLnkgKyBoYWxmc3FydDIgKiB2ZXJ0cmFkLCB6X2luZGV4KTtcblxuICAgIHRhcmdldF9wb3NpdGlvbl9hcnJheS5wdXNoKGNlbnRlci54LCBjZW50ZXIueSwgel9pbmRleCk7XG4gICAgdGFyZ2V0X3Bvc2l0aW9uX2FycmF5LnB1c2goY2VudGVyLnggKyBoYWxmc3FydDIgKiBob3J6cmFkLCBjZW50ZXIueSArIGhhbGZzcXJ0MiAqIHZlcnRyYWQsIHpfaW5kZXgpO1xuICAgIHRhcmdldF9wb3NpdGlvbl9hcnJheS5wdXNoKGNlbnRlci54LCBjZW50ZXIueSArIHZlcnRyYWQsIHpfaW5kZXgpO1xuXG4gICAgdGFyZ2V0X3Bvc2l0aW9uX2FycmF5LnB1c2goY2VudGVyLngsIGNlbnRlci55LCB6X2luZGV4KTtcbiAgICB0YXJnZXRfcG9zaXRpb25fYXJyYXkucHVzaChjZW50ZXIueCwgY2VudGVyLnkgKyB2ZXJ0cmFkLCB6X2luZGV4KTtcbiAgICB0YXJnZXRfcG9zaXRpb25fYXJyYXkucHVzaChjZW50ZXIueCAtIGhhbGZzcXJ0MiAqIGhvcnpyYWQsIGNlbnRlci55ICsgaGFsZnNxcnQyICogdmVydHJhZCwgel9pbmRleCk7XG5cbiAgICB0YXJnZXRfcG9zaXRpb25fYXJyYXkucHVzaChjZW50ZXIueCwgY2VudGVyLnksIHpfaW5kZXgpO1xuICAgIHRhcmdldF9wb3NpdGlvbl9hcnJheS5wdXNoKGNlbnRlci54IC0gaGFsZnNxcnQyICogaG9yenJhZCwgY2VudGVyLnkgKyBoYWxmc3FydDIgKiB2ZXJ0cmFkLCB6X2luZGV4KTtcbiAgICB0YXJnZXRfcG9zaXRpb25fYXJyYXkucHVzaChjZW50ZXIueCAtIGhvcnpyYWQsIGNlbnRlci55LCB6X2luZGV4KTtcblxuICAgIHRhcmdldF9wb3NpdGlvbl9hcnJheS5wdXNoKGNlbnRlci54LCBjZW50ZXIueSwgel9pbmRleCk7XG4gICAgdGFyZ2V0X3Bvc2l0aW9uX2FycmF5LnB1c2goY2VudGVyLnggLSBob3J6cmFkLCBjZW50ZXIueSwgel9pbmRleCk7XG4gICAgdGFyZ2V0X3Bvc2l0aW9uX2FycmF5LnB1c2goY2VudGVyLnggLSBoYWxmc3FydDIgKiBob3J6cmFkLCBjZW50ZXIueSAtIGhhbGZzcXJ0MiAqIHZlcnRyYWQsIHpfaW5kZXgpO1xuXG4gICAgdGFyZ2V0X3Bvc2l0aW9uX2FycmF5LnB1c2goY2VudGVyLngsIGNlbnRlci55LCB6X2luZGV4KTtcbiAgICB0YXJnZXRfcG9zaXRpb25fYXJyYXkucHVzaChjZW50ZXIueCAtIGhhbGZzcXJ0MiAqIGhvcnpyYWQsIGNlbnRlci55IC0gaGFsZnNxcnQyICogdmVydHJhZCwgel9pbmRleCk7XG4gICAgdGFyZ2V0X3Bvc2l0aW9uX2FycmF5LnB1c2goY2VudGVyLngsIGNlbnRlci55IC0gdmVydHJhZCwgel9pbmRleCk7XG5cbiAgICB0YXJnZXRfcG9zaXRpb25fYXJyYXkucHVzaChjZW50ZXIueCwgY2VudGVyLnksIHpfaW5kZXgpO1xuICAgIHRhcmdldF9wb3NpdGlvbl9hcnJheS5wdXNoKGNlbnRlci54LCBjZW50ZXIueSAtIHZlcnRyYWQsIHpfaW5kZXgpO1xuICAgIHRhcmdldF9wb3NpdGlvbl9hcnJheS5wdXNoKGNlbnRlci54ICsgaGFsZnNxcnQyICogaG9yenJhZCwgY2VudGVyLnkgLSBoYWxmc3FydDIgKiB2ZXJ0cmFkLCB6X2luZGV4KTtcblxuICAgIHRhcmdldF9wb3NpdGlvbl9hcnJheS5wdXNoKGNlbnRlci54LCBjZW50ZXIueSwgel9pbmRleCk7XG4gICAgdGFyZ2V0X3Bvc2l0aW9uX2FycmF5LnB1c2goY2VudGVyLnggKyBoYWxmc3FydDIgKiBob3J6cmFkLCBjZW50ZXIueSAtIGhhbGZzcXJ0MiAqIHZlcnRyYWQsIHpfaW5kZXgpO1xuICAgIHRhcmdldF9wb3NpdGlvbl9hcnJheS5wdXNoKGNlbnRlci54ICsgaG9yenJhZCwgY2VudGVyLnksIHpfaW5kZXgpO1xuXG4gICAgYWRkVmVydGV4Q29sb3IodGFyZ2V0X2NvbG9yX2FycmF5LCBwYXJhbXMuZmlsbCwgMyAqIDgpO1xufTtcbnZhciBsaW5lVG9WZXJ0ZXhlcyA9IGZ1bmN0aW9uKHBhcmFtcywgel9pbmRleCwgdGFyZ2V0X3Bvc2l0aW9uX2FycmF5LCB0YXJnZXRfY29sb3JfYXJyYXkpIHtcbiAgICAvLyBGb3Igc2ltcGxpY2l0eSBvZiBkZWFsaW5nIHdpdGggd2ViR0wgd2UnbGwgaW1wbGVtZW50IGxpbmVzIGFzIHRoaW4gdHJpYW5nbGUgcGFpcnNcbiAgICB2YXIgeDEgPSBwYXJzZUZsb2F0KHBhcmFtcy54MSk7XG4gICAgdmFyIHgyID0gcGFyc2VGbG9hdChwYXJhbXMueDIpO1xuICAgIHZhciB5MSA9IHBhcnNlRmxvYXQocGFyYW1zLnkxKTtcbiAgICB2YXIgeTIgPSBwYXJzZUZsb2F0KHBhcmFtcy55Mik7XG5cbiAgICBpZiAoeDEgIT09IHgyKSB7XG5cdC8vIFdMT0cgbWFrZSB4MSx5MSB0aGUgb25lIG9uIHRoZSBsZWZ0XG5cdGlmIChNYXRoLm1pbih4MSwgeDIpID09PSB4Mikge1xuXHQgICAgdmFyIHRtcHgxID0geDE7XG5cdCAgICB2YXIgdG1weTEgPSB5MTtcblx0ICAgIHgxID0geDI7XG5cdCAgICB5MSA9IHkyO1xuXHQgICAgeDIgPSB0bXB4MTtcblx0ICAgIHkyID0gdG1weTE7XG5cdH1cbiAgICB9XG5cbiAgICB2YXIgcGVycGVuZGljdWxhcl92ZWN0b3IgPSBbeTIgLSB5MSwgeDEgLSB4Ml07XG4gICAgdmFyIHBlcnBlbmRpY3VsYXJfdmVjdG9yX2xlbmd0aCA9IE1hdGguc3FydChwZXJwZW5kaWN1bGFyX3ZlY3RvclswXSAqIHBlcnBlbmRpY3VsYXJfdmVjdG9yWzBdICsgcGVycGVuZGljdWxhcl92ZWN0b3JbMV0gKiBwZXJwZW5kaWN1bGFyX3ZlY3RvclsxXSk7XG4gICAgdmFyIHVuaXRfcGVycF92ZWN0b3IgPSBbcGVycGVuZGljdWxhcl92ZWN0b3JbMF0gLyBwZXJwZW5kaWN1bGFyX3ZlY3Rvcl9sZW5ndGgsIHBlcnBlbmRpY3VsYXJfdmVjdG9yWzFdIC8gcGVycGVuZGljdWxhcl92ZWN0b3JfbGVuZ3RoXTtcblxuICAgIHZhciBoYWxmX3N0cm9rZV93aWR0aCA9IHBhcnNlRmxvYXQocGFyYW1zWydzdHJva2Utd2lkdGgnXSkgLyAyO1xuICAgIHZhciBkaXJlY3Rpb24xID0gW3VuaXRfcGVycF92ZWN0b3JbMF0gKiBoYWxmX3N0cm9rZV93aWR0aCwgdW5pdF9wZXJwX3ZlY3RvclsxXSAqIGhhbGZfc3Ryb2tlX3dpZHRoXTtcbiAgICB2YXIgZGlyZWN0aW9uMiA9IFtkaXJlY3Rpb24xWzBdICogLTEsIGRpcmVjdGlvbjFbMV0gKiAtMV07XG4gICAgdmFyIEEgPSBbeDEgKyBkaXJlY3Rpb24xWzBdLCB5MSArIGRpcmVjdGlvbjFbMV1dO1xuICAgIHZhciBCID0gW3gxICsgZGlyZWN0aW9uMlswXSwgeTEgKyBkaXJlY3Rpb24yWzFdXTtcbiAgICB2YXIgQyA9IFt4MiArIGRpcmVjdGlvbjFbMF0sIHkyICsgZGlyZWN0aW9uMVsxXV07XG4gICAgdmFyIEQgPSBbeDIgKyBkaXJlY3Rpb24yWzBdLCB5MiArIGRpcmVjdGlvbjJbMV1dO1xuXG4gICAgdGFyZ2V0X3Bvc2l0aW9uX2FycmF5LnB1c2goQVswXSwgQVsxXSwgel9pbmRleCk7XG4gICAgdGFyZ2V0X3Bvc2l0aW9uX2FycmF5LnB1c2goQlswXSwgQlsxXSwgel9pbmRleCk7XG4gICAgdGFyZ2V0X3Bvc2l0aW9uX2FycmF5LnB1c2goQ1swXSwgQ1sxXSwgel9pbmRleCk7XG5cbiAgICB0YXJnZXRfcG9zaXRpb25fYXJyYXkucHVzaChDWzBdLCBDWzFdLCB6X2luZGV4KTtcbiAgICB0YXJnZXRfcG9zaXRpb25fYXJyYXkucHVzaChEWzBdLCBEWzFdLCB6X2luZGV4KTtcbiAgICB0YXJnZXRfcG9zaXRpb25fYXJyYXkucHVzaChCWzBdLCBCWzFdLCB6X2luZGV4KTtcblxuICAgIGFkZFZlcnRleENvbG9yKHRhcmdldF9jb2xvcl9hcnJheSwgcGFyYW1zLnN0cm9rZSwgMyAqIDIpO1xufTtcbm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24ob25jb3ByaW50X3NoYXBlX2NvbXB1dGVkX3BhcmFtcywgel9pbmRleCwgdGFyZ2V0X3Bvc2l0aW9uX2FycmF5LCB0YXJnZXRfY29sb3JfYXJyYXkpIHtcbiAgICAvLyB0YXJnZXRfcG9zaXRpb25fYXJyYXkgaXMgYW4gYXJyYXkgd2l0aCAzLWQgZmxvYXQgdmVydGV4ZXNcbiAgICAvLyB0YXJnZXRfY29sb3JfYXJyYXkgaXMgYW4gYXJyYXkgd2l0aCByZ2JhIHZhbHVlcyBpbiBbMCwxXVxuICAgIC8vIFdlIHBhc3MgdGhlbSBpbiB0byBzYXZlIG9uIGNvbmNhdGVuYXRpb24gY29zdHNcbiAgICBcbiAgICB2YXIgdHlwZSA9IG9uY29wcmludF9zaGFwZV9jb21wdXRlZF9wYXJhbXMudHlwZTtcbiAgICBpZiAodHlwZSA9PT0gXCJyZWN0YW5nbGVcIikge1xuXHRyZXR1cm4gcmVjdGFuZ2xlVG9WZXJ0ZXhlcyhvbmNvcHJpbnRfc2hhcGVfY29tcHV0ZWRfcGFyYW1zLCB6X2luZGV4LCB0YXJnZXRfcG9zaXRpb25fYXJyYXksIHRhcmdldF9jb2xvcl9hcnJheSk7XG4gICAgfSBlbHNlIGlmICh0eXBlID09PSBcInRyaWFuZ2xlXCIpIHtcblx0cmV0dXJuIHRyaWFuZ2xlVG9WZXJ0ZXhlcyhvbmNvcHJpbnRfc2hhcGVfY29tcHV0ZWRfcGFyYW1zLCB6X2luZGV4LCB0YXJnZXRfcG9zaXRpb25fYXJyYXksIHRhcmdldF9jb2xvcl9hcnJheSk7XG4gICAgfSBlbHNlIGlmICh0eXBlID09PSBcImVsbGlwc2VcIikge1xuXHRyZXR1cm4gZWxsaXBzZVRvVmVydGV4ZXMob25jb3ByaW50X3NoYXBlX2NvbXB1dGVkX3BhcmFtcywgel9pbmRleCwgdGFyZ2V0X3Bvc2l0aW9uX2FycmF5LCB0YXJnZXRfY29sb3JfYXJyYXkpO1xuICAgIH0gZWxzZSBpZiAodHlwZSA9PT0gXCJsaW5lXCIpIHtcblx0cmV0dXJuIGxpbmVUb1ZlcnRleGVzKG9uY29wcmludF9zaGFwZV9jb21wdXRlZF9wYXJhbXMsIHpfaW5kZXgsIHRhcmdldF9wb3NpdGlvbl9hcnJheSwgdGFyZ2V0X2NvbG9yX2FycmF5KTtcbiAgICB9XG59IiwidmFyIE9uY29wcmludFRvb2xUaXAgPSAoZnVuY3Rpb24oKSB7XG4gICAgZnVuY3Rpb24gT25jb3ByaW50VG9vbFRpcCgkY29udGFpbmVyLCBwYXJhbXMpIHtcblx0cGFyYW1zID0gcGFyYW1zIHx8IHt9O1xuXHR0aGlzLiRjb250YWluZXIgPSAkY29udGFpbmVyO1xuXHR0aGlzLiRkaXYgPSAkKCc8ZGl2PjwvZGl2PicpLmFwcGVuZFRvKCRjb250YWluZXIpLmNzcyh7J2JhY2tncm91bmQtY29sb3InOidyZ2JhKDI1NSwyNTUsMjU1LDEpJywgJ3Bvc2l0aW9uJzonYWJzb2x1dGUnLCAnZGlzcGxheSc6J25vbmUnLCAnYm9yZGVyJzonMXB4IHNvbGlkIGJsYWNrJywgJ21heC13aWR0aCc6MzAwLCAnbWluLXdpZHRoJzoxNTB9KTtcblx0aWYgKHBhcmFtcy5ub3NlbGVjdCkge1xuXHQgICAgdGhpcy4kZGl2LmFkZENsYXNzKFwibm9zZWxlY3RcIik7XG5cdH1cblx0dGhpcy5oaWRlX3RpbWVvdXRfaWQgPSB1bmRlZmluZWQ7XG5cdHRoaXMuc2hvd190aW1lb3V0X2lkID0gdW5kZWZpbmVkO1xuXHR0aGlzLmNlbnRlciA9IGZhbHNlO1xuXHRcblx0dGhpcy5zaG93biA9IGZhbHNlO1xuXHRcblx0dmFyIHNlbGYgPSB0aGlzO1xuXHR0aGlzLiRkaXYub24oXCJtb3VzZW1vdmVcIiwgZnVuY3Rpb24oZXZ0KSB7XG5cdCAgICBldnQuc3RvcFByb3BhZ2F0aW9uKCk7XG5cdCAgICBjYW5jZWxTY2hlZHVsZWRIaWRlKHNlbGYpO1xuXHR9KTtcblx0dGhpcy4kZGl2Lm9uKFwibW91c2VsZWF2ZVwiLCBmdW5jdGlvbihldnQpIHtcblx0ICAgIGV2dC5zdG9wUHJvcGFnYXRpb24oKTtcblx0ICAgIHNlbGYuaGlkZSgpO1xuXHR9KTtcbiAgICB9XG4gICAgT25jb3ByaW50VG9vbFRpcC5wcm90b3R5cGUuc2hvdyA9IGZ1bmN0aW9uKHdhaXQsIHBhZ2VfeCwgcGFnZV95LCAkY29udGVudHMsIGZhZGUpIHtcblx0Y2FuY2VsU2NoZWR1bGVkSGlkZSh0aGlzKTtcblx0XG5cdGlmICh0eXBlb2Ygd2FpdCAhPT0gJ3VuZGVmaW5lZCcgJiYgIXRoaXMuc2hvd24pIHtcblx0ICAgIHZhciBzZWxmID0gdGhpcztcblx0ICAgIGNhbmNlbFNjaGVkdWxlZFNob3codGhpcyk7XG5cdCAgICB0aGlzLnNob3dfdGltZW91dF9pZCA9IHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XG5cdFx0ZG9TaG93KHNlbGYsIHBhZ2VfeCwgcGFnZV95LCAkY29udGVudHMsIGZhZGUpO1xuXHQgICAgfSwgd2FpdCk7XG5cdH0gZWxzZSB7XG5cdCAgICBkb1Nob3codGhpcywgcGFnZV94LCBwYWdlX3ksICRjb250ZW50cywgZmFkZSk7XG5cdH1cbiAgICB9XG4gICAgdmFyIGRvU2hvdyA9IGZ1bmN0aW9uKHR0LCBwYWdlX3gsIHBhZ2VfeSwgJGNvbnRlbnRzLCBmYWRlKSB7XG5cdGNhbmNlbFNjaGVkdWxlZFNob3codHQpO1xuXHR0dC5zaG93X3RpbWVvdXRfaWQgPSB1bmRlZmluZWQ7XG5cdHR0LiRkaXYuZW1wdHkoKTtcblx0dHQuJGRpdi5hcHBlbmQoJGNvbnRlbnRzKTtcblx0aWYgKCFmYWRlKSB7XG5cdCAgICB0dC4kZGl2LnNob3coKTtcblx0fSBlbHNlIHtcblx0ICAgIHR0LiRkaXYuc3RvcCgpLmZhZGVJbignZmFzdCcpO1xuXHR9XG5cdHZhciBjb250YWluZXJfb2Zmc2V0ID0gdHQuJGNvbnRhaW5lci5vZmZzZXQoKTtcblx0dmFyIHggPSBwYWdlX3ggLSBjb250YWluZXJfb2Zmc2V0LmxlZnQgLSAodHQuY2VudGVyID8gdHQuJGRpdi53aWR0aCgpLzIgOiAwKTtcblx0dmFyIHkgPSBwYWdlX3kgLSBjb250YWluZXJfb2Zmc2V0LnRvcCAtIHR0LiRkaXYuaGVpZ2h0KCk7XG5cdHR0LiRkaXYuY3NzKHsndG9wJzp5LCAnbGVmdCc6eCwgJ3otaW5kZXgnOjk5OTl9KTtcblx0dHQuc2hvd24gPSB0cnVlO1xuICAgIH07XG4gICAgdmFyIGRvSGlkZSA9IGZ1bmN0aW9uKHR0LCBmYWRlKSB7XG5cdGNhbmNlbFNjaGVkdWxlZEhpZGUodHQpO1xuXHR0dC5oaWRlX3RpbWVvdXRfaWQgPSB1bmRlZmluZWQ7XG5cdGlmICghZmFkZSkge1xuXHQgICAgdHQuJGRpdi5oaWRlKCk7XG5cdH0gZWxzZSB7XG5cdCAgICB0dC4kZGl2LmZhZGVPdXQoKTtcblx0fVxuXHR0dC5zaG93biA9IGZhbHNlO1xuICAgIH07XG4gICAgdmFyIGNhbmNlbFNjaGVkdWxlZFNob3cgPSBmdW5jdGlvbih0dCkge1xuXHRjbGVhclRpbWVvdXQodHQuc2hvd190aW1lb3V0X2lkKTtcblx0dHQuc2hvd190aW1lb3V0X2lkID0gdW5kZWZpbmVkO1xuICAgIH07XG4gICAgdmFyIGNhbmNlbFNjaGVkdWxlZEhpZGUgPSBmdW5jdGlvbih0dCkge1xuXHRjbGVhclRpbWVvdXQodHQuaGlkZV90aW1lb3V0X2lkKTtcblx0dHQuaGlkZV90aW1lb3V0X2lkID0gdW5kZWZpbmVkO1xuICAgIH07XG4gICAgT25jb3ByaW50VG9vbFRpcC5wcm90b3R5cGUuc2hvd0lmTm90QWxyZWFkeUdvaW5nVG8gPSBmdW5jdGlvbih3YWl0LCBwYWdlX3gsIHBhZ2VfeSwgJGNvbnRlbnRzKSB7XG5cdGlmICh0eXBlb2YgdGhpcy5zaG93X3RpbWVvdXRfaWQgPT09ICd1bmRlZmluZWQnKSB7XG5cdCAgICB0aGlzLnNob3cod2FpdCwgcGFnZV94LCBwYWdlX3ksICRjb250ZW50cyk7XG5cdH1cbiAgICB9XG4gICAgT25jb3ByaW50VG9vbFRpcC5wcm90b3R5cGUuaGlkZUlmTm90QWxyZWFkeUdvaW5nVG8gPSBmdW5jdGlvbih3YWl0KSB7XG5cdGlmICh0eXBlb2YgdGhpcy5oaWRlX3RpbWVvdXRfaWQgPT09ICd1bmRlZmluZWQnKSB7XG5cdCAgICB0aGlzLmhpZGUod2FpdCk7XG5cdH1cbiAgICB9O1xuICAgIE9uY29wcmludFRvb2xUaXAucHJvdG90eXBlLmhpZGUgPSBmdW5jdGlvbih3YWl0KSB7XG5cdGNhbmNlbFNjaGVkdWxlZFNob3codGhpcyk7XG5cdFxuXHRpZiAoIXRoaXMuc2hvd24pIHtcblx0ICAgIHJldHVybjtcblx0fVxuXHRcblx0aWYgKHR5cGVvZiB3YWl0ICE9PSAndW5kZWZpbmVkJykge1xuXHQgICAgdmFyIHNlbGYgPSB0aGlzO1xuXHQgICAgY2FuY2VsU2NoZWR1bGVkSGlkZSh0aGlzKTtcblx0ICAgIHRoaXMuaGlkZV90aW1lb3V0X2lkID0gc2V0VGltZW91dChmdW5jdGlvbigpIHtcblx0XHRkb0hpZGUoc2VsZik7XG5cdCAgICB9LCB3YWl0KTtcblx0fSBlbHNlIHtcblx0ICAgIGRvSGlkZSh0aGlzKTtcblx0fVxuICAgIH1cbiAgICBPbmNvcHJpbnRUb29sVGlwLnByb3RvdHlwZS5mYWRlSW4gPSBmdW5jdGlvbih3YWl0LCBwYWdlX3gsIHBhZ2VfeSwgJGNvbnRlbnRzKSB7XG5cdHRoaXMuc2hvdyh3YWl0LCBwYWdlX3gsIHBhZ2VfeSwgJGNvbnRlbnRzLCB0cnVlKTtcbiAgICB9XG4gICAgcmV0dXJuIE9uY29wcmludFRvb2xUaXA7XG59KSgpO1xuXG5tb2R1bGUuZXhwb3J0cyA9IE9uY29wcmludFRvb2xUaXA7IiwidmFyIHN2Z2ZhY3RvcnkgPSByZXF1aXJlKCcuL3N2Z2ZhY3RvcnkuanMnKTtcblxudmFyIE9uY29wcmludFRyYWNrSW5mb1ZpZXcgPSAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIE9uY29wcmludFRyYWNrSW5mb1ZpZXcoJGRpdikge1xuXHR0aGlzLiRkaXYgPSAkZGl2O1xuXHR0aGlzLiRjdHIgPSAkKCc8ZGl2PjwvZGl2PicpLmNzcyh7J3Bvc2l0aW9uJzogJ2Fic29sdXRlJywgJ292ZXJmbG93LXknOidoaWRkZW4nLCAnb3ZlcmZsb3cteCc6J2hpZGRlbid9KS5hcHBlbmRUbyh0aGlzLiRkaXYpO1xuXHR0aGlzLiR0ZXh0X2N0ciA9ICQoJzxkaXY+PC9kaXY+JykuY3NzKHsncG9zaXRpb24nOidhYnNvbHV0ZSd9KS5hcHBlbmRUbyh0aGlzLiRjdHIpO1xuXHR0aGlzLmJhc2VfZm9udF9zaXplID0gMTI7XG5cdHRoaXMuZm9udF9mYW1pbHkgPSAnQXJpYWwnO1xuXHR0aGlzLmZvbnRfd2VpZ2h0ID0gJ2JvbGQnO1xuXHR0aGlzLndpZHRoID0gMDtcblxuXHR0aGlzLnJlbmRlcmluZ19zdXBwcmVzc2VkID0gZmFsc2U7XG4gICAgfVxuXG4gICAgdmFyIHJlbmRlckFsbEluZm8gPSBmdW5jdGlvbiAodmlldywgbW9kZWwpIHtcblx0aWYgKHZpZXcucmVuZGVyaW5nX3N1cHByZXNzZWQpIHtcblx0ICAgIHJldHVybjtcblx0fVxuXHR2aWV3LiR0ZXh0X2N0ci5lbXB0eSgpO1xuXG5cdHZhciB0cmFja3MgPSBtb2RlbC5nZXRUcmFja3MoKTtcblx0dmlldy5taW5pbXVtX3RyYWNrX2hlaWdodCA9IE51bWJlci5QT1NJVElWRV9JTkZJTklUWTtcblx0Zm9yICh2YXIgaSA9IDA7IGkgPCB0cmFja3MubGVuZ3RoOyBpKyspIHtcblx0ICAgIHZpZXcubWluaW11bV90cmFja19oZWlnaHQgPSBNYXRoLm1pbih2aWV3Lm1pbmltdW1fdHJhY2tfaGVpZ2h0LCBtb2RlbC5nZXRUcmFja0hlaWdodCh0cmFja3NbaV0pKTtcblx0fVxuXG5cdHZpZXcud2lkdGggPSA0MDtcblxuXHR2YXIgbGFiZWxfdG9wcyA9IG1vZGVsLmdldExhYmVsVG9wcygpO1xuXHRzY3JvbGwodmlldywgbW9kZWwuZ2V0VmVydFNjcm9sbCgpKTtcblx0dmFyIGZvbnRfc2l6ZSA9IHZpZXcuZ2V0Rm9udFNpemUoKTtcblx0Zm9yICh2YXIgaSA9IDA7IGkgPCB0cmFja3MubGVuZ3RoOyBpKyspIHtcblx0ICAgIHZhciAkbmV3X2xhYmVsID0gJCgnPHNwYW4+JykuY3NzKHsncG9zaXRpb24nOiAnYWJzb2x1dGUnLFxuXHRcdCdmb250LWZhbWlseSc6IHZpZXcuZm9udF9mYW1pbHksXG5cdFx0J2ZvbnQtd2VpZ2h0Jzogdmlldy5mb250X3dlaWdodCxcblx0XHQnZm9udC1zaXplJzogZm9udF9zaXplfSlcblx0XHQgICAgLmFkZENsYXNzKCdub3NlbGVjdCcpO1xuXHQgICAgJG5ld19sYWJlbC50ZXh0KG1vZGVsLmdldFRyYWNrSW5mbyh0cmFja3NbaV0pKTtcblx0ICAgICRuZXdfbGFiZWwuYXBwZW5kVG8odmlldy4kdGV4dF9jdHIpO1xuXHQgICAgdmFyIHRvcCA9IGxhYmVsX3RvcHNbdHJhY2tzW2ldXSArIChtb2RlbC5nZXRDZWxsSGVpZ2h0KHRyYWNrc1tpXSkgLSAkbmV3X2xhYmVsLm91dGVySGVpZ2h0KCkpIC8gMjtcblx0ICAgICRuZXdfbGFiZWwuY3NzKHsndG9wJzogdG9wICsgJ3B4J30pO1xuXHQgICAgdmlldy53aWR0aCA9IE1hdGgubWF4KHZpZXcud2lkdGgsICRuZXdfbGFiZWxbMF0uY2xpZW50V2lkdGgpO1xuXHR9XG4gICAgfTtcbiAgICB2YXIgc2Nyb2xsID0gZnVuY3Rpb24gKHZpZXcsIHNjcm9sbF95KSB7XG5cdGlmICh2aWV3LnJlbmRlcmluZ19zdXBwcmVzc2VkKSB7XG5cdCAgICByZXR1cm47XG5cdH1cblx0dmlldy4kdGV4dF9jdHIuY3NzKHsndG9wJzogLXNjcm9sbF95fSk7XG4gICAgfTtcblxuICAgIHZhciByZXNpemUgPSBmdW5jdGlvbiAodmlldywgbW9kZWwpIHtcblx0aWYgKHZpZXcucmVuZGVyaW5nX3N1cHByZXNzZWQpIHtcblx0ICAgIHJldHVybjtcblx0fVxuXHR2aWV3LiRkaXYuY3NzKHsnd2lkdGgnOiB2aWV3LmdldFdpZHRoKCksICdoZWlnaHQnOiBtb2RlbC5nZXRDZWxsVmlld0hlaWdodCgpfSk7XG5cdHZpZXcuJGN0ci5jc3Moeyd3aWR0aCc6IHZpZXcuZ2V0V2lkdGgoKSwgJ2hlaWdodCc6IG1vZGVsLmdldENlbGxWaWV3SGVpZ2h0KCl9KTtcbiAgICB9O1xuXG4gICAgT25jb3ByaW50VHJhY2tJbmZvVmlldy5wcm90b3R5cGUuZ2V0Rm9udFNpemUgPSBmdW5jdGlvbiAoKSB7XG5cdHJldHVybiBNYXRoLm1heChNYXRoLm1pbih0aGlzLmJhc2VfZm9udF9zaXplLCB0aGlzLm1pbmltdW1fdHJhY2tfaGVpZ2h0KSwgNyk7XG4gICAgfVxuICAgIE9uY29wcmludFRyYWNrSW5mb1ZpZXcucHJvdG90eXBlLmdldFdpZHRoID0gZnVuY3Rpb24gKCkge1xuXHRyZXR1cm4gdGhpcy53aWR0aCArIDEwO1xuICAgIH1cbiAgICBPbmNvcHJpbnRUcmFja0luZm9WaWV3LnByb3RvdHlwZS5hZGRUcmFja3MgPSBmdW5jdGlvbiAobW9kZWwpIHtcblx0cmVuZGVyQWxsSW5mbyh0aGlzLCBtb2RlbCk7XG5cdHJlc2l6ZSh0aGlzLCBtb2RlbCk7XG4gICAgfVxuICAgIE9uY29wcmludFRyYWNrSW5mb1ZpZXcucHJvdG90eXBlLm1vdmVUcmFjayA9IGZ1bmN0aW9uIChtb2RlbCkge1xuXHRyZW5kZXJBbGxJbmZvKHRoaXMsIG1vZGVsKTtcblx0cmVzaXplKHRoaXMsIG1vZGVsKTtcbiAgICB9XG4gICAgT25jb3ByaW50VHJhY2tJbmZvVmlldy5wcm90b3R5cGUuc2V0VHJhY2tHcm91cE9yZGVyID0gZnVuY3Rpb24obW9kZWwpIHtcblx0cmVuZGVyQWxsSW5mbyh0aGlzLCBtb2RlbCk7XG5cdHJlc2l6ZSh0aGlzLCBtb2RlbCk7XG4gICAgfVxuICAgIE9uY29wcmludFRyYWNrSW5mb1ZpZXcucHJvdG90eXBlLnJlbW92ZVRyYWNrID0gZnVuY3Rpb24gKG1vZGVsKSB7XG5cdHJlbmRlckFsbEluZm8odGhpcywgbW9kZWwpO1xuXHRyZXNpemUodGhpcywgbW9kZWwpO1xuICAgIH1cbiAgICBPbmNvcHJpbnRUcmFja0luZm9WaWV3LnByb3RvdHlwZS5zZXRUcmFja0luZm8gPSBmdW5jdGlvbiAobW9kZWwpIHtcblx0cmVuZGVyQWxsSW5mbyh0aGlzLCBtb2RlbCk7XG5cdHJlc2l6ZSh0aGlzLCBtb2RlbCk7XG4gICAgfVxuICAgIE9uY29wcmludFRyYWNrSW5mb1ZpZXcucHJvdG90eXBlLnNldFNjcm9sbCA9IGZ1bmN0aW9uKG1vZGVsKSB7XG5cdHRoaXMuc2V0VmVydFNjcm9sbChtb2RlbCk7XG4gICAgfVxuICAgIE9uY29wcmludFRyYWNrSW5mb1ZpZXcucHJvdG90eXBlLnNldEhvcnpTY3JvbGwgPSBmdW5jdGlvbiAobW9kZWwpIHtcbiAgICB9XG4gICAgT25jb3ByaW50VHJhY2tJbmZvVmlldy5wcm90b3R5cGUuc2V0VmVydFNjcm9sbCA9IGZ1bmN0aW9uIChtb2RlbCkge1xuXHRzY3JvbGwodGhpcywgbW9kZWwuZ2V0VmVydFNjcm9sbCgpKTtcbiAgICB9XG4gICAgT25jb3ByaW50VHJhY2tJbmZvVmlldy5wcm90b3R5cGUuc2V0Wm9vbSA9IGZ1bmN0aW9uKG1vZGVsKSB7XG5cdHRoaXMuc2V0VmVydFpvb20obW9kZWwpO1xuICAgIH1cbiAgICBcbiAgICBPbmNvcHJpbnRUcmFja0luZm9WaWV3LnByb3RvdHlwZS5zZXRWaWV3cG9ydCA9IGZ1bmN0aW9uKG1vZGVsKSB7XG5cdHJlbmRlckFsbEluZm8odGhpcywgbW9kZWwpO1xuXHRyZXNpemUodGhpcywgbW9kZWwpO1xuXHRzY3JvbGwodGhpcywgbW9kZWwuZ2V0VmVydFNjcm9sbCgpKTtcbiAgICB9XG4gICAgT25jb3ByaW50VHJhY2tJbmZvVmlldy5wcm90b3R5cGUuc2V0VmVydFpvb20gPSBmdW5jdGlvbiAobW9kZWwpIHtcblx0cmVuZGVyQWxsSW5mbyh0aGlzLCBtb2RlbCk7XG5cdHJlc2l6ZSh0aGlzLCBtb2RlbCk7XG4gICAgfVxuICAgIE9uY29wcmludFRyYWNrSW5mb1ZpZXcucHJvdG90eXBlLnN1cHByZXNzUmVuZGVyaW5nID0gZnVuY3Rpb24gKCkge1xuXHR0aGlzLnJlbmRlcmluZ19zdXBwcmVzc2VkID0gdHJ1ZTtcbiAgICB9XG4gICAgT25jb3ByaW50VHJhY2tJbmZvVmlldy5wcm90b3R5cGUucmVsZWFzZVJlbmRlcmluZyA9IGZ1bmN0aW9uIChtb2RlbCkge1xuXHR0aGlzLnJlbmRlcmluZ19zdXBwcmVzc2VkID0gZmFsc2U7XG5cdHJlbmRlckFsbEluZm8odGhpcywgbW9kZWwpO1xuXHRyZXNpemUodGhpcywgbW9kZWwpO1xuXHRzY3JvbGwodGhpcywgbW9kZWwuZ2V0VmVydFNjcm9sbCgpKTtcbiAgICB9XG4gICAgT25jb3ByaW50VHJhY2tJbmZvVmlldy5wcm90b3R5cGUudG9TVkdHcm91cCA9IGZ1bmN0aW9uIChtb2RlbCwgb2Zmc2V0X3gsIG9mZnNldF95KSB7XG5cdHZhciByb290ID0gc3ZnZmFjdG9yeS5ncm91cCgob2Zmc2V0X3ggfHwgMCksIChvZmZzZXRfeSB8fCAwKSk7XG5cdHZhciBjZWxsX3RvcHMgPSBtb2RlbC5nZXRDZWxsVG9wcygpO1xuXHR2YXIgdHJhY2tzID0gbW9kZWwuZ2V0VHJhY2tzKCk7XG5cdGZvciAodmFyIGkgPSAwOyBpIDwgdHJhY2tzLmxlbmd0aDsgaSsrKSB7XG5cdCAgICB2YXIgdHJhY2tfaWQgPSB0cmFja3NbaV07XG5cdCAgICB2YXIgeSA9IGNlbGxfdG9wc1t0cmFja19pZF0gKyBtb2RlbC5nZXRDZWxsSGVpZ2h0KHRyYWNrX2lkKSAvIDI7XG5cdCAgICB2YXIgaW5mbyA9IG1vZGVsLmdldFRyYWNrSW5mbyh0cmFja19pZCk7XG5cdCAgICB2YXIgdGV4dF9lbHQgPSBzdmdmYWN0b3J5LnRleHQoaW5mbywgMCwgeSwgdGhpcy5mb250X3NpemUsIHRoaXMuZm9udF9mYW1pbHksIHRoaXMuZm9udF93ZWlnaHQsIFwiYm90dG9tXCIpO1xuXHQgICAgdGV4dF9lbHQuc2V0QXR0cmlidXRlKFwiZHlcIiwgXCIwLjM1ZW1cIik7XG5cdCAgICByb290LmFwcGVuZENoaWxkKHRleHRfZWx0KTtcblx0fVxuXHRyZXR1cm4gcm9vdDtcbiAgICB9XG4gICAgcmV0dXJuIE9uY29wcmludFRyYWNrSW5mb1ZpZXc7XG59KSgpO1xuXG5tb2R1bGUuZXhwb3J0cyA9IE9uY29wcmludFRyYWNrSW5mb1ZpZXc7IiwidmFyIE9uY29wcmludFRyYWNrT3B0aW9uc1ZpZXcgPSAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIE9uY29wcmludFRyYWNrT3B0aW9uc1ZpZXcoJGRpdiwgbW92ZVVwQ2FsbGJhY2ssIG1vdmVEb3duQ2FsbGJhY2ssIHJlbW92ZUNhbGxiYWNrLCBzb3J0Q2hhbmdlQ2FsbGJhY2ssIHVuZXhwYW5kQ2FsbGJhY2spIHtcblx0Ly8gcmVtb3ZlQ2FsbGJhY2s6IGZ1bmN0aW9uKHRyYWNrX2lkKVxuXHR2YXIgcG9zaXRpb24gPSAkZGl2LmNzcygncG9zaXRpb24nKTtcblx0aWYgKHBvc2l0aW9uICE9PSAnYWJzb2x1dGUnICYmIHBvc2l0aW9uICE9PSAncmVsYXRpdmUnKSB7XG5cdCAgICBjb25zb2xlLmxvZyhcIldBUk5JTkc6IGRpdiBwYXNzZWQgdG8gT25jb3ByaW50VHJhY2tPcHRpb25zVmlldyBtdXN0IGJlIGFic29sdXRlIG9yIHJlbGF0aXZlIHBvc2l0aW9uZWQgLSBsYXlvdXQgcHJvYmxlbXMgd2lsbCBvY2N1clwiKTtcblx0fVxuXG5cdHRoaXMubW92ZVVwQ2FsbGJhY2sgPSBtb3ZlVXBDYWxsYmFjaztcblx0dGhpcy5tb3ZlRG93bkNhbGxiYWNrID0gbW92ZURvd25DYWxsYmFjaztcblx0dGhpcy5yZW1vdmVDYWxsYmFjayA9IHJlbW92ZUNhbGxiYWNrOyAvLyBmdW5jdGlvbih0cmFja19pZCkgeyAuLi4gfVxuXHR0aGlzLnNvcnRDaGFuZ2VDYWxsYmFjayA9IHNvcnRDaGFuZ2VDYWxsYmFjazsgLy8gZnVuY3Rpb24odHJhY2tfaWQsIGRpcikgeyAuLi4gfVxuXHR0aGlzLnVuZXhwYW5kQ2FsbGJhY2sgPSB1bmV4cGFuZENhbGxiYWNrOyAvLyBmdW5jdGlvbih0cmFja19pZClcblxuXHR0aGlzLiRkaXYgPSAkZGl2O1xuXHR0aGlzLiRjdHIgPSAkKCc8ZGl2PjwvZGl2PicpLmNzcyh7J3Bvc2l0aW9uJzogJ2Fic29sdXRlJywgJ292ZXJmbG93LXknOidoaWRkZW4nLCAnb3ZlcmZsb3cteCc6J2hpZGRlbid9KS5hcHBlbmRUbyh0aGlzLiRkaXYpO1xuXHR0aGlzLiRidXR0b25zX2N0ciA9ICQoJzxkaXY+PC9kaXY+JykuY3NzKHsncG9zaXRpb24nOidhYnNvbHV0ZSd9KS5hcHBlbmRUbyh0aGlzLiRjdHIpO1xuXHR0aGlzLiRkcm9wZG93bl9jdHIgPSAkKCc8ZGl2PjwvZGl2PicpLmNzcyh7J3Bvc2l0aW9uJzogJ2Fic29sdXRlJ30pLmFwcGVuZFRvKHRoaXMuJGRpdik7XG5cblx0dGhpcy5pbWdfc2l6ZSA9IG51bGw7XG5cblx0dGhpcy5yZW5kZXJpbmdfc3VwcHJlc3NlZCA9IGZhbHNlO1xuXG5cdHRoaXMudHJhY2tfb3B0aW9uc18kZWx0cyA9IHt9O1xuXG5cdHRoaXMubWVudV9zaG93biA9IHt9O1xuXG5cdHZhciBzZWxmID0gdGhpcztcblx0JChkb2N1bWVudCkuY2xpY2soZnVuY3Rpb24oKSB7XG5cdCAgICAkKHNlbGYpLnRyaWdnZXIoJ29uY29wcmludC10cmFjay1vcHRpb25zLXZpZXcuY2xpY2stb3V0Jyk7XG5cdH0pO1xuXG5cdHRoaXMuaW50ZXJhY3Rpb25fZGlzYWJsZWQgPSBmYWxzZTtcbiAgICB9XG4gICAgXG4gICAgdmFyIHJlbmRlckFsbE9wdGlvbnMgPSBmdW5jdGlvbih2aWV3LCBtb2RlbCkge1xuXHRpZiAodmlldy5yZW5kZXJpbmdfc3VwcHJlc3NlZCkge1xuXHQgICAgcmV0dXJuO1xuXHR9XG5cdCQodmlldykub2ZmKCdvbmNvcHJpbnQtdHJhY2stb3B0aW9ucy12aWV3LmNsaWNrLW91dCcpO1xuXHQkKHZpZXcpLm9uKCdvbmNvcHJpbnQtdHJhY2stb3B0aW9ucy12aWV3LmNsaWNrLW91dCcsIGZ1bmN0aW9uKCkge1xuXHQgICAgIGZvciAodmFyIHRyYWNrX2lkIGluIHZpZXcudHJhY2tfb3B0aW9uc18kZWx0cykge1xuXHRcdGlmICh2aWV3LnRyYWNrX29wdGlvbnNfJGVsdHMuaGFzT3duUHJvcGVydHkodHJhY2tfaWQpKSB7XG5cdFx0ICAgIGhpZGVUcmFja01lbnUodmlldywgdHJhY2tfaWQpO1xuXHRcdH1cblx0ICAgIH1cblx0fSk7XG5cdFxuXHR2aWV3LiRidXR0b25zX2N0ci5lbXB0eSgpO1xuXHR2aWV3LiRkcm9wZG93bl9jdHIuZW1wdHkoKTtcblx0c2Nyb2xsKHZpZXcsIG1vZGVsLmdldFZlcnRTY3JvbGwoKSk7XG5cblx0dmFyIHRyYWNrcyA9IG1vZGVsLmdldFRyYWNrcygpO1xuXHR2YXIgbWluaW11bV90cmFja19oZWlnaHQgPSBOdW1iZXIuUE9TSVRJVkVfSU5GSU5JVFk7XG5cdGZvciAodmFyIGkgPSAwOyBpIDwgdHJhY2tzLmxlbmd0aDsgaSsrKSB7XG5cdCAgICBtaW5pbXVtX3RyYWNrX2hlaWdodCA9IE1hdGgubWluKG1pbmltdW1fdHJhY2tfaGVpZ2h0LCBtb2RlbC5nZXRUcmFja0hlaWdodCh0cmFja3NbaV0pKTtcblx0fVxuXHR2aWV3LmltZ19zaXplID0gTWF0aC5mbG9vcihtaW5pbXVtX3RyYWNrX2hlaWdodCAqIDAuNzUpO1xuXG5cdGZvciAodmFyIGkgPSAwOyBpIDwgdHJhY2tzLmxlbmd0aDsgaSsrKSB7XG5cdCAgICByZW5kZXJUcmFja09wdGlvbnModmlldywgbW9kZWwsIHRyYWNrc1tpXSk7XG5cdH1cbiAgICB9O1xuXG4gICAgdmFyIHNjcm9sbCA9IGZ1bmN0aW9uICh2aWV3LCBzY3JvbGxfeSkge1xuXHRpZiAodmlldy5yZW5kZXJpbmdfc3VwcHJlc3NlZCkge1xuXHQgICAgcmV0dXJuO1xuXHR9XG5cdHZpZXcuJGJ1dHRvbnNfY3RyLmNzcyh7J3RvcCc6IC1zY3JvbGxfeX0pO1xuXHR2aWV3LiRkcm9wZG93bl9jdHIuY3NzKHsndG9wJzogLXNjcm9sbF95fSk7XG4gICAgfTtcblxuICAgIHZhciByZXNpemUgPSBmdW5jdGlvbiAodmlldywgbW9kZWwpIHtcblx0aWYgKHZpZXcucmVuZGVyaW5nX3N1cHByZXNzZWQpIHtcblx0ICAgIHJldHVybjtcblx0fVxuXHR2aWV3LiRkaXYuY3NzKHsnd2lkdGgnOiB2aWV3LmdldFdpZHRoKCksICdoZWlnaHQnOiBtb2RlbC5nZXRDZWxsVmlld0hlaWdodCgpfSk7XG5cdHZpZXcuJGN0ci5jc3Moeyd3aWR0aCc6IHZpZXcuZ2V0V2lkdGgoKSwgJ2hlaWdodCc6IG1vZGVsLmdldENlbGxWaWV3SGVpZ2h0KCl9KTtcbiAgICB9O1xuXG4gICAgdmFyIGhpZGVUcmFja01lbnUgPSBmdW5jdGlvbiAodmlldywgdHJhY2tfaWQpIHtcblx0dmlldy5tZW51X3Nob3duW3RyYWNrX2lkXSA9IGZhbHNlO1xuXHR2YXIgJGVsdHMgPSB2aWV3LnRyYWNrX29wdGlvbnNfJGVsdHNbdHJhY2tfaWRdO1xuXHQkZWx0cy4kZHJvcGRvd24uY3NzKHsnei1pbmRleCc6IDF9KTtcblx0JGVsdHMuJGRyb3Bkb3duLmNzcyh7J2JvcmRlcic6ICcxcHggc29saWQgcmdiYSgxMjUsMTI1LDEyNSwwKSd9KTtcblx0JGVsdHMuJGltZy5jc3Moeydib3JkZXInOiAnMXB4IHNvbGlkIHJnYmEoMTI1LDEyNSwxMjUsMCknfSk7XG5cdCRlbHRzLiRkcm9wZG93bi5mYWRlT3V0KDEwMCk7XG4gICAgfTtcblxuICAgIHZhciBzaG93VHJhY2tNZW51ID0gZnVuY3Rpb24gKHZpZXcsIHRyYWNrX2lkKSB7XG5cdHZpZXcubWVudV9zaG93blt0cmFja19pZF0gPSB0cnVlO1xuXHR2YXIgJGVsdHMgPSB2aWV3LnRyYWNrX29wdGlvbnNfJGVsdHNbdHJhY2tfaWRdO1xuXHQkZWx0cy4kZHJvcGRvd24uY3NzKHsnei1pbmRleCc6IDEwfSk7XG5cdCRlbHRzLiRkcm9wZG93bi5jc3Moeydib3JkZXInOiAnMXB4IHNvbGlkIHJnYmEoMTI1LDEyNSwxMjUsMSknfSk7XG5cdCRlbHRzLiRpbWcuY3NzKHsnYm9yZGVyJzogJzFweCBzb2xpZCByZ2JhKDEyNSwxMjUsMTI1LDEpJ30pO1xuXHQkZWx0cy4kZHJvcGRvd24uZmFkZUluKDEwMCk7XG4gICAgfTtcblxuICAgIHZhciBoaWRlTWVudXNFeGNlcHQgPSBmdW5jdGlvbiAodmlldywgdHJhY2tfaWQpIHtcblx0dHJhY2tfaWQgPSB0cmFja19pZC50b1N0cmluZygpO1xuXHRmb3IgKHZhciBvdGhlcl90cmFja19pZCBpbiB2aWV3LnRyYWNrX29wdGlvbnNfJGVsdHMpIHtcblx0ICAgIGlmICh2aWV3LnRyYWNrX29wdGlvbnNfJGVsdHMuaGFzT3duUHJvcGVydHkob3RoZXJfdHJhY2tfaWQpKSB7XG5cdFx0aWYgKG90aGVyX3RyYWNrX2lkID09PSB0cmFja19pZCkge1xuXHRcdCAgICBjb250aW51ZTtcblx0XHR9XG5cdFx0aGlkZVRyYWNrTWVudSh2aWV3LCBvdGhlcl90cmFja19pZCk7XG5cdCAgICB9XG5cdH1cbiAgICB9O1xuXG4gICAgdmFyICRtYWtlRHJvcGRvd25PcHRpb24gPSBmdW5jdGlvbiAodGV4dCwgd2VpZ2h0LCBjYWxsYmFjaykge1xuXHRyZXR1cm4gJCgnPGxpPicpLnRleHQodGV4dCkuY3NzKHsnZm9udC13ZWlnaHQnOiB3ZWlnaHQsICdmb250LXNpemUnOiAxMiwgJ2N1cnNvcic6ICdwb2ludGVyJywgJ2JvcmRlci1ib3R0b20nOiAnMXB4IHNvbGlkIHJnYmEoMCwwLDAsMC4zKSd9KVxuXHRcdC5jbGljayhjYWxsYmFjaylcblx0XHQuaG92ZXIoZnVuY3Rpb24gKCkge1xuXHRcdCAgICAkKHRoaXMpLmNzcyh7J2JhY2tncm91bmQtY29sb3InOiAncmdiKDIwMCwyMDAsMjAwKSd9KTtcblx0XHR9LCBmdW5jdGlvbiAoKSB7XG5cdFx0ICAgICQodGhpcykuY3NzKHsnYmFja2dyb3VuZC1jb2xvcic6ICdyZ2JhKDI1NSwyNTUsMjU1LDApJ30pO1xuXHRcdH0pO1xuICAgIH07XG4gICAgdmFyICRtYWtlRHJvcGRvd25TZXBhcmF0b3IgPSBmdW5jdGlvbiAoKSB7XG5cdHJldHVybiAkKCc8bGk+JykuY3NzKHsnYm9yZGVyLXRvcCc6ICcxcHggc29saWQgYmxhY2snfSk7XG4gICAgfTtcblxuICAgIHZhciByZW5kZXJUcmFja09wdGlvbnMgPSBmdW5jdGlvbiAodmlldywgbW9kZWwsIHRyYWNrX2lkKSB7XG5cdHZhciAkZGl2LCAkaW1nLCAkZHJvcGRvd247XG5cdHZhciB0b3AgPSBtb2RlbC5nZXRab29tZWRUcmFja1RvcHModHJhY2tfaWQpO1xuXHQkZGl2ID0gJCgnPGRpdj4nKS5hcHBlbmRUbyh2aWV3LiRidXR0b25zX2N0cikuY3NzKHsncG9zaXRpb24nOiAnYWJzb2x1dGUnLCAnbGVmdCc6ICcwcHgnLCAndG9wJzogdG9wICsgJ3B4J30pO1xuXHQkaW1nID0gJCgnPGltZy8+JykuYXBwZW5kVG8oJGRpdikuYXR0cih7J3NyYyc6ICdpbWFnZXMvbWVudWRvdHMuc3ZnJywgJ3dpZHRoJzogdmlldy5pbWdfc2l6ZSwgJ2hlaWdodCc6IHZpZXcuaW1nX3NpemV9KS5jc3MoeydmbG9hdCc6ICdsZWZ0JywgJ2N1cnNvcic6ICdwb2ludGVyJywgJ2JvcmRlcic6ICcxcHggc29saWQgcmdiYSgxMjUsMTI1LDEyNSwwKSd9KTtcblx0JGRyb3Bkb3duID0gJCgnPHVsPicpLmFwcGVuZFRvKHZpZXcuJGRyb3Bkb3duX2N0cikuY3NzKHsncG9zaXRpb24nOidhYnNvbHV0ZScsICd3aWR0aCc6IDEyMCwgJ2Rpc3BsYXknOiAnbm9uZScsICdsaXN0LXN0eWxlLXR5cGUnOiAnbm9uZScsICdwYWRkaW5nLWxlZnQnOiAnNicsICdwYWRkaW5nLXJpZ2h0JzogJzYnLCAnZmxvYXQnOiAncmlnaHQnLCAnYmFja2dyb3VuZC1jb2xvcic6ICdyZ2IoMjU1LDI1NSwyNTUpJyxcblx0XHRcdFx0XHRcdFx0XHQnbGVmdCc6JzBweCcsICd0b3AnOiB0b3AgKyB2aWV3LmltZ19zaXplICsgJ3B4J30pO1xuXHR2aWV3LnRyYWNrX29wdGlvbnNfJGVsdHNbdHJhY2tfaWRdID0geyckZGl2JzogJGRpdiwgJyRpbWcnOiAkaW1nLCAnJGRyb3Bkb3duJzogJGRyb3Bkb3dufTtcblxuXHQkaW1nLmhvdmVyKGZ1bmN0aW9uIChldnQpIHtcblx0ICAgIGlmICghdmlldy5tZW51X3Nob3duW3RyYWNrX2lkXSkge1xuXHRcdCQodGhpcykuY3NzKHsnYm9yZGVyJzogJzFweCBzb2xpZCByZ2JhKDEyNSwxMjUsMTI1LDAuMyknfSk7XG5cdCAgICB9XG5cdH0sIGZ1bmN0aW9uIChldnQpIHtcblx0ICAgIGlmICghdmlldy5tZW51X3Nob3duW3RyYWNrX2lkXSkge1xuXHRcdCQodGhpcykuY3NzKHsnYm9yZGVyJzogJzFweCBzb2xpZCByZ2JhKDEyNSwxMjUsMTI1LDApJ30pO1xuXHQgICAgfVxuXHR9KTtcblx0JGltZy5jbGljayhmdW5jdGlvbiAoZXZ0KSB7XG5cdCAgICBldnQuc3RvcFByb3BhZ2F0aW9uKCk7XG5cdCAgICBpZiAoJGRyb3Bkb3duLmlzKFwiOnZpc2libGVcIikpIHtcblx0XHRoaWRlVHJhY2tNZW51KHZpZXcsIHRyYWNrX2lkKTtcblx0ICAgIH0gZWxzZSB7XG5cdFx0c2hvd1RyYWNrTWVudSh2aWV3LCB0cmFja19pZCk7XG5cdCAgICB9XG5cdCAgICBoaWRlTWVudXNFeGNlcHQodmlldywgdHJhY2tfaWQpO1xuXHR9KTtcblxuXHQkZHJvcGRvd24uYXBwZW5kKCRtYWtlRHJvcGRvd25PcHRpb24oJ01vdmUgdXAnLCAnbm9ybWFsJywgZnVuY3Rpb24gKGV2dCkge1xuXHQgICAgZXZ0LnN0b3BQcm9wYWdhdGlvbigpO1xuXHQgICAgdmlldy5tb3ZlVXBDYWxsYmFjayh0cmFja19pZCk7XG5cdH0pKTtcblx0JGRyb3Bkb3duLmFwcGVuZCgkbWFrZURyb3Bkb3duT3B0aW9uKCdNb3ZlIGRvd24nLCAnbm9ybWFsJywgZnVuY3Rpb24gKGV2dCkge1xuXHQgICAgZXZ0LnN0b3BQcm9wYWdhdGlvbigpO1xuXHQgICAgdmlldy5tb3ZlRG93bkNhbGxiYWNrKHRyYWNrX2lkKTtcblx0fSkpO1xuXHRpZiAobW9kZWwuaXNUcmFja1JlbW92YWJsZSh0cmFja19pZCkpIHtcblx0ICAgICRkcm9wZG93bi5hcHBlbmQoJG1ha2VEcm9wZG93bk9wdGlvbignUmVtb3ZlIHRyYWNrJywgJ25vcm1hbCcsIGZ1bmN0aW9uIChldnQpIHtcblx0XHRldnQuc3RvcFByb3BhZ2F0aW9uKCk7XG5cdFx0dmlldy5yZW1vdmVDYWxsYmFjayh0cmFja19pZCk7XG5cdCAgICB9KSk7XG5cdH1cblx0aWYgKG1vZGVsLmlzVHJhY2tTb3J0RGlyZWN0aW9uQ2hhbmdlYWJsZSh0cmFja19pZCkpIHtcblx0ICAgICRkcm9wZG93bi5hcHBlbmQoJG1ha2VEcm9wZG93blNlcGFyYXRvcigpKTtcblx0ICAgIHZhciAkc29ydF9pbmNfbGk7XG5cdCAgICB2YXIgJHNvcnRfZGVjX2xpO1xuXHQgICAgdmFyICRkb250X3NvcnRfbGk7XG5cdCAgICAkc29ydF9pbmNfbGkgPSAkbWFrZURyb3Bkb3duT3B0aW9uKCdTb3J0IGEtWicsIChtb2RlbC5nZXRUcmFja1NvcnREaXJlY3Rpb24odHJhY2tfaWQpID09PSAxID8gJ2JvbGQnIDogJ25vcm1hbCcpLCBmdW5jdGlvbiAoZXZ0KSB7XG5cdFx0ZXZ0LnN0b3BQcm9wYWdhdGlvbigpO1xuXHRcdCRzb3J0X2luY19saS5jc3MoJ2ZvbnQtd2VpZ2h0JywgJ2JvbGQnKTtcblx0XHQkc29ydF9kZWNfbGkuY3NzKCdmb250LXdlaWdodCcsICdub3JtYWwnKTtcblx0XHQkZG9udF9zb3J0X2xpLmNzcygnZm9udC13ZWlnaHQnLCAnbm9ybWFsJyk7XG5cdFx0dmlldy5zb3J0Q2hhbmdlQ2FsbGJhY2sodHJhY2tfaWQsIDEpO1xuXHQgICAgfSk7XG5cdCAgICAkc29ydF9kZWNfbGkgPSAkbWFrZURyb3Bkb3duT3B0aW9uKCdTb3J0IFotYScsIChtb2RlbC5nZXRUcmFja1NvcnREaXJlY3Rpb24odHJhY2tfaWQpID09PSAtMSA/ICdib2xkJyA6ICdub3JtYWwnKSwgZnVuY3Rpb24gKGV2dCkge1xuXHRcdGV2dC5zdG9wUHJvcGFnYXRpb24oKTtcblx0XHQkc29ydF9pbmNfbGkuY3NzKCdmb250LXdlaWdodCcsICdub3JtYWwnKTtcblx0XHQkc29ydF9kZWNfbGkuY3NzKCdmb250LXdlaWdodCcsICdib2xkJyk7XG5cdFx0JGRvbnRfc29ydF9saS5jc3MoJ2ZvbnQtd2VpZ2h0JywgJ25vcm1hbCcpO1xuXHRcdHZpZXcuc29ydENoYW5nZUNhbGxiYWNrKHRyYWNrX2lkLCAtMSk7XG5cdCAgICB9KTtcblx0ICAgICRkb250X3NvcnRfbGkgPSAkbWFrZURyb3Bkb3duT3B0aW9uKCdEb25cXCd0IHNvcnQgdHJhY2snLCAobW9kZWwuZ2V0VHJhY2tTb3J0RGlyZWN0aW9uKHRyYWNrX2lkKSA9PT0gMCA/ICdib2xkJyA6ICdub3JtYWwnKSwgZnVuY3Rpb24gKGV2dCkge1xuXHRcdGV2dC5zdG9wUHJvcGFnYXRpb24oKTtcblx0XHQkc29ydF9pbmNfbGkuY3NzKCdmb250LXdlaWdodCcsICdub3JtYWwnKTtcblx0XHQkc29ydF9kZWNfbGkuY3NzKCdmb250LXdlaWdodCcsICdub3JtYWwnKTtcblx0XHQkZG9udF9zb3J0X2xpLmNzcygnZm9udC13ZWlnaHQnLCAnYm9sZCcpO1xuXHRcdHZpZXcuc29ydENoYW5nZUNhbGxiYWNrKHRyYWNrX2lkLCAwKTtcblx0ICAgIH0pO1xuXHQgICAgJGRyb3Bkb3duLmFwcGVuZCgkc29ydF9pbmNfbGkpO1xuXHQgICAgJGRyb3Bkb3duLmFwcGVuZCgkc29ydF9kZWNfbGkpO1xuXHQgICAgJGRyb3Bkb3duLmFwcGVuZCgkZG9udF9zb3J0X2xpKTtcblx0fVxuXHRpZiAobW9kZWwuaXNUcmFja0V4cGFuZGFibGUodHJhY2tfaWQpKSB7XG5cdCAgICAkZHJvcGRvd24uYXBwZW5kKCRtYWtlRHJvcGRvd25PcHRpb24oXG5cdFx0ICAgIChtb2RlbC5pc1RyYWNrRXhwYW5kZWQodHJhY2tfaWQpID8gJ01vcmUnIDogJ1Nob3cnKSArICcgZ2VuZXMnLFxuXHRcdCAgICAnbm9ybWFsJyxcblx0XHQgICAgZnVuY3Rpb24gKGV2dCkge1xuXHRcdFx0ZXZ0LnN0b3BQcm9wYWdhdGlvbigpO1xuXHRcdFx0aWYgKCFtb2RlbC5pc1RyYWNrRXhwYW5kZWQodHJhY2tfaWQpKSB7XG5cdFx0XHQgICAgbW9kZWwuaW5pdEV4cGFuc2lvbih0cmFja19pZCk7XG5cdFx0XHR9XG5cdFx0XHRtb2RlbC5leHBhbmRUcmFjayh0cmFja19pZCk7XG5cdFx0ICAgIH0pKTtcblx0fVxuXHRpZiAobW9kZWwuaXNUcmFja0V4cGFuZGVkKHRyYWNrX2lkKSkge1xuXHQgICAgJGRyb3Bkb3duLmFwcGVuZCgkbWFrZURyb3Bkb3duT3B0aW9uKFxuXHRcdCAgICAnSGlkZSBnZW5lcycsXG5cdFx0ICAgICdub3JtYWwnLFxuXHRcdCAgICBmdW5jdGlvbiAoZXZ0KSB7XG5cdFx0XHRldnQuc3RvcFByb3BhZ2F0aW9uKCk7XG5cdFx0XHR2aWV3LnVuZXhwYW5kQ2FsbGJhY2sodHJhY2tfaWQpO1xuXHRcdCAgICB9KSk7XG5cdH1cbiAgICB9O1xuXG4gICAgT25jb3ByaW50VHJhY2tPcHRpb25zVmlldy5wcm90b3R5cGUuZW5hYmxlSW50ZXJhY3Rpb24gPSBmdW5jdGlvbiAoKSB7XG5cdHRoaXMuaW50ZXJhY3Rpb25fZGlzYWJsZWQgPSBmYWxzZTtcbiAgICB9XG4gICAgT25jb3ByaW50VHJhY2tPcHRpb25zVmlldy5wcm90b3R5cGUuZGlzYWJsZUludGVyYWN0aW9uID0gZnVuY3Rpb24gKCkge1xuXHR0aGlzLmludGVyYWN0aW9uX2Rpc2FibGVkID0gdHJ1ZTtcbiAgICB9XG4gICAgT25jb3ByaW50VHJhY2tPcHRpb25zVmlldy5wcm90b3R5cGUuc3VwcHJlc3NSZW5kZXJpbmcgPSBmdW5jdGlvbiAoKSB7XG5cdHRoaXMucmVuZGVyaW5nX3N1cHByZXNzZWQgPSB0cnVlO1xuICAgIH1cbiAgICBPbmNvcHJpbnRUcmFja09wdGlvbnNWaWV3LnByb3RvdHlwZS5yZWxlYXNlUmVuZGVyaW5nID0gZnVuY3Rpb24gKG1vZGVsKSB7XG5cdHRoaXMucmVuZGVyaW5nX3N1cHByZXNzZWQgPSBmYWxzZTtcblx0cmVuZGVyQWxsT3B0aW9ucyh0aGlzLCBtb2RlbCk7XG5cdHJlc2l6ZSh0aGlzLCBtb2RlbCk7XG5cdHNjcm9sbCh0aGlzLCBtb2RlbC5nZXRWZXJ0U2Nyb2xsKCkpO1xuICAgIH1cbiAgICBPbmNvcHJpbnRUcmFja09wdGlvbnNWaWV3LnByb3RvdHlwZS5zZXRTY3JvbGwgPSBmdW5jdGlvbihtb2RlbCkge1xuXHR0aGlzLnNldFZlcnRTY3JvbGwobW9kZWwpO1xuICAgIH1cbiAgICBPbmNvcHJpbnRUcmFja09wdGlvbnNWaWV3LnByb3RvdHlwZS5zZXRIb3J6U2Nyb2xsID0gZnVuY3Rpb24gKG1vZGVsKSB7XG4gICAgfVxuICAgIE9uY29wcmludFRyYWNrT3B0aW9uc1ZpZXcucHJvdG90eXBlLnNldFZlcnRTY3JvbGwgPSBmdW5jdGlvbiAobW9kZWwpIHtcblx0c2Nyb2xsKHRoaXMsIG1vZGVsLmdldFZlcnRTY3JvbGwoKSk7XG4gICAgfVxuICAgIE9uY29wcmludFRyYWNrT3B0aW9uc1ZpZXcucHJvdG90eXBlLnNldFpvb20gPSBmdW5jdGlvbihtb2RlbCkge1xuXHR0aGlzLnNldFZlcnRab29tKG1vZGVsKTtcbiAgICB9XG4gICAgT25jb3ByaW50VHJhY2tPcHRpb25zVmlldy5wcm90b3R5cGUuc2V0VmVydFpvb20gPSBmdW5jdGlvbiAobW9kZWwpIHtcblx0cmVuZGVyQWxsT3B0aW9ucyh0aGlzLCBtb2RlbCk7XG5cdHJlc2l6ZSh0aGlzLCBtb2RlbCk7XG4gICAgfVxuICAgIE9uY29wcmludFRyYWNrT3B0aW9uc1ZpZXcucHJvdG90eXBlLnNldFZpZXdwb3J0ID0gZnVuY3Rpb24obW9kZWwpIHtcblx0cmVuZGVyQWxsT3B0aW9ucyh0aGlzLCBtb2RlbCk7XG5cdHJlc2l6ZSh0aGlzLCBtb2RlbCk7XG5cdHNjcm9sbCh0aGlzLCBtb2RlbC5nZXRWZXJ0U2Nyb2xsKCkpO1xuICAgIH1cbiAgICBPbmNvcHJpbnRUcmFja09wdGlvbnNWaWV3LnByb3RvdHlwZS5nZXRXaWR0aCA9IGZ1bmN0aW9uICgpIHtcblx0cmV0dXJuIDEwICsgdGhpcy5pbWdfc2l6ZTtcbiAgICB9XG4gICAgT25jb3ByaW50VHJhY2tPcHRpb25zVmlldy5wcm90b3R5cGUuYWRkVHJhY2tzID0gZnVuY3Rpb24gKG1vZGVsKSB7XG5cdHJlbmRlckFsbE9wdGlvbnModGhpcywgbW9kZWwpO1xuXHRyZXNpemUodGhpcywgbW9kZWwpO1xuICAgIH1cbiAgICBPbmNvcHJpbnRUcmFja09wdGlvbnNWaWV3LnByb3RvdHlwZS5tb3ZlVHJhY2sgPSBmdW5jdGlvbiAobW9kZWwpIHtcblx0cmVuZGVyQWxsT3B0aW9ucyh0aGlzLCBtb2RlbCk7XG5cdHJlc2l6ZSh0aGlzLCBtb2RlbCk7XG4gICAgfVxuICAgIE9uY29wcmludFRyYWNrT3B0aW9uc1ZpZXcucHJvdG90eXBlLnNldFRyYWNrR3JvdXBPcmRlciA9IGZ1bmN0aW9uKG1vZGVsKSB7XG5cdHJlbmRlckFsbE9wdGlvbnModGhpcywgbW9kZWwpO1xuICAgIH1cbiAgICBPbmNvcHJpbnRUcmFja09wdGlvbnNWaWV3LnByb3RvdHlwZS5yZW1vdmVUcmFjayA9IGZ1bmN0aW9uKG1vZGVsLCB0cmFja19pZCkge1xuXHRkZWxldGUgdGhpcy50cmFja19vcHRpb25zXyRlbHRzW3RyYWNrX2lkXTtcblx0cmVuZGVyQWxsT3B0aW9ucyh0aGlzLCBtb2RlbCk7XG5cdHJlc2l6ZSh0aGlzLCBtb2RlbCk7XG4gICAgfVxuICAgIHJldHVybiBPbmNvcHJpbnRUcmFja09wdGlvbnNWaWV3O1xufSkoKTtcblxubW9kdWxlLmV4cG9ydHMgPSBPbmNvcHJpbnRUcmFja09wdGlvbnNWaWV3OyIsInZhciBnbF9tYXRyaXggPSByZXF1aXJlKCdnbC1tYXRyaXgnKTtcbnZhciBzdmdmYWN0b3J5ID0gcmVxdWlyZSgnLi9zdmdmYWN0b3J5LmpzJyk7XG52YXIgc2hhcGVUb1ZlcnRleGVzID0gcmVxdWlyZSgnLi9vbmNvcHJpbnRzaGFwZXRvdmVydGV4ZXMuanMnKTtcbnZhciBDYWNoZWRQcm9wZXJ0eSA9IHJlcXVpcmUoJy4vQ2FjaGVkUHJvcGVydHkuanMnKTtcblxuLy8gVE9ETzogYW50aWFsaWFzaW5nXG5cbnZhciBzZ25kaWZmID0gZnVuY3Rpb24oYSxiKSB7XG4gICAgaWYgKGEgPCBiKSB7XG5cdHJldHVybiAtMTtcbiAgICB9IGVsc2UgaWYgKGEgPiBiKSB7XG5cdHJldHVybiAxO1xuICAgIH0gZWxzZSB7XG5cdHJldHVybiAwO1xuICAgIH1cbn07XG5cbnZhciBhcnJheUZpbmRJbmRleCA9IGZ1bmN0aW9uKGFyciwgY2FsbGJhY2ssIHN0YXJ0X2luZGV4KSB7XG4gICAgc3RhcnRfaW5kZXggPSBzdGFydF9pbmRleCB8fCAwO1xuICAgIGZvciAodmFyIGk9c3RhcnRfaW5kZXg7IGk8YXJyLmxlbmd0aDsgaSsrKSB7XG5cdGlmIChjYWxsYmFjayhhcnJbaV0pKSB7XG5cdCAgICByZXR1cm4gaTtcblx0fVxuICAgIH1cbiAgICByZXR1cm4gLTE7XG59O1xuXG52YXIgZ2V0TmV3Q2FudmFzID0gZnVuY3Rpb24odmlldykge1xuICAgIHZhciBvbGRfY2FudmFzID0gdmlldy4kY2FudmFzWzBdO1xuICAgIHZhciBuZXdfY2FudmFzID0gb2xkX2NhbnZhcy5jbG9uZU5vZGUoKTtcbiAgICB2YXIgcGFyZW50X25vZGUgPSBvbGRfY2FudmFzLnBhcmVudE5vZGU7XG4gICAgcGFyZW50X25vZGUucmVtb3ZlQ2hpbGQob2xkX2NhbnZhcyk7XG4gICAgcGFyZW50X25vZGUuaW5zZXJ0QmVmb3JlKG5ld19jYW52YXMsIHZpZXcuJG92ZXJsYXlfY2FudmFzWzBdKTtcbiAgICB2aWV3LiRjYW52YXMgPSAkKG5ld19jYW52YXMpO1xufTtcbnZhciBnZXRXZWJHTENhbnZhc0NvbnRleHQgPSBmdW5jdGlvbiAodmlldykge1xuICAgIHRyeSB7XG5cdHZhciBjYW52YXMgPSB2aWV3LiRjYW52YXNbMF07XG5cdHZhciBjdHggPSBjYW52YXMuZ2V0Q29udGV4dChcImV4cGVyaW1lbnRhbC13ZWJnbFwiLCB7YWxwaGE6IGZhbHNlLCBhbnRpYWxpYXM6IHZpZXcuYW50aWFsaWFzfSk7XG5cdGN0eC5jbGVhckNvbG9yKDEuMCwgMS4wLCAxLjAsIDEuMCk7XG5cdGN0eC5jbGVhcihjdHguQ09MT1JfQlVGRkVSX0JJVCB8IGN0eC5ERVBUSF9CVUZGRVJfQklUKTtcblx0Y3R4LnZpZXdwb3J0V2lkdGggPSBjYW52YXMud2lkdGg7XG5cdGN0eC52aWV3cG9ydEhlaWdodCA9IGNhbnZhcy5oZWlnaHQ7XG5cdGN0eC52aWV3cG9ydCgwLCAwLCBjdHgudmlld3BvcnRXaWR0aCwgY3R4LnZpZXdwb3J0SGVpZ2h0KTtcblx0Y3R4LmVuYWJsZShjdHguREVQVEhfVEVTVCk7XG5cdGN0eC5lbmFibGUoY3R4LkJMRU5EKTtcblx0Y3R4LmJsZW5kRXF1YXRpb24oY3R4LkZVTkNfQUREKTtcblx0Y3R4LmJsZW5kRnVuYyhjdHguU1JDX0FMUEhBLCBjdHguT05FX01JTlVTX1NSQ19BTFBIQSk7XG5cdGN0eC5kZXB0aE1hc2soZmFsc2UpO1xuXHRcblx0cmV0dXJuIGN0eDtcbiAgICB9IGNhdGNoIChlKSB7XG5cdHJldHVybiBudWxsO1xuICAgIH1cbn07XG5cbnZhciBjcmVhdGVTaGFkZXJQcm9ncmFtID0gZnVuY3Rpb24gKHZpZXcsIHZlcnRleF9zaGFkZXIsIGZyYWdtZW50X3NoYWRlcikge1xuICAgIHZhciBwcm9ncmFtID0gdmlldy5jdHguY3JlYXRlUHJvZ3JhbSgpO1xuICAgIHZpZXcuY3R4LmF0dGFjaFNoYWRlcihwcm9ncmFtLCB2ZXJ0ZXhfc2hhZGVyKTtcbiAgICB2aWV3LmN0eC5hdHRhY2hTaGFkZXIocHJvZ3JhbSwgZnJhZ21lbnRfc2hhZGVyKTtcblxuICAgIHZpZXcuY3R4LmxpbmtQcm9ncmFtKHByb2dyYW0pO1xuXG4gICAgdmFyIHN1Y2Nlc3MgPSB2aWV3LmN0eC5nZXRQcm9ncmFtUGFyYW1ldGVyKHByb2dyYW0sIHZpZXcuY3R4LkxJTktfU1RBVFVTKTtcbiAgICBpZiAoIXN1Y2Nlc3MpIHtcblx0dmFyIG1zZyA9IHZpZXcuY3R4LmdldFByb2dyYW1JbmZvTG9nKHByb2dyYW0pO1xuXHR2aWV3LmN0eC5kZWxldGVQcm9ncmFtKHByb2dyYW0pO1xuXHR0aHJvdyBcIlVuYWJsZSB0byBsaW5rIHNoYWRlciBwcm9ncmFtOiBcIiArIG1zZztcbiAgICB9XG5cbiAgICByZXR1cm4gcHJvZ3JhbTtcbn07XG52YXIgY3JlYXRlU2hhZGVyID0gZnVuY3Rpb24gKHZpZXcsIHNvdXJjZSwgdHlwZSkge1xuICAgIHZhciBzaGFkZXIgPSB2aWV3LmN0eC5jcmVhdGVTaGFkZXIodmlldy5jdHhbdHlwZV0pO1xuICAgIHZpZXcuY3R4LnNoYWRlclNvdXJjZShzaGFkZXIsIHNvdXJjZSk7XG4gICAgdmlldy5jdHguY29tcGlsZVNoYWRlcihzaGFkZXIpO1xuXG4gICAgdmFyIHN1Y2Nlc3MgPSB2aWV3LmN0eC5nZXRTaGFkZXJQYXJhbWV0ZXIoc2hhZGVyLCB2aWV3LmN0eC5DT01QSUxFX1NUQVRVUyk7XG4gICAgaWYgKCFzdWNjZXNzKSB7XG5cdHZhciBtc2cgPSB2aWV3LmN0eC5nZXRTaGFkZXJJbmZvTG9nKHNoYWRlcik7XG5cdHZpZXcuY3R4LmRlbGV0ZVNoYWRlcihzaGFkZXIpO1xuXHR0aHJvdyBcIlVuYWJsZSB0byBjb21waWxlIHNoYWRlcjogXCIgKyBtc2c7XG4gICAgfVxuXG4gICAgcmV0dXJuIHNoYWRlcjtcbn07XG5cbnZhciBPbmNvcHJpbnRXZWJHTENlbGxWaWV3ID0gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBPbmNvcHJpbnRXZWJHTENlbGxWaWV3KCRjb250YWluZXIsICRjYW52YXMsICRvdmVybGF5X2NhbnZhcywgJGR1bW15X3Njcm9sbF9kaXZfY29udGVudHMsIG1vZGVsLCB0b29sdGlwLCBoaWdobGlnaHRfYXJlYV9jYWxsYmFjaywgY2VsbF9vdmVyX2NhbGxiYWNrKSB7XG5cdHRoaXMuJGNvbnRhaW5lciA9ICRjb250YWluZXI7XG5cdHRoaXMuJGNhbnZhcyA9ICRjYW52YXM7XG5cdHRoaXMuJG92ZXJsYXlfY2FudmFzID0gJG92ZXJsYXlfY2FudmFzO1xuXHRcblx0dGhpcy5zdXBlcnNhbXBsaW5nX3JhdGlvID0gMjtcblx0XG5cdHRoaXMuYW50aWFsaWFzID0gdHJ1ZTtcblx0dGhpcy5hbnRpYWxpYXNfb25fY2VsbF93aWR0aF90aHJlc2ggPSA1O1xuXHRcblx0Z2V0V2ViR0xDb250ZXh0QW5kU2V0VXBNYXRyaWNlc0FuZFNoYWRlcnModGhpcyk7XG5cdGdldE92ZXJsYXlDb250ZXh0QW5kQ2xlYXIodGhpcyk7XG5cdHRoaXMudmlzaWJsZV9hcmVhX3dpZHRoID0gJGNhbnZhc1swXS53aWR0aDtcblx0XG5cdHZhciBzZWxmID0gdGhpcztcblx0XG5cdHRoaXMudG9vbHRpcCA9IHRvb2x0aXA7XG5cdHRoaXMudG9vbHRpcC5jZW50ZXIgPSB0cnVlO1xuXHRcblx0dGhpcy5zY3JvbGxfeCA9IDA7XG5cdHRoaXMuc2Nyb2xsX3kgPSAwO1xuXHR0aGlzLiRkdW1teV9zY3JvbGxfZGl2X2NvbnRlbnRzID0gJGR1bW15X3Njcm9sbF9kaXZfY29udGVudHM7XG5cdHRoaXMuZHVtbXlfc2Nyb2xsX2Rpdl9jbGllbnRfc2l6ZSA9IG5ldyBDYWNoZWRQcm9wZXJ0eSh7J3dpZHRoJzokZHVtbXlfc2Nyb2xsX2Rpdl9jb250ZW50cy5wYXJlbnQoKVswXS5jbGllbnRXaWR0aCwgJ2hlaWdodCc6JGR1bW15X3Njcm9sbF9kaXZfY29udGVudHMucGFyZW50KClbMF0uY2xpZW50SGVpZ2h0fSwgZnVuY3Rpb24oKSB7XG5cdCAgICByZXR1cm4geyd3aWR0aCc6JGR1bW15X3Njcm9sbF9kaXZfY29udGVudHMucGFyZW50KClbMF0uY2xpZW50V2lkdGgsICdoZWlnaHQnOiRkdW1teV9zY3JvbGxfZGl2X2NvbnRlbnRzLnBhcmVudCgpWzBdLmNsaWVudEhlaWdodH07XG5cdH0pO1xuXG5cdHRoaXMuaWRlbnRpZmllZF9zaGFwZV9saXN0X2xpc3QgPSB7fTtcblxuXHR0aGlzLnZlcnRleF9wb3NpdGlvbl9hcnJheSA9IHt9OyAvLyB0cmFja19pZCAtPiB2ZXJ0ZXggbGlzdCAoZmxvYXQgbGlzdCwgaXRlbSBzaXplIDMpXG5cdHRoaXMudmVydGV4X2NvbG9yX2FycmF5ID0ge307IC8vIHRyYWNrX2lkIC0+IGNvbG9yIGxpc3QgKGZsb2F0IGxpc3QsIGl0ZW0gc2l6ZSA0KVxuXHR0aGlzLnZlcnRleF9jb2x1bW5fYXJyYXkgPSB7fTsgLy8gdHJhY2tfaWQgLT4gbnVtYmVyIGxpc3QgKGZsb2F0IGxpc3QsIGl0ZW0gc2l6ZSAxKVxuXHRcblx0dGhpcy52ZXJ0ZXhfcG9zaXRpb25fYnVmZmVyID0ge307IC8vIHRyYWNrX2lkIC0+IGdsLmNyZWF0ZUJ1ZmZlcigpXG5cdHRoaXMudmVydGV4X2NvbG9yX2J1ZmZlciA9IHt9OyAvLyB0cmFja19pZCAtPiBnbC5jcmVhdGVCdWZmZXIoKVxuXHR0aGlzLnZlcnRleF9jb2x1bW5fYnVmZmVyID0ge307IC8vIHRyYWNrX2lkIC0+IGdsLmNyZWF0ZUJ1ZmZlcigpXG5cdFxuXHR0aGlzLmlkX3RvX2ZpcnN0X3ZlcnRleF9pbmRleCA9IHt9OyAvLyB0cmFja19pZCAtPiBpZCAtPiB2ZXJ0ZXggaW5kZXggb2YgZmlyc3QgdmVydGV4IGNvcnJlc3BvbmRpbmcgdG8gdGhpcyBpZFxuXG5cdHRoaXMucmVuZGVyaW5nX3N1cHByZXNzZWQgPSBmYWxzZTtcblx0XG5cdHRoaXMuaGlnaGxpZ2h0X2FyZWFfY2FsbGJhY2sgPSAodHlwZW9mIGhpZ2hsaWdodF9hcmVhX2NhbGxiYWNrID09PSAndW5kZWZpbmVkJyA/IGZ1bmN0aW9uKCkge30gOiBoaWdobGlnaHRfYXJlYV9jYWxsYmFjayk7IC8vIGZ1bmN0aW9uKGxlZnQsIHJpZ2h0KSB7IC4uLiB9XG5cdFxuXHQoZnVuY3Rpb24gaW5pdGlhbGl6ZU92ZXJsYXlFdmVudHMoc2VsZikge1xuXHQgICAgdmFyIGRyYWdnaW5nID0gZmFsc2U7XG5cdCAgICB2YXIgZHJhZ19kaWZmX21pbmltdW0gPSAxMDtcblx0ICAgIHZhciBkcmFnX3N0YXJ0X3g7XG5cdCAgICB2YXIgZHJhZ19lbmRfeDtcblx0ICAgIHZhciBwcmV2X292ZXJsYXBwaW5nX2NlbGwgPSBudWxsO1xuXHQgICAgXG5cdCAgICB2YXIgZHJhZ0lzVmFsaWQgPSBmdW5jdGlvbihkcmFnX3N0YXJ0X3gsIGRyYWdfZW5kX3gpIHtcblx0XHRyZXR1cm4gTWF0aC5hYnMoZHJhZ19zdGFydF94IC0gZHJhZ19lbmRfeCkgPj0gZHJhZ19kaWZmX21pbmltdW07XG5cdCAgICB9O1xuXHQgICAgdmFyIGV4ZWN1dGVEcmFnID0gZnVuY3Rpb24oKSB7XG5cdFx0aWYgKCFkcmFnZ2luZykge1xuXHRcdCAgICByZXR1cm47XG5cdFx0fVxuXHRcdGRyYWdnaW5nID0gZmFsc2U7XG5cdFx0XG5cdFx0aWYgKCFkcmFnSXNWYWxpZChkcmFnX3N0YXJ0X3gsIGRyYWdfZW5kX3gpKSB7XG5cdFx0ICAgIHJldHVybjtcblx0XHR9XG5cdFx0dmFyIGxlZnQgPSBNYXRoLm1pbihkcmFnX3N0YXJ0X3gsIGRyYWdfZW5kX3gpO1xuXHRcdHZhciByaWdodCA9IE1hdGgubWF4KGRyYWdfc3RhcnRfeCwgZHJhZ19lbmRfeCk7XG5cdFx0c2VsZi5oaWdobGlnaHRfYXJlYV9jYWxsYmFjayhsZWZ0K3NlbGYuc2Nyb2xsX3gsIHJpZ2h0K3NlbGYuc2Nyb2xsX3gpO1xuXHQgICAgfTtcblx0ICAgIFxuXHQgICAgdmFyIG1vdXNlSW5PdmVybGF5Q2FudmFzID0gZnVuY3Rpb24obW91c2VfeCwgbW91c2VfeSkge1xuXHRcdHZhciBvZmZzZXQgPSBzZWxmLiRvdmVybGF5X2NhbnZhcy5vZmZzZXQoKTtcblx0XHR2YXIgd2lkdGggPSBzZWxmLiRvdmVybGF5X2NhbnZhcy53aWR0aCgpO1xuXHRcdHZhciBoZWlnaHQgPSBzZWxmLiRvdmVybGF5X2NhbnZhcy5oZWlnaHQoKTtcblx0XHRyZXR1cm4gKG1vdXNlX3ggPj0gb2Zmc2V0LmxlZnQgJiYgbW91c2VfeCA8IHdpZHRoICsgb2Zmc2V0LmxlZnQgJiYgbW91c2VfeSA+PSBvZmZzZXQudG9wICYmIG1vdXNlX3kgPCBoZWlnaHQgKyBvZmZzZXQudG9wKTtcblx0ICAgIH07XG5cdCAgICAkKGRvY3VtZW50KS5vbihcIm1vdXNlbW92ZVwiLCBmdW5jdGlvbihldnQpIHtcblx0XHRpZiAoIW1vdXNlSW5PdmVybGF5Q2FudmFzKGV2dC5wYWdlWCwgZXZ0LnBhZ2VZKSkge1xuXHRcdCAgICBjbGVhck92ZXJsYXkoc2VsZik7XG5cdFx0ICAgIHRvb2x0aXAuaGlkZSgpO1xuXHRcdH1cblx0ICAgIH0pO1xuXHQgICAgc2VsZi4kb3ZlcmxheV9jYW52YXMub24oXCJtb3VzZW91dCBtb3VzZWxlYXZlXCIsIGZ1bmN0aW9uKGV2dCkge1xuXHRcdGNsZWFyT3ZlcmxheShzZWxmKTtcblx0XHR0b29sdGlwLmhpZGUoKTtcblx0ICAgIH0pO1xuXHQgICAgc2VsZi4kb3ZlcmxheV9jYW52YXMub24oXCJtb3VzZW1vdmVcIiwgZnVuY3Rpb24oZXZ0KSB7XG5cdFx0aWYgKHNlbGYucmVuZGVyaW5nX3N1cHByZXNzZWQpIHtcblx0XHQgICAgcmV0dXJuO1xuXHRcdH1cblx0XHRjbGVhck92ZXJsYXkoc2VsZik7XG5cdFx0dmFyIG9mZnNldCA9IHNlbGYuJG92ZXJsYXlfY2FudmFzLm9mZnNldCgpO1xuXHRcdHZhciBtb3VzZVggPSBldnQucGFnZVggLSBvZmZzZXQubGVmdDtcblx0XHR2YXIgbW91c2VZID0gZXZ0LnBhZ2VZIC0gb2Zmc2V0LnRvcDtcblx0XHRpZiAoIWRyYWdnaW5nKSB7XG5cdFx0ICAgIHZhciBvdmVybGFwcGluZ19jZWxsID0gbW9kZWwuZ2V0T3ZlcmxhcHBpbmdDZWxsKG1vdXNlWCArIHNlbGYuc2Nyb2xsX3gsIG1vdXNlWSArIHNlbGYuc2Nyb2xsX3kpO1xuXHRcdCAgICB2YXIgb3ZlcmxhcHBpbmdfZGF0dW0gPSAob3ZlcmxhcHBpbmdfY2VsbCA9PT0gbnVsbCA/IG51bGwgOiBtb2RlbC5nZXRUcmFja0RhdHVtKG92ZXJsYXBwaW5nX2NlbGwudHJhY2ssIG92ZXJsYXBwaW5nX2NlbGwuaWQpKTtcblx0XHQgICAgdmFyIGNlbGxfd2lkdGggPSBtb2RlbC5nZXRDZWxsV2lkdGgoKTtcblx0XHQgICAgdmFyIGNlbGxfcGFkZGluZyA9IG1vZGVsLmdldENlbGxQYWRkaW5nKCk7XG5cdFx0ICAgIGlmIChvdmVybGFwcGluZ19kYXR1bSAhPT0gbnVsbCkge1xuXHRcdFx0Y2VsbF9vdmVyX2NhbGxiYWNrKG92ZXJsYXBwaW5nX2NlbGwudHJhY2ssIG92ZXJsYXBwaW5nX2NlbGwuaWQpO1xuXHRcdFx0dmFyIGxlZnQgPSBtb2RlbC5nZXRab29tZWRDb2x1bW5MZWZ0KG92ZXJsYXBwaW5nX2NlbGwuaWQpIC0gc2VsZi5zY3JvbGxfeDtcblx0XHRcdG92ZXJsYXlTdHJva2VSZWN0KHNlbGYsIGxlZnQsIG1vZGVsLmdldENlbGxUb3BzKG92ZXJsYXBwaW5nX2NlbGwudHJhY2spIC0gc2VsZi5zY3JvbGxfeSwgbW9kZWwuZ2V0Q2VsbFdpZHRoKCkgKyAobW9kZWwuZ2V0VHJhY2tIYXNDb2x1bW5TcGFjaW5nKG92ZXJsYXBwaW5nX2NlbGwudHJhY2spID8gMCA6IGNlbGxfcGFkZGluZyksIG1vZGVsLmdldENlbGxIZWlnaHQob3ZlcmxhcHBpbmdfY2VsbC50cmFjayksIFwicmdiYSgwLDAsMCwxKVwiKTtcblx0XHRcdHZhciB0cmFja3MgPSBtb2RlbC5nZXRUcmFja3MoKTtcblx0XHRcdGZvciAodmFyIGk9MDsgaTx0cmFja3MubGVuZ3RoOyBpKyspIHtcblx0XHRcdCAgICBpZiAobW9kZWwuZ2V0VHJhY2tEYXR1bSh0cmFja3NbaV0sIG92ZXJsYXBwaW5nX2NlbGwuaWQpICE9PSBudWxsKSB7XG5cdFx0XHRcdG92ZXJsYXlTdHJva2VSZWN0KHNlbGYsIGxlZnQsIG1vZGVsLmdldENlbGxUb3BzKHRyYWNrc1tpXSkgLSBzZWxmLnNjcm9sbF95LCBtb2RlbC5nZXRDZWxsV2lkdGgoKSArIChtb2RlbC5nZXRUcmFja0hhc0NvbHVtblNwYWNpbmcodHJhY2tzW2ldKSA/IDAgOiBjZWxsX3BhZGRpbmcpLCBtb2RlbC5nZXRDZWxsSGVpZ2h0KHRyYWNrc1tpXSksIFwicmdiYSgwLDAsMCwwLjUpXCIpO1xuXHRcdFx0ICAgIH1cblx0XHRcdH1cblx0XHRcdHRvb2x0aXAuc2hvdygyNTAsIG1vZGVsLmdldFpvb21lZENvbHVtbkxlZnQob3ZlcmxhcHBpbmdfY2VsbC5pZCkgKyBtb2RlbC5nZXRDZWxsV2lkdGgoKSAvIDIgKyBvZmZzZXQubGVmdCAtIHNlbGYuc2Nyb2xsX3gsIG1vZGVsLmdldENlbGxUb3BzKG92ZXJsYXBwaW5nX2NlbGwudHJhY2spICsgb2Zmc2V0LnRvcCAtIHNlbGYuc2Nyb2xsX3ksIG1vZGVsLmdldFRyYWNrVG9vbHRpcEZuKG92ZXJsYXBwaW5nX2NlbGwudHJhY2spKG92ZXJsYXBwaW5nX2RhdHVtKSk7XG5cdFx0XHRwcmV2X292ZXJsYXBwaW5nX2NlbGwgPSBvdmVybGFwcGluZ19jZWxsO1xuXHRcdCAgICB9IGVsc2Uge1xuXHRcdFx0dG9vbHRpcC5oaWRlSWZOb3RBbHJlYWR5R29pbmdUbygxNTApO1xuXHRcdFx0b3ZlcmxhcHBpbmdfY2VsbCA9IG51bGw7XG5cdFx0ICAgIH1cblx0XHR9IGVsc2Uge1xuXHRcdCAgICBvdmVybGFwcGluZ19jZWxsID0gbnVsbDtcblx0XHQgICAgZHJhZ19lbmRfeCA9IG1vdXNlWDtcblx0XHQgICAgdmFyIGxlZnQgPSBNYXRoLm1pbihtb3VzZVgsIGRyYWdfc3RhcnRfeCk7XG5cdFx0ICAgIHZhciByaWdodCA9IE1hdGgubWF4KG1vdXNlWCwgZHJhZ19zdGFydF94KTtcblx0XHQgICAgdmFyIGRyYWdfcmVjdF9maWxsID0gZHJhZ0lzVmFsaWQoZHJhZ19zdGFydF94LCBkcmFnX2VuZF94KSA/ICdyZ2JhKDAsMCwwLDAuMyknIDogJ3JnYmEoMCwwLDAsMC4yKSc7XG5cdFx0ICAgIG92ZXJsYXlGaWxsUmVjdChzZWxmLCBsZWZ0LCAwLCByaWdodC1sZWZ0LCBtb2RlbC5nZXRDZWxsVmlld0hlaWdodCgpLCBkcmFnX3JlY3RfZmlsbCk7XG5cdFx0fVxuXHRcdGlmIChvdmVybGFwcGluZ19jZWxsID09PSBudWxsKSB7XG5cdFx0ICAgIGNlbGxfb3Zlcl9jYWxsYmFjayhudWxsKTtcblx0XHR9XG5cdCAgICB9KTtcblx0ICAgIFxuXHQgICAgc2VsZi4kb3ZlcmxheV9jYW52YXMub24oXCJtb3VzZWRvd25cIiwgZnVuY3Rpb24oZXZ0KSB7XG5cdFx0aWYgKCFtb3VzZUluT3ZlcmxheUNhbnZhcyhldnQucGFnZVgsIGV2dC5wYWdlWSkpIHtcblx0XHQgICAgcmV0dXJuO1xuXHRcdH1cblx0XHRkcmFnZ2luZyA9IHRydWU7XG5cdFx0ZHJhZ19zdGFydF94ID0gZXZ0LnBhZ2VYIC0gc2VsZi4kb3ZlcmxheV9jYW52YXMub2Zmc2V0KCkubGVmdDtcblx0XHRkcmFnX2VuZF94ID0gZHJhZ19zdGFydF94O1xuXHRcdFxuXHRcdHRvb2x0aXAuaGlkZSgpO1xuXHQgICAgfSk7XG5cdCAgICBzZWxmLiRvdmVybGF5X2NhbnZhcy5vbihcIm1vdXNldXBcIiwgZnVuY3Rpb24oZXZ0KSB7XG5cdFx0aWYgKCFtb3VzZUluT3ZlcmxheUNhbnZhcyhldnQucGFnZVgsIGV2dC5wYWdlWSkpIHtcblx0XHQgICAgcmV0dXJuO1xuXHRcdH1cblx0XHRleGVjdXRlRHJhZygpO1xuXHQgICAgfSk7XG5cdCAgICBzZWxmLiRvdmVybGF5X2NhbnZhcy5vbihcIm1vdXNlbGVhdmVcIiwgZnVuY3Rpb24oZXZ0KSB7XG5cdFx0ZXhlY3V0ZURyYWcoKTtcblx0ICAgIH0pO1xuXHQgICAgXG5cdH0pKHRoaXMpO1xuXHRcblx0JGR1bW15X3Njcm9sbF9kaXZfY29udGVudHMucGFyZW50KCkuc2Nyb2xsKGZ1bmN0aW9uKCkge1xuXHQgICAgY2xlYXJPdmVybGF5KHNlbGYpO1xuXHR9KTtcbiAgICB9XG4gICAgXG4gICAgdmFyIG92ZXJsYXlTdHJva2VSZWN0ID0gZnVuY3Rpb24odmlldywgeCwgeSwgd2lkdGgsIGhlaWdodCwgY29sb3IpIHtcblx0dmFyIGN0eCA9IHZpZXcub3ZlcmxheV9jdHg7XG5cdGN0eC5zdHJva2VTdHlsZSA9IGNvbG9yO1xuXHRjdHguc3Ryb2tlV2lkdGggPSAxMDtcblx0Y3R4LnN0cm9rZVJlY3Qodmlldy5zdXBlcnNhbXBsaW5nX3JhdGlvKngsIHZpZXcuc3VwZXJzYW1wbGluZ19yYXRpbyp5LCB2aWV3LnN1cGVyc2FtcGxpbmdfcmF0aW8qd2lkdGgsIHZpZXcuc3VwZXJzYW1wbGluZ19yYXRpbypoZWlnaHQpO1xuICAgIH07XG4gICAgXG4gICAgdmFyIG92ZXJsYXlGaWxsUmVjdCA9IGZ1bmN0aW9uKHZpZXcsIHgsIHksIHdpZHRoLCBoZWlnaHQsIGNvbG9yKSB7XG5cdHZhciBjdHggPSB2aWV3Lm92ZXJsYXlfY3R4O1xuXHRjdHguZmlsbFN0eWxlID0gY29sb3I7XG5cdGN0eC5maWxsUmVjdCh2aWV3LnN1cGVyc2FtcGxpbmdfcmF0aW8qeCwgdmlldy5zdXBlcnNhbXBsaW5nX3JhdGlvKnksIHZpZXcuc3VwZXJzYW1wbGluZ19yYXRpbyp3aWR0aCwgdmlldy5zdXBlcnNhbXBsaW5nX3JhdGlvKmhlaWdodCk7XG4gICAgfTtcbiAgICBcbiAgICB2YXIgY2xlYXJPdmVybGF5ID0gZnVuY3Rpb24odmlldykge1xuXHR2aWV3Lm92ZXJsYXlfY3R4LmZpbGxTdHlsZSA9IFwicmdiYSgwLDAsMCwwKVwiO1xuXHR2aWV3Lm92ZXJsYXlfY3R4LmNsZWFyUmVjdCgwLDAsdmlldy4kb3ZlcmxheV9jYW52YXNbMF0ud2lkdGgsIHZpZXcuJG92ZXJsYXlfY2FudmFzWzBdLmhlaWdodCk7XG4gICAgfTtcbiAgICBcbiAgICB2YXIgZ2V0T3ZlcmxheUNvbnRleHRBbmRDbGVhciA9IGZ1bmN0aW9uKHZpZXcpIHtcblx0dmlldy5vdmVybGF5X2N0eCA9IHZpZXcuJG92ZXJsYXlfY2FudmFzWzBdLmdldENvbnRleHQoJzJkJyk7XG5cdGNsZWFyT3ZlcmxheSh2aWV3KTtcbiAgICB9O1xuICAgIFxuICAgIHZhciBnZXRXZWJHTENvbnRleHRBbmRTZXRVcE1hdHJpY2VzID0gZnVuY3Rpb24odmlldykge1xuXHR2aWV3LmN0eCA9IGdldFdlYkdMQ2FudmFzQ29udGV4dCh2aWV3KTtcblx0KGZ1bmN0aW9uIGluaXRpYWxpemVNYXRyaWNlcyhzZWxmKSB7XG5cdCAgICB2YXIgbXZNYXRyaXggPSBnbF9tYXRyaXgubWF0NC5jcmVhdGUoKTtcblx0ICAgIGdsX21hdHJpeC5tYXQ0Lmxvb2tBdChtdk1hdHJpeCwgWzAsIDAsIDFdLCBbMCwgMCwgMF0sIFswLCAxLCAwXSk7XG5cdCAgICBzZWxmLm12TWF0cml4ID0gbXZNYXRyaXg7XG5cblx0ICAgIHZhciBwTWF0cml4ID0gZ2xfbWF0cml4Lm1hdDQuY3JlYXRlKCk7XG5cdCAgICBnbF9tYXRyaXgubWF0NC5vcnRobyhwTWF0cml4LCAwLCBzZWxmLmN0eC52aWV3cG9ydFdpZHRoLCBzZWxmLmN0eC52aWV3cG9ydEhlaWdodCwgMCwgLTUsIDEwMDApOyAvLyB5IGF4aXMgaW52ZXJ0ZWQgc28gdGhhdCB5IGluY3JlYXNlcyBkb3duIGxpa2UgU1ZHXG5cdCAgICBzZWxmLnBNYXRyaXggPSBwTWF0cml4O1xuXHR9KSh2aWV3KTtcbiAgICB9O1xuICAgIHZhciBnZXRXZWJHTENvbnRleHRBbmRTZXRVcE1hdHJpY2VzQW5kU2hhZGVycyA9IGZ1bmN0aW9uKHZpZXcpIHtcblx0Z2V0V2ViR0xDb250ZXh0QW5kU2V0VXBNYXRyaWNlcyh2aWV3KTtcblx0KGZ1bmN0aW9uIGluaXRpYWxpemVTaGFkZXJzKHNlbGYpIHsvLyBJbml0aWFsaXplIHNoYWRlcnNcblx0ICAgIHZhciB2ZXJ0ZXhfc2hhZGVyX3NvdXJjZSA9IFsnYXR0cmlidXRlIHZlYzMgYVZlcnRleFBvc2l0aW9uOycsXG5cdFx0J2F0dHJpYnV0ZSB2ZWM0IGFWZXJ0ZXhDb2xvcjsnLFxuXHRcdCdhdHRyaWJ1dGUgZmxvYXQgYVZlcnRleE9uY29wcmludENvbHVtbjsnLFxuXHRcdFxuXHRcdCd1bmlmb3JtIGZsb2F0IGNvbHVtbldpZHRoOycsXG5cdFx0J3VuaWZvcm0gZmxvYXQgc2Nyb2xsWDsnLFxuXHRcdCd1bmlmb3JtIGZsb2F0IHpvb21YOycsXG5cdFx0J3VuaWZvcm0gZmxvYXQgc2Nyb2xsWTsnLFxuXHRcdCd1bmlmb3JtIGZsb2F0IHpvb21ZOycsXG5cdFx0J3VuaWZvcm0gbWF0NCB1TVZNYXRyaXg7Jyxcblx0XHQndW5pZm9ybSBtYXQ0IHVQTWF0cml4OycsXG5cdFx0J3VuaWZvcm0gZmxvYXQgb2Zmc2V0WTsnLFxuXHRcdCd1bmlmb3JtIGZsb2F0IHN1cGVyc2FtcGxpbmdSYXRpbzsnLFxuXHRcdCd2YXJ5aW5nIHZlYzQgdkNvbG9yOycsXG5cdFx0J3ZvaWQgbWFpbih2b2lkKSB7Jyxcblx0XHQnXHRnbF9Qb3NpdGlvbiA9IHZlYzQoYVZlcnRleFBvc2l0aW9uLCAxLjApOycsXG5cdFx0J1x0Z2xfUG9zaXRpb25bMF0gKz0gYVZlcnRleE9uY29wcmludENvbHVtbipjb2x1bW5XaWR0aDsnLFxuXHRcdCdcdGdsX1Bvc2l0aW9uICo9IHZlYzQoem9vbVgsIHpvb21ZLCAxLjAsIDEuMCk7Jyxcblx0XHQnXHRnbF9Qb3NpdGlvblsxXSArPSBvZmZzZXRZOycsIC8vIG9mZnNldCBpcyBnaXZlbiB6b29tZWRcblx0XHQnXHRnbF9Qb3NpdGlvbiAtPSB2ZWM0KHNjcm9sbFgsIHNjcm9sbFksIDAuMCwgMC4wKTsnLFxuXHRcdCdcdGdsX1Bvc2l0aW9uWzBdICo9IHN1cGVyc2FtcGxpbmdSYXRpbzsnLFxuXHRcdCdcdGdsX1Bvc2l0aW9uWzFdICo9IHN1cGVyc2FtcGxpbmdSYXRpbzsnLFxuXHRcdCdcdGdsX1Bvc2l0aW9uID0gdVBNYXRyaXggKiB1TVZNYXRyaXggKiBnbF9Qb3NpdGlvbjsnLFxuXHRcdCdcdHZDb2xvciA9IGFWZXJ0ZXhDb2xvcjsnLFxuXHRcdCd9J10uam9pbignXFxuJyk7XG5cdCAgICB2YXIgZnJhZ21lbnRfc2hhZGVyX3NvdXJjZSA9IFsncHJlY2lzaW9uIG1lZGl1bXAgZmxvYXQ7Jyxcblx0XHQndmFyeWluZyB2ZWM0IHZDb2xvcjsnLFxuXHRcdCcnLFxuXHRcdCd2b2lkIG1haW4odm9pZCkgeycsXG5cdFx0JyAgIGdsX0ZyYWdDb2xvciA9IHZDb2xvcjsnLFxuXHRcdCd9J10uam9pbignXFxuJyk7XG5cdCAgICB2YXIgdmVydGV4X3NoYWRlciA9IGNyZWF0ZVNoYWRlcihzZWxmLCB2ZXJ0ZXhfc2hhZGVyX3NvdXJjZSwgJ1ZFUlRFWF9TSEFERVInKTtcblx0ICAgIHZhciBmcmFnbWVudF9zaGFkZXIgPSBjcmVhdGVTaGFkZXIoc2VsZiwgZnJhZ21lbnRfc2hhZGVyX3NvdXJjZSwgJ0ZSQUdNRU5UX1NIQURFUicpO1xuXG5cdCAgICB2YXIgc2hhZGVyX3Byb2dyYW0gPSBjcmVhdGVTaGFkZXJQcm9ncmFtKHNlbGYsIHZlcnRleF9zaGFkZXIsIGZyYWdtZW50X3NoYWRlcik7XG5cdCAgICBzaGFkZXJfcHJvZ3JhbS52ZXJ0ZXhQb3NpdGlvbkF0dHJpYnV0ZSA9IHNlbGYuY3R4LmdldEF0dHJpYkxvY2F0aW9uKHNoYWRlcl9wcm9ncmFtLCAnYVZlcnRleFBvc2l0aW9uJyk7XG5cdCAgICBzZWxmLmN0eC5lbmFibGVWZXJ0ZXhBdHRyaWJBcnJheShzaGFkZXJfcHJvZ3JhbS52ZXJ0ZXhQb3NpdGlvbkF0dHJpYnV0ZSk7XG5cdCAgICBzaGFkZXJfcHJvZ3JhbS52ZXJ0ZXhDb2xvckF0dHJpYnV0ZSA9IHNlbGYuY3R4LmdldEF0dHJpYkxvY2F0aW9uKHNoYWRlcl9wcm9ncmFtLCAnYVZlcnRleENvbG9yJyk7XG5cdCAgICBzZWxmLmN0eC5lbmFibGVWZXJ0ZXhBdHRyaWJBcnJheShzaGFkZXJfcHJvZ3JhbS52ZXJ0ZXhDb2xvckF0dHJpYnV0ZSk7XG5cdCAgICBzaGFkZXJfcHJvZ3JhbS52ZXJ0ZXhPbmNvcHJpbnRDb2x1bW5BdHRyaWJ1dGUgPSBzZWxmLmN0eC5nZXRBdHRyaWJMb2NhdGlvbihzaGFkZXJfcHJvZ3JhbSwgJ2FWZXJ0ZXhPbmNvcHJpbnRDb2x1bW4nKTtcblx0ICAgIHNlbGYuY3R4LmVuYWJsZVZlcnRleEF0dHJpYkFycmF5KHNoYWRlcl9wcm9ncmFtLnZlcnRleE9uY29wcmludENvbHVtbkF0dHJpYnV0ZSk7XG5cblx0ICAgIHNoYWRlcl9wcm9ncmFtLnBNYXRyaXhVbmlmb3JtID0gc2VsZi5jdHguZ2V0VW5pZm9ybUxvY2F0aW9uKHNoYWRlcl9wcm9ncmFtLCAndVBNYXRyaXgnKTtcblx0ICAgIHNoYWRlcl9wcm9ncmFtLm12TWF0cml4VW5pZm9ybSA9IHNlbGYuY3R4LmdldFVuaWZvcm1Mb2NhdGlvbihzaGFkZXJfcHJvZ3JhbSwgJ3VNVk1hdHJpeCcpO1xuXHQgICAgc2hhZGVyX3Byb2dyYW0uY29sdW1uV2lkdGhVbmlmb3JtID0gc2VsZi5jdHguZ2V0VW5pZm9ybUxvY2F0aW9uKHNoYWRlcl9wcm9ncmFtLCAnY29sdW1uV2lkdGgnKTtcblx0ICAgIHNoYWRlcl9wcm9ncmFtLnNjcm9sbFhVbmlmb3JtID0gc2VsZi5jdHguZ2V0VW5pZm9ybUxvY2F0aW9uKHNoYWRlcl9wcm9ncmFtLCAnc2Nyb2xsWCcpO1xuXHQgICAgc2hhZGVyX3Byb2dyYW0uc2Nyb2xsWVVuaWZvcm0gPSBzZWxmLmN0eC5nZXRVbmlmb3JtTG9jYXRpb24oc2hhZGVyX3Byb2dyYW0sICdzY3JvbGxZJyk7XG5cdCAgICBzaGFkZXJfcHJvZ3JhbS56b29tWFVuaWZvcm0gPSBzZWxmLmN0eC5nZXRVbmlmb3JtTG9jYXRpb24oc2hhZGVyX3Byb2dyYW0sICd6b29tWCcpO1xuXHQgICAgc2hhZGVyX3Byb2dyYW0uem9vbVlVbmlmb3JtID0gc2VsZi5jdHguZ2V0VW5pZm9ybUxvY2F0aW9uKHNoYWRlcl9wcm9ncmFtLCAnem9vbVknKTtcblx0ICAgIHNoYWRlcl9wcm9ncmFtLm9mZnNldFlVbmlmb3JtID0gc2VsZi5jdHguZ2V0VW5pZm9ybUxvY2F0aW9uKHNoYWRlcl9wcm9ncmFtLCAnb2Zmc2V0WScpO1xuXHQgICAgc2hhZGVyX3Byb2dyYW0uc3VwZXJzYW1wbGluZ1JhdGlvVW5pZm9ybSA9IHNlbGYuY3R4LmdldFVuaWZvcm1Mb2NhdGlvbihzaGFkZXJfcHJvZ3JhbSwgJ3N1cGVyc2FtcGxpbmdSYXRpbycpO1xuXG5cdCAgICBzZWxmLnNoYWRlcl9wcm9ncmFtID0gc2hhZGVyX3Byb2dyYW07XG5cdH0pKHZpZXcpO1xuICAgIH07XG5cbiAgICB2YXIgcmVzaXplQW5kQ2xlYXIgPSBmdW5jdGlvbih2aWV3LCBtb2RlbCkge1xuXHR2YXIgaGVpZ2h0ID0gbW9kZWwuZ2V0Q2VsbFZpZXdIZWlnaHQoKTtcblx0dmFyIHRvdGFsX3dpZHRoID0gdmlldy5nZXRUb3RhbFdpZHRoKG1vZGVsKTtcblx0dmFyIHZpc2libGVfYXJlYV93aWR0aCA9IHZpZXcudmlzaWJsZV9hcmVhX3dpZHRoO1xuXHR2YXIgc2Nyb2xsYmFyX3NsYWNrID0gMjA7XG5cdHZpZXcuJGR1bW15X3Njcm9sbF9kaXZfY29udGVudHMuY3NzKHsnbWluLXdpZHRoJzp0b3RhbF93aWR0aCwgJ21pbi1oZWlnaHQnOm1vZGVsLmdldE9uY29wcmludEhlaWdodCgpfSk7XG5cdHZpZXcuJGR1bW15X3Njcm9sbF9kaXZfY29udGVudHMucGFyZW50KCkuY3NzKHsnaGVpZ2h0JzogaGVpZ2h0ICsgc2Nyb2xsYmFyX3NsYWNrLCAnd2lkdGgnOiB2aXNpYmxlX2FyZWFfd2lkdGggKyBzY3JvbGxiYXJfc2xhY2t9KTsgLy8gYWRkIHNwYWNlIGZvciBzY3JvbGxiYXJzXG5cdHZpZXcuZHVtbXlfc2Nyb2xsX2Rpdl9jbGllbnRfc2l6ZS51cGRhdGUoKTtcblx0dmlldy4kY2FudmFzWzBdLmhlaWdodCA9IHZpZXcuc3VwZXJzYW1wbGluZ19yYXRpbypoZWlnaHQ7XG5cdHZpZXcuJGNhbnZhc1swXS5zdHlsZS5oZWlnaHQgPSBoZWlnaHQgKyAncHgnO1xuXHR2aWV3LiRvdmVybGF5X2NhbnZhc1swXS5oZWlnaHQgPSB2aWV3LnN1cGVyc2FtcGxpbmdfcmF0aW8qaGVpZ2h0O1xuXHR2aWV3LiRvdmVybGF5X2NhbnZhc1swXS5zdHlsZS5oZWlnaHQgPSBoZWlnaHQgKyAncHgnO1xuXHR2aWV3LiRjYW52YXNbMF0ud2lkdGggPSB2aWV3LnN1cGVyc2FtcGxpbmdfcmF0aW8qdmlzaWJsZV9hcmVhX3dpZHRoO1xuXHR2aWV3LiRjYW52YXNbMF0uc3R5bGUud2lkdGggPSB2aXNpYmxlX2FyZWFfd2lkdGggKyAncHgnO1xuXHR2aWV3LiRvdmVybGF5X2NhbnZhc1swXS53aWR0aCA9IHZpZXcuc3VwZXJzYW1wbGluZ19yYXRpbyp2aXNpYmxlX2FyZWFfd2lkdGg7XG5cdHZpZXcuJG92ZXJsYXlfY2FudmFzWzBdLnN0eWxlLndpZHRoID0gdmlzaWJsZV9hcmVhX3dpZHRoICsgJ3B4Jztcblx0dmlldy4kY29udGFpbmVyLmNzcygnaGVpZ2h0JywgaGVpZ2h0KTtcblx0dmlldy4kY29udGFpbmVyLmNzcygnd2lkdGgnLCB2aXNpYmxlX2FyZWFfd2lkdGgpO1xuXHRnZXRXZWJHTENvbnRleHRBbmRTZXRVcE1hdHJpY2VzKHZpZXcpO1xuXHRnZXRPdmVybGF5Q29udGV4dEFuZENsZWFyKHZpZXcpO1xuICAgIH07XG4gICAgdmFyIHJlbmRlckFsbFRyYWNrcyA9IGZ1bmN0aW9uICh2aWV3LCBtb2RlbCwgZG9udF9yZXNpemUpIHtcblx0aWYgKHZpZXcucmVuZGVyaW5nX3N1cHByZXNzZWQpIHtcblx0ICAgIHJldHVybjtcblx0fVxuXHRcblx0dmFyIHNjcm9sbF94ID0gdmlldy5zY3JvbGxfeDtcblx0dmFyIHNjcm9sbF95ID0gdmlldy5zY3JvbGxfeTtcblx0dmFyIHpvb21feCA9IG1vZGVsLmdldEhvcnpab29tKCk7XG5cdHZhciB6b29tX3kgPSBtb2RlbC5nZXRWZXJ0Wm9vbSgpO1xuXHRcblx0dmFyIHZpZXdwb3J0ID0gdmlldy5nZXRWaWV3cG9ydE9uY29wcmludFNwYWNlKG1vZGVsKTtcblx0dmFyIHdpbmRvd19sZWZ0ID0gdmlld3BvcnQubGVmdDtcblx0dmFyIHdpbmRvd19yaWdodCA9IHZpZXdwb3J0LnJpZ2h0O1xuXHR2YXIgd2luZG93X3RvcCA9IHZpZXdwb3J0LnRvcDtcblx0dmFyIHdpbmRvd19ib3R0b20gPSB2aWV3cG9ydC5ib3R0b207XG5cdHZhciBpZF90b19sZWZ0ID0gbW9kZWwuZ2V0Q29sdW1uTGVmdCgpO1xuXHR2YXIgaWRfb3JkZXIgPSBtb2RlbC5nZXRJZE9yZGVyKCk7XG5cdHZhciBob3J6X2ZpcnN0X2lkX2luX3dpbmRvd19pbmRleCA9IGFycmF5RmluZEluZGV4KGlkX29yZGVyLCBmdW5jdGlvbihpZCkgeyByZXR1cm4gaWRfdG9fbGVmdFtpZF0gPj0gd2luZG93X2xlZnQ7IH0pO1xuXHR2YXIgaG9yel9maXJzdF9pZF9hZnRlcl93aW5kb3dfaW5kZXggPSBhcnJheUZpbmRJbmRleChpZF9vcmRlciwgZnVuY3Rpb24oaWQpIHsgcmV0dXJuIGlkX3RvX2xlZnRbaWRdID4gd2luZG93X3JpZ2h0OyB9LCBob3J6X2ZpcnN0X2lkX2luX3dpbmRvd19pbmRleCsxKTtcblx0dmFyIGhvcnpfZmlyc3RfaWRfaW5fd2luZG93ID0gKGhvcnpfZmlyc3RfaWRfaW5fd2luZG93X2luZGV4IDwgMSA/IGlkX29yZGVyWzBdIDogaWRfb3JkZXJbaG9yel9maXJzdF9pZF9pbl93aW5kb3dfaW5kZXggLSAxXSk7XG5cdHZhciBob3J6X2ZpcnN0X2lkX2FmdGVyX3dpbmRvdyA9IChob3J6X2ZpcnN0X2lkX2FmdGVyX3dpbmRvd19pbmRleCA9PT0gLTEgPyBudWxsIDogaWRfb3JkZXJbaG9yel9maXJzdF9pZF9hZnRlcl93aW5kb3dfaW5kZXhdKTtcblx0XG5cdGlmICghZG9udF9yZXNpemUpIHtcblx0ICAgIHJlc2l6ZUFuZENsZWFyKHZpZXcsIG1vZGVsKTtcblx0fVxuXHR2aWV3LmN0eC5jbGVhckNvbG9yKDEuMCwxLjAsMS4wLDEuMCk7XG5cdHZpZXcuY3R4LmNsZWFyKHZpZXcuY3R4LkNPTE9SX0JVRkZFUl9CSVQgfCB2aWV3LmN0eC5ERVBUSF9CVUZGRVJfQklUKTtcblx0XG5cdHZhciB0cmFja3MgPSBtb2RlbC5nZXRUcmFja3MoKTtcblx0Zm9yICh2YXIgaSA9IDA7IGkgPCB0cmFja3MubGVuZ3RoOyBpKyspIHtcblx0ICAgIHZhciB0cmFja19pZCA9IHRyYWNrc1tpXTtcblx0ICAgIHZhciBjZWxsX3RvcCA9IG1vZGVsLmdldENlbGxUb3BzKHRyYWNrX2lkKTtcblx0ICAgIHZhciBjZWxsX2hlaWdodCA9IG1vZGVsLmdldENlbGxIZWlnaHQodHJhY2tfaWQpO1xuXHQgICAgaWYgKChjZWxsX3RvcCAvIHpvb21feSkgPj0gd2luZG93X2JvdHRvbSB8fCAoKGNlbGxfdG9wICsgY2VsbF9oZWlnaHQpL3pvb21feSkgPCB3aW5kb3dfdG9wKSB7XG5cdFx0Ly8gdmVydGljYWwgY2xpcHBpbmdcblx0XHRjb250aW51ZTtcblx0ICAgIH1cblx0ICAgIHZhciBidWZmZXJzID0gZ2V0VHJhY2tCdWZmZXJzKHZpZXcsIHRyYWNrX2lkKTtcblx0ICAgIGlmIChidWZmZXJzLnBvc2l0aW9uLm51bUl0ZW1zID09PSAwKSB7XG5cdFx0Y29udGludWU7XG5cdCAgICB9XG5cdCAgICB2YXIgZmlyc3RfaW5kZXggPSB2aWV3LmlkX3RvX2ZpcnN0X3ZlcnRleF9pbmRleFt0cmFja19pZF1baG9yel9maXJzdF9pZF9pbl93aW5kb3ddO1xuXHQgICAgdmFyIGZpcnN0X2luZGV4X291dCA9IGhvcnpfZmlyc3RfaWRfYWZ0ZXJfd2luZG93ID09PSBudWxsID8gYnVmZmVycy5wb3NpdGlvbi5udW1JdGVtcyA6IHZpZXcuaWRfdG9fZmlyc3RfdmVydGV4X2luZGV4W3RyYWNrX2lkXVtob3J6X2ZpcnN0X2lkX2FmdGVyX3dpbmRvd107XG5cdCAgICBcblx0ICAgIHZpZXcuY3R4LnVzZVByb2dyYW0odmlldy5zaGFkZXJfcHJvZ3JhbSk7XG5cdCAgICB2aWV3LmN0eC5iaW5kQnVmZmVyKHZpZXcuY3R4LkFSUkFZX0JVRkZFUiwgYnVmZmVycy5wb3NpdGlvbik7XG5cdCAgICB2aWV3LmN0eC52ZXJ0ZXhBdHRyaWJQb2ludGVyKHZpZXcuc2hhZGVyX3Byb2dyYW0udmVydGV4UG9zaXRpb25BdHRyaWJ1dGUsIGJ1ZmZlcnMucG9zaXRpb24uaXRlbVNpemUsIHZpZXcuY3R4LkZMT0FULCBmYWxzZSwgMCwgMCk7XG5cblx0ICAgIHZpZXcuY3R4LmJpbmRCdWZmZXIodmlldy5jdHguQVJSQVlfQlVGRkVSLCBidWZmZXJzLmNvbG9yKTtcblx0ICAgIHZpZXcuY3R4LnZlcnRleEF0dHJpYlBvaW50ZXIodmlldy5zaGFkZXJfcHJvZ3JhbS52ZXJ0ZXhDb2xvckF0dHJpYnV0ZSwgYnVmZmVycy5jb2xvci5pdGVtU2l6ZSwgdmlldy5jdHguRkxPQVQsIGZhbHNlLCAwLCAwKTtcblx0ICAgIFxuXHQgICAgdmlldy5jdHguYmluZEJ1ZmZlcih2aWV3LmN0eC5BUlJBWV9CVUZGRVIsIGJ1ZmZlcnMuY29sdW1uKTtcblx0ICAgIHZpZXcuY3R4LnZlcnRleEF0dHJpYlBvaW50ZXIodmlldy5zaGFkZXJfcHJvZ3JhbS52ZXJ0ZXhPbmNvcHJpbnRDb2x1bW5BdHRyaWJ1dGUsIGJ1ZmZlcnMuY29sdW1uLml0ZW1TaXplLCB2aWV3LmN0eC5GTE9BVCwgZmFsc2UsIDAsIDApO1xuXG5cdCAgICB2aWV3LmN0eC51bmlmb3JtTWF0cml4NGZ2KHZpZXcuc2hhZGVyX3Byb2dyYW0ucE1hdHJpeFVuaWZvcm0sIGZhbHNlLCB2aWV3LnBNYXRyaXgpO1xuXHQgICAgdmlldy5jdHgudW5pZm9ybU1hdHJpeDRmdih2aWV3LnNoYWRlcl9wcm9ncmFtLm12TWF0cml4VW5pZm9ybSwgZmFsc2UsIHZpZXcubXZNYXRyaXgpO1xuXHQgICAgdmlldy5jdHgudW5pZm9ybTFmKHZpZXcuc2hhZGVyX3Byb2dyYW0uY29sdW1uV2lkdGhVbmlmb3JtLCBtb2RlbC5nZXRDZWxsV2lkdGgodHJ1ZSkgKyBtb2RlbC5nZXRDZWxsUGFkZGluZyh0cnVlKSk7XG5cdCAgICB2aWV3LmN0eC51bmlmb3JtMWYodmlldy5zaGFkZXJfcHJvZ3JhbS5zY3JvbGxYVW5pZm9ybSwgc2Nyb2xsX3gpO1xuXHQgICAgdmlldy5jdHgudW5pZm9ybTFmKHZpZXcuc2hhZGVyX3Byb2dyYW0uc2Nyb2xsWVVuaWZvcm0sIHNjcm9sbF95KTtcblx0ICAgIHZpZXcuY3R4LnVuaWZvcm0xZih2aWV3LnNoYWRlcl9wcm9ncmFtLnpvb21YVW5pZm9ybSwgem9vbV94KTtcblx0ICAgIHZpZXcuY3R4LnVuaWZvcm0xZih2aWV3LnNoYWRlcl9wcm9ncmFtLnpvb21ZVW5pZm9ybSwgem9vbV95KTtcblx0ICAgIHZpZXcuY3R4LnVuaWZvcm0xZih2aWV3LnNoYWRlcl9wcm9ncmFtLm9mZnNldFlVbmlmb3JtLCBjZWxsX3RvcCk7XG5cdCAgICB2aWV3LmN0eC51bmlmb3JtMWYodmlldy5zaGFkZXJfcHJvZ3JhbS5zdXBlcnNhbXBsaW5nUmF0aW9Vbmlmb3JtLCB2aWV3LnN1cGVyc2FtcGxpbmdfcmF0aW8pO1xuXHQgICAgXG5cdCAgICB2aWV3LmN0eC5kcmF3QXJyYXlzKHZpZXcuY3R4LlRSSUFOR0xFUywgZmlyc3RfaW5kZXgsIGZpcnN0X2luZGV4X291dCAtIGZpcnN0X2luZGV4KTtcblx0fVxuICAgIH07XG4gICAgXG4gICAgdmFyIGNsZWFyVHJhY2tQb3NpdGlvbkFuZENvbG9yQnVmZmVycyA9IGZ1bmN0aW9uKHZpZXcsIG1vZGVsLCB0cmFja19pZCkge1xuXHR2YXIgdHJhY2tzX3RvX2NsZWFyO1xuXHRpZiAodHlwZW9mIHRyYWNrX2lkID09PSAndW5kZWZpbmVkJykge1xuXHQgICAgdHJhY2tzX3RvX2NsZWFyID0gbW9kZWwuZ2V0VHJhY2tzKCk7XG5cdH0gZWxzZSB7XG5cdCAgICB0cmFja3NfdG9fY2xlYXIgPSBbdHJhY2tfaWRdO1xuXHR9XG5cdGZvciAodmFyIGk9MDsgaTx0cmFja3NfdG9fY2xlYXIubGVuZ3RoOyBpKyspIHtcblx0ICAgIGlmICh2aWV3LnZlcnRleF9wb3NpdGlvbl9idWZmZXJbdHJhY2tzX3RvX2NsZWFyW2ldXSkge1xuXHRcdGRlbGV0ZSB2aWV3LnZlcnRleF9wb3NpdGlvbl9idWZmZXJbdHJhY2tzX3RvX2NsZWFyW2ldXTtcblx0ICAgIH1cblx0ICAgIGlmICh2aWV3LnZlcnRleF9jb2xvcl9idWZmZXJbdHJhY2tzX3RvX2NsZWFyW2ldXSkge1xuXHRcdGRlbGV0ZSB2aWV3LnZlcnRleF9jb2xvcl9idWZmZXJbdHJhY2tzX3RvX2NsZWFyW2ldXTtcblx0ICAgIH1cblx0fVxuICAgIH07XG4gICAgXG4gICAgIHZhciBjbGVhclRyYWNrQ29sdW1uQnVmZmVycyA9IGZ1bmN0aW9uKHZpZXcsIG1vZGVsLCB0cmFja19pZCkge1xuXHR2YXIgdHJhY2tzX3RvX2NsZWFyO1xuXHRpZiAodHlwZW9mIHRyYWNrX2lkID09PSAndW5kZWZpbmVkJykge1xuXHQgICAgdHJhY2tzX3RvX2NsZWFyID0gbW9kZWwuZ2V0VHJhY2tzKCk7XG5cdH0gZWxzZSB7XG5cdCAgICB0cmFja3NfdG9fY2xlYXIgPSBbdHJhY2tfaWRdO1xuXHR9XG5cdGZvciAodmFyIGk9MDsgaTx0cmFja3NfdG9fY2xlYXIubGVuZ3RoOyBpKyspIHtcblx0ICAgIGlmICh2aWV3LnZlcnRleF9jb2x1bW5fYnVmZmVyW3RyYWNrc190b19jbGVhcltpXV0pIHtcblx0XHRkZWxldGUgdmlldy52ZXJ0ZXhfY29sdW1uX2J1ZmZlclt0cmFja3NfdG9fY2xlYXJbaV1dO1xuXHQgICAgfVxuXHR9XG4gICAgfTtcbiAgICBcbiAgICBcbiAgICB2YXIgZ2V0VHJhY2tCdWZmZXJzID0gZnVuY3Rpb24odmlldywgdHJhY2tfaWQpIHtcblx0aWYgKHR5cGVvZiB2aWV3LnZlcnRleF9wb3NpdGlvbl9idWZmZXJbdHJhY2tfaWRdID09PSAndW5kZWZpbmVkJykge1xuXHQgICAgdmFyIHZlcnRleF9wb3NpdGlvbl9idWZmZXIgPSB2aWV3LmN0eC5jcmVhdGVCdWZmZXIoKTtcblx0ICAgIHZhciB2ZXJ0ZXhfY29sb3JfYnVmZmVyID0gdmlldy5jdHguY3JlYXRlQnVmZmVyKCk7XG5cdCAgICB2YXIgdmVydGV4X3Bvc2l0aW9uX2FycmF5ID0gdmlldy52ZXJ0ZXhfcG9zaXRpb25fYXJyYXlbdHJhY2tfaWRdO1xuXHQgICAgdmFyIHZlcnRleF9jb2xvcl9hcnJheSA9IHZpZXcudmVydGV4X2NvbG9yX2FycmF5W3RyYWNrX2lkXTtcblx0ICAgIFxuXHQgICAgdmlldy5jdHguYmluZEJ1ZmZlcih2aWV3LmN0eC5BUlJBWV9CVUZGRVIsIHZlcnRleF9wb3NpdGlvbl9idWZmZXIpO1xuXHQgICAgdmlldy5jdHguYnVmZmVyRGF0YSh2aWV3LmN0eC5BUlJBWV9CVUZGRVIsIG5ldyBGbG9hdDMyQXJyYXkodmVydGV4X3Bvc2l0aW9uX2FycmF5KSwgdmlldy5jdHguU1RBVElDX0RSQVcpO1xuXHQgICAgdmVydGV4X3Bvc2l0aW9uX2J1ZmZlci5pdGVtU2l6ZSA9IDM7XG5cdCAgICB2ZXJ0ZXhfcG9zaXRpb25fYnVmZmVyLm51bUl0ZW1zID0gdmVydGV4X3Bvc2l0aW9uX2FycmF5Lmxlbmd0aCAvIHZlcnRleF9wb3NpdGlvbl9idWZmZXIuaXRlbVNpemU7XG5cblx0ICAgIHZpZXcuY3R4LmJpbmRCdWZmZXIodmlldy5jdHguQVJSQVlfQlVGRkVSLCB2ZXJ0ZXhfY29sb3JfYnVmZmVyKTtcblx0ICAgIHZpZXcuY3R4LmJ1ZmZlckRhdGEodmlldy5jdHguQVJSQVlfQlVGRkVSLCBuZXcgRmxvYXQzMkFycmF5KHZlcnRleF9jb2xvcl9hcnJheSksIHZpZXcuY3R4LlNUQVRJQ19EUkFXKTtcblx0ICAgIHZlcnRleF9jb2xvcl9idWZmZXIuaXRlbVNpemUgPSA0O1xuXHQgICAgdmVydGV4X2NvbG9yX2J1ZmZlci5udW1JdGVtcyA9IHZlcnRleF9jb2xvcl9hcnJheS5sZW5ndGggLyB2ZXJ0ZXhfY29sb3JfYnVmZmVyLml0ZW1TaXplO1xuXHQgICAgXG5cdCAgICB2aWV3LnZlcnRleF9wb3NpdGlvbl9idWZmZXJbdHJhY2tfaWRdID0gdmVydGV4X3Bvc2l0aW9uX2J1ZmZlcjtcblx0ICAgIHZpZXcudmVydGV4X2NvbG9yX2J1ZmZlclt0cmFja19pZF0gPSB2ZXJ0ZXhfY29sb3JfYnVmZmVyO1xuXHR9XG5cdFxuXHRpZiAodHlwZW9mIHZpZXcudmVydGV4X2NvbHVtbl9idWZmZXJbdHJhY2tfaWRdID09PSAndW5kZWZpbmVkJykge1xuXHQgICAgdmFyIHZlcnRleF9jb2x1bW5fYnVmZmVyID0gdmlldy5jdHguY3JlYXRlQnVmZmVyKCk7XG5cdCAgICB2YXIgdmVydGV4X2NvbHVtbl9hcnJheSA9IHZpZXcudmVydGV4X2NvbHVtbl9hcnJheVt0cmFja19pZF07XG5cdCAgICB2aWV3LmN0eC5iaW5kQnVmZmVyKHZpZXcuY3R4LkFSUkFZX0JVRkZFUiwgdmVydGV4X2NvbHVtbl9idWZmZXIpO1xuXHQgICAgdmlldy5jdHguYnVmZmVyRGF0YSh2aWV3LmN0eC5BUlJBWV9CVUZGRVIsIG5ldyBGbG9hdDMyQXJyYXkodmVydGV4X2NvbHVtbl9hcnJheSksIHZpZXcuY3R4LlNUQVRJQ19EUkFXKTtcblx0ICAgIHZlcnRleF9jb2x1bW5fYnVmZmVyLml0ZW1TaXplID0gMTtcblx0ICAgIHZlcnRleF9jb2x1bW5fYnVmZmVyLm51bUl0ZW1zID0gdmVydGV4X2NvbHVtbl9hcnJheS5sZW5ndGggLyB2ZXJ0ZXhfY29sdW1uX2J1ZmZlci5pdGVtU2l6ZTtcblx0ICAgIFxuXHQgICAgdmlldy52ZXJ0ZXhfY29sdW1uX2J1ZmZlclt0cmFja19pZF0gPSB2ZXJ0ZXhfY29sdW1uX2J1ZmZlcjtcblx0fVxuXHRyZXR1cm4geydwb3NpdGlvbic6dmlldy52ZXJ0ZXhfcG9zaXRpb25fYnVmZmVyW3RyYWNrX2lkXSxcblx0XHQnY29sb3InOiB2aWV3LnZlcnRleF9jb2xvcl9idWZmZXJbdHJhY2tfaWRdLFxuXHRcdCdjb2x1bW4nOiB2aWV3LnZlcnRleF9jb2x1bW5fYnVmZmVyW3RyYWNrX2lkXX07XG4gICAgfTtcbiAgICBcbiAgICB2YXIgY29tcHV0ZVZlcnRleENvbHVtbnMgPSBmdW5jdGlvbih2aWV3LCBtb2RlbCwgdHJhY2tfaWQpIHtcblx0aWYgKHZpZXcucmVuZGVyaW5nX3N1cHByZXNzZWQpIHtcblx0ICAgIHJldHVybjtcblx0fVxuXHR2YXIgbnVtX2l0ZW1zID0gdmlldy52ZXJ0ZXhfcG9zaXRpb25fYXJyYXlbdHJhY2tfaWRdLmxlbmd0aCAvIDM7XG5cdHZhciBpZF90b19maXJzdF92ZXJ0ZXhfaW5kZXggPSB2aWV3LmlkX3RvX2ZpcnN0X3ZlcnRleF9pbmRleFt0cmFja19pZF07XG5cdHZhciBpZF90b19pbmRleCA9IG1vZGVsLmdldFZpc2libGVJZFRvSW5kZXhNYXAoKTtcblx0dmFyIGlkX2FuZF9maXJzdF92ZXJ0ZXggPSBPYmplY3Qua2V5cyhpZF90b19maXJzdF92ZXJ0ZXhfaW5kZXgpLm1hcChmdW5jdGlvbihpZCkgeyByZXR1cm4gW2lkLCBpZF90b19maXJzdF92ZXJ0ZXhfaW5kZXhbaWRdXTsgfSlcblx0XHRcdFx0LnNvcnQoZnVuY3Rpb24oYSxiKSB7IHJldHVybiBzZ25kaWZmKGFbMV0sIGJbMV0pOyB9KTtcblx0dmFyIHZlcnRleF9jb2x1bW5fYXJyYXkgPSBbXTtcblx0Zm9yICh2YXIgaT0wOyBpPGlkX2FuZF9maXJzdF92ZXJ0ZXgubGVuZ3RoOyBpKyspIHtcblx0ICAgIHZhciBudW1fdG9fYWRkID0gKGkgPT09IGlkX2FuZF9maXJzdF92ZXJ0ZXgubGVuZ3RoIC0gMSA/IG51bV9pdGVtcyA6IGlkX2FuZF9maXJzdF92ZXJ0ZXhbaSsxXVsxXSkgLSBpZF9hbmRfZmlyc3RfdmVydGV4W2ldWzFdO1xuXHQgICAgdmFyIGNvbHVtbiA9IGlkX3RvX2luZGV4W2lkX2FuZF9maXJzdF92ZXJ0ZXhbaV1bMF1dO1xuXHQgICAgZm9yICh2YXIgaj0wOyBqPG51bV90b19hZGQ7IGorKykge1xuXHRcdHZlcnRleF9jb2x1bW5fYXJyYXkucHVzaChjb2x1bW4pO1xuXHQgICAgfVxuXHR9XG5cdHZpZXcudmVydGV4X2NvbHVtbl9hcnJheVt0cmFja19pZF0gPSB2ZXJ0ZXhfY29sdW1uX2FycmF5O1xuXHRjbGVhclRyYWNrQ29sdW1uQnVmZmVycyh2aWV3LCBtb2RlbCwgdHJhY2tfaWQpO1xuICAgIH07XG4gICAgXG4gICAgdmFyIGNvbXB1dGVWZXJ0ZXhQb3NpdGlvbnNBbmRWZXJ0ZXhDb2xvcnMgPSBmdW5jdGlvbiAodmlldywgbW9kZWwsIHRyYWNrX2lkKSB7XG5cdGlmICh2aWV3LnJlbmRlcmluZ19zdXBwcmVzc2VkKSB7XG5cdCAgICByZXR1cm47XG5cdH1cblx0dmFyIGlkZW50aWZpZWRfc2hhcGVfbGlzdF9saXN0ID0gdmlldy5pZGVudGlmaWVkX3NoYXBlX2xpc3RfbGlzdFt0cmFja19pZF07XG5cdHZhciBpZF90b19pbmRleCA9IG1vZGVsLmdldElkVG9JbmRleE1hcCgpO1xuXHRpZGVudGlmaWVkX3NoYXBlX2xpc3RfbGlzdC5zb3J0KGZ1bmN0aW9uKGEsIGIpIHtcblx0ICAgIHJldHVybiBzZ25kaWZmKGlkX3RvX2luZGV4W2EuaWRdLCBpZF90b19pbmRleFtiLmlkXSk7XG5cdH0pO1xuXHR2YXIgaGFsZnNxcnQyID0gTWF0aC5zcXJ0KDIpIC8gMjtcblx0Ly8gQ29tcHV0ZSB2ZXJ0ZXggYW5kIGNvbG9yIGFycmF5c1xuXHR2YXIgdmVydGV4X3Bvc2l0aW9uX2FycmF5ID0gW107XG5cdHZhciB2ZXJ0ZXhfY29sb3JfYXJyYXkgPSBbXTtcblx0dmFyIGlkX3RvX2ZpcnN0X3ZlcnRleF9pbmRleCA9IHt9O1xuXHRcblx0Zm9yICh2YXIgaSA9IDA7IGkgPCBpZGVudGlmaWVkX3NoYXBlX2xpc3RfbGlzdC5sZW5ndGg7IGkrKykge1xuXHQgICAgdmFyIHNoYXBlX2xpc3QgPSBpZGVudGlmaWVkX3NoYXBlX2xpc3RfbGlzdFtpXS5zaGFwZV9saXN0O1xuXHQgICAgdmFyIGlkID0gaWRlbnRpZmllZF9zaGFwZV9saXN0X2xpc3RbaV0uaWQ7XG5cblx0ICAgIGlkX3RvX2ZpcnN0X3ZlcnRleF9pbmRleFtpZF0gPSB2ZXJ0ZXhfcG9zaXRpb25fYXJyYXkubGVuZ3RoIC8gMztcblx0ICAgIFxuXHQgICAgZm9yICh2YXIgaiA9IDA7IGogPCBzaGFwZV9saXN0Lmxlbmd0aDsgaisrKSB7XG5cdFx0dmFyIHNoYXBlID0gc2hhcGVfbGlzdFtqXTtcblx0XHRzaGFwZVRvVmVydGV4ZXMoc2hhcGUsIGosIHZlcnRleF9wb3NpdGlvbl9hcnJheSwgdmVydGV4X2NvbG9yX2FycmF5KTtcblx0ICAgIH1cblx0fVxuXHR2aWV3LnZlcnRleF9wb3NpdGlvbl9hcnJheVt0cmFja19pZF0gPSB2ZXJ0ZXhfcG9zaXRpb25fYXJyYXk7Ly90cmFjayB0byB2ZXJ0ZXhfcG9zaXRpb25fYXJyYXk7XG5cdHZpZXcudmVydGV4X2NvbG9yX2FycmF5W3RyYWNrX2lkXSA9IHZlcnRleF9jb2xvcl9hcnJheTsvL3RyYWNrIHRvIHZlcnRleF9jb2xvcl9hcnJheTtcblx0dmlldy5pZF90b19maXJzdF92ZXJ0ZXhfaW5kZXhbdHJhY2tfaWRdID0gaWRfdG9fZmlyc3RfdmVydGV4X2luZGV4O1xuXHRcblx0Y2xlYXJUcmFja1Bvc2l0aW9uQW5kQ29sb3JCdWZmZXJzKHZpZXcsIG1vZGVsLCB0cmFja19pZCk7XG4gICAgfTtcbiAgICBcbiAgICB2YXIgZ2V0U2hhcGVzID0gZnVuY3Rpb24odmlldywgbW9kZWwsIHRyYWNrX2lkKSB7XG5cdGlmICh2aWV3LnJlbmRlcmluZ19zdXBwcmVzc2VkKSB7XG5cdCAgICByZXR1cm47XG5cdH1cblx0dmlldy5pZGVudGlmaWVkX3NoYXBlX2xpc3RfbGlzdFt0cmFja19pZF0gPSBtb2RlbC5nZXRJZGVudGlmaWVkU2hhcGVMaXN0TGlzdCh0cmFja19pZCwgdHJ1ZSwgdHJ1ZSk7XG4gICAgfTtcbiAgICBcbiAgICB2YXIgcmVmcmVzaENhbnZhcyA9IGZ1bmN0aW9uKHZpZXcsIG1vZGVsKSB7XG5cdGNsZWFyVHJhY2tQb3NpdGlvbkFuZENvbG9yQnVmZmVycyh2aWV3LCBtb2RlbCk7IC8vIHdoZW5ldmVyIHlvdSBnZXQgYSBuZXcgY29udGV4dCwgeW91IGhhdmUgdG8gZ2V0IG5ldyBidWZmZXJzXG5cdGNsZWFyVHJhY2tDb2x1bW5CdWZmZXJzKHZpZXcsIG1vZGVsKTtcblx0Z2V0TmV3Q2FudmFzKHZpZXcpO1xuXHRnZXRXZWJHTENvbnRleHRBbmRTZXRVcE1hdHJpY2VzQW5kU2hhZGVycyh2aWV3LCBtb2RlbCk7XG4gICAgfTtcbiAgICBcbiAgICBPbmNvcHJpbnRXZWJHTENlbGxWaWV3LnByb3RvdHlwZS5nZXRWaWV3cG9ydE9uY29wcmludFNwYWNlID0gZnVuY3Rpb24obW9kZWwpIHtcblx0dmFyIHNjcm9sbF94ID0gdGhpcy5zY3JvbGxfeDtcblx0dmFyIHNjcm9sbF95ID0gdGhpcy5zY3JvbGxfeTtcblx0dmFyIHpvb21feCA9IG1vZGVsLmdldEhvcnpab29tKCk7XG5cdHZhciB6b29tX3kgPSBtb2RlbC5nZXRWZXJ0Wm9vbSgpO1xuXHRcblx0dmFyIHdpbmRvd19sZWZ0ID0gTWF0aC5yb3VuZChzY3JvbGxfeCAvIHpvb21feCk7XG5cdHZhciB3aW5kb3dfcmlnaHQgPSBNYXRoLnJvdW5kKChzY3JvbGxfeCArIHRoaXMudmlzaWJsZV9hcmVhX3dpZHRoKSAvIHpvb21feCk7XG5cdHZhciB3aW5kb3dfdG9wID0gTWF0aC5yb3VuZChzY3JvbGxfeSAvIHpvb21feSk7XG5cdHZhciB3aW5kb3dfYm90dG9tID0gTWF0aC5yb3VuZCgoc2Nyb2xsX3kgKyBtb2RlbC5nZXRDZWxsVmlld0hlaWdodCgpKSAvIHpvb21feSk7XG5cdFxuXHRyZXR1cm4ge1xuXHQgICAgJ3RvcCc6IHdpbmRvd190b3AsXG5cdCAgICAnYm90dG9tJzogd2luZG93X2JvdHRvbSxcblx0ICAgICdsZWZ0Jzogd2luZG93X2xlZnQsXG5cdCAgICAncmlnaHQnOiB3aW5kb3dfcmlnaHRcblx0fTtcbiAgICB9XG4gICAgT25jb3ByaW50V2ViR0xDZWxsVmlldy5wcm90b3R5cGUuaXNVc2FibGUgPSBmdW5jdGlvbiAoKSB7XG5cdHJldHVybiB0aGlzLmN0eCAhPT0gbnVsbDtcbiAgICB9XG4gICAgT25jb3ByaW50V2ViR0xDZWxsVmlldy5wcm90b3R5cGUucmVtb3ZlVHJhY2sgPSBmdW5jdGlvbiAobW9kZWwsIHRyYWNrX2lkKSB7XG5cdGlmICh0aGlzLnJlbmRlcmluZ19zdXBwcmVzc2VkKSB7XG5cdCAgICByZXR1cm47XG5cdH07XG5cdGRlbGV0ZSB0aGlzLmlkZW50aWZpZWRfc2hhcGVfbGlzdF9saXN0W3RyYWNrX2lkXTtcblx0ZGVsZXRlIHRoaXMudmVydGV4X3Bvc2l0aW9uX2FycmF5W3RyYWNrX2lkXTtcblx0ZGVsZXRlIHRoaXMudmVydGV4X2NvbG9yX2FycmF5W3RyYWNrX2lkXTtcblx0ZGVsZXRlIHRoaXMudmVydGV4X2NvbHVtbl9hcnJheVt0cmFja19pZF07XG5cdGRlbGV0ZSB0aGlzLmlkX3RvX2ZpcnN0X3ZlcnRleF9pbmRleFt0cmFja19pZF07XG5cdGRlbGV0ZSB0aGlzLnZlcnRleF9wb3NpdGlvbl9idWZmZXJbdHJhY2tfaWRdO1xuXHRkZWxldGUgdGhpcy52ZXJ0ZXhfY29sb3JfYnVmZmVyW3RyYWNrX2lkXTtcblx0ZGVsZXRlIHRoaXMudmVydGV4X2NvbHVtbl9idWZmZXJbdHJhY2tfaWRdO1xuXHRcblx0cmVuZGVyQWxsVHJhY2tzKHRoaXMsIG1vZGVsKTtcbiAgICB9XG4gICAgT25jb3ByaW50V2ViR0xDZWxsVmlldy5wcm90b3R5cGUubW92ZVRyYWNrID0gZnVuY3Rpb24gKG1vZGVsKSB7XG5cdGlmICh0aGlzLnJlbmRlcmluZ19zdXBwcmVzc2VkKSB7XG5cdCAgICByZXR1cm47XG5cdH07XG5cdHJlbmRlckFsbFRyYWNrcyh0aGlzLCBtb2RlbCk7XG4gICAgfVxuICAgIE9uY29wcmludFdlYkdMQ2VsbFZpZXcucHJvdG90eXBlLnNldFRyYWNrR3JvdXBPcmRlciA9IGZ1bmN0aW9uKG1vZGVsKSB7XG5cdHJlbmRlckFsbFRyYWNrcyh0aGlzLCBtb2RlbCk7XG4gICAgfVxuICAgIFxuICAgIE9uY29wcmludFdlYkdMQ2VsbFZpZXcucHJvdG90eXBlLmFkZFRyYWNrcyA9IGZ1bmN0aW9uIChtb2RlbCwgdHJhY2tfaWRzKSB7XG5cdGlmICh0aGlzLnJlbmRlcmluZ19zdXBwcmVzc2VkKSB7XG5cdCAgICByZXR1cm47XG5cdH07XG5cdGZvciAodmFyIGk9MDsgaTx0cmFja19pZHMubGVuZ3RoOyBpKyspIHtcblx0ICAgIGdldFNoYXBlcyh0aGlzLCBtb2RlbCwgdHJhY2tfaWRzW2ldKTtcblx0ICAgIGNvbXB1dGVWZXJ0ZXhQb3NpdGlvbnNBbmRWZXJ0ZXhDb2xvcnModGhpcywgbW9kZWwsIHRyYWNrX2lkc1tpXSk7XG5cdCAgICBjb21wdXRlVmVydGV4Q29sdW1ucyh0aGlzLCBtb2RlbCwgdHJhY2tfaWRzW2ldKTtcblx0fVxuXHRyZW5kZXJBbGxUcmFja3ModGhpcywgbW9kZWwpO1xuICAgIH1cbiAgICBPbmNvcHJpbnRXZWJHTENlbGxWaWV3LnByb3RvdHlwZS5zZXRJZE9yZGVyID0gZnVuY3Rpb24obW9kZWwsIGlkcykge1xuXHRpZiAodGhpcy5yZW5kZXJpbmdfc3VwcHJlc3NlZCkge1xuXHQgICAgcmV0dXJuO1xuXHR9O1xuXHR2YXIgdHJhY2tfaWRzID0gbW9kZWwuZ2V0VHJhY2tzKCk7XG5cdGZvciAodmFyIGk9MDsgaTx0cmFja19pZHMubGVuZ3RoOyBpKyspIHtcblx0ICAgIGNvbXB1dGVWZXJ0ZXhDb2x1bW5zKHRoaXMsIG1vZGVsLCB0cmFja19pZHNbaV0pO1xuXHR9XG5cdHJlbmRlckFsbFRyYWNrcyh0aGlzLCBtb2RlbCk7XG4gICAgfVxuICAgIE9uY29wcmludFdlYkdMQ2VsbFZpZXcucHJvdG90eXBlLnNldFRyYWNrR3JvdXBTb3J0UHJpb3JpdHkgPSBmdW5jdGlvbihtb2RlbCkge1xuXHRpZiAodGhpcy5yZW5kZXJpbmdfc3VwcHJlc3NlZCkge1xuXHQgICAgcmV0dXJuO1xuXHR9O1xuXHRyZW5kZXJBbGxUcmFja3ModGhpcywgbW9kZWwpO1xuICAgIH1cbiAgICBPbmNvcHJpbnRXZWJHTENlbGxWaWV3LnByb3RvdHlwZS5zb3J0ID0gZnVuY3Rpb24obW9kZWwpIHtcblx0aWYgKHRoaXMucmVuZGVyaW5nX3N1cHByZXNzZWQpIHtcblx0ICAgIHJldHVybjtcblx0fTtcblx0dmFyIHRyYWNrX2lkcyA9IG1vZGVsLmdldFRyYWNrcygpO1xuXHRmb3IgKHZhciBpPTA7IGk8dHJhY2tfaWRzLmxlbmd0aDsgaSsrKSB7XG5cdCAgICBjb21wdXRlVmVydGV4UG9zaXRpb25zQW5kVmVydGV4Q29sb3JzKHRoaXMsIG1vZGVsLCB0cmFja19pZHNbaV0pOyAvLyBuZWVkIHRvIHJlY29tcHV0ZSBiZWNhdXNlIHRoZSB2ZXJ0ZXhlcyBhcmUgaW4gc29ydGVkIG9yZGVyIGZvciBjbGlwcGluZ1xuXHQgICAgY29tcHV0ZVZlcnRleENvbHVtbnModGhpcywgbW9kZWwsIHRyYWNrX2lkc1tpXSk7XG5cdH1cblx0cmVuZGVyQWxsVHJhY2tzKHRoaXMsIG1vZGVsKTtcbiAgICB9XG4gICAgT25jb3ByaW50V2ViR0xDZWxsVmlldy5wcm90b3R5cGUuc3VwcHJlc3NSZW5kZXJpbmcgPSBmdW5jdGlvbigpIHtcblx0dGhpcy5yZW5kZXJpbmdfc3VwcHJlc3NlZCA9IHRydWU7XG4gICAgfVxuICAgIE9uY29wcmludFdlYkdMQ2VsbFZpZXcucHJvdG90eXBlLnJlbGVhc2VSZW5kZXJpbmcgPSBmdW5jdGlvbihtb2RlbCkge1xuXHR0aGlzLnJlbmRlcmluZ19zdXBwcmVzc2VkID0gZmFsc2U7XG5cdHZhciB0cmFja19pZHMgPSBtb2RlbC5nZXRUcmFja3MoKTtcblx0Zm9yICh2YXIgaT0wOyBpPHRyYWNrX2lkcy5sZW5ndGg7IGkrKykge1xuXHQgICAgZ2V0U2hhcGVzKHRoaXMsIG1vZGVsLCB0cmFja19pZHNbaV0pO1xuXHQgICAgY29tcHV0ZVZlcnRleFBvc2l0aW9uc0FuZFZlcnRleENvbG9ycyh0aGlzLCBtb2RlbCwgdHJhY2tfaWRzW2ldKTtcblx0ICAgIGNvbXB1dGVWZXJ0ZXhDb2x1bW5zKHRoaXMsIG1vZGVsLCB0cmFja19pZHNbaV0pO1xuXHR9XG5cdHJlbmRlckFsbFRyYWNrcyh0aGlzLCBtb2RlbCk7XG4gICAgfVxuICAgIE9uY29wcmludFdlYkdMQ2VsbFZpZXcucHJvdG90eXBlLmhpZGVJZHMgPSBmdW5jdGlvbihtb2RlbCkge1xuXHRpZiAodGhpcy5yZW5kZXJpbmdfc3VwcHJlc3NlZCkge1xuXHQgICAgcmV0dXJuO1xuXHR9O1xuXHR2YXIgdHJhY2tfaWRzID0gbW9kZWwuZ2V0VHJhY2tzKCk7XG5cdGZvciAodmFyIGk9MDsgaTx0cmFja19pZHMubGVuZ3RoOyBpKyspIHtcblx0ICAgIGNvbXB1dGVWZXJ0ZXhDb2x1bW5zKHRoaXMsIG1vZGVsLCB0cmFja19pZHNbaV0pO1xuXHR9XG5cdHJlbmRlckFsbFRyYWNrcyh0aGlzLCBtb2RlbCk7XG4gICAgfVxuICAgIE9uY29wcmludFdlYkdMQ2VsbFZpZXcucHJvdG90eXBlLnNldFRyYWNrRGF0YSA9IGZ1bmN0aW9uKG1vZGVsLCB0cmFja19pZCkge1xuXHRpZiAodGhpcy5yZW5kZXJpbmdfc3VwcHJlc3NlZCkge1xuXHQgICAgcmV0dXJuO1xuXHR9O1xuXHRnZXRTaGFwZXModGhpcywgbW9kZWwsIHRyYWNrX2lkKTtcblx0Y29tcHV0ZVZlcnRleFBvc2l0aW9uc0FuZFZlcnRleENvbG9ycyh0aGlzLCBtb2RlbCwgdHJhY2tfaWQpO1xuXHRjb21wdXRlVmVydGV4Q29sdW1ucyh0aGlzLCBtb2RlbCwgdHJhY2tfaWQpO1xuXHRyZW5kZXJBbGxUcmFja3ModGhpcywgbW9kZWwpO1xuICAgIH1cbiAgICAgT25jb3ByaW50V2ViR0xDZWxsVmlldy5wcm90b3R5cGUuc2V0UnVsZVNldCA9IGZ1bmN0aW9uKG1vZGVsLCB0YXJnZXRfdHJhY2tfaWQpIHtcblx0IGlmICh0aGlzLnJlbmRlcmluZ19zdXBwcmVzc2VkKSB7XG5cdCAgICByZXR1cm47XG5cdH07XG5cdGdldFNoYXBlcyh0aGlzLCBtb2RlbCwgdGFyZ2V0X3RyYWNrX2lkKTtcblx0Y29tcHV0ZVZlcnRleFBvc2l0aW9uc0FuZFZlcnRleENvbG9ycyh0aGlzLCBtb2RlbCwgdGFyZ2V0X3RyYWNrX2lkKTtcblx0cmVuZGVyQWxsVHJhY2tzKHRoaXMsIG1vZGVsKTtcbiAgICB9XG4gICAgT25jb3ByaW50V2ViR0xDZWxsVmlldy5wcm90b3R5cGUuc2hhcmVSdWxlU2V0ID0gZnVuY3Rpb24obW9kZWwsIHRhcmdldF90cmFja19pZCkge1xuXHRpZiAodGhpcy5yZW5kZXJpbmdfc3VwcHJlc3NlZCkge1xuXHQgICAgcmV0dXJuO1xuXHR9O1xuXHRnZXRTaGFwZXModGhpcywgbW9kZWwsIHRhcmdldF90cmFja19pZCk7XG5cdGNvbXB1dGVWZXJ0ZXhQb3NpdGlvbnNBbmRWZXJ0ZXhDb2xvcnModGhpcywgbW9kZWwsIHRhcmdldF90cmFja19pZCk7XG5cdHJlbmRlckFsbFRyYWNrcyh0aGlzLCBtb2RlbCk7XG4gICAgfVxuICAgIE9uY29wcmludFdlYkdMQ2VsbFZpZXcucHJvdG90eXBlLnNldFNvcnRDb25maWcgPSBmdW5jdGlvbihtb2RlbCkge1xuXHRpZiAodGhpcy5yZW5kZXJpbmdfc3VwcHJlc3NlZCkge1xuXHQgICAgcmV0dXJuO1xuXHR9O1xuXHR0aGlzLnNvcnQobW9kZWwpO1xuICAgIH1cbiAgICBcbiAgICBPbmNvcHJpbnRXZWJHTENlbGxWaWV3LnByb3RvdHlwZS5zZXRIb3J6U2Nyb2xsID0gZnVuY3Rpb24obW9kZWwpIHtcblx0aWYgKHRoaXMucmVuZGVyaW5nX3N1cHByZXNzZWQpIHtcblx0ICAgIHJldHVybjtcblx0fTtcblx0dGhpcy5zZXRTY3JvbGwobW9kZWwpO1xuICAgIH1cbiAgICBcbiAgICBPbmNvcHJpbnRXZWJHTENlbGxWaWV3LnByb3RvdHlwZS5zZXRWZXJ0U2Nyb2xsID0gZnVuY3Rpb24obW9kZWwpIHtcblx0aWYgKHRoaXMucmVuZGVyaW5nX3N1cHByZXNzZWQpIHtcblx0ICAgIHJldHVybjtcblx0fTtcblx0dGhpcy5zZXRTY3JvbGwobW9kZWwpO1xuICAgIH1cbiAgICBcbiAgICBPbmNvcHJpbnRXZWJHTENlbGxWaWV3LnByb3RvdHlwZS5zZXRTY3JvbGwgPSBmdW5jdGlvbihtb2RlbCkge1xuXHRpZiAodGhpcy5yZW5kZXJpbmdfc3VwcHJlc3NlZCkge1xuXHQgICAgcmV0dXJuO1xuXHR9O1xuXHR0aGlzLnNjcm9sbF94ID0gbW9kZWwuZ2V0SG9yelNjcm9sbCgpO1xuXHR0aGlzLnNjcm9sbF95ID0gbW9kZWwuZ2V0VmVydFNjcm9sbCgpO1xuXHRyZW5kZXJBbGxUcmFja3ModGhpcywgbW9kZWwsIHRydWUpO1xuICAgIH1cbiAgICBcbiAgICB2YXIgdXBkYXRlQW50aWFsaWFzU2V0dGluZyA9IGZ1bmN0aW9uKHZpZXcsIG1vZGVsKSB7XG5cdHZhciBjZWxsX3dpZHRoID0gbW9kZWwuZ2V0Q2VsbFdpZHRoKCk7XG5cdGlmIChjZWxsX3dpZHRoIDwgdmlldy5hbnRpYWxpYXNfb25fY2VsbF93aWR0aF90aHJlc2gpIHtcblx0ICAgIGlmICghdmlldy5hbnRpYWxpYXMpIHtcblx0XHR2aWV3LmFudGlhbGlhcyA9IHRydWU7XG5cdFx0cmVmcmVzaENhbnZhcyh2aWV3LCBtb2RlbCk7XG5cdCAgICB9XG5cdH0gZWxzZSB7XG5cdCAgICBpZiAodmlldy5hbnRpYWxpYXMpIHtcblx0XHR2aWV3LmFudGlhbGlhcyA9IGZhbHNlO1xuXHRcdHJlZnJlc2hDYW52YXModmlldywgbW9kZWwpO1xuXHQgICAgfVxuXHR9XG4gICAgfTtcbiAgICBcbiAgICBPbmNvcHJpbnRXZWJHTENlbGxWaWV3LnByb3RvdHlwZS5zZXRab29tID0gZnVuY3Rpb24obW9kZWwpIHtcblx0aWYgKHRoaXMucmVuZGVyaW5nX3N1cHByZXNzZWQpIHtcblx0ICAgIHJldHVybjtcblx0fTtcblx0dXBkYXRlQW50aWFsaWFzU2V0dGluZyh0aGlzLCBtb2RlbCk7XG5cdHJlbmRlckFsbFRyYWNrcyh0aGlzLCBtb2RlbCk7XG4gICAgfVxuICAgIFxuICAgIE9uY29wcmludFdlYkdMQ2VsbFZpZXcucHJvdG90eXBlLnNldEhvcnpab29tID0gZnVuY3Rpb24obW9kZWwpIHtcblx0aWYgKHRoaXMucmVuZGVyaW5nX3N1cHByZXNzZWQpIHtcblx0ICAgIHJldHVybjtcblx0fTtcblx0dXBkYXRlQW50aWFsaWFzU2V0dGluZyh0aGlzLCBtb2RlbCk7XG5cdHJlbmRlckFsbFRyYWNrcyh0aGlzLCBtb2RlbCk7XG4gICAgfVxuICAgIFxuICAgIE9uY29wcmludFdlYkdMQ2VsbFZpZXcucHJvdG90eXBlLnNldFZlcnRab29tID0gZnVuY3Rpb24obW9kZWwpIHtcblx0aWYgKHRoaXMucmVuZGVyaW5nX3N1cHByZXNzZWQpIHtcblx0ICAgIHJldHVybjtcblx0fTtcblx0cmVuZGVyQWxsVHJhY2tzKHRoaXMsIG1vZGVsKTtcbiAgICB9XG4gICAgXG4gICAgT25jb3ByaW50V2ViR0xDZWxsVmlldy5wcm90b3R5cGUuc2V0Vmlld3BvcnQgPSBmdW5jdGlvbihtb2RlbCkge1xuXHRpZiAodGhpcy5yZW5kZXJpbmdfc3VwcHJlc3NlZCkge1xuXHQgICAgcmV0dXJuO1xuXHR9O1xuXHR0aGlzLnNjcm9sbF94ID0gbW9kZWwuZ2V0SG9yelNjcm9sbCgpO1xuXHR0aGlzLnNjcm9sbF95ID0gbW9kZWwuZ2V0VmVydFNjcm9sbCgpO1xuXHR1cGRhdGVBbnRpYWxpYXNTZXR0aW5nKHRoaXMsIG1vZGVsKTtcblx0cmVuZGVyQWxsVHJhY2tzKHRoaXMsIG1vZGVsKTtcbiAgICB9XG4gICAgXG4gICAgT25jb3ByaW50V2ViR0xDZWxsVmlldy5wcm90b3R5cGUuZ2V0VG90YWxXaWR0aCA9IGZ1bmN0aW9uKG1vZGVsLCBiYXNlKSB7XG5cdHJldHVybiAobW9kZWwuZ2V0Q2VsbFdpZHRoKGJhc2UpICsgbW9kZWwuZ2V0Q2VsbFBhZGRpbmcoYmFzZSkpKm1vZGVsLmdldElkT3JkZXIoKS5sZW5ndGg7XG4gICAgfVxuICAgIFxuICAgIE9uY29wcmludFdlYkdMQ2VsbFZpZXcucHJvdG90eXBlLmdldFdpZHRoID0gZnVuY3Rpb24oKSB7XG5cdHJldHVybiB0aGlzLnZpc2libGVfYXJlYV93aWR0aDtcbiAgICB9XG4gICAgXG4gICAgT25jb3ByaW50V2ViR0xDZWxsVmlldy5wcm90b3R5cGUuc2V0V2lkdGggPSBmdW5jdGlvbih3LCBtb2RlbCkge1xuXHR0aGlzLnZpc2libGVfYXJlYV93aWR0aCA9IHc7XG5cdGlmICh0aGlzLnJlbmRlcmluZ19zdXBwcmVzc2VkKSB7XG5cdCAgICByZXR1cm47XG5cdH07XG5cdHJlbmRlckFsbFRyYWNrcyh0aGlzLCBtb2RlbCk7IC8vIGluIHRoZSBwcm9jZXNzIGl0IHdpbGwgY2FsbCByZXNpemVBbmRDbGVhclxuICAgIH1cbiAgICBcbiAgICBPbmNvcHJpbnRXZWJHTENlbGxWaWV3LnByb3RvdHlwZS5zZXRDZWxsUGFkZGluZ09uID0gZnVuY3Rpb24obW9kZWwpIHtcblx0aWYgKHRoaXMucmVuZGVyaW5nX3N1cHByZXNzZWQpIHtcblx0ICAgIHJldHVybjtcblx0fTtcblx0dmFyIHRyYWNrX2lkcyA9IG1vZGVsLmdldFRyYWNrcygpO1xuXHRmb3IgKHZhciBpPTA7IGk8dHJhY2tfaWRzLmxlbmd0aDsgaSsrKSB7XG5cdCAgICBpZiAoIW1vZGVsLmdldFRyYWNrSGFzQ29sdW1uU3BhY2luZyh0cmFja19pZHNbaV0pKSB7XG5cdFx0Ly8gV2UgbmVlZCB0byByZWNvbXB1dGUgc2hhcGVzIGZvciB0cmFja3MgdGhhdCBkb24ndCBoYXZlIGNvbHVtbiBzcGFjaW5nLFxuXHRcdC8vIGJlY2F1c2UgZm9yIHRob3NlIHdlJ3JlIHJlZGVmaW5pbmcgdGhlIGJhc2Ugd2lkdGggZm9yIHNoYXBlIGdlbmVyYXRpb24uXG5cdFx0Z2V0U2hhcGVzKHRoaXMsIG1vZGVsLCB0cmFja19pZHNbaV0pO1xuXHRcdGNvbXB1dGVWZXJ0ZXhQb3NpdGlvbnNBbmRWZXJ0ZXhDb2xvcnModGhpcywgbW9kZWwsIHRyYWNrX2lkc1tpXSk7XG5cdCAgICB9XG5cdCAgICBjb21wdXRlVmVydGV4Q29sdW1ucyh0aGlzLCBtb2RlbCwgdHJhY2tfaWRzW2ldKTtcblx0fVxuXHRyZW5kZXJBbGxUcmFja3ModGhpcywgbW9kZWwpO1xuICAgIH1cbiAgICBcbiAgICBPbmNvcHJpbnRXZWJHTENlbGxWaWV3LnByb3RvdHlwZS5nZXREdW1teVNjcm9sbERpdkNsaWVudFNpemUgPSBmdW5jdGlvbigpIHtcblx0cmV0dXJuIHRoaXMuZHVtbXlfc2Nyb2xsX2Rpdl9jbGllbnRfc2l6ZS5nZXQoKTtcbiAgICB9XG4gICAgXG4gICAgT25jb3ByaW50V2ViR0xDZWxsVmlldy5wcm90b3R5cGUudG9TVkdHcm91cCA9IGZ1bmN0aW9uKG1vZGVsLCBvZmZzZXRfeCwgb2Zmc2V0X3kpIHtcblx0dmFyIHJvb3QgPSBzdmdmYWN0b3J5Lmdyb3VwKChvZmZzZXRfeCB8fCAwKSwgKG9mZnNldF95IHx8IDApKTtcblx0dmFyIGNlbGxfdG9wcyA9IG1vZGVsLmdldENlbGxUb3BzKCk7XG5cdHZhciB0cmFja3MgPSBtb2RlbC5nZXRUcmFja3MoKTtcblx0dmFyIHpvb21lZENvbHVtbkxlZnQgPSBtb2RlbC5nZXRab29tZWRDb2x1bW5MZWZ0KCk7XG5cdGZvciAodmFyIGk9MDsgaTx0cmFja3MubGVuZ3RoOyBpKyspIHtcblx0ICAgIHZhciB0cmFja19pZCA9IHRyYWNrc1tpXTtcblx0ICAgIHZhciBvZmZzZXRfeSA9IGNlbGxfdG9wc1t0cmFja19pZF07XG5cdCAgICB2YXIgaWRlbnRpZmllZF9zaGFwZV9saXN0X2xpc3QgPSBtb2RlbC5nZXRJZGVudGlmaWVkU2hhcGVMaXN0TGlzdCh0cmFja19pZCwgZmFsc2UsIHRydWUpO1xuXHQgICAgZm9yICh2YXIgaj0wOyBqPGlkZW50aWZpZWRfc2hhcGVfbGlzdF9saXN0Lmxlbmd0aDsgaisrKSB7XG5cdFx0dmFyIGlkX3NsID0gaWRlbnRpZmllZF9zaGFwZV9saXN0X2xpc3Rbal07XG5cdFx0dmFyIGlkID0gaWRfc2wuaWQ7XG5cdFx0dmFyIHNsID0gaWRfc2wuc2hhcGVfbGlzdDtcblx0XHR2YXIgb2Zmc2V0X3ggPSB6b29tZWRDb2x1bW5MZWZ0W2lkXTtcblx0XHRpZiAodHlwZW9mIG9mZnNldF94ID09PSAndW5kZWZpbmVkJykge1xuXHRcdCAgICAvLyBoaWRkZW4gaWRcblx0XHQgICAgY29udGludWU7XG5cdFx0fVxuXHRcdGZvciAodmFyIGg9MDsgaDxzbC5sZW5ndGg7IGgrKykge1xuXHRcdCAgICByb290LmFwcGVuZENoaWxkKHN2Z2ZhY3RvcnkuZnJvbVNoYXBlKHNsW2hdLCBvZmZzZXRfeCwgb2Zmc2V0X3kpKTtcblx0XHR9XG5cdCAgICB9XG5cdH1cblx0cmV0dXJuIHJvb3Q7XG4gICAgfVxuICAgIHJldHVybiBPbmNvcHJpbnRXZWJHTENlbGxWaWV3O1xufSkoKTtcblxubW9kdWxlLmV4cG9ydHMgPSBPbmNvcHJpbnRXZWJHTENlbGxWaWV3O1xuIiwidmFyIE9uY29wcmludFpvb21TbGlkZXIgPSAoZnVuY3Rpb24oKSB7XG4gICAgdmFyIFZFUlRJQ0FMID0gXCJ2XCI7XG4gICAgdmFyIEhPUklaT05UQUwgPSBcImhcIjtcbiAgICBcbiAgICB2YXIgY2xhbXAgPSBmdW5jdGlvbih4KSB7XG5cdHJldHVybiBNYXRoLm1heChNYXRoLm1pbih4LCAxKSwgMCk7XG4gICAgfTtcbiAgICBcbiAgICB2YXIgaW5pdGlhbGl6ZSA9IGZ1bmN0aW9uKGNvbXBvbmVudCwgcGFyYW1zKSB7XG5cdHZhciAkY3RyID0gY29tcG9uZW50LiRkaXY7XG5cdHZhciBpY29uX3NpemUgPSBNYXRoLnJvdW5kKHBhcmFtcy5idG5fc2l6ZSAqIDAuNyk7XG5cdHZhciBpY29uX3BhZGRpbmcgPSBNYXRoLnJvdW5kKChwYXJhbXMuYnRuX3NpemUgLSBpY29uX3NpemUpLzIpO1xuXHR2YXIgJHNsaWRlcl9iYXIgPSAkKCc8ZGl2PicpLmNzcyh7J3Bvc2l0aW9uJzonYWJzb2x1dGUnLFxuXHRcdFx0XHRcdCdiYWNrZ3JvdW5kLWNvbG9yJzonI2ZmZmZmZicsXG5cdFx0XHRcdFx0J291dGxpbmUnOiAnc29saWQgMXB4IGJsYWNrJ30pLmFwcGVuZFRvKCRjdHIpO1xuXHR2YXIgJHNsaWRlciA9ICQoJzxkaXY+JykuY3NzKHsncG9zaXRpb24nOidhYnNvbHV0ZScsXG5cdFx0XHRcdCAgICAnYmFja2dyb3VuZC1jb2xvcic6JyNmZmZmZmYnLFxuXHRcdFx0XHQgICAgJ2JvcmRlcic6ICdzb2xpZCAxcHggYmxhY2snLFxuXHRcdFx0XHQgICAgJ2JvcmRlci1yYWRpdXMnOiAnM3B4Jyxcblx0XHRcdFx0ICAgICdjdXJzb3InOiAncG9pbnRlcid9KS5hcHBlbmRUbygkY3RyKTtcblx0XHRcdFx0XG5cdHZhciAkcGx1c19idG4gPSAkKCc8ZGl2PicpLmNzcyh7J3Bvc2l0aW9uJzonYWJzb2x1dGUnLFxuXHRcdFx0XHRcdCAgICAnbWluLWhlaWdodCc6IHBhcmFtcy5idG5fc2l6ZSxcblx0XHRcdFx0XHQgICAgJ21pbi13aWR0aCc6IHBhcmFtcy5idG5fc2l6ZSxcblx0XHRcdFx0XHQgICAgJ2JhY2tncm91bmQtY29sb3InOicjZmZmZmZmJyxcblx0XHRcdFx0XHQgICAgJ2JvcmRlcic6ICdzb2xpZCAxcHggYmxhY2snLFxuXHRcdFx0XHRcdCAgICAnYm9yZGVyLXJhZGl1cyc6ICczcHgnLFxuXHRcdFx0XHRcdCAgICAnY3Vyc29yJzogJ3BvaW50ZXInfSlcblx0XHRcdFx0XHRcdC5hcHBlbmRUbygkY3RyKTtcblx0JCgnPHNwYW4+JykuYWRkQ2xhc3MoXCJpY29uIGZhIGZhLXBsdXNcIikuY3NzKHsncG9zaXRpb24nOidhYnNvbHV0ZScsIFxuXHRcdFx0XHRcdFx0XHQndG9wJzppY29uX3BhZGRpbmcsXG5cdFx0XHRcdFx0XHRcdCdsZWZ0JzppY29uX3BhZGRpbmcsXG5cdFx0XHRcdFx0XHRcdCdtaW4td2lkdGgnOmljb25fc2l6ZSxcblx0XHRcdFx0XHRcdFx0J21pbi1oZWlnaHQnOmljb25fc2l6ZX0pXG5cdFx0XHRcdFx0XHQuYXBwZW5kVG8oJHBsdXNfYnRuKTtcblx0dmFyICRtaW51c19idG4gPSAkKCc8ZGl2PicpLmNzcyh7J3Bvc2l0aW9uJzonYWJzb2x1dGUnLFxuXHRcdFx0XHRcdCAgICAnbWluLWhlaWdodCc6IHBhcmFtcy5idG5fc2l6ZSxcblx0XHRcdFx0XHQgICAgJ21pbi13aWR0aCc6IHBhcmFtcy5idG5fc2l6ZSxcblx0XHRcdFx0XHQgICAgJ2JhY2tncm91bmQtY29sb3InOicjZmZmZmZmJyxcblx0XHRcdFx0XHQgICAgJ2JvcmRlcic6ICdzb2xpZCAxcHggYmxhY2snLFxuXHRcdFx0XHRcdCAgICAnYm9yZGVyLXJhZGl1cyc6ICczcHgnLFxuXHRcdFx0XHRcdCAgICAnY3Vyc29yJzogJ3BvaW50ZXInfSlcblx0XHRcdFx0XHRcdC5hcHBlbmRUbygkY3RyKTtcblx0JCgnPHNwYW4+JykuYWRkQ2xhc3MoXCJpY29uIGZhIGZhLW1pbnVzXCIpLmNzcyh7J3Bvc2l0aW9uJzonYWJzb2x1dGUnLCBcblx0XHRcdFx0XHRcdFx0J3RvcCc6aWNvbl9wYWRkaW5nLFxuXHRcdFx0XHRcdFx0XHQnbGVmdCc6aWNvbl9wYWRkaW5nLFxuXHRcdFx0XHRcdFx0XHQnbWluLXdpZHRoJzppY29uX3NpemUsXG5cdFx0XHRcdFx0XHRcdCdtaW4taGVpZ2h0JzppY29uX3NpemV9KVxuXHRcdFx0XHRcdFx0LmFwcGVuZFRvKCRtaW51c19idG4pO1xuXHRpZiAocGFyYW1zLnZlcnRpY2FsKSB7XG5cdCAgICAkc2xpZGVyX2Jhci5jc3MoeydtaW4taGVpZ2h0JzogcGFyYW1zLmhlaWdodCAtIDIgKiBwYXJhbXMuYnRuX3NpemUsXG5cdFx0J21pbi13aWR0aCc6IE1hdGgucm91bmQocGFyYW1zLmJ0bl9zaXplIC8gNSl9KTtcblx0ICAgICRzbGlkZXIuY3NzKHsnbWluLWhlaWdodCc6IE1hdGgucm91bmQocGFyYW1zLmJ0bl9zaXplIC8gMiksXG5cdFx0J21pbi13aWR0aCc6IHBhcmFtcy5idG5fc2l6ZX0pO1xuXG5cdCAgICAkcGx1c19idG4uY3NzKHsndG9wJzogMCwgJ2xlZnQnOiAwfSk7XG5cdCAgICAkbWludXNfYnRuLmNzcyh7J3RvcCc6IHBhcmFtcy5oZWlnaHQgLSBwYXJhbXMuYnRuX3NpemUsICdsZWZ0JzogMH0pO1xuXHQgICAgJHNsaWRlcl9iYXIuY3NzKHsndG9wJzogcGFyYW1zLmJ0bl9zaXplLCAnbGVmdCc6IDAuNCAqIHBhcmFtcy5idG5fc2l6ZX0pO1xuXHQgICAgJHNsaWRlci5jc3MoeydsZWZ0JzogMH0pO1xuXHQgICAgY29tcG9uZW50Lm9yaWVudGF0aW9uID0gVkVSVElDQUw7XG5cdH0gZWxzZSB7XG5cdCAgICAkc2xpZGVyX2Jhci5jc3MoeydtaW4taGVpZ2h0JzogTWF0aC5yb3VuZChwYXJhbXMuYnRuX3NpemUgLyA1KSxcblx0XHQnbWluLXdpZHRoJzogcGFyYW1zLndpZHRoIC0gMiAqIHBhcmFtcy5idG5fc2l6ZX0pO1xuXHQgICAgJHNsaWRlci5jc3MoeydtaW4taGVpZ2h0JzogcGFyYW1zLmJ0bl9zaXplLFxuXHRcdCdtaW4td2lkdGgnOiBNYXRoLnJvdW5kKHBhcmFtcy5idG5fc2l6ZSAvIDIpfSk7XG5cdCAgICBcblx0ICAgICRwbHVzX2J0bi5jc3Moeyd0b3AnOiAwLCAnbGVmdCc6IHBhcmFtcy53aWR0aCAtIHBhcmFtcy5idG5fc2l6ZX0pO1xuXHQgICAgJG1pbnVzX2J0bi5jc3Moeyd0b3AnOiAwLCAnbGVmdCc6IDB9KTtcblx0ICAgICRzbGlkZXJfYmFyLmNzcyh7J3RvcCc6IDAuNCpwYXJhbXMuYnRuX3NpemUsICdsZWZ0JzogcGFyYW1zLmJ0bl9zaXplfSk7XG5cdCAgICAkc2xpZGVyLmNzcyh7J3RvcCc6IDB9KTtcblx0ICAgIGNvbXBvbmVudC5vcmllbnRhdGlvbiA9IEhPUklaT05UQUw7XG5cdH1cblx0XG5cdCRwbHVzX2J0bi5jbGljayhmdW5jdGlvbigpIHtcblx0ICAgIGNvbXBvbmVudC52YWx1ZSAvPSAwLjc7XG5cdCAgICBwYXJhbXMub25DaGFuZ2UoY29tcG9uZW50LnZhbHVlKTtcblx0fSk7XHRcdFx0XHRcblx0JG1pbnVzX2J0bi5jbGljayhmdW5jdGlvbigpIHtcblx0ICAgIGNvbXBvbmVudC52YWx1ZSAqPSAwLjc7XG5cdCAgICBwYXJhbXMub25DaGFuZ2UoY29tcG9uZW50LnZhbHVlKTtcblx0fSk7XG5cdFxuXHRbJHNsaWRlciwgJHBsdXNfYnRuLCAkbWludXNfYnRuXS5tYXAoZnVuY3Rpb24oJGJ0bikgeyAkYnRuLmhvdmVyKGZ1bmN0aW9uKCkge1xuXHQgICAgJCh0aGlzKS5jc3MoeydiYWNrZ3JvdW5kLWNvbG9yJzonI2NjY2NjYyd9KTtcblx0fSwgZnVuY3Rpb24oKSB7XG5cdCAgICAkKHRoaXMpLmNzcyh7J2JhY2tncm91bmQtY29sb3InOiAnI2ZmZmZmZid9KTtcblx0fSk7IH0pO1xuICAgIFxuICAgIFxuICAgIFxuXHRjb21wb25lbnQuJHNsaWRlciA9ICRzbGlkZXI7XG5cdGNvbXBvbmVudC4kcGx1c19idG4gPSAkcGx1c19idG47XG5cdGNvbXBvbmVudC4kbWludXNfYnRuID0gJG1pbnVzX2J0bjtcblx0XG5cdChmdW5jdGlvbiBzZXRVcFNsaWRlckRyYWcoKSB7XG5cdCAgICB2YXIgc3RhcnRfbW91c2U7XG5cdCAgICB2YXIgc3RhcnRfdmFsO1xuXHQgICAgdmFyIGRyYWdnaW5nO1xuXHQgICAgdmFyIGhhbmRsZVNsaWRlckRyYWcgPSBmdW5jdGlvbiAoZXZ0KSB7XG5cdFx0ZXZ0LnN0b3BQcm9wYWdhdGlvbigpO1xuXHRcdGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdHZhciBkZWx0YV9tb3VzZTtcblx0XHRpZiAoY29tcG9uZW50Lm9yaWVudGF0aW9uID09PSBWRVJUSUNBTCkge1xuXHRcdCAgICBkZWx0YV9tb3VzZSA9IHN0YXJ0X21vdXNlIC0gZXZ0LnBhZ2VZOyAvLyB2ZXJ0aWNhbCB6b29tLCBwb3NpdGl2ZSBpcyB1cCwgYnV0IENTUyBwb3NpdGl2ZSBpcyBkb3duLCBzbyB3ZSBuZWVkIHRvIGludmVydFxuXHRcdH0gZWxzZSB7XG5cdFx0ICAgIGRlbHRhX21vdXNlID0gZXZ0LnBhZ2VYIC0gc3RhcnRfbW91c2U7XG5cdFx0fVxuXHRcdHZhciBkZWx0YV92YWwgPSBkZWx0YV9tb3VzZSAvIGNvbXBvbmVudC5zbGlkZXJfYmFyX3NpemU7XG5cdFx0Y29tcG9uZW50LnNldFNsaWRlclZhbHVlKHN0YXJ0X3ZhbCArIGRlbHRhX3ZhbCk7XG5cdCAgICB9O1xuXHQgICAgdmFyIHN0b3BTbGlkZXJEcmFnID0gZnVuY3Rpb24gKCkge1xuXHRcdGlmIChkcmFnZ2luZyAmJiBzdGFydF92YWwgIT09IGNvbXBvbmVudC52YWx1ZSkge1xuXHRcdCAgICBjb21wb25lbnQub25DaGFuZ2UoY29tcG9uZW50LnZhbHVlKTtcblx0XHR9XG5cdFx0ZHJhZ2dpbmcgPSBmYWxzZTtcblx0ICAgIH07XG5cdCAgICBjb21wb25lbnQuJHNsaWRlci5vbihcIm1vdXNlZG93blwiLCBmdW5jdGlvbiAoZXZ0KSB7XG5cdFx0aWYgKGNvbXBvbmVudC5vcmllbnRhdGlvbiA9PT0gVkVSVElDQUwpIHtcblx0XHQgICAgc3RhcnRfbW91c2UgPSBldnQucGFnZVk7XG5cdFx0fSBlbHNlIHtcblx0XHQgICAgc3RhcnRfbW91c2UgPSBldnQucGFnZVg7XG5cdFx0fVxuXHRcdHN0YXJ0X3ZhbCA9IGNvbXBvbmVudC52YWx1ZTtcblx0XHRkcmFnZ2luZyA9IHRydWU7XG5cdFx0JChkb2N1bWVudCkub24oXCJtb3VzZW1vdmVcIiwgaGFuZGxlU2xpZGVyRHJhZyk7XG5cdCAgICB9KTtcblx0ICAgICQoZG9jdW1lbnQpLm9uKFwibW91c2V1cCBjbGlja1wiLCBmdW5jdGlvbiAoKSB7XG5cdFx0JChkb2N1bWVudCkub2ZmKFwibW91c2Vtb3ZlXCIsIGhhbmRsZVNsaWRlckRyYWcpO1xuXHRcdHN0b3BTbGlkZXJEcmFnKCk7XG5cdCAgICB9KTtcblx0fSkoKVxuICAgIH07XG4gICAgXG4gICAgdmFyIHNldFNsaWRlclBvcyA9IGZ1bmN0aW9uKGNvbXBvbmVudCwgcHJvcG9ydGlvbikge1xuXHR2YXIgJHNsaWRlciA9IGNvbXBvbmVudC4kc2xpZGVyO1xuXHR2YXIgYm91bmRzID0gZ2V0U2xpZGVyQm91bmRzKGNvbXBvbmVudCk7XG5cdGlmIChjb21wb25lbnQub3JpZW50YXRpb24gPT09IFZFUlRJQ0FMKSB7XG5cdCAgICAkc2xpZGVyLmNzcygndG9wJywgYm91bmRzLmJvdHRvbSooMS1wcm9wb3J0aW9uKSArIGJvdW5kcy50b3AqcHJvcG9ydGlvbik7XG5cdH0gZWxzZSBpZiAoY29tcG9uZW50Lm9yaWVudGF0aW9uID09PSBIT1JJWk9OVEFMKSB7XG5cdCAgICAkc2xpZGVyLmNzcygnbGVmdCcsIGJvdW5kcy5sZWZ0KigxLXByb3BvcnRpb24pICsgYm91bmRzLnJpZ2h0KnByb3BvcnRpb24pO1xuXHR9XG4gICAgfTtcbiAgICBcbiAgICB2YXIgZ2V0U2xpZGVyQm91bmRzID0gZnVuY3Rpb24oY29tcG9uZW50KSB7XG5cdGlmIChjb21wb25lbnQub3JpZW50YXRpb24gPT09IFZFUlRJQ0FMKSB7XG5cdCAgICByZXR1cm4ge2JvdHRvbTogcGFyc2VJbnQoY29tcG9uZW50LiRtaW51c19idG4uY3NzKCd0b3AnKSwgMTApIC0gcGFyc2VJbnQoY29tcG9uZW50LiRzbGlkZXIuY3NzKCdtaW4taGVpZ2h0JyksIDEwKSxcblx0XHQgICAgdG9wOiBwYXJzZUludChjb21wb25lbnQuJHBsdXNfYnRuLmNzcygndG9wJyksIDEwKSArIHBhcnNlSW50KGNvbXBvbmVudC4kcGx1c19idG4uY3NzKCdtaW4taGVpZ2h0JyksIDEwKX07XG5cdH0gZWxzZSB7IFxuXHQgICAgcmV0dXJuIHtsZWZ0OiBwYXJzZUludChjb21wb25lbnQuJG1pbnVzX2J0bi5jc3MoJ2xlZnQnKSwgMTApICsgcGFyc2VJbnQoY29tcG9uZW50LiRtaW51c19idG4uY3NzKCdtaW4td2lkdGgnKSwgMTApLFxuXHRcdCAgICByaWdodDogcGFyc2VJbnQoY29tcG9uZW50LiRwbHVzX2J0bi5jc3MoJ2xlZnQnKSwgMTApIC0gcGFyc2VJbnQoY29tcG9uZW50LiRzbGlkZXIuY3NzKCdtaW4td2lkdGgnKSwgMTApfTtcblx0fVxuICAgIH07XG4gICAgXG4gICAgdmFyIHVwZGF0ZVNsaWRlclBvcyA9IGZ1bmN0aW9uKGNvbXBvbmVudCkge1xuXHRzZXRTbGlkZXJQb3MoY29tcG9uZW50LCBjb21wb25lbnQudmFsdWUpO1xuICAgIH07XG4gICAgXG4gICAgZnVuY3Rpb24gT25jb3ByaW50Wm9vbVNsaWRlcigkY29udGFpbmVyLCBwYXJhbXMpIHtcblx0dGhpcy4kZGl2ID0gJCgnPGRpdj4nKS5jc3Moeydwb3NpdGlvbic6J2Fic29sdXRlJyxcblx0XHRcdFx0ICAgICd0b3AnOiBwYXJhbXMudG9wIHx8IDAsXG5cdFx0XHRcdCAgICAnbGVmdCc6IHBhcmFtcy5sZWZ0IHx8IDB9KS5hcHBlbmRUbygkY29udGFpbmVyKTtcblx0cGFyYW1zID0gcGFyYW1zIHx8IHt9O1xuXHRwYXJhbXMuYnRuX3NpemUgPSBwYXJhbXMuYnRuX3NpemUgfHwgMTM7XG5cdHRoaXMub25DaGFuZ2UgPSBwYXJhbXMub25DaGFuZ2UgfHwgZnVuY3Rpb24oKSB7fTtcblx0aW5pdGlhbGl6ZSh0aGlzLCBwYXJhbXMpO1xuXHR0aGlzLnZhbHVlID0gcGFyYW1zLmluaXRfdmFsIHx8IDAuNTtcblx0dGhpcy5zbGlkZXJfYmFyX3NpemUgPSAodGhpcy5vcmllbnRhdGlvbiA9PT0gVkVSVElDQUwgPyBwYXJhbXMuaGVpZ2h0IDogcGFyYW1zLndpZHRoKSAtIDIqcGFyYW1zLmJ0bl9zaXplO1xuXHR1cGRhdGVTbGlkZXJQb3ModGhpcyk7XG4gICAgfVxuICAgIFxuICAgIE9uY29wcmludFpvb21TbGlkZXIucHJvdG90eXBlLnNldFNsaWRlclZhbHVlID0gZnVuY3Rpb24ocHJvcG9ydGlvbiwgdHJpZ2dlcl9jYWxsYmFjaykge1xuXHR0aGlzLnZhbHVlID0gY2xhbXAocHJvcG9ydGlvbik7XG5cdHVwZGF0ZVNsaWRlclBvcyh0aGlzKTtcbiAgICB9XG4gICAgXG4gICAgXG4gICAgcmV0dXJuIE9uY29wcmludFpvb21TbGlkZXI7XG4gICAgfSkoKTtcbiAgICBcbm1vZHVsZS5leHBvcnRzID0gT25jb3ByaW50Wm9vbVNsaWRlcjsiLCJ2YXIgbWFrZVNWR0VsZW1lbnQgPSByZXF1aXJlKCcuL21ha2VzdmdlbGVtZW50LmpzJyk7XG52YXIgc2hhcGVUb1NWRyA9IHJlcXVpcmUoJy4vb25jb3ByaW50c2hhcGV0b3N2Zy5qcycpO1xudmFyIGV4dHJhY3RSR0JBID0gcmVxdWlyZSgnLi9leHRyYWN0cmdiYS5qcycpO1xuXG52YXIgZXh0cmFjdENvbG9yID0gZnVuY3Rpb24oc3RyKSB7XG4gICAgaWYgKHN0ci5pbmRleE9mKFwicmdiKFwiKSA+IC0xKSB7XG5cdHJldHVybiB7XG5cdCAgICAncmdiJzogc3RyLFxuXHQgICAgJ29wYWNpdHknOiAxXG5cdH07XG4gICAgfVxuICAgIHZhciByZ2JhX2FyciA9IGV4dHJhY3RSR0JBKHN0cik7XG4gICAgcmV0dXJuIHtcblx0J3JnYic6ICdyZ2IoJytNYXRoLnJvdW5kKHJnYmFfYXJyWzBdKjI1NSkrJywnK01hdGgucm91bmQocmdiYV9hcnJbMV0qMjU1KSsnLCcrTWF0aC5yb3VuZChyZ2JhX2FyclsyXSoyNTUpKycpJyxcblx0J29wYWNpdHknOiByZ2JhX2FyclszXVxuICAgIH07XG59O1xuXG5mdW5jdGlvbiBtYWtlSWRDb3VudGVyKCkge1xuICAgIHZhciBpZCA9IDA7XG4gICAgcmV0dXJuIGZ1bmN0aW9uICgpIHtcblx0aWQgKz0gMTtcblx0cmV0dXJuIGlkO1xuICAgIH07XG59XG5cbnZhciBncmFkaWVudElkID0gbWFrZUlkQ291bnRlcigpO1xuXG5tb2R1bGUuZXhwb3J0cyA9IHtcbiAgICB0ZXh0OiBmdW5jdGlvbihjb250ZW50LHgseSxzaXplLGZhbWlseSx3ZWlnaHQsYWxpZ25tZW50X2Jhc2VsaW5lKSB7XG5cdHNpemUgPSBzaXplIHx8IDEyO1xuXHR2YXIgYWxpZ25tZW50X2Jhc2VsaW5lX3lfb2Zmc2V0ID0gc2l6ZTtcblx0aWYgKGFsaWdubWVudF9iYXNlbGluZSA9PT0gXCJtaWRkbGVcIikge1xuXHQgICAgYWxpZ25tZW50X2Jhc2VsaW5lX3lfb2Zmc2V0ID0gc2l6ZS8yO1xuXHR9IGVsc2UgaWYgKGFsaWdubWVudF9iYXNlbGluZSA9PT0gXCJib3R0b21cIikge1xuXHQgICAgYWxpZ25tZW50X2Jhc2VsaW5lX3lfb2Zmc2V0ID0gMDtcblx0fVxuXHR2YXIgZWx0ID0gbWFrZVNWR0VsZW1lbnQoJ3RleHQnLCB7XG5cdCAgICAneCc6KHggfHwgMCksXG5cdCAgICAneSc6KHkgfHwgMCkgKyBhbGlnbm1lbnRfYmFzZWxpbmVfeV9vZmZzZXQsXG5cdCAgICAnZm9udC1zaXplJzpzaXplLFxuXHQgICAgJ2ZvbnQtZmFtaWx5JzooZmFtaWx5IHx8ICdzZXJpZicpLFxuXHQgICAgJ2ZvbnQtd2VpZ2h0Jzood2VpZ2h0IHx8ICdub3JtYWwnKSxcblx0ICAgICd0ZXh0LWFuY2hvcic6J3N0YXJ0Jyxcblx0fSk7XG5cdGVsdC50ZXh0Q29udGVudCA9IGNvbnRlbnQgKyAnJztcblx0cmV0dXJuIGVsdDtcbiAgICB9LFxuICAgIGdyb3VwOiBmdW5jdGlvbih4LHkpIHtcblx0eCA9IHggfHwgMDtcblx0eSA9IHkgfHwgMDtcblx0cmV0dXJuIG1ha2VTVkdFbGVtZW50KCdnJywge1xuXHQgICAgJ3RyYW5zZm9ybSc6J3RyYW5zbGF0ZSgnK3grJywnK3krJyknLFxuXHQgICAgJ3gnOngsXG5cdCAgICAneSc6eVxuXHR9KTtcbiAgICB9LFxuICAgIHN2ZzogZnVuY3Rpb24od2lkdGgsIGhlaWdodCkge1xuXHRyZXR1cm4gbWFrZVNWR0VsZW1lbnQoJ3N2ZycsIHtcblx0ICAgICd3aWR0aCc6KHdpZHRoIHx8IDApLCBcblx0ICAgICdoZWlnaHQnOihoZWlnaHQgfHwgMCksXG5cdH0pO1xuICAgIH0sXG4gICAgd3JhcFRleHQ6IGZ1bmN0aW9uKGluX2RvbV90ZXh0X3N2Z19lbHQsIHdpZHRoKSB7XG5cdHZhciB0ZXh0ID0gaW5fZG9tX3RleHRfc3ZnX2VsdC50ZXh0Q29udGVudDtcblx0aW5fZG9tX3RleHRfc3ZnX2VsdC50ZXh0Q29udGVudCA9IFwiXCI7XG5cdFxuXHR2YXIgd29yZHMgPSB0ZXh0LnNwbGl0KFwiIFwiKTtcblx0dmFyIGR5ID0gMDtcblx0dmFyIHRzcGFuID0gbWFrZVNWR0VsZW1lbnQoJ3RzcGFuJywgeyd4JzonMCcsICdkeSc6ZHl9KTtcblx0aW5fZG9tX3RleHRfc3ZnX2VsdC5hcHBlbmRDaGlsZCh0c3Bhbik7XG5cdFxuXHR2YXIgY3Vycl90c3Bhbl93b3JkcyA9IFtdO1xuXHRmb3IgKHZhciBpPTA7IGk8d29yZHMubGVuZ3RoOyBpKyspIHtcblx0ICAgIGN1cnJfdHNwYW5fd29yZHMucHVzaCh3b3Jkc1tpXSk7XG5cdCAgICB0c3Bhbi50ZXh0Q29udGVudCA9IGN1cnJfdHNwYW5fd29yZHMuam9pbihcIiBcIik7XG5cdCAgICBpZiAodHNwYW4uZ2V0Q29tcHV0ZWRUZXh0TGVuZ3RoKCkgPiB3aWR0aCkge1xuXHRcdHRzcGFuLnRleHRDb250ZW50ID0gY3Vycl90c3Bhbl93b3Jkcy5zbGljZSgwLCBjdXJyX3RzcGFuX3dvcmRzLmxlbmd0aC0xKS5qb2luKFwiIFwiKTtcblx0XHRkeSA9IGluX2RvbV90ZXh0X3N2Z19lbHQuZ2V0QkJveCgpLmhlaWdodDtcblx0XHRjdXJyX3RzcGFuX3dvcmRzID0gW3dvcmRzW2ldXTtcblx0XHR0c3BhbiA9IG1ha2VTVkdFbGVtZW50KCd0c3BhbicsIHsneCc6JzAnLCAnZHknOmR5fSk7XG5cdFx0aW5fZG9tX3RleHRfc3ZnX2VsdC5hcHBlbmRDaGlsZCh0c3Bhbik7XG5cdFx0dHNwYW4udGV4dENvbnRlbnQgPSB3b3Jkc1tpXTtcblx0ICAgIH1cblx0fVxuICAgIH0sXG4gICAgZnJvbVNoYXBlOiBmdW5jdGlvbihvbmNvcHJpbnRfc2hhcGVfY29tcHV0ZWRfcGFyYW1zLCBvZmZzZXRfeCwgb2Zmc2V0X3kpIHtcblx0cmV0dXJuIHNoYXBlVG9TVkcob25jb3ByaW50X3NoYXBlX2NvbXB1dGVkX3BhcmFtcywgb2Zmc2V0X3gsIG9mZnNldF95KTtcbiAgICB9LFxuICAgIHBvbHlnb246IGZ1bmN0aW9uKHBvaW50cywgZmlsbCkge1xuXHRyZXR1cm4gbWFrZVNWR0VsZW1lbnQoJ3BvbHlnb24nLCB7J3BvaW50cyc6IHBvaW50cywgJ2ZpbGwnOmZpbGx9KTtcbiAgICB9LFxuICAgIHJlY3Q6IGZ1bmN0aW9uKHgseSx3aWR0aCxoZWlnaHQsZmlsbCkge1xuXHRyZXR1cm4gbWFrZVNWR0VsZW1lbnQoJ3JlY3QnLCB7J3gnOngsICd5Jzp5LCAnd2lkdGgnOndpZHRoLCAnaGVpZ2h0JzpoZWlnaHQsICdmaWxsJzpmaWxsfSk7XG4gICAgfSxcbiAgICBiZ3JlY3Q6IGZ1bmN0aW9uKHdpZHRoLCBoZWlnaHQsIGZpbGwpIHtcblx0cmV0dXJuIG1ha2VTVkdFbGVtZW50KCdyZWN0Jywgeyd3aWR0aCc6d2lkdGgsICdoZWlnaHQnOmhlaWdodCwgJ2ZpbGwnOmZpbGx9KTtcbiAgICB9LFxuICAgIHBhdGg6IGZ1bmN0aW9uKHBvaW50cywgc3Ryb2tlLCBmaWxsKSB7XG5cdHBvaW50cyA9IHBvaW50cy5tYXAoZnVuY3Rpb24ocHQpIHsgcmV0dXJuIHB0LmpvaW4oXCIsXCIpOyB9KTtcblx0cG9pbnRzWzBdID0gJ00nK3BvaW50c1swXTtcblx0Zm9yICh2YXIgaT0xOyBpPHBvaW50cy5sZW5ndGg7IGkrKykge1xuXHQgICAgcG9pbnRzW2ldID0gJ0wnK3BvaW50c1tpXTtcblx0fVxuXHRzdHJva2UgPSBleHRyYWN0Q29sb3Ioc3Ryb2tlKTtcblx0ZmlsbCA9IGV4dHJhY3RDb2xvcihmaWxsKTtcblx0cmV0dXJuIG1ha2VTVkdFbGVtZW50KCdwYXRoJywge1xuXHQgICAgJ2QnOiBwb2ludHMuam9pbihcIiBcIiksXG5cdCAgICAnc3Ryb2tlJzogc3Ryb2tlLnJnYixcblx0ICAgICdzdHJva2Utb3BhY2l0eSc6IHN0cm9rZS5vcGFjaXR5LFxuXHQgICAgJ2ZpbGwnOiBmaWxsLnJnYixcblx0ICAgICdmaWxsLW9wYWNpdHknOiBmaWxsLm9wYWNpdHlcblx0fSk7XG4gICAgfSxcbiAgICBkZWZzOiBmdW5jdGlvbigpIHtcblx0cmV0dXJuIG1ha2VTVkdFbGVtZW50KCdkZWZzJyk7XG4gICAgfSxcbiAgICBncmFkaWVudDogZnVuY3Rpb24oY29sb3JGbikge1xuXHR2YXIgZ3JhZGllbnQgPSBtYWtlU1ZHRWxlbWVudCgnbGluZWFyR3JhZGllbnQnLCB7XG5cdCAgICAnaWQnOiAnZ3JhZGllbnQnK2dyYWRpZW50SWQoKSxcblx0ICAgICd4MSc6MCxcblx0ICAgICd5MSc6MCxcblx0ICAgICd4Mic6MSxcblx0ICAgICd5Mic6MFxuXHR9KTtcblx0Zm9yICh2YXIgaT0wOyBpPD0xMDA7IGkrKykge1xuXHQgICAgdmFyIGNvbG9yID0gZXh0cmFjdENvbG9yKGNvbG9yRm4oaS8xMDApKTtcblx0ICAgIGdyYWRpZW50LmFwcGVuZENoaWxkKG1ha2VTVkdFbGVtZW50KCdzdG9wJywge1xuXHRcdCdvZmZzZXQnOiBpICsgJyUnLFxuXHRcdCdzdG9wLWNvbG9yJzpjb2xvci5yZ2IsXG5cdFx0J3N0b3Atb3BhY2l0eSc6IGNvbG9yLm9wYWNpdHlcblx0ICAgIH0pKTtcblx0fVxuXHRyZXR1cm4gZ3JhZGllbnQ7XG4gICAgfVxufTtcblxuXG4iXX0=
